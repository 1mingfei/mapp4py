cscope 15 $HOME/Software/mapp4py/src               0001563912
	@MAPP.cpp

1 
	~<PythÚ.h
>

2 
	~"py_com·t.h
"

3 
	#NPY_NO_DEPRECATED_API
 
NPY_1_7_API_VERSION


	)

4 
	#PY_ARRAY_UNIQUE_SYMBOL
 
ARRAY_API


	)

5 
	~<numpy/¬¿yobjeù.h
>

6 
	~"MAPP.h
"

7 
	~<mpi.h
>

8 
	~<dlfú.h
>

9 
	~"comm.h
"

10 
	~"exam¶e.h
"

11 
	~"©oms_¡yËs.h
"

12 
	~"md_¡yËs.h
"

13 
	~"mš_¡yËs.h
"

14 
	~"d«_¡yËs.h
"

15 
	~"expÜt_¡yËs.h
"

16 #ifdeà
POTFIT


17 
	~"pÙf™.h
"

18 
	~"pÙf™_o.h
"

20 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

22 
PyM‘hodDef
 
	gMAPP
::
m‘hods
[]=
Em±yPyM‘hodDef
(3);

24 
	gMAPP
::
	$£tup_m‘hods
()

26 
m‘hods
[0].
ml_Çme
="pause_slave_out";

27 
m‘hods
[0].
ml_m‘h
=(
PyCFunùiÚ
)
·u£_out
;

28 
m‘hods
[0].
ml_æags
=
METH_NOARGS
;

29 
m‘hods
[0].
ml_doc
=(*)
R
"---(

30 
	`·u£_¦ave_out
()

32 
Pau£s
 
¡dout
 & 
¡d”r
 
of
 
nÚ
-
roÙ
 
´oûs£s


34 
R‘uºs


36 
NÚe


38 
NÙes


40 
This
 
funùiÚ
 
¡İs
 
pythÚ
's stdout‡nd stderr of‡ll…rocessesorsƒxcepthe„oot…rocessor

43 
Exam¶es


47 >>> 
	`·u£_¦ave_out
()

51 
m‘hods
[1].
ml_Çme
="resume_slave_out";

52 
m‘hods
[1].
ml_m‘h
=(
PyCFunùiÚ
)
»sume_out
;

53 
m‘hods
[1].
ml_æags
=
METH_NOARGS
;

54 
m‘hods
[1].
ml_doc
=(*)
R
"---(

55 
	`»sume_¦ave_out
()

57 
Resumes
 
¡dout
 & 
¡d”r
 
of
 
nÚ
-
roÙ
 
´oûs£s


59 
R‘uºs


61 
NÚe


63 
NÙes


65 
This
 
funùiÚ
 
»sumes
 
pythÚ
's stdout‡nd stderr of‡ll ifhey have been…aused by :py:function:`mapp.pause_slave_out`

68 
Exam¶es


72 >>> 
	`»sume_¦ave_out
()

75 
	}
}

79 
PyObjeù
* 
MAPP
::
	$·u£_out
(
PyObjeù
*)

81 
	`MPI_B¬r›r
(
MPI_COMM_WORLD
);

82 if(!
glbl_¿nk
è
Py_RETURN_NONE
;

83 if(!
__devnuÎ__
è__devnuÎ__=
	`fİ’
(
devnuÎ_·th
,"w");

85 
	`GET_FILE_FROM_PY
(
¡dout
)=
__devnuÎ__
;

86 
	`GET_FILE_FROM_PY
(
¡d”r
)=
__devnuÎ__
;

87 
m­p_out
=
__devnuÎ__
;

88 
m­p_”r
=
__devnuÎ__
;

89 
Py_RETURN_NONE
;

90 
	}
}

94 
PyObjeù
* 
	gMAPP
::
	$»sume_out
(
PyObjeù
*)

96 
	`MPI_B¬r›r
(
MPI_COMM_WORLD
);

97 
	`GET_FILE_FROM_PY
(
¡dout
)=
__¡dout__
;

98 
	`GET_FILE_FROM_PY
(
¡d”r
)=
__¡d”r__
;

99 
m­p_out
=
__¡dout__
;

100 
m­p_”r
=
__¡d”r__
;

101 if(
__devnuÎ__
)

103 
	`fşo£
(
__devnuÎ__
);

104 
__devnuÎ__
=
NULL
;

106 
Py_RETURN_NONE
;

107 
	}
}

109 cÚ¡ * 
	gMAPP
::
devnuÎ_·th
;

110 
	gMAPP
::
glbl_¿nk
=0;

111 
FILE
* 
	gMAPP_NS
::
MAPP
::
__devnuÎ__
(
NULL
);

112 
FILE
* 
	gMAPP_NS
::
MAPP
::
__¡dout__
(
NULL
);

113 
FILE
* 
	gMAPP_NS
::
MAPP
::
__¡d”r__
(
NULL
);

114 
FILE
* 
	gMAPP_NS
::
MAPP
::
m­p_out
(
NULL
);

115 
FILE
* 
	gMAPP_NS
::
MAPP
::
m­p_”r
(
NULL
);

116 #ifdeà
MAPP_DEBUG_MODE


117 
FILE
* 
	gMAPP_NS
::
MAPP
::
m­p_debug
(
NULL
);

119 #ifdeà
IS_PY3K


120 
PyModuËDef
 
	gMAPP
::
moduË
=
Em±yModuË
;

122 
MOD_INIT
(
m­p
,
MAPP_NS
::
MAPP
::
	$š™_moduË
())

124 
PyObjeù
* 
MAPP
::
	$š™_moduË
()

126 
mpi_š™Ÿlized
;

127 
	`MPI_In™Ÿlized
(&
mpi_š™Ÿlized
);

128 if(!
mpi_š™Ÿlized
)

130 
	`dlİ’
("libmpi.so.0",
RTLD_GLOBAL
 | 
RTLD_LAZY
);

131 
	`MPI_In™
(
NULL
,NULL);

134 #ifdeà
MAPP_DEBUG_MODE


135 
	~<uni¡d.h
>

136 
	~<io¡»am
>

137 
debug_fe
 [100];

138 
¿nk
;

139 
	`MPI_Comm_¿nk
(
MPI_COMM_WORLD
,&
¿nk
);

140 
	`¥rštf
(
debug_fe
, "Debug/debug-%d",
¿nk
);

141 
m­p_debug
=
	`fİ’
(
debug_fe
,"w");

142 
	`årštf
(
m­p_debug
,"my…id i %d\n",
	`g‘pid
());

144 
	`Py_AtEx™
([]()

146 #ifdeà
MAPP_DEBUG_MODE


147 
	`fşo£
(
m­p_debug
);

149 
mpi_fš®ized
;

150 
	`MPI_Fš®ized
(&
mpi_fš®ized
);

151 if(!
mpi_fš®ized
è
	`MPI_Fš®ize
();

154 
PyObjeù
* 
posix·th
=
	`PyImpÜt_ImpÜtModuË
("posixpath");

155 
PyObjeù
* 
devnuÎ_·th_İ
=
	`PyObjeù_G‘A‰rSŒšg
(
posix·th
,"devnull");

156 
devnuÎ_·th
=
	`__PySŒšg_AsSŒšg
(
devnuÎ_·th_İ
);

157 
	`Py_DECREF
(
devnuÎ_·th_İ
);

158 
	`Py_DECREF
(
posix·th
);

159 
glbl_¿nk
=
CommuniÿtiÚ
::
	`g‘_¿nk
();

161 
m­p_out
=
__¡dout__
=
	`GET_FILE_FROM_PY
(
¡dout
);

162 
m­p_”r
=
__¡d”r__
=
	`GET_FILE_FROM_PY
(
¡d”r
);

164 
	`impÜt_¬¿y2
("m­°wa uÇbËØimpÜˆnumpy.cÜe.muÉŸ¼ay", 
NULL
)

165 
	`£tup_m‘hods
();

166 #ifdeà
IS_PY3K


167 
moduË
.
m_Çme
="mapp";

168 
moduË
.
m_doc
="MIT Atomistic Parallel Package";

169 
moduË
.
m_m‘hods
=
m‘hods
;

170 
PyObjeù
* 
moduË_ob
=
	`PyModuË_C»©e
(&
moduË
);

172 
PyObjeù
* 
moduË_ob
=
	`Py_In™ModuË3
("m­p",
m‘hods
,"MIT Atomistic Parallel Package");

176 if(
moduË_ob
==
NULL
)  NULL;

178 
MAPP_MPI
::
	`£tup_
();

179 if(
	`PyTy³_R—dy
(&
MAPP_MPI
::
Ty³Objeù
)<0è 
NULL
;

180 
	`Py_INCREF
(&
MAPP_MPI
::
Ty³Objeù
);

181 
	`PyModuË_AddObjeù
(
moduË_ob
,"mpi",
»š‹½»t_ÿ¡
<
PyObjeù
*>(&
MAPP_MPI
::
Ty³Objeù
));

184 if(
LšeS—rch
::
	`£tup_
()<0è 
NULL
;

185 
	`PyModuË_AddObjeù
(
moduË_ob
,"ls",
»š‹½»t_ÿ¡
<
PyObjeù
*>(&
LšeS—rch
::
Ty³Objeù
));

188 if(
LšeS—rchGŞd’SeùiÚ
::
	`£tup_
()<0è 
NULL
;

189 
	`PyModuË_AddObjeù
(
moduË_ob
,"ls_gŞd’",
»š‹½»t_ÿ¡
<
PyObjeù
*>(&
LšeS—rchGŞd’SeùiÚ
::
Ty³Objeù
));

192 if(
LšeS—rchB»Á
::
	`£tup_
()<0è 
NULL
;

193 
	`PyModuË_AddObjeù
(
moduË_ob
,"ls_b»Á",
»š‹½»t_ÿ¡
<
PyObjeù
*>(&
LšeS—rchB»Á
::
Ty³Objeù
));

196 if(
LšeS—rchBackT¿ck
::
	`£tup_
()<0è 
NULL
;

197 
	`PyModuË_AddObjeù
(
moduË_ob
,"ls_bt",
»š‹½»t_ÿ¡
<
PyObjeù
*>(&
LšeS—rchBackT¿ck
::
Ty³Objeù
));

199 #ifdeà
POTFIT


202 if(
PÙF™O
::
	`£tup_
()<0è 
NULL
;

203 
	`PyModuË_AddObjeù
(
moduË_ob
,"pÙf™_o",
»š‹½»t_ÿ¡
<
PyObjeù
*>(&
PÙF™O
::
Ty³Objeù
));

205 if(
PÙF™
<
FÜûF›ldEAMPÙF™AckOg©a
,2>::
	`£tup_
()<0è 
NULL
;

206 
	`PyModuË_AddObjeù
(
moduË_ob
,"pÙf™",
»š‹½»t_ÿ¡
<
PyObjeù
*>(&
PÙF™
<
FÜûF›ldEAMPÙF™AckOg©a
,2>::
Ty³Objeù
));

209 
PyObjeù
* 
md
=
MAPP
::
MD
::
	`š™_moduË
();

210 if(
md
==
NULL
)  NULL;

211 
	`PyModuË_AddObjeù
(
moduË_ob
,"md",
md
);

214 
PyObjeù
* 
dmd
=
MAPP
::
DMD
::
	`š™_moduË
();

215 if(
dmd
==
NULL
)  NULL;

216 
	`PyModuË_AddObjeù
(
moduË_ob
,"dmd",
dmd
);

218 
	`·u£_out
(
NULL
);

219 #ifdeà
IS_PY3K


220  
moduË_ob
;

222  
NULL
;

224 
	}
}

226 
PyM‘hodDef
 
	gMAPP
::
MD
::
m‘hods
[]=
Em±yPyM‘hodDef
(1);

228 
	gMAPP
::
MD
::
	$£tup_m‘hods
()

234 
	}
}

236 #ifdeà
IS_PY3K


237 
PyModuËDef
 
MAPP
::
MD
::
moduË
=
Em±yModuË
;

240 
PyObjeù
* 
	gMAPP
::
MD
::
	$š™_moduË
()

242 
	`£tup_m‘hods
();

243 #ifdeà
IS_PY3K


244 
moduË
.
m_Çme
="mapp.md";

245 
moduË
.
m_doc
="Molecular Dynamics (MD) module";

246 
moduË
.
m_m‘hods
=
m‘hods
;

247 
PyObjeù
* 
moduË_ob
=
	`PyModuË_C»©e
(&
moduË
);

249 
PyObjeù
* 
moduË_ob
=
	`Py_In™ModuË3
("m­p.md",
m‘hods
,"Molecular Dynamics (MD) module");

251 if(
moduË_ob
==
NULL
)  NULL;

254 if(
AtomsMD
::
	`£tup_
()<0è 
NULL
;

255 
	`PyModuË_AddObjeù
(
moduË_ob
,"©oms",
»š‹½»t_ÿ¡
<
PyObjeù
*>(&
AtomsMD
::
Ty³Objeù
));

257 if(
MDNVT
::
	`£tup_
()<0è 
NULL
;

258 
	`PyModuË_AddObjeù
(
moduË_ob
,"nvt",
»š‹½»t_ÿ¡
<
PyObjeù
*>(&
MDNVT
::
Ty³Objeù
));

261 if(
MDNST
::
	`£tup_
()<0è 
NULL
;

262 
	`PyModuË_AddObjeù
(
moduË_ob
,"n¡",
»š‹½»t_ÿ¡
<
PyObjeù
*>(&
MDNST
::
Ty³Objeù
));

265 if(
MDMuVT_2
::
	`£tup_
()<0è 
NULL
;

266 
	`PyModuË_AddObjeù
(
moduË_ob
,"muvt",
»š‹½»t_ÿ¡
<
PyObjeù
*>(&
MDMuVT_2
::
Ty³Objeù
));

269 if(
MšCG
::
	`£tup_
()<0è 
NULL
;

270 
	`PyModuË_AddObjeù
(
moduË_ob
,"mš_cg",
»š‹½»t_ÿ¡
<
PyObjeù
*>(&
MšCG
::
Ty³Objeù
));

273 if(
MšLBFGS
::
	`£tup_
()<0è 
NULL
;

274 
	`PyModuË_AddObjeù
(
moduË_ob
,"mš_lbfgs",
»š‹½»t_ÿ¡
<
PyObjeù
*>(&
MšLBFGS
::
Ty³Objeù
));

277 if(
ExpÜtMD
::
	`£tup_
()<0è 
NULL
;

278 
	`PyModuË_AddObjeù
(
moduË_ob
,"expÜt",
»š‹½»t_ÿ¡
<
PyObjeù
*>(&
ExpÜtMD
::
Ty³Objeù
));

281 if(
ExpÜtCFGMD
::
	`£tup_
()<0è 
NULL
;

282 
	`PyModuË_AddObjeù
(
moduË_ob
,"expÜt_cfg",
»š‹½»t_ÿ¡
<
PyObjeù
*>(&
ExpÜtCFGMD
::
Ty³Objeù
));

285  
moduË_ob
;

286 
	}
}

288 
PyM‘hodDef
 
	gMAPP
::
DMD
::
m‘hods
[]=
Em±yPyM‘hodDef
(4);

290 
	gMAPP
::
DMD
::
	$£tup_m‘hods
()

293 
Exam¶ePythÚ
::
	`ml_mv_c
(
m‘hods
[0]);

294 
Exam¶ePythÚ
::
	`ml_mv_c2
(
m‘hods
[1]);

295 
Exam¶ePythÚ
::
	`ml_mv_c3
(
m‘hods
[2]);

301 
	}
}

303 #ifdeà
IS_PY3K


304 
PyModuËDef
 
	gMAPP
::
DMD
::
moduË
=
Em±yModuË
;

307 
PyObjeù
* 
	gMAPP
::
DMD
::
	$š™_moduË
()

309 
	`£tup_m‘hods
();

310 #ifdeà
IS_PY3K


311 
moduË
.
m_Çme
="mapp.dmd";

312 
moduË
.
m_doc
="Diffusive Molecular Dynamics (MD) module";

313 
moduË
.
m_m‘hods
=
m‘hods
;

314 
PyObjeù
* 
moduË_ob
=
	`PyModuË_C»©e
(&
moduË
);

316 
PyObjeù
* 
moduË_ob
=
	`Py_In™ModuË3
("m­p.dmd",
m‘hods
,"Diffusive Molecular Dynamics (DMD) module");

318 if(
moduË_ob
==
NULL
)  NULL;

321 if(
AtomsDMD
::
	`£tup_
()<0è 
NULL
;

322 
	`PyModuË_AddObjeù
(
moduË_ob
,"©oms",
»š‹½»t_ÿ¡
<
PyObjeù
*>(&
AtomsDMD
::
Ty³Objeù
));

325 if(
MšCGDMD
::
	`£tup_
()<0è 
NULL
;

326 
	`PyModuË_AddObjeù
(
moduË_ob
,"mš_cg",
»š‹½»t_ÿ¡
<
PyObjeù
*>(&
MšCGDMD
::
Ty³Objeù
));

328 if(
MšCG3DMD
::
	`£tup_
()<0è 
NULL
;

329 
	`PyModuË_AddObjeù
(
moduË_ob
,"mš_cg3",
»š‹½»t_ÿ¡
<
PyObjeù
*>(&
MšCG3DMD
::
Ty³Objeù
));

331 if(
MšLBFGSDMD
::
	`£tup_
()<0è 
NULL
;

332 
	`PyModuË_AddObjeù
(
moduË_ob
,"mš_lbfgs",
»š‹½»t_ÿ¡
<
PyObjeù
*>(&
MšLBFGSDMD
::
Ty³Objeù
));

335 if(
DAEBDF
::
	`£tup_
()<0è 
NULL
;

336 
	`PyModuË_AddObjeù
(
moduË_ob
,"bdf",
»š‹½»t_ÿ¡
<
PyObjeù
*>(&
DAEBDF
::
Ty³Objeù
));

338 if(
ExpÜtDMD
::
	`£tup_
()<0è 
NULL
;

339 
	`PyModuË_AddObjeù
(
moduË_ob
,"expÜt",
»š‹½»t_ÿ¡
<
PyObjeù
*>(&
ExpÜtDMD
::
Ty³Objeù
));

341 if(
ExpÜtCFGDMD
::
	`£tup_
()<0è 
NULL
;

342 
	`PyModuË_AddObjeù
(
moduË_ob
,"expÜt_cfg",
»š‹½»t_ÿ¡
<
PyObjeù
*>(&
ExpÜtCFGDMD
::
Ty³Objeù
));

345  
moduË_ob
;

346 
	}
}

	@MAPP.h

1 #iâdeà
__MAPP__MAPP__


2 
	#__MAPP__MAPP__


	)

3 
	~<¡dio.h
>

4 
	g_objeù
;

5 
_objeù
 
	tPyObjeù
;

6 
PyM‘hodDef
 
	tPyM‘hodDef
;

7 
PyModuËDef
 
	tPyModuËDef
;

8 
Çme¥aû
 
	gMAPP_NS


10 şas 
	cMAPP


12 
	g´iv©e
:

13 cÚ¡ * 
devnuÎ_·th
;

14 
	gglbl_¿nk
;

15 
	g´Ùeùed
:

16 
public
:

17 
PyModuËDef
 
moduË
;

18 
PyObjeù
* 
š™_moduË
();

20 
FILE
* 
	g__¡dout__
;

21 
FILE
* 
	g__¡d”r__
;

22 
FILE
* 
	g__devnuÎ__
;

23 #ifdeà
MAPP_DEBUG_MODE


24 
FILE
* 
	gm­p_debug
;

27 
FILE
* 
	gm­p_out
;

28 
FILE
* 
	gm­p_”r
;

30 
PyObjeù
* 
·u£_out
(PyObjeù* =
NULL
);

31 
PyObjeù
* 
»sume_out
(PyObjeù* =
NULL
);

33 
PyM‘hodDef
 
	gm‘hods
[];

34 
£tup_m‘hods
();

36 şas 
	cMD


38 
	g´iv©e
:

39 
´Ùeùed
:

40 
public
:

41 
PyModuËDef
 
moduË
;

42 
PyObjeù
* 
š™_moduË
();

43 
PyM‘hodDef
 
	gm‘hods
[];

44 
£tup_m‘hods
();

47 şas 
	cDMD


49 
	g´iv©e
:

50 
´Ùeùed
:

51 
public
:

52 
PyModuËDef
 
moduË
;

53 
PyObjeù
* 
š™_moduË
();

54 
PyM‘hodDef
 
	gm‘hods
[];

55 
£tup_m‘hods
();

	@api.h

1 #iâdeà
__MAPP__­i__


2 
	#__MAPP__­i__


	)

4 
	~"logics.h
"

6 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

10 
Çme¥aû
 
	gMAPP_NS


14 
	g‹m¶©e
<
şass
 
	gT
>

15 şas 
	cV¬API


17 
	g´iv©e
:

18 
´Ùeùed
:

19 
public
:

20 
ty³Çme
 
	tıp_ty³
<
	tT
>::
	tty³
 
	tS
;

21 
S
 
	gv®
;

22 
	gv¬
<
	gT
> 
	g__v¬__
;

23 
Logics
 
	glogics
[
v¬
<
T
>::
g‘_¿nk
()+1];

25 
V¬API
(const *);

26 
	g‹m¶©e
<
	gşass
 ... 
	gTs
>

27 
V¬API
(cÚ¡ *,
Ts
&&...);

28 ~
V¬API
();

31 
PyObjeù
* 
g‘
();

32 
£t
(
PyObjeù
*);

33 
boŞ
 
£t_nÙhrow
(
PyObjeù
*);

34 cÚ¡ * 
Çme
() const;

35 * 
g‘_±r
(){ &
	gv®
;}

43 
	g‹m¶©e
<
şass
 
	gT
>

44 
	gV¬API
<
	gT
>::
	$V¬API
(cÚ¡ * 
Çme
):

45 
	$__v¬__
(
v®
,
Çme
)

47 
	}
}

51 
	g‹m¶©e
<
şass
 
	gT
>‹m¶©e<
	gşass
 ... 
	gTs
>

52 
	gV¬API
<
	gT
>::
	$V¬API
(cÚ¡ * 
Çme
,
Ts
&&...
dsizes
):

53 
	$__v¬__
(
v®
,
Çme
,
dsizes
...)

55 
	}
}

59 
	g‹m¶©e
<
şass
 
	gT
>

60 
	gV¬API
<
	gT
>::~
	$V¬API
()

61 {
	}
}

65 
‹m¶©e
<
şass
 
T
>

66 
PyObjeù
* 
V¬API
<
T
>::
	$g‘
()

68 if(
__v¬__
.
obj_£t
)

69  
__v¬__
.
	`g‘
();

71 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"% ha nÙ b“À£ˆy‘",
__v¬__
.
Çme
.
	`c_¡r
());

72  
NULL
;

73 
	}
}

77 
	g‹m¶©e
<
şass
 
	gT
>

78 
	gV¬API
<
	gT
>::
	$£t
(
PyObjeù
* 
İ
)

80 
Œy


82 
__v¬__
.
	`£t
(
İ
);

84 
	`ÿtch
(
¡d
::
¡ršg
& 
”r_msg
)

86 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,
”r_msg
.
	`c_¡r
());

89 
Œy


91 
Logics
::
	`v¬_log
(&
__v¬__
,
logics
+
v¬
<
T
>::
	`g‘_¿nk
());

93 
	`ÿtch
(
¡d
::
¡ršg
& 
”r_msg
)

95 
	`PyE¼_S‘SŒšg
(
PyExc_V®ueE¼Ü
,
”r_msg
.
	`c_¡r
());

98 
__v¬__
.
obj_£t
=
Œue
;

100 
	}
}

104 
	g‹m¶©e
<
şass
 
	gT
>

105 
boŞ
 
	gV¬API
<
	gT
>::
	$£t_nÙhrow
(
PyObjeù
* 
İ
)

107 if(!
__v¬__
.
	`£t_nÙhrow
(
İ
))

108  
çl£
;

110 if(!
Logics
::
	`v¬_log_nÙhrow
(&
__v¬__
,
logics
+
v¬
<
T
>::
	`g‘_¿nk
()))

111  
çl£
;

113  
Œue
;

114 
	}
}

118 
	g‹m¶©e
<
şass
 
	gT
>

119 cÚ¡ * 
	gV¬API
<
	gT
>::
	$Çme
() const

121  
__v¬__
.
Çme
.
	`c_¡r
();

122 
	}
}

126 
Çme¥aû
 
	gMAPP_NS


128 
	g‹m¶©e
 <
	gşass
... 
	gTs
>

129 şas 
	cFuncTu¶e


132 
	g‹m¶©e
 <
şass
 
	gT
, 
	gşass
... 
	gTs
>

133 
şass
 
	gFuncTu¶e
<
	gT
, 
	gTs
...>

135 
	g´iv©e
:

136 
´Ùeùed
:

137 
public
:

138 
T
 
	tty³
;

140 
	gFuncTu¶e
<
	gTs
...> 
	gÃxt_func
;

141 
	gV¬API
<
	gT
> 
	g__v¬_­i__
;

142 
PyObjeù
* 
	gİ
;

145 
m©ch_kwd
(cÚ¡ *,
PyObjeù
*);

146 
m©ch
(
PyObjeù
*,
Py_ssize_t
);

147 
»£t
();

148 
£t
();

149 
ex³ùed
(
size_t
);

151 
	g‹m¶©e
 <
	gşass
... 
	gSs
>

152 
FuncTu¶e
(cÚ¡ * 
s
, 
Ss
... 
ss
):

153 
Ãxt_func
(
ss
...),

154 
__v¬_­i__
(
s
),

155 
İ
(
NULL
)

159 
FuncTu¶e
(cÚ¡ *cÚ¡* 
s
):

160 
Ãxt_func
(
s
+1),

161 
__v¬_­i__
(*
s
),

162 
İ
(
NULL
)

167 
	g‹m¶©e
<
şass
 
	gS
,
	gşass
... 
	gTTs
>

168 
PyObjeù
* 
aù
(
S
 
s
,PyObjeù* 
şs
,
TTs
 ... 
v¬s
)

170  
	gÃxt_func
.
aù
(
s
,
şs
,
v¬s
..., 
__v¬_­i__
.
v®
);

173 
	g‹m¶©e
<
şass
 
	gS
>

174 
PyObjeù
* 
İ”©Ü
()(
S
 
	gs
,PyObjeù* 
	gşs
)

176  
	gÃxt_func
.
aù
(
s
,
şs
,
__v¬_­i__
.
v®
);

182 
	g‹m¶©e
 <
şass
 
	gT
>

183 
şass
 
	gFuncTu¶e
<
	gT
>

185 
	g´iv©e
:

186 
´Ùeùed
:

187 
public
:

188 
T
 
	tty³
;

189 
	gV¬API
<
	gT
> 
	g__v¬_­i__
;

190 
PyObjeù
* 
	gİ
;

192 
m©ch_kwd
(cÚ¡ *,
PyObjeù
*);

193 
m©ch
(
PyObjeù
*,
Py_ssize_t
);

194 
»£t
();

195 
£t
();

196 
ex³ùed
(
size_t
);

198 
FuncTu¶e
(cÚ¡ * 
s
):

199 
__v¬_­i__
(
s
),

200 
İ
(
NULL
)

202 
FuncTu¶e
(cÚ¡ *cÚ¡* 
s
):

203 
__v¬_­i__
(*
s
),

204 
İ
(
NULL
)

207 
	g‹m¶©e
<
şass
 
	gS
,
	gşass
... 
	gTTs
>

208 
PyObjeù
* 
aù
(
S
 
s
,PyObjeù* 
şs
,
TTs
 ... 
v¬s
)

210  
s
(
şs
,
v¬s
...,
__v¬_­i__
.
v®
);

212 
	g‹m¶©e
<
şass
 
	gS
>

213 
PyObjeù
* 
İ”©Ü
()(
S
 
	gs
,PyObjeù* 
	gşs
)

215  
s
(
şs
,
__v¬_­i__
.
v®
);

222 
	g‹m¶©e
 <
şass
 
	gT
, 
	gşass
... 
	gTs
>

223 
	gFuncTu¶e
<
	gT
, 
	gTs
...>::
	$m©ch_kwd
(cÚ¡ * 
kwd
,
PyObjeù
* 
v®
)

225 
boŞ
 
m©ch
=!
	`¡rcmp
(
__v¬_­i__
.
	`Çme
(),
kwd
);

226 if(
m©ch
 && 
İ
)

227 
throw
 0;

228 if(
m©ch
)

230 
İ
=
v®
;

233  
Ãxt_func
.
	`m©ch_kwd
(
kwd
,
v®
);

234 
	}
}

238 
	g‹m¶©e
 <
şass
 
	gT
>

239 
	gFuncTu¶e
<
	gT
>::
	$m©ch_kwd
(cÚ¡ * 
kwd
,
PyObjeù
* 
v®
)

241 
boŞ
 
m©ch
=!
	`¡rcmp
(
__v¬_­i__
.
	`Çme
(),
kwd
);

242 if(
m©ch
 && 
İ
)

243 
throw
 0;

244 if(
m©ch
)

246 
İ
=
v®
;

249 
throw
 1;

250 
	}
}

254 
	g‹m¶©e
 <
şass
 
	gT
, 
	gşass
... 
	gTs
>

255 
	gFuncTu¶e
<
	gT
, 
	gTs
...>::
	$m©ch
(
PyObjeù
* 
tu¶e
,
Py_ssize_t
 
i
)

257 
İ
=
	`PySequ’û_Fa¡_GET_ITEM
(
tu¶e
,
i
);

258 if(
i
==
	`PyObjeù_Size
(
tu¶e
)-1)

260  
Ãxt_func
.
	`m©ch
(
tu¶e
,
i
+1);

261 
	}
}

265 
	g‹m¶©e
 <
şass
 
	gT
>

266 
	gFuncTu¶e
<
	gT
>::
	$m©ch
(
PyObjeù
* 
tu¶e
,
Py_ssize_t
 
i
)

268 
İ
=
	`PySequ’û_Fa¡_GET_ITEM
(
tu¶e
,
i
);

269 
	}
}

273 
	g‹m¶©e
 <
şass
 
	gT
, 
	gşass
... 
	gTs
>

274 
	gFuncTu¶e
<
	gT
, 
	gTs
...>::
	$»£t
()

276 
İ
=
NULL
;

277 
Ãxt_func
.
	`»£t
();

278 
	}
}

282 
	g‹m¶©e
 <
şass
 
	gT
>

283 
	gFuncTu¶e
<
	gT
>::
	$»£t
()

285 
İ
=
NULL
;

286 
	}
}

290 
	g‹m¶©e
 <
şass
 
	gT
, 
	gşass
... 
	gTs
>

291 
	gFuncTu¶e
<
	gT
, 
	gTs
...>::
	$£t
()

293 if(
İ
 && 
__v¬_­i__
.
	`£t
(op)==-1)

295  
Ãxt_func
.
	`£t
();

296 
	}
}

300 
	g‹m¶©e
 <
şass
 
	gT
>

301 
	gFuncTu¶e
<
	gT
>::
	$£t
()

303 if(
İ
 && 
__v¬_­i__
.
	`£t
(op)==-1)

306 
	}
}

310 
	g‹m¶©e
 <
şass
 
	gT
, 
	gşass
... 
	gTs
>

311 
	gFuncTu¶e
<
	gT
, 
	gTs
...>::
	$ex³ùed
(
size_t
 
i
)

313 if(
i
==0) ;

315 if(
İ
==
NULL
)

316 
throw
 
__v¬_­i__
.
	`Çme
();

318  
Ãxt_func
.
	`ex³ùed
(
i
-1);

319 
	}
}

323 
	g‹m¶©e
 <
şass
 
	gT
>

324 
	gFuncTu¶e
<
	gT
>::
	$ex³ùed
(
size_t
 
i
)

326 if(
i
==0) ;

328 if(
İ
==
NULL
)

329 
throw
 
__v¬_­i__
.
	`Çme
();

330 
	}
}

334 
Çme¥aû
 
	gMAPP_NS


338 
	g‹m¶©e
 <
size_t
 
	gI
, 
şass
 
	gT
>

339 
şass
 
	gFuncEËm’t
;

341 
	g‹m¶©e
 <
size_t
 
	gI
,
şass
 
	gT
,
	gşass
 ... 
	gTs
>

342 
şass
 
	gFuncEËm’t
<
	gI
,
	gFuncTu¶e
<
	gT
,
	gTs
...>>

344 
	gpublic
:

345 
ty³Çme
 
	tFuncEËm’t
<
	tI
-1,
	tFuncTu¶e
<
	tTs
...>>::
	tty³
ype;

346 
ty³Çme
 
	tFuncEËm’t
<
	tI
-1,
	tFuncTu¶e
<
	tTs
...>>::
	tv®_ty³
 val_type;

348 
	gV¬API
<
	gty³
>& 
v¬_­i
(
FuncTu¶e
<
T
,
Ts
...>& 
f
)

350  
	gFuncEËm’t
<
	gI
-1,
	gFuncTu¶e
<
	gTs
...>>::
v¬_­i
(
f
.
Ãxt_func
);

353 
	gv¬
<
	gty³
>& 
v¬
(
FuncTu¶e
<
T
,
Ts
...>& 
f
)

355  
	gFuncEËm’t
<
	gI
-1,
	gFuncTu¶e
<
	gTs
...>>::
v¬
(
f
.
Ãxt_func
);

358 
	gv®_ty³
& 
v®
(
FuncTu¶e
<
T
,
Ts
...>& 
f
)

360  
	gFuncEËm’t
<
	gI
-1,
	gFuncTu¶e
<
	gTs
...>>::
v®
(
f
.
Ãxt_func
);

363 
	g‹m¶©e
 <
şass
 
	gT
,
	gşass
 ... 
	gTs
>

364 
şass
 
	gFuncEËm’t
<0,
	gFuncTu¶e
<
	gT
,
	gTs
...>>

366 
	gpublic
:

367 
T
 
	tty³
;

368 
ty³Çme
 
	tV¬API
<
	tT
>::
	tS
 
	tv®_ty³
;

369 
	gV¬API
<
	gty³
>& 
v¬_­i
(
FuncTu¶e
<
T
,
Ts
...>& 
f
)

371  
	gf
.
	g__v¬_­i__
;

374 
	gv¬
<
	gty³
>& 
v¬
(
FuncTu¶e
<
T
,
Ts
...>& 
f
)

376  
	gf
.
	g__v¬_­i__
.
	g__v¬__
;

378 
	gv®_ty³
& 
v®
(
FuncTu¶e
<
T
,
Ts
...>& 
f
)

380  
	gf
.
	g__v¬_­i__
.
	gv®
;

385 
	g‹m¶©e
 <
	gşass
... 
	gTs
>

386 
şass
 
	gFuncAPI
;

388 
	g‹m¶©e
 <
şass
 
	gT
,
	gşass
... 
	gTs
>

389 
şass
 
	gFuncAPI
<
	gT
,
	gTs
 ...>

391 
	g´iv©e
:

392 
´Ùeùed
:

393 
public
:

394 
FuncTu¶e
<
T
,
	gTs
...> 
	gfunc
;

395 
size_t
 
	gnv¬s
;

396 
size_t
 
	gnİtiÚ®s
;

397 
	g¡d
::
¡ršg
 
Çme
;

399 
	g‹m¶©e
<
	gşass
 ... 
	gSs
>

400 
FuncAPI
(cÚ¡ * 
__Çme
,
Ss
 ... 
vs
):

401 
Çme
(
__Çme
+
¡d
::
¡ršg
("()")),

402 
func
(
vs
...),

403 
nv¬s
(...(
vs
)),

404 
nİtiÚ®s
(0){}

406 
FuncAPI
(cÚ¡ * 
__Çme
,
¡d
::
š™Ÿliz”_li¡
<cÚ¡ *> 
__Çmes
):

407 
Çme
(
__Çme
+
¡d
::
¡ršg
("()")),

408 
func
(
__Çmes
.
begš
()),

409 
nv¬s
(
__Çmes
.
size
()),

410 
nİtiÚ®s
(0){}

412 
İ”©Ü
()(
	gPyObjeù
*,PyObject*);

413 
	g‹m¶©e
<
şass
 
	gF
>

414 
PyObjeù
* 
İ”©Ü
()(
	gF
,
	gPyObjeù
*,PyObject*,PyObject*);

417 
	g‹m¶©e
 <
size_t
 
	gI
>

418 
	gV¬API
<
ty³Çme
 
	gFuncEËm’t
<
	gI
, 
	gFuncTu¶e
<
	gT
,
	gTs
...> >::
ty³
>& 
g‘
()

419 { 
FuncEËm’t
<
I
, 
	gFuncTu¶e
<
	gT
,
	gTs
...> >::
v¬_­i
(
func
);}

421 
	g‹m¶©e
 <
size_t
 
	gI
>

422 
	gv¬
<
ty³Çme
 
	gFuncEËm’t
<
	gI
, 
	gFuncTu¶e
<
	gT
,
	gTs
...> >::
ty³
>& 
v
()

423 { 
g‘
<
I
>().
__v¬__
;}

425 
	g‹m¶©e
 <
size_t
 
	gI
>

426 
ty³Çme
 
	gFuncEËm’t
<
	gI
, 
	gFuncTu¶e
<
	gT
,
	gTs
...> >::
v®_ty³
& 
v®
()

427 { 
g‘
<
I
>().
v®
;}

428 
	g‹m¶©e
 <
size_t
 
	gI
>

429 
ty³Çme
 
	gFuncEËm’t
<
	gI
, 
	gFuncTu¶e
<
	gT
,
	gTs
...> >::
v®_ty³
&& 
mov
()

430 { 
¡d
::
move
(
g‘
<
I
>().
v®
);}

432 
	g‹m¶©e
 <
size_t
 
	gI
>

433 
Logics
* 
logics
()

434 { 
	gg‘
<
	gI
>().
	glogics
;}

441 
	g‹m¶©e
<
size_t
 
	gI
,size_ˆ
	gI0
,
	gsize_t
 ... 
	gIs
>

442 
___»m­
(cÚ¡ * 
Çme
,cÚ¡ 
¡d
::
¡ršg
* 
–ems
,cÚ¡ 
size_t
 
ÃËms
)

447 
	g‹m¶©e
<
	gsize_t
,size_t,size_ˆ... 
	gIs
,
	gşass
 ... 
	gTTs
>

448 
»m­
(cÚ¡ *,cÚ¡ 
¡d
::
¡ršg
*,cÚ¡ 
size_t
 
ÃËms
,
TTs
& ...);

449 
	g‹m¶©e
<
	gsize_t
,
	gşass
 ... 
	gTTs
>

450 
»m­
(cÚ¡ *,cÚ¡ 
¡d
::
¡ršg
*,cÚ¡ 
size_t
,
TTs
& ...);

456 
	g‹m¶©e
 <
şass
 
	gT
,
	gşass
... 
	gTs
>

457 
	gFuncAPI
<
	gT
,
	gTs
...>::
	$İ”©Ü
()(
PyObjeù
* 
¬gs
,PyObjeù* 
kwds
)

459 
size_t
 
max_Çrgs
=
nv¬s
;

460 
size_t
 
mš_Çrgs
=
nv¬s
-
nİtiÚ®s
;

462 
size_t
 
Çrgs
=
	`PyObjeù_Size
(
¬gs
);

463 
size_t
 
nkwds
=0;

464 if(
kwds
è
nkwds
=
	`PyObjeù_Size
(kwds);

465 
Çrgs
+=
nkwds
;

467 if(
Çrgs
<
mš_Çrgs
)

469 if(
mš_Çrgs
==
max_Çrgs
)

471 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"%sakesƒxactly %zu %s (%zu given)",

472 
Çme
.
	`c_¡r
(),
mš_Çrgs
,mš_Çrgs==1?"¬gum’t":"¬gum’ts",
Çrgs
);

477 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"%sakes‡t†east %zu %s (%zu given)",

478 
Çme
.
	`c_¡r
(),
mš_Çrgs
,mš_Çrgs==1?"¬gum’t":"¬gum’ts",
Çrgs
);

482 if(
Çrgs
>
max_Çrgs
)

484 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"%sakes‡t most %zu %s (%zu given)",

485 
Çme
.
	`c_¡r
(),
max_Çrgs
,max_Çrgs==1?"¬gum’t":"¬gum’ts",
Çrgs
);

489 if(
	`PyObjeù_Size
(
¬gs
))

490 
func
.
	`m©ch
(
¬gs
,0);

492 if(
nkwds
)

494 
PyObjeù
* 
keys
=
	`PyDiù_Keys
(
kwds
);

495 
PyObjeù
* 
v®s
=
	`PyDiù_V®ues
(
kwds
);

496 
size_t
 
i
=0;i<
nkwds
;i++)

498 
Œy


500 
func
.
	`m©ch_kwd
(
	`__PySŒšg_AsSŒšg
(
	`PyLi¡_G‘I‹m
(
keys
,
i
)),PyLi¡_G‘I‹m(
v®s
,i));

502 
	`ÿtch
 (
__”r
)

504 if(
__”r
)

505 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"%s got‡n unexpected keyword "

506 "¬gum’ˆkeywÜd‡rgum’ˆ'%s'",
Çme
.
	`c_¡r
(),

507 
	`__PySŒšg_AsSŒšg
(
	`PyLi¡_G‘I‹m
(
keys
,
i
)));

509 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"%s got multiple values for "

510 "keywÜd‡rgum’ˆ'%s'",
Çme
.
	`c_¡r
(),

511 
	`__PySŒšg_AsSŒšg
(
	`PyLi¡_G‘I‹m
(
keys
,
i
)));

512 
func
.
	`»£t
();

513 
	`Py_DECREF
(
keys
);

514 
	`Py_DECREF
(
v®s
);

519 
	`Py_DECREF
(
keys
);

520 
	`Py_DECREF
(
v®s
);

523 
Œy


525 
func
.
	`ex³ùed
(
mš_Çrgs
);

527 
	`ÿtch
(cÚ¡ * 
v¬_Çme
)

529 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"%sƒxpects "

530 "v®ufÜ‡rgum’ˆ'%s'",
Çme
.
	`c_¡r
(),
v¬_Çme
);

531 
func
.
	`»£t
();

535 if(
func
.
	`£t
()==-1)

537 
func
.
	`»£t
();

541 
	}
}

545 
	g‹m¶©e
 <
şass
 
	gT
,
	gşass
... 
	gTs
>‹m¶©e<şas 
	gF
>

546 
PyObjeù
* 
	gFuncAPI
<
	gT
,
	gTs
...>::
	$İ”©Ü
()(
F
 
f
,
PyObjeù
* 
şs
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)

548 if(
this
->
	`İ”©Ü
()(
¬gs
,
kwds
)==-1)

549  
NULL
;

551 
PyObjeù
* 
ªs
=
	`func
(
f
,
şs
);

552 
func
.
	`»£t
();

553  
ªs
;

554 
	}
}

558 
Çme¥aû
 
	gMAPP_NS


560 
	g‹m¶©e
 <>

561 
şass
 
	gFuncAPI
<>

563 
	g´iv©e
:

564 
‹m¶©e
<
şass
 
T
,
	gşass
 ... 
	gTs
>

565 
§me_size
(cÚ¡ 
¡d
::
¡ršg
&,cÚ¡ 
size_t
,
T
&,
Ts
&...);

566 
	g‹m¶©e
<
şass
 
	gT
>

567 
§me_size
(cÚ¡ 
¡d
::
¡ršg
&,cÚ¡ 
size_t
,
T
&);

568 
§me_size
(cÚ¡ 
¡d
::
¡ršg
&,cÚ¡ 
size_t
){}

569 
	g‹m¶©e
<
şass
 
	gT
,
	gşass
 ... 
	gTs
>

570 
»£t_n_»m­
(cÚ¡ 
size_t
*,cÚ¡ size_t,
T
&,
Ts
& ...);

571 
	g‹m¶©e
<
şass
 
	gT
>

572 
»£t_n_»m­
(cÚ¡ 
size_t
*,cÚ¡ size_t,
T
&);

573 
»£t_n_»m­
(cÚ¡ 
size_t
*){};

574 
size_t
* 
m­pšg
(cÚ¡ 
¡d
::
¡ršg
*,cÚ¡ size_t,cÚ¡ 
V¬API
<std::string*>&);

575 
	g´Ùeùed
:

576 
public
:

577 
¡d
::
¡ršg
 
Çme
;

578 
FuncAPI
(cÚ¡ * 
__Çme
):

579 
Çme
(
__Çme
){}

580 
İ”©Ü
()(
PyObjeù
*,
	gPyObjeù
*);

581 
	g‹m¶©e
<
şass
 
	gF
>

582 
PyObjeù
* 
İ”©Ü
()(
	gF
,
	gPyObjeù
*,PyObject*,PyObject*);

584 
	g‹m¶©e
<
	gşass
 ... 
	gTs
>

585 
__»m­
(cÚ¡ *,cÚ¡ 
¡d
::
¡ršg
*,cÚ¡ 
size_t
,cÚ¡ 
V¬API
<¡d::¡ršg*>&,
Ts
&...);

592 
šlše
 
	gFuncAPI
<>::
	$İ”©Ü
()(
PyObjeù
* 
¬gs
,PyObjeù* 
kwds
)

594 
size_t
 
Çrgs
=
	`PyObjeù_Size
(
¬gs
);

595 
size_t
 
nkwds
=0;

596 if(
kwds
è
nkwds
=
	`PyObjeù_Size
(kwds);

597 
Çrgs
+=
nkwds
;

599 if(
Çrgs
!=0)

601 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"%sakes‚o‡rguments (%zu given)",

602 
Çme
.
	`c_¡r
(),
Çrgs
);

607 
	}
}

611 
	g‹m¶©e
<
şass
 
	gF
>

612 
PyObjeù
* 
	gFuncAPI
<>::
	$İ”©Ü
()(
F
 
f
,
PyObjeù
* 
şs
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)

614 if(
this
->
	`İ”©Ü
()(
¬gs
,
kwds
)==-1)

615  
NULL
;

616  
	`f
();

617 
	}
}

621 
	g‹m¶©e
<
şass
 
	gT
,
	gşass
 ... 
	gTs
>

622 
	gFuncAPI
<>::
	$§me_size
(cÚ¡ 
¡d
::
¡ršg
& 
Çme
,cÚ¡ 
size_t
 
size
,
T
& 
v
,
Ts
& ... 
vs
)

624 if(
v
.
__v¬__
.
¿nk
>0 && 
size
!=v.__var__.size)

625 
throw
 "'"+
v
.
__v¬__
.
Çme
+"' isƒxpectedo havehe same size‡s '"+name+"'";

627 
	`§me_size
(
Çme
,
size
,
vs
...);

628 
	}
}

632 
	g‹m¶©e
<
şass
 
	gT
>

633 
	gFuncAPI
<>::
	$§me_size
(cÚ¡ 
¡d
::
¡ršg
& 
Çme
,cÚ¡ 
size_t
 
size
,
T
& 
v
)

635 if(
v
.
__v¬__
.
¿nk
>0 && 
size
!=v.__var__.size)

636 
throw
 "'"+
v
.
__v¬__
.
Çme
+"' isƒxpectedo havehe same size‡s '"+name+"'";

637 
	}
}

641 
	g‹m¶©e
<
şass
 
	gT
,
	gşass
 ... 
	gTs
>

642 
	gFuncAPI
<>::
	$»£t_n_»m­
(cÚ¡ 
size_t
* 
m­
,cÚ¡ size_ˆ
m­_sz
,
T
& 
v
,
Ts
& ... 
vs
)

644 if(
v
.
__v¬__
.
¿nk
>0)

645 
v
.
__v¬__
.
	`»£t_n_»m­
(
m­
,
m­_sz
);

646 
	`»£t_n_»m­
(
m­
,
m­_sz
,
vs
...);

647 
	}
}

651 
	g‹m¶©e
<
şass
 
	gT
>

652 
	gFuncAPI
<>::
	$»£t_n_»m­
(cÚ¡ 
size_t
* 
m­
,cÚ¡ size_ˆ
m­_sz
,
T
& 
v
)

654 if(
v
.
__v¬__
.
¿nk
>0)

655 
v
.
__v¬__
.
	`»£t_n_»m­
(
m­
,
m­_sz
);

656 
	}
}

660 
šlše
 
size_t
* 
	gFuncAPI
<>::
m­pšg
(cÚ¡ 
¡d
::
¡ršg
* 
–ems
,cÚ¡ size_ˆ
ÃËms
,cÚ¡ 
V¬API
<¡d::¡ršg*>& 
v
)

663 
size_t
 
i
=0;
	gi
<
	gv
.
	g__v¬__
.
	gsize
;i++)

664 
size_t
 
	gj
=
i
+1;j<
	gv
.
	g__v¬__
.
	gsize
;j++)

665 if(!
¡rcmp
(
v
.
v®
[
i
].
c_¡r
(),v.v®[
j
].c_str()))

666 
	gthrow
 "du¶iÿ‹ƒËm’ˆ'"+
	gv
.
	gv®
[
i
]+"' iÀ'"+v.
	g__v¬__
.
	gÇme
+"'";

669 
size_t
* 
	gm­
=
Ãw
 size_t[
ÃËms
];

671 
size_t
 
	gi
=0;i<
	gÃËms
;i++)

673 
boŞ
 
	gfound
=
çl£
;

674 
size_t
 
	gj
=0;j<
	gv
.
	g__v¬__
.
	gsize
 && !
	gfound
;j++)

675 if(!
¡rcmp
(
v
.
v®
[
j
].
c_¡r
(),
–ems
[
i
].c_str()))

677 
	gm­
[
i
]=
j
;

678 
	gfound
=
Œue
;

681 if(!
	gfound
)

683 
	gd–‘e
 [] 
	gm­
;

684 
	gthrow
 "uÇbËØfšdƒlm’ˆ'"+
	g–ems
[
i
]+"' iÀ'"+
	gv
.
	g__v¬__
.
	gÇme
+"'";

688  
	gm­
;

695 
	g‹m¶©e
<
	gşass
 ... 
	gTs
>

696 
	gFuncAPI
<>::
__»m­
(cÚ¡ * 
__–ems_Çme
,cÚ¡ 
¡d
::
¡ršg
* 
__–ems
,cÚ¡ 
size_t
 
__ÃËms
,cÚ¡ 
V¬API
<¡d::¡ršg*>& 
__–em_­i
,
Ts
&... 
vs
)

698 if(
	g__–em_­i
.
	gv®
)

700 
	gŒy


702 
§me_size
(
__–em_­i
.
__v¬__
.
Çme
,__–em_­i.__v¬__.
size
,
vs
...);

704 
ÿtch
(
¡d
::
¡ršg
& 
”r_msg
)

706 
throw
 
”r_msg
;

709 
size_t
* 
	gm­
=
NULL
;

710 
	gŒy


712 
	gm­
=
m­pšg
(
__–ems
,
__ÃËms
,
__–em_­i
);

714 
ÿtch
(
¡d
::
¡ršg
& 
”r_msg
)

716 
throw
 
”r_msg
;

719 
»£t_n_»m­
(
m­
,
__ÃËms
,
vs
 ...);

720 
	gd–‘e
 [] 
	gm­
;

724 
	gŒy


726 
§me_size
(
¡d
::
¡ršg
(
__–ems_Çme
),
__ÃËms
,
vs
...);

728 
ÿtch
(
¡d
::
¡ršg
& 
”r_msg
)

730 
throw
 
”r_msg
;

738 
	g‹m¶©e
 <
şass
 
	gT
,
	gşass
... 
	gTs
>em¶©e<
size_t
 
	gM
,size_ˆ
	gI
,
	gsize_t
 ... 
	gIs
,şas ... 
	gTTs
>

739 
	gFuncAPI
<
	gT
,
	gTs
...>::
	$»m­
(cÚ¡ * 
Çme
,cÚ¡ 
¡d
::
¡ršg
* 
–ems
,cÚ¡ 
size_t
 
ÃËms
,
TTs
& ... 
vs
)

741  
»m­
<
M
,
Is
...>(
Çme
,
–ems
,
ÃËms
,
vs
 ...,
g‘
<
I
>());

742 
	}
}

746 
	g‹m¶©e
 <
şass
 
	gT
,
	gşass
... 
	gTs
>em¶©e<
size_t
 
	gM
,şas ... 
	gTTs
>

747 
	gFuncAPI
<
	gT
,
	gTs
...>::
	$»m­
(cÚ¡ * 
Çme
,cÚ¡ 
¡d
::
¡ršg
* 
–ems
,cÚ¡ 
size_t
 
ÃËms
,
TTs
& ... 
vs
)

749 
Œy


751 
FuncAPI
<>::
	`__»m­
(
Çme
,
–ems
,
ÃËms
,
g‘
<
M
>(),
vs
 ...);

753 
	`ÿtch
(
¡d
::
¡ršg
& 
”r_msg
)

755 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,
”r_msg
.
	`c_¡r
());

759 
	}
}

	@atoms.cpp

1 
	~"©oms.h
"

2 
	~"comm.h
"

3 
	~"–em’ts.h
"

4 
	~"xm©h.h
"

5 
	~<lim™s
>

6 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

7 #ifdeà
MPI_CXX_BOOL


8 
	g‹m¶©e
<> 
MPI_D©©y³
 
	gVec
<
	gboŞ
>::
MPI_T
=
MPI_CXX_BOOL
;

10 
	g‹m¶©e
<> 
MPI_D©©y³
 
	gVec
<
	gboŞ
>::
MPI_T
=
MPI_BYTE
;

12 
	g‹m¶©e
<> 
MPI_D©©y³
 
	gVec
<>::
MPI_T
=
MPI_CHAR
;

13 
	g‹m¶©e
<> 
MPI_D©©y³
 
	gVec
<>::
MPI_T
=
MPI_SHORT
;

14 
	g‹m¶©e
<> 
MPI_D©©y³
 
	gVec
<>::
MPI_T
=
MPI_INT
;

15 
	g‹m¶©e
<> 
MPI_D©©y³
 
	gVec
<>::
MPI_T
=
MPI_LONG
;

16 
	g‹m¶©e
<> 
MPI_D©©y³
 
	gVec
<>::
MPI_T
=
MPI_LONG_LONG
;

17 
	g‹m¶©e
<> 
MPI_D©©y³
 
	gVec
<>::
MPI_T
=
MPI_UNSIGNED_CHAR
;

18 
	g‹m¶©e
<> 
MPI_D©©y³
 
	gVec
<>::
MPI_T
=
MPI_UNSIGNED_SHORT
;

19 
	g‹m¶©e
<> 
MPI_D©©y³
 
	gVec
<>::
MPI_T
=
MPI_UNSIGNED
;

20 
	g‹m¶©e
<> 
MPI_D©©y³
 
	gVec
<>::
MPI_T
=
MPI_UNSIGNED_LONG
;

21 
	g‹m¶©e
<> 
MPI_D©©y³
 
	gVec
<>::
MPI_T
=
MPI_UNSIGNED_LONG_LONG
;

22 
	g‹m¶©e
<> 
MPI_D©©y³
 
	gVec
<>::
MPI_T
=
MPI_FLOAT
;

23 
	g‹m¶©e
<> 
MPI_D©©y³
 
	gVec
<>::
MPI_T
=
MPI_DOUBLE
;

24 
	g‹m¶©e
<> 
MPI_D©©y³
 
	gVec
<>::
MPI_T
=
MPI_LONG_DOUBLE
;

27 
	g‹m¶©e
<> cÚ¡ * 
	gVec
<
	gboŞ
>::
´št_fÜm©
="%d ";

28 
	g‹m¶©e
<> cÚ¡ * 
	gVec
<>::
´št_fÜm©
="%c ";

29 
	g‹m¶©e
<> cÚ¡ * 
	gVec
<>::
´št_fÜm©
="%d ";

30 
	g‹m¶©e
<> cÚ¡ * 
	gVec
<>::
´št_fÜm©
="%d ";

31 
	g‹m¶©e
<> cÚ¡ * 
	gVec
<>::
´št_fÜm©
="%ld ";

32 
	g‹m¶©e
<> cÚ¡ * 
	gVec
<>::
´št_fÜm©
="%lld ";

33 
	g‹m¶©e
<> cÚ¡ * 
	gVec
<>::
´št_fÜm©
="%c ";

34 
	g‹m¶©e
<> cÚ¡ * 
	gVec
<>::
´št_fÜm©
="%d ";

35 
	g‹m¶©e
<> cÚ¡ * 
	gVec
<>::
´št_fÜm©
="%u ";

36 
	g‹m¶©e
<> cÚ¡ * 
	gVec
<>::
´št_fÜm©
="%lu ";

37 
	g‹m¶©e
<> cÚ¡ * 
	gVec
<>::
´št_fÜm©
="%llu ";

38 
	g‹m¶©e
<> cÚ¡ * 
	gVec
<>::
´št_fÜm©
="%.16f ";

39 
	g‹m¶©e
<> cÚ¡ * 
	gVec
<>::
´št_fÜm©
="%.16lf ";

40 
	g‹m¶©e
<> cÚ¡ * 
	gVec
<>::
´št_fÜm©
="%.16Lf ";

51 
	gAtoms
::
	$Atoms
(
MPI_Comm
& 
__wÜld
):

52 
	`nvecs
(0),

53 
	`vecs
(
NULL
),

54 
	`dyÇmic_vecs
(
NULL
),

55 
	`ndyÇmic_vecs
(0),

56 
	`Çtms
(0),

57 
	`Çtms_lş
(0),

58 
	`Çtms_ph
(0),

59 
	`comm
(
__wÜld
),

60 
	`wÜld
(
comm
.
wÜld
),

61 
	`comm_¿nk
(
CommuniÿtiÚ
::
	`g‘_¿nk
(
__wÜld
)),

62 
	`comm_size
(
CommuniÿtiÚ
::
	`g‘_size
(
__wÜld
)),

63 
	`s_hi
(
comm
.
s_hi
),

64 
	`s_lo
(
comm
.
s_lo
),

65 
	`–em’ts
(
	`EËm’ts
()),

66 
	`hP
(
NAN
),

67 
	`kB
(
NAN
),

68 
	`vŞ
(0.0),

69 
H
{
	`DESIG2
(
__dim__
,__dim__,0.0)
	}
},

70 
	gB
{
DESIG2
(
__dim__
,__dim__,0.0)},

71 
	gd•th_šv
{
DESIG
(
__dim__
,0.0)},

72 
	$¡•
(0)

74 
Algeb¿
::
z”o
<
__nvoigt__
>(
__h
);

75 
Algeb¿
::
z”o
<
__nvoigt__
>(
__b
);

76 
x
=
Ãw
 
Vec
<
ty³0
>(
this
,
__dim__
,"x");

77 
id
ğ
Ãw
 
Vec
<>(
this
,1,"id");

78 
x_dof
=
Ãw
 
Vec
<
boŞ
>(
this
,
__dim__
,"x_dof");

79 
x_dof
->
	`em±y
(
Œue
);

80 
	}
}

84 
	gAtoms
::~
	$Atoms
()

86 
d–‘e
 
x_dof
;

87 
d–‘e
 
id
;

88 
d–‘e
 
x
;

89 
d–‘e
 [] 
dyÇmic_vecs
;

90 
nvecs
è
d–‘e
 
vecs
[0];

91 
	}
}

95 
	gAtoms
::
	$upd©e_H
()

97 
Algeb¿
::
	`MLT_šv
(
H
,
B
);

98 
vŞ
=
Algeb¿
::
	`MLT_d‘
(
H
);

99 
Algeb¿
::
	`MLT_d•th
(
B
,
d•th_šv
);

100 
Algeb¿
::
	`MLT_2_V
(
H
,
__h
);

101 
Algeb¿
::
	`MLT_2_V
(
B
,
__b
);

102 
	}
}

106 
	gAtoms
::
	$push
(
vec
* 
v
)

108 if(
v
->
Çme
)

109 
ivec
=0;ivec<
nvecs
;ivec++)

110 if(
vecs
[
ivec
]->
Çme
 && !
	`¡rcmp
(
v
->name,vecs[ivec]->name))

111 
throw
 "internalƒrror: vector‚ame‡lreadyƒxist";

113 
vec
** 
__vecs
=
Ãw
 vec*[
nvecs
+1];

114 
	`memıy
(
__vecs
,
vecs
,
nvecs
*(
vec
*));

115 
d–‘e
 [] 
vecs
;

116 
vecs
=
__vecs
;

117 
vecs
[
nvecs
++]=
v
;

119 if(
ndyÇmic_vecs
)

121 
vec
** 
__dyamic_vecs
=
Ãw
 vec*[
ndyÇmic_vecs
+1];

122 
	`memıy
(
__dyamic_vecs
,
dyÇmic_vecs
,
ndyÇmic_vecs
*(
vec
*));

123 
d–‘e
 [] 
dyÇmic_vecs
;

124 
dyÇmic_vecs
=
__dyamic_vecs
;

125 
dyÇmic_vecs
[
ndyÇmic_vecs
++]=
v
;

127 
	}
}

131 
	gAtoms
::
	$pİ
(
vec
* 
v
)

133 
ivec
=
nvecs
-1;

134 ;
vecs
[
ivec
]!=
v
;ivec--){}

135 
vecs
[
ivec
]=vecs[
nvecs
-1];

136 
nvecs
--;

138 
vec
** 
__vecs
=
NULL
;

139 if(
nvecs
è
__vecs
=
Ãw
 
vec
*[nvecs];

140 
	`memıy
(
__vecs
,
vecs
,(
nvecs
)*(
vec
*));

142 if(
ndyÇmic_vecs
)

144 
ivec
=
ndyÇmic_vecs
-1;

145 ;
dyÇmic_vecs
[
ivec
]!=
v
;ivec--){}

146 
dyÇmic_vecs
[
ivec
]=dyÇmic_vecs[
ndyÇmic_vecs
-1];

147 
ndyÇmic_vecs
--;

148 
vec
** 
__dyamic_vecs
=
NULL
;

149 if(
ndyÇmic_vecs
)

150 
__dyamic_vecs
=
Ãw
 
vec
*[
ndyÇmic_vecs
];

155 
	`memıy
(
__dyamic_vecs
,
dyÇmic_vecs
,
ndyÇmic_vecs
*(
vec
*));

156 
d–‘e
 [] 
dyÇmic_vecs
;

157 
dyÇmic_vecs
=
__dyamic_vecs
;

159 
	}
}

163 
	gAtoms
::
	$is_dyÇmic
(
vec
* 
v
)

165 
i
=
ndyÇmic_vecs
-1;i>-1;i--)

166 if(
v
==
dyÇmic_vecs
[
i
])  i;

168 
	}
}

172 
vec
* 
	gAtoms
::
	$fšd_vec
(cÚ¡ * 
Çme
)

174 
ivec
=0;ivec<
nvecs
;ivec++)

175 if(
vecs
[
ivec
]->
Çme
 && 
	`¡rcmp
(name,vecs[ivec]->name)==0)

176  
vecs
[
ivec
];

177  
NULL
;

178 
	}
}

182 
	gAtoms
::
	$x2s
(
no
)

184 
Algeb¿
::
X2S
<
__dim__
>(
__b
,
no
,
x
->
	`begš
());

185 
	}
}

189 
	gAtoms
::
	$s2x
(
no
)

191 
Algeb¿
::
S2X
<
__dim__
>(
__h
,
no
,
x
->
	`begš
());

192 
	}
}

196 
	gAtoms
::
	$x2s_lş
()

198 
Algeb¿
::
X2S
<
__dim__
>(
__b
,
Çtms_lş
,
x
->
	`begš
());

199 
	}
}

203 
	gAtoms
::
	$s2x_lş
()

205 
Algeb¿
::
S2X
<
__dim__
>(
__h
,
Çtms_lş
,
x
->
	`begš
());

206 
	}
}

210 
	gAtoms
::
	$x2s_®l
()

212 
Algeb¿
::
X2S
<
__dim__
>(
__b
,
Çtms_lş
+
Çtms_ph
,
x
->
	`begš
());

213 
	}
}

217 
	gAtoms
::
	$s2x_®l
()

219 
Algeb¿
::
S2X
<
__dim__
>(
__h
,
Çtms_lş
+
Çtms_ph
,
x
->
	`begš
());

220 
	}
}

224 
	gAtoms
::
	$x2s_dump
()

226 
Algeb¿
::
X2S
<
__dim__
>(
__b
,
Çtms
,
x
->
	`begš_dump
());

227 
	}
}

231 
	gAtoms
::
	$š£¹
(
by‹
* 
buff
,
vec
** 
vecs_
,
nvecs_
,
Çtms_
)

233 
¡ride
=0;

234 
ivec
=0;ivec<
nvecs_
;ivec++è
¡ride
+=
vecs_
[ivec]->
by‹_sz
;

237 
ivec
=0;ivec<
nvecs_
;ivec++)

238 
vecs_
[
ivec
]->
	`p¡
(
buff
,
¡ride
,
Çtms_
);

240 
Çtms_lş
+=
Çtms_
;

241 
	}
}

253 
	gAtoms
::
	$add
()

255 
i
=0;i<
nvecs
;i++)

256 
vecs
[
i
]->
	`add
();

257 
Çtms_lş
++;

258 
	}
}

270 
	gAtoms
::
	$d–
(& 
d–_idx
)

272 
i
=0;i<
nvecs
;i++)

273 
vecs
[
i
]->
	`d–
(
d–_idx
);

274 
Çtms_lş
--;

275 
	}
}

279 
	gAtoms
::
	$»¡¬t
()

281 
Çtms
=0;

282 
Çtms_lş
=0;

283 
Çtms_ph
=0;

284 
nvecs
)

285 
d–‘e
 
vecs
[0];

286 
	}
}

290 
	~"exchªge.h
"

291 
	gAtoms
::
	$»£t_domaš
()

293 
ndyÇmic_vecs
=0;

294 
i
=0;i<
nvecs
;i++)

295 if(!
vecs
[
i
]->
	`is_em±y
())

296 
ndyÇmic_vecs
++;

297 if(
ndyÇmic_vecs
==0) ;

299 
dyÇmic_vecs
=
Ãw
 
vec
*[
ndyÇmic_vecs
];

300 
ndyÇmic_vecs
=0;

301 
i
=0;i<
nvecs
;i++)

302 if(!
vecs
[
i
]->
	`is_em±y
())

303 
dyÇmic_vecs
[
ndyÇmic_vecs
++]=
vecs
[
i
];

305 
Exchªge
 
	`xchng
(
this
,
ndyÇmic_vecs
);

307 
	`x2s_lş
();

308 
xchng
.
	`fuÎ_xchng
();

309 
	`s2x_lş
();

312 
d–‘e
 [] 
dyÇmic_vecs
;

313 
dyÇmic_vecs
=
NULL
;

314 
ndyÇmic_vecs
=0;

316 
	}
}

320 
	~"ff_¡yËs.h
"

321 
PyObjeù
* 
	gAtoms
::
	$__Ãw__
(
PyTy³Objeù
* 
ty³
,
PyObjeù
* 
¬gs
,PyObjeù* 
kwds
)

323 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
ty³
->
	`_®loc
(type,0));

324 
PyObjeù
* 
£lf
=
»š‹½»t_ÿ¡
<PyObjeù*>(
__£lf
);

325  
£lf
;

326 
	}
}

330 
	gAtoms
::
	$__š™__
(
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)

332 
FuncAPI
<> 
	`func
("__init__");

333 if(
	`func
(
¬gs
,
kwds
)==-1)  -1;

334 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

335 
__£lf
->
©oms
=
NULL
;

336 
__£lf
->
ff
=
NULL
;

338 
	}
}

342 
PyObjeù
* 
	gAtoms
::
	$__®loc__
(
PyTy³Objeù
* 
ty³
,
Py_ssize_t
)

344 
Objeù
* 
__£lf
=
Ãw
 Object;

345 
	`Py_TYPE
(
__£lf
)=
ty³
;

346 
	`Py_REFCNT
(
__£lf
)=1;

347 
__£lf
->
©oms
=
NULL
;

348 
__£lf
->
ff
=
NULL
;

349  
»š‹½»t_ÿ¡
<
PyObjeù
*>(
__£lf
);

350 
	}
}

354 
	gAtoms
::
	$__d—Îoc__
(
PyObjeù
* 
£lf
)

356 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

357 
d–‘e
 
__£lf
->
ff
;

358 
d–‘e
 
__£lf
->
©oms
;

359 
d–‘e
 
__£lf
;

360 
	}
}

362 
PyTy³Objeù
 
	gAtoms
::
Ty³Objeù
 ={
PyObjeù_HEAD_INIT
(
NULL
)};

364 
	gAtoms
::
	$£tup_
()

366 
Ty³Objeù
.
_Çme
="atoms";

367 
Ty³Objeù
.
_doc
="container class";

369 
Ty³Objeù
.
_æags
=
Py_TPFLAGS_DEFAULT
;

370 
Ty³Objeù
.
_basicsize
=(
Objeù
);

372 
Ty³Objeù
.
_Ãw
=
__Ãw__
;

373 
Ty³Objeù
.
_š™
=
__š™__
;

374 
Ty³Objeù
.
_®loc
=
__®loc__
;

375 
Ty³Objeù
.
_d—Îoc
=
__d—Îoc__
;

376 
	`£tup__m‘hods
();

377 
Ty³Objeù
.
_m‘hods
=
m‘hods
;

378 
	`£tup__g‘£t
();

379 
Ty³Objeù
.
_g‘£t
=
g‘£t
;

381 
ichk
=
	`PyTy³_R—dy
(&
Ty³Objeù
);

382 if(
ichk
<0)  ichk;

383 
	`Py_INCREF
(&
Ty³Objeù
);

385  
ichk
;

386 
	}
}

388 
PyG‘S‘Def
 
	gAtoms
::
g‘£t
[]=
Em±yPyG‘S‘Def
(13);

390 
	gAtoms
::
	$£tup__g‘£t
()

392 
	`g‘£t_¡•
(
g‘£t
[0]);

393 
	`g‘£t_hP
(
g‘£t
[1]);

394 
	`g‘£t_kB
(
g‘£t
[2]);

395 
	`g‘£t_H
(
g‘£t
[3]);

396 
	`g‘£t_B
(
g‘£t
[4]);

397 
	`g‘£t_vŞ
(
g‘£t
[5]);

398 
	`g‘£t_–ems
(
g‘£t
[6]);

399 
	`g‘£t_skš
(
g‘£t
[7]);

400 
	`g‘£t_comm_¿nk
(
g‘£t
[8]);

401 
	`g‘£t_comm_size
(
g‘£t
[9]);

402 
	`g‘£t_comm_coÜds
(
g‘£t
[10]);

403 
	`g‘£t_comm_dims
(
g‘£t
[11]);

404 
	}
}

406 
PyM‘hodDef
 
	gAtoms
::
m‘hods
[]=
Em±yPyM‘hodDef
(2);

408 
	gAtoms
::
	$£tup__m‘hods
()

410 
	`ml_¡¿š
(
m‘hods
[0]);

411 
	}
}

415 
	gAtoms
::
	$g‘£t_¡•
(
PyG‘S‘Def
& 
g‘£t
)

417 
g‘£t
.
Çme
=(*)"step";

418 
g‘£t
.
doc
=(*)
R
"---(

419 (è
¡•
 
numb”


421 
Cu¼’t
 
¡•
 
numb”


423 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

425  
v¬
<>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
©oms
->
¡•
);

427 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

429 
V¬API
<> 
	`¡•
("step");

430 
¡•
.
logics
[0]=
	`VLogics
("ge",0);

431 if(
¡•
.
	`£t
(
v®
)==-1)  -1;

432 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
©oms
->
¡•
=¡•.
v®
;

435 
	}
}

439 
	gAtoms
::
	$g‘£t_hP
(
PyG‘S‘Def
& 
g‘£t
)

441 
g‘£t
.
Çme
=(*)"hP";

442 
g‘£t
.
doc
=(*)
R
"---(

443 (è
PÏnck
 
cÚ¡ªt


445 
PÏnck
 
cÚ¡ªt


447 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

449  
v¬
<
ty³0
>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
©oms
->
hP
);

451 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

453 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

454 if(!
__£lf
->
©oms
)

456 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"cannot set 'hP'…rioro†oading system configuration");

460 
V¬API
<
ty³0
> 
	`hP
("hP");

461 
hP
.
logics
[0]=
	`VLogics
("gt",0.0);

462 if(
hP
.
	`£t
(
v®
)==-1)  -1;

463 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
©oms
->
hP
=hP.
v®
;

466 
	}
}

470 
	gAtoms
::
	$g‘£t_kB
(
PyG‘S‘Def
& 
g‘£t
)

472 
g‘£t
.
Çme
=(*)"kB";

473 
g‘£t
.
doc
=(*)
R
"---(

474 (è
BŞtzmªn
 
cÚ¡ªt


476 
BŞtzmªn
 
cÚ¡ªt


478 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

480  
v¬
<
ty³0
>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
©oms
->
kB
);

482 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

484 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

485 if(!
__£lf
->
©oms
)

487 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"cannot set 'kB'…rioro†oading system configuration");

491 
V¬API
<
ty³0
> 
	`kB
("kB");

492 
kB
.
logics
[0]=
	`VLogics
("gt",0.0);

493 if(
kB
.
	`£t
(
v®
)==-1)  -1;

494 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
©oms
->
kB
=kB.
v®
;

497 
	}
}

501 
	gAtoms
::
	$g‘£t_skš
(
PyG‘S‘Def
& 
g‘£t
)

503 
g‘£t
.
Çme
=(*)"skin";

504 
g‘£t
.
doc
=(*)
R
"---(

505 (è
size
 
of
 
skš


507 
ThickÃss
 
of
 
ÃighbÜ
 
li¡
 
skš


509 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

511  
v¬
<
ty³0
>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
©oms
->
comm
.
skš
);

513 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

515 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

516 if(!
__£lf
->
©oms
)

518 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"cannot set 'skin'…rioro†oading system configuration");

522 
V¬API
<
ty³0
> 
	`skš
("skin");

523 
skš
.
logics
[0]=
	`VLogics
("gt",0.0);

524 if(
skš
.
	`£t
(
v®
)==-1)  -1;

525 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
©oms
->
comm
.
skš
=skš.
v®
;

528 
	}
}

532 
	gAtoms
::
	$g‘£t_H
(
PyG‘S‘Def
& 
g‘£t
)

534 
g‘£t
.
Çme
=(*)"H";

535 
g‘£t
.
doc
=(*)
R
"---(

536 (
symm
<[
dim
][dim]>è
un™ûÎ
 
m©rix


538 
M©rix
 
of
 
un™ûÎ
 
veùÜs
, 
h”e
 
dim
 
is
 
the
 
dim’siÚ
 oà
simuÏtiÚ


540 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

542 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

543 if(!
__£lf
->
©oms
)

545 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"cannot„eturn 'H'…rioro†oading system configuration");

546  
NULL
;

549  
v¬
<
ty³0
[
__dim__
][__dim__]>::
	`bud
(
__£lf
->
©oms
->
H
);

551 
g‘£t
.
£t
=[](
PyObjeù
*,PyObject*,*)->

553 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,"readonly‡ttribute");

556 
	}
}

560 
	gAtoms
::
	$g‘£t_B
(
PyG‘S‘Def
& 
g‘£t
)

562 
g‘£t
.
Çme
=(*)"B";

563 
g‘£t
.
doc
=(*)
R
"---(

564 (
symm
<[
dim
][dim]>è
un™ûÎ
 
m©rix
 
	`šv”£
 (:
m©h
:`\
m©hbf
{
H
}^{-1}`)

566 
Inv”£
 
of
 
m©rix
 oà
un™ûÎ
 
veùÜs
, 
h”e
 
dim
 
is
 
the
 
dim’siÚ
 oà
simuÏtiÚ


568 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

570 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

571 if(!
__£lf
->
©oms
)

573 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"cannot„eturn 'B'…rioro†oading system configuration");

574  
NULL
;

577  
v¬
<
ty³0
[
__dim__
][__dim__]>::
	`bud
(
__£lf
->
©oms
->
B
);

579 
g‘£t
.
£t
=[](
PyObjeù
*,PyObject*,*)->

581 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,"readonly‡ttribute");

584 
	}
}

588 
	gAtoms
::
	$g‘£t_vŞ
(
PyG‘S‘Def
& 
g‘£t
)

590 
g‘£t
.
Çme
=(*)"vol";

591 
g‘£t
.
doc
=(*)
R
"---(

592 (è
un™ûÎ
 
vŞume


594 
VŞume
 
of
 
un™ûÎ


596 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

598 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

599 if(!
__£lf
->
©oms
)

601 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"cannot„eturn 'vol'…rioro†oading system configuration");

602  
NULL
;

605  
v¬
<
ty³0
>::
	`bud
(
__£lf
->
©oms
->
vŞ
);

607 
g‘£t
.
£t
=[](
PyObjeù
*,PyObject*,*)->

609 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,"readonly‡ttribute");

612 
	}
}

616 
	gAtoms
::
	$g‘£t_–ems
(
PyG‘S‘Def
& 
g‘£t
)

618 
g‘£t
.
Çme
=(*)"elems";

619 
g‘£t
.
doc
=(*)
R
"---(

620 (
diù
{:
¡ršg
}è
–em’ts
 
diùiÚ¬y


622 
DiùiÚ¬y
 
of
 
–em’ts
 
´e£Á
 
š
 
the
 
sy¡em


624 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

626 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

627 if(!
__£lf
->
©oms
)

629 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"cannot„eturn 'elems'…rioro system configuration");

630  
NULL
;

632  
__£lf
->
©oms
->
–em’ts
.
	`g‘_diù
();

634 
g‘£t
.
£t
=[](
PyObjeù
*,PyObject*,*)->

636 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,"readonly‡ttribute");

639 
	}
}

643 
	gAtoms
::
	$g‘£t_comm_¿nk
(
PyG‘S‘Def
& 
g‘£t
)

645 
g‘£t
.
Çme
=(*)"comm_rank";

646 
g‘£t
.
doc
=(*)
R
"---(

647 (è
communiÿtiÚ
 
¿nk


649 
Rªk
 
of
 
the
 
ÿÎšg
 
´oûss
 
š
h
communiÿtÜ


651 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

653 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

654 if(!
__£lf
->
©oms
)

656 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"cannot„eturn 'comm_rank'…rioro system configuration");

657  
NULL
;

659 
¿nk
=
__£lf
->
©oms
->
comm
.rank;

660  
v¬
<>::
	`bud
(
¿nk
);

662 
g‘£t
.
£t
=[](
PyObjeù
*,PyObject*,*)->

664 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,"readonly‡ttribute");

667 
	}
}

671 
	gAtoms
::
	$g‘£t_comm_size
(
PyG‘S‘Def
& 
g‘£t
)

673 
g‘£t
.
Çme
=(*)"comm_size";

674 
g‘£t
.
doc
=(*)
R
"---(

675 (è
communiÿtiÚ
 
size


677 
Size
 
of
 
the
 
group
 
assocŸ‹d
 
w™h
h
communiÿtÜ


679 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

681 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

682 if(!
__£lf
->
©oms
)

684 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"cannot„eturn 'comm_size'…rioro system configuration");

685  
NULL
;

687 
size
=
__£lf
->
©oms
->
comm
.size;

688  
v¬
<>::
	`bud
(
size
);

690 
g‘£t
.
£t
=[](
PyObjeù
*,PyObject*,*)->

692 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,"readonly‡ttribute");

695 
	}
}

699 
	gAtoms
::
	$g‘£t_comm_coÜds
(
PyG‘S‘Def
& 
g‘£t
)

701 
g‘£t
.
Çme
=(*)"comm_coords";

702 
g‘£t
.
doc
=(*)
R
"---(

703 ([
dim
]è
communiÿtiÚ
 
coÜdš©es


705 
CommuniÿtiÚ
 
coÜdš©es
 
of
 
the
 
ÿÎšg
 
´oûss
, 
h”e
 
dim
 
is
h
dim’siÚ
 oà
simuÏtiÚ


707 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

709 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

710 if(!
__£lf
->
©oms
)

712 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"cannot„eturn 'comm_coords'…rioro system configuration");

713  
NULL
;

715  
v¬
<[
__dim__
]>::
	`bud
(
__£lf
->
©oms
->
comm
.
coÜds
);

717 
g‘£t
.
£t
=[](
PyObjeù
*,PyObject*,*)->

719 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,"readonly‡ttribute");

722 
	}
}

726 
	gAtoms
::
	$g‘£t_comm_dims
(
PyG‘S‘Def
& 
g‘£t
)

728 
g‘£t
.
Çme
=(*)"comm_dims";

729 
g‘£t
.
doc
=(*)
R
"---(

730 ([
dim
]è
communiÿtiÚ
 
dim’siÚs


732 
Numb”
 
of
 
´oûs£s
 
—ch
 
ÿ¹esŸn
 
dim’siÚ
, 
h”e
 
dim
 
is
 
the
 dim’siÚ oà
simuÏtiÚ


734 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

736 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

737 if(!
__£lf
->
©oms
)

739 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"cannot„eturn 'comm_dims'…rioro system configuration");

740  
NULL
;

742  
v¬
<[
__dim__
]>::
	`bud
(
__£lf
->
©oms
->
comm
.
dims
);

744 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

746 
V¬API
<[
__dim__
]> 
	`dims
("dims");

747 
dims
.
logics
[0]=
	`VLogics
("ge",0);

748 
i£t
=
dims
.
	`£t
(
v®
);

749 if(
i£t
==-1)  -1;

750 
size
=1;

751 
und‘_dims
=0;

752 
i
=0;i<
__dim__
;i++)

754 if(
dims
.
v®
[
i
]è
size
*=dims.val[i];

755 
und‘_dims
++;

757 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

758 if(
__£lf
->
©oms
->
comm
.
size
%size!=0)

760 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"'comm_size' is‚ot divisble byhe…roduct of‚onzero components of 'comm_dims'");

764 if(
und‘_dims
==0 && 
__£lf
->
©oms
->
comm
.
size
!=size)

766 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"'comm_size' is‚otƒqualohe…roduct of‚onzero components of 'comm_dims'");

770 
__£lf
->
©oms
->
comm
.
	`grid
(
dims
.
v®
);

771 
__£lf
->
©oms
->
	`»£t_domaš
();

774 
	}
}

778 
	gAtoms
::
	$ml_¡¿š
(
PyM‘hodDef
& 
_m‘hods
)

780 
_m‘hods
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

781 
_m‘hods
.
ml_Çme
="strain";

782 
_m‘hods
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

783 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

785 
FuncAPI
<
ty³0
[
__dim__
][__dim__]> 
	`f
("strain",{"eps"});

786 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

788 
Atoms
::
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Atoms::Objeù*>(
£lf
);

790 
ty³0
 
H
[
__dim__
][__dim__]{
	`DESIG2
(__dim__,__dim__,0.0)};

791 
ty³0
 
B
[
__dim__
][__dim__]{
	`DESIG2
(__dim__,__dim__,0.0)};

792 
Algeb¿
::
DoLT
<
__dim__
>::
	`func
([&
H
,&
B
,&
__£lf
](
i
,
j
)

794 
H
[
i
][
j
]=
__£lf
->
©oms
->H[i][j];

795 
B
[
i
][
j
]=
__£lf
->
©oms
->B[i][j];

798 
	`ty³0
 (&
¡¿š
)[
__dim__
][__dim__]=
f
.
v®
<0>();

800 
Algeb¿
::
Do
<
__dim__
>::
	`func
([&
¡¿š
](
i
){strain[i][i]++;});

801 
ty³0
 
F
[
__dim__
][__dim__]{
	`DESIG2
(__dim__,__dim__,0.0)};

802 
ty³0
 
__H
[
__dim__
][__dim__]{
	`DESIG2
(__dim__,__dim__,0.0)};

803 
Algeb¿
::
	`MLT_mul_MSQ
(
H
,
¡¿š
,
__H
);

805 
Algeb¿
::
	`MSQ_2_MLT
(
__H
,
H
);

806 
Algeb¿
::
	`MLT_mul_MLT
(
B
,
H
,
F
);

807 if(
Algeb¿
::
	`MLT_d‘
(
F
)<=0.0)

809 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,"strain should„esult inransformationensor with…ositive determinant");

810  
NULL
;

813 
Algeb¿
::
	`MLT_šv
(
H
,
B
);

815 
__£lf
->
©oms
->
	`x2s_lş
();

816 
Algeb¿
::
V_eq
<
__dim__
*__dim__>(&
H
[0][0],&(
__£lf
->
©oms
->H[0][0]));

817 
__£lf
->
©oms
->
	`upd©e_H
();

818 
__£lf
->
©oms
->
	`s2x_lş
();

826 
Py_RETURN_NONE
;

829 
_m‘hods
.
ml_doc
=
R
"---(

830 
	`¡¿š
(
•s
)

832 
SŒaš
 
the
 
	`sy¡em
 (
NEED
 
MORE
 
EXPLANATION
 
TBCMPLTD
)

835 
P¬am‘”s


837 
•s
 : [
dim
][dim]

838 
SŒaš
 
‹nsÜ
, 
h”e
 
dim
 
is
 
the
 
dim’siÚ
 
of
 
simuÏtiÚ


840 
R‘uºs


842 
NÚe


845 
	}
}

849 
	gAtoms
::
	$ml_mul
(
PyM‘hodDef
& 
_m‘hods
)

851 
_m‘hods
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

852 
_m‘hods
.
ml_Çme
="mul";

853 
_m‘hods
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

854 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

856 
FuncAPI
<[
__dim__
]> 
	`f
("mul",{"N"});

858 
f
.
g‘
<0>().
logics
[0]=
	`VLogics
("ge",1);

859 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

860 
Atoms
* 
©oms
=
»š‹½»t_ÿ¡
<Atoms::
Objeù
*>(
£lf
)->atoms;

861 
N
[
__dim__
];

862 
Algeb¿
::
V_eq
<
__dim__
>(
f
.
v®
<0>(),
N
);

863 
n
=1;

864 
Algeb¿
::
Do
<
__dim__
>::
	`func
([&
n
,&
N
](
i
){n*=N[i];});

866 * 
__id
=
©oms
->
id
->
	`begš
();

867 
Çtms_lş
=
©oms
->natms_lcl;

868 
max_id_lş
=0;

869 
max_id
;

870 
i
=0;i<
Çtms_lş
;i++è
max_id_lş
=
	`MAX
(max_id_lş,
__id
[i]);

871 
	`MPI_AÎ»duû
(&
max_id_lş
,&
max_id
,1,
Vec
<>::
MPI_T
,
MPI_MAX
,
©oms
->
wÜld
);

875 
nvecs
=
©oms
->nvecs;

876 
vec
** 
vecs
=
©oms
->vecs;

877 
i
=0;i<
nvecs
;i++)

878 
vecs
[
i
]->
	`»¶iÿ‹
(
n
);

881 
ty³0
 
dx
[
__dim__
];

882 
ty³0
 
I
[
__dim__
];

883 
P
[
__dim__
]{
	`DESIG
(__dim__,1)};

884 
Algeb¿
::
DoLT
<
__dim__
-1>::
	`func
([&
P
,&
N
](
i
,
j
)

886 
P
[
__dim__
-2-
i
]*=
N
[__dim__-1-
j
];

890 
no
;

891 
did
;

892 
ty³0
* 
__x
=
©oms
->
x
->
	`begš
()+
Çtms_lş
*
__dim__
;

893 
__id
=
©oms
->
id
->
	`begš
()+
Çtms_lş
;

894 
	`ty³0
 (&
H
)[
__dim__
][__dim__]=
©oms
->H;

895 
i
=1;i<
n
;i++)

897 
no
=
i
;

898 
Algeb¿
::
z”o
<
__dim__
>(
I
);

899 
Algeb¿
::
z”o
<
__dim__
>(
dx
);

900 
Algeb¿
::
Do
<
__dim__
>::
	`func
([&
I
,&
P
,&
no
](
i
)

902 
I
[
i
]=
¡©ic_ÿ¡
<
ty³0
>(
no
/
P
[i]);

903 
no
òo%
P
[
i
];

905 
did
=
¡©ic_ÿ¡
<>(
i
)*(
max_id
+1);

906 
Algeb¿
::
	`V_mul_MLT
(
I
,
H
,
dx
);

907 
j
=0;j<
Çtms_lş
;j++)

909 
Algeb¿
::
V_add
<
__dim__
>(
dx
,
__x
);

910 *
__id
+=
did
;

911 
__x
+=
__dim__
;

912 ++
__id
;

918 
Algeb¿
::
DoLT
<
__dim__
>::
	`func
([&
©oms
,&
N
](
i
,
j
)

920 
©oms
->
H
[
i
][
j
]*=
¡©ic_ÿ¡
<
ty³0
>(
N
[i]);

922 
©oms
->
	`upd©e_H
();

923 
©oms
->
Çtms_lş
*=
n
;

924 
©oms
->
Çtms
*=
n
;

925 
©oms
->
	`»£t_domaš
();

928 
Py_RETURN_NONE
;

931 
_m‘hods
.
ml_doc
=
R
"---(

932 
	`mul
(
N
)

934 
R•liÿ‹s
 
the
 
box
 
š
 
—ch
 
dim’siÚ
 
accÜdšg
 
to
h
giv’
 
v®ues
 
by
h
veùÜ


936 
P¬am‘”s


938 
N
 : [
dim
]

939 
Numb”
 
of
 
»¶iÿtiÚs
 
š
 
®l
 
dim’siÚs
, 
h”e
 
dim
 
is
 
the
 
dim’siÚ
 oà
simuÏtiÚ


941 
R‘uºs


943 
NÚe


946 
	}
}

950 
	gAtoms
::
	$ml_do
(
PyM‘hodDef
& 
_m‘hod
)

952 
_m‘hod
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

953 
_m‘hod
.
ml_Çme
="do";

954 
_m‘hod
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

955 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

958 
FuncAPI
<
OB
<
PyFunùiÚObjeù
,
PyFunùiÚ_Ty³
>> 
	`f
("do",{"func"});

959 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

961 
PyObjeù
* 
İ
=
f
.
v®
<0>();

963 
Atoms
::
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Atoms::Objeù*>(
£lf
);

964 
Œy


966 
__£lf
->
©oms
->
	`DO
(
İ
);

968 
	`ÿtch
(
¡d
::
¡ršg
& 
”r_msg
)

970 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,
”r_msg
.
	`c_¡r
());

971  
NULL
;

974 
Py_RETURN_NONE
;

976 
_m‘hod
.
ml_doc
=
R
"---(

977 do(
func
)

979 
aùs
 
a
 
giv’
 
funùiÚ
 
Ú
 
ev”y
 
©om


981 
P¬am‘”s


983 
func
 : 
ÿÎabË
 
pythÚ
 
objeù


984 
funùiÚ


986 
R‘uºs


988 
NÚe


991 
	}
}

	@atoms.h

1 #iâdeà
__MAPP__©oms__


2 
	#__MAPP__©oms__


	)

3 
	~"­i.h
"

4 
	~<ty³šfo
>

5 
	~<cm©h
>

6 
	~"comm.h
"

7 
	~"–em’ts.h
"

8 
	~"maüos.h
"

9 
	~"glob®.h
"

11 ’um {
	m¢d_to_bhnd
,
	m¢d_to_äÁ
};

12 ’um {
	mrcv_fm_äÁ
,
	mrcv_fm_bhnd
};

21 
Çme¥aû
 
	gMAPP_NS


23 şas 
	cvec


25 
	g´iv©e
:

26 
´Ùeùed
:

27 
public
:

29 
boŞ
 
__is_em±y__
;

30 
	gdim
;

31 
	gby‹_sz
;

32 
	gvec_sz
;

33 
	gvec_ıùy
;

34 
şass
 
Atoms
* 
	g©oms
;

35 cÚ¡ * 
	gÇme
;

36 
by‹
* 
	gd©a
;

37 
by‹
* 
	gd©a_dump
;

38 
cÚ¡ex´
 
	gvec_grw
=128;

40 * 
begš
()cÚ¡{ 
	gd©a
;};

41 * 
’d
()cÚ¡{ 
	gd©a
+
vec_sz
*
	gby‹_sz
;};

43 
vec
(
şass
 
Atoms
*,,
size_t
,const *);

44 
	gvœtu®
 ~
vec
();

46 
chªge_dim
();

48 
»£rve
();

49 
»size
();

50 
shršk_to_f™
();

51 
»¶iÿ‹
();

52 
»¬¿nge
(*,*,,);

53 
p¡_to
(
by‹
*&,);

55 
add
();

56 
d–
(&);

58 
pİ_out
(
by‹
*&,);

59 
pİ_š
(
by‹
*&);

61 
ıy
(
by‹
*&,);

62 
p¡
(
by‹
*&,,);

63 
ıy_p¡
();

65 
ıy
(
by‹
*&,*,);

66 
p¡
(
by‹
*&,);

67 
ıy_p¡
(*,);

68 
boŞ
 
is_em±y
()cÚ¡{ 
	g__is_em±y__
;};

71 * 
begš_dump
()cÚ¡{ 
	gd©a_dump
;}

72 
vœtu®
 
ndim_dump
()cÚ¡{ 
	gdim
;};

73 
vœtu®
 
š™_dump
();

74 
vœtu®
 
fš_dump
();

75 
vœtu®
 
´št
(
FILE
*,)=0;

78 
	~<c¡ršg
>

79 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

83 
šlše
 
	gvec
::
	$chªge_dim
(
Ãw_dim
)

85 if(
Ãw_dim
==
dim
) ;

87 
Ãw_by‹_sz
=(
by‹_sz
/
dim
)*
Ãw_dim
;

88 
mš_by‹_sz
=
	`MIN
(
Ãw_by‹_sz
,
by‹_sz
);

89 
by‹
* 
__d©a
=
Ãw
 by‹[
Ãw_by‹_sz
*
vec_ıùy
];

90 
i
=0;i<
vec_sz
;i++)

91 
	`memıy
(
__d©a
+
i
*
Ãw_by‹_sz
,
d©a
+i*
by‹_sz
,
mš_by‹_sz
);

93 
d–‘e
 [] 
d©a
;

94 
d©a
=
__d©a
;

95 
by‹_sz
=
Ãw_by‹_sz
;

96 
dim
=
Ãw_dim
;

97 
	}
}

101 
šlše
 
	gvec
::
	$»£rve
(
xŒa_©ms
)

103 if(
vec_ıùy
>=
vec_sz
+
xŒa_©ms
)

106 
vec_ıùy
=
vec_sz
+
xŒa_©ms
+
vec_grw
;

107 
by‹
* 
__d©a
=
Ãw
 by‹[
vec_ıùy
*
by‹_sz
];

109 
	`memıy
(
__d©a
,
d©a
,
by‹_sz
*
vec_sz
);

111 
d–‘e
 [] 
d©a
;

112 
d©a
=
__d©a
;

114 
	}
}

118 
šlše
 
	gvec
::
	$»size
(
n
)

120 if(
vec_ıùy
>=
n
)

122 
vec_sz
=
n
;

127 
vec_ıùy
=
n
+
vec_grw
;

128 
by‹
* 
__d©a
=
NULL
;

129 if(
n
è
__d©a
=
Ãw
 
by‹
[
vec_ıùy
*
by‹_sz
];

130 
	`memıy
(
__d©a
,
d©a
,
by‹_sz
*
vec_sz
);

131 
d–‘e
 [] 
d©a
;

132 
d©a
=
__d©a
;

133 
vec_sz
=
n
;

134 
	}
}

138 
šlše
 
	gvec
::
	$shršk_to_f™
()

140 if(
vec_ıùy
==
vec_sz
)

143 
by‹
* 
__d©a
=
NULL
;

144 if(
vec_sz
è
__d©a
=
Ãw
 
by‹
[vec_sz*
by‹_sz
];

145 
	`memıy
(
__d©a
,
d©a
,
vec_sz
*
by‹_sz
);

147 
d–‘e
 [] 
d©a
;

148 
d©a
=
__d©a
;

149 
vec_ıùy
=
vec_sz
;

150 
	}
}

154 
šlše
 
	gvec
::
	$»¶iÿ‹
(
n
)

156 if(
__is_em±y__
) ;

158 
Şd_vec_sz
=
vec_sz
;

159 
	`»size
(
n
*
vec_sz
);

160 
by‹
* 
__d©a
=
d©a
+
Şd_vec_sz
*
by‹_sz
;

161 
i
=1;i<
n
;i++,
__d©a
+=
Şd_vec_sz
*
by‹_sz
)

162 
	`memıy
(
__d©a
,
d©a
,
Şd_vec_sz
*
by‹_sz
);

164 
	}
}

168 
šlše
 
	gvec
::
	$»¬¿nge
(* 
Şd_pos


169 ,* 
Ãw_pos
,
sz
,
Ãw_vec_ıùy
)

171 
by‹
* 
__d©a
=
NULL
;

172 if(
Ãw_vec_ıùy
è
__d©a
=
Ãw
 
by‹
[Ãw_vec_ıùy*
by‹_sz
];

174 
i
=0;i<
sz
;i++)

175 
	`memıy
(
__d©a
+
Ãw_pos
[
i
]*
by‹_sz
,
d©a
+
Şd_pos
[i]*byte_sz,byte_sz);

177 
d–‘e
 [] 
d©a
;

178 
d©a
=
__d©a
;

179 
vec_sz
=0;

180 
vec_ıùy
=
Ãw_vec_ıùy
;

181 
	}
}

185 
šlše
 
	gvec
::
	$p¡_to
(
by‹
*& 
buff
,
Ÿtm
)

187 
	`memıy
(
d©a
+
Ÿtm
*
by‹_sz
,
buff
,byte_sz);

188 
buff
+=
by‹_sz
;

189 
	}
}

209 
šlše
 
	gvec
::
	$add
()

211 if(
__is_em±y__
) ;

212 
	`»size
(
vec_sz
+1);

213 
	}
}

225 
šlše
 
	gvec
::
	$d–
(&
d–_idx
)

227 if(
__is_em±y__
) ;

228 
vec_sz
--;

229 if(
d–_idx
==
vec_sz
) ;

230 
	`memıy
(
d©a
+
d–_idx
*
by‹_sz
,d©a+
vec_sz
*byte_sz,byte_sz);

231 
	}
}

249 
šlše
 
	gvec
::
	$pİ_out
(
by‹
*& 
buff
,
Ÿtm
)

251 
	`memıy
(
buff
,
d©a
+
Ÿtm
*
by‹_sz
,byte_sz);

252 
	`memıy
(
d©a
+
Ÿtm
*
by‹_sz
,d©a+(
vec_sz
-1)*byte_sz,byte_sz);

253 
buff
+=
by‹_sz
;

254 
vec_sz
--;

255 
	}
}

264 
šlše
 
	gvec
::
	$pİ_š
(
by‹
*& 
buff
)

266 
	`memıy
(
d©a
+
vec_sz
*
by‹_sz
,
buff
,byte_sz);

267 
buff
+=
by‹_sz
;

268 
vec_sz
++;

269 
	}
}

287 
šlše
 
	gvec
::
	$ıy
(
by‹
*& 
buff
,
Ÿtm
)

289 
	`memıy
(
buff
,
d©a
+
Ÿtm
*
by‹_sz
,byte_sz);

290 
buff
+=
by‹_sz
;

291 
	}
}

301 
šlše
 
	gvec
::
	$p¡
(
by‹
*& 
buff
,
¡ride
,
xŒa_Çtms
)

303 
	`»£rve
(
xŒa_Çtms
);

304 
by‹
* 
__d©a
=
d©a
+
vec_sz
*
by‹_sz
;

305 
i
=0;i<
xŒa_Çtms
;i++)

307 
	`memıy
(
__d©a
,
buff
,
by‹_sz
);

308 
buff
+=
¡ride
;

309 
__d©a
+=
by‹_sz
;

311 
buff
+=
by‹_sz
-
¡ride
*
xŒa_Çtms
;

312 
vec_sz
+=
xŒa_Çtms
;

313 
	}
}

321 
šlše
 
	gvec
::
	$ıy_p¡
(
Ÿtm
)

323 
	`»£rve
(1);

324 
	`memıy
(
d©a
+
vec_sz
*
by‹_sz
,d©a+
Ÿtm
*byte_sz,byte_sz);

325 
vec_sz
++;

326 
	}
}

343 
šlše
 
	gvec
::
	$ıy
(
by‹
*& 
buff
,* 
l¡
,
no
)

345 
i
=0;i<
no
;i++)

347 
	`memıy
(
buff
,
d©a
+
l¡
[
i
]*
by‹_sz
,byte_sz);

348 
buff
+=
by‹_sz
;

350 
	}
}

359 
šlše
 
	gvec
::
	$p¡
(
by‹
*& 
buff
,
xŒa_Çtms
)

361 
	`memıy
(
d©a
+
vec_sz
*
by‹_sz
,
buff
,by‹_sz*
xŒa_Çtms
);

362 
buff
+=
by‹_sz
*
xŒa_Çtms
;

363 
vec_sz
+=
xŒa_Çtms
;

364 
	}
}

372 
šlše
 
	gvec
::
	$ıy_p¡
(* 
l¡
,
no
)

374 
by‹
* 
vec_buff
=
d©a
+
vec_sz
*
by‹_sz
;

375 
i
=0;i<
no
;i++)

377 
	`memıy
(
vec_buff
,
d©a
+
l¡
[
i
]*
by‹_sz
,byte_sz);

378 
vec_buff
+=
by‹_sz
;

380 
vec_sz
+=
no
;

381 
	}
}

390 
Çme¥aû
 
	gMAPP_NS


393 
	g‹m¶©e
<
ty³Çme
 
	gT
>

394 şas 
	cVec
: 
public
 
vec


396 
´iv©e
:

397 
´Ùeùed
:

398 
public
:

399 
T
 
em±y_v®
;

400 
Vec
(
Atoms
*,,const *);

401 
Vec
(
Atoms
*,);

402 ~
Vec
();

403 
size
()cÚ¡{ 
dim
*
	gvec_sz
;}

404 
MPI_D©©y³
 
	gMPI_T
;

405 cÚ¡ * 
	g´št_fÜm©
;

406 
T
* 
begš
()cÚ¡{ 
	g»š‹½»t_ÿ¡
<
	gT
*>(
	gd©a
);};

407 
T
* 
’d
()cÚ¡{ 
	g»š‹½»t_ÿ¡
<
	gT
*>(
	gd©a
+
vec_sz
*
	gby‹_sz
);};

408 
T
* 
begš_dump
()cÚ¡{ 
	g»š‹½»t_ÿ¡
<
	gT
*>(
	gd©a_dump
);};

409 
em±y
(cÚ¡ 
T
);

410 
fl
();

411 
vœtu®
 
´št
(
FILE
*,);

415 
	g‹m¶©e
<> 
MPI_D©©y³
 
	gVec
<
	gboŞ
>::
MPI_T
;

416 
	g‹m¶©e
<> 
MPI_D©©y³
 
	gVec
<>::
MPI_T
;

417 
	g‹m¶©e
<> 
MPI_D©©y³
 
	gVec
<>::
MPI_T
;

418 
	g‹m¶©e
<> 
MPI_D©©y³
 
	gVec
<>::
MPI_T
;

419 
	g‹m¶©e
<> 
MPI_D©©y³
 
	gVec
<>::
MPI_T
;

420 
	g‹m¶©e
<> 
MPI_D©©y³
 
	gVec
<>::
MPI_T
;

421 
	g‹m¶©e
<> 
MPI_D©©y³
 
	gVec
<>::
MPI_T
;

422 
	g‹m¶©e
<> 
MPI_D©©y³
 
	gVec
<>::
MPI_T
;

423 
	g‹m¶©e
<> 
MPI_D©©y³
 
	gVec
<>::
MPI_T
;

424 
	g‹m¶©e
<> 
MPI_D©©y³
 
	gVec
<>::
MPI_T
;

425 
	g‹m¶©e
<> 
MPI_D©©y³
 
	gVec
<>::
MPI_T
;

426 
	g‹m¶©e
<> 
MPI_D©©y³
 
	gVec
<>::
MPI_T
;

427 
	g‹m¶©e
<> 
MPI_D©©y³
 
	gVec
<>::
MPI_T
;

428 
	g‹m¶©e
<> 
MPI_D©©y³
 
	gVec
<>::
MPI_T
;

430 
	g‹m¶©e
<> cÚ¡ * 
	gVec
<
	gboŞ
>::
´št_fÜm©
;

431 
	g‹m¶©e
<> cÚ¡ * 
	gVec
<>::
´št_fÜm©
;

432 
	g‹m¶©e
<> cÚ¡ * 
	gVec
<>::
´št_fÜm©
;

433 
	g‹m¶©e
<> cÚ¡ * 
	gVec
<>::
´št_fÜm©
;

434 
	g‹m¶©e
<> cÚ¡ * 
	gVec
<>::
´št_fÜm©
;

435 
	g‹m¶©e
<> cÚ¡ * 
	gVec
<>::
´št_fÜm©
;

436 
	g‹m¶©e
<> cÚ¡ * 
	gVec
<>::
´št_fÜm©
;

437 
	g‹m¶©e
<> cÚ¡ * 
	gVec
<>::
´št_fÜm©
;

438 
	g‹m¶©e
<> cÚ¡ * 
	gVec
<>::
´št_fÜm©
;

439 
	g‹m¶©e
<> cÚ¡ * 
	gVec
<>::
´št_fÜm©
;

440 
	g‹m¶©e
<> cÚ¡ * 
	gVec
<>::
´št_fÜm©
;

441 
	g‹m¶©e
<> cÚ¡ * 
	gVec
<>::
´št_fÜm©
;

442 
	g‹m¶©e
<> cÚ¡ * 
	gVec
<>::
´št_fÜm©
;

443 
	g‹m¶©e
<> cÚ¡ * 
	gVec
<>::
´št_fÜm©
;

453 
Çme¥aû
 
	gMAPP_NS


455 şas 
	cAtoms


457 
	g´iv©e
:

458 
´Ùeùed
:

459 
public
:

461 
EËm’ts
 
–em’ts
;

462 
CommuniÿtiÚ
 
	gcomm
;

463 
	gMPI_Comm
& 
	gwÜld
;

464 
ty³0
 (&
s_lo
)[
__dim__
];

465 
ty³0
 (&
s_hi
)[
__dim__
];

468 cÚ¡ 
	gcomm_size
;

469 cÚ¡ 
	gcomm_¿nk
;

470 
	gÇtms_lş
;

471 
	gÇtms_ph
;

472 
	gÇtms
;

473 
	g¡•
;

477 
ty³0
 
	gmax_cut
;

481 
ty³0
 
	gkB
;

483 
ty³0
 
	ghP
;

484 
ty³0
 
	gvŞ
;

485 
ty³0
 
	gd•th_šv
[
__dim__
];

486 
ty³0
 
	gH
[
__dim__
][__dim__];

487 
ty³0
 
	gB
[
__dim__
][__dim__];

488 
ty³0
 
	g__h
[
__nvoigt__
];

489 
ty³0
 
	g__b
[
__nvoigt__
];

492 
upd©e_H
();

493 
	gVec
<
	gty³0
>* 
	gx
;

494 
	gVec
<>* 
	gid
;

495 
	gVec
<
	gboŞ
>* 
	gx_dof
;

496 
vec
** 
	gvecs
;

497 
	gnvecs
;

498 
vec
** 
	gdyÇmic_vecs
;

499 
	gndyÇmic_vecs
;

501 
Atoms
(
MPI_Comm
&);

502 
	gvœtu®
 ~
Atoms
();

503 
vec
* 
fšd_vec
(const *);

504 
push
(
vec
*);

505 
pİ
(
vec
*);

506 
x2s
();

507 
s2x
();

508 
x2s_lş
();

509 
s2x_lş
();

510 
x2s_®l
();

511 
s2x_®l
();

512 
x2s_dump
();

514 
š£¹
(
by‹
*,
vec
**,,);

515 
add
();

516 
d–
(&);

517 
»¡¬t
();

518 
is_dyÇmic
(
vec
*);

520 
»£t_domaš
();

522 
vœtu®
 
DO
(
PyObjeù
*){}

527 
PyObjeù_HEAD


528 
şass
 
Atoms
* 
	g©oms
;

529 
şass
 
FÜûF›ld
* 
	gff
;

530 }
	tObjeù
;

532 
PyTy³Objeù
 
	gTy³Objeù
;

533 
PyObjeù
* 
__Ãw__
(
PyTy³Objeù
*,PyObject*, PyObject*);

534 
__š™__
(
PyObjeù
*, PyObject*,PyObject*);

535 
PyObjeù
* 
__®loc__
(
PyTy³Objeù
*,
Py_ssize_t
);

536 
__d—Îoc__
(
PyObjeù
*);

539 
PyM‘hodDef
 
	gm‘hods
[];

540 
£tup__m‘hods
();

541 
ml_¡¿š
(
PyM‘hodDef
&);

542 
ml_mul
(
PyM‘hodDef
&);

543 
ml_do
(
PyM‘hodDef
&);

546 
PyG‘S‘Def
 
	gg‘£t
[];

547 
£tup__g‘£t
();

548 
g‘£t_¡•
(
PyG‘S‘Def
&);

549 
g‘£t_hP
(
PyG‘S‘Def
&);

550 
g‘£t_kB
(
PyG‘S‘Def
&);

551 
g‘£t_H
(
PyG‘S‘Def
&);

552 
g‘£t_B
(
PyG‘S‘Def
&);

553 
g‘£t_vŞ
(
PyG‘S‘Def
&);

554 
g‘£t_–ems
(
PyG‘S‘Def
&);

555 
g‘£t_skš
(
PyG‘S‘Def
&);

556 
g‘£t_comm_¿nk
(
PyG‘S‘Def
&);

557 
g‘£t_comm_size
(
PyG‘S‘Def
&);

558 
g‘£t_comm_coÜds
(
PyG‘S‘Def
&);

559 
g‘£t_comm_dims
(
PyG‘S‘Def
&);

562 
£tup_
();

579 
šlše
 
	gvec
::
	$vec
(
Atoms
* 
__©oms
,
__dim
,
size_t
 
__t_size
,cÚ¡ * 
__Çme
):

580 
	`dim
(
__dim
),

581 
	`by‹_sz
(
¡©ic_ÿ¡
<>(
__t_size
)*
__dim
),

582 
	`d©a
(
NULL
),

583 
	`vec_sz
(0),

584 
	`vec_ıùy
(0),

586 
	`Çme
(
__Çme
),

587 
	`©oms
(
__©oms
),

588 
	`__is_em±y__
(
çl£
),

589 
	$d©a_dump
(
NULL
)

591 
©oms
->
	`push
(
this
);

592 
	`»£rve
(
©oms
->
Çtms_lş
+©oms->
Çtms_ph
);

593 
	`»size
(
©oms
->
Çtms_lş
);

594 
	}
}

598 
šlše
 
	gvec
::~
	$vec
()

600 
d–‘e
 [] 
d©a
;

601 
©oms
->
	`pİ
(
this
);

602 
	}
}

606 
šlše
 
	gvec
::
	$š™_dump
()

609 if(
©oms
->
comm_¿nk
)

610 
d©a_dump
=
d©a
;

613 
Çtms
=
©oms
->natms;

614 if(
Çtms
)

615 
d©a_dump
=
Ãw
 
by‹
[
Çtms
*
by‹_sz
];

616 
	`memıy
(
d©a_dump
,
d©a
,
by‹_sz
*
©oms
->
Çtms_lş
);

618 
	}
}

622 
šlše
 
	gvec
::
	$fš_dump
()

624 if(
©oms
->
comm_¿nk
==0)

625 
d–‘e
 [] 
d©a_dump
;

626 
d©a_dump
=
NULL
;

627 
	}
}

631 
	g‹m¶©e
<
ty³Çme
 
	gT
>

632 
	gVec
<
	gT
>::
	$Vec
(
Atoms
* 
__©oms
,
__dim
,cÚ¡ * 
__Çme
):

633 
	`vec
(
__©oms
,
__dim
,(
T
),
__Çme
)

634 {
	}
}

638 
	g‹m¶©e
<
ty³Çme
 
	gT
>

639 
	gVec
<
	gT
>::
	$Vec
(
Atoms
* 
__©oms
,
__dim
):

640 
	`vec
(
__©oms
,
__dim
,(
T
),
NULL
)

641 {
	}
}

645 
	g‹m¶©e
<
ty³Çme
 
	gT
>

646 
šlše
 
	gVec
<
	gT
>::~
	$Vec
()

647 {
	}
}

651 
‹m¶©e
<
ty³Çme
 
T
>

652 
šlše
 
Vec
<
T
>::
	$em±y
(cÚ¡ 
T
 
__em±y_v®
)

654 
em±y_v®
=
__em±y_v®
;

655 if(
__is_em±y__
) ;

656 
d–‘e
 [] 
d©a
;

657 
d©a
=
NULL
;

658 
vec_sz
=
vec_ıùy
=0;

659 
__is_em±y__
=
Œue
;

660 
	}
}

664 
	g‹m¶©e
<
ty³Çme
 
	gT
>

665 
šlše
 
	gVec
<
	gT
>::
	$fl
()

667 if(
__is_em±y__
)

669 
	`»£rve
(
©oms
->
Çtms_lş
+©oms->
Çtms_ph
);

670 
	`»size
(
©oms
->
Çtms_lş
);

675 
T
* 
__d©a
=
	`begš
();

676 
i
=0;i<
dim
*
vec_sz
;i++è
__d©a
[i]=
em±y_v®
;

677 
__is_em±y__
=
çl£
;

678 
	}
}

682 
	g‹m¶©e
<
ty³Çme
 
	gT
>

683 
šlše
 
	gVec
<
	gT
>::
	$´št
(
FILE
* 
å
,
i
)

685 
T
* 
__d©a_dump
=
	`begš_dump
()+
dim
*
i
;

686 
j
=0;j<
dim
;j++)

687 
	`årštf
(
å
,
´št_fÜm©
,
__d©a_dump
[
j
]);

688 
	}
}

707 
Çme¥aû
 
	gMAPP_NS


709 
	g‹m¶©e
<
ty³Çme
 
	gT
,
şass
 
	gF
>

710 şas 
	cVecPy


712 
	g´iv©e
:

713 
´Ùeùed
:

714 
public
:

715 
size_t
 
os
;

716 
boŞ
 
	gšc
;

717 
PyObjeù
* 
	gİ
;

718 
	gdim
;

719 
	g¡d
::
»move_poš‹r
<
Åy_š
>::
ty³
 
Åy_dim
;

721 
T
* 
	gd©a
;

722 
T
* 
	g¬r_d©a
;

723 
T
* 
	gh—d
;

725 
	gF
& 
	gfunc
;

726 
	gVec
<
	gT
>* 
	gvec
;

728 
VecPy
(
Vec
<
T
>*,
F
&);

729 
	gvœtu®
 ~
VecPy
();

731 
š™
();

732 
fš
();

733 
vœtu®
 
£tup_¬r_d©a
();

734 
vœtu®
 
´e_™”
();

735 
vœtu®
 
po¡_™”
();

745 
	g‹m¶©e
<
ty³Çme
 
	gT
,
şass
 
	gF
>

746 
	gVecPy
<
	gT
,
	gF
>::
VecPy
(
Vec
<
T
>* 
__vec
,
F
& 
__func
):

747 
d©a
(
NULL
),

748 
¬r_d©a
(
NULL
),

749 
vec
(
__vec
),

750 
dim
(
__vec
->dim),

751 
func
(
__func
),

752 
İ
(
NULL
),

753 
šc
(
çl£
),

754 
	$os
(0)

756 
	}
}

760 
	g‹m¶©e
<
ty³Çme
 
	gT
,
şass
 
	gF
>

761 
	gVecPy
<
	gT
,
	gF
>::
	$£tup_¬r_d©a
()

763 
¬r_d©a
=
Ãw
 
T
[
dim
];

764 
Åy_dim
=
¡©ic_ÿ¡
<
¡d
::
»move_poš‹r
<
Åy_š
>::
ty³
>(
dim
);

765 
	}
}

769 
	g‹m¶©e
<
ty³Çme
 
	gT
,
şass
 
	gF
>

770 
	gVecPy
<
	gT
,
	gF
>::
	$š™
()

772 
Çtms_lş
=
vec
->
©oms
->natms_lcl;

773 if(
Çtms_lş
è
d©a
=
Ãw
 
T
[Çtms_lş*
dim
];

774 if(
vec
->
	`is_em±y
())

776 
T
 
em±y_v®
=
vec
->empty_val;

777 
i
=0;i<
Çtms_lş
*
dim
;i++)

779 
d©a
[
i
]=
em±y_v®
;

784 
	`memıy
(
d©a
,
vec
->
	`begš
(),
Çtms_lş
*
dim
*(
T
));

787 
	`£tup_¬r_d©a
();

798 
İ
=
	`PyA¼ay_Sim¶eNewFromD©a
(1,&
Åy_dim
,
ıp_ty³2ty³_num
<
T
>::
	`ty³_num
(),
¬r_d©a
);

802 
h—d
=
d©a
;

803 
	}
}

807 
	g‹m¶©e
<
ty³Çme
 
	gT
,
şass
 
	gF
>

808 
	gVecPy
<
	gT
,
	gF
>::
	$´e_™”
()

810 
	`memıy
(
¬r_d©a
,
h—d
,(
T
)*
dim
);

811 
	}
}

815 
	g‹m¶©e
<
ty³Çme
 
	gT
,
şass
 
	gF
>

816 
	gVecPy
<
	gT
,
	gF
>::
	$po¡_™”
()

821 
Œy


823 
	`func
(
h—d
,
¬r_d©a
);

825 
	`ÿtch
(
¡d
::
¡ršg
& 
”r_msg
)

827 
throw
 
”r_msg
;

830 
	`memıy
(
h—d
,
¬r_d©a
,(
T
)*
dim
);

831 
h—d
+=
dim
;

832 
	}
}

836 
	g‹m¶©e
<
ty³Çme
 
	gT
,
şass
 
	gF
>

837 
	gVecPy
<
	gT
,
	gF
>::
	$fš
()

839 
h—d
=
NULL
;

840 if(
İ
)

842 
	`Py_DECREF
(
İ
);

843 
İ
=
NULL
;

848 
d–‘e
 [] 
¬r_d©a
;

849 
¬r_d©a
=
NULL
;

850 if(
vec
->
	`is_em±y
())

852 
Çtms_lş
=
vec
->
©oms
->natms_lcl;

853 
T
 
em±y_v®
=
vec
->empty_val;

854 
i
=0;

855 
i
<
Çtms_lş
*
dim
 && 
d©a
[i]==
em±y_v®
)

856 
i
++;

858 
is_em±y_lş
=0,
is_em±y
;

859 if(
i
!=
Çtms_lş
*
dim
è
is_em±y_lş
=1;

860 
	`MPI_AÎ»duû
(&
is_em±y_lş
,&
is_em±y
,1,
MPI_INT
,
MPI_MAX
,
vec
->
©oms
->
wÜld
);

862 if(
is_em±y
)

864 
vec
->
	`fl
();

865 
	`memıy
(
vec
->
	`begš
(),
d©a
,
Çtms_lş
*
dim
*(
T
));

871 
Çtms_lş
=
vec
->
©oms
->natms_lcl;

872 
	`memıy
(
vec
->
	`begš
(),
d©a
,
Çtms_lş
*
dim
*(
T
));

875 
d–‘e
 [] 
d©a
;

876 
d©a
=
NULL
;

877 
	}
}

881 
	g‹m¶©e
<
ty³Çme
 
	gT
,
şass
 
	gF
>

882 
	gVecPy
<
	gT
,
	gF
>::~
	$VecPy
()

884 if(
İ
)

886 
	`Py_DECREF
(
İ
);

887 
İ
=
NULL
;

890 
d–‘e
 [] 
¬r_d©a
;

891 
d–‘e
 [] 
d©a
;

892 
	}
}

897 
Çme¥aû
 
	gMAPP_NS


899 şas 
	cVecPyFunc


901 
	g´iv©e
:

902 
´Ùeùed
:

903 
public
:

904 
‹m¶©e
 <
ty³Çme
 
T
,
şass
 
	gF
, 
	gşass
... 
	gSs
>

905 
fšd
(cÚ¡ 
size_t
 
i
,cÚ¡ * 
Çme
,
VecPy
<
T
,
F
>& 
__v
,
Ss
&... 
ss
)

908 if(
¡rcmp
(
Çme
,
__v
.
vec
->name)==0)

910 
__v
.
šc
=
Œue
;

911 
	g__v
.
	gos
=
i
;

914  
fšd
(
i
,
Çme
,
ss
...);

921 
	g‹m¶©e
 <
ty³Çme
 
	gT
,
şass
 
	gF
, 
	gşass
... 
	gSs
>

922 
š™
(
PyObjeù
* 
tu¶e
,
VecPy
<
T
,
F
>& 
__v
,
Ss
&... 
ss
)

924 if(
	g__v
.
	gšc
)

926 
	g__v
.
š™
();

927 
PyTu¶e_SET_ITEM
(
tu¶e
,
__v
.
os
,__v.
İ
);

928 
Py_INCREF
(
__v
.
İ
);

931 
š™
(
tu¶e
,
ss
...);

935 
	g‹m¶©e
 <
ty³Çme
 
	gT
,
şass
 
	gF
, 
	gşass
... 
	gSs
>

936 
fš
(
VecPy
<
T
,
F
>& 
__v
,
Ss
&... 
ss
)

938 if(
	g__v
.
	gšc
)

939 
	g__v
.
fš
();

940 
fš
(
ss
...);

946 
	g‹m¶©e
 <
ty³Çme
 
	gT
,
şass
 
	gF
, 
	gşass
... 
	gSs
>

947 
´e_™”
(
VecPy
<
T
,
F
>& 
__v
,
Ss
&... 
ss
)

949 if(
	g__v
.
	gšc
)

950 
	g__v
.
´e_™”
();

952 
´e_™”
(
ss
...);

956 
	g‹m¶©e
 <
ty³Çme
 
	gT
,
şass
 
	gF
, 
	gşass
... 
	gSs
>

957 
po¡_™”
(
VecPy
<
T
,
F
>& 
__v
,
Ss
&... 
ss
)

959 
	gŒy


961 if(
	g__v
.
	gšc
è__v.
po¡_™”
();

963 
ÿtch
(
¡d
::
¡ršg
& 
”r_msg
)

965 
throw
 
”r_msg
;

967 
po¡_™”
(
ss
...);

973 
fšd
(cÚ¡ 
size_t
,cÚ¡ * 
Çme
)

974 {
throw
 
	g¡d
::
¡ršg
("nØvrŸbË‚amed ")+
Çme
+
¡d
::string("ƒxists inhe system");}

975 
š™
(
PyObjeù
*){}

976 
fš
(){}

977 
´e_™”
(){}

978 
po¡_™”
(){}

983 
	g‹m¶©e
 <
	gşass
... 
	gSs
>

984 
Do
(
Atoms
* ,
PyObjeù
*,
Ss
&... 
ss
);

993 
	g‹m¶©e
 <
	gşass
... 
	gSs
>

994 
	gVecPyFunc
::
	$Do
(
Atoms
* 
©oms
,
PyObjeù
* 
İ
,
Ss
&... 
ss
)

996 
PyCodeObjeù
* 
co
=(PyCodeObjeù *)
	`PyFunùiÚ_GET_CODE
(
İ
);

997 
PyObjeù
* 
co_v¬Çmes
=
co
->co_varnames;

998 
size_t
 
co_nv¬s
=
¡©ic_ÿ¡
<size_t>(
co
->
co_¬gcouÁ
);

1002 
Œy
{

1003 
size_t
 
i
=0;i<
co_nv¬s
;i++)

1005 cÚ¡ * 
v¬_Çme
=
	`__PySŒšg_AsSŒšg
(
	`PyTu¶e_G‘I‹m
(
co_v¬Çmes
,
i
));

1006 
	`fšd
(
i
,
v¬_Çme
,
ss
...);

1009 
	`ÿtch
(
¡d
::
¡ršg
& 
”r_msg
)

1011 
throw
 
”r_msg
;

1015 
PyObjeù
* 
tu¶e
=
	`PyTu¶e_New
(
co_nv¬s
);

1016 
	`š™
(
tu¶e
,
ss
...);

1018 
Çtms_lş
=
©oms
->natms_lcl;

1019 
”r_lş
=0;

1020 
¡d
::
¡ršg
 
”r_msg
;

1021 
PyObjeù
* 
ªs
=
NULL
;

1023 
i
=0;i<
Çtms_lş
 && 
”r_lş
==0;i++)

1025 
	`´e_™”
(
ss
...);

1028 
ªs
=
	`PyEv®_C®lObjeù
(
İ
,
tu¶e
);

1029 if(
	`PyE¼_Occu¼ed
()!=
NULL
)

1031 
”r_lş
=1;

1032 
”r_msg
=
¡d
::
	`¡ršg
("Anƒrror occured inhe…rovided function");

1033 if(
ªs
è
	`Py_DECREF
(ans);

1034 
	`PyE¼_CË¬
();

1038 if(
Py_NÚe
!=
ªs
)

1040 
	`Py_DECREF
(
ªs
);

1041 
”r_lş
=1;

1042 
”r_msg
=
¡d
::
	`¡ršg
("provided function should‚ot„eturn‡ny value");

1046 
	`Py_DECREF
(
ªs
);

1053 
Œy


1055 
	`po¡_™”
(
ss
...);

1057 
	`ÿtch
(
¡d
::
¡ršg
& 
__”r_msg
)

1059 
”r_lş
=1;

1060 
”r_msg
=
__”r_msg
;

1064 
”r
;

1065 
	`MPI_AÎ»duû
(&
”r_lş
,&
”r
,1,
MPI_INT
,
MPI_MAX
,
©oms
->
wÜld
);

1066 if(
”r
)

1068 
fœ¡_´oc
;

1069 
comm_¿nk
=0;

1070 if(
”r_lş
)

1071 
comm_¿nk
=
©oms
->comm_rank;

1073 
comm_¿nk
=
©oms
->
comm_size
;

1075 
	`MPI_AÎ»duû
(&
comm_¿nk
,&
fœ¡_´oc
,1,
MPI_INT
,
MPI_MIN
,
©oms
->
wÜld
);

1076 
”r_msg_Ëngth
=0;

1077 if(
©oms
->
comm_¿nk
==
fœ¡_´oc
)

1078 
”r_msg_Ëngth
=
¡©ic_ÿ¡
<>(
”r_msg
.
	`size
())+1;

1079 
	`MPI_Bÿ¡
(&
”r_msg_Ëngth
,1,
MPI_INT
,
fœ¡_´oc
,
©oms
->
wÜld
);

1080 * 
__”r_msg
=
NULL
;

1081 
__”r_msg
=
Ãw
 [
”r_msg_Ëngth
];

1082 if(
©oms
->
comm_¿nk
==
fœ¡_´oc
)

1083 
	`memıy
(
__”r_msg
,
”r_msg
.
	`c_¡r
(),
”r_msg_Ëngth
);

1084 
	`MPI_Bÿ¡
(
__”r_msg
,
”r_msg_Ëngth
,
MPI_CHAR
,
fœ¡_´oc
,
©oms
->
wÜld
);

1085 
”r_msg
=
¡d
::
	`¡ršg
(
__”r_msg
);

1086 
d–‘e
 [] 
__”r_msg
;

1087 
throw
 
”r_msg
;

1093 
	`Py_DECREF
(
tu¶e
);

1094 
	`fš
(
ss
...);

1096 
	}
}

	@atoms_dmd.cpp

1 
	~"©oms_dmd.h
"

2 
	~"xm©h.h
"

6 
	gAtomsDMD
::
	$AtomsDMD
(
MPI_Comm
& 
wÜld
,
__c_dim
,
__N
):

7 
	`c_dim
(
__c_dim
),

8 
	`N
(
__N
),

9 
	`Atoms
(
wÜld
),

10 
	`xi
(
Ãw
 
ty³0
[
__N
]),

11 
	`wi
(
Ãw
 
ty³0
[
__N
]),

12 
	`‹mp
(
NAN
),

13 
S_ã
{
	`DESIG2
(
__dim__
,__dim__,
NAN
)
	}
},

14 
ã
(
NAN
),

15 
	$s
(
NAN
)

17 
XM©h
::
	`quad¿tu»_hg
(
N
,
xi
,
wi
);

18 
–em
=
Ãw
 
Vec
<
–em_ty³
>(
this
,
c_dim
,"elem");

19 
®pha
=
Ãw
 
DMDVec
<
ty³0
>(
this
,0.0,"alpha");

20 
c
=
Ãw
 
DMDVec
<
ty³0
>(
this
,-1.0,"c");

21 
®pha_dof
=
Ãw
 
DMDVec
<
boŞ
>(
this
,
Œue
,"alpha_dof");

22 
c_dof
=
Ãw
 
DMDVec
<
boŞ
>(
this
,
Œue
,"c_dof");

24 
®pha_dof
->
	`em±y
(
Œue
);

25 
c_dof
->
	`em±y
(
Œue
);

26 
	}
}

30 
	gAtomsDMD
::~
	$AtomsDMD
()

32 
d–‘e
 
®pha_dof
;

33 
d–‘e
 
c_dof
;

34 
d–‘e
 
c
;

35 
d–‘e
 
®pha
;

36 
d–‘e
 
–em
;

38 
d–‘e
 [] 
wi
;

39 
d–‘e
 [] 
xi
;

40 
	}
}

44 
	gAtomsDMD
::
	$upd©e_max_®pha
()

46 
n
=
Çtms_lş
*
c_dim
;

47 
ty³0
 
max_®pha_lş
=0.0;

48 
ty³0
* 
®pha_vec
=
®pha
->
	`begš
();

49 
i
=0;i<
n
;i++)

50 
max_®pha_lş
=
	`MAX
(max_®pha_lş,
®pha_vec
[
i
]);

51 
	`MPI_AÎ»duû
(&
max_®pha_lş
,&
max_®pha
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_MAX
,
wÜld
);

52 
	}
}

56 
	~"–em’ts.h
"

57 
	gAtomsDMD
& AtomsDMD::
İ”©Ü
=(cÚ¡ 
Atoms
& 
r
)

59 
–em’ts
=
r
.elements;

60 
	gcomm
=
r
.
comm
;

61 
	gÇtms_lş
=
r
.
Çtms_lş
;

62 
	gÇtms_ph
=
r
.
Çtms_ph
;

63 
	gÇtms
=
r
.
Çtms
;

64 
	g¡•
=
r
.
¡•
;

66 
	gmax_cut
=
r
.
max_cut
;

67 
	gkB
=
r
.
kB
;

68 
	ghP
=
r
.
hP
;

70 
	gvŞ
=
r
.
vŞ
;

71 
memıy
(
d•th_šv
,
r
.d•th_šv,
__dim__
*(
ty³0
));

72 
memıy
(
__h
,
r
.__h,
__nvoigt__
*(
ty³0
));

73 
memıy
(
__b
,
r
.__b,
__nvoigt__
*(
ty³0
));

74 
memıy
(&
H
[0][0],&
r
.H[0][0],
__dim__
*__dim__*(
ty³0
));

75 
memıy
(&
B
[0][0],&
r
.B[0][0],
__dim__
*__dim__*(
ty³0
));

77 
	gi
=0;i<
	gnvecs
;i++)

78 if(!
	gvecs
[
i
]->
is_em±y
())

79 
	gvecs
[
i
]->
»size
(
Çtms_lş
);

82 
memıy
(
x
->
begš
(),
r
.x->begš(),
Çtms_lş
*
__dim__
*(
ty³0
));

83 
memıy
(
id
->
begš
(),
r
.id->begš(),
Çtms_lş
*());

84 * 
	gthis
;

89 
ty³0
 
	gAtomsDMD
::
	$vac_msd
()

91 
ty³0
* 
__c
=
c
->
	`begš
();

92 
ty³0
* 
__x
=
x
->
	`begš
();

93 
ty³0
 
cv_v®s_lş
[
__dim__
+2];

94 
Algeb¿
::
z”o
<
__dim__
+2>(
cv_v®s_lş
);

95 
ty³0
 
__xi
[
__dim__
];

96 
ty³0
 
cv
;

97 
i
=0;i<
Çtms_lş
;i++,
__c
+=
c_dim
,
__x
+=
__dim__
)

99 
cv
=1.0;

100 
j
=0;j<
c_dim
;j++)

101 if(
__c
[
j
]>0.0)

102 
cv
-=
__c
[
j
];

104 
Algeb¿
::
V_eq
<
__dim__
>(
__x
,
__xi
);

105 
Algeb¿
::
X2S
<
__dim__
>(
B
[0],
__xi
);

106 
Algeb¿
::
S2X
<
__dim__
>(
H
[0],
__xi
);

107 
cv_v®s_lş
[
__dim__
]+=
cv
*
Algeb¿
::
V_mul_V
<__dim__>(
__xi
,__xi);

108 
Algeb¿
::
V_add_x_mul_V
<
__dim__
>(
cv
,
__xi
,
cv_v®s_lş
);

109 
cv_v®s_lş
[
__dim__
+1]+=
cv
;

112 
ty³0
 
cv_v®s
[
__dim__
+2];

113 
Algeb¿
::
z”o
<
__dim__
+2>(
cv_v®s
);

115 
	`MPI_AÎ»duû
(
cv_v®s_lş
,
cv_v®s
,
__dim__
+2,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

118 
Algeb¿
::
Do
<
__dim__
+1>::
	`func
([&
cv_v®s
](
i
)

120 
cv_v®s
[
i
]/=cv_v®s[
__dim__
+1];

123  
cv_v®s
[
__dim__
]-
Algeb¿
::
V_mul_V
<__dim__>(cv_vals,cv_vals);

124 
	}
}

128 
	gAtomsDMD
::
	$DO
(
PyObjeù
* 
İ
)

130 şas 
	cFunc_id


132 
public
:

133 
	`İ”©Ü
()(* 
Şd_v®
,* 
Ãw_v®
)

135 if(*
Şd_v®
!=*
Ãw_v®
)

136 
throw
 
¡d
::
	`¡ršg
("id of‡toms cannot be changed");

138 
	}
};

139 
Func_id
 
	gfunc_id
;

140 
	gVecPy
<,
	gFunc_id
> 
id_vec_py
(
id
,
func_id
);

142 şas 
	cFunc_x


144 
	gpublic
:

145 
İ”©Ü
()(
ty³0
*,
	gty³0
*)

148 
Func_x
 
	gfunc_x
;

149 
	gVecPy
<
	gty³0
,
	gFunc_x
> 
x_vec_py
(
x
,
func_x
);

151 şas 
	cFunc_dof


153 
	gpublic
:

154 
İ”©Ü
()(
boŞ
*,
	gboŞ
*)

158 
Func_dof
 
	gfunc_dof
;

159 
	gVecPy
<
	gboŞ
,
	gFunc_dof
> 
dof_vec_py
(
x_dof
,
func_dof
);

162 şas 
	cFunc_®pha


164 
	gpublic
:

165 
c_dim
;

166 
Func_®pha
(
__c_dim
):
c_dim
(__c_dim){}

167 
İ”©Ü
()(
ty³0
* 
Şd_v®
,ty³0* 
	gÃw_v®
)

169 
	gi
=0;i<
	gc_dim
;i++)

170 if(
	gÃw_v®
[
i
]<=0.0 && 
Ãw_v®
[i]!=
Şd_v®
[i])

171 
throw
 
¡d
::
¡ršg
("all values of‡lpha correspondingo…resentƒlements (i.e. c!=-1.0) should be greaterhan 0.0");

174 
Func_®pha
 
func_®pha
(
c_dim
);

175 
	gDMDVecPy
<
	gty³0
,
	gFunc_®pha
> 
®pha_vec_py
(
®pha
,
func_®pha
);

179 şas 
	cFunc_c


181 
	gpublic
:

182 
c_dim
;

183 
Func_c
(
__c_dim
):
c_dim
(__c_dim){}

184 
İ”©Ü
()(
ty³0
* 
Şd_v®
,ty³0* 
	gÃw_v®
)

187 vŞ©
ty³0
 
	gc0
;

188 
	gi
=0;i<
	gc_dim
;i++)

190 
	gc0
=
Ãw_v®
[
i
];

191 --++
	gc0
;

192 
	gÃw_v®
[
i
]=
c0
;

194 
ty³0
 
	gsum_c
=0.0;

195 
	gi
=0;i<
	gc_dim
;i++)

197 if(
	gÃw_v®
[
i
]!=-1.0 && (
Ãw_v®
[i]<0.0 ||‚ew_val[i]>1.0))

198 
throw
 
¡d
::
¡ršg
("all values of c should be greater orƒqualo 0.0‡nd†esshan orƒqualo 1.0, orƒqualo -1.0");

199 if(
	gÃw_v®
[
i
]!=-1.0è
sum_c
+=
Ãw_v®
[i];

202 if(
	gsum_c
>1.0)

203 
throw
 
	g¡d
::
¡ršg
("sum of…resentƒlements of one site should‚otƒxceed 1.0");

206 
Func_c
 
func_c
(
c_dim
);

207 
	gDMDVecPy
<
	gty³0
,
	gFunc_c
> 
c_vec_py
(
c
,
func_c
);

211 
	gDMDVecPy
<
	gboŞ
,
	gFunc_dof
> 
c_dof_vec_py
(
c_dof
,
func_dof
);

212 
	gDMDVecPy
<
	gboŞ
,
	gFunc_dof
> 
®pha_dof_vec_py
(
®pha_dof
,
func_dof
);

213 
	gŒy


215 
	gVecPyFunc
::
Do
(
this
,
İ
,
id_vec_py
,
x_vec_py
,
®pha_vec_py
,
c_vec_py
,
dof_vec_py
,
c_dof_vec_py
,
®pha_dof_vec_py
);

217 
	$ÿtch
(
¡d
::
¡ršg
& 
”r_msg
)

219 
throw
 
”r_msg
;

220 
	}
}

222 if(
	gx_vec_py
.
	gšc
è
	gthis
->
»£t_domaš
();

228 
	~"ff_¡yËs.h
"

229 
	~"impÜt_¡yËs.h
"

230 
PyObjeù
* 
	gAtomsDMD
::
	$__Ãw__
(
PyTy³Objeù
* 
ty³
,
PyObjeù
* 
¬gs
,PyObjeù* 
kwds
)

232 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
ty³
->
	`_®loc
(type,0));

233 
PyObjeù
* 
£lf
=
»š‹½»t_ÿ¡
<PyObjeù*>(
__£lf
);

234  
£lf
;

235 
	}
}

239 
	gAtomsDMD
::
	$__š™__
(
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)

241 
FuncAPI
<> 
	`func
("__init__");

242 if(
	`func
(
¬gs
,
kwds
)==-1)  -1;

243 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

244 
__£lf
->
©oms
=
NULL
;

245 
__£lf
->
ff
=
NULL
;

247 
	}
}

251 
PyObjeù
* 
	gAtomsDMD
::
	$__®loc__
(
PyTy³Objeù
* 
ty³
,
Py_ssize_t
)

253 
Objeù
* 
__£lf
=
Ãw
 Object;

254 
	`Py_TYPE
(
__£lf
)=
ty³
;

255 
	`Py_REFCNT
(
__£lf
)=1;

256 
__£lf
->
©oms
=
NULL
;

257 
__£lf
->
ff
=
NULL
;

258  
»š‹½»t_ÿ¡
<
PyObjeù
*>(
__£lf
);

259 
	}
}

263 
	gAtomsDMD
::
	$__d—Îoc__
(
PyObjeù
* 
£lf
)

265 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

266 
d–‘e
 
__£lf
->
ff
;

267 
d–‘e
 
__£lf
->
©oms
;

268 
d–‘e
 
__£lf
;

269 
	}
}

271 
PyTy³Objeù
 
	gAtomsDMD
::
Ty³Objeù
 ={
PyObjeù_HEAD_INIT
(
NULL
)};

273 
	gAtomsDMD
::
	$£tup_
()

275 
Ty³Objeù
.
_Çme
="mapp.dmd.atoms";

276 
Ty³Objeù
.
_doc
="container class";

277 
Ty³Objeù
.
_æags
=
Py_TPFLAGS_DEFAULT
 | 
Py_TPFLAGS_BASETYPE
;

278 
Ty³Objeù
.
_basicsize
=(
Objeù
);

280 
Ty³Objeù
.
_Ãw
=
__Ãw__
;

281 
Ty³Objeù
.
_š™
=
__š™__
;

282 
Ty³Objeù
.
_®loc
=
__®loc__
;

283 
Ty³Objeù
.
_d—Îoc
=
__d—Îoc__
;

285 
	`£tup__g‘£t
();

286 
Ty³Objeù
.
_g‘£t
=
g‘£t
;

287 
	`£tup__m‘hods
();

288 
Ty³Objeù
.
_m‘hods
=
m‘hods
;

290 
ichk
=
	`PyTy³_R—dy
(&
Ty³Objeù
);

291 if(
ichk
<0)  ichk;

292 
	`Py_INCREF
(&
Ty³Objeù
);

293  
ichk
;

294 
	}
}

297 #ifdeà
SC_DMD


298 
PyG‘S‘Def
 
	gAtomsDMD
::
g‘£t
[]=
Em±yPyG‘S‘Def
(20);

300 
PyG‘S‘Def
 
	gAtomsDMD
::
g‘£t
[]=
Em±yPyG‘S‘Def
(18);

304 
	gAtomsDMD
::
	$£tup__g‘£t
()

306 
	`g‘£t_¡•
(
g‘£t
[0]);

307 
	`g‘£t_hP
(
g‘£t
[1]);

308 
	`g‘£t_kB
(
g‘£t
[2]);

309 
	`g‘£t_H
(
g‘£t
[3]);

310 
	`g‘£t_B
(
g‘£t
[4]);

311 
	`g‘£t_vŞ
(
g‘£t
[5]);

312 
	`g‘£t_–ems
(
g‘£t
[6]);

313 
	`g‘£t_skš
(
g‘£t
[7]);

314 
	`g‘£t_comm_¿nk
(
g‘£t
[8]);

315 
	`g‘£t_comm_size
(
g‘£t
[9]);

316 
	`g‘£t_comm_coÜds
(
g‘£t
[10]);

317 
	`g‘£t_comm_dims
(
g‘£t
[11]);

318 
	`g‘£t_‹mp
(
g‘£t
[12]);

319 
	`g‘£t_ã
(
g‘£t
[13]);

320 
	`g‘£t_S_ã
(
g‘£t
[14]);

321 
	`g‘£t_s
(
g‘£t
[15]);

322 
	`g‘£t_ave_mu
(
g‘£t
[16]);

323 #ifdeà
SC_DMD


324 
	`g‘£t_BB
(
g‘£t
[17]);

325 
	`g‘£t_d–
(
g‘£t
[18]);

327 
	}
}

330 #ifdeà
SC_DMD


331 
PyM‘hodDef
 
	gAtomsDMD
::
m‘hods
[]=
Em±yPyM‘hodDef
(17);

333 
PyM‘hodDef
 
	gAtomsDMD
::
m‘hods
[]=
Em±yPyM‘hodDef
(8);

336 
	gAtomsDMD
::
	$£tup__m‘hods
()

338 
	`ml_do
(
m‘hods
[0]);

339 
	`ml_¡¿š
(
m‘hods
[1]);

340 
	`ml_mul
(
m‘hods
[2]);

341 
ImpÜtCFGDMD
::
	`ml_impÜt
(
m‘hods
[3]);

342 
FÜûF›ldEAMDMD
::
	`ml_Ãw
(
m‘hods
[4],methods[5],methods[6]);

343 #ifdeà
SC_DMD


344 
FÜûF›ldEAMDMDSC
::
	`ml_Ãw
(
m‘hods
[7],methods[8],methods[9]);

345 
FÜûF›ldEAMDMDSCC
::
	`ml_Ãw
(
m‘hods
[10],methods[11],methods[12]);

346 
FÜûF›ldEAMDMDCLUSTER
::
	`ml_Ãw
(
m‘hods
[13],methods[14],methods[15]);

348 
	}
}

352 
	gAtomsDMD
::
	$g‘£t_‹mp
(
PyG‘S‘Def
& 
g‘£t
)

354 
g‘£t
.
Çme
=(*)"temp";

355 
g‘£t
.
doc
=(*)
R
"---(

356 (è
‹m³¿tu»


358 
Tem³¿tu»
 
of
 
the
 
sy¡em


360 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

362  
v¬
<
ty³0
>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
©oms
->
‹mp
);

364 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

366 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

367 if(!
__£lf
->
©oms
)

369 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"cannot set 'temp'…rioro†oading system configuration");

373 
V¬API
<
ty³0
> 
	`‹mp
("temp");

374 
‹mp
.
logics
[0]=
	`VLogics
("gt",0.0);

375 if(
‹mp
.
	`£t
(
v®
)==-1)  -1;

376 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
©oms
->
‹mp
ñemp.
v®
;

379 
	}
}

383 
	gAtomsDMD
::
	$g‘£t_S_ã
(
PyG‘S‘Def
& 
g‘£t
)

385 
g‘£t
.
Çme
=(*)"S_fe";

386 
g‘£t
.
doc
=(*)
R
"---(

387 (è
¡»ss


389 
VœŸl
 
¡»ss
 
äom
 
ä“
 
’”gy


391 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

393  
v¬
<
ty³0
[
__dim__
][__dim__]>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
©oms
->
S_ã
);

395 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

397 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,"readonly‡ttribute");

400 
	}
}

404 
	gAtomsDMD
::
	$g‘£t_ã
(
PyG‘S‘Def
& 
g‘£t
)

406 
g‘£t
.
Çme
=(*)"fe";

407 
g‘£t
.
doc
=(*)
R
"---(

408 (è
ä“
 
’”gy


410 
F»e
 
’”gy


412 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

414  
v¬
<
ty³0
>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
©oms
->
ã
);

416 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

418 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,"readonly‡ttribute");

421 
	}
}

425 
	gAtomsDMD
::
	$g‘£t_s
(
PyG‘S‘Def
& 
g‘£t
)

427 
g‘£t
.
Çme
=(*)"s";

428 
g‘£t
.
doc
=(*)
R
"---(

429 (è
ä“
 
’”gy


431 
EÁrİy


433 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

435  
v¬
<
ty³0
>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
©oms
->
s
);

437 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

439 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,"readonly‡ttribute");

442 
	}
}

446 
	gAtomsDMD
::
	$g‘£t_ave_mu
(
PyG‘S‘Def
& 
g‘£t
)

448 
g‘£t
.
Çme
=(*)"ave_mu";

449 
g‘£t
.
doc
=(*)
R
"---(

450 ([
ÃËms
]è
av”age
 
mu
 
³r
 
–em’t


452 
Av”age
 
mu
 
³r
 
–em’t


454 
g‘£t
.
g‘
=[](
PyObjeù
* 
__£lf
,*)->PyObject*

456 
FÜûF›ldDMD
* 
__ff
=
»š‹½»t_ÿ¡
<
Objeù
*>(
__£lf
)->
ff
;

457 
AtomsDMD
* 
__©oms
=
»š‹½»t_ÿ¡
<
Objeù
*>(
__£lf
)->
©oms
;

459 if(!
__ff
)

461 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,"cannot calculate‡ve_mu without governingƒquations (force field)");

462  
NULL
;

465 if(
¡d
::
	`i¢ª
(
__©oms
->
kB
))

467 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,"boltzmann constant should be set…rioro calculation of‡ve_mu");

468  
NULL
;

471 if(
¡d
::
	`i¢ª
(
__©oms
->
hP
))

473 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,"planck constant should be set…rioro calculation of‡ve_mu");

474  
NULL
;

477 
__ff
->
	`ÿlc_th”mo
();

478 
size_t
* 
szp
=&(
__©oms
->
–em’ts
.
ÃËms
);

479  
v¬
<
ty³0
*>::
	`bud
(
__ff
->
ave_mu
,&
szp
);

481 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

483 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,"readonly‡ttribute");

486 
	}
}

487 #ifdeà
SC_DMD


491 
	gAtomsDMD
::
	$g‘£t_BB
(
PyG‘S‘Def
& 
g‘£t
)

493 
g‘£t
.
Çme
=(*)"BB";

494 
g‘£t
.
doc
=(*)
R
"---(

495 (è
ä“
 
’”gy


497 
BB


499 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

501  
v¬
<
ty³0
>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
©oms
->
BB
);

503 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

505 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,"readonly‡ttribute");

508 
	}
}

512 
	gAtomsDMD
::
	$g‘£t_d–
(
PyG‘S‘Def
& 
g‘£t
)

514 
g‘£t
.
Çme
=(*)"delta";

515 
g‘£t
.
doc
=(*)
R
"---(

516 (è
‹m³¿tu»


518 
Tem³¿tu»
 
of
 
the
 
sy¡em


520 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

522  
v¬
<
ty³0
>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
©oms
->
d–
);

524 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

526 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

527 if(!
__£lf
->
©oms
)

529 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"cannot set 'delta'…rioro†oading system configuration");

533 
V¬API
<
ty³0
> 
	`‹mp
("delta");

534 if(
‹mp
.
	`£t
(
v®
)==-1)  -1;

535 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
©oms
->
d–
=
‹mp
.
v®
;

538 
	}
}

	@atoms_dmd.h

1 #iâdeà
__MAPP__©oms_dmd__


2 
	#__MAPP__©oms_dmd__


	)

3 
	~"©oms.h
"

6 
Çme¥aû
 
	gMAPP_NS


8 
	g‹m¶©e
<
	gşass
> 
şass
 
	gDMDVec
;

9 şas 
	cAtomsDMD
: 
public
 
Atoms


11 
´iv©e
:

12 
´Ùeùed
:

13 
public
:

14 
ty³0
 
S_ã
[
__dim__
][__dim__];

15 
ty³0
 
	gã
;

16 
ty³0
 
	gs
;

17 #ifdeà
SC_DMD


18 
ty³0
 
	gBB
;

19 
ty³0
 
	gd–
;

22 
	gDMDVec
<
	gty³0
>* 
	g®pha
;

23 
	gDMDVec
<
	gty³0
>* 
	gc
;

24 
	gDMDVec
<
	gboŞ
>* 
	gc_dof
;

25 
	gDMDVec
<
	gboŞ
>* 
	g®pha_dof
;

26 
	gVec
<
	g–em_ty³
>* 
	g–em
;

28 
DO
(
PyObjeù
*);

29 
AtomsDMD
(
MPI_Comm
&,,);

30 ~
AtomsDMD
();

31 
upd©e_max_®pha
();

32 
	gAtomsDMD
& 
	gİ”©Ü
=(cÚ¡ 
Atoms
&);

34 
ty³0
 
vac_msd
();

35 
ty³0
 
	g‹mp
;

36 
ty³0
 
	gmax_®pha
;

37 cÚ¡ 
	gc_dim
;

39 cÚ¡ 
	gN
;

40 
ty³0
* 
	gxi
;

41 
ty³0
* 
	gwi
;

45 
PyObjeù_HEAD


46 
şass
 
AtomsDMD
* 
	g©oms
;

47 
şass
 
FÜûF›ldDMD
* 
	gff
;

48 }
	tObjeù
;

50 
PyTy³Objeù
 
	gTy³Objeù
;

51 
PyObjeù
* 
__Ãw__
(
PyTy³Objeù
*,PyObject*, PyObject*);

52 
__š™__
(
PyObjeù
*, PyObject*,PyObject*);

53 
PyObjeù
* 
__®loc__
(
PyTy³Objeù
*,
Py_ssize_t
);

54 
__d—Îoc__
(
PyObjeù
*);

56 
PyG‘S‘Def
 
	gg‘£t
[];

57 
£tup__g‘£t
();

58 
g‘£t_‹mp
(
PyG‘S‘Def
&);

59 
g‘£t_S_ã
(
PyG‘S‘Def
&);

60 
g‘£t_ã
(
PyG‘S‘Def
&);

61 
g‘£t_s
(
PyG‘S‘Def
&);

62 
g‘£t_ave_mu
(
PyG‘S‘Def
&);

63 #ifdeà
SC_DMD


64 
g‘£t_BB
(
PyG‘S‘Def
&);

65 
g‘£t_d–
(
PyG‘S‘Def
&);

67 
PyM‘hodDef
 
	gm‘hods
[];

68 
£tup__m‘hods
();

70 
£tup_
();

81 
Çme¥aû
 
	gMAPP_NS


83 
	g‹m¶©e
<
ty³Çme
 
	gT
>

84 
şass
 
	gDMDVec
: 
public
 
Vec
<
T
>

86 
´iv©e
:

87 
şass
 
AtomsDMD
* 
©oms_dmd
;

88 
	gdump_dim
;

89 
	g´Ùeùed
:

90 
public
:

91 cÚ¡ 
T
 
def_v®
;

92 
DMDVec
(
şass
 
AtomsDMD
*,
T
,const *);

94 
DMDVec
(
şass
 
AtomsDMD
*,
T
);

95 ~
DMDVec
(){}

96 
ndim_dump
()cÚ¡{ 
	g¡©ic_ÿ¡
<>(
	g©oms_dmd
->
	g–em’ts
.
	gÃËms
);};

97 
š™_dump
();

98 
fš_dump
();

99 
š™_do
();

100 
fš_do
();

101 
´št
(
FILE
*,);

107 
	g‹m¶©e
<
ty³Çme
 
	gT
>

108 
šlše
 
	gDMDVec
<
	gT
>::
	$DMDVec
(
şass
 
AtomsDMD
* 
__©oms
,
T
 
__def_v®
,cÚ¡ * 
__Çme
):

109 
Vec
<
T
>(
__©oms
,__©oms->
c_dim
,
__Çme
),

110 
	`def_v®
(
__def_v®
),

111 
	$©oms_dmd
(
__©oms
)

113 
	}
}

117 
	g‹m¶©e
<
ty³Çme
 
	gT
>

118 
šlše
 
	gDMDVec
<
	gT
>::
	$DMDVec
(
şass
 
AtomsDMD
* 
__©oms
,
T
 
__def_v®
):

119 
Vec
<
T
>(
__©oms
,__©oms->
c_dim
),

120 
	`def_v®
(
__def_v®
),

121 
	$©oms_dmd
(
__©oms
)

123 
	}
}

127 
	g‹m¶©e
<
ty³Çme
 
	gT
>

128 
šlše
 
	gDMDVec
<
	gT
>::
	$š™_dump
()

130 
dump_dim
=
¡©ic_ÿ¡
<>(
©oms_dmd
->
–em’ts
.
ÃËms
);

131 if(
vec
::
dim
==
dump_dim
)

132  
vec
::
	`š™_dump
();

135 
¿nk
=
©oms_dmd
->
comm_¿nk
;

136 
Çtms_lş
=
©oms_dmd
->natms_lcl;

137 
size_t
 
sz
;

138 if(
¿nk
)

139 
sz
=
dump_dim
*(
T
)*
Çtms_lş
;

141 
sz
=
dump_dim
*(
T
)*
©oms_dmd
->
Çtms
;

143 if(
sz
è
vec
::
d©a_dump
=
Ãw
 
by‹
[sz];

145 
T
* 
__d©a_dump
=
»š‹½»t_ÿ¡
<T*>(
vec
::
d©a_dump
);

146 
T
* 
__d©a
=
»š‹½»t_ÿ¡
<T*>(
vec
::
d©a
);

147 
–em_ty³
* 
–em
=
©oms_dmd
->–em->
	`begš
();

150 
i
=0;i<
Çtms_lş
;i++)

152 
j
=0;j<
dump_dim
;j++)

153 
__d©a_dump
[
j
]=
def_v®
;

155 
j
=0;j<
vec
::
dim
;j++)

156 
__d©a_dump
[
–em
[
j
]]=
__d©a
[j];

158 
__d©a_dump
+=
dump_dim
;

159 
__d©a
+=
vec
::
dim
;

160 
–em
+=
vec
::
dim
;

162 
vec
::
by‹_sz
=(vec::by‹_sz*
dump_dim
)/vec::
dim
;

163 
	}
}

167 
	g‹m¶©e
<
ty³Çme
 
	gT
>

168 
šlše
 
	gDMDVec
<
	gT
>::
	$´št
(
FILE
* 
å
,
i
)

170 
T
* 
__d©a_dump
=
Vec
<T>::
	`begš_dump
()+
dump_dim
*
i
;

171 
j
=0;j<
dump_dim
;j++)

172 
	`årštf
(
å
,
Vec
<
T
>::
´št_fÜm©
,
__d©a_dump
[
j
]);

173 
	}
}

177 
	g‹m¶©e
<
ty³Çme
 
	gT
>

178 
šlše
 
	gDMDVec
<
	gT
>::
	$fš_dump
()

180 if(
vec
::
dim
==
dump_dim
)

181  
vec
::
	`fš_dump
();

183 
vec
::
by‹_sz
=(vec::by‹_sz*vec::
dim
)/
dump_dim
;

184 
d–‘e
 [] 
vec
::
d©a_dump
;

185 
vec
::
d©a_dump
=
NULL
;

186 
	}
}

190 
	g‹m¶©e
<
ty³Çme
 
	gT
>

191 
šlše
 
	gDMDVec
<
	gT
>::
	$š™_do
()

193 
dump_dim
=
¡©ic_ÿ¡
<>(
©oms_dmd
->
–em’ts
.
ÃËms
);

194 if(
vec
::
dim
==
dump_dim
)

197 
Çtms_lş
=
©oms_dmd
->natms_lcl;

198 
size_t
 
sz
=
dump_dim
*
Çtms_lş
;

200 
T
* 
__Ãw_d©a
=
NULL
;

201 if(
sz
è
__Ãw_d©a
=
Ãw
 
by‹
[sz];

202 
T
* 
__d©a
=
»š‹½»t_ÿ¡
<T*>(
vec
::
d©a
);

203 
–em_ty³
* 
–em
=
©oms_dmd
->–em->
	`begš
();

206 
i
=0;i<
Çtms_lş
;i++)

208 
j
=0;j<
dump_dim
;j++)

209 
__Ãw_d©a
[
j
]=
def_v®
;

211 
j
=0;j<
vec
::
dim
;j++)

212 
__Ãw_d©a
[
–em
[
j
]]=
__d©a
[j];

214 
__Ãw_d©a
+=
dump_dim
;

215 
__d©a
+=
vec
::
dim
;

216 
–em
+=
vec
::
dim
;

218 
vec
::
by‹_sz
=(vec::by‹_sz*
dump_dim
)/vec::
dim
;

219 
	}
}

223 
	g‹m¶©e
<
ty³Çme
 
	gT
>

224 
šlše
 
	gDMDVec
<
	gT
>::
	$fš_do
()

226 if(
vec
::
dim
==
dump_dim
)

227  
vec
::
	`fš_dump
();

229 
vec
::
by‹_sz
=(vec::by‹_sz*vec::
dim
)/
dump_dim
;

230 
d–‘e
 [] 
vec
::
d©a_dump
;

231 
vec
::
d©a_dump
=
NULL
;

232 
	}
}

237 
Çme¥aû
 
	gMAPP_NS


239 
	g‹m¶©e
<
ty³Çme
 
	gT
,
şass
 
	gF
>

240 
şass
 
	gDMDVecPy
 : 
public
 
VecPy
<
T
,
	gF
>

242 
	g´iv©e
:

243 
´Ùeùed
:

244 
public
:

245 
DMDVecPy
(
DMDVec
<
T
>* 
__vec
,
F
& 
__func
);

246 ~
DMDVecPy
();

247 
£tup_¬r_d©a
();

248 
´e_™”
();

249 
po¡_™”
();

250 
	gtmp_dim
;

252 
–em_ty³
* 
	g–em
;

253 
–em_ty³
* 
	g–em_h—d
;

255 * 
	gm­_–em
;

256 
T
 
	gdef_v®
;

264 
	g‹m¶©e
<
ty³Çme
 
	gT
,
şass
 
	gF
>

265 
	gDMDVecPy
<
	gT
,
	gF
>::
DMDVecPy
(
DMDVec
<
T
>* 
__vec
,
F
& 
__func
):

266 
VecPy
<
T
,
	gF
>::
	$VecPy
(
__vec
,
__func
)

268 
–em
=
»š‹½»t_ÿ¡
<
AtomsDMD
*>(
__vec
->
©oms
)->–em->
	`begš
();

269 
def_v®
=
__vec
->def_val;

270 
tmp_dim
=
__vec
->
	`ndim_dump
();

271 if(
tmp_dim
è
m­_–em
=
Ãw
 [tmp_dim];

273 
	}
}

277 
	g‹m¶©e
<
ty³Çme
 
	gT
,
şass
 
	gF
>

278 
	gDMDVecPy
<
	gT
,
	gF
>::~
	$DMDVecPy
()

280 
d–‘e
 [] 
m­_–em
;

281 
	}
}

285 
	g‹m¶©e
<
ty³Çme
 
	gT
,
şass
 
	gF
>

286 
	gDMDVecPy
<
	gT
,
	gF
>::
	$£tup_¬r_d©a
()

288 
VecPy
<
T
,
F
>::
¬r_d©a
=
Ãw
 T[
tmp_dim
];

289 
VecPy
<
T
,
F
>::
Åy_dim
=
¡©ic_ÿ¡
<
¡d
::
»move_poš‹r
<
Åy_š
>::
ty³
>(
tmp_dim
);

290 
–em_h—d
=
–em
;

291 
	}
}

295 
	g‹m¶©e
<
ty³Çme
 
	gT
,
şass
 
	gF
>

296 
	gDMDVecPy
<
	gT
,
	gF
>::
	$´e_™”
()

298 
i
=0;i<
tmp_dim
;i++)

300 
m­_–em
[
i
]=-1;

301 
VecPy
<
T
,
F
>::
¬r_d©a
[
i
]=
def_v®
;

303 
i
=0;i<
VecPy
<
T
,
F
>::
dim
;i++)

305 
m­_–em
[
–em_h—d
[
i
]]=i;

306 
VecPy
<
T
,
F
>::
¬r_d©a
[
–em_h—d
[
i
]]=VecPy<T,F>::
h—d
[i];

309 
	}
}

313 
	g‹m¶©e
<
ty³Çme
 
	gT
,
şass
 
	gF
>

314 
	gDMDVecPy
<
	gT
,
	gF
>::
	$po¡_™”
()

319 
i
=0;i<
tmp_dim
;i++)

321 if(
m­_–em
[
i
]==-1 && 
VecPy
<
T
,
F
>::
¬r_d©a
[i]!=
def_v®
)

322 
throw
 
¡d
::
	`¡ršg
("cannot change it");

325 
Œy


327 
VecPy
<
T
,
F
>::
	`func
(VecPy<T,F>::
h—d
,VecPy<T,F>::
¬r_d©a
);

329 
	`ÿtch
(
¡d
::
¡ršg
& 
”r_msg
)

331 
throw
 
”r_msg
;

333 
i
=0;i<
tmp_dim
;i++)

334 if(
m­_–em
[
i
]!=-1)

335 
VecPy
<
T
,
F
>::
h—d
[
m­_–em
[
i
]]=VecPy<T,F>::
¬r_d©a
[i];

336 
VecPy
<
T
,
F
>::
h—d
+=VecPy<T,F>::
dim
;

337 
–em_h—d
+=
VecPy
<
T
,
F
>::
dim
;

338 
	}
}

	@atoms_md.cpp

1 
	~"©oms_md.h
"

2 
	~"xm©h.h
"

6 
	gAtomsMD
::
	$AtomsMD
(
MPI_Comm
& 
wÜld
):

7 
	`Atoms
(
wÜld
),

8 
S_³
{
	`DESIG2
(
__dim__
,__dim__,
NAN
)
	}
},

9 
	$³
(
NAN
)

11 
–em
=
Ãw
 
Vec
<
–em_ty³
>(
this
,1,"elem");

12 
x_d
=
Ãw
 
Vec
<
ty³0
>(
this
,
__dim__
,"x_d");

13 
x_d
->
	`em±y
(0.0);

14 
	}
}

18 
	gAtomsMD
::~
	$AtomsMD
()

20 
d–‘e
 
x_d
;

21 
d–‘e
 
–em
;

22 
	}
}

26 
	gAtomsMD
& AtomsMD::
İ”©Ü
=(cÚ¡ 
Atoms
& 
r
)

28 
–em’ts
=
r
.elements;

29 
	gcomm
=
r
.
comm
;

30 
	gÇtms_lş
=
r
.
Çtms_lş
;

31 
	gÇtms_ph
=
r
.
Çtms_ph
;

32 
	gÇtms
=
r
.
Çtms
;

33 
	g¡•
=
r
.
¡•
;

35 
	gmax_cut
=
r
.
max_cut
;

36 
	gkB
=
r
.
kB
;

37 
	ghP
=
r
.
hP
;

39 
	gvŞ
=
r
.
vŞ
;

40 
memıy
(
d•th_šv
,
r
.d•th_šv,
__dim__
*(
ty³0
));

41 
memıy
(
__h
,
r
.__h,
__nvoigt__
*(
ty³0
));

42 
memıy
(
__b
,
r
.__b,
__nvoigt__
*(
ty³0
));

43 
memıy
(&
H
[0][0],&
r
.H[0][0],
__dim__
*__dim__*(
ty³0
));

44 
memıy
(&
B
[0][0],&
r
.B[0][0],
__dim__
*__dim__*(
ty³0
));

46 
	gi
=0;i<
	gnvecs
;i++)

47 if(!
	gvecs
[
i
]->
is_em±y
())

48 
	gvecs
[
i
]->
»size
(
Çtms_lş
);

49 
memıy
(
x
->
begš
(),
r
.x->begš(),
Çtms_lş
*
__dim__
*(
ty³0
));

50 
memıy
(
id
->
begš
(),
r
.id->begš(),
Çtms_lş
*());

51 * 
	gthis
;

56 
	gAtomsMD
::
	$x_d2s_d_dump
()

58 
Algeb¿
::
X2S_NOCORR
<
__dim__
>(
__b
,
Çtms
,
x_d
->
	`begš_dump
());

59 
	}
}

63 
	~"¿ndom.h
"

64 
	~"–em’ts.h
"

65 
	~"xm©h.h
"

66 
	gAtomsMD
::
	$ü—‹_T
(
ty³0
 
T
,
£ed
)

68 
x_d
->
	`fl
();

69 
Rªdom
 
	`¿nd
(
£ed
+
comm_¿nk
);

70 
ty³0
* 
__x_d
=
x_d
->
	`begš
();

71 
ty³0
* 
m
=
–em’ts
.
mas£s
;

72 
–em_ty³
* 
__–em
=
–em
->
	`begš
();

73 
ty³0
 
çc
;

74 if(!
x_dof
->
	`is_em±y
())

76 
boŞ
* 
__dof
=
x_dof
->
	`begš
();

77 
i
=0;i<
Çtms_lş
;i++)

79 
çc
=
	`sq¹
(
kB
*
T
/
m
[*
__–em
]);

80 
Algeb¿
::
Do
<
__dim__
>::
	`func
([&
çc
,&
¿nd
,&
__x_d
,
__dof
,
this
](cÚ¡ 
i
){if(__dof[i]è__x_d[i]ôªd.
	`gaussŸn
()*fac;});

81 
__x_d
+=
__dim__
;

82 
__dof
+=
__dim__
;

83 ++
__–em
;

88 
i
=0;i<
Çtms_lş
;i++)

90 
çc
=
	`sq¹
(
kB
*
T
/
m
[*
__–em
]);

91 
Algeb¿
::
Do
<
__dim__
>::
	`func
([&
çc
,&
¿nd
,&
__x_d
,
this
](cÚ¡ 
i
){__x_d[i]ôªd.
	`gaussŸn
()*fac;});

92 
__x_d
+=
__dim__
;

93 ++
__–em
;

96 
	}
}

100 
	gAtomsMD
::
	$couÁ_–em
(
–em_ty³
 
›Ëm
)

102 
–em_ty³
* 
__–em
=
–em
->
	`begš
();

103 
n_lş
=0;

104 
i
=0;i<
Çtms_lş
;i++)

105 if(
__–em
[
i
]==
›Ëm
è
n_lş
++;

106 
n
=0;

107 
	`MPI_AÎ»duû
(&
n_lş
,&
n
,1,
Vec
<>::
MPI_T
,
MPI_SUM
,
wÜld
);

108  
n
;

109 
	}
}

113 
	gAtomsMD
::
	$DO
(
PyObjeù
* 
İ
)

115 şas 
	cFunc_x


117 
public
:

118 
	`İ”©Ü
()(
ty³0
*,type0*)

120 
	}
};

121 
Func_x
 
	gfunc_x
;

122 
	gVecPy
<
	gty³0
,
	gFunc_x
> 
x_vec_py
(
x
,
func_x
);

124 şas 
	cFunc_x_d


126 
	gpublic
:

127 
İ”©Ü
()(
ty³0
*,
	gty³0
*)

130 
Func_x_d
 
	gfunc_x_d
;

131 
	gVecPy
<
	gty³0
,
	gFunc_x_d
> 
x_d_vec_py
(
x_d
,
func_x_d
);

134 şas 
	cFunc_id


136 
	gpublic
:

137 
İ”©Ü
()(* 
Şd_v®
,* 
	gÃw_v®
)

139 if(*
	gŞd_v®
!=*
Ãw_v®
)

140 
throw
 
¡d
::
¡ršg
("id of‡toms cannot be changed");

143 
Func_id
 
	gfunc_id
;

144 
	gVecPy
<,
	gFunc_id
> 
id_vec_py
(
id
,
func_id
);

148 şas 
	cFunc_–em


150 
	gpublic
:

151 
–em_ty³
 
ÃËm
;

152 
Func_–em
(
–em_ty³
 
__ÃËm
):
ÃËm
(__nelem){}

153 
İ”©Ü
()(
–em_ty³
* 
Şd_v®
,–em_ty³* 
	gÃw_v®
)

155 if(*
	gÃw_v®
>=
ÃËm
)

156 
throw
 
¡d
::
¡ršg
("–em oà©om should bËs thª ")+
Pršt
::
to_¡ršg
(
¡©ic_ÿ¡
<>(
ÃËm
));

159 
Func_–em
 
func_–em
(
–em’ts
.
__ÃËms
);

160 
	gVecPy
<
	g–em_ty³
,
	gFunc_–em
> 
–em_vec_py
(
–em
,
func_–em
);

164 şas 
	cFunc_dof


166 
	gpublic
:

167 
İ”©Ü
()(
boŞ
*,
	gboŞ
*)

171 
Func_dof
 
	gfunc_dof
;

172 
	gVecPy
<
	gboŞ
,
	gFunc_dof
> 
dof_vec_py
(
x_dof
,
func_dof
);

173 
	gŒy


175 
	gVecPyFunc
::
Do
(
this
,
İ
,
id_vec_py
,
x_vec_py
,
x_d_vec_py
,
–em_vec_py
,
dof_vec_py
);

177 
	$ÿtch
(
¡d
::
¡ršg
& 
”r_msg
)

179 
throw
 
”r_msg
;

180 
	}
}

182 if(
	gx_vec_py
.
	gšc
è
	gthis
->
»£t_domaš
();

188 
	~"ff_¡yËs.h
"

189 
	~"impÜt_¡yËs.h
"

190 
PyObjeù
* 
	gAtomsMD
::
	$__Ãw__
(
PyTy³Objeù
* 
ty³
,
PyObjeù
* 
¬gs
,PyObjeù* 
kwds
)

192 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
ty³
->
	`_®loc
(type,0));

193 
PyObjeù
* 
£lf
=
»š‹½»t_ÿ¡
<PyObjeù*>(
__£lf
);

194  
£lf
;

195 
	}
}

199 
	gAtomsMD
::
	$__š™__
(
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)

201 
FuncAPI
<> 
	`func
("__init__");

202 if(
	`func
(
¬gs
,
kwds
)==-1)  -1;

203 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

204 
__£lf
->
©oms
=
NULL
;

205 
__£lf
->
ff
=
NULL
;

207 
	}
}

211 
PyObjeù
* 
	gAtomsMD
::
	$__®loc__
(
PyTy³Objeù
* 
ty³
,
Py_ssize_t
)

213 
Objeù
* 
__£lf
=
Ãw
 Object;

214 
	`Py_TYPE
(
__£lf
)=
ty³
;

215 
	`Py_REFCNT
(
__£lf
)=1;

216 
__£lf
->
©oms
=
NULL
;

217 
__£lf
->
ff
=
NULL
;

218  
»š‹½»t_ÿ¡
<
PyObjeù
*>(
__£lf
);

219 
	}
}

223 
	gAtomsMD
::
	$__d—Îoc__
(
PyObjeù
* 
£lf
)

225 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

226 
d–‘e
 
__£lf
->
ff
;

227 
d–‘e
 
__£lf
->
©oms
;

228 
d–‘e
 
__£lf
;

229 
	}
}

231 
PyTy³Objeù
 
	gAtomsMD
::
Ty³Objeù
 ={
PyObjeù_HEAD_INIT
(
NULL
)};

233 
	gAtomsMD
::
	$£tup_
()

235 
Ty³Objeù
.
_Çme
="mapp.md.atoms";

236 
Ty³Objeù
.
_doc
="container class";

238 
Ty³Objeù
.
_æags
=
Py_TPFLAGS_DEFAULT
 | 
Py_TPFLAGS_BASETYPE
;

239 
Ty³Objeù
.
_basicsize
=(
Objeù
);

241 
Ty³Objeù
.
_Ãw
=
__Ãw__
;

242 
Ty³Objeù
.
_š™
=
__š™__
;

243 
Ty³Objeù
.
_®loc
=
__®loc__
;

244 
Ty³Objeù
.
_d—Îoc
=
__d—Îoc__
;

246 
	`£tup__g‘£t
();

247 
Ty³Objeù
.
_g‘£t
=
g‘£t
;

248 
	`£tup__m‘hods
();

249 
Ty³Objeù
.
_m‘hods
=
m‘hods
;

251 
ichk
=
	`PyTy³_R—dy
(&
Ty³Objeù
);

252 if(
ichk
<0)  ichk;

253 
	`Py_INCREF
(&
Ty³Objeù
);

254  
ichk
;

255 
	}
}

257 
PyG‘S‘Def
 
	gAtomsMD
::
g‘£t
[]=
Em±yPyG‘S‘Def
(15);

259 
	gAtomsMD
::
	$£tup__g‘£t
()

261 
	`g‘£t_¡•
(
g‘£t
[0]);

262 
	`g‘£t_hP
(
g‘£t
[1]);

263 
	`g‘£t_kB
(
g‘£t
[2]);

264 
	`g‘£t_H
(
g‘£t
[3]);

265 
	`g‘£t_B
(
g‘£t
[4]);

266 
	`g‘£t_vŞ
(
g‘£t
[5]);

267 
	`g‘£t_–ems
(
g‘£t
[6]);

268 
	`g‘£t_skš
(
g‘£t
[7]);

269 
	`g‘£t_comm_¿nk
(
g‘£t
[8]);

270 
	`g‘£t_comm_size
(
g‘£t
[9]);

271 
	`g‘£t_comm_coÜds
(
g‘£t
[10]);

272 
	`g‘£t_comm_dims
(
g‘£t
[11]);

273 
	`g‘£t_³
(
g‘£t
[12]);

274 
	`g‘£t_S_³
(
g‘£t
[13]);

275 
	}
}

279 
	gAtomsMD
::
	$g‘£t_S_³
(
PyG‘S‘Def
& 
g‘£t
)

281 
g‘£t
.
Çme
=(*)"S_pe";

282 
g‘£t
.
doc
=(*)
R
"---(

283 (è
pÙ’tŸl
 
’”gy
 
¡»ss


285 
PÙ’tŸl
 
’”gy
 
·¹
 
of
 
vœŸl
 
¡»ss


287 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

289  
v¬
<
ty³0
[
__dim__
][__dim__]>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
©oms
->
S_³
);

291 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

293 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,"readonly‡ttribute");

296 
	}
}

300 
	gAtomsMD
::
	$g‘£t_³
(
PyG‘S‘Def
& 
g‘£t
)

302 
g‘£t
.
Çme
=(*)"pe";

303 
g‘£t
.
doc
=(*)
R
"---(

304 (è
pÙ’tŸl
 
’”gy


306 
PÙ’tŸl
 
’”gy


308 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

310  
v¬
<
ty³0
>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
©oms
->
³
);

312 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

314 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,"readonly‡ttribute");

317 
	}
}

319 #ifdeà
POTFIT


320 
PyM‘hodDef
 
	gAtomsMD
::
m‘hods
[]=
Em±yPyM‘hodDef
(16);

322 
PyM‘hodDef
 
	gAtomsMD
::
m‘hods
[]=
Em±yPyM‘hodDef
(13);

325 
	gAtomsMD
::
	$£tup__m‘hods
()

327 
	`ml_do
(
m‘hods
[0]);

328 
	`ml_mul
(
m‘hods
[1]);

329 
	`ml_¡¿š
(
m‘hods
[2]);

330 
	`ml_ü—‹_‹mp
(
m‘hods
[3]);

331 
	`ml_add_–em
(
m‘hods
[4]);

332 
FÜûF›ldLJ
::
	`ml_Ãw
(
m‘hods
[5]);

333 
FÜûF›ldEAM
::
	`ml_Ãw
(
m‘hods
[6],methods[7],methods[8]);

334 
FÜûF›ldFS
::
	`ml_Ãw
(
m‘hods
[9]);

335 
FÜûF›ldEAMFunc
::
	`ml_Ãw
(
m‘hods
[10]);

336 
ImpÜtCFGMD
::
	`ml_impÜt
(
m‘hods
[11]);

337 #ifdeà
POTFIT


338 
FÜûF›ldEAMF™
::
	`ml_Ãw
(
m‘hods
[12]);

339 
FÜûF›ldEAMF™O
::
	`ml_Ãw
(
m‘hods
[13]);

340 
FÜûF›ldEAMPÙF™AckOg©a
::
	`ml_Ãw
(
m‘hods
[14]);

342 
	}
}

346 
	gAtomsMD
::
	$ml_ü—‹_‹mp
(
PyM‘hodDef
& 
_m‘hod
)

348 
_m‘hod
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

349 
_m‘hod
.
ml_Çme
="create_temp";

350 
_m‘hod
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

351 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

353 
AtomsMD
::
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<AtomsMD::Objeù*>(
£lf
);

354 if(
¡d
::
	`i¢ª
(
__£lf
->
©oms
->
kB
))

356 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,"boltzmann constant should be set…rioro create_temp");

357  
NULL
;

360 
FuncAPI
<
ty³0
,> 
	`f
("create_temp",{"temp","seed"});

361 
f
.
logics
<0>()[0]=
	`VLogics
("gt",0.0);

362 
f
.
logics
<1>()[0]=
	`VLogics
("gt",0);

363 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

365 
__£lf
->
©oms
->
	`ü—‹_T
(
f
.
v®
<0>(),f.val<1>());

366 
Py_RETURN_NONE
;

368 
_m‘hod
.
ml_doc
=
R
"---(

369 
	`ü—‹_‹mp
(
‹mp
,
£ed
)

371 
C»©e
 
a
 
¿ndom
 
v–c™y
 
f›ld


373 
P¬am‘”s


375 
‹mp
 : 

376 
Tem³¿tu»


377 
£ed
 : 

378 
¿ndom
 
£ed


380 
R‘uºs


382 
NÚe


385 
	}
}

389 
AtomsMD
::
	$ml_add_–em
(
PyM‘hodDef
& 
_m‘hod
)

391 
_m‘hod
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

392 
_m‘hod
.
ml_Çme
="add_elem";

393 
_m‘hod
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

394 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

396 
FuncAPI
<
¡d
::
¡ršg
,
ty³0
> 
	`f
("add_elem",{"elem","mass"});

397 
f
.
logics
<1>()[0]=
	`VLogics
("gt",0.0);

398 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

400 
AtomsMD
::
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<AtomsMD::Objeù*>(
£lf
);

401 
__£lf
->
©oms
->
–em’ts
.
	`add_ty³
(
f
.
v®
<1>(),f.v®<0>().
	`c_¡r
());

403 
Py_RETURN_NONE
;

405 
_m‘hod
.
ml_doc
=
R
"---(

406 
	`add_–em
(
–em
,
mass
)

408 
Add
 
a
 
Ãw
 
–em’t
 
to
 
the
 
sy¡em


410 
P¬am‘”s


412 
–em
 : 
¡ršg


413 
New
 
–em’t


414 
£ed
 : 

415 
Mass
 
of
 
the
 
–em’t


417 
R‘uºs


419 
NÚe


422 
	}
}

	@atoms_md.h

1 #iâdeà
__MAPP__©oms_md__


2 
	#__MAPP__©oms_md__


	)

3 
	~"©oms.h
"

4 
Çme¥aû
 
	gMAPP_NS


6 şas 
	cAtomsMD
: 
public
 
Atoms


8 
´iv©e
:

9 
´Ùeùed
:

10 
public
:

11 
ty³0
 
S_³
[
__dim__
][__dim__];

12 
ty³0
 
	g³
;

14 
	gVec
<
	gty³0
>* 
	gx_d
;

15 
	gVec
<
	g–em_ty³
>* 
	g–em
;

16 
ü—‹_T
(
ty³0
,);

17 
couÁ_–em
(
–em_ty³
);

18 
DO
(
PyObjeù
*);

19 
AtomsMD
(
MPI_Comm
&);

20 ~
AtomsMD
();

21 
	gAtomsMD
& 
	gİ”©Ü
=(cÚ¡ 
Atoms
&);

22 
x_d2s_d_dump
();

25 
PyObjeù_HEAD


26 
şass
 
AtomsMD
* 
	g©oms
;

27 
şass
 
FÜûF›ldMD
* 
	gff
;

28 }
	tObjeù
;

30 
PyTy³Objeù
 
	gTy³Objeù
;

31 
PyObjeù
* 
__Ãw__
(
PyTy³Objeù
*,PyObject*, PyObject*);

32 
__š™__
(
PyObjeù
*, PyObject*,PyObject*);

33 
PyObjeù
* 
__®loc__
(
PyTy³Objeù
*,
Py_ssize_t
);

34 
__d—Îoc__
(
PyObjeù
*);

36 
PyG‘S‘Def
 
	gg‘£t
[];

37 
£tup__g‘£t
();

38 
g‘£t_S_³
(
PyG‘S‘Def
&);

39 
g‘£t_³
(
PyG‘S‘Def
&);

41 
PyM‘hodDef
 
	gm‘hods
[];

42 
£tup__m‘hods
();

43 
ml_ü—‹_‹mp
(
PyM‘hodDef
&);

44 
ml_add_–em
(
PyM‘hodDef
&);

45 
ml_impÜt_cfg
(
PyM‘hodDef
&);

47 
£tup_
();

	@atoms_styles.h

1 
	~"©oms_md.h
"

2 
	~"©oms_dmd.h
"

	@cell.h

1 #iâdeà
__MAPP__ûÎ__


2 
	#__MAPP__ûÎ__


	)

3 
Çme¥aû
 
	gMAPP_NS


5 
	g‹m¶©e
<cÚ¡ 
	gM
>

6 şas 
	cC–l


8 
	g´iv©e
:

9 
şass
 
Atoms
* 
©oms
;

10 
ty³0
 
	gûÎ_size
[
__dim__
];

11 
ty³0
 
	gs_lo
[
__dim__
];

12 
ty³0
 
	gs_hi
[
__dim__
];

13 
ty³0
 
	gcut_s
[
__dim__
];

14 
	gûÎ_d’om
[
__dim__
];

15 
	gnûÎs_³r_dim
[
__dim__
];

16 
	gnûÎs
;

18 cÚ¡ 
	gÂeighs
;

19 * 
	g»l_Ãigh_l¡
;

20 (*
	g»l_Ãigh_l¡_coÜd
)[
__dim__
];

22 * 
	gh—d_©m
;

23 
	gpublic
:

24 
‹m¶©e
<
şass
 
F0
,şas 
	gF1
,şas 
	gF2
>

25 
DO
(
boŞ
,
F0
,
F1
,
F2
);

27 
C–l
(
şass
 
Atoms
*);

28 ~
C–l
();

29 
£tup
();

30 
Ãigh_size
();

34 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

38 
	g‹m¶©e
<cÚ¡ 
	gM
>

39 
	gC–l
<
	gM
>::
	$C–l
(
Atoms
* 
__©oms
):

40 
	`©oms
(
__©oms
),

41 
	`Âeighs
(
	`Ãigh_size
()),

42 
	$h—d_©m
(
NULL
)

44 
nûÎs
=0;

45 
»l_Ãigh_l¡
=
Ãw
 [
Âeighs
];

46 
»l_Ãigh_l¡_coÜd
=
Ãw
 [
Âeighs
][
__dim__
];

48 
couÁr
[
__dim__
]={
	`DESIG
(__dim__,-
M
)};

49 
cÚ¡ex´
 
max_Âeighs
=
Algeb¿
::
pow
<2*
M
+1,
__dim__
>();

51 
sum
,
icurs
=0;

52 
cÚ¡ex´
 
rc_sq
=
M
*M;

53 
i
=0;i<
max_Âeighs
;i++)

55 
sum
=0;

56 
j
=0;j<
__dim__
;j++)

58 
sum
+=
couÁr
[
j
]*countr[j];

59 if(
couÁr
[
j
]!=0)

60 
sum
+=1-2*
¡d
::
	`abs
(
couÁr
[
j
]);

63 if(
sum
<
rc_sq
)

65 
Algeb¿
::
V_eq
<
__dim__
>(
couÁr
,
»l_Ãigh_l¡_coÜd
[
icurs
]);

66 
icurs
++;

69 
couÁr
[0]++;

70 
j
=0;j<
__dim__
-1;j++)

71 if(
couÁr
[
j
]==
M
+1)

73 
couÁr
[
j
]=-
M
;

74 
couÁr
[
j
+1]++;

78 
	}
}

82 
	g‹m¶©e
<cÚ¡ 
	gM
>

83 
	gC–l
<
	gM
>::~
	$C–l
()

85 
d–‘e
 [] 
»l_Ãigh_l¡_coÜd
;

86 
d–‘e
 [] 
»l_Ãigh_l¡
;

87 
d–‘e
 [] 
h—d_©m
;

88 
	}
}

92 
	g‹m¶©e
<cÚ¡ 
	gM
>

93 
	gC–l
<
	gM
>::
	$Ãigh_size
()

95 
couÁr
[
__dim__
]={
	`DESIG
(__dim__,-
M
)};

96 
cÚ¡ex´
 
max_Âeighs
=
Algeb¿
::
pow
<2*
M
+1,
__dim__
>();

97 
cÚ¡ex´
 
rc_sq
=
M
*M;

98 
ªs
=0;

99 
i
=0;i<
max_Âeighs
;i++)

101 
sum
=0;

102 
j
=0;j<
__dim__
;j++)

104 
sum
+=
couÁr
[
j
]*countr[j];

105 if(
couÁr
[
j
]!=0)

106 
sum
+=1-2*
¡d
::
	`abs
(
couÁr
[
j
]);

109 if(
sum
<
rc_sq
è++
ªs
;

111 
couÁr
[0]++;

112 
j
=0;j<
__dim__
-1;j++)

113 if(
couÁr
[
j
]==
M
+1)

115 
couÁr
[
j
]=-
M
;

116 
couÁr
[
j
+1]++;

120  
ªs
;

121 
	}
}

125 
	g‹m¶©e
<cÚ¡ 
	gM
>

126 
	gC–l
<
	gM
>::
	$£tup
()

128 
nûÎs
=1;

129 
Algeb¿
::
V_eq_x_mul_V
<
__dim__
>(
©oms
->
max_cut
,©oms->
d•th_šv
,
cut_s
);

130 
Algeb¿
::
V_eq
<
__dim__
>(
©oms
->
s_hi
,s_hi);

131 
Algeb¿
::
V_eq
<
__dim__
>(
©oms
->
s_lo
,s_lo);

132 
i
=0;i<
__dim__
;i++)

134 
ûÎ_size
[
i
]=
cut_s
[i]/
¡©ic_ÿ¡
<
ty³0
>(
M
);

135 
nûÎs_³r_dim
[
i
]=
¡©ic_ÿ¡
<>

136 ((
s_hi
[
i
]-
s_lo
[i])/
ûÎ_size
[i])+1+2*
M
;

137 
ûÎ_d’om
[
i
]=
nûÎs
;

138 
nûÎs
*=
nûÎs_³r_dim
[
i
];

141 
d–‘e
 [] 
h—d_©m
;

142 
h—d_©m
=
Ãw
 [
nûÎs
];

144 
i
=0;i<
Âeighs
;i++)

145 
»l_Ãigh_l¡
[
i
]=
Algeb¿
::
V_mul_V
<
__dim__
>(
ûÎ_d’om
,
»l_Ãigh_l¡_coÜd
[i]);

146 
	}
}

150 
	g‹m¶©e
<cÚ¡ 
	gM
>‹m¶©e<
şass
 
	gF0
,şas 
	gF1
,şas 
	gF2
>

151 
	gC–l
<
	gM
>::
	$DO
(
boŞ
 
chng_box
,
F0
 
´e
,
F1
 
mid
,
F2
 
po¡
)

153 if(
chng_box
è
	`£tup
();

155 
i
=0;i<
nûÎs
;i++)

156 
h—d_©m
[
i
]=-1;

158 cÚ¡ 
Çtms_lş
=
©oms
->natms_lcl;

159 cÚ¡ 
ÇÎ
=
©oms
->
Çtms_ph
+
Çtms_lş
;

161 * 
Ãxt_vec
=
NULL
;

162 * 
ûÎ_vec
=
NULL
;

163 if(
ÇÎ
)

165 
Ãxt_vec
=
Ãw
 [
ÇÎ
];

166 
ûÎ_vec
=
Ãw
 [
ÇÎ
];

169 cÚ¡ 
s_dim
=
©oms
->
x
->
dim
;

170 
ty³0
* 
s
=
©oms
->
x
->
	`begš
()+(
ÇÎ
-1)*
s_dim
;

172 
i
=
ÇÎ
-1,
ûÎ_no
;i>
Çtms_lş
-1;i--,
s
-=
s_dim
)

174 
ûÎ_no
=0;

175 
Algeb¿
::
Do
<
__dim__
>::
	`func
([&
s
,&
ûÎ_no
,
this
](
i
){

176 if(
s
[
i
]<
s_lo
[i])

179 
ûÎ_no
+=
ûÎ_d’om
[
i
]*(
	`MIN
(
¡©ic_ÿ¡
<>((
s
[i]-(
s_lo
[i]-
cut_s
[i]))/
ûÎ_size
[i]),
M
-1));

181 if(
s_hi
[
i
]<=
s
[i])

184 
ûÎ_no
+=
ûÎ_d’om
[
i
]*(
	`MIN
(
	`MAX
(
¡©ic_ÿ¡
<>((
s
[i]-
s_lo
[i])/
ûÎ_size
[i]),
nûÎs_³r_dim
[i]-2*
M
-1),ncells_per_dim[i]-1-M)+M);

189 
ûÎ_no
+=
ûÎ_d’om
[
i
]*(
	`MIN
(
¡©ic_ÿ¡
<>((
s
[i]-
s_lo
[i])/
ûÎ_size
[i]),
nûÎs_³r_dim
[i]-2*
M
-1)+M);

192 
ûÎ_vec
[
i
]=
ûÎ_no
;

193 
Ãxt_vec
[
i
]=
h—d_©m
[
ûÎ_no
];

194 
h—d_©m
[
ûÎ_no
]=
i
;

197 
i
=
Çtms_lş
-1,
ûÎ_no
;i>-1;i--,
s
-=
s_dim
)

199 
ûÎ_no
=0;

200 
Algeb¿
::
Do
<
__dim__
>::
	`func
([&
s
,&
ûÎ_no
,
this
](
i
){

201 
ûÎ_no
+=
ûÎ_d’om
[
i
]*(
	`MIN
(
¡©ic_ÿ¡
<>((
s
[i]-
s_lo
[i])/
ûÎ_size
[i]),
nûÎs_³r_dim
[i]-2*
M
-1)+M);});

203 
ûÎ_vec
[
i
]=
ûÎ_no
;

204 
Ãxt_vec
[
i
]=
h—d_©m
[
ûÎ_no
];

205 
h—d_©m
[
ûÎ_no
]=
i
;

208 
©oms
->
	`s2x_®l
();

211 
i
=0,
j
,
iûÎ
,
jûÎ
,
šeigh
;i<
Çtms_lş
;i++)

213 
	`´e
(
i
);

214 
iûÎ
=
ûÎ_vec
[
i
];

215 
j
=-1;

216 
šeigh
=-1;

217 
j
==-1 && ++
šeigh
<
Âeighs
)

219 
jûÎ
=
iûÎ
+
»l_Ãigh_l¡
[
šeigh
];

220 
j
=
h—d_©m
[
jûÎ
];

221 
j
!=-1)

223 if(
i
!=
j
è
	`mid
(i,j);

224 
j
=
Ãxt_vec
[j];

227 
	`po¡
(
i
);

230 
d–‘e
 [] 
ûÎ_vec
;

231 
d–‘e
 [] 
Ãxt_vec
;

233 
	}
}

	@comm.cpp

1 
	~"comm.h
"

2 
	~"exchªge.h
"

3 
	~"xm©h.h
"

4 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

5 
	~<¡ruùmemb”.h
>

9 
PyObjeù
* 
	gMAPP_MPI
::
	$__Ãw__
(
PyTy³Objeù
* 
ty³
,
PyObjeù
* 
¬gs
,PyObjeù* 
kwds
)

11 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
ty³
->
	`_®loc
(type,0));

12 
PyObjeù
* 
£lf
=
»š‹½»t_ÿ¡
<PyObjeù*>(
__£lf
);

13  
£lf
;

14 
	}
}

18 
	gMAPP_MPI
::
	$__š™__
(
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)

20 
FuncAPI
<> 
	`func
("__init__");

21 if(
	`func
(
¬gs
,
kwds
)==-1)  -1;

22 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

23 
__£lf
->
wÜld
=
MPI_COMM_WORLD
;

24 
	`MPI_Comm_¿nk
(
__£lf
->
wÜld
,&(__£lf->
¿nk
));

25 
	`MPI_Comm_size
(
__£lf
->
wÜld
,&(__£lf->
size
));

27 
	}
}

31 
PyObjeù
* 
	gMAPP_MPI
::
	$__®loc__
(
PyTy³Objeù
* 
ty³
,
Py_ssize_t
)

33 
Objeù
* 
__£lf
=
Ãw
 Object;

34 
	`Py_TYPE
(
__£lf
)=
ty³
;

35 
	`Py_REFCNT
(
__£lf
)=1;

36 
__£lf
->
wÜld
=
NULL
;

37  
»š‹½»t_ÿ¡
<
PyObjeù
*>(
__£lf
);

38 
	}
}

42 
	gMAPP_MPI
::
	$__d—Îoc__
(
PyObjeù
* 
£lf
)

44 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

45 if(
__£lf
->
wÜld
!=
MPI_COMM_WORLD
)

46 
	`MPI_Comm_ä“
(&(
__£lf
->
wÜld
));

47 
	}
}

49 
PyTy³Objeù
 
	gMAPP_MPI
::
Ty³Objeù
 ={
PyObjeù_HEAD_INIT
(
NULL
)};

51 
	gMAPP_MPI
::
	$£tup_
()

53 
Ty³Objeù
.
_Çme
="mpi";

54 
Ty³Objeù
.
_doc
="just‡ simple container for MPI_Comm";

56 
Ty³Objeù
.
_æags
=
Py_TPFLAGS_DEFAULT
 | 
Py_TPFLAGS_BASETYPE
;

57 
Ty³Objeù
.
_basicsize
=(
Objeù
);

59 
Ty³Objeù
.
_Ãw
=
__Ãw__
;

60 
Ty³Objeù
.
_š™
=
__š™__
;

61 
Ty³Objeù
.
_®loc
=
__®loc__
;

62 
Ty³Objeù
.
_d—Îoc
=
__d—Îoc__
;

63 
	`£tup__memb”s
();

64 
Ty³Objeù
.
_memb”s
=tp_members;

66 
ichk
=
	`PyTy³_R—dy
(&
Ty³Objeù
);

67 if(
ichk
<0)  ichk;

68 
	`Py_INCREF
(&
Ty³Objeù
);

69  
ichk
;

70 
	}
}

72 
PyMemb”Def
 
	gMAPP_MPI
::
_memb”s
[]=
Em±yPyMemb”Def
(3);

74 
	gMAPP_MPI
::
	$£tup__memb”s
()

76 
_memb”s
[0].
ty³
=
T_INT
;

77 
_memb”s
[0].
æags
=
READONLY
;

78 
_memb”s
[0].
Çme
=(*)"rank";

79 
_memb”s
[0].
doc
=(*)"rank ofhe mpi communicator";

80 
_memb”s
[0].
off£t
=
	`off£tof
(
MAPP_MPI
::
Objeù
,
¿nk
);

82 
_memb”s
[1].
ty³
=
T_INT
;

83 
_memb”s
[1].
æags
=
READONLY
;

84 
_memb”s
[1].
Çme
=(*)"size";

85 
_memb”s
[1].
doc
=(*)"size ofhe mpi communicator";

86 
_memb”s
[1].
off£t
=
	`off£tof
(
MAPP_MPI
::
Objeù
,
size
);

87 
	}
}

91 
	gCommuniÿtiÚ
::
CommuniÿtiÚ
(
MPI_Comm
 
__wÜld
,(&
N
)[
__dim__
],
ty³0
(&
H
)[__dim__][__dim__],ty³0 
__skš
):

92 
wÜld
(
__wÜld
),

93 
size
(
g‘_size
(
__wÜld
)),

94 
¿nk
(
g‘_¿nk
(
__wÜld
)),

95 
skš
(
__skš
),

96 
	$xchng_id
(0)

98 
	`grid
(
N
,
H
);

99 
	}
}

103 
	gCommuniÿtiÚ
::
CommuniÿtiÚ
(
MPI_Comm
 
__wÜld
,
ty³0
(&
H
)[
__dim__
][__dim__],ty³0 
__skš
):

104 
wÜld
(
__wÜld
),

105 
size
(
g‘_size
(
__wÜld
)),

106 
¿nk
(
g‘_¿nk
(
__wÜld
)),

107 
skš
(
__skš
),

108 
	$xchng_id
(0)

110 
N
[
__dim__
]={
	`DESIG
(__dim__,0)};

111 
	`grid
(
N
,
H
);

112 
	}
}

116 
	gCommuniÿtiÚ
::
	$CommuniÿtiÚ
(
MPI_Comm
 
__wÜld
,
ty³0
 
__skš
):

117 
	`wÜld
(
__wÜld
),

118 
	`size
(
	`g‘_size
(
__wÜld
)),

119 
	`¿nk
(
	`g‘_¿nk
(
__wÜld
)),

120 
	`skš
(
__skš
),

121 
	$xchng_id
(0)

123 
N
[
__dim__
]={
	`DESIG
(__dim__,0)};

124 
ty³0
 
H
[
__dim__
][__dim__]={
	`DESIG2
(__dim__,__dim__,0.0)};

125 
i
=0;i<
__dim__
;i++è
H
[i][i]=1.0;

126 
	`grid
(
N
,
H
);

127 
	}
}

131 
	gCommuniÿtiÚ
::
	$CommuniÿtiÚ
(cÚ¡ 
CommuniÿtiÚ
& 
r
):

132 
	`wÜld
(
r
.
wÜld
),

133 
	`size
(
r
.
size
),

134 
	`¿nk
(
r
.
¿nk
),

135 
	`skš
(
r
.
skš
),

136 
	$xchng_id
(
r
.
xchng_id
)

138 
i
=0;i<
__dim__
;i++)

140 
coÜds
[
i
]=
r
.coords[i];

141 
dims
[
i
]=
r
.dims[i];

142 
Ãigh
[
i
][0]=
r
.neigh[i][0];

143 
Ãigh
[
i
][1]=
r
.neigh[i][1];

144 
s_lo
[
i
]=
r
.s_lo[i];

145 
s_hi
[
i
]=
r
.s_hi[i];

147 
	}
}

151 
	gCommuniÿtiÚ
& CommuniÿtiÚ::
İ”©Ü
=(cÚ¡ 
CommuniÿtiÚ
& 
r
)

153 
this
->~
CommuniÿtiÚ
();

154 
Ãw
 (
this
è
CommuniÿtiÚ
(
r
);

155  *
	gthis
;

160 
	gCommuniÿtiÚ
::
grid
(
ty³0
(&
H
)[
__dim__
][__dim__])

162 
N
[
__dim__
]={
DESIG
(__dim__,0)};

163 
grid
(
N
,
H
);

168 
	gCommuniÿtiÚ
::
grid
((&
N
)[
__dim__
])

170 
ty³0
 
H
[
__dim__
][__dim__]={
DESIG2
(__dim__,__dim__,0.0)};

171 
	gi
=0;i<
	g__dim__
;i++è
	gH
[
i
][i]=1.0;

172 
grid
(
N
,
H
);

177 
	gCommuniÿtiÚ
::
grid
((&
N
)[
__dim__
],
ty³0
(&
H
)[__dim__][__dim__])

179 
	glş_¿nk
,
	gÄªk
,
	gnsize
;

180 * 
	gp_³r_n
;

181 ** 
	gÅ_¬r
;

182 
boŞ
 
	guni_di¡
;

184 
ÃtwÜk_ª®ysis
(
wÜld
,
lş_¿nk
,
Äªk
,
nsize
,
p_³r_n
,
Å_¬r
,
uni_di¡
);

186 if(
	g__dim__
==1)

188 
dims
[0]=
size
;

189 
	gcoÜds
[0]=
lş_¿nk
;

190 
	gi
=0;i<
	gÄªk
;i++è
	gcoÜds
[0]+=
p_³r_n
[
i
];

191 
	gÃigh
[0][0]=
lş_¿nk
==0?

192 
Å_¬r
[
Äªk
==0?
nsize
-1:Äªk-1][
p_³r_n
[nrank==0?nsize-1:nrank-1]-1]:

193 
Å_¬r
[
Äªk
][
lş_¿nk
-1];

195 
	gÃigh
[0][1]=
lş_¿nk
==
p_³r_n
[
Äªk
]-1?

196 
Å_¬r
[
Äªk
==
nsize
-1?0:Äªk+1][0]:Å_¬r[Äªk][
lş_¿nk
+1];

198 
	gs_lo
[0]=
¡©ic_ÿ¡
<
ty³0
>(
coÜds
[0])/¡©ic_ÿ¡<ty³0>(
dims
[0]);

199 
	gs_hi
[0]=
¡©ic_ÿ¡
<
ty³0
>(
coÜds
[0]+1)/¡©ic_ÿ¡<ty³0>(
dims
[0]);

202 
	gd–‘e
 [] *
	gÅ_¬r
;

203 
	gd–‘e
 [] 
	gÅ_¬r
;

204 
	gd–‘e
 [] 
	gp_³r_n
;

209 
	gndims_d‘
=0;

210 
	gd‘_size
=1;

211 
	gi
=0;i<
	g__dim__
;i++)

212 if(
	gN
[
i
])

214 
	gd‘_size
*=
N
[
i
];

215 
	gndims_d‘
++;

219 if(
	gndims_d‘
==
__dim__
-1)

221 
i
=0;
	gi
<
	g__dim__
;i++)

222 if(!
	gN
[
i
]èN[i]=
size
/
d‘_size
;

224 
	gd‘_size
=
size
;

225 
	gndims_d‘
++;

228 
	g´š_dim
=-1;

229 if(
	guni_di¡
 && 
	gnsize
!=1)

232 
key
[
__dim__
];

233 
	gi
=0;i<
	g__dim__
;i++è
	gkey
[
i
]=i;

234 
	gXM©h
::
quicksÜt
(
key
,key+
__dim__


235 ,[&
H
](* 
_i
,* 
_j
){ (H[*_i][*_i]>H[*_j][*_j]);}

236 ,[](* 
_i
,* 
_j
){
¡d
::
sw­
(*_i,*_j);}

239 
	gidim
=0;

240 
	g´š_dim
==-1 && 
idim
<
__dim__
)

242 if(
N
[
key
[
idim
]] && N[key[idim]]==
nsize
)

243 
´š_dim
=
key
[
idim
];

244 if(!
	gN
[
key
[
idim
]] && (
	gsize
/
	gd‘_size
)%
	gnsize
==0)

246 
N
[
key
[
idim
]]=
nsize
;

247 
	g´š_dim
=
key
[
idim
];

248 
	gd‘_size
*=
nsize
;

249 
	gndims_d‘
++;

251 
	gidim
++;

255 if(
	gndims_d‘
!=
__dim__
)

257 
__dims
[
__dim__
];

258 
ty³0
 
	gh
[
__dim__
];

259 
	gicur
=0;

260 
	gi
=0;i<
	g__dim__
;i++)

261 if(!
	gN
[
i
]è
	gh
[
icur
++]=
H
[i][i];

262 
	gAlgeb¿
::
İt_comm_grid
(
__dim__
-
ndims_d‘
,
h
,
size
/
d‘_size
,
__dims
);

264 
	gicur
=0;

265 
	gi
=0;i<
	g__dim__
;i++)

266 if(!
	gN
[
i
]èN[i]=
__dims
[
icur
++];

269 if(
	g´š_dim
!=-1)

271 
dims
[
´š_dim
]=
nsize
;

272 
	gcoÜds
[
´š_dim
]=
Äªk
;

273 
	gÃigh
[
´š_dim
][0]=
Äªk
==0? 
Å_¬r
[
nsize
-1][
lş_¿nk
]:np_arr[nrank-1][lcl_rank];

274 
	gÃigh
[
´š_dim
][1]=
Äªk
==
nsize
-1? 
Å_¬r
[0][
lş_¿nk
]:np_arr[nrank+1][lcl_rank];

276 
	g__dims
[
__dim__
-1];

277 
	g__coÜds
[
__dim__
-1];

278 
	g__Ãigh
[
__dim__
-1][2];

279 
	gicur
=0;

280 
	gi
=0;i<
	g__dim__
;i++)

281 if(
	gi
!=
´š_dim
)

282 
__dims
[
icur
++]=
N
[
i
];

284 
£q_ª®ysis
(
¿nk
,
Å_¬r
[
Äªk
],
p_³r_n
[Äªk],
__dims
,
__coÜds
,
__Ãigh
);

286 
	gicur
=0;

287 
	gi
=0;i<
	g__dim__
;i++)

288 if(
	gi
!=
´š_dim
)

290 
coÜds
[
i
]=
__coÜds
[
icur
];

291 
	gdims
[
i
]=
__dims
[
icur
];

292 
	gÃigh
[
i
][0]=
__Ãigh
[
icur
][0];

293 
	gÃigh
[
i
][1]=
__Ãigh
[
icur
][1];

294 
	gicur
++;

299 
	gi
=0;i<
	g__dim__
;i++è
	gdims
[
i
]=
N
[i];

300 
	gli¡
[
__dim__
];

301 
	gi
=0;i<
	g__dim__
;i++è
	gli¡
[
i
]=1;

302 
MPI_Comm
 
	gÿ¹esŸn
;

303 
MPI_C¬t_ü—‹
(
wÜld
,
__dim__
,
dims
,
li¡
,1,&
ÿ¹esŸn
);

304 
MPI_C¬t_g‘
(
ÿ¹esŸn
,
__dim__
,
dims
,
li¡
,
coÜds
);

305 
	gi
=0;i<
	g__dim__
;i++)

306 
MPI_C¬t_shiá
(
ÿ¹esŸn
,
i
,1,&
Ãigh
[i][0],&neigh[i][1]);

307 
MPI_Comm_ä“
(&
ÿ¹esŸn
);

310 
	gi
=0;i<
	g__dim__
;i++)

312 
	gs_lo
[
i
]=
¡©ic_ÿ¡
<
ty³0
>(
coÜds
[i])/¡©ic_ÿ¡<ty³0>(
dims
[i]);

313 
	gs_hi
[
i
]=
¡©ic_ÿ¡
<
ty³0
>(
coÜds
[i]+1)/¡©ic_ÿ¡<ty³0>(
dims
[i]);

317 
	gd–‘e
 [] *
	gÅ_¬r
;

318 
	gd–‘e
 [] 
	gÅ_¬r
;

319 
	gd–‘e
 [] 
	gp_³r_n
;

324 
	gCommuniÿtiÚ
::
	$g‘_¿nk
(
MPI_Comm
& 
comm
)

326 
i
;

327 
	`MPI_Comm_¿nk
(
comm
,&
i
);

328  
i
;

329 
	}
}

333 
	gCommuniÿtiÚ
::
	$g‘_size
(
MPI_Comm
& 
comm
)

335 
i
;

336 
	`MPI_Comm_size
(
comm
,&
i
);

337  
i
;

338 
	}
}

342 
	gCommuniÿtiÚ
::
	$g‘_¿nk
()

344 
i
;

345 
	`MPI_Comm_¿nk
(
MPI_COMM_WORLD
,&
i
);

346  
i
;

347 
	}
}

351 
	gCommuniÿtiÚ
::
	$g‘_size
()

353 
i
;

354 
	`MPI_Comm_size
(
MPI_COMM_WORLD
,&
i
);

355  
i
;

356 
	}
}

360 
	gCommuniÿtiÚ
::
	$ÃtwÜk_ª®ysis
(
MPI_Comm
& 
wÜld
,

361 & 
lş_¿nk
,& 
Äªk
,& 
nsize
,*& 
p_³r_n
,

362 **& 
Å_¬r
,
boŞ
& 
uni_di¡
)

364 
size
=
	`g‘_size
(
wÜld
);

365 
¿nk
=
	`g‘_¿nk
(
wÜld
);

368 * 
ids
=
Ãw
 [
size
];

369 * 
Çme
=
Ãw
 [
MPI_MAX_PROCESSOR_NAME
];

370 
Çme_sz
;

371 
	`MPI_G‘_´oûssÜ_Çme
(
Çme
,&
Çme_sz
);

372 
Çme_sz
++;

373 
cum_Çme_sz
;

374 
	`MPI_AÎ»duû
(&
Çme_sz
,&
cum_Çme_sz
,1,
MPI_INT
,
MPI_SUM
,
wÜld
);

375 ** 
Çmes
=
Ãw
 *[
size
];

376 *
Çmes
=
NULL
;

377 if(
cum_Çme_sz
è*
Çmes
=
Ãw
 [cum_name_sz];

379 * 
__Çme
=*
Çmes
;

380 
__Çme_sz
;

381 

=0;<
size
;ip++)

383 
ids
[

]=ip;

384 if(

==
¿nk
)

386 
__Çme_sz
=
Çme_sz
;

387 
	`memıy
(
__Çme
,
Çme
,
__Çme_sz
*());

390 
	`MPI_Bÿ¡
(&
__Çme_sz
,1,
MPI_INT
,

,
wÜld
);

391 
	`MPI_Bÿ¡
(
__Çme
,
__Çme_sz
,
MPI_CHAR
,

,
wÜld
);

392 
Çmes
[

]=
__Çme
;

393 
__Çme
+=
__Çme_sz
;

395 
d–‘e
 [] 
Çme
;

398 
nsize
=0;

399 
p_³r_n
=
NULL
;

400 * 
p_³r_n_
;

401 
i
=0,
Ï¡
=0;i<
size
;i++)

403 if(
i
==
¿nk
)

404 
Äªk
=
nsize
;

405 
j
=
i
+1;j<
size
;j++)

406 if(
	`¡rcmp
(
Çmes
[
i
],Çmes[
j
])==0)

408 if(
j
==
¿nk
)

409 
Äªk
=
nsize
;

410 
¡d
::
	`sw­
(
Çmes
[
i
+1],Çmes[
j
]);

411 
¡d
::
	`sw­
(
ids
[
i
+1],ids[
j
]);

412 
i
++;

415 
p_³r_n_
=
Ãw
 [
nsize
+1];

416 
	`memıy
(
p_³r_n_
,
p_³r_n
,
nsize
*());

417 
d–‘e
 [] 
p_³r_n
;

418 
p_³r_n
=
p_³r_n_
;

419 
p_³r_n
[
nsize
++]=
i
+1-
Ï¡
;

420 
Ï¡
=
i
+1;

423 
d–‘e
 [] *
Çmes
;

424 
d–‘e
 [] 
Çmes
;

426 
Å_¬r
=
Ãw
 *[
nsize
];

427 *
Å_¬r
=
ids
;

428 
i
=1;i<
nsize
;i++)

429 
Å_¬r
[
i
]òp_¬r[i-1]+
p_³r_n
[i-1];

430 
uni_di¡
=
Œue
;

431 
i
=0;i<
nsize
 && 
uni_di¡
;i++)

432 if(
p_³r_n
[
i
]!=p_per_n[0])

433 
uni_di¡
=
çl£
;

435 
lş_¿nk
=0;

436 
Å_¬r
[
Äªk
][
lş_¿nk
]!=
¿nk
)†cl_rank++;

437 
	}
}

	@comm.h

1 #iâdeà
__MAPP__comm__


2 
	#__MAPP__comm__


	)

3 
	~"­i.h
"

4 
	~<mpi.h
>

5 
	~"glob®.h
"

15 
Çme¥aû
 
	gMAPP_NS


17 şas 
	cCommuniÿtiÚ


19 
	g´iv©e
:

20 
‹m¶©e
<cÚ¡ 
dim
>

21 
£q_ª®ysis
(cÚ¡ ,cÚ¡ *,cÚ¡ ,(&)[
dim
],(&)[dim],(&)[dim][2]);

22 
	g´Ùeùed
:

23 
public
:

24 
ÃtwÜk_ª®ysis
(
MPI_Comm
&,&,&,&,*&,**&,
boŞ
&);

25 
g‘_¿nk
();

26 
g‘_size
();

27 
g‘_¿nk
(
MPI_Comm
&);

28 
g‘_size
(
MPI_Comm
&);

31 cÚ¡ 
	g¿nk
;

32 cÚ¡ 
	gsize
;

33 
ty³0
 
	gskš
;

34 
	gxchng_id
;

36 
MPI_Comm
 
	gwÜld
;

40 
	gcoÜds
[
__dim__
];

41 
	gdims
[
__dim__
];

42 
	gÃigh
[
__dim__
][2];

43 
ty³0
 
	gs_lo
[
__dim__
];

44 
ty³0
 
	gs_hi
[
__dim__
];

46 
grid
((&)[
__dim__
],
ty³0
(&)[__dim__][__dim__]);

47 
grid
(
ty³0
(&)[
__dim__
][__dim__]);

48 
grid
((&)[
__dim__
]);

49 
CommuniÿtiÚ
(
MPI_Comm
,(&)[
__dim__
],
ty³0
(&)[__dim__][__dim__],type0=0.5);

50 
CommuniÿtiÚ
(
MPI_Comm
,
ty³0
(&)[
__dim__
][__dim__],type0=0.5);

51 
CommuniÿtiÚ
(
MPI_Comm
,
ty³0
=0.5);

52 
CommuniÿtiÚ
(const Communication&);

53 
	gCommuniÿtiÚ
& 
	gİ”©Ü
=(cÚ¡ 
CommuniÿtiÚ
&);

56 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

60 
	g‹m¶©e
<cÚ¡ 
	gdim
>

61 
	gCommuniÿtiÚ
::
£q_ª®ysis
(cÚ¡ 
my_id
,cÚ¡ * 
£q
,cÚ¡ 
£q_sz
,(&
dims
)[
dim
],(&
coÜd
)[dim],(&
Ãigh
)[dim][2])

63 
	gba£
[
dim
];

64 
	gba£
[0]=1;

65 
	gi
=1;i<
	gdim
;i++)

66 
	gba£
[
i
]=
ba£
[i-1]*
dims
[i-1];

68 
	gmy_¿nk
=0;

69 
	g£q
[
my_¿nk
]!=
my_id
) my_rank++;

70 
	gi
=
dim
-1;i>-1;i--)

72 
	gcoÜd
[
i
]=
my_¿nk
/
ba£
[i];

73 
	gmy_¿nk
-=
coÜd
[
i
]*
ba£
[i];

76 
	gi
=0;i<
	gdim
;i++)

78 
	gÃigh
[
i
][0]=
Ãigh
[i][1]=0;

79 
	gj
=0;j<
	gdim
;j++)

81 if(
	gj
==
i
)

83 
Ãigh
[
i
][0]+=(
coÜd
[
j
]==0? 
dims
[j]-1:coÜd[j]-1)*
ba£
[j];

84 
	gÃigh
[
i
][1]+=(
coÜd
[
j
]==
dims
[j]-1? 0:coÜd[j]+1)*
ba£
[j];

88 
	gÃigh
[
i
][0]+=
coÜd
[
j
]*
ba£
[j];

89 
	gÃigh
[
i
][1]+=
coÜd
[
j
]*
ba£
[j];

93 
	gÃigh
[
i
][0]=
£q
[
Ãigh
[i][0]];

94 
	gÃigh
[
i
][1]=
£q
[
Ãigh
[i][1]];

101 
Çme¥aû
 
	gMAPP_NS


104 şas 
	cMAPP_MPI


106 
	gpublic
:

109 
PyObjeù_HEAD


110 
MPI_Comm
 
wÜld
;

111 
	g¿nk
;

112 
	gsize
;

114 }
	tObjeù
;

115 
PyTy³Objeù
 
	gTy³Objeù
;

116 
PyObjeù
* 
__Ãw__
(
PyTy³Objeù
*,PyObject*, PyObject*);

117 
__š™__
(
PyObjeù
*, PyObject*,PyObject*);

118 
PyObjeù
* 
__®loc__
(
PyTy³Objeù
*,
Py_ssize_t
);

119 
__d—Îoc__
(
PyObjeù
*);

121 
PyMemb”Def
 
	g_memb”s
[];

122 
£tup__memb”s
();

123 
£tup_
();

	@dae.cpp

1 
	~"d«.h
"

2 
	~"MAPP.h
"

3 
	~"©oms_dmd.h
"

4 
	~"dyÇmic_dmd.h
"

5 
	~"ff_dmd.h
"

6 
	~"memÜy.h
"

7 #ifdeà
MINCG_W_NEWTON


8 
	~"mš_cg_dmd.h
"

10 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

14 
	gDAE
::
	$DAE
():

15 
	`max_n¡•s
(1000),

16 
	`a_tŞ
(
	`sq¹
(
¡d
::
num”ic_lim™s
<
ty³0
>::
	`•sÚ
())),

17 
	`mš_dt
(
¡d
::
num”ic_lim™s
<
ty³0
>::
	`•sÚ
()),

18 
	`c
(
NULL
),

19 
	`c_d
(
NULL
),

20 
	`x´t
(
NULL
),

21 
	`ncs
(0),

22 
	`Á®ly
(1000),

23 
	`Äe£t
(0),

24 
	`chng_box
(
çl£
),

25 
S_dof
{
	`DESIG2
(
__dim__
,__dim__,
çl£
)
	}
},

26 
	gS
{
DESIG2
(
__dim__
,__dim__,
NAN
)},

27 
max_ÂewtÚ_™”s
(5),

28 
	$max_ngm»s_™”s
(5)

30 
	}
}

34 
	gDAE
::~
	$DAE
()

36 
	}
}

40 
DAE
::
	$´e_run_chk
(
AtomsDMD
* 
__©oms
, 
FÜûF›ldDMD
* 
__ff
)

43 if(!
__©oms
)

44 
throw
 
¡d
::
	`¡ršg
("cannot start dae„un without initial conditions");

47 if(!
__ff
)

48 
throw
 
¡d
::
	`¡ršg
("cannot start dae„un without governingƒquations (force field)");

50 if(
¡d
::
	`i¢ª
(
__©oms
->
kB
))

51 
throw
 
¡d
::
	`¡ršg
("boltzmann constant should be set…rioro dae„un");

53 if(
¡d
::
	`i¢ª
(
__©oms
->
hP
))

54 
throw
 
¡d
::
	`¡ršg
("planck constant should be set…rioro dae„un");

58 if(
chng_box
 && !
__©oms
->
x_dof
->
	`is_em±y
())

60 
boŞ
* 
dof
=
__©oms
->
x_dof
->
	`begš
();

61 
__dof_lş
[
__dim__
]{
	`DESIG
(__dim__,0)};

62 
i
=0;i<
__©oms
->
Çtms_lş
;i++,
dof
+=
__dim__
)

63 
Algeb¿
::
Do
<
__dim__
>::
	`func
([&
dof
,&
__dof_lş
](
i
){ if(!dof[i]) __dof_lcl[i]=1;});

65 
__dof
[
__dim__
]{
	`DESIG
(__dim__,0)};

66 
	`MPI_AÎ»duû
(
__dof_lş
,
__dof
,
__dim__
,
MPI_INT
,
MPI_MAX
,
__©oms
->
wÜld
);

67 
¡d
::
¡ršg
 
”r_msg
=¡d::
	`¡ršg
();

68 
i
=0;i<
__dim__
;i++)

69 
j
=
i
;j<
__dim__
;j++)

70 if(
S_dof
[
i
][
j
] && 
__dof
[i])

78 
”r_msg
+="\nyou hav©om th© dØnÙ havdeg»ä“dom iÀ"+
Pršt
::
	`to_¡ršg
(
i
)

79 +" dœeùiÚhey wÈbdefÜmed‡ffš–y dutØdefšed deg»e oàä“dom H_dof["+
Pršt
::
	`to_¡ršg
(
i
)+"]["+Pršt::to_¡ršg(
j
)+"]";

83 if(!
”r_msg
.
	`em±y
(è&& 
Á®ly
)

85 
”r_msg
="Warning:"+err_msg+"\n";

86 
	`årštf
(
MAPP
::
m­p_out
,"%s",
”r_msg
.
	`c_¡r
());

90 
	}
}

94 
	gDAE
::
	$š™_¡©ic
()

97 
ncs
=
©oms
->
Çtms_lş
*
c_dim
;

99 
c
=
©oms
->c->
	`begš
();

100 
c_d
=
ff
->c_d->
	`begš
();

102 
	}
}

106 
	gDAE
::
	$fš_¡©ic
()

109 
c
=
c_d
=
NULL
;

110 
	}
}

114 
	gDAE
::
	$š™
()

116 
Ã¼_mšs
=0;

117 
c_dim
=
©oms
->c_dim;

118 
ff
->
c_d
->
	`fl
();

119 #ifdeà
MINCG_W_NEWTON


120 
ls
=
Ãw
 
	`LšeS—rchB»Á
();

121 
boŞ
 
__H_dof
[
__dim__
][__dim__];

122 
i
=0;i<
__dim__
;i++è
j
=0;j<__dim__;j++è
__H_dof
[i][j]=
çl£
;

123 
mš
ğ
Ãw
 
	`MšCGDMD
(1.0e-9,
__H_dof
,
çl£
,1.0,0.1,
ls
);

124 
mš
->
©oms
=atoms;

125 
mš
->
ff
=ff;

126 
mš
->
	`š™
();

127 
mš
->
Á®ly
=0;

128 
dyÇmic
=
mš
->dynamic;

130 
dyÇmic
=
Ãw
 
	`DyÇmicDMD
(
©oms
,
ff
,
chng_box
,{©oms->
c_dof
},{©oms->
x_dof
,©oms->
®pha_dof
},{});

131 
dyÇmic
->
	`š™
();

134 
ff
->
	`ÿlc_ndof
();

135 
a_tŞ_sq¹_nc_dof
=
a_tŞ
*
	`sq¹
(
¡©ic_ÿ¡
<
ty³0
>(
ff
->
nc_dof
));

136 
n
=
ff
->
nx_dof
+ff->
ÇÍha_dof
;

137 
Algeb¿
::
DoLT
<
__dim__
>::
	`func
([
this
,&
n
](
i
,
j
)

138 {if(!
¡d
::
	`i¢ª
(
S
[
i
][
j
])è++
n
;});

139 
sq¹_nx_ÇÍha_nS_dof
=
	`sq¹
(
¡©ic_ÿ¡
<
ty³0
>(
n
));

140 
a_tŞ_sq¹_nx_ÇÍha_nS_dof
=
a_tŞ
*
sq¹_nx_ÇÍha_nS_dof
;

141 
	}
}

145 
	gDAE
::
	$fš
()

147 #ifdeà
MINCG_W_NEWTON


148 
mš
->
	`fš
();

149 
mš
->
ff
=
NULL
;

150 
mš
->
©oms
=
NULL
;

151 
d–‘e
 
mš
;

152 
mš
=
NULL
;

153 
d–‘e
 
ls
;

154 
ls
=
NULL
;

156 
dyÇmic
->
	`fš
();

157 
d–‘e
 
dyÇmic
;

159 
dyÇmic
=
NULL
;

160 
	}
}

164 
ty³0
 
	gDAE
::
	$ÿlc_”r
()

166 if(!
chng_box
è 
ff
->
”r
/
sq¹_nx_ÇÍha_nS_dof
;

167 
ty³0
 
”r_sq
=0.0;

168 
	`ty³0
 (&
S_ã
)[
__dim__
][__dim__]=
©oms
->S_fe;

169 
Algeb¿
::
DoLT
<
__dim__
>::
	`func
([&
S_ã
,&
”r_sq
,
this
](
i
,
j
)

170 {if(!
¡d
::
	`i¢ª
(
S
[
i
][
j
])è
”r_sq
+=(S[i][j]-
S_ã
[i][j])*(S[i][j]-S_fe[i][j]);});

171 
”r_sq
*=(
©oms
->
vŞ
)*(atoms->vol);

172 
”r_sq
+=(
ff
->
”r
)*(ff->err);

173  
	`sq¹
(
”r_sq
)/
sq¹_nx_ÇÍha_nS_dof
;

174 
	}
}

178 
	gDAE
::
	$mš_”rÜ_Œue
()

180 #ifdeà
MINCG_W_NEWTON


181 
__¡•
=
©oms
->
¡•
;

182 
mš
->
	`run
(10000);

183 
©oms
->
¡•
=
__¡•
;

186 
VecT’s
<
ty³0
,2> 
	`x
(
©oms
,
Œue
,©oms->
H
,©oms->
x
,©oms->
®pha
);

187 
VecT’s
<
ty³0
,2> 
	`f
(
©oms
,
Œue
,
ff
->
F_H
,ff->
f
,ff->
f_®pha
);

188 
VecT’s
<
ty³0
,2> 
	`h
(
©oms
,
Œue
,
__dim__
,
c_dim
);

190 #iâdeà
NEW_UPDTAE


191 
vec
* 
uvecs
[2];

192 
uvecs
[0]=
©oms
->
x
;

193 
uvecs
[1]=
©oms
->
®pha
;

195 
ty³0
 
nÜm
,
»s
,
»s_sq
;

197 
__GMRES__
<
VecT’s
<
ty³0
,2>> 
	`gm»s
(
max_ngm»s_™”s
,
©oms
,
Œue
,
__dim__
,
c_dim
);

227 autØ
J
=[
this
](
VecT’s
<
ty³0
,2>& 
dx
,VecT’s<ty³0,2>& 
Jdx
)->

229 #ifdeà
OLD_UPDATE


230 
dyÇmic
->
	`upd©e
(
dx
.
vecs
[0]);

231 
dyÇmic
->
	`upd©e
(
dx
.
vecs
[1]);

233 
dyÇmic
->
	`upd©e
(
dx
.
vecs
[0],dx.vecs[1]);

235 cÚ¡ 
n
=
©oms
->
Çtms_lş
+©oms->
Çtms_ph
;

236 
ty³0
* 
__dx
=
dx
.
vecs
[0]->
	`begš
();

237 
ty³0
* 
__x
=
©oms
->
x
->
	`begš
();

238 
i
=0;i<
n
;i++,
__dx
+=
__dim__
,
__x
+=__dim__)

239 
Algeb¿
::
	`V_mul_MLT_add_š
(
__x
,
dx
.
A
,
__dx
);

242 
ty³0
* 
__vec
=
ff
->
	`J
(
dx
.
vecs
[0],dx.vecs[1],
Jdx
.vecs[0],Jdx.vecs[1]);

243 
Algeb¿
::
	`DyadicV_2_MLT
(
__vec
,
Jdx
.
A
);

245 
ty³0
 
dlog_vŞ
=0.0;

246 
	`ty³0
 (&
H
)[
__dim__
][__dim__]=
©oms
->H;

248 
Algeb¿
::
Do
<
__dim__
>::
	`func
([&
H
,&
dx
,&
dlog_vŞ
](
i
)

250 
dlog_vŞ
+=
dx
.
A
[
i
][i];

253 
ty³0
 
tmp
=
dlog_vŞ
*
©oms
->
vŞ
;

254 
Algeb¿
::
DoLT
<
__dim__
>::
	`func
([&
Jdx
,&
tmp
,
this
](
i
,
j
)

256 if(!
S_dof
[
i
][
j
]è
Jdx
.
A
[i][j]=0.0;

257 
Jdx
.
A
[
i
][
j
]-=
S
[i][j]*
tmp
;

261 
»s_sq
=
ff
->
	`´•J_n_»s
(
f
.
vecs
[0],f.vecs[1]);

262 
ty³0
 
vŞ_Ãg
=-
©oms
->
vŞ
;

263 
Algeb¿
::
DoLT
<
__dim__
>::
	`func
([&
»s_sq
,&
f
,
this
,&
vŞ_Ãg
](
i
,
j
)

265 if(!
¡d
::
	`i¢ª
(
S
[
i
][
j
]))

267 
f
.
A
[
i
][
j
]=
ff
->
F_H
[i][j]-
S
[i][j]*
vŞ_Ãg
;

268 
»s_sq
+=
f
.
A
[
i
][
j
]*f.A[i][j];

271 
f
.
A
[
i
][
j
]=0.0;

275 
»s
=
	`sq¹
(
»s_sq
);

277 
ty³0
 
r
;

278 
i¡•
=0;

279 ;
i¡•
<
max_ÂewtÚ_™”s
 && 
»s
/
a_tŞ_sq¹_nx_ÇÍha_nS_dof
>1.0;istep++)

281 
gm»s
.
	`sŞve
(
J
,
f
,0.005*
a_tŞ_sq¹_nx_ÇÍha_nS_dof
,
nÜm
,
h
);

283 cÚ¡ 
n0
=
©oms
->
Çtms_lş
;

284 
ty³0
* 
__x
=
©oms
->
x
->
	`begš
();

285 
ty³0
* 
__dx
=
h
.
vecs
[0]->
	`begš
();

286 
i
=0;i<
n0
;i++,
__dx
+=
__dim__
,
__x
+=__dim__)

287 
Algeb¿
::
	`V_mul_MLT_add_š
(
__x
,
h
.
A
,
__dx
);

288 
Algeb¿
::
	`MLT_mul_MLT
(
©oms
->
H
,
h
.
A
,h.A);

290 cÚ¡ 
n
=
©oms
->
Çtms_lş
*
c_dim
;

291 
ty³0
* 
®pha_vec
=
©oms
->
®pha
->
	`begš
();

292 
ty³0
* 
h®pha_vec
=
h
.
vecs
[1]->
	`begš
();

293 
ty³0
 
r_lş
=1.0,
tmp
;

294 
i
=0;i<
n
;i++)

296 
tmp
=
®pha_vec
[
i
]+
r_lş
*
h®pha_vec
[i];

297 if(
tmp
<0.0)

299 
r_lş
=-
®pha_vec
[
i
]/
h®pha_vec
[i];

300 
®pha_vec
[
i
]+
r_lş
*
h®pha_vec
[i]<=0.0)

301 
r_lş
=
	`Ãxá”
(r_lcl,0.0);

304 
	`MPI_AÎ»duû
(&
r_lş
,&
r
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_MIN
,
©oms
->
wÜld
);

306 if(
r
==1.0)

307 
x
+=
h
;

310 
r
*=0.5;

311 
x
+=
r
*
h
;

313 
ty³0
 
max_®pha_lş
=0.0;

316 
ty³0
* 
c_vec
=
©oms
->
c
->
	`begš
();

317 
i
=0;i<
n
;i++)

318 if(
c_vec
[
i
]>=0.0è
max_®pha_lş
=
	`MAX
(max_®pha_lş,
®pha_vec
[i]);

319 
	`MPI_AÎ»duû
(&
max_®pha_lş
,&
©oms
->
max_®pha
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_MAX
,©oms->
wÜld
);

321 
©oms
->
	`upd©e_H
();

322 #ifdeà
OLD_UPDATE


323 
dyÇmic
->
	`upd©e
(
uvecs
,2);

325 
dyÇmic
->
upd©e
<
Œue
,true>();

329 
»s_sq
=
ff
->
	`´•J_n_»s
(
f
.
vecs
[0],f.vecs[1]);

330 
ty³0
 
vŞ_Ãg
=-
©oms
->
vŞ
;

332 
Algeb¿
::
DoLT
<
__dim__
>::
	`func
([&
»s_sq
,&
f
,
this
,&
vŞ_Ãg
](
i
,
j
)

334 if(!
¡d
::
	`i¢ª
(
S
[
i
][
j
]))

336 
f
.
A
[
i
][
j
]=
ff
->
F_H
[i][j]-
S
[i][j]*
vŞ_Ãg
;

337 
»s_sq
+=
f
.
A
[
i
][
j
]*f.A[i][j];

340 
f
.
A
[
i
][
j
]=0.0;

343 
»s
=
	`sq¹
(
»s_sq
);

346 if(
i¡•
è
Ã¼_mšs
++;

347 
	}
}

351 
	gDAE
::
	$mš_”rÜ_çl£
()

353 #ifdeà
MINCG_W_NEWTON


354 
__¡•
=
©oms
->
¡•
;

355 
mš
->
	`run
(10000);

356 
©oms
->
¡•
=
__¡•
;

359 
VecT’s
<
ty³0
,2> 
	`x
(
©oms
,
çl£
,©oms->
H
,©oms->
x
,©oms->
®pha
);

360 
VecT’s
<
ty³0
,2> 
	`f
(
©oms
,
çl£
,
ff
->
F_H
,ff->
f
,ff->
f_®pha
);

361 
VecT’s
<
ty³0
,2> 
	`h
(
©oms
,
çl£
,
__dim__
,
c_dim
);

363 #iâdeà
NEW_UPDTAE


364 
vec
* 
uvecs
[2];

365 
uvecs
[0]=
©oms
->
x
;

366 
uvecs
[1]=
©oms
->
®pha
;

368 
ty³0
 
nÜm
,
»s
,
»s_sq
;

370 
__GMRES__
<
VecT’s
<
ty³0
,2>> 
	`gm»s
(
max_ngm»s_™”s
,
©oms
,
çl£
,
__dim__
,
c_dim
);

371 autØ
J
=[
this
](
VecT’s
<
ty³0
,2>& 
x
,VecT’s<ty³0,2>& 
Jx
)->

373 #ifdeà
OLD_UPDATE


374 
dyÇmic
->
	`upd©e
(
x
.
vecs
[0]);

375 
dyÇmic
->
	`upd©e
(
x
.
vecs
[1]);

377 
dyÇmic
->
	`upd©e
(
x
.
vecs
[0],x.vecs[1]);

380 
ff
->
	`J
(
x
.
vecs
[0],x.vecs[1],
Jx
.vecs[0],Jx.vecs[1]);

384 
»s_sq
=
ff
->
	`´•J_n_»s
(
f
.
vecs
[0],f.vecs[1]);

385 
»s
=
	`sq¹
(
»s_sq
);

387 
ty³0
 
r
;

388 
i¡•
=0;

389 ;
i¡•
<
max_ÂewtÚ_™”s
 && 
»s
/
a_tŞ_sq¹_nx_ÇÍha_nS_dof
>1.0;istep++)

391 
gm»s
.
	`sŞve
(
J
,
f
,0.005*
a_tŞ_sq¹_nx_ÇÍha_nS_dof
,
nÜm
,
h
);

394 cÚ¡ 
n
=
©oms
->
Çtms_lş
*
c_dim
;

395 
ty³0
* 
®pha_vec
=
©oms
->
®pha
->
	`begš
();

396 
ty³0
* 
h®pha_vec
=
h
.
vecs
[1]->
	`begš
();

397 
ty³0
 
r_lş
=1.0,
tmp
;

398 
i
=0;i<
n
;i++)

400 
tmp
=
®pha_vec
[
i
]+
r_lş
*
h®pha_vec
[i];

401 if(
tmp
<0.0)

403 
r_lş
=-
®pha_vec
[
i
]/
h®pha_vec
[i];

404 
®pha_vec
[
i
]+
r_lş
*
h®pha_vec
[i]<=0.0)

405 
r_lş
=
	`Ãxá”
(r_lcl,0.0);

408 
	`MPI_AÎ»duû
(&
r_lş
,&
r
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_MIN
,
©oms
->
wÜld
);

410 if(
r
==1.0)

411 
x
+=
h
;

414 
r
*=0.5;

415 
x
+=
r
*
h
;

417 
ty³0
 
max_®pha_lş
=0.0;

420 
ty³0
* 
c_vec
=
©oms
->
c
->
	`begš
();

421 
i
=0;i<
n
;i++)

422 if(
c_vec
[
i
]>=0.0è
max_®pha_lş
=
	`MAX
(max_®pha_lş,
®pha_vec
[i]);

423 
	`MPI_AÎ»duû
(&
max_®pha_lş
,&
©oms
->
max_®pha
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_MAX
,©oms->
wÜld
);

425 #ifdeà
OLD_UPDATE


426 
dyÇmic
->
	`upd©e
(
uvecs
,2);

428 
dyÇmic
->
upd©e
<
Œue
,true>();

432 
»s_sq
=
ff
->
	`´•J_n_»s
(
f
.
vecs
[0],f.vecs[1]);

433 
»s
=
	`sq¹
(
»s_sq
);

436 if(
i¡•
è
Ã¼_mšs
++;

437 
	}
}

441 
PyObjeù
* 
	gDAE
::
	$__Ãw__
(
PyTy³Objeù
* 
ty³
,
PyObjeù
* 
¬gs
,PyObjeù* 
kwds
)

443 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
ty³
->
	`_®loc
(type,0));

444 
PyObjeù
* 
£lf
=
»š‹½»t_ÿ¡
<PyObjeù*>(
__£lf
);

445  
£lf
;

446 
	}
}

450 
	gDAE
::
	$__š™__
(
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)

452 
FuncAPI
<> 
	`f
("__init__");

454 if(
	`f
(
¬gs
,
kwds
)==-1)  -1;

455 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

456 
__£lf
->
d«
=
Ãw
 
	`DAE
();

457 
__£lf
->
x´t
=
NULL
;

460 
	}
}

464 
PyObjeù
* 
	gDAE
::
	$__®loc__
(
PyTy³Objeù
* 
ty³
,
Py_ssize_t
)

466 
Objeù
* 
__£lf
=
Ãw
 Object;

467 
	`Py_TYPE
(
__£lf
)=
ty³
;

468 
	`Py_REFCNT
(
__£lf
)=1;

469 
__£lf
->
d«
=
NULL
;

470 
__£lf
->
x´t
=
NULL
;

471  
»š‹½»t_ÿ¡
<
PyObjeù
*>(
__£lf
);

472 
	}
}

476 
	gDAE
::
	$__d—Îoc__
(
PyObjeù
* 
£lf
)

478 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

479 
d–‘e
 
__£lf
->
d«
;

480 
__£lf
->
d«
=
NULL
;

481 if(
__£lf
->
x´t
è
	`Py_DECREF
(__self->xprt);

482 
__£lf
->
x´t
=
NULL
;

483 
d–‘e
 
__£lf
;

484 
	}
}

486 
PyTy³Objeù
 
	gDAE
::
Ty³Objeù
={
PyObjeù_HEAD_INIT
(
NULL
)};

488 
	gDAE
::
	$£tup_
()

490 
Ty³Objeù
.
_Çme
="mapp.dmd.dae";

491 
Ty³Objeù
.
_doc
="chemical integration";

493 
Ty³Objeù
.
_æags
=
Py_TPFLAGS_DEFAULT
;

494 
Ty³Objeù
.
_basicsize
=(
Objeù
);

496 
Ty³Objeù
.
_Ãw
=
__Ãw__
;

497 
Ty³Objeù
.
_š™
=
__š™__
;

498 
Ty³Objeù
.
_®loc
=
__®loc__
;

499 
Ty³Objeù
.
_d—Îoc
=
__d—Îoc__
;

500 
	`£tup__m‘hods
();

501 
Ty³Objeù
.
_m‘hods
=
m‘hods
;

502 
	`£tup__g‘£t
();

503 
Ty³Objeù
.
_g‘£t
=
g‘£t
;

505 
ichk
=
	`PyTy³_R—dy
(&
Ty³Objeù
);

506 if(
ichk
<0)  ichk;

507 
	`Py_INCREF
(&
Ty³Objeù
);

508  
ichk
;

510 
	}
}

512 
PyG‘S‘Def
 
	gDAE
::
g‘£t
[]=
Em±yPyG‘S‘Def
(8);

514 
	gDAE
::
	$£tup__g‘£t
()

516 
	`g‘£t_a_tŞ
(
g‘£t
[0]);

517 
	`g‘£t_max_n¡•s
(
g‘£t
[1]);

518 
	`g‘£t_mš_dt
(
g‘£t
[2]);

519 
	`g‘£t_Äe£t
(
g‘£t
[3]);

520 
	`g‘£t_Á®ly
(
g‘£t
[4]);

521 
	`g‘£t_S
(
g‘£t
[5]);

522 
	`g‘£t_expÜt
(
g‘£t
[6]);

523 
	}
}

525 
PyM‘hodDef
 
	gDAE
::
m‘hods
[]=
Em±yPyM‘hodDef
(1);

527 
	gDAE
::
	$£tup__m‘hods
()

529 
	}
}

533 
DAE
::
	$g‘£t_a_tŞ
(
PyG‘S‘Def
& 
g‘£t
)

535 
g‘£t
.
Çme
=(*)"a_tol";

536 
g‘£t
.
doc
=(*)
R
"---(

537 (è
LTE
 
tŞ”ªû


539 
AbsŞu‹
 
”rÜ
 
tŞ”’û
 
š
 
loÿl
 
ŒuÿtiÚ
ƒrror

541 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

543  
v¬
<
ty³0
>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
d«
->
a_tŞ
);

545 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

547 
V¬API
<
ty³0
> 
	`a_tŞ
("a_tol");

548 
a_tŞ
.
logics
[0]=
	`VLogics
("gt",0.0)*VLogics("lt",1.0);

549 
ichk
=
a_tŞ
.
	`£t
(
İ
);

550 if(
ichk
==-1)  -1;

551 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
d«
->
a_tŞ
÷_tŞ.
v®
;

554 
	}
}

558 
	gDAE
::
	$g‘£t_max_n¡•s
(
PyG‘S‘Def
& 
g‘£t
)

560 
g‘£t
.
Çme
=(*)"max_nsteps";

561 
g‘£t
.
doc
=(*)
R
"---(

562 (è
maximum
 
numb”
 
of
 
¡•s


564 
Maximum
 
numb”
 
of
 
¡•s
 
to
 
ach›ve
 
’”gy
 
mšimiz©iÚ


566 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

568  
v¬
<>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
d«
->
max_n¡•s
);

570 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

572 
V¬API
<> 
	`max_n¡•s
("max_nsteps");

573 
max_n¡•s
.
logics
[0]=
	`VLogics
("ge",0);

574 
ichk
=
max_n¡•s
.
	`£t
(
İ
);

575 if(
ichk
==-1)  -1;

576 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
d«
->
max_n¡•s
=max_n¡•s.
v®
;

579 
	}
}

583 
	gDAE
::
	$g‘£t_mš_dt
(
PyG‘S‘Def
& 
g‘£t
)

585 
g‘£t
.
Çme
=(*)"min_dt";

586 
g‘£t
.
doc
=(*)
R
"---(

587 (è
mšimum
 
time
 
¡•


589 
Mšimum
 
time
 
¡•


591 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

593  
v¬
<
ty³0
>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
d«
->
mš_dt
);

595 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

597 
V¬API
<
ty³0
> 
	`mš_dt
("min_dt");

598 
mš_dt
.
logics
[0]=
	`VLogics
("gt",0.0);

599 
ichk
=
mš_dt
.
	`£t
(
İ
);

600 if(
ichk
==-1)  -1;

601 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
d«
->
mš_dt
=mš_dt.
v®
;

604 
	}
}

608 
	gDAE
::
	$g‘£t_Äe£t
(
PyG‘S‘Def
& 
g‘£t
)

610 
g‘£t
.
Çme
=(*)"nreset";

611 
g‘£t
.
doc
=(*)
R
"---(

612 (è
cÚfigu¿tiÚ
 
»£t
 
³riod


614 
Numb”
 
of
 
¡•s
 
to
 
»£t
 
ªd
 
»adju¡
. 
If
 
£t
Ø0 
no
 
»adju¡m’t
 
wl
 
occur


616 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

618 
n™”s
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
d«
->
Äe£t
;

619  
v¬
<>::
	`bud
(
n™”s
,
NULL
);

621 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

623 
V¬API
<> 
	`Äe£t
("nreset");

624 
Äe£t
.
logics
[0]=
	`VLogics
("ge",0);

625 
ichk
=
Äe£t
.
	`£t
(
İ
);

626 if(
ichk
==-1)  -1;

627 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
d«
->
Äe£t
ò»£t.
v®
;

630 
	}
}

634 
	gDAE
::
	$g‘£t_Á®ly
(
PyG‘S‘Def
& 
g‘£t
)

636 
g‘£t
.
Çme
=(*)"ntally";

637 
g‘£t
.
doc
=(*)
R
"---(

638 (è
th”modyÇmic
 
Îyšg
 
³riod


640 
Numb”
 
of
 
¡•s
 
to
 
be
 
k’
 
äom
 
Úe
 
th”modyÇmics
 
ouut
Ø
the
 
Ãxt
.

642 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

644  
v¬
<>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
d«
->
Á®ly
);

646 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

648 
V¬API
<> 
	`Á®ly
("ntally");

649 
Á®ly
.
logics
[0]=
	`VLogics
("ge",0);

650 
ichk
=
Á®ly
.
	`£t
(
İ
);

651 if(
ichk
==-1)  -1;

652 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
d«
->
Á®ly
òÎy.
v®
;

655 
	}
}

659 
	gDAE
::
	$g‘£t_S
(
PyG‘S‘Def
& 
g‘£t
)

661 
g‘£t
.
Çme
=(*)"S";

662 
g‘£t
.
doc
=(*)
R
"---(

663 (
symm
<[
dim
][dim]>è
ex‹º®
 
¡»ss
 
‹nsÜ


665 
Ex‹º®
 
¡»ss
 
impo£d
 
Ú
 
sy¡em
, 
h”e
 
dim
 
is
 
the
 
dim’siÚ
 
of
 
simuÏtiÚ


667 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

669  
v¬
<
symm
<
ty³0
[
__dim__
][__dim__]>>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
d«
->
S
);

671 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

673 
V¬API
<
symm
<
ty³0
[
__dim__
][__dim__]>> 
	`S
("S");

674 
ichk
=
S
.
	`£t
(
İ
);

675 if(
ichk
==-1)  -1;

677 
	`boŞ
 (&
__S_dof
)[
__dim__
][__dim__]=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
d«
->
S_dof
;

678 
	`ty³0
 (&
__S
)[
__dim__
][__dim__]=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
d«
->
S
;

679 
boŞ
& 
__chng_box
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
d«
->
chng_box
;

680 
__chng_box
=
çl£
;

681 
Algeb¿
::
DoLT
<
__dim__
>::
	`func
([&
__S_dof
,&
__S
,&
__chng_box
,&
S
](
i
,
j
)

684 if(
¡d
::
	`i¢ª
(
S
.
v®
[
i
][
j
]))

686 
__S
[
i
][
j
]=__S[j][i]=
NAN
;

687 
__S_dof
[
i
][
j
]=__S_dof[j][i]=
çl£
;

691 
__S
[
i
][
j
]=__S[j][i]=
S
.
v®
[i][j];

692 
__S_dof
[
i
][
j
]=__S_dof[j][i]=
Œue
;

693 
__chng_box
=
Œue
;

699 
	}
}

703 
	gDAE
::
	$g‘£t_expÜt
(
PyG‘S‘Def
& 
g‘£t
)

705 
g‘£t
.
Çme
=(*)"export";

706 
g‘£t
.
doc
=(*)
R
"---(

707 (
m­p
.
dmd
.
expÜt
èexpÜˆ
objeù


709 
ExpÜt
 
objeù
 
to
 
»cÜd
 
the
 
¢­shÙs
 
of
h
sy¡em
 
mšimizšg


711 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

713 
ExpÜtDMD
::
Objeù
* 
x´t
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
)->xprt;

714 if(!
x´t
è
Py_RETURN_NONE
;

715 
	`Py_INCREF
(
x´t
);

716  
»š‹½»t_ÿ¡
<
PyObjeù
*>(
x´t
);

718 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

720 
V¬API
<
OP
<
ExpÜtDMD
>> 
	`x´t
("export");

721 
ichk
=
x´t
.
	`£t
(
İ
);

722 if(
ichk
==-1)  -1;

723 if(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
x´t
è
	`Py_DECREF
(reinterpret_cast<Object*>(self)->xprt);

724 
	`Py_INCREF
(
x´t
.
v®
.
ob
);

725 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
x´t
ôeš‹½»t_ÿ¡<
ExpÜtDMD
::Objeù*>(x´t.
v®
.
ob
);

728 
	}
}

732 
	gDAE
::
	$ml_run
(
PyM‘hodDef
& 
_m‘hods
)

734 
_m‘hods
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

735 
_m‘hods
.
ml_Çme
="run";

736 
_m‘hods
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

737 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

739 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

740 
FuncAPI
<
OP
<
AtomsDMD
>,
ty³0
> 
	`f
("run",{"atoms","t"});

741 
f
.
logics
<1>()[0]=
	`VLogics
("ge",0.0);

742 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

744 
AtomsDMD
* 
__©oms
=
»š‹½»t_ÿ¡
<AtomsDMD::
Objeù
*>(
f
.
v®
<0>().
ob
)->
©oms
;

745 
FÜûF›ldDMD
* 
__ff
=
»š‹½»t_ÿ¡
<
AtomsDMD
::
Objeù
*>(
f
.
v®
<0>().
ob
)->
ff
;

746 
ExpÜtDMD
* 
__x´t
=
__£lf
->
x´t
==
NULL
 ? NULL:__self->xprt->xprt;

747 
Œy


749 
__£lf
->
d«
->
	`´e_run_chk
(
__©oms
,
__ff
);

751 
	`ÿtch
(
¡d
::
¡ršg
& 
”r_msg
)

753 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,
”r_msg
.
	`c_¡r
());

754  
NULL
;

757 
__£lf
->
d«
->
©oms
=
__©oms
;

758 
__£lf
->
d«
->
ff
=
__ff
;

759 
__£lf
->
d«
->
x´t
=
__x´t
;

761 
Œy


763 
__£lf
->
d«
->
	`š™
();

765 
	`ÿtch
(
¡d
::
¡ršg
& 
”r_msg
)

767 
__£lf
->
d«
->
x´t
=
NULL
;

768 
__£lf
->
d«
->
ff
=
NULL
;

769 
__£lf
->
d«
->
©oms
=
NULL
;

770 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,
”r_msg
.
	`c_¡r
());

771  
NULL
;

776 
__£lf
->
d«
->
	`run
(
f
.
v®
<1>());

779 
__£lf
->
d«
->
	`fš
();

781 
__£lf
->
d«
->
x´t
=
NULL
;

782 
__£lf
->
d«
->
ff
=
NULL
;

783 
__£lf
->
d«
->
©oms
=
NULL
;

785 
Py_RETURN_NONE
;

788 
_m‘hods
.
ml_doc
=(*)
R
"---(

789 
	`run
(
©oms
,
t
)

791 
Execu‹
 
DEA


793 
This
 
m‘hod
 
¡¬ts
 
difã»ÁŸl
-
®geb¿ic
 
equ©iÚs
 
a
 
giv’
 
©oms
 
objeù
 
ªd
 
numb”
 
of
 
time
.

795 
P¬am‘”s


797 
©oms
 : 
m­p
.
dmd
.atoms

798 
Sy¡em
 
of
 
š‹»¡


799 
t
 : 

800 
Desœed
 
time


802 
R‘uºs


804 
NÚe


807 
	}
}

811 
	~<io¡»am
>

812 
	~"¿ndom.h
"

813 
	~"ff_—m_dmd.h
"

	@dae.h

1 #iâdeà
__MAPP__d«__


2 
	#__MAPP__d«__


	)

3 
	~"­i.h
"

4 
	~"expÜt_¡yËs.h
"

5 
	~"mš_vec.h
"

6 
Çme¥aû
 
	gMAPP_NS


8 
	g‹m¶©e
<
	gty³Çme
> 
şass
 
	gVec
;

9 şas 
	cDAE


11 
	g´iv©e
:

12 
´Ùeùed
:

13 
ty³0
 
a_tŞ_sq¹_nc_dof
,
	ga_tŞ_sq¹_nx_ÇÍha_nS_dof
,
	gsq¹_nx_ÇÍha_nS_dof
;

14 
´e_run_chk
(
şass
 
AtomsDMD
*,şas 
FÜûF›ldDMD
*);

15 
ty³0
 
ÿlc_”r
();

16 
	gc_dim
;

17 
	gncs
;

18 
	gÃ¼_mšs
;

20 
boŞ
 
	gchng_box
;

21 
boŞ
 
	gS_dof
[
__dim__
][__dim__];

22 
ty³0
 
	gS
[
__dim__
][__dim__];

24 
şass
 
AtomsDMD
* 
	g©oms
;

25 
şass
 
FÜûF›ldDMD
* 
	gff
;

26 
şass
 
ExpÜtDMD
* 
	gx´t
;

27 
şass
 
DyÇmicDMD
* 
	gdyÇmic
;

28 #ifdeà
MINCG_W_NEWTON


29 
şass
 
LšeS—rchB»Á
* 
	gls
;

30 
şass
 
MšCGDMD
* 
	gmš
;

32 
	gpublic
:

33 
max_ÂewtÚ_™”s
;

34 
	gmax_ngm»s_™”s
;

36 
	gÁ®ly
;

37 
	gÄe£t
;

38 
	gmax_n¡•s
;

40 
ty³0
 
	ga_tŞ
;

41 
ty³0
 
	gmš_dt
;

43 
ty³0
 
	gdt
;

44 
ty³0
 
	gt_cur
;

45 
ty³0
 
	gt_fš
;

46 
ty³0
 
	g”r
;

48 
ty³0
* 
	gc
;

49 
ty³0
* 
	gc_d
;

53 
DAE
();

54 
	gvœtu®
 ~
DAE
();

55 
vœtu®
 
š™_¡©ic
();

56 
vœtu®
 
fš_¡©ic
();

57 
vœtu®
 
run
(
ty³0
){};

58 
mš_”rÜ_Œue
();

59 
mš_”rÜ_çl£
();

61 
vœtu®
 
š™
();

62 
vœtu®
 
fš
();

67 
PyObjeù_HEAD


68 
DAE
* 
	gd«
;

69 
	gExpÜtDMD
::
Objeù
* 
x´t
;

70 }
	tObjeù
;

73 
PyTy³Objeù
 
	gTy³Objeù
;

74 
PyObjeù
* 
__Ãw__
(
PyTy³Objeù
*,PyObject*, PyObject*);

75 
__š™__
(
PyObjeù
*, PyObject*,PyObject*);

76 
PyObjeù
* 
__®loc__
(
PyTy³Objeù
*,
Py_ssize_t
);

77 
__d—Îoc__
(
PyObjeù
*);

79 
PyM‘hodDef
 
	gm‘hods
[];

80 
£tup__m‘hods
();

81 
ml_run
(
PyM‘hodDef
&);

83 
PyG‘S‘Def
 
	gg‘£t
[];

84 
£tup__g‘£t
();

85 
g‘£t_S
(
PyG‘S‘Def
&);

86 
g‘£t_a_tŞ
(
PyG‘S‘Def
&);

87 
g‘£t_max_n¡•s
(
PyG‘S‘Def
&);

88 
g‘£t_mš_dt
(
PyG‘S‘Def
&);

89 
g‘£t_Äe£t
(
PyG‘S‘Def
&);

90 
g‘£t_Á®ly
(
PyG‘S‘Def
&);

91 
g‘£t_expÜt
(
PyG‘S‘Def
&);

93 
£tup_
();

	@dae_bdf.cpp

1 
	~"d«_bdf.h
"

2 
	~"©oms_dmd.h
"

3 
	~"ff_dmd.h
"

4 
	~"dyÇmic_dmd.h
"

5 
	~"ÃighbÜ_dmd.h
"

6 
	~"memÜy.h
"

7 
	~"th”mo_dyÇmics.h
"

8 
	~"MAPP.h
"

9 
	~<lim™s
>

10 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

14 
	gDAEBDF
::
	$DAEBDF
():

15 
	`DAEIm¶ic™
(),

16 
	`z
(
NULL
),

17 
	$dy
(
NULL
)

19 
Algeb¿
::
z”o
<
max_q
+1>(
t
);

20 
Algeb¿
::
z”o
<
max_q
+1>(
l
);

21 
Algeb¿
::
z”o
<(
max_q
+1)*(max_q+1)>(
A
[0]);

22 
Algeb¿
::
z”o
<(
max_q
+1)*(max_q+1)>(
A_b¬
[0]);

24 
i
=0;i<
max_q
+1;i++)

25 
A
[0][
i
]=A[i][i]=1.0;

27 
i
=2;i<
max_q
+1;i++)

28 
j
=1;j<
i
;j++)

29 
A
[
j
][
i
]=A[j][i-1]+A[j-1][i-1];

31 
	}
}

35 
	gDAEBDF
::~
	$DAEBDF
()

37 
d–‘e
 
dy
;

38 
d–‘e
 
z
;

39 
	}
}

43 
	gDAEBDF
::
	$š™_¡©ic
()

45 
DAEIm¶ic™
::
	`š™_¡©ic
();

46 
MemÜy
::
	`®loc
(
dy
,(
max_q
+2)*
ncs
);

47 
z
=
dy
+
ncs
;

49 
ff
->
	`d”iv©ive
();

50 
ff
->
ÃighbÜ
->
	`š™_¡©ic
();

51 
ff
->
ÃighbÜ
->
	`ü—‹_2nd_li¡
();

52 
ff
->
	`š™_¡©ic
();

53 
	}
}

57 
	gDAEBDF
::
	$fš_¡©ic
()

60 
ff
->
	`fš_¡©ic
();

61 
ff
->
ÃighbÜ
->
	`fš_¡©ic
();

62 
MemÜy
::
	`d—Îoc
(
dy
);

63 
z
=
NULL
;

64 
DAEIm¶ic™
::
	`fš_¡©ic
();

65 
	}
}

69 
	gDAEBDF
::
	$š™
()

71 
DAEIm¶ic™
::
	`š™
();

72 if(
x´t
)

74 
Œy


76 
x´t
->
©oms
=atoms;

77 
x´t
->
	`š™
();

79 
	`ÿtch
(
¡d
::
¡ršg
& 
”r_msg
)

81 
	`fš_¡©ic
();

82 
throw
 
”r_msg
;

86 
	}
}

90 
	gDAEBDF
::
	$fš
()

93 if(
x´t
)

95 
x´t
->
	`fš
();

96 
x´t
->
©oms
=
NULL
;

98 
DAEIm¶ic™
::
	`fš
();

99 
	}
}

103 
	gDAEBDF
::
	$run
(
ty³0
 
t_tÙ
)

105 
¡•
=
©oms
->step;

106 
Ãv”y_x´t
=
x´t
==
NULL
 ? 0:x´t->
Ãv”y
;

109 
t_cur
=0.0;

110 
t_fš
=
t_tÙ
;

114 
__max_q
=1;

115 
ty³0
 
__max_dt
=0.0,
__mš_dt
=
¡d
::
num”ic_lim™s
<ty³0>::
	`šfš™y
();

117 if(
Äe£t
è
chng_box
 ? 
	`mš_”rÜ_Œue
():
	`mš_”rÜ_çl£
();

118 
ty³0
 
ã_ave_”r
,
´ev_ã_ave_”r
;

119 
ã_ave_”r
=
´ev_ã_ave_”r
=
	`ÿlc_”r
();

121 
	`š™_¡©ic
();

122 
	`»£t
();

123 
ncÚ¡_q
=
ncÚ¡_dt
=
ÂÚlš_acc
=
ÂÚlš_»j
=
nš‹g_acc
=
nš‹g_»j
=
nšŞ_acc
=
nšŞ_»j
=0;

126 
Th”moDyÇmics
 
	`th”mo
(6,

127 "Time",
t_cur
,

128 "FE_AVE_ERR",
ã_ave_”r
,

129 "FE",
©oms
->
ã
,

130 "S[0][0]",
©oms
->
S_ã
[0][0],

131 "S[1][1]",
©oms
->
S_ã
[1][1],

132 "S[2][2]",
©oms
->
S_ã
[2][2],

133 "S[1][2]",
©oms
->
S_ã
[2][1],

134 "S[2][0]",
©oms
->
S_ã
[2][0],

135 "S[0][1]",
©oms
->
S_ã
[1][0]);

137 if(
Ãv”y_x´t
è
x´t
->
	`wr™e
(
¡•
);

139 if(
Á®ly
è
th”mo
.
	`š™
();

140 if(
Á®ly
è
th”mo
.
	`´št
(
¡•
);

142 
ty³0
 
dt_´ev
;

143 
q_´ev
;

144 
i¡•
=0;

145 ;
i¡•
<
max_n¡•s
 && 
t_cur
<
t_fš
;istep++)

147 
dt_´ev
=
dt
;

148 
q_´ev
=
q
;

152 !
	`š‹g¿‹
())

153 
	`š‹g¿‹_ç
();

155 
__max_q
=
	`MAX
(
q
,__max_q);

156 
__max_dt
=
	`MAX
(
dt
,__max_dt);

157 
__mš_dt
=
	`MIN
(
dt
,__min_dt);

160 if(
q_´ev
!=
q
è
ncÚ¡_q
=1;

161 
ncÚ¡_q
++;

163 if(
dt_´ev
!=
dt
è
ncÚ¡_dt
=1;

164 
ncÚ¡_dt
++;

168 
dt_´ev
=
dt
;

169 
q_´ev
=
q
;

170 
t_cur
+=
dt_´ev
;

171 
	`´•_fÜ_Ãxt
();

173 if(
dt_´ev
!=
dt
)

174 
ncÚ¡_dt
=0;

175 if(
q_´ev
!=
q
)

176 
ncÚ¡_q
=0;

177 
ã_ave_”r
=
	`ÿlc_”r
();

178 if(((
i¡•
+1)%
Äe£t
==0 && 
ã_ave_”r
/
a_tŞ
>1.0è|| fe_ave_”¸>2.0*
´ev_ã_ave_”r
)

180 
	`fš_¡©ic
();

181 
chng_box
 ? 
	`mš_”rÜ_Œue
():
	`mš_”rÜ_çl£
();

182 
ã_ave_”r
=
	`ÿlc_”r
();

183 
´ev_ã_ave_”r
=
ã_ave_”r
;

184 
	`š™_¡©ic
();

186 
	`»£t
();

187 
ncÚ¡_q
=
ncÚ¡_dt
=0;

190 if(
Á®ly
 && (
i¡•
+1)%ntally==0)

192 
ff
->
	`fÜû_ÿlc_¡©ic
();

193 
th”mo
.
	`´št
(
¡•
+
i¡•
+1);

196 if(
Ãv”y_x´t
 && (
i¡•
+1)%Ãv”y_x´t==0è
x´t
->
	`wr™e
(
¡•
+istep+1);

204 if(
Á®ly
 && 
i¡•
%ntally)

206 
ff
->
	`fÜû_ÿlc_¡©ic
();

207 
th”mo
.
	`´št
(
¡•
+
i¡•
);

210 if(
Äe£t
 && 
i¡•
%nreset)

212 
	`fš_¡©ic
();

213 
chng_box
 ? 
	`mš_”rÜ_Œue
():
	`mš_”rÜ_çl£
();

214 
	`š™_¡©ic
();

215 
	`»£t
();

216 
ncÚ¡_q
=
ncÚ¡_dt
=0;

219 if(
Ãv”y_x´t
 && 
i¡•
%Ãv”y_x´tè
x´t
->
	`wr™e
(
¡•
+istep);

221 if(
Á®ly
è
th”mo
.
	`fš
();

224 
	`fš_¡©ic
();

227 if(
Á®ly
)

229 
	`årštf
(
MAPP
::
m­p_out
,"nÚlš—¸equ©iÚs:\cû±ed = %d„ejeùed = %d\n",
ÂÚlš_acc
,
ÂÚlš_»j
);

230 
	`årštf
(
MAPP
::
m­p_out
,"š‹½Ş©iÚs:\t\cû³td = %d„ejeùed = %d\n",
nšŞ_acc
,
nšŞ_»j
);

231 
	`årštf
(
MAPP
::
m­p_out
,"š‹g¿tiÚs:\t\cû³td = %d„ejeùed = %d\n",
nš‹g_acc
,
nš‹g_»j
);

232 
	`årštf
(
MAPP
::
m­p_out
,"”rÜ mšimiz©iÚs:\t%d\n",
Ã¼_mšs
);

233 
	`årštf
(
MAPP
::
m­p_out
,"maximum ord”: %d\n",
__max_q
);

234 
	`årštf
(
MAPP
::
m­p_out
,"maximumime¡•: %e\n",
__max_dt
);

235 
	`årštf
(
MAPP
::
m­p_out
,"mšimumime¡•: %e\n",
__mš_dt
);

239 
©oms
->
¡•
+=
i¡•
;

240 
	}
}

244 
boŞ
 
	gDAEBDF
::
	$š‹g¿‹
()

246 
	`memıy
(
c_0
,
c
,
ncs
*(
ty³0
));

247 
Œue
)

255 if(!
	`š‹½Ş©e
())

257 
	`š‹½Ş©e_ç
();

270 if(!
	`ÃwtÚ
())

272 
	`ÃwtÚ_ç
();

292 
ty³0
 
nÜm_lş
=0.0,
nÜm
;

293 
i
=0;i<
ncs
;i++)

294 
nÜm_lş
+=(
c
[
i
]-
y_0
[i])*(c[i]-y_0[i]);

295 
	`MPI_AÎ»duû
(&
nÜm_lş
,&
nÜm
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
©oms
->
wÜld
);

296 
”r
=
”r_çc
*
	`sq¹
(
nÜm
)/
a_tŞ_sq¹_nc_dof
;

299 if(
”r
<1.0)

301 
nš‹g_acc
++;

302  
Œue
;

305 
	`memıy
(
c
,
c_0
,
ncs
*(
ty³0
));

306 
dyÇmic
->
	`upd©e
(
©oms
->
c
);

307 
nš‹g_»j
++;

308  
çl£
;

309 
	}
}

322 
boŞ
 
	gDAEBDF
::
	$š‹½Ş©e
()

324 
ty³0
 
__dt
;

325 
i
=0;i<
q
+1;i++)

327 
__dt
=1.0;

328 
j
=
i
;j<
q
+1;j++)

330 
A_b¬
[
i
][
j
]=
A
[i][j]*
__dt
;

331 
__dt
*=
dt
;

334 
”r_çc
=
VC_y
::
	`”r_çc_ÿlc
(
q
,
dt
,
t
,
lo_”r_çc
,
hi_”r_çc
,
b‘a
);

341 
boŞ
 
š_domaš
=
Œue
;

342 
q
)

344 1: 
š_domaš
=
DAEBDFM©h
::
š‹½Ş©e
<1>(
ncs
,
b‘a
,
A_b¬
[0],&A_b¬[1][1],
z
,
y_0
,
a
);

346 2: 
š_domaš
=
DAEBDFM©h
::
š‹½Ş©e
<2>(
ncs
,
b‘a
,
A_b¬
[0],&A_b¬[1][1],
z
,
y_0
,
a
);

348 3: 
š_domaš
=
DAEBDFM©h
::
š‹½Ş©e
<3>(
ncs
,
b‘a
,
A_b¬
[0],&A_b¬[1][1],
z
,
y_0
,
a
);

350 4: 
š_domaš
=
DAEBDFM©h
::
š‹½Ş©e
<4>(
ncs
,
b‘a
,
A_b¬
[0],&A_b¬[1][1],
z
,
y_0
,
a
);

352 : 
š_domaš
=
DAEBDFM©h
::
š‹½Ş©e
<
max_q
>(
ncs
,
b‘a
,
A_b¬
[0],&A_b¬[1][1],
z
,
y_0
,
a
);

355 
domaš_”r
,
domaš_”r_lş
=
š_domaš
 ? 0:1;

356 
	`MPI_AÎ»duû
(&
domaš_”r_lş
,&
domaš_”r
,1,
MPI_INT
,
MPI_MAX
,
©oms
->
wÜld
);

358 if(
domaš_”r
)

360 
nšŞ_»j
++;

361  
çl£
;

366 
nšŞ_acc
++;

367  
Œue
;

368 
	}
}

372 
	gDAEBDF
::
	$´•_fÜ_Ãxt
()

377 
ty³0
 
tmp
,
nÜm
,
iq
=
¡©ic_ÿ¡
<ty³0>(
q
);

378 
‘a
[1]=
	`pow
(0.5/
”r
,1.0/(
iq
+1.0));

379 
‘a
[0]=eta[2]=0.0;

381 if(
q
<
max_q
)

383 
ty³0
 
nÜm_lş
=0.0;

384 
i
=0;i<
ncs
;i++)

386 if(
c
[
i
]>=0.0)

388 
tmp
=
c
[
i
]-
y_0
[i]+
hi_”r_çc
[1]*
dy
[i];

389 
nÜm_lş
+=
tmp
*tmp;

393 
	`MPI_AÎ»duû
(&
nÜm_lş
,&
tmp
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
©oms
->
wÜld
);

394 
nÜm
=
hi_”r_çc
[0]*
	`sq¹
(
tmp
)/
a_tŞ_sq¹_nc_dof
;

395 
‘a
[2]=
	`pow
(0.5/
nÜm
,1.0/(
iq
+2.0));

398 if(
q
>1)

400 
ty³0
* 
__z
=
z
;

401 
ty³0
 
nÜm_lş
=0.0;

402 
i
=0;i<
ncs
;i++)

404 if(
c
[
i
]>=0.0)

406 
tmp
=
c
[
i
]-
y_0
[i]+
lo_”r_çc
[1]*
__z
[
q
];

407 
nÜm_lş
+=
tmp
*tmp;

410 
__z
+=
max_q
+1;

412 
	`MPI_AÎ»duû
(&
nÜm_lş
,&
tmp
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
©oms
->
wÜld
);

413 
nÜm
=
lo_”r_çc
[0]*
	`sq¹
(
tmp
)/
a_tŞ_sq¹_nc_dof
;

414 
‘a
[0]=
	`pow
(0.5/
nÜm
,1.0/(
iq
));

418 
i
=0;i<
ncs
;i++)

420 
dy
[
i
]=
c
[i]-
y_0
[i];

424 
ty³0
 
dt_r
=1.0;

425 
dq
=0;

428 if(
ncÚ¡_q
>2+
q
 && 
ncÚ¡_dt
>2+q)

430 if(
‘a
[0]>eta[1] &&ƒta[0]>eta[2])

432 
dq
=-1;

433 
dt_r
=
‘a
[0];

435 if(
‘a
[2]>eta[0] &&ƒta[2]>eta[1])

437 
dq
=1;

438 
dt_r
=
‘a
[2];

442 
dq
=0;

443 
dt_r
=
‘a
[1];

447 if(2.0<
dt_r
)

448 
dt_r
=2.0;

449 if(
dt_r
<=0.5)

450 
dt_r
=0.5;

452 
ty³0
 
Ãw_dt
;

453 if(
dt_r
*
dt
>
t_fš
-
t_cur
)

456 
Ãw_dt
=
t_fš
-
t_cur
;

460 if(
t_fš
-
t_cur
<=2.0*
mš_dt
)

461 
Ãw_dt
=2.0*
mš_dt
;

464 if(
dt_r
*
dt
<
mš_dt
)

465 
Ãw_dt
=
mš_dt
;

466 if(
dt_r
*
dt
>=
t_fš
-
t_cur
-
mš_dt
)

467 
Ãw_dt
=
t_fš
-
t_cur
-
mš_dt
;

469 
Ãw_dt
=
dt_r
*
dt
;

473 
	`upd©e_z
();

475 
i
=
max_q
;i>0;i--)

476 
t
[
i
]ñ[i-1]-
dt
;

478 
dt
=
Ãw_dt
;

479 
q
+=
dq
;

480 
	}
}

484 
	gDAEBDF
::
	$upd©e_z
()

486 
VC_y
::
	`´•_A_b¬_l
(
q
,
dt
,
t
,
dq
,
l
,
A_b¬
);

488 if(
dq
==1)

490 
q
)

492 1: 
DAEBDFM©h
::
upd©e_z_šc
<1>(
ncs
,
A_b¬
[0],
z
,
dy
,
l
);

494 2: 
DAEBDFM©h
::
upd©e_z_šc
<2>(
ncs
,
A_b¬
[0],
z
,
dy
,
l
);

496 3: 
DAEBDFM©h
::
upd©e_z_šc
<3>(
ncs
,
A_b¬
[0],
z
,
dy
,
l
);

498 4: 
DAEBDFM©h
::
upd©e_z_šc
<4>(
ncs
,
A_b¬
[0],
z
,
dy
,
l
);

500 : 
DAEBDFM©h
::
upd©e_z_šc
<
max_q
>(
ncs
,
A_b¬
[0],
z
,
dy
,
l
);

505 
q
+
dq
)

507 1: 
DAEBDFM©h
::
upd©e_z
<1>(
ncs
,
A_b¬
[0],
z
,
dy
,
l
);

509 2: 
DAEBDFM©h
::
upd©e_z
<2>(
ncs
,
A_b¬
[0],
z
,
dy
,
l
);

511 3: 
DAEBDFM©h
::
upd©e_z
<3>(
ncs
,
A_b¬
[0],
z
,
dy
,
l
);

513 4: 
DAEBDFM©h
::
upd©e_z
<4>(
ncs
,
A_b¬
[0],
z
,
dy
,
l
);

515 : 
DAEBDFM©h
::
upd©e_z
<
max_q
>(
ncs
,
A_b¬
[0],
z
,
dy
,
l
);

519 
	}
}

523 
	gDAEBDF
::
	$ÃwtÚ_ç
()

525 if(
t_fš
-
t_cur
<=2.0*
mš_dt
)

527 if(
q
>1)

528 
q
--;

536 if(
dt
==
mš_dt
)

538 if(
q
>1)

539 
q
--;

547 
ty³0
 
r
=0.25;

548 if(
r
*
dt
<
mš_dt
)

549 
dt
=
mš_dt
;

550 if(
r
*
dt
>
t_fš
-
t_cur
-
mš_dt
)

551 
dt
=
t_fš
-
t_cur
-
mš_dt
;

553 
dt
*=
r
;

557 
	`memıy
(
c
,
c_0
,
ncs
*(
ty³0
));

558 
dyÇmic
->
	`upd©e
(
©oms
->
c
);

559 
	}
}

563 
	gDAEBDF
::
	$»£t
()

565 autØ
g‘_max_dt
=[](
ty³0
 
x
,ty³0 
x_d
)->type0

568 if(
x_d
>0.0)

570 
ty³0
 
ªs
=(1.0-
x
)/
x_d
;

571 
x
+
x_d
*
ªs
>1.0)

572 
ªs
=
¡d
::
	`Ãxá”
(ans,-1.0);

573  
ªs
;

575 if(
x_d
<0.0)

577 
ty³0
 
ªs
=-
x
/
x_d
;

578 
x
+
x_d
*
ªs
<0.0)

579 
ªs
=
¡d
::
	`Ãxá”
(ans,-1.0);

580  
ªs
;

583  
¡d
::
num”ic_lim™s
<
ty³0
>::
	`šfš™y
();

587 
ty³0
 
nÜm
=
ff
->
	`c_dd_nÜm
()/
a_tŞ_sq¹_nc_dof
;

588 
ty³0
 
max_dt_lş
=
¡d
::
num”ic_lim™s
<ty³0>::
	`šfš™y
();

589 
ty³0
* 
__z
=
z
;

590 
i
=0;i<
ncs
;i++,
__z
+=
max_q
+1)

592 if(
c
[
i
]>=0.0)

594 
max_dt_lş
=
	`MIN
(max_dt_lş,
	`g‘_max_dt
(
c
[
i
],
c_d
[i]));

595 
__z
[0]=
c
[
i
];

596 
__z
[1]=
c_d
[
i
];

599 
__z
[0]=__z[1]=0.0;

604 
ty³0
 
max_dt
;

605 
	`MPI_AÎ»duû
(&
max_dt_lş
,&
max_dt
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_MIN
,
©oms
->
wÜld
);

608 
q
=1;

609 
dt
=
	`MAX
(
	`MIN
(MIN(
	`sq¹
(2.0/
nÜm
),(
t_fš
-
t_cur
)*0.001),
max_dt
),
mš_dt
);

610 
Algeb¿
::
z”o
<
max_q
+1>(
t
);

611 
	`mem£t
(
dy
,0,
ncs
*(
ty³0
));

612 
	}
}

616 
	gDAEBDF
::
	$š‹½Ş©e_ç
()

618 
	`»£t
();

619 
	}
}

623 
	gDAEBDF
::
	$š‹g¿‹_ç
()

625 if(
t_fš
-
t_cur
<=2.0*
mš_dt
)

627 if(
q
>1)

628 
q
--;

636 if(
dt
==
mš_dt
)

638 if(
q
>1)

639 
q
--;

647 
ty³0
 
r
=
	`pow
(0.5/
”r
,1.0/
¡©ic_ÿ¡
<ty³0>(
q
+1));

652 if(
r
*
dt
<
mš_dt
)

653 
dt
=
mš_dt
;

654 if(
r
*
dt
>
t_fš
-
t_cur
-
mš_dt
)

655 
dt
=
t_fš
-
t_cur
-
mš_dt
;

657 
dt
*=
r
;

660 
	}
}

664 
PyObjeù
* 
	gDAEBDF
::
	$__Ãw__
(
PyTy³Objeù
* 
ty³
,
PyObjeù
* 
¬gs
,PyObjeù* 
kwds
)

666 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
ty³
->
	`_®loc
(type,0));

667 
PyObjeù
* 
£lf
=
»š‹½»t_ÿ¡
<PyObjeù*>(
__£lf
);

668  
£lf
;

669 
	}
}

673 
	gDAEBDF
::
	$__š™__
(
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)

675 
FuncAPI
<> 
	`f
("__init__");

678 if(
	`f
(
¬gs
,
kwds
)==-1)  -1;

679 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

680 
__£lf
->
d«
=
Ãw
 
	`DAEBDF
();

681 
__£lf
->
x´t
=
NULL
;

684 
	}
}

688 
PyObjeù
* 
	gDAEBDF
::
	$__®loc__
(
PyTy³Objeù
* 
ty³
,
Py_ssize_t
)

690 
Objeù
* 
__£lf
=
Ãw
 Object;

691 
	`Py_TYPE
(
__£lf
)=
ty³
;

692 
	`Py_REFCNT
(
__£lf
)=1;

693 
__£lf
->
d«
=
NULL
;

694 
__£lf
->
x´t
=
NULL
;

695  
»š‹½»t_ÿ¡
<
PyObjeù
*>(
__£lf
);

696 
	}
}

700 
	gDAEBDF
::
	$__d—Îoc__
(
PyObjeù
* 
£lf
)

702 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

703 
d–‘e
 
__£lf
->
d«
;

704 
__£lf
->
d«
=
NULL
;

705 if(
__£lf
->
x´t
è
	`Py_DECREF
(__self->xprt);

706 
__£lf
->
x´t
=
NULL
;

707 
d–‘e
 
__£lf
;

708 
	}
}

710 
PyTy³Objeù
 
	gDAEBDF
::
Ty³Objeù
={
PyObjeù_HEAD_INIT
(
NULL
)};

712 
	gDAEBDF
::
	$£tup_
()

714 
Ty³Objeù
.
_Çme
="mapp.dmd.bdf";

715 
Ty³Objeù
.
_doc
=(*)
R
"---(

716 
	`__š™__
(
a_tŞ
=1.0e-8,
mš_dt
=1.0e-8,
max_ngm»s_™”s
=5,
max_ÂewtÚ_™”s
=5,
max_n¡•s
=10000)

718 
BDF
 
š‹g¿tÜ


720 
P¬am‘”s


722 
a_tŞ
 : 

723 
AbsŞu‹
 
”rÜ
 
tŞ”’û
 
š
 
loÿl
 
ŒuÿtiÚ
ƒrror

724 
mš_dt
 : 

725 
Mšimum
 
time
 
¡•


726 
max_ngm»s_™”s
 : 

727 
Maximum
 
numb”
 
of
 
™”©iÚs
 oà
lš—r
 
	`sŞv”
 (
GMRES
)

728 
max_ÂewtÚ_™”s
 : 

729 
Maximum
 
numb”
 
of
 
™”©iÚs
 oà
nÚlš—r
 
	`sŞv”
 (
ÃwtÚ
)

730 
max_n¡•s
 : 

731 
Maximum
 
numb”
 
of
 
¡•s
 
to
 
ach›ve
 
’”gy
 
mšimiz©iÚ


734 
Ty³Objeù
.
_æags
=
Py_TPFLAGS_DEFAULT
;

735 
Ty³Objeù
.
_basicsize
=(
Objeù
);

737 
Ty³Objeù
.
_Ãw
=
__Ãw__
;

738 
Ty³Objeù
.
_š™
=
__š™__
;

739 
Ty³Objeù
.
_®loc
=
__®loc__
;

740 
Ty³Objeù
.
_d—Îoc
=
__d—Îoc__
;

741 
	`£tup__m‘hods
();

742 
Ty³Objeù
.
_m‘hods
=
m‘hods
;

743 
	`£tup__g‘£t
();

744 
Ty³Objeù
.
_g‘£t
=
g‘£t
;

746 
ichk
=
	`PyTy³_R—dy
(&
Ty³Objeù
);

747 if(
ichk
<0)  ichk;

748 
	`Py_INCREF
(&
Ty³Objeù
);

749 
	`GET_WRAPPER_DOC
(
Ty³Objeù
,
__š™__
)=
NULL
;

750  
ichk
;

751 
	}
}

753 
PyG‘S‘Def
 
	gDAEBDF
::
g‘£t
[]=
Em±yPyG‘S‘Def
(10);

755 
	gDAEBDF
::
	$£tup__g‘£t
()

757 
	`g‘£t_a_tŞ
(
g‘£t
[0]);

758 
	`g‘£t_max_n¡•s
(
g‘£t
[1]);

759 
	`g‘£t_mš_dt
(
g‘£t
[2]);

760 
	`g‘£t_Äe£t
(
g‘£t
[3]);

761 
	`g‘£t_Á®ly
(
g‘£t
[4]);

762 
	`g‘£t_S
(
g‘£t
[5]);

763 
	`g‘£t_expÜt
(
g‘£t
[6]);

764 
	`g‘£t_max_ngm»s_™”s
(
g‘£t
[7]);

765 
	`g‘£t_max_ÂewtÚ_™”s
(
g‘£t
[8]);

767 
	}
}

769 
PyM‘hodDef
 
	gDAEBDF
::
m‘hods
[]=
Em±yPyM‘hodDef
(2);

771 
	gDAEBDF
::
	$£tup__m‘hods
()

773 
	`ml_run
(
m‘hods
[0]);

774 
	}
}

	@dae_bdf.h

1 #iâdeà
__MAPP__d«_bdf__


2 
	#__MAPP__d«_bdf__


	)

3 
	~"d«_imp.h
"

4 
Çme¥aû
 
	gMAPP_NS


6 
	g‹m¶©e
<
	gty³Çme
> 
şass
 
	gVec
;

7 şas 
	cDAEBDF
:
public
 
DAEIm¶ic™


9 
´iv©e
:

10 
´Ùeùed
:

11 
ÃwtÚ_ç
();

12 
	gpublic
:

14 
cÚ¡ex´
 
max_q
=5;

15 
	gq
;

16 
	gdq
;

18 
	gncÚ¡_q
;

19 
	gncÚ¡_dt
;

22 
ty³0
 
	g‘a
[3];

24 
ty³0
 
	glo_”r_çc
[2];

25 
ty³0
 
	ghi_”r_çc
[2];

28 
ty³0
 
	gt
[
max_q
+1];

29 
ty³0
 
	gl
[
max_q
+1];

31 
ty³0
 
	gA
[
max_q
+1][max_q+1];

32 
ty³0
 
	gA_b¬
[
max_q
+1][max_q+1];

34 
ty³0
* 
	gz
;

35 
ty³0
* 
	gdy
;

48 
DAEBDF
();

49 ~
DAEBDF
();

51 
š™_¡©ic
();

52 
fš_¡©ic
();

53 
š™
();

54 
fš
();

56 
run
(
ty³0
);

57 
boŞ
 
š‹g¿‹
();

58 
š‹g¿‹_ç
();

59 
boŞ
 
š‹½Ş©e
();

60 
š‹½Ş©e_ç
();

61 
upd©e_z
();

62 
´•_fÜ_Ãxt
();

63 
»£t
();

74 
PyObjeù_HEAD


75 
DAEBDF
* 
	gd«
;

76 
	gExpÜtDMD
::
Objeù
* 
x´t
;

77 }
	tObjeù
;

79 
PyTy³Objeù
 
	gTy³Objeù
;

80 
PyObjeù
* 
__Ãw__
(
PyTy³Objeù
*,PyObject*, PyObject*);

81 
__š™__
(
PyObjeù
*, PyObject*,PyObject*);

82 
PyObjeù
* 
__®loc__
(
PyTy³Objeù
*,
Py_ssize_t
);

83 
__d—Îoc__
(
PyObjeù
*);

86 
PyM‘hodDef
 
	gm‘hods
[];

87 
£tup__m‘hods
();

91 
PyG‘S‘Def
 
	gg‘£t
[];

92 
£tup__g‘£t
();

94 
£tup_
();

98 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

99 
	~"xm©h.h
"

103 
Çme¥aû
 
	gMAPP_NS


105 
Çme¥aû
 
	gDAEBDFM©h


108 
	g‹m¶©e
<cÚ¡ 
	gi
,cÚ¡ 
	gdim
>

109 şas 
	cA_z_y_l


111 
	gpublic
:

112 
‹m¶©e
<
şass
 
T
>

113 
šlše
 
func0
(
T
* 
RESTRICT
 
A
,T* RESTRICT 
z
,T 
dy
,T* RESTRICT 
l
)

115 *
	gz
=
Algeb¿
::
V_mul_V
<
i
>(
A
,z)+
dy
**
	gl
;

116 
	gA_z_y_l
<
	gi
-1,
	gdim
>::
func0
(
A
+
DAEBDF
::
max_q
+2,
z
+1,
dy
,
l
+1);

120 
	g‹m¶©e
<cÚ¡ 
	gdim
>

121 
şass
 
	gA_z_y_l
<1,
	gdim
>

123 
	gpublic
:

124 
‹m¶©e
<
şass
 
T
>

125 
šlše
 
func0
(
T
* 
RESTRICT
 
A
,T* RESTRICT 
z
,T 
dy
,T* RESTRICT 
l
)

127 *
	gz
=*
A
**
z
+
dy
**
l
;

137 
	g‹m¶©e
<cÚ¡ 
	gdim
>

138 
upd©e_z
(cÚ¡ 
n
,
ty³0
* 
RESTRICT
 
A
,ty³0* RESTRICT 
z
,ty³0* RESTRICT 
dy
,ty³0* RESTRICT 
l
)

140 
	gi
=0;i<
	gn
;i++)

142 
	gA_z_y_l
<
	gdim
+1,dim+1>::
func0
(
A
,
z
,
dy
[
i
],
l
);

143 
	gz
+=
DAEBDF
::
max_q
+1;

148 
	g‹m¶©e
<cÚ¡ 
	gdim
>

149 
upd©e_z_šc
(cÚ¡ 
n
,
ty³0
* 
RESTRICT
 
A
,ty³0* RESTRICT 
z
,ty³0* RESTRICT 
dy
,ty³0* RESTRICT 
l
)

151 
	gi
=0;i<
	gn
;i++)

153 
	gz
[
dim
+1]=
l
[dim+1]*
dy
[
i
];

154 
	gA_z_y_l
<
	gdim
+1,dim+1>::
func0
(
A
,
z
,
dy
[
i
],
l
);

155 
	gz
+=
DAEBDF
::
max_q
+1;

161 
	g‹m¶©e
<cÚ¡ 
	gdim
>

162 
boŞ
 
š‹½Ş©e
(cÚ¡ 
n
,cÚ¡ 
ty³0
 
b‘a
,cÚ¡y³0* 
RESTRICT
 
A0
,cÚ¡y³0* RESTRICT 
A1
,cÚ¡y³0* RESTRICT 
z
,ty³0* RESTRICT 
y_0
,ty³0* RESTRICT 
a
)

181 
ty³0
 
	gb‘a_šv
=1.0/
b‘a
;

182 
ty³0
 
	gy0
;

183 
	gi
=0;i<
	gn
;i++)

185 
	gy0
=
Algeb¿
::
V_mul_V
<
dim
+1>(
A0
,
	gz
);

186 if(
	gy0
<0.0 || y0>1.0è 
	gçl£
;

188 
	gy_0
[
i
]=
y0
;

189 
	ga
[
i
]=
Algeb¿
::
V_mul_V
<
dim
>(
A1
,
	gz
+1)-
y0
*
	gb‘a_šv
;

190 
	gz
+=
DAEBDF
::
max_q
+1;

193  
	gŒue
;

209 
šlše
 
l_ÿlc
(
q
,
ty³0
& 
dt
,ty³0 (&
t
)[
DAEBDF
::
max_q
+1],ty³0 (&
l
)[DAEBDF::max_q+1])

211 
l
[0]=1.0;

212 
	gi
=1;i<
	gq
+1;i++)

213 
	gl
[
i
]=0.0;

215 
ty³0
 
	gk0
;

217 
	gi
=0;i<
	gq
;i++)

219 
	gk0
=1.0/(
dt
-
t
[
i
]);

220 
	gj
=
i
+1;j>0;j--)

221 
	gl
[
j
]+=
k0
*
l
[j-1];

230 şas 
	cFLC_f


232 
	gpublic
:

233 
šlše
 
´•_A_b¬_l
(& 
q
,
ty³0
& 
dt
,ty³0 (&
t
)[
DAEBDF
::
max_q
+1],
dq
,ty³0 (&
l
)[DAEBDF::max_q+1],ty³0 (&
A_b¬
)[DAEBDF::max_q+1][DAEBDF::max_q+1])

235 if(
dq
==1)

237 
ty³0
 
k2
=0.0,
	giq
=0.0;

238 
	gi
=0;i<
	gq
;i++,
	giq
++)

239 
	gk2
+=1.0/(
dt
*(
iq
+1.0))-1.0/(dt-
t
[
i
]);

242 
	gDAEBDFM©h
::
l_ÿlc
(
q
,
dt
,
t
,
l
);

243 
	gl
[
q
+1]=0.0;

244 
	gi
=
q
+1;i>0;i--)

245 
	gl
[
i
]+=
k2
*
l
[i-1];

247 if(
	gdq
==-1)

249 
DAEBDFM©h
::
l_ÿlc
(
q
-2,
dt
,
t
,
l
);

250 
ty³0
 
	gp_q_2
=1.0;

251 
	gi
=0;i<
	gq
-2;i++)

252 
	gp_q_2
*=
dt
-
t
[
i
];

253 
	gi
=2;i<
	gq
;i++)

254 
	gA_b¬
[
i
][
q
]-=
p_q_2
*
l
[i-2];

257 
ty³0
 
	gk1
=0.0,
	giq
=0.0;

258 
	gi
=0;i<
	gq
-2;i++,
	giq
++)

259 
	gk1
+=1.0/(
dt
*(
iq
+1.0))-1.0/(dt-
t
[
i
]);

260 
	gk1
+=1.0/(
dt
*(
iq
+1.0))+1.0/(dt*(iq+2.0));

263 
	gl
[
q
-1]=0.0;

264 
	gi
=
q
-1;i>0;i--)

265 
	gl
[
i
]+=
k1
*
l
[i-1];

269 
	gDAEBDFM©h
::
l_ÿlc
(
q
-1,
dt
,
t
,
l
);

271 
ty³0
 
	gk0
=0.0,
	giq
=0.0;

272 
	gi
=0;i<
	gq
-1;i++,
	giq
++)

273 
	gk0
+=1.0/(
dt
*(
iq
+1.0))-1.0/(dt-
t
[
i
]);

274 
	gk0
+=1.0/(
dt
*(
iq
+1.0));

276 
	gl
[
q
]=0.0;

277 
	gi
=
q
;i>0;i--)

278 
	gl
[
i
]+=
k0
*
l
[i-1];

282 
šlše
 
ty³0
 
”r_çc_ÿlc
(& 
q
,ty³0& 
dt
,ty³0 (&
t
)[
DAEBDF
::
max_q
+1],ty³0 (&
lo_”r_çc
)[2],ty³0 (&
hi_”r_çc
)[2],ty³0& 
b‘a
)

284 
ty³0
 
	giq
=0.0;

285 
ty³0
 
	gb‘a_šv
=0.0;

286 
	gi
=0;i<
	gq
;i++,
	giq
++)

287 
	gb‘a_šv
+=1.0/(
iq
+1.0);

288 
	gb‘a_šv
/=
dt
;

289 
	gb‘a
=1.0/
b‘a_šv
;

291 
ty³0
 
	gu_q
=0.0,
	gs_b¬_q
=0.0;

292 
	giq
=0.0;

294 
	gi
=0;i<
	gq
;i++,
	giq
++)

296 
	gs_b¬_q
+=1.0/(
iq
+1.0);

297 
	gu_q
+=1.0/(
dt
-
t
[
i
]);

301 
	gu_q
*=
dt
;

303 
	gu_q
++;

304 
	gu_q
-=
s_b¬_q
;

306 
ty³0
 
	g”r_çc
=
çbs
(
u_q
/(
s_b¬_q
*(1.0+
iq
*u_q)));

308 if(
	gq
<
	gDAEBDF
::
max_q
)

310 
ty³0
 
r
=1.0;

311 
	gi
=1;i<
	gq
;i++)

312 
	gr
*=(
t
[
i
]-
dt
)/t[i];

313 
ty³0
 
	gu_p_q
=0.0;

314 
	gi
=0;i<
	gq
;i++)

315 
	gu_p_q
+=1.0/
t
[
i
+1];

317 
	gu_p_q
*=
t
[1];

318 
	gu_p_q
++;

319 
	gu_p_q
-=
s_b¬_q
;

321 
ty³0
 
	gtmp
=(1.0-
t
[
q
]/
dt
)*(
u_q
-1.0/(
iq
+1.0)+dt/(dt-t[q]));

322 
	gtmp
/=(1.0+
iq
*
u_q
)*(
s_b¬_q
+1.0/(iq+1.0))*(iq+2.0);

323 
	ghi_”r_çc
[0]=
çbs
(
tmp
);

324 
	ghi_”r_çc
[1]=-
dt
*dt*
r
*(1.0+
iq
*
u_q
)/(
t
[1]*t[
q
]*(1.0+iq*
u_p_q
));

327 if(
	gq
>1)

329 
ty³0
 
	gp_q
=1.0;

330 
	gi
=0;i<
	gq
;i++,
	giq
++)

331 
	gp_q
*=
dt
-
t
[
i
];

333 
ty³0
 
	gtmp
=
u_q
-
dt
/(dt-
t
[
q
-1])+1.0/
iq
;

334 
	gtmp
/=
s_b¬_q
-1.0/
iq
;

335 
	gtmp
/=1.0-
t
[
q
-1]/
dt
;

337 
	glo_”r_çc
[0]=
çbs
(
tmp
);

338 
	glo_”r_çc
[1]=
p_q
;

340  
	g”r_çc
;

344 şas 
	cFLC_y


346 
	gpublic
:

347 
šlše
 
´•_A_b¬_l
(& 
q
,
ty³0
& 
dt
,ty³0 (&
t
)[
DAEBDF
::
max_q
+1],
dq
,ty³0 (&
l
)[DAEBDF::max_q+1],ty³0 (&
A_b¬
)[DAEBDF::max_q+1][DAEBDF::max_q+1])

349 if(
dq
==1)

350 
DAEBDFM©h
::
l_ÿlc
(
q
+1,
dt
,
t
,
l
);

351 if(
	gdq
==-1)

353 
DAEBDFM©h
::
l_ÿlc
(
q
-1,
dt
,
t
,
l
);

354 
ty³0
 
	gp_q_1
=1.0;

355 
	gi
=0;i<
	gq
-1;i++)

356 
	gp_q_1
*=
dt
-
t
[
i
];

357 
	gi
=1;i<
	gq
;i++)

358 
	gA_b¬
[
i
][
q
]-=
p_q_1
*
l
[i-1];

361 
	gDAEBDFM©h
::
l_ÿlc
(
q
,
dt
,
t
,
l
);

364 
šlše
 
ty³0
 
”r_çc_ÿlc
(& 
q
,ty³0& 
dt
,ty³0 (&
t
)[
DAEBDF
::
max_q
+1],ty³0 (&
lo_”r_çc
)[2],ty³0 (&
hi_”r_çc
)[2],ty³0& 
b‘a
)

366 
ty³0
 
	giq
=0.0;

367 
ty³0
 
	gb‘a_šv
=0.0;

368 
	gi
=0;i<
	gq
;i++,
	giq
++)

369 
	gb‘a_šv
+=1.0/(
iq
+1.0);

371 
	gb‘a
=
dt
/
b‘a_šv
;

373 
ty³0
 
	g®pha_q
=0.0,
	gs_qq
=0.0;

374 
	giq
=0.0;

376 
	gi
=0;i<
	gq
;i++,
	giq
++)

378 
	g®pha_q
+=1.0/(
iq
+1.0);

379 
	gs_qq
+=1.0/(
dt
-
t
[
i
]);

382 
	gs_qq
+=1.0/(
dt
-
t
[
q
]);

384 
ty³0
 
	g”r_çc
=
çbs
(1.0-
dt
*
s_qq
/
®pha_q
);

386 if(
	gq
<
	gDAEBDF
::
max_q
)

388 
ty³0
 
r
=-
dt
/
t
[
q
+1];

389 
ty³0
 
	g®pha_qq
=
®pha_q
+1.0/(
iq
+1.0);

390 
ty³0
 
	gs_qqq
=
s_qq
+1.0/(
dt
-
t
[
q
+1]);

391 
	gi
=1;i<
	gq
+1;i++)

392 
	gr
*=(
t
[
i
]-
dt
)/t[i];

394 
	ghi_”r_çc
[0]=
çbs
((1.0-
t
[
q
+1]/
dt
)*(1.0-dt*
s_qqq
/
®pha_qq
)/(
iq
+2.0));

395 
	ghi_”r_çc
[1]=-
r
;

398 if(
	gq
>1)

400 
ty³0
 
	g®pha_qq
=
®pha_q
-1.0/
iq
;

401 
ty³0
 
	gs_qqq
=
s_qq
-1.0/(
dt
-
t
[
q
]);

402 
ty³0
 
	gp_q
=1.0;

403 
	gi
=0;i<
	gq
;i++,
	giq
++)

404 
	gp_q
*=
dt
-
t
[
i
];

406 
	glo_”r_çc
[0]=
çbs
(1.0-
s_qqq
*
dt
/
®pha_qq
);

407 
	glo_”r_çc
[1]=
p_q
;

410  
	g”r_çc
;

414 şas 
	cVC_f


416 
	gpublic
:

417 
šlše
 
´•_A_b¬_l
(& 
q
,
ty³0
& 
dt
,ty³0 (&
t
)[
DAEBDF
::
max_q
+1],
dq
,ty³0 (&
l
)[DAEBDF::max_q+1],ty³0 (&
A_b¬
)[DAEBDF::max_q+1][DAEBDF::max_q+1])

419 if(
dq
==1)

421 
DAEBDFM©h
::
l_ÿlc
(
q
,
dt
,
t
,
l
);

422 
	gl
[
q
+1]=0.0;

424 if(
	gdq
==-1)

426 
DAEBDFM©h
::
l_ÿlc
(
q
-2,
dt
,
t
,
l
);

427 
ty³0
 
	gp_q_2
=1.0;

428 
	gi
=0;i<
	gq
-2;i++)

429 
	gp_q_2
*=
dt
-
t
[
i
];

430 
	gi
=2;i<
	gq
;i++)

431 
	gA_b¬
[
i
][
q
]-=
p_q_2
*
l
[i-2];

433 
ty³0
 
	gk0
=1.0/(
dt
-
t
[
q
-1])+1.0/(dt-t[q-2]);

435 
	gl
[
q
-1]=0.0;

436 
	gi
=
q
-1;i>0;i--)

437 
	gl
[
i
]+=
k0
*
l
[i-1];

440 
	gDAEBDFM©h
::
l_ÿlc
(
q
,
dt
,
t
,
l
);

443 
šlše
 
ty³0
 
”r_çc_ÿlc
(& 
q
,ty³0& 
dt
,ty³0 (&
t
)[
DAEBDF
::
max_q
+1],ty³0 (&
lo_”r_çc
)[2],ty³0 (&
hi_”r_çc
)[2],ty³0& 
b‘a
)

445 
ty³0
 
	gb‘a_šv
=0.0;

446 
	gi
=0;i<
	gq
;i++)

447 
	gb‘a_šv
+=1.0/(
dt
-
t
[
i
]);

448 
	gb‘a
=1.0/
b‘a_šv
;

450 
ty³0
 
	gs_q
=0.0,
	gr
=1.0,
	giq
=0.0;

451 
	gi
=0;i<
	gq
;i++)

452 
	gs_q
+=1.0/(
dt
-
t
[
i
]);

453 
	gi
=1;i<
	gq
;i++,
	giq
++)

454 
	gr
*=(
t
[
i
]-
dt
)/t[i];

457 
ty³0
 
	g”r_çc
=
çbs
(1.0/(
s_q
*(1.0+
r
)*
dt
));

459 if(
	gq
<
	gDAEBDF
::
max_q
)

461 
ty³0
 
r_p
=1.0;

462 
	gi
=1;i<
	gq
;i++)

463 
	gr_p
*=
t
[
i
+1]/(t[i+1]-t[1]);

465 
ty³0
 
	gtmp
=(
dt
-
t
[
q
])/(dt*dt*(
iq
+2.0)*
r
);

466 
	gtmp
/=
s_q
+1.0/(
dt
-
t
[
q
]);

468 
	ghi_”r_çc
[0]=
çbs
(
tmp
);

469 
	ghi_”r_çc
[1]=-
dt
*dt*
r
*(1.0+r)/(
t
[1]*t[
q
]*(1.0+
r_p
));

472 if(
	gq
>1)

474 
ty³0
 
	gp_q
=1.0;

475 
	gi
=0;i<
	gq
;i++,
	giq
++)

476 
	gp_q
*=
dt
-
t
[
i
];

478 
	glo_”r_çc
[0]=
çbs
(1.0/((
dt
-
t
[
q
])*
s_q
-1.0));

479 
	glo_”r_çc
[1]=
p_q
;

481  
	g”r_çc
;

485 şas 
	cVC_y


487 
	gpublic
:

488 
šlše
 
´•_A_b¬_l
(& 
q
,
ty³0
& 
dt
,ty³0 (&
t
)[
DAEBDF
::
max_q
+1],
dq
,ty³0 (&
l
)[DAEBDF::max_q+1],ty³0 (&
A_b¬
)[DAEBDF::max_q+1][DAEBDF::max_q+1])

490 if(
dq
==1)

491 
DAEBDFM©h
::
l_ÿlc
(
q
+1,
dt
,
t
,
l
);

492 if(
	gdq
==-1)

494 
DAEBDFM©h
::
l_ÿlc
(
q
-1,
dt
,
t
,
l
);

495 
ty³0
 
	gp_q_1
=1.0;

496 
	gi
=0;i<
	gq
-1;i++)

497 
	gp_q_1
*=
dt
-
t
[
i
];

498 
	gi
=1;i<
	gq
;i++)

499 
	gA_b¬
[
i
][
q
]-=
p_q_1
*
l
[i-1];

502 
	gDAEBDFM©h
::
l_ÿlc
(
q
,
dt
,
t
,
l
);

505 
šlše
 
ty³0
 
”r_çc_ÿlc
(& 
q
,ty³0& 
dt
,ty³0 (&
t
)[
DAEBDF
::
max_q
+1],ty³0 (&
lo_”r_çc
)[2],ty³0 (&
hi_”r_çc
)[2],ty³0& 
b‘a
)

507 
ty³0
 
	gb‘a_šv
=0.0;

508 
	gi
=0;i<
	gq
;i++)

509 
	gb‘a_šv
+=1.0/(
dt
-
t
[
i
]);

510 
	gb‘a
=1.0/
b‘a_šv
;

512 
ty³0
 
	gs_q
=0.0,
	giq
=0.0;

513 
	gi
=0;i<
	gq
;i++,
	giq
++)

514 
	gs_q
+=1.0/(
dt
-
t
[
i
]);

517 
ty³0
 
	g”r_çc
=
çbs
(1.0/(
s_q
*(
dt
-
t
[
q
])));

519 if(
	gq
<
	gDAEBDF
::
max_q
)

521 
ty³0
 
r
=-
dt
/
t
[
q
+1];

522 
	gi
=1;i<
	gq
+1;i++)

523 
	gr
*=(
t
[
i
]-
dt
)/t[i];

525 
ty³0
 
	gs_qq
=
s_q
+1.0/(
dt
-
t
[
q
]);

527 
	ghi_”r_çc
[0]=
çbs
(1.0/(
dt
*(
iq
+2.0)*
s_qq
));

528 
	ghi_”r_çc
[1]=-
r
;

531 if(
	gq
>1)

533 
ty³0
 
	gp_q
=1.0;

534 
	gi
=0;i<
	gq
;i++,
	giq
++)

535 
	gp_q
*=
dt
-
t
[
i
];

536 
ty³0
 
	gs_q_1
=
s_q
-1.0/(
dt
-
t
[
q
-1]);

538 
	glo_”r_çc
[0]=
çbs
(1.0/((
dt
-
t
[
q
])*
s_q_1
));

539 
	glo_”r_çc
[1]=
p_q
;

542  
	g”r_çc
;

	@dae_imp.cpp

1 
	~"d«_imp.h
"

2 
	~"©oms_dmd.h
"

3 
	~"ff_dmd.h
"

4 
	~"dyÇmic_dmd.h
"

5 
	~"gm»s.h
"

6 
	~"memÜy.h
"

7 
	~"xm©h.h
"

8 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

12 
	gDAEIm¶ic™
::
	$DAEIm¶ic™
():

13 
	`DAE
(),

14 
	`y_0
(
NULL
),

15 
	`c_0
(
NULL
),

16 
	`d–_c
(
NULL
),

17 
	`F
(
NULL
),

18 
	`a
(
NULL
),

19 
	`F_±r
(
NULL
),

20 
	`d–_c_±r
(
NULL
),

21 
	$gm»s
(
NULL
)

23 
	}
}

27 
	gDAEIm¶ic™
::~
	$DAEIm¶ic™
()

29 
d–‘e
 [] 
y_0
;

30 
y_0
=
c_0
=
a
=
NULL
;

31 
d–‘e
 
F_±r
;

32 
d–‘e
 
d–_c_±r
;

33 
	}
}

37 
	gDAEIm¶ic™
::
	$š™_¡©ic
()

39 
DAE
::
	`š™_¡©ic
();

40 
MemÜy
::
	`®loc
(
y_0
,3*
ncs
);

41 
c_0
=
y_0
+
ncs
;

42 
a
=
y_0
+2*
ncs
;

43 
d–_c_±r
=
Ãw
 
Vec
<
ty³0
>(
©oms
,
c_dim
);

44 
d–_c
=
d–_c_±r
->
	`begš
();

45 
F_±r
=
Ãw
 
Vec
<
ty³0
>(
©oms
,
c_dim
);

46 
F
=
F_±r
->
	`begš
();

47 
gm»s
=
Ãw
 
	`GMRES
(
©oms
,
max_ngm»s_™”s
,
c_dim
);

48 
	}
}

52 
	gDAEIm¶ic™
::
	$fš_¡©ic
()

54 
d–‘e
 
gm»s
;

55 
gm»s
=
NULL
;

56 
d–‘e
 
F_±r
;

57 
F_±r
=
NULL
;

58 
F
=
NULL
;

59 
d–‘e
 
d–_c_±r
;

60 
d–_c_±r
=
NULL
;

61 
d–_c
=
NULL
;

62 
MemÜy
::
	`d—Îoc
(
y_0
);

63 
y_0
=
c_0
=
a
=
NULL
;

64 
DAE
::
	`fš_¡©ic
();

65 
	}
}

69 
	gDAEIm¶ic™
::
	$š™
()

71 
DAE
::
	`š™
();

75 
	}
}

79 
	gDAEIm¶ic™
::
	$fš
()

85 
DAE
::
	`fš
();

86 
	}
}

90 
šlše
 
ty³0
 
	gDAEIm¶ic™
::
	$upd©e_c
()

92 
ty³0
 
tmp
;

93 
ty³0
 
r
,
r_lş
=1.0;

94 
i
=0;i<
ncs
;i++)

96 if(
c
[
i
]>=0.0)

98 
tmp
=
c
[
i
]-
r_lş
*
d–_c
[i];

99 if(
tmp
>1.0)

101 
r_lş
=(
c
[
i
]-1.0)/
d–_c
[i];

102 
c
[
i
]-
r_lş
*
d–_c
[i]>1.0)

103 
r_lş
=
	`Ãxá”
(r_lcl,0.0);

105 if(
tmp
<0.0)

107 
r_lş
=
c
[
i
]/
d–_c
[i];

108 
c
[
i
]-
r_lş
*
d–_c
[i]<0.0)

109 
r_lş
=
	`Ãxá”
(r_lcl,0.0);

113 
d–_c
[
i
]=0.0;

117 
	`MPI_AÎ»duû
(&
r_lş
,&
r
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_MIN
,
©oms
->
wÜld
);

118 vŞ©
ty³0
 
c0
;

120 
i
=0;i<
ncs
;i++)

122 
c0
=
c
[
i
]-
r
*
d–_c
[i];

123 --++
c0
;

124 
c
[
i
]=
c0
;

138  
r
;

139 
	}
}

146 
boŞ
 
	gDAEIm¶ic™
::
	$ÃwtÚ
()

148 autØ
F_nÜm
=[
this
]()->
ty³0


150 
ff
->
	`c_d_ÿlc
();

151 
ty³0
 
F_nÜm_lş
=0.0;

152 
ty³0
 
b‘a_šv
=1.0/
b‘a
;

153 
i
=0;i<
ncs
;i++)

155 
F
[
i
]=
b‘a_šv
*
c
[i]+
a
[i]-
c_d
[i];

156 
F_nÜm_lş
+=
F
[
i
]*F[i];

158 
ty³0
 
F_nÜm
;

159 
	`MPI_AÎ»duû
(&
F_nÜm_lş
,&
F_nÜm
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
©oms
->
wÜld
);

160  
	`sq¹
(
F_nÜm
)/
a_tŞ_sq¹_nc_dof
;

163 autØ
Jacobaš_ÿlc
=[
this
](
Vec
<
ty³0
>* 
x
,Vec<ty³0>* 
Jx
)->

165 
ff
->
	`J
(
x
,
Jx
);

166 
ty³0
* 
__Jx
=
Jx
->
	`begš
();

167 
ty³0
* 
__x
=
x
->
	`begš
();

168 
ty³0
 
b‘a_šv
=1.0/
b‘a
;

169 
i
=0;i<
ncs
;i++)

170 
__Jx
[
i
]=-__Jx[i]+
b‘a_šv
*
__x
[i];

175 
ty³0
 
»s_tŞ
=0.005*
a_tŞ_sq¹_nc_dof
/
”r_çc
;

176 
ty³0
 
d’om
=0.1*
a_tŞ_sq¹_nc_dof
/
”r_çc
;

177 
ty³0
 
nÜm
=1.0,
d–
=0.0,
d–_´ev
=0.0,
¿tio
=1.0,
R
=1.0;

179 
™”
=0;

184 
ty³0
 
co¡
=
	`F_nÜm
();

186 
boŞ
 
cÚv”ge
=
çl£
,
div”ge
=false;

187 
™”
<
max_ÂewtÚ_™”s
 && !
cÚv”ge
 && !
div”ge
)

189 
gm»s
->
	`sŞve
(
Jacobaš_ÿlc
,
F_±r
,
»s_tŞ
,
nÜm
,
d–_c_±r
);

191 
¿tio
=
	`upd©e_c
();

192 
dyÇmic
->
	`upd©e
(
©oms
->
c
);

194 
d–
=
	`çbs
(
¿tio
*
nÜm
/
d’om
);

196 if(
™”
è
R
=
	`MAX
(0.3*R,
d–
/
d–_´ev
);

197 if(
™”
>1 && 
R
*
d–
<1.0)

199 
co¡
=
	`F_nÜm
();

200 
cÚv”ge
=
Œue
;

204 if(
™”
>1 && 
d–
/
d–_´ev
>2.0)

206 
div”ge
=
Œue
;

210 
d–_´ev
=
d–
;

212 
co¡
=
	`F_nÜm
();

213 
™”
++;

217 if(
cÚv”ge
)

219 if(
™”
è
ÂÚlš_acc
++;

220  
Œue
;

222 
	`memıy
(
c
,
c_0
,
ncs
*(
ty³0
));

223 
dyÇmic
->
	`upd©e
(
©oms
->
c
);

224 
ÂÚlš_»j
++;

225  
çl£
;

226 
	}
}

310 
PyObjeù
* 
	gDAEIm¶ic™
::
	$__Ãw__
(
PyTy³Objeù
* 
ty³
,
PyObjeù
* 
¬gs
,PyObjeù* 
kwds
)

312 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
ty³
->
	`_®loc
(type,0));

313 
PyObjeù
* 
£lf
=
»š‹½»t_ÿ¡
<PyObjeù*>(
__£lf
);

314  
£lf
;

315 
	}
}

319 
	gDAEIm¶ic™
::
	$__š™__
(
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)

321 
FuncAPI
<> 
	`f
("__init__");

323 if(
	`f
(
¬gs
,
kwds
)==-1)  -1;

324 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

325 
__£lf
->
d«
=
Ãw
 
	`DAEIm¶ic™
();

326 
__£lf
->
x´t
=
NULL
;

328 
	}
}

332 
PyObjeù
* 
	gDAEIm¶ic™
::
	$__®loc__
(
PyTy³Objeù
* 
ty³
,
Py_ssize_t
)

334 
Objeù
* 
__£lf
=
Ãw
 Object;

335 
	`Py_TYPE
(
__£lf
)=
ty³
;

336 
	`Py_REFCNT
(
__£lf
)=1;

337 
__£lf
->
d«
=
NULL
;

338 
__£lf
->
x´t
=
NULL
;

339  
»š‹½»t_ÿ¡
<
PyObjeù
*>(
__£lf
);

340 
	}
}

344 
	gDAEIm¶ic™
::
	$__d—Îoc__
(
PyObjeù
* 
£lf
)

346 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

347 
d–‘e
 
__£lf
->
d«
;

348 
__£lf
->
d«
=
NULL
;

349 if(
__£lf
->
x´t
è
	`Py_DECREF
(__self->xprt);

350 
__£lf
->
x´t
=
NULL
;

351 
d–‘e
 
__£lf
;

352 
	}
}

354 
PyTy³Objeù
 
	gDAEIm¶ic™
::
Ty³Objeù
={
PyObjeù_HEAD_INIT
(
NULL
)};

356 
	gDAEIm¶ic™
::
	$£tup_
()

358 
Ty³Objeù
.
_Çme
="mapp.dmd.dae_implicit";

359 
Ty³Objeù
.
_doc
="chemical integration";

361 
Ty³Objeù
.
_æags
=
Py_TPFLAGS_DEFAULT
;

362 
Ty³Objeù
.
_basicsize
=(
Objeù
);

364 
Ty³Objeù
.
_Ãw
=
__Ãw__
;

365 
Ty³Objeù
.
_š™
=
__š™__
;

366 
Ty³Objeù
.
_®loc
=
__®loc__
;

367 
Ty³Objeù
.
_d—Îoc
=
__d—Îoc__
;

368 
	`£tup__m‘hods
();

369 
Ty³Objeù
.
_m‘hods
=
m‘hods
;

370 
	`£tup__g‘£t
();

371 
Ty³Objeù
.
_g‘£t
=
g‘£t
;

373 
ichk
=
	`PyTy³_R—dy
(&
Ty³Objeù
);

374 if(
ichk
<0)  ichk;

375 
	`Py_INCREF
(&
Ty³Objeù
);

376  
ichk
;

377 
	}
}

379 
PyG‘S‘Def
 
	gDAEIm¶ic™
::
g‘£t
[]=
Em±yPyG‘S‘Def
(3);

381 
	gDAEIm¶ic™
::
	$£tup__g‘£t
()

383 
	`g‘£t_max_ngm»s_™”s
(
g‘£t
[0]);

384 
	`g‘£t_max_ÂewtÚ_™”s
(
g‘£t
[1]);

385 
	}
}

387 
PyM‘hodDef
 
	gDAEIm¶ic™
::
m‘hods
[]=
Em±yPyM‘hodDef
(2);

389 
	gDAEIm¶ic™
::
	$£tup__m‘hods
()

391 
	}
}

395 
DAEIm¶ic™
::
	$g‘£t_max_ngm»s_™”s
(
PyG‘S‘Def
& 
g‘£t
)

397 
g‘£t
.
Çme
=(*)"max_ngmres_iters";

398 
g‘£t
.
doc
=(*)
R
"---(

399 (è
maximim
 
numb”
 
of
 
gm»s
 
™”©iÚs


401 
Maximum
 
numb”
 
of
 
™”©iÚs
 oà
lš—r
 
	`sŞv”
 (
GMRES
)

403 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

405  
v¬
<>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
d«
->
max_ngm»s_™”s
);

407 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

409 
V¬API
<> 
	`max_ngm»s_™”s
("max_ngmres_iters");

410 
max_ngm»s_™”s
.
logics
[0]=
	`VLogics
("gt",0);

411 
ichk
=
max_ngm»s_™”s
.
	`£t
(
İ
);

412 if(
ichk
==-1)  -1;

413 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
d«
->
max_ngm»s_™”s
=max_ngm»s_™”s.
v®
;

416 
	}
}

420 
	gDAEIm¶ic™
::
	$g‘£t_max_ÂewtÚ_™”s
(
PyG‘S‘Def
& 
g‘£t
)

422 
g‘£t
.
Çme
=(*)"max_nnewton_iters";

423 
g‘£t
.
doc
=(*)
R
"---(

424 (è
maximim
 
numb”
 
of
 
ÃwtÚ
 
™”©iÚs


426 
Maximum
 
numb”
 
of
 
™”©iÚs
 oà
nÚlš—r
 
	`sŞv”
 (
ÃwtÚ
)

428 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

430  
v¬
<>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
d«
->
max_ÂewtÚ_™”s
);

432 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

434 
V¬API
<> 
	`max_ÂewtÚ_™”s
("max_nnewton_iters");

435 
max_ÂewtÚ_™”s
.
logics
[0]=
	`VLogics
("gt",0);

436 
ichk
=
max_ÂewtÚ_™”s
.
	`£t
(
İ
);

437 if(
ichk
==-1)  -1;

438 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
d«
->
max_ÂewtÚ_™”s
=max_ÂewtÚ_™”s.
v®
;

441 
	}
}

	@dae_imp.h

1 #iâdeà
__MAPP__d«_imp__


2 
	#__MAPP__d«_imp__


	)

3 
	~"d«.h
"

4 
Çme¥aû
 
	gMAPP_NS


6 şas 
	cDAEIm¶ic™
:
public
 
DAE


8 
´iv©e
:

9 
´Ùeùed
:

10 
boŞ
 
ÃwtÚ
();

11 
ty³0
 
upd©e_c
();

12 
J_‹¡
();

13 
	gpublic
:

15 
ÂÚlš_acc
;

16 
	gÂÚlš_»j
;

17 
	gnš‹g_acc
;

18 
	gnš‹g_»j
;

19 
	gnšŞ_acc
;

20 
	gnšŞ_»j
;

22 
ty³0
 
	g”r_çc
;

23 
ty³0
 
	gb‘a
;

25 
ty³0
* 
	gy_0
;

26 
ty³0
* 
	gc_0
;

27 
ty³0
* 
	ga
;

28 
ty³0
* 
	gd–_c
;

29 
ty³0
* 
	gF
;

30 
	gVec
<
	gty³0
>* 
	gF_±r
;

31 
	gVec
<
	gty³0
>* 
	gd–_c_±r
;

35 
şass
 
GMRES
* 
	ggm»s
;

37 
DAEIm¶ic™
();

38 
	gvœtu®
 ~
DAEIm¶ic™
();

39 
š™_¡©ic
();

40 
fš_¡©ic
();

42 
š™
();

43 
fš
();

48 
PyObjeù_HEAD


49 
DAEIm¶ic™
* 
	gd«
;

50 
	gExpÜtDMD
::
Objeù
* 
x´t
;

51 }
	tObjeù
;

54 
PyTy³Objeù
 
	gTy³Objeù
;

55 
PyObjeù
* 
__Ãw__
(
PyTy³Objeù
*,PyObject*, PyObject*);

56 
__š™__
(
PyObjeù
*, PyObject*,PyObject*);

57 
PyObjeù
* 
__®loc__
(
PyTy³Objeù
*,
Py_ssize_t
);

58 
__d—Îoc__
(
PyObjeù
*);

60 
PyM‘hodDef
 
	gm‘hods
[];

61 
£tup__m‘hods
();

63 
PyG‘S‘Def
 
	gg‘£t
[];

64 
£tup__g‘£t
();

65 
g‘£t_max_ÂewtÚ_™”s
(
PyG‘S‘Def
&);

66 
g‘£t_max_ngm»s_™”s
(
PyG‘S‘Def
&);

68 
£tup_
();

	@dae_styles.h

1 
	~"d«_bdf.h
"

	@dynamic.cpp

1 
	~"©oms_¡yËs.h
"

2 
	~"dyÇmic.h
"

3 
	~"ff_¡yËs.h
"

4 
	~"xm©h.h
"

5 
	~"memÜy.h
"

66 
	gDyÇmic
::
DyÇmic
(
Atoms
* 
__©oms
,
FÜûF›ld
* 
__ff
,
boŞ
 
__chng_box
,

67 
¡d
::
š™Ÿliz”_li¡
<
vec
*> 
__updt_vecs_def
,¡d::š™Ÿliz”_li¡<vec*> 
__updt_vecs
,

68 
¡d
::
š™Ÿliz”_li¡
<
vec
*> 
__xchng_comp_vecs_def
,¡d::š™Ÿliz”_li¡<vec*> 
__xchng_comp_vecs
,

69 
¡d
::
š™Ÿliz”_li¡
<
vec
*> 
__¬ch_vecs_def
,¡d::š™Ÿliz”_li¡<vec*> 
__¬ch_vecs
):

70 
©oms
(
__©oms
),

71 
wÜld
(
__©oms
->
comm
.world),

72 
skš
(
__©oms
->
comm
.skin),

73 
ff
(
__ff
),

74 
chng_box
(
__chng_box
),

76 
updt_vecs
(
__updt_vecs_def
.
size
()+
__updt_vecs
.size()==0 ? 
NULL
: 
Ãw
 
vec
*[__updt_vecs_def.size()+__updt_vecs.size()]),

77 
nupdt_vecs
(
¡©ic_ÿ¡
<>(
__updt_vecs
.
size
()+
__updt_vecs_def
.size())),

79 
xchng_comp_vecs
(
__xchng_comp_vecs_def
.
size
()+
__xchng_comp_vecs
.size()==0 ? 
NULL
: 
Ãw
 
vec
*[__xchng_comp_vecs_def.size()+__xchng_comp_vecs.size()]),

80 
nxchng_comp_vecs
(
¡©ic_ÿ¡
<>(
__xchng_comp_vecs
.
size
()+
__xchng_comp_vecs_def
.size())),

82 
¬ch_vecs
(
__¬ch_vecs_def
.
size
()+
__¬ch_vecs
.size()==0 ? 
NULL
: 
Ãw
 
vec
*[__arch_vecs_def.size()+__arch_vecs.size()]),

83 
Çrch_vecs
(
¡©ic_ÿ¡
<>(
__¬ch_vecs
.
size
()+
__¬ch_vecs_def
.size())),

85 
nupdt_vecs_fuÎ
(0),

86 
nxchng_vecs_fuÎ
(0),

87 
¬ch_vecs_fuÎ
(
NULL
),

88 
	$Çrch_vecs_fuÎ
(0)

90 
	`memıy
(
updt_vecs
,
__updt_vecs_def
.
	`begš
(),__updt_vecs_def.
	`size
()*(
vec
*));

91 
	`memıy
(
updt_vecs
+
__updt_vecs_def
.
	`size
(),
__updt_vecs
.
	`begš
(),__updt_vecs.size()*(
vec
*));

93 
	`memıy
(
xchng_comp_vecs
,
__xchng_comp_vecs_def
.
	`begš
(),__xchng_comp_vecs_def.
	`size
()*(
vec
*));

94 
	`memıy
(
xchng_comp_vecs
+
__xchng_comp_vecs_def
.
	`size
(),
__xchng_comp_vecs
.
	`begš
(),__xchng_comp_vecs.size()*(
vec
*));

96 
	`memıy
(
¬ch_vecs
,
__¬ch_vecs_def
.
	`begš
(),__¬ch_vecs_def.
	`size
()*(
vec
*));

97 
	`memıy
(
¬ch_vecs
+
__¬ch_vecs_def
.
	`size
(),
__¬ch_vecs
.
	`begš
(),__¬ch_vecs.size()*(
vec
*));

98 
	}
}

102 
	gDyÇmic
::~
	$DyÇmic
()

104 
d–‘e
 [] 
¬ch_vecs
;

105 
d–‘e
 [] 
xchng_comp_vecs
;

106 
d–‘e
 [] 
updt_vecs
;

107 
	}
}

111 
	gDyÇmic
::
	$add_xchng
(
vec
* 
v
)

113 
vec
** 
__xchng_comp_vecs
=
Ãw
 vec*[
nxchng_comp_vecs
+1];

114 
	`memıy
(
__xchng_comp_vecs
,
xchng_comp_vecs
,
nxchng_comp_vecs
*(
vec
*));

115 
d–‘e
 [] 
xchng_comp_vecs
;

116 
xchng_comp_vecs
=
__xchng_comp_vecs
;

117 
xchng_comp_vecs
[
nxchng_comp_vecs
++]=
v
;

118 
	}
}

122 
	gDyÇmic
::
	$add_updt
(
vec
* 
v
)

124 
vec
** 
__updt_vecs
=
Ãw
 vec*[
nupdt_vecs
+1];

125 
	`memıy
(
__updt_vecs
,
updt_vecs
,
nupdt_vecs
*(
vec
*));

126 
d–‘e
 [] 
updt_vecs
;

127 
updt_vecs
=
__updt_vecs
;

128 
updt_vecs
[
nupdt_vecs
++]=
v
;

129 
	}
}

133 
	gDyÇmic
::
	$ü—‹_dyÇmic_vecs
()

136 
dyÇmic_vecs_ıùy
=
©oms
->
nvecs
;

137 
vec
** 
dyÇmic_vecs
;

138 
MemÜy
::
	`®loc
(
dyÇmic_vecs
,
dyÇmic_vecs_ıùy
);

139 
ndyÇmic_vecs
=0;

141 
nupdt_vecs_fuÎ
=0;

142 
i
=0;i<
nupdt_vecs
;i++)

143 if(!
updt_vecs
[
i
]->
	`is_em±y
())

145 
dyÇmic_vecs
[
ndyÇmic_vecs
++]=
updt_vecs
[
i
];

146 
nupdt_vecs_fuÎ
++;

149 
nxchng_vecs_fuÎ
=
nupdt_vecs_fuÎ
;

150 
i
=0;i<
nxchng_comp_vecs
;i++)

151 if(!
xchng_comp_vecs
[
i
]->
	`is_em±y
())

153 
dyÇmic_vecs
[
ndyÇmic_vecs
++]=
xchng_comp_vecs
[
i
];

154 
nxchng_vecs_fuÎ
++;

158 autØ
is_š
=[](
vec
*& 
v
,vec**& 
vs
,& 
nvs
)->
boŞ


161 
i
=0;i<
nvs
;i++)

162 if(
vs
[
i
]==
v
è 
Œue
;

163  
çl£
;

166 
vec
** 
®l_vecs
=
©oms
->
vecs
;

167 
ÇÎ_vecs
=
©oms
->
nvecs
;

168 
i
=0;i<
ÇÎ_vecs
;i++)

170 if(
®l_vecs
[
i
]->
	`is_em±y
()) ;

171 if(
	`is_š
(
®l_vecs
[
i
],
dyÇmic_vecs
,
nxchng_vecs_fuÎ
)) ;

172 if(
	`is_š
(
®l_vecs
[
i
],
¬ch_vecs_fuÎ
,
Çrch_vecs_fuÎ
)) ;

173 
dyÇmic_vecs
[
ndyÇmic_vecs
++]=
®l_vecs
[
i
];

178 
MemÜy
::
	`shršk_to_f™
(
dyÇmic_vecs
,
ndyÇmic_vecs
,
dyÇmic_vecs_ıùy
);

179 
d–‘e
 [] 
©oms
->
dyÇmic_vecs
;

180 
©oms
->
dyÇmic_vecs
=dynamic_vecs;

181 
©oms
->
ndyÇmic_vecs
=ndynamic_vecs;

182 
	}
}

186 
	gDyÇmic
::
	$de¡roy_dyÇmic_vecs
()

188 
d–‘e
 [] 
©oms
->
dyÇmic_vecs
;

189 
©oms
->
dyÇmic_vecs
=
NULL
;

190 
©oms
->
ndyÇmic_vecs
=0;

192 
nxchng_vecs_fuÎ
=
nupdt_vecs_fuÎ
=0;

193 
	}
}

197 
	gDyÇmic
::
	$¡Üe_¬ch_vecs
()

200 
MemÜy
::
	`®loc
(
¬ch_vecs_fuÎ
,
Çrch_vecs
+1);

201 
Çrch_vecs_fuÎ
=0;

202 
i
=0;i<
Çrch_vecs
;i++)

203 if(!
¬ch_vecs
[
i
]->
	`is_em±y
())

204 
¬ch_vecs_fuÎ
[
Çrch_vecs_fuÎ
++]=
¬ch_vecs
[
i
];

205 if(
Çrch_vecs_fuÎ
)

206 
¬ch_vecs_fuÎ
[
Çrch_vecs_fuÎ
++]=
Ãw
 
Vec
<>(
©oms
,1,"id_arch");

207 
MemÜy
::
	`shršk_to_f™
(
¬ch_vecs_fuÎ
,
Çrch_vecs_fuÎ
,
Çrch_vecs
+1);

208 if(!
Çrch_vecs_fuÎ
) ;

210 * 
id_0
=
©oms
->
id
->
	`begš
();

211 * 
id_1
=
»š‹½»t_ÿ¡
<*>(
¬ch_vecs_fuÎ
[
Çrch_vecs_fuÎ
-1]->
	`begš
());

212 
	`memıy
(
id_1
,
id_0
,
©oms
->
Çtms_lş
*());

213 
	}
}

217 
	gDyÇmic
::
	$»¡Üe_¬ch_vecs
()

219 if(!
Çrch_vecs_fuÎ
) ;

221 cÚ¡ 
tÙ_p
=
CommuniÿtiÚ
::
	`g‘_size
(
wÜld
);

222 cÚ¡ 
my_p
=
CommuniÿtiÚ
::
	`g‘_¿nk
(
wÜld
);

223 
MPI_Comm
& 
__wÜld
=
wÜld
;

226 
by‹_sz
=0;

227 
ivec
=0;ivec<
Çrch_vecs_fuÎ
-1;ivec++)

228 
by‹_sz
+=
¬ch_vecs_fuÎ
[
ivec
]->byte_sz;

230 
Vec
<>* 
id_¬ch
=
dyÇmic_ÿ¡
<Vec<>*>(
¬ch_vecs_fuÎ
[
Çrch_vecs_fuÎ
-1]);

231 
Çtms_Şd
=
id_¬ch
->
vec_sz
;

232 * 
id_Şd
=
id_¬ch
->
	`begš
();

233 * 
key_Şd
=
NULL
;

234 if(
Çtms_Şd
è
key_Şd
=
Ãw
 [natms_old];

235 
i
=0;i<
Çtms_Şd
;i++è
key_Şd
[i]=i;

236 
XM©h
::
	`quicksÜt
(
key_Şd
,key_Şd+
Çtms_Şd


237 ,[&
id_Şd
](* 
¿nk_i
,* 
¿nk_j
){ (id_old[*rank_i]<id_old[*rank_j]);}

238 ,[](* 
¿nk_i
,* 
¿nk_j
){
¡d
::
	`sw­
(*rank_i,*rank_j);}

241 
Çtms_Ãw
=
©oms
->
id
->
vec_sz
;

242 * 
id_Ãw
=
©oms
->
id
->
	`begš
();

243 * 
key_Ãw
=
NULL
;

244 if(
Çtms_Ãw
è
key_Ãw
=
Ãw
 [natms_new];

245 
i
=0;i<
Çtms_Ãw
;i++è
key_Ãw
[i]=i;

246 
XM©h
::
	`quicksÜt
(
key_Ãw
,key_Ãw+
Çtms_Ãw


247 ,[&
id_Ãw
](* 
¿nk_i
,* 
¿nk_j
){ (id_new[*rank_i]<id_new[*rank_j]);}

248 ,[](* 
¿nk_i
,* 
¿nk_j
){
¡d
::
	`sw­
(*rank_i,*rank_j);}

252 
n¢d
=0;

253 * 
idx_l¡_¢d
=
NULL
;

254 * 
id_l¡_¢d
=
NULL
;

255 if(
Çtms_Şd
)

257 
idx_l¡_¢d
=
Ãw
 [
Çtms_Şd
];

258 
id_l¡_¢d
=
Ãw
 [
Çtms_Şd
];

261 
Äcv
=0;

262 * 
idx_l¡_rcv
=
NULL
;

263 * 
id_l¡_rcv
=
NULL
;

264 if(
Çtms_Ãw
)

266 
idx_l¡_rcv
=
Ãw
 [
Çtms_Ãw
];

267 
id_l¡_rcv
=
Ãw
 [
Çtms_Ãw
];

270 
nk“p
=0;

271 * 
idx_k“p_Şd
=
NULL
;

272 * 
idx_k“p_Ãw
=
NULL
;

273 if(
	`MIN
(
Çtms_Şd
,
Çtms_Ãw
))

275 
idx_k“p_Şd
=
Ãw
 [
	`MIN
(
Çtms_Şd
,
Çtms_Ãw
)];

276 
idx_k“p_Ãw
=
Ãw
 [
	`MIN
(
Çtms_Şd
,
Çtms_Ãw
)];

279 
i_Şd
=0,
i_Ãw
=0;

280 ;
i_Şd
<
Çtms_Şd
 && 
i_Ãw
<
Çtms_Ãw
;)

282 if(
id_Şd
[
key_Şd
[
i_Şd
]]<
id_Ãw
[
key_Ãw
[
i_Ãw
]])

284 
id_l¡_¢d
[
n¢d
]=
id_Şd
[
key_Şd
[
i_Şd
]];

285 
idx_l¡_¢d
[
n¢d
++]=
key_Şd
[
i_Şd
++];

287 if(
id_Şd
[
key_Şd
[
i_Şd
]]>
id_Ãw
[
key_Ãw
[
i_Ãw
]])

289 
id_l¡_rcv
[
Äcv
]=
id_Ãw
[
key_Ãw
[
i_Ãw
]];

290 
idx_l¡_rcv
[
Äcv
++]=
key_Ãw
[
i_Ãw
++];

294 
idx_k“p_Şd
[
nk“p
]=
key_Şd
[
i_Şd
++];

295 
idx_k“p_Ãw
[
nk“p
++]=
key_Ãw
[
i_Ãw
++];

299 ;
i_Şd
<
Çtms_Şd
;)

301 
id_l¡_¢d
[
n¢d
]=
id_Şd
[
key_Şd
[
i_Şd
]];

302 
idx_l¡_¢d
[
n¢d
++]=
key_Şd
[
i_Şd
++];

304 ;
i_Ãw
<
Çtms_Ãw
;)

306 
id_l¡_rcv
[
Äcv
]=
id_Ãw
[
key_Ãw
[
i_Ãw
]];

307 
idx_l¡_rcv
[
Äcv
++]=
key_Ãw
[
i_Ãw
++];

310 
d–‘e
 [] 
key_Şd
;

311 
d–‘e
 [] 
key_Ãw
;

313 
MemÜy
::
	`shršk_to_f™
(
id_l¡_¢d
,
n¢d
,
Çtms_Şd
);

314 
MemÜy
::
	`shršk_to_f™
(
idx_l¡_¢d
,
n¢d
,
Çtms_Şd
);

315 
MemÜy
::
	`shršk_to_f™
(
id_l¡_rcv
,
Äcv
,
Çtms_Ãw
);

316 
MemÜy
::
	`shršk_to_f™
(
idx_l¡_rcv
,
Äcv
,
Çtms_Ãw
);

317 
MemÜy
::
	`shršk_to_f™
(
idx_k“p_Şd
,
nk“p
,
	`MIN
(
Çtms_Şd
,
Çtms_Ãw
));

318 
MemÜy
::
	`shršk_to_f™
(
idx_k“p_Ãw
,
nk“p
,
	`MIN
(
Çtms_Şd
,
Çtms_Ãw
));

321 autØ
sÜt_idx_by_p
=

322 [&
__wÜld
,&
my_p
,&
tÙ_p
] (cÚ¡ * 
l¡
,
l¡_sz
,cÚ¡ * 
sub_l¡
,
sub_l¡_sz
,

323 *& 
sub_l¡_idx
,* 
comm_size
)->

325 

=0;<
tÙ_p
;ip++)

326 
comm_size
[

]=0;

328 
max_l¡_sz
;

329 
	`MPI_AÎ»duû
(&
l¡_sz
,&
max_l¡_sz
,1,
MPI_INT
,
MPI_MAX
,
__wÜld
);

330 
mÙh”_l¡_sz
;

331 * 
mÙh”_l¡
=
NULL
;

332 if(
max_l¡_sz
è
mÙh”_l¡
=
Ãw
 [max_lst_sz];

334 
âd_sz
,
uâd_sz
;

336 * 
uâd
=
NULL
;

337 * 
uâd_idx
=
NULL
;

338 * 
âd_idx
=
NULL
;

339 if(
sub_l¡_sz
)

341 
uâd
=
Ãw
 [
sub_l¡_sz
];

342 
uâd_idx
=
Ãw
 [
sub_l¡_sz
];

343 
âd_idx
=
Ãw
 [
sub_l¡_sz
];

346 
âd_sz
=0;

347 
uâd_sz
=
sub_l¡_sz
;

348 
	`memıy
(
uâd
,
sub_l¡
,
sub_l¡_sz
*());

349 
	`memıy
(
uâd_idx
,
sub_l¡_idx
,
sub_l¡_sz
*());

350 
imÙh”_l¡
,
iuâd
,
uâd_tmp_sz
,

=0;<
tÙ_p
;ip++)

352 if(

==
my_p
)

354 
mÙh”_l¡_sz
=
l¡_sz
;

355 
	`memıy
(
mÙh”_l¡
,
l¡
,
mÙh”_l¡_sz
*());

357 
	`MPI_Bÿ¡
(&
mÙh”_l¡_sz
,1,
MPI_INT
,

,
__wÜld
);

358 
	`MPI_Bÿ¡
(
mÙh”_l¡
,
mÙh”_l¡_sz
*(),
MPI_BYTE
,

,
__wÜld
);

360 if(

==
my_p
 || 
uâd_sz
==0 || 
mÙh”_l¡_sz
==0) ;

362 
uâd_tmp_sz
=0;

363 
imÙh”_l¡
=0,
iuâd
=0;imÙh”_l¡<
mÙh”_l¡_sz
 && iuâd<
uâd_sz
;)

365 if(
mÙh”_l¡
[
imÙh”_l¡
]<
uâd
[
iuâd
])

366 
imÙh”_l¡
++;

367 if(
mÙh”_l¡
[
imÙh”_l¡
]>
uâd
[
iuâd
])

369 
uâd_idx
[
uâd_tmp_sz
]=uâd_idx[
iuâd
];

370 
uâd
[
uâd_tmp_sz
++]=uâd[
iuâd
++];

374 
âd_idx
[
âd_sz
++]=
uâd_idx
[
iuâd
++];

375 
imÙh”_l¡
++;

376 
comm_size
[

]++;

380 ;
iuâd
<
uâd_sz
;)

382 
uâd_idx
[
uâd_tmp_sz
]=uâd_idx[
iuâd
];

383 
uâd
[
uâd_tmp_sz
++]=uâd[
iuâd
++];

386 
uâd_sz
=
uâd_tmp_sz
;

390 
d–‘e
 [] 
sub_l¡_idx
;

391 
sub_l¡_idx
=
âd_idx
;

392 
d–‘e
 [] 
uâd
;

393 
d–‘e
 [] 
uâd_idx
;

394 
d–‘e
 [] 
mÙh”_l¡
;

397 * 
n¢d_comm
=
Ãw
 [
tÙ_p
];

398 * 
Äcv_comm
=
Ãw
 [
tÙ_p
];

399 
	`sÜt_idx_by_p
(
id_l¡_rcv
,
Äcv
,
id_l¡_¢d
,
n¢d
,
idx_l¡_¢d
,
n¢d_comm
);

400 
	`sÜt_idx_by_p
(
id_l¡_¢d
,
n¢d
,
id_l¡_rcv
,
Äcv
,
idx_l¡_rcv
,
Äcv_comm
);

401 
d–‘e
 [] 
id_l¡_¢d
;

402 
d–‘e
 [] 
id_l¡_rcv
;

405 
by‹
** 
¢d_buff
=
Ãw
 by‹*[
tÙ_p
];

406 *
¢d_buff
=
NULL
;

407 if(
n¢d
)

409 *
¢d_buff
=
Ãw
 
by‹
[
by‹_sz
*
n¢d
];

410 

=1;<
tÙ_p
;ip++)

411 
¢d_buff
[

]=¢d_buff[-1]+
by‹_sz
*
n¢d_comm
[ip-1];

414 
by‹
** 
rcv_buff
=
Ãw
 by‹*[
tÙ_p
];

415 *
rcv_buff
=
NULL
;

416 if(
Äcv
)

418 *
rcv_buff
=
Ãw
 
by‹
[
by‹_sz
*
Äcv
];

419 

=1;<
tÙ_p
;ip++)

420 
rcv_buff
[

]ôcv_buff[-1]+
by‹_sz
*
Äcv_comm
[ip-1];

423 
by‹
* 
_¢d_buff
=*
¢d_buff
;

424 
ivec
=0;ivec<
Çrch_vecs_fuÎ
-1;ivec++)

425 
i
=0;i<
n¢d
;i++)

426 
¬ch_vecs_fuÎ
[
ivec
]->
	`ıy
(
_¢d_buff
,
idx_l¡_¢d
[
i
]);

427 
d–‘e
 [] 
idx_l¡_¢d
;

430 
ivec
=0;ivec<
Çrch_vecs_fuÎ
-1;ivec++)

431 
¬ch_vecs_fuÎ
[
ivec
]->
	`»¬¿nge
(
idx_k“p_Şd
,
idx_k“p_Ãw
,
nk“p
,
Çtms_Ãw
);

432 
d–‘e
 [] 
idx_k“p_Şd
;

433 
d–‘e
 [] 
idx_k“p_Ãw
;

436 
idi¥
=1;idi¥<
tÙ_p
;idisp++)

438 
rcv_p
=
my_p
-
idi¥
;

439 if(
rcv_p
<0èrcv_p+=
tÙ_p
;

440 
¢d_p
=
my_p
+
idi¥
;

441 if(
¢d_p
>=
tÙ_p
) snd_p-=tot_p;

442 
	`MPI_S’d»cv
(
¢d_buff
[
¢d_p
],
n¢d_comm
[¢d_p]*
by‹_sz
,
MPI_BYTE
,snd_p,0,

443 
rcv_buff
[
rcv_p
],
Äcv_comm
[rcv_p]*
by‹_sz
,
MPI_BYTE
,rcv_p,0,

444 
wÜld
,
MPI_STATUS_IGNORE
);

447 
d–‘e
 [] 
n¢d_comm
;

448 
d–‘e
 [] 
Äcv_comm
;

450 
d–‘e
 [] *
¢d_buff
;

451 
d–‘e
 [] 
¢d_buff
;

453 
by‹
* 
_rcv_buff
=*
rcv_buff
;

454 
ivec
=0;ivec<
Çrch_vecs_fuÎ
-1;ivec++)

455 
i
=0;i<
Äcv
;i++)

456 
¬ch_vecs_fuÎ
[
ivec
]->
	`p¡_to
(
_rcv_buff
,
idx_l¡_rcv
[
i
]);

458 
d–‘e
 [] 
idx_l¡_rcv
;

459 
d–‘e
 [] *
rcv_buff
;

460 
d–‘e
 [] 
rcv_buff
;

463 
d–‘e
 
¬ch_vecs_fuÎ
[
Çrch_vecs_fuÎ
-1];

464 
d–‘e
 [] 
¬ch_vecs_fuÎ
;

465 
¬ch_vecs_fuÎ
=
NULL
;

466 
Çrch_vecs_fuÎ
=0;

467 
	}
}

471 
	gNewDyÇmic
::
NewDyÇmic
(
Atoms
* 
__©oms
,
FÜûF›ld
* 
__ff
,

472 
¡d
::
š™Ÿliz”_li¡
<
vec
*> 
__updt_vecs_def
,¡d::š™Ÿliz”_li¡<vec*> 
__updt_vecs
,

473 
¡d
::
š™Ÿliz”_li¡
<
vec
*> 
__xchng_comp_vecs_def
,¡d::š™Ÿliz”_li¡<vec*> 
__xchng_comp_vecs
,

474 
¡d
::
š™Ÿliz”_li¡
<
vec
*> 
__¬ch_vecs_def
,¡d::š™Ÿliz”_li¡<vec*> 
__¬ch_vecs
):

475 
©oms
(
__©oms
),

476 
wÜld
(
__©oms
->
comm
.world),

477 
skš
(
__©oms
->
comm
.skin),

478 
ff
(
__ff
),

481 
updt_vecs
(
__updt_vecs_def
.
size
()+
__updt_vecs
.size()==0 ? 
NULL
: 
Ãw
 
vec
*[__updt_vecs_def.size()+__updt_vecs.size()]),

482 
nupdt_vecs
(
¡©ic_ÿ¡
<>(
__updt_vecs
.
size
()+
__updt_vecs_def
.size())),

484 
xchng_comp_vecs
(
__xchng_comp_vecs_def
.
size
()+
__xchng_comp_vecs
.size()==0 ? 
NULL
: 
Ãw
 
vec
*[__xchng_comp_vecs_def.size()+__xchng_comp_vecs.size()]),

485 
nxchng_comp_vecs
(
¡©ic_ÿ¡
<>(
__xchng_comp_vecs
.
size
()+
__xchng_comp_vecs_def
.size())),

487 
¬ch_vecs
(
__¬ch_vecs_def
.
size
()+
__¬ch_vecs
.size()==0 ? 
NULL
: 
Ãw
 
vec
*[__arch_vecs_def.size()+__arch_vecs.size()]),

488 
Çrch_vecs
(
¡©ic_ÿ¡
<>(
__¬ch_vecs
.
size
()+
__¬ch_vecs_def
.size())),

490 
nupdt_vecs_fuÎ
(0),

491 
nxchng_vecs_fuÎ
(0),

492 
¬ch_vecs_fuÎ
(
NULL
),

493 
	$Çrch_vecs_fuÎ
(0)

495 
	`memıy
(
updt_vecs
,
__updt_vecs_def
.
	`begš
(),__updt_vecs_def.
	`size
()*(
vec
*));

496 
	`memıy
(
updt_vecs
+
__updt_vecs_def
.
	`size
(),
__updt_vecs
.
	`begš
(),__updt_vecs.size()*(
vec
*));

498 
	`memıy
(
xchng_comp_vecs
,
__xchng_comp_vecs_def
.
	`begš
(),__xchng_comp_vecs_def.
	`size
()*(
vec
*));

499 
	`memıy
(
xchng_comp_vecs
+
__xchng_comp_vecs_def
.
	`size
(),
__xchng_comp_vecs
.
	`begš
(),__xchng_comp_vecs.size()*(
vec
*));

501 
	`memıy
(
¬ch_vecs
,
__¬ch_vecs_def
.
	`begš
(),__¬ch_vecs_def.
	`size
()*(
vec
*));

502 
	`memıy
(
¬ch_vecs
+
__¬ch_vecs_def
.
	`size
(),
__¬ch_vecs
.
	`begš
(),__¬ch_vecs.size()*(
vec
*));

503 
	}
}

507 
	gNewDyÇmic
::~
	$NewDyÇmic
()

509 
d–‘e
 [] 
¬ch_vecs
;

510 
d–‘e
 [] 
xchng_comp_vecs
;

511 
d–‘e
 [] 
updt_vecs
;

512 
	}
}

516 
	gNewDyÇmic
::
	$add_xchng
(
vec
* 
v
)

518 
vec
** 
__xchng_comp_vecs
=
Ãw
 vec*[
nxchng_comp_vecs
+1];

519 
	`memıy
(
__xchng_comp_vecs
,
xchng_comp_vecs
,
nxchng_comp_vecs
*(
vec
*));

520 
d–‘e
 [] 
xchng_comp_vecs
;

521 
xchng_comp_vecs
=
__xchng_comp_vecs
;

522 
xchng_comp_vecs
[
nxchng_comp_vecs
++]=
v
;

523 
	}
}

527 
	gNewDyÇmic
::
	$add_updt
(
vec
* 
v
)

529 
vec
** 
__updt_vecs
=
Ãw
 vec*[
nupdt_vecs
+1];

530 
	`memıy
(
__updt_vecs
,
updt_vecs
,
nupdt_vecs
*(
vec
*));

531 
d–‘e
 [] 
updt_vecs
;

532 
updt_vecs
=
__updt_vecs
;

533 
updt_vecs
[
nupdt_vecs
++]=
v
;

534 
	}
}

538 
	gNewDyÇmic
::
	$ü—‹_dyÇmic_vecs
()

541 
dyÇmic_vecs_ıùy
=
©oms
->
nvecs
;

542 
vec
** 
dyÇmic_vecs
;

543 
MemÜy
::
	`®loc
(
dyÇmic_vecs
,
dyÇmic_vecs_ıùy
);

544 
ndyÇmic_vecs
=0;

546 
nupdt_vecs_fuÎ
=0;

547 
i
=0;i<
nupdt_vecs
;i++)

548 if(!
updt_vecs
[
i
]->
	`is_em±y
())

550 
dyÇmic_vecs
[
ndyÇmic_vecs
++]=
updt_vecs
[
i
];

551 
nupdt_vecs_fuÎ
++;

554 
nxchng_vecs_fuÎ
=
nupdt_vecs_fuÎ
;

555 
i
=0;i<
nxchng_comp_vecs
;i++)

556 if(!
xchng_comp_vecs
[
i
]->
	`is_em±y
())

558 
dyÇmic_vecs
[
ndyÇmic_vecs
++]=
xchng_comp_vecs
[
i
];

559 
nxchng_vecs_fuÎ
++;

563 autØ
is_š
=[](
vec
*& 
v
,vec**& 
vs
,& 
nvs
)->
boŞ


566 
i
=0;i<
nvs
;i++)

567 if(
vs
[
i
]==
v
è 
Œue
;

568  
çl£
;

571 
vec
** 
®l_vecs
=
©oms
->
vecs
;

572 
ÇÎ_vecs
=
©oms
->
nvecs
;

573 
i
=0;i<
ÇÎ_vecs
;i++)

575 if(
®l_vecs
[
i
]->
	`is_em±y
()) ;

576 if(
	`is_š
(
®l_vecs
[
i
],
dyÇmic_vecs
,
nxchng_vecs_fuÎ
)) ;

577 if(
	`is_š
(
®l_vecs
[
i
],
¬ch_vecs_fuÎ
,
Çrch_vecs_fuÎ
)) ;

578 
dyÇmic_vecs
[
ndyÇmic_vecs
++]=
®l_vecs
[
i
];

583 
MemÜy
::
	`shršk_to_f™
(
dyÇmic_vecs
,
ndyÇmic_vecs
,
dyÇmic_vecs_ıùy
);

584 
d–‘e
 [] 
©oms
->
dyÇmic_vecs
;

585 
©oms
->
dyÇmic_vecs
=dynamic_vecs;

586 
©oms
->
ndyÇmic_vecs
=ndynamic_vecs;

587 
	}
}

591 
	gNewDyÇmic
::
	$de¡roy_dyÇmic_vecs
()

593 
d–‘e
 [] 
©oms
->
dyÇmic_vecs
;

594 
©oms
->
dyÇmic_vecs
=
NULL
;

595 
©oms
->
ndyÇmic_vecs
=0;

597 
nxchng_vecs_fuÎ
=
nupdt_vecs_fuÎ
=0;

598 
	}
}

602 
	gNewDyÇmic
::
	$¡Üe_¬ch_vecs
()

605 
MemÜy
::
	`®loc
(
¬ch_vecs_fuÎ
,
Çrch_vecs
+1);

606 
Çrch_vecs_fuÎ
=0;

607 
i
=0;i<
Çrch_vecs
;i++)

608 if(!
¬ch_vecs
[
i
]->
	`is_em±y
())

609 
¬ch_vecs_fuÎ
[
Çrch_vecs_fuÎ
++]=
¬ch_vecs
[
i
];

610 if(
Çrch_vecs_fuÎ
)

611 
¬ch_vecs_fuÎ
[
Çrch_vecs_fuÎ
++]=
Ãw
 
Vec
<>(
©oms
,1,"id_arch");

612 
MemÜy
::
	`shršk_to_f™
(
¬ch_vecs_fuÎ
,
Çrch_vecs_fuÎ
,
Çrch_vecs
+1);

613 if(!
Çrch_vecs_fuÎ
) ;

615 * 
id_0
=
©oms
->
id
->
	`begš
();

616 * 
id_1
=
»š‹½»t_ÿ¡
<*>(
¬ch_vecs_fuÎ
[
Çrch_vecs_fuÎ
-1]->
	`begš
());

617 
	`memıy
(
id_1
,
id_0
,
©oms
->
Çtms_lş
*());

618 
	}
}

622 
	gNewDyÇmic
::
	$»¡Üe_¬ch_vecs
()

624 if(!
Çrch_vecs_fuÎ
) ;

626 cÚ¡ 
tÙ_p
=
CommuniÿtiÚ
::
	`g‘_size
(
wÜld
);

627 cÚ¡ 
my_p
=
CommuniÿtiÚ
::
	`g‘_¿nk
(
wÜld
);

628 
MPI_Comm
& 
__wÜld
=
wÜld
;

631 
by‹_sz
=0;

632 
ivec
=0;ivec<
Çrch_vecs_fuÎ
-1;ivec++)

633 
by‹_sz
+=
¬ch_vecs_fuÎ
[
ivec
]->byte_sz;

635 
Vec
<>* 
id_¬ch
=
dyÇmic_ÿ¡
<Vec<>*>(
¬ch_vecs_fuÎ
[
Çrch_vecs_fuÎ
-1]);

636 
Çtms_Şd
=
id_¬ch
->
vec_sz
;

637 * 
id_Şd
=
id_¬ch
->
	`begš
();

638 * 
key_Şd
=
NULL
;

639 if(
Çtms_Şd
è
key_Şd
=
Ãw
 [natms_old];

640 
i
=0;i<
Çtms_Şd
;i++è
key_Şd
[i]=i;

641 
XM©h
::
	`quicksÜt
(
key_Şd
,key_Şd+
Çtms_Şd


642 ,[&
id_Şd
](* 
¿nk_i
,* 
¿nk_j
){ (id_old[*rank_i]<id_old[*rank_j]);}

643 ,[](* 
¿nk_i
,* 
¿nk_j
){
¡d
::
	`sw­
(*rank_i,*rank_j);}

646 
Çtms_Ãw
=
©oms
->
id
->
vec_sz
;

647 * 
id_Ãw
=
©oms
->
id
->
	`begš
();

648 * 
key_Ãw
=
NULL
;

649 if(
Çtms_Ãw
è
key_Ãw
=
Ãw
 [natms_new];

650 
i
=0;i<
Çtms_Ãw
;i++è
key_Ãw
[i]=i;

651 
XM©h
::
	`quicksÜt
(
key_Ãw
,key_Ãw+
Çtms_Ãw


652 ,[&
id_Ãw
](* 
¿nk_i
,* 
¿nk_j
){ (id_new[*rank_i]<id_new[*rank_j]);}

653 ,[](* 
¿nk_i
,* 
¿nk_j
){
¡d
::
	`sw­
(*rank_i,*rank_j);}

657 
n¢d
=0;

658 * 
idx_l¡_¢d
=
NULL
;

659 * 
id_l¡_¢d
=
NULL
;

660 if(
Çtms_Şd
)

662 
idx_l¡_¢d
=
Ãw
 [
Çtms_Şd
];

663 
id_l¡_¢d
=
Ãw
 [
Çtms_Şd
];

666 
Äcv
=0;

667 * 
idx_l¡_rcv
=
NULL
;

668 * 
id_l¡_rcv
=
NULL
;

669 if(
Çtms_Ãw
)

671 
idx_l¡_rcv
=
Ãw
 [
Çtms_Ãw
];

672 
id_l¡_rcv
=
Ãw
 [
Çtms_Ãw
];

675 
nk“p
=0;

676 * 
idx_k“p_Şd
=
NULL
;

677 * 
idx_k“p_Ãw
=
NULL
;

678 if(
	`MIN
(
Çtms_Şd
,
Çtms_Ãw
))

680 
idx_k“p_Şd
=
Ãw
 [
	`MIN
(
Çtms_Şd
,
Çtms_Ãw
)];

681 
idx_k“p_Ãw
=
Ãw
 [
	`MIN
(
Çtms_Şd
,
Çtms_Ãw
)];

684 
i_Şd
=0,
i_Ãw
=0;

685 ;
i_Şd
<
Çtms_Şd
 && 
i_Ãw
<
Çtms_Ãw
;)

687 if(
id_Şd
[
key_Şd
[
i_Şd
]]<
id_Ãw
[
key_Ãw
[
i_Ãw
]])

689 
id_l¡_¢d
[
n¢d
]=
id_Şd
[
key_Şd
[
i_Şd
]];

690 
idx_l¡_¢d
[
n¢d
++]=
key_Şd
[
i_Şd
++];

692 if(
id_Şd
[
key_Şd
[
i_Şd
]]>
id_Ãw
[
key_Ãw
[
i_Ãw
]])

694 
id_l¡_rcv
[
Äcv
]=
id_Ãw
[
key_Ãw
[
i_Ãw
]];

695 
idx_l¡_rcv
[
Äcv
++]=
key_Ãw
[
i_Ãw
++];

699 
idx_k“p_Şd
[
nk“p
]=
key_Şd
[
i_Şd
++];

700 
idx_k“p_Ãw
[
nk“p
++]=
key_Ãw
[
i_Ãw
++];

704 ;
i_Şd
<
Çtms_Şd
;)

706 
id_l¡_¢d
[
n¢d
]=
id_Şd
[
key_Şd
[
i_Şd
]];

707 
idx_l¡_¢d
[
n¢d
++]=
key_Şd
[
i_Şd
++];

709 ;
i_Ãw
<
Çtms_Ãw
;)

711 
id_l¡_rcv
[
Äcv
]=
id_Ãw
[
key_Ãw
[
i_Ãw
]];

712 
idx_l¡_rcv
[
Äcv
++]=
key_Ãw
[
i_Ãw
++];

715 
d–‘e
 [] 
key_Şd
;

716 
d–‘e
 [] 
key_Ãw
;

718 
MemÜy
::
	`shršk_to_f™
(
id_l¡_¢d
,
n¢d
,
Çtms_Şd
);

719 
MemÜy
::
	`shršk_to_f™
(
idx_l¡_¢d
,
n¢d
,
Çtms_Şd
);

720 
MemÜy
::
	`shršk_to_f™
(
id_l¡_rcv
,
Äcv
,
Çtms_Ãw
);

721 
MemÜy
::
	`shršk_to_f™
(
idx_l¡_rcv
,
Äcv
,
Çtms_Ãw
);

722 
MemÜy
::
	`shršk_to_f™
(
idx_k“p_Şd
,
nk“p
,
	`MIN
(
Çtms_Şd
,
Çtms_Ãw
));

723 
MemÜy
::
	`shršk_to_f™
(
idx_k“p_Ãw
,
nk“p
,
	`MIN
(
Çtms_Şd
,
Çtms_Ãw
));

726 autØ
sÜt_idx_by_p
=

727 [&
__wÜld
,&
my_p
,&
tÙ_p
] (cÚ¡ * 
l¡
,
l¡_sz
,cÚ¡ * 
sub_l¡
,
sub_l¡_sz
,

728 *& 
sub_l¡_idx
,* 
comm_size
)->

730 

=0;<
tÙ_p
;ip++)

731 
comm_size
[

]=0;

733 
max_l¡_sz
;

734 
	`MPI_AÎ»duû
(&
l¡_sz
,&
max_l¡_sz
,1,
MPI_INT
,
MPI_MAX
,
__wÜld
);

735 
mÙh”_l¡_sz
;

736 * 
mÙh”_l¡
=
NULL
;

737 if(
max_l¡_sz
è
mÙh”_l¡
=
Ãw
 [max_lst_sz];

739 
âd_sz
,
uâd_sz
;

741 * 
uâd
=
NULL
;

742 * 
uâd_idx
=
NULL
;

743 * 
âd_idx
=
NULL
;

744 if(
sub_l¡_sz
)

746 
uâd
=
Ãw
 [
sub_l¡_sz
];

747 
uâd_idx
=
Ãw
 [
sub_l¡_sz
];

748 
âd_idx
=
Ãw
 [
sub_l¡_sz
];

751 
âd_sz
=0;

752 
uâd_sz
=
sub_l¡_sz
;

753 
	`memıy
(
uâd
,
sub_l¡
,
sub_l¡_sz
*());

754 
	`memıy
(
uâd_idx
,
sub_l¡_idx
,
sub_l¡_sz
*());

755 
imÙh”_l¡
,
iuâd
,
uâd_tmp_sz
,

=0;<
tÙ_p
;ip++)

757 if(

==
my_p
)

759 
mÙh”_l¡_sz
=
l¡_sz
;

760 
	`memıy
(
mÙh”_l¡
,
l¡
,
mÙh”_l¡_sz
*());

762 
	`MPI_Bÿ¡
(&
mÙh”_l¡_sz
,1,
MPI_INT
,

,
__wÜld
);

763 
	`MPI_Bÿ¡
(
mÙh”_l¡
,
mÙh”_l¡_sz
*(),
MPI_BYTE
,

,
__wÜld
);

765 if(

==
my_p
 || 
uâd_sz
==0 || 
mÙh”_l¡_sz
==0) ;

767 
uâd_tmp_sz
=0;

768 
imÙh”_l¡
=0,
iuâd
=0;imÙh”_l¡<
mÙh”_l¡_sz
 && iuâd<
uâd_sz
;)

770 if(
mÙh”_l¡
[
imÙh”_l¡
]<
uâd
[
iuâd
])

771 
imÙh”_l¡
++;

772 if(
mÙh”_l¡
[
imÙh”_l¡
]>
uâd
[
iuâd
])

774 
uâd_idx
[
uâd_tmp_sz
]=uâd_idx[
iuâd
];

775 
uâd
[
uâd_tmp_sz
++]=uâd[
iuâd
++];

779 
âd_idx
[
âd_sz
++]=
uâd_idx
[
iuâd
++];

780 
imÙh”_l¡
++;

781 
comm_size
[

]++;

785 ;
iuâd
<
uâd_sz
;)

787 
uâd_idx
[
uâd_tmp_sz
]=uâd_idx[
iuâd
];

788 
uâd
[
uâd_tmp_sz
++]=uâd[
iuâd
++];

791 
uâd_sz
=
uâd_tmp_sz
;

795 
d–‘e
 [] 
sub_l¡_idx
;

796 
sub_l¡_idx
=
âd_idx
;

797 
d–‘e
 [] 
uâd
;

798 
d–‘e
 [] 
uâd_idx
;

799 
d–‘e
 [] 
mÙh”_l¡
;

802 * 
n¢d_comm
=
Ãw
 [
tÙ_p
];

803 * 
Äcv_comm
=
Ãw
 [
tÙ_p
];

804 
	`sÜt_idx_by_p
(
id_l¡_rcv
,
Äcv
,
id_l¡_¢d
,
n¢d
,
idx_l¡_¢d
,
n¢d_comm
);

805 
	`sÜt_idx_by_p
(
id_l¡_¢d
,
n¢d
,
id_l¡_rcv
,
Äcv
,
idx_l¡_rcv
,
Äcv_comm
);

806 
d–‘e
 [] 
id_l¡_¢d
;

807 
d–‘e
 [] 
id_l¡_rcv
;

810 
by‹
** 
¢d_buff
=
Ãw
 by‹*[
tÙ_p
];

811 *
¢d_buff
=
NULL
;

812 if(
n¢d
)

814 *
¢d_buff
=
Ãw
 
by‹
[
by‹_sz
*
n¢d
];

815 

=1;<
tÙ_p
;ip++)

816 
¢d_buff
[

]=¢d_buff[-1]+
by‹_sz
*
n¢d_comm
[ip-1];

819 
by‹
** 
rcv_buff
=
Ãw
 by‹*[
tÙ_p
];

820 *
rcv_buff
=
NULL
;

821 if(
Äcv
)

823 *
rcv_buff
=
Ãw
 
by‹
[
by‹_sz
*
Äcv
];

824 

=1;<
tÙ_p
;ip++)

825 
rcv_buff
[

]ôcv_buff[-1]+
by‹_sz
*
Äcv_comm
[ip-1];

828 
by‹
* 
_¢d_buff
=*
¢d_buff
;

829 
ivec
=0;ivec<
Çrch_vecs_fuÎ
-1;ivec++)

830 
i
=0;i<
n¢d
;i++)

831 
¬ch_vecs_fuÎ
[
ivec
]->
	`ıy
(
_¢d_buff
,
idx_l¡_¢d
[
i
]);

832 
d–‘e
 [] 
idx_l¡_¢d
;

835 
ivec
=0;ivec<
Çrch_vecs_fuÎ
-1;ivec++)

836 
¬ch_vecs_fuÎ
[
ivec
]->
	`»¬¿nge
(
idx_k“p_Şd
,
idx_k“p_Ãw
,
nk“p
,
Çtms_Ãw
);

837 
d–‘e
 [] 
idx_k“p_Şd
;

838 
d–‘e
 [] 
idx_k“p_Ãw
;

841 
idi¥
=1;idi¥<
tÙ_p
;idisp++)

843 
rcv_p
=
my_p
-
idi¥
;

844 if(
rcv_p
<0èrcv_p+=
tÙ_p
;

845 
¢d_p
=
my_p
+
idi¥
;

846 if(
¢d_p
>=
tÙ_p
) snd_p-=tot_p;

847 
	`MPI_S’d»cv
(
¢d_buff
[
¢d_p
],
n¢d_comm
[¢d_p]*
by‹_sz
,
MPI_BYTE
,snd_p,0,

848 
rcv_buff
[
rcv_p
],
Äcv_comm
[rcv_p]*
by‹_sz
,
MPI_BYTE
,rcv_p,0,

849 
wÜld
,
MPI_STATUS_IGNORE
);

852 
d–‘e
 [] 
n¢d_comm
;

853 
d–‘e
 [] 
Äcv_comm
;

855 
d–‘e
 [] *
¢d_buff
;

856 
d–‘e
 [] 
¢d_buff
;

858 
by‹
* 
_rcv_buff
=*
rcv_buff
;

859 
ivec
=0;ivec<
Çrch_vecs_fuÎ
-1;ivec++)

860 
i
=0;i<
Äcv
;i++)

861 
¬ch_vecs_fuÎ
[
ivec
]->
	`p¡_to
(
_rcv_buff
,
idx_l¡_rcv
[
i
]);

863 
d–‘e
 [] 
idx_l¡_rcv
;

864 
d–‘e
 [] *
rcv_buff
;

865 
d–‘e
 [] 
rcv_buff
;

868 
d–‘e
 
¬ch_vecs_fuÎ
[
Çrch_vecs_fuÎ
-1];

869 
d–‘e
 [] 
¬ch_vecs_fuÎ
;

870 
¬ch_vecs_fuÎ
=
NULL
;

871 
Çrch_vecs_fuÎ
=0;

872 
	}
}

	@dynamic.h

1 #iâdeà
__MAPP__dyÇmic__


2 
	#__MAPP__dyÇmic__


	)

4 
	~<š™Ÿliz”_li¡
>

5 
	~<mpi.h
>

6 
	~"glob®.h
"

7 
	~"exchªge.h
"

9 
Çme¥aû
 
	gMAPP_NS


11 
şass
 
	gvec
;

12 
	g‹m¶©e
<
	gty³Çme
> 
şass
 
	gVec
;

13 şas 
	cDyÇmic


15 
	g´iv©e
:

16 
¡Üe_x0
();

17 
boŞ
 
decide
();

18 
şass
 
FÜûF›ld
* 
	gff
;

19 
şass
 
Atoms
* 
	g©oms
;

20 
	g´Ùeùed
:

21 
¡Üe_¬ch_vecs
();

22 
»¡Üe_¬ch_vecs
();

23 
ü—‹_dyÇmic_vecs
();

24 
de¡roy_dyÇmic_vecs
();

26 cÚ¡ 
boŞ
 
	gchng_box
;

28 
vec
** 
	g¬ch_vecs
;

29 
	gÇrch_vecs
;

30 
vec
** 
	gxchng_comp_vecs
;

31 
	gnxchng_comp_vecs
;

32 
vec
** 
	gupdt_vecs
;

33 
	gnupdt_vecs
;

34 
	gnupdt_vecs_fuÎ
;

35 
	gnxchng_vecs_fuÎ
;

36 
vec
** 
	g¬ch_vecs_fuÎ
;

37 
	gÇrch_vecs_fuÎ
;

40 
	gMPI_Comm
& 
	gwÜld
;

42 
Exchªge
* 
	gxchng
;

43 
Upd©e
* 
	gupdt
;

45 cÚ¡ 
ty³0
 
	gskš
;

47 
	gpublic
:

48 
DyÇmic
(
şass
 
Atoms
*,şas 
FÜûF›ld
*,
boŞ
,

49 
¡d
::
š™Ÿliz”_li¡
<
vec
*>,std::initializer_list<vec*>,

50 
¡d
::
š™Ÿliz”_li¡
<
vec
*>,std::initializer_list<vec*>,

51 
¡d
::
š™Ÿliz”_li¡
<
vec
*>,std::initializer_list<vec*>);

52 
	gvœtu®
 ~
DyÇmic
();

54 
vœtu®
 
add_xchng
(
vec
*);

55 
vœtu®
 
add_updt
(
vec
*);

62 
Çme¥aû
 
	gMAPP_NS


64 
şass
 
	gvec
;

65 
	g‹m¶©e
<
	gty³Çme
> 
şass
 
	gVec
;

66 şas 
	cNewDyÇmic


68 
	g´iv©e
:

69 
¡Üe_x0
();

70 
boŞ
 
decide
();

71 
şass
 
FÜûF›ld
* 
	gff
;

72 
şass
 
Atoms
* 
	g©oms
;

73 
	g´Ùeùed
:

74 
¡Üe_¬ch_vecs
();

75 
»¡Üe_¬ch_vecs
();

76 
ü—‹_dyÇmic_vecs
();

77 
de¡roy_dyÇmic_vecs
();

79 
vec
** 
	g¬ch_vecs
;

80 
	gÇrch_vecs
;

81 
vec
** 
	gxchng_comp_vecs
;

82 
	gnxchng_comp_vecs
;

83 
vec
** 
	gupdt_vecs
;

84 
	gnupdt_vecs
;

85 
	gnupdt_vecs_fuÎ
;

86 
	gnxchng_vecs_fuÎ
;

87 
vec
** 
	g¬ch_vecs_fuÎ
;

88 
	gÇrch_vecs_fuÎ
;

91 
	gMPI_Comm
& 
	gwÜld
;

93 
Exchªge
* 
	gxchng
;

94 
Upd©e
* 
	gupdt
;

96 cÚ¡ 
ty³0
 
	gskš
;

98 
	gpublic
:

99 
NewDyÇmic
(
şass
 
Atoms
*,şas 
FÜûF›ld
*,

100 
¡d
::
š™Ÿliz”_li¡
<
vec
*>,std::initializer_list<vec*>,

101 
¡d
::
š™Ÿliz”_li¡
<
vec
*>,std::initializer_list<vec*>,

102 
¡d
::
š™Ÿliz”_li¡
<
vec
*>,std::initializer_list<vec*>);

103 
	gvœtu®
 ~
NewDyÇmic
();

105 
vœtu®
 
add_xchng
(
vec
*);

106 
vœtu®
 
add_updt
(
vec
*);

	@dynamic_dmd.cpp

1 
	~"comm.h
"

2 
	~"dyÇmic_dmd.h
"

3 
	~"xm©h.h
"

4 
	~"MAPP.h
"

7 #ifdeà
OLD_UPDATE


8 
	~"©oms_dmd.h
"

9 
	~"ff_¡yËs.h
"

10 
	~"ÃighbÜ_dmd.h
"

13 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

17 
	gDyÇmicDMD
::
DyÇmicDMD
(
AtomsDMD
* 
__©oms
,
FÜûF›ldDMD
* 
__ff
,
boŞ
 
__chng_box
,

18 
¡d
::
š™Ÿliz”_li¡
<
vec
*> 
__updt_vecs
,

19 
¡d
::
š™Ÿliz”_li¡
<
vec
*> 
__xchng_comp_vecs
,

20 
¡d
::
š™Ÿliz”_li¡
<
vec
*> 
__¬ch_vecs
):

21 
DyÇmic
(
__©oms
,
__ff
,
__chng_box
,

22 {
__©oms
->
x
,__©oms->
®pha
,__©oms->
c
,__©oms->
–em
},
__updt_vecs
,

23 {
__©oms
->
id
},
__xchng_comp_vecs
,

24 {},
__¬ch_vecs
),

25 
©oms
(
__©oms
),

26 
ff
(
__ff
),

27 
c_dim
(
__©oms
->
c
->
dim
),

28 
®pha_sÿË
(
__©oms
->
xi
[__©oms->
N
-1]),

29 
x0
(
NULL
),

30 
	$®pha0
(
NULL
)

32 
	}
}

36 
	gDyÇmicDMD
::~
	$DyÇmicDMD
()

38 
	}
}

42 
DyÇmicDMD
::
	$š™
()

45 
	`¡Üe_¬ch_vecs
();

46 
	`ü—‹_dyÇmic_vecs
();

47 
x0
=
Ãw
 
Vec
<
ty³0
>(
©oms
,
__dim__
,"x0");

48 
®pha0
=
Ãw
 
Vec
<
ty³0
>(
©oms
,
c_dim
,"alpha0");

49 
ff
->
	`š™
();

50 
ff
->
ÃighbÜ
->
	`š™
();

51 
©oms
->
max_cut
=
ff
->max_cut+©oms->
comm
.
skš
+
®pha_sÿË
*
sq¹_2
*©oms->
max_®pha
;

53 
xchng
=
Ãw
 
	`Exchªge
(
©oms
,
nxchng_vecs_fuÎ
);

54 
updt
=
Ãw
 
	`Upd©e
(
©oms
,
nupdt_vecs_fuÎ
,
nxchng_vecs_fuÎ
);

56 
ff
->
updt
=updt;

57 
©oms
->
	`x2s_lş
();

58 
xchng
->
	`fuÎ_xchng
();

59 
updt
->
	`»£t
();

60 
updt
->
	`li¡
();

61 
ff
->
ÃighbÜ
->
	`ü—‹_li¡
(
Œue
);

62 
	`¡Üe_x0
();

64 
	}
}

68 
	gDyÇmicDMD
::
	$fš
()

70 
ff
->
ÃighbÜ
->
	`fš
();

71 
ff
->
	`fš
();

73 
d–‘e
 
updt
;

74 
d–‘e
 
xchng
;

75 
d–‘e
 
®pha0
;

76 
d–‘e
 
x0
;

78 
	`»¡Üe_¬ch_vecs
();

79 
d–‘e
 [] 
©oms
->
dyÇmic_vecs
;

80 
©oms
->
dyÇmic_vecs
=
NULL
;

81 
©oms
->
ndyÇmic_vecs
=0;

83 
	`de¡roy_dyÇmic_vecs
();

84 
	`»¡Üe_¬ch_vecs
();

86 
ivec
=0;ivec<
©oms
->
nvecs
;ivec++)

87 if(!
©oms
->
vecs
[
ivec
]->
	`is_em±y
())

89 
©oms
->
vecs
[
ivec
]->
vec_sz
÷toms->
Çtms_lş
;

90 
©oms
->
vecs
[
ivec
]->
	`shršk_to_f™
();

92 
©oms
->
Çtms_ph
=0;

93 
	}
}

97 
	gDyÇmicDMD
::
	$¡Üe_x0
()

99 
Ï¡_©m
=
©oms
->
Çtms_lş
;

100 if(
chng_box
è
Ï¡_©m
+=
©oms
->
Çtms_ph
;

101 
	`memıy
(
x0
->
	`begš
(),
©oms
->
x
->begš(),
Ï¡_©m
*
__dim__
*(
ty³0
));

102 
	`memıy
(
®pha0
->
	`begš
(),
©oms
->
®pha
->begš(),
Ï¡_©m
*
c_dim
*(
ty³0
));

103 
	}
}

108 #ifdeà
OLD_UPDATE


109 
	gšlše


112 
boŞ
 
	gDyÇmicDMD
::
	$decide
()

114 
succ
,
succ_lş
=1;

115 
ty³0
* 
x_vec
=
©oms
->
x
->
	`begš
();

116 
ty³0
* 
x0_vec
=
x0
->
	`begš
();

117 
ty³0
* 
®pha_vec
=
©oms
->
®pha
->
	`begš
();

118 
ty³0
* 
®pha0_vec
=
®pha0
->
	`begš
();

119 
Ï¡_©m
=
©oms
->
Çtms_lş
;

120 if(
chng_box
è
Ï¡_©m
+=
©oms
->
Çtms_ph
;

122 
Ÿtm
=0;
succ_lş
 && i©m<
Ï¡_©m
;Ÿtm++,
x0_vec
+=
__dim__
,
x_vec
+=__dim__,
®pha_vec
+=
c_dim
,
®pha0_vec
+=c_dim)

124 
ty³0
 
dr
=
	`sq¹
(
Algeb¿
::
RSQ
<
__dim__
>(
x0_vec
,
x_vec
));

125 
ty³0
 
d®pha
=
®pha_vec
[0]-
®pha0_vec
[0];

126 
i
=0;i<
c_dim
;i++)

127 
d®pha
=
	`MAX
(d®pha,
®pha_vec
[
i
]-
®pha0_vec
[i]);

129 if(
dr
+
d®pha
*
®pha_sÿË
>0.5*
skš
è
succ_lş
=0;

132 
	`MPI_AÎ»duû
(&
succ_lş
,&
succ
,1,
MPI_INT
,
MPI_MIN
,
wÜld
);

133 if(
succ
è 
Œue
;

134  
çl£
;

135 
	}
}

136 #ifdeà
OLD_UPDATE


140 
	gDyÇmicDMD
::
	$upd©e
(
vec
* 
updt_vec
)

142 
	`upd©e
(&
updt_vec
,1);

143 
	}
}

147 
	gDyÇmicDMD
::
upd©e
(
vec
* 
dx
,
ty³0
 (*
dH
)[
__dim__
])

149 
	gupdt
->
upd©e
(
dx
,
dH
);

154 
	gDyÇmicDMD
::
	$upd©e
(
vec
** 
updt_vecs
,
nupdt_vecs
)

156 
boŞ
 
x_x¡
=
çl£
;

157 
ivec
=0;
x_x¡
==
çl£
 && ivec<
nupdt_vecs
;ivec++)

158 if(
updt_vecs
[
ivec
]==
©oms
->
x
)

159 
x_x¡
=
Œue
;

160 if(
x_x¡
==
çl£
)

162 if(
nupdt_vecs
==1)

163 
updt
->
	`upd©e
(
updt_vecs
[0],
çl£
);

165 
updt
->
	`upd©e
(
updt_vecs
,
nupdt_vecs
,
çl£
);

170 if(
chng_box
)

172 if(
nupdt_vecs
==1)

173 
updt
->
	`upd©e
(
©oms
->
x
,
Œue
);

175 
updt
->
	`upd©e
(
updt_vecs
,
nupdt_vecs
,
Œue
);

177 if(
	`decide
())

180 
©oms
->
	`x2s_lş
();

181 
xchng
->
	`fuÎ_xchng
();

182 
©oms
->
max_cut
=
ff
->max_cut+©oms->
comm
.
skš
+
®pha_sÿË
*
sq¹_2
*©oms->
max_®pha
;

183 
updt
->
	`»£t
();

184 
updt
->
	`li¡
();

185 
ff
->
ÃighbÜ
->
	`ü—‹_li¡
(
Œue
);

186 
	`¡Üe_x0
();

190 if(
	`decide
())

192 if(
nupdt_vecs
==1)

193 
updt
->
	`upd©e
(
©oms
->
x
,
Œue
);

195 
updt
->
	`upd©e
(
updt_vecs
,
nupdt_vecs
,
Œue
);

199 
©oms
->
	`x2s_lş
();

200 
xchng
->
	`fuÎ_xchng
();

201 
©oms
->
max_cut
=
ff
->max_cut+©oms->
comm
.
skš
+
®pha_sÿË
*
sq¹_2
*©oms->
max_®pha
;

202 
updt
->
	`»£t
();

203 
updt
->
	`li¡
();

204 
ff
->
ÃighbÜ
->
	`ü—‹_li¡
(
Œue
);

205 
	`¡Üe_x0
();

207 
	}
}

210 #ifdeà
OLD_UPDATE


220 
	g‹m¶©e
<>

221 
	gNewDyÇmicDMD
<
	gŒue
,Œue,Œue>::
	$®loc_x0_®pha0
()

223 
x0
=
Ãw
 
Vec
<
ty³0
>(
©oms
,
__dim__
,"x0");

224 
®pha0
=
Ãw
 
Vec
<
ty³0
>(
©oms
,
c_dim
,"alpha0");

225 
	}
}

229 
	g‹m¶©e
<>

230 
	gNewDyÇmicDMD
<
	gŒue
,Œue,Œue>::
	$¡Üe_x0_®pha0
()

232 
	`memıy
(
x0
->
	`begš
(),
©oms
->
x
->begš(),×toms->
Çtms_lş
+©oms->
Çtms_ph
)*
__dim__
*(
ty³0
));

233 
	`memıy
(
®pha0
->
	`begš
(),
©oms
->
®pha
->begš(),×toms->
Çtms_lş
+©oms->
Çtms_ph
)*
c_dim
*(
ty³0
));

234 
	}
}

238 
	g‹m¶©e
<>

239 
boŞ
 
	gNewDyÇmicDMD
<
	gŒue
,Œue,Œue>::
	$decide
()

241 
succ
,
succ_lş
=1;

242 
ty³0
* 
x_vec
=
©oms
->
x
->
	`begš
();

243 
ty³0
* 
x0_vec
=
x0
->
	`begš
();

244 
ty³0
* 
®pha_vec
=
©oms
->
®pha
->
	`begš
();

245 
ty³0
* 
®pha0_vec
=
®pha0
->
	`begš
();

246 
Ï¡_©m
=
©oms
->
Çtms_lş
+©oms->
Çtms_ph
;

248 
Ÿtm
=0;
succ_lş
 && i©m<
Ï¡_©m
;Ÿtm++,
x0_vec
+=
__dim__
,
x_vec
+=__dim__,
®pha_vec
+=
c_dim
,
®pha0_vec
+=c_dim)

250 
ty³0
 
dr
=
	`sq¹
(
Algeb¿
::
RSQ
<
__dim__
>(
x0_vec
,
x_vec
));

251 
ty³0
 
d®pha
=
®pha_vec
[0]-
®pha0_vec
[0];

252 
i
=0;i<
c_dim
;i++)

253 
d®pha
=
	`MAX
(d®pha,
®pha_vec
[
i
]-
®pha0_vec
[i]);

255 if(
dr
+
d®pha
*
®pha_sÿË
>0.5*
skš
è
succ_lş
=0;

258 
	`MPI_AÎ»duû
(&
succ_lş
,&
succ
,1,
MPI_INT
,
MPI_MIN
,
wÜld
);

259 if(
succ
è 
Œue
;

260  
çl£
;

261 
	}
}

270 
	g‹m¶©e
<>

271 
	gNewDyÇmicDMD
<
	gçl£
,
	gŒue
,Œue>::
	$®loc_x0_®pha0
()

273 
x0
=
Ãw
 
Vec
<
ty³0
>(
©oms
,
__dim__
,"x0");

274 
®pha0
=
Ãw
 
Vec
<
ty³0
>(
©oms
,
c_dim
,"alpha0");

275 
	}
}

279 
	g‹m¶©e
<>

280 
	gNewDyÇmicDMD
<
	gçl£
,
	gŒue
,Œue>::
	$¡Üe_x0_®pha0
()

282 
	`memıy
(
x0
->
	`begš
(),
©oms
->
x
->begš(),×toms->
Çtms_lş
)*
__dim__
*(
ty³0
));

283 
	`memıy
(
®pha0
->
	`begš
(),
©oms
->
®pha
->begš(),×toms->
Çtms_lş
)*
c_dim
*(
ty³0
));

284 
	}
}

288 
	g‹m¶©e
<>

289 
boŞ
 
	gNewDyÇmicDMD
<
	gçl£
,
	gŒue
,Œue>::
	$decide
()

291 
succ
,
succ_lş
=1;

292 
ty³0
* 
x_vec
=
©oms
->
x
->
	`begš
();

293 
ty³0
* 
x0_vec
=
x0
->
	`begš
();

294 
ty³0
* 
®pha_vec
=
©oms
->
®pha
->
	`begš
();

295 
ty³0
* 
®pha0_vec
=
®pha0
->
	`begš
();

296 
Ï¡_©m
=
©oms
->
Çtms_lş
;

298 
Ÿtm
=0;
succ_lş
 && i©m<
Ï¡_©m
;Ÿtm++,
x0_vec
+=
__dim__
,
x_vec
+=__dim__,
®pha_vec
+=
c_dim
,
®pha0_vec
+=c_dim)

300 
ty³0
 
dr
=
	`sq¹
(
Algeb¿
::
RSQ
<
__dim__
>(
x0_vec
,
x_vec
));

301 
ty³0
 
d®pha
=
®pha_vec
[0]-
®pha0_vec
[0];

302 
i
=0;i<
c_dim
;i++)

303 
d®pha
=
	`MAX
(d®pha,
®pha_vec
[
i
]-
®pha0_vec
[i]);

305 if(
dr
+
d®pha
*
®pha_sÿË
>0.5*
skš
è
succ_lş
=0;

308 
	`MPI_AÎ»duû
(&
succ_lş
,&
succ
,1,
MPI_INT
,
MPI_MIN
,
wÜld
);

309 if(
succ
è 
Œue
;

310  
çl£
;

311 
	}
}

320 
	g‹m¶©e
<>

321 
	gNewDyÇmicDMD
<
	gŒue
,Œue,
	gçl£
>::
	$®loc_x0_®pha0
()

323 
x0
=
Ãw
 
Vec
<
ty³0
>(
©oms
,
__dim__
,"x0");

324 
	}
}

328 
	g‹m¶©e
<>

329 
	gNewDyÇmicDMD
<
	gŒue
,Œue,
	gçl£
>::
	$¡Üe_x0_®pha0
()

331 
	`memıy
(
x0
->
	`begš
(),
©oms
->
x
->begš(),×toms->
Çtms_lş
+©oms->
Çtms_ph
)*
__dim__
*(
ty³0
));

332 
	}
}

336 
	g‹m¶©e
<>

337 
boŞ
 
	gNewDyÇmicDMD
<
	gŒue
,Œue,
	gçl£
>::
	$decide
()

339 
ty³0
 
skš_sq
=0.25*
skš
*skin;

340 
succ
,
succ_lş
=1;

341 
ty³0
* 
x_vec
=
©oms
->
x
->
	`begš
();

342 
ty³0
* 
x0_vec
=
x0
->
	`begš
();

343 
Ï¡_©m
=
©oms
->
Çtms_lş
+©oms->
Çtms_ph
;

344 
Ÿtm
=0;
succ_lş
 && i©m<
Ï¡_©m
;Ÿtm++,
x0_vec
+=
__dim__
,
x_vec
+=__dim__)

345 if(
Algeb¿
::
RSQ
<
__dim__
>(
x0_vec
,
x_vec
)>
skš_sq
)

346 
succ_lş
=0;

348 
	`MPI_AÎ»duû
(&
succ_lş
,&
succ
,1,
MPI_INT
,
MPI_MIN
,
wÜld
);

349 if(
succ
è 
Œue
;

350  
çl£
;

351 
	}
}

360 
	g‹m¶©e
<>

361 
	gNewDyÇmicDMD
<
	gçl£
,
	gŒue
,çl£>::
	$®loc_x0_®pha0
()

363 
x0
=
Ãw
 
Vec
<
ty³0
>(
©oms
,
__dim__
,"x0");

364 
	}
}

368 
	g‹m¶©e
<>

369 
	gNewDyÇmicDMD
<
	gçl£
,
	gŒue
,çl£>::
	$¡Üe_x0_®pha0
()

371 
	`memıy
(
x0
->
	`begš
(),
©oms
->
x
->begš(),©oms->
Çtms_lş
*
__dim__
*(
ty³0
));

372 
	}
}

376 
	g‹m¶©e
<>

377 
boŞ
 
	gNewDyÇmicDMD
<
	gçl£
,
	gŒue
,çl£>::
	$decide
()

379 
ty³0
 
skš_sq
=0.25*
skš
*skin;

380 
succ
,
succ_lş
=1;

381 
ty³0
* 
x_vec
=
©oms
->
x
->
	`begš
();

382 
ty³0
* 
x0_vec
=
x0
->
	`begš
();

383 
Ï¡_©m
=
©oms
->
Çtms_lş
;

384 
Ÿtm
=0;
succ_lş
 && i©m<
Ï¡_©m
;Ÿtm++,
x0_vec
+=
__dim__
,
x_vec
+=__dim__)

385 if(
Algeb¿
::
RSQ
<
__dim__
>(
x0_vec
,
x_vec
)>
skš_sq
)

386 
succ_lş
=0;

388 
	`MPI_AÎ»duû
(&
succ_lş
,&
succ
,1,
MPI_INT
,
MPI_MIN
,
wÜld
);

389 if(
succ
è 
Œue
;

390  
çl£
;

391 
	}
}

400 
	g‹m¶©e
<>

401 
	gNewDyÇmicDMD
<
	gçl£
,çl£,
	gŒue
>::
	$®loc_x0_®pha0
()

403 
®pha0
=
Ãw
 
Vec
<
ty³0
>(
©oms
,
c_dim
,"alpha0");

404 
	}
}

408 
	g‹m¶©e
<>

409 
	gNewDyÇmicDMD
<
	gçl£
,çl£,
	gŒue
>::
	$¡Üe_x0_®pha0
()

411 
	`memıy
(
®pha0
->
	`begš
(),
©oms
->
®pha
->begš(),©oms->
Çtms_lş
*
c_dim
*(
ty³0
));

412 
	}
}

416 
	g‹m¶©e
<>

417 
boŞ
 
	gNewDyÇmicDMD
<
	gçl£
,çl£,
	gŒue
>::
	$decide
()

419 
succ
,
succ_lş
=1;

420 
ty³0
* 
®pha_vec
=
©oms
->
®pha
->
	`begš
();

421 
ty³0
* 
®pha0_vec
=
®pha0
->
	`begš
();

422 
Ï¡_©m
=
©oms
->
Çtms_lş
;

424 
Ÿtm
=0;
succ_lş
 && i©m<
Ï¡_©m
;Ÿtm++,
®pha_vec
+=
c_dim
,
®pha0_vec
+=c_dim)

426 
ty³0
 
d®pha
=
®pha_vec
[0]-
®pha0_vec
[0];

427 
i
=1;i<
c_dim
;i++)

428 
d®pha
=
	`MAX
(d®pha,
®pha_vec
[
i
]-
®pha0_vec
[i]);

430 if(
d®pha
*
®pha_sÿË
>0.5*
skš
è
succ_lş
=0;

433 
	`MPI_AÎ»duû
(&
succ_lş
,&
succ
,1,
MPI_INT
,
MPI_MIN
,
wÜld
);

434 if(
succ
è 
Œue
;

435  
çl£
;

436 
	}
}

445 
	g‹m¶©e
<>

446 
	gNewDyÇmicDMD
<
	gçl£
,çl£,çl£>::
	$®loc_x0_®pha0
()

448 
	}
}

452 
‹m¶©e
<>

453 
NewDyÇmicDMD
<
çl£
,
	gçl£
,çl£>::
	$¡Üe_x0_®pha0
()

455 
	}
}

	@dynamic_dmd.h

1 #iâdeà
__MAPP__dyÇmic_dmd__


2 
	#__MAPP__dyÇmic_dmd__


	)

4 
	~"dyÇmic.h
"

5 #ifdeà
OLD_UPDATE


7 
	~"©oms_dmd.h
"

8 
	~"ff_¡yËs.h
"

9 
	~"ÃighbÜ_dmd.h
"

12 
Çme¥aû
 
	gMAPP_NS


14 
şass
 
	gvec
;

15 
	g‹m¶©e
<
	gty³Çme
> 
şass
 
	gVec
;

16 şas 
	cDyÇmicDMD
: 
public
 
DyÇmic


18 
´iv©e
:

19 cÚ¡ 
c_dim
;

20 cÚ¡ 
ty³0
 
	g®pha_sÿË
;

21 
¡Üe_x0
();

22 
boŞ
 
decide
();

23 
şass
 
FÜûF›ldDMD
* 
	gff
;

24 
şass
 
AtomsDMD
* 
	g©oms
;

25 
	g´Ùeùed
:

27 
Vec
<
ty³0
>* 
x0
;

28 
	gVec
<
	gty³0
>* 
	g®pha0
;

30 
	gpublic
:

31 
DyÇmicDMD
(
şass
 
AtomsDMD
*,şas 
FÜûF›ldDMD
*,
boŞ
,

32 
¡d
::
š™Ÿliz”_li¡
<
vec
*>,std::initializer_list<vec*>,std::initializer_list<vec*> = {});

33 ~
DyÇmicDMD
();

34 #ifdeà
OLD_UPDATE


35 
upd©e
(
vec
**,);

36 
upd©e
(
vec
*);

37 
upd©e
(
vec
*,
ty³0
 (*)[
__dim__
]);

39 
	g‹m¶©e
<
	gşass
...
	gVS
>

40 
upd©e_wo_x_wo_®pha
(
VS
*&... 
__vs
)

42 
	gupdt
->
upd©e_wo_x
(
__vs
...);

45 
	g‹m¶©e
<
	gşass
...
	gVS
>

46 
upd©e_w_x_w_®pha
(
VS
*&... 
__vs
)

48 if(
	gchng_box
)

50 
	gupdt
->
upd©e_w_x
(
©oms
->
®pha
,
__vs
...);

52 if(
decide
()) ;

54 
	g©oms
->
x2s_lş
();

55 
	gxchng
->
fuÎ_xchng
();

56 
	g©oms
->
	gmax_cut
=
ff
->
max_cut
+
©oms
->
comm
.
skš
+
®pha_sÿË
*
sq¹_2
*©oms->
max_®pha
;

57 
	gupdt
->
»£t
();

58 
	gupdt
->
li¡
();

59 
	gff
->
	gÃighbÜ
->
ü—‹_li¡
(
Œue
);

60 
¡Üe_x0
();

64 if(
decide
())

66 
	gupdt
->
upd©e_w_x
(
©oms
->
®pha
,
__vs
...);

70 
	g©oms
->
x2s_lş
();

71 
	gxchng
->
fuÎ_xchng
();

72 
	g©oms
->
	gmax_cut
=
ff
->
max_cut
+
©oms
->
comm
.
skš
+
®pha_sÿË
*
sq¹_2
*©oms->
max_®pha
;

73 
	gupdt
->
»£t
();

74 
	gupdt
->
li¡
();

75 
	gff
->
	gÃighbÜ
->
ü—‹_li¡
(
Œue
);

76 
¡Üe_x0
();

84 
	g‹m¶©e
<
boŞ
 
	gX
,boŞ 
	gALPHA
>

85 şas 
	cH–³r


87 
	gpublic
:

88 
‹m¶©e
<
şass
...
VS
>

89 
upd©e
(
DyÇmicDMD
& 
dyÇmic
,
VS
*&... 
__vs
)

91 
	gdyÇmic
.
upd©e_w_x_w_®pha
(
__vs
...);

97 
	g‹m¶©e
<
boŞ
 
	gX
=
çl£
,boŞ 
	gALPHA
=çl£,
	gşass
...
	gVS
>

98 
upd©e
(
VS
*&... 
__vs
)

100 
	gH–³r
<
	gX
,
	gALPHA
>::
upd©e
(*
this
,
__vs
...);

104 
	g‹m¶©e
<
	gşass
...
	gVS
>

105 
upd©e
(
ty³0
 (*&
__dH
)[
__dim__
],
Vec
<ty³0>*& 
__v
,
VS
*&... 
__vs
)

107 
	gupdt
->
upd©e_w_x_w_dH
(
__dH
,
__v
,
__vs
...);

110 
š™
();

111 
fš
();

115 #ifdeà
OLD_UPDATE


117 
	g‹m¶©e
<>

118 
şass
 
	gDyÇmicDMD
::
H–³r
<
çl£
,
	gçl£
>

120 
	gpublic
:

121 
‹m¶©e
<
şass
...
VS
>

122 
upd©e
(
DyÇmicDMD
& 
dyÇmic
,
VS
*&... 
__vs
)

124 
	gdyÇmic
.
upd©e_wo_x_wo_®pha
(
__vs
...);

135 #ifdeà
OLD_UPDATE


142 
Çme¥aû
 
	gMAPP_NS


144 
şass
 
	gvec
;

145 
	g‹m¶©e
<
	gty³Çme
> 
şass
 
	gVec
;

147 
	g‹m¶©e
<
boŞ
 
	gBC
,boŞ 
	gX
,boŞ 
	gALPHA
>

148 şas 
	cNewDyÇmicDMD
: 
public
 
NewDyÇmic


150 
´iv©e
:

151 cÚ¡ 
c_dim
;

152 cÚ¡ 
ty³0
 
	g®pha_sÿË
;

153 
şass
 
FÜûF›ldDMD
* 
	gff
;

154 
şass
 
AtomsDMD
* 
	g©oms
;

157 
boŞ
 
decide
();

158 
¡Üe_x0_®pha0
();

159 
®loc_x0_®pha0
();

160 
	g´Ùeùed
:

161 
Vec
<
ty³0
>* 
x0
;

162 
	gVec
<
	gty³0
>* 
	g®pha0
;

164 
	gpublic
:

166 
NewDyÇmicDMD
(
AtomsDMD
* 
__©oms
,
FÜûF›ldDMD
* 
__ff
,

167 
¡d
::
š™Ÿliz”_li¡
<
vec
*> 
__updt_vecs
,

168 
¡d
::
š™Ÿliz”_li¡
<
vec
*> 
__xchng_comp_vecs
,

169 
¡d
::
š™Ÿliz”_li¡
<
vec
*> 
__¬ch_vecs
):

170 
NewDyÇmic
(
__©oms
,
__ff
,

171 {
__©oms
->
x
,__©oms->
®pha
,__©oms->
c
,__©oms->
–em
},
__updt_vecs
,

172 {
__©oms
->
id
},
__xchng_comp_vecs
,

173 {},
__¬ch_vecs
),

174 
©oms
(
__©oms
),

175 
ff
(
__ff
),

176 
c_dim
(
__©oms
->
c
->
dim
),

177 
®pha_sÿË
(
__©oms
->
xi
[__©oms->
N
-1]),

178 
x0
(
NULL
),

179 
®pha0
(
NULL
)

182 ~
NewDyÇmicDMD
()

186 
š™
()

189 
¡Üe_¬ch_vecs
();

190 
ü—‹_dyÇmic_vecs
();

191 
®loc_x0_®pha0
();

192 
	gff
->
š™
();

193 
	gff
->
	gÃighbÜ
->
š™
();

194 
	g©oms
->
	gmax_cut
=
ff
->
max_cut
+
©oms
->
comm
.
skš
+
®pha_sÿË
*
sq¹_2
*©oms->
max_®pha
;

196 
	gxchng
=
Ãw
 
Exchªge
(
©oms
,
nxchng_vecs_fuÎ
);

197 
	gupdt
=
Ãw
 
Upd©e
(
©oms
,
nupdt_vecs_fuÎ
,
nxchng_vecs_fuÎ
);

199 
	gff
->
	gupdt
=
updt
;

200 
	g©oms
->
x2s_lş
();

201 
	gxchng
->
fuÎ_xchng
();

202 
	gupdt
->
»£t
();

203 
	gupdt
->
li¡
();

204 
	gff
->
	gÃighbÜ
->
ü—‹_li¡
(
Œue
);

205 
¡Üe_x0_®pha0
();

207 
fš
()

209 
	gff
->
	gÃighbÜ
->
fš
();

210 
	gff
->
fš
();

212 
d–‘e
 
	gupdt
;

213 
	gupdt
=
NULL
;

214 
d–‘e
 
	gxchng
;

215 
	gxchng
=
NULL
;

216 
d–‘e
 
	g®pha0
;

217 
	g®pha0
=
NULL
;

218 
d–‘e
 
	gx0
;

219 
	gx0
=
NULL
;

221 
»¡Üe_¬ch_vecs
();

222 
	gd–‘e
 [] 
	g©oms
->
	gdyÇmic_vecs
;

223 
	g©oms
->
	gdyÇmic_vecs
=
NULL
;

224 
	g©oms
->
	gndyÇmic_vecs
=0;

226 
de¡roy_dyÇmic_vecs
();

227 
»¡Üe_¬ch_vecs
();

229 
	givec
=0;ivec<
	g©oms
->
	gnvecs
;ivec++)

230 if(!
	g©oms
->
	gvecs
[
ivec
]->
is_em±y
())

232 
	g©oms
->
	gvecs
[
ivec
]->
	gvec_sz
=
©oms
->
Çtms_lş
;

233 
	g©oms
->
	gvecs
[
ivec
]->
shršk_to_f™
();

235 
	g©oms
->
	gÇtms_ph
=0;

238 
	g‹m¶©e
<
	gşass
...
	gVS
>

239 
upd©e
(
VS
*&... 
__vs
)

247 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

250 
	g‹m¶©e
<>

251 
	g‹m¶©e
<
	gşass
...
	gVS
>

252 
	gNewDyÇmicDMD
<
	gŒue
,Œue,Œue>::
	$upd©e
(
VS
*&... 
__vs
)

254 
©oms
->
	`upd©e_max_®pha
();

255 
©oms
->
	`upd©e_H
();

257 
updt
->
	`upd©e_w_x
(
©oms
->
®pha
,
__vs
...);

259 if(
	`decide
()) ;

261 
©oms
->
	`x2s_lş
();

262 
xchng
->
	`fuÎ_xchng
();

263 
©oms
->
max_cut
=
ff
->max_cut+©oms->
comm
.
skš
+
®pha_sÿË
*
sq¹_2
*©oms->
max_®pha
;

264 
updt
->
	`»£t
();

265 
updt
->
	`li¡
();

266 
ff
->
ÃighbÜ
->
	`ü—‹_li¡
(
Œue
);

267 
	`¡Üe_x0_®pha0
();

268 
	}
}

270 
	g‹m¶©e
<>

271 
	g‹m¶©e
<
	gşass
...
	gVS
>

272 
	gNewDyÇmicDMD
<
	gçl£
,
	gŒue
,Œue>::
	$upd©e
(
VS
*&... 
__vs
)

274 
©oms
->
	`upd©e_max_®pha
();

276 if(
	`decide
())

278 
updt
->
	`upd©e_w_x
(
©oms
->
®pha
,
__vs
...);

283 
©oms
->
	`x2s_lş
();

284 
xchng
->
	`fuÎ_xchng
();

285 
©oms
->
max_cut
=
ff
->max_cut+©oms->
comm
.
skš
+
®pha_sÿË
*
sq¹_2
*©oms->
max_®pha
;

286 
updt
->
	`»£t
();

287 
updt
->
	`li¡
();

288 
ff
->
ÃighbÜ
->
	`ü—‹_li¡
(
Œue
);

289 
	`¡Üe_x0_®pha0
();

290 
	}
}

292 
	g‹m¶©e
<>

293 
	g‹m¶©e
<
	gşass
...
	gVS
>

294 
	gNewDyÇmicDMD
<
	gŒue
,Œue,
	gçl£
>::
	$upd©e
(
VS
*&... 
__vs
)

296 
©oms
->
	`upd©e_H
();

298 
updt
->
	`upd©e_w_x
(
__vs
...);

300 if(
	`decide
()) ;

304 
©oms
->
	`x2s_lş
();

305 
xchng
->
	`fuÎ_xchng
();

306 
updt
->
	`»£t
();

307 
updt
->
	`li¡
();

308 
ff
->
ÃighbÜ
->
	`ü—‹_li¡
(
Œue
);

309 
	`¡Üe_x0_®pha0
();

310 
	}
}

312 
	g‹m¶©e
<>

313 
	g‹m¶©e
<
	gşass
...
	gVS
>

314 
	gNewDyÇmicDMD
<
	gçl£
,
	gŒue
,çl£>::
	$upd©e
(
VS
*&... 
__vs
)

316 if(
	`decide
())

318 
updt
->
	`upd©e_w_x
(
__vs
...);

323 
©oms
->
	`x2s_lş
();

324 
xchng
->
	`fuÎ_xchng
();

325 
updt
->
	`li¡
();

326 
ff
->
ÃighbÜ
->
	`ü—‹_li¡
(
çl£
);

327 
	`¡Üe_x0_®pha0
();

328 
	}
}

330 
	g‹m¶©e
<>

331 
	g‹m¶©e
<
	gşass
...
	gVS
>

332 
	gNewDyÇmicDMD
<
	gçl£
,çl£,
	gŒue
>::
	$upd©e
(
VS
*&... 
__vs
)

335 if(
	`decide
())

337 
updt
->
	`upd©e_wo_x
(
©oms
->
®pha
,
__vs
...);

340 
©oms
->
	`upd©e_max_®pha
();

342 
©oms
->
	`x2s_lş
();

343 
©oms
->
max_cut
=
ff
->max_cut+©oms->
comm
.
skš
+
®pha_sÿË
*
sq¹_2
*©oms->
max_®pha
;

344 
xchng
->
	`fuÎ_xchng_¡©ic
();

345 
updt
->
	`»£t
();

346 
updt
->
	`li¡
();

347 
ff
->
ÃighbÜ
->
	`ü—‹_li¡
(
Œue
);

348 
	`¡Üe_x0_®pha0
();

349 
	}
}

351 
	g‹m¶©e
<>

352 
	g‹m¶©e
<
	gşass
...
	gVS
>

353 
	gNewDyÇmicDMD
<
	gçl£
,çl£,çl£>::
	$upd©e
(
VS
*&... 
__vs
)

355 
updt
->
	`upd©e_wo_x
(
__vs
...);

356 
	}
}

	@dynamic_md.cpp

1 
	~"comm.h
"

2 
	~"dyÇmic_md.h
"

3 
	~"©oms_md.h
"

4 
	~"xm©h.h
"

5 
	~"tim”.h
"

6 
	~"MAPP.h
"

7 
	~"ff_¡yËs.h
"

8 
	~"ÃighbÜ_md.h
"

9 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

13 
	gDyÇmicMD
::
DyÇmicMD
(
AtomsMD
* 
__©oms
,
FÜûF›ldMD
* 
__ff
,
boŞ
 
__chng_box
,

14 
¡d
::
š™Ÿliz”_li¡
<
vec
*> 
__updt_vecs
,

15 
¡d
::
š™Ÿliz”_li¡
<
vec
*> 
__xchng_comp_vecs
,

16 
¡d
::
š™Ÿliz”_li¡
<
vec
*> 
__¬ch_vecs
):

17 
DyÇmic
(
__©oms
,
__ff
,
__chng_box
,

18 {
__©oms
->
x
,__©oms->
–em
},
__updt_vecs
,

19 {
__©oms
->
id
},
__xchng_comp_vecs
,

20 {},
__¬ch_vecs
),

21 
©oms
(
__©oms
),

22 
ff
(
__ff
),

23 
	$x0
(
NULL
)

25 
	}
}

29 
	gDyÇmicMD
::~
	$DyÇmicMD
()

31 
	}
}

35 
DyÇmicMD
::
	$š™
()

37 
	`¡Üe_¬ch_vecs
();

38 
	`ü—‹_dyÇmic_vecs
();

39 
x0
=
Ãw
 
Vec
<
ty³0
>(
©oms
,
__dim__
,"x0");

40 
ff
->
	`š™
();

41 
ff
->
ÃighbÜ
->
	`š™
();

42 
©oms
->
max_cut
=
ff
->max_cut+©oms->
comm
.
skš
;

44 
xchng
=
Ãw
 
	`Exchªge
(
©oms
,
nxchng_vecs_fuÎ
);

45 
updt
=
Ãw
 
	`Upd©e
(
©oms
,
nupdt_vecs_fuÎ
,
nxchng_vecs_fuÎ
);

46 
ff
->
updt
=updt;

47 
©oms
->
	`x2s_lş
();

48 
xchng
->
	`fuÎ_xchng
();

49 
updt
->
	`»£t
();

50 
updt
->
	`li¡
();

51 
ff
->
ÃighbÜ
->
	`ü—‹_li¡
(
Œue
);

52 
	`¡Üe_x0
();

54 
	}
}

58 
	gDyÇmicMD
::
	$fš
()

60 
ff
->
ÃighbÜ
->
	`fš
();

61 
ff
->
	`fš
();

63 
d–‘e
 
updt
;

64 
d–‘e
 
xchng
;

65 
d–‘e
 
x0
;

67 
	`de¡roy_dyÇmic_vecs
();

68 
	`»¡Üe_¬ch_vecs
();

70 
ivec
=0;ivec<
©oms
->
nvecs
;ivec++)

71 if(!
©oms
->
vecs
[
ivec
]->
	`is_em±y
())

73 
©oms
->
vecs
[
ivec
]->
vec_sz
÷toms->
Çtms_lş
;

74 
©oms
->
vecs
[
ivec
]->
	`shršk_to_f™
();

76 
©oms
->
Çtms_ph
=0;

77 
	}
}

81 
	gDyÇmicMD
::
	$¡Üe_x0
()

83 
Ï¡_©m
=
©oms
->
Çtms_lş
;

84 if(
chng_box
è
Ï¡_©m
+=
©oms
->
Çtms_ph
;

85 
	`memıy
(
x0
->
	`begš
(),
©oms
->
x
->begš(),
Ï¡_©m
*
__dim__
*(
ty³0
));

86 
	}
}

91 #ifdeà
OLD_UPDATE


92 
	gšlše


95 
boŞ
 
	gDyÇmicMD
::
	$decide
()

97 
ty³0
 
skš_sq
=0.25*
skš
*skin;

98 
succ
,
succ_lş
=1;

99 
ty³0
* 
x_vec
=
©oms
->
x
->
	`begš
();

100 
ty³0
* 
x0_vec
=
x0
->
	`begš
();

101 
Ï¡_©m
=
©oms
->
Çtms_lş
;

102 if(
chng_box
è
Ï¡_©m
+=
©oms
->
Çtms_ph
;

103 
Ÿtm
=0;
succ_lş
 && i©m<
Ï¡_©m
;Ÿtm++,
x0_vec
+=
__dim__
,
x_vec
+=__dim__)

104 if(
Algeb¿
::
RSQ
<
__dim__
>(
x0_vec
,
x_vec
)>
skš_sq
)

105 
succ_lş
=0;

107 
	`MPI_AÎ»duû
(&
succ_lş
,&
succ
,1,
MPI_INT
,
MPI_MIN
,
wÜld
);

108 if(
succ
è 
Œue
;

109  
çl£
;

110 
	}
}

111 #ifdeà
OLD_UPDATE


115 
	gDyÇmicMD
::
	$upd©e
(
vec
* 
updt_vec
)

117 
	`upd©e
(&
updt_vec
,1);

118 
	}
}

122 
	gDyÇmicMD
::
	$upd©e
(
vec
** 
updt_vecs
,
nupdt_vecs
)

124 
boŞ
 
x_x¡
=
çl£
;

125 
ivec
=0;
x_x¡
==
çl£
 && ivec<
nupdt_vecs
;ivec++)

126 if(
updt_vecs
[
ivec
]==
©oms
->
x
)

127 
x_x¡
=
Œue
;

128 if(
x_x¡
==
çl£
)

130 if(
nupdt_vecs
==1)

131 
updt
->
	`upd©e
(
updt_vecs
[0],
çl£
);

133 
updt
->
	`upd©e
(
updt_vecs
,
nupdt_vecs
,
çl£
);

138 if(
chng_box
)

140 if(
nupdt_vecs
==1)

141 
updt
->
	`upd©e
(
©oms
->
x
,
Œue
);

143 
updt
->
	`upd©e
(
updt_vecs
,
nupdt_vecs
,
Œue
);

145 if(
	`decide
())

148 
©oms
->
	`x2s_lş
();

149 
xchng
->
	`fuÎ_xchng
();

151 
updt
->
	`»£t
();

152 
updt
->
	`li¡
();

153 
ff
->
ÃighbÜ
->
	`ü—‹_li¡
(
chng_box
);

154 
	`¡Üe_x0
();

158 if(
	`decide
())

160 if(
nupdt_vecs
==1)

161 
updt
->
	`upd©e
(
©oms
->
x
,
Œue
);

163 
updt
->
	`upd©e
(
updt_vecs
,
nupdt_vecs
,
Œue
);

167 
©oms
->
	`x2s_lş
();

168 
xchng
->
	`fuÎ_xchng
();

170 
updt
->
	`li¡
();

171 
ff
->
ÃighbÜ
->
	`ü—‹_li¡
(
chng_box
);

173 
	`¡Üe_x0
();

175 
	}
}

181 
	gDyÇmicMD
::
	$š™_xchng
()

183 
©oms
->
	`x2s_lş
();

184 
xchng
->
	`fuÎ_xchng
();

185 
updt
->
	`li¡
();

186 
	}
}

190 
	gDyÇmicMD
::
	$fš_xchng
()

192 
updt
->
	`li¡
();

193 
ff
->
ÃighbÜ
->
	`ü—‹_li¡
(
chng_box
);

194 
	`¡Üe_x0
();

195 
	}
}

196 #ifdeà
OLD_UPDATE


201 
	gDyÇmicMD
::
	$ÃighbÜšg
()

203 
ff
->
ÃighbÜ
->
	`ü—‹_li¡
(
chng_box
);

204 
	}
}

	@dynamic_md.h

1 #iâdeà
__MAPP__dyÇmic_md__


2 
	#__MAPP__dyÇmic_md__


	)

4 
	~"dyÇmic.h
"

5 #ifdeà
OLD_UPDATE


7 
	~"©oms_md.h
"

10 
Çme¥aû
 
	gMAPP_NS


12 
şass
 
	gvec
;

13 
	g‹m¶©e
<
	gty³Çme
> 
şass
 
	gVec
;

14 şas 
	cDyÇmicMD
: 
public
 
DyÇmic


16 
´iv©e
:

17 
¡Üe_x0
();

18 
boŞ
 
decide
();

19 
şass
 
FÜûF›ldMD
* 
	gff
;

20 
şass
 
AtomsMD
* 
	g©oms
;

21 #ifdeà
OLD_UPDATE


23 
ÃighbÜšg
();

25 
	g´Ùeùed
:

26 
Vec
<
ty³0
>* 
x0
;

27 
	gpublic
:

28 
DyÇmicMD
(
şass
 
AtomsMD
*,şas 
FÜûF›ldMD
*,
boŞ
,

29 
¡d
::
š™Ÿliz”_li¡
<
vec
*>,std::initializer_list<vec*>,std::initializer_list<vec*> = {});

30 ~
DyÇmicMD
();

32 
š™_xchng
();

33 
fš_xchng
();

34 
š™
();

35 
fš
();

36 #ifdeà
OLD_UPDATE


37 
upd©e
(
vec
**,);

38 
upd©e
(
vec
*);

40 
	g‹m¶©e
<
	gşass
...
	gVS
>

41 
upd©e_wo_x
(
VS
*&... 
__vs
)

43 
	gupdt
->
upd©e_wo_x
(
__vs
...);

45 
	g‹m¶©e
<
	gşass
...
	gVS
>

46 
upd©e_w_x
(
VS
*&... 
__vs
)

48 if(
	gchng_box
)

50 
	gupdt
->
upd©e_w_x
(
__vs
...);

52 if(
decide
()) ;

54 
	g©oms
->
x2s_lş
();

55 
	gxchng
->
fuÎ_xchng
();

57 
	gupdt
->
»£t
();

58 
	gupdt
->
li¡
();

59 
ÃighbÜšg
();

60 
¡Üe_x0
();

64 if(
decide
())

66 
	gupdt
->
upd©e_w_x
(
__vs
...);

70 
	g©oms
->
x2s_lş
();

71 
	gxchng
->
fuÎ_xchng
();

73 
	gupdt
->
li¡
();

74 
ÃighbÜšg
();

76 
¡Üe_x0
();

80 
	g‹m¶©e
<
boŞ
 
	gX
>

81 şas 
	cH–³r


83 
	gpublic
:

84 
‹m¶©e
<
şass
...
VS
>

85 
upd©e
(
DyÇmicMD
& 
dyÇmic
,
VS
*&... 
__vs
)

87 
	gdyÇmic
.
upd©e_w_x
(
__vs
...);

93 
	g‹m¶©e
<
boŞ
 
	gX
=
çl£
,
	gşass
...
	gVS
>

94 
upd©e
(
VS
*&... 
__vs
)

96 
	gH–³r
<
	gX
>::
upd©e
(*
this
,
__vs
...);

100 #ifdeà
OLD_UPDATE


102 
	g‹m¶©e
<>

103 
şass
 
	gDyÇmicMD
::
H–³r
<
çl£
>

105 
public
:

106 
‹m¶©e
<
şass
...
VS
>

107 
upd©e
(
DyÇmicMD
& 
dyÇmic
,
VS
*&... 
__vs
)

109 
	gdyÇmic
.
upd©e_wo_x
(
__vs
...);

	@elements.cpp

5 
	~"–em’ts.h
"

6 
	~"memÜy.h
"

7 
	~<lim™s
>

8 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

12 
	gEËm’ts
::
	$EËm’ts
():

13 
	`ÃËms
(0),

14 
	`__ÃËms
(0),

15 
	`Çmes
(
NULL
),

16 
	`mas£s
(
NULL
),

17 
	`__ÃËms__
(
ÃËms
,"nelems")

19 
	}
}

23 
	gEËm’ts
::
	$EËm’ts
(cÚ¡ 
EËm’ts
& 
r
):

24 
	`ÃËms
(
r
.
ÃËms
),

25 
	`__ÃËms
(
r
.
__ÃËms
),

26 
	`Çmes
(
NULL
),

27 
	`mas£s
(
NULL
),

28 
	`__ÃËms__
(
ÃËms
,"nelems")

30 if(
ÃËms
==0) ;

31 
Çmes
=
Ãw
 
¡d
::
¡ršg
[
ÃËms
];

32 
mas£s
=
Ãw
 
ty³0
[
ÃËms
];

33 
size_t
 
i
=0;i<
ÃËms
;i++)

35 
Çmes
[
i
]=
r
.names[i];

36 
mas£s
[
i
]=
r
.masses[i];

38 
	}
}

42 
	gEËm’ts
::
	$EËm’ts
(
EËm’ts
&& 
r
):

43 
	`ÃËms
(
r
.
ÃËms
),

44 
	`__ÃËms
(
r
.
__ÃËms
),

45 
	`Çmes
(
r
.
Çmes
),

46 
	`mas£s
(
r
.
mas£s
),

47 
	`__ÃËms__
(
¡d
::
	$move
(
r
.
__ÃËms__
))

49 
r
.
Çmes
=
NULL
;

50 
r
.
mas£s
=
NULL
;

51 
	}
}

55 
	gEËm’ts
::~
	$EËm’ts
()

57 
d–‘e
 [] 
Çmes
;

58 
d–‘e
 [] 
mas£s
;

59 
	}
}

63 
	gEËm’ts
& EËm’ts::
İ”©Ü
=(cÚ¡ 
EËm’ts
& 
r
)

65 
this
->~
EËm’ts
();

66 
Ãw
 (
this
è
EËm’ts
(
r
);

67  *
	gthis
;

72 
	gEËm’ts
& EËm’ts::
İ”©Ü
=(
EËm’ts
&& 
r
)

74 
this
->~
EËm’ts
();

75 
Ãw
 (
this
è
EËm’ts
(
¡d
::
move
(
r
));

76  *
	gthis
;

81 
boŞ
 
	gEËm’ts
::
İ”©Ü
==(cÚ¡ 
EËm’ts
& 
r
)

83 if(
ÃËms
!=
r
.ÃËmsè 
çl£
;

84 
size_t
 
	gi
=0;i<
	gÃËms
;i++)

85 if(
¡rcmp
(
Çmes
[
i
].
c_¡r
(),
r
.names[i].c_str())!=0)

86  
çl£
;

88  
	gŒue
;

93 
–em_ty³
 
	gEËm’ts
::
	$add_ty³
(cÚ¡ 
ty³0
 
mass
,cÚ¡ * 
Çme
)

95 
–em_ty³
 
i
=0;i<
__ÃËms
;i++)

96 if(!
	`¡rcmp
(
Çme
,
Çmes
[
i
].
	`c_¡r
()))

97  
i
;

98 if(
__ÃËms
==
¡d
::
num”ic_lim™s
<
–em_ty³
>::
	`max
())

99 
throw
 "cannot have morehan 256ƒlements";

102 
MemÜy
::
	`grow
(
mas£s
,
ÃËms
,nelems+1);

103 
mas£s
[
ÃËms
]=
mass
;

104 
¡d
::
¡ršg
* 
__Çmes
=
Ãw
 std::¡ršg[
ÃËms
+1];

105 
size_t
 
i
=0;i<
ÃËms
;i++)

106 
__Çmes
[
i
]=
¡d
::
	`move
(
Çmes
[i]);

108 
__Çmes
[
ÃËms
]=
¡d
::
	`¡ršg
(
Çme
);

109 
d–‘e
 [] 
Çmes
;

110 
Çmes
=
__Çmes
;

112 
ÃËms
++;

113  
__ÃËms
++;

114 
	}
}

118 
–em_ty³
 
	gEËm’ts
::
	$fšd
(cÚ¡ * 
Çme
)

120 
–em_ty³
 
i
=0;i<
__ÃËms
;i++)

121 if(!
	`¡rcmp
(
Çme
,
Çmes
[
i
].
	`c_¡r
()))

122  
i
;

124 
throw
 0;

125 
	}
}

129 
size_t
* 
	gEËm’ts
::
	$m­
(cÚ¡ 
¡d
::
¡ršg
* 
__Çmes
,cÚ¡ 
size_t
 
__n
)

131 if(!
ÃËms
è 
NULL
;

133 
size_t
* 
m­
=
Ãw
 size_t[
ÃËms
];

135 
size_t
 
i
=0;i<
ÃËms
;i++)

137 
boŞ
 
found
=
çl£
;

138 
size_t
 
j
=0;j<
__n
 && !
found
;j++)

139 if(!
	`¡rcmp
(
__Çmes
[
j
].
	`c_¡r
(),
Çmes
[
i
].c_str()))

141 
m­
[
i
]=
j
;

142 
found
=
Œue
;

145 if(!
found
)

147 
d–‘e
 [] 
m­
;

148 
throw
 
Çmes
[
i
];

152  
m­
;

153 
	}
}

157 
PyObjeù
* 
	gEËm’ts
::
	$g‘_diù
()

159 if(
ÃËms
==0è
Py_RETURN_NONE
;

160 
PyObjeù
* 
diù
ğ
	`PyDiù_New
();

161 
size_t
 
i
=0;i<
ÃËms
;i++)

162 
	`PyDiù_S‘I‹mSŒšg
(
diù
,
Çmes
[
i
].
	`c_¡r
(),
	`PyLÚg_FromSize_t
(i));

165  
diù
;

166 
	}
}

170 
	gEËm’ts
::
assign_cŞÜ_¿d
(cÚ¡ * 
Çme
,
ty³0
 (&
m©
)[4])

173 if(!
¡rcmp
(
Çme
,"H"))

175 
	gm©
[0]=0.800000;

176 
	gm©
[1]=0.800000;

177 
	gm©
[2]=0.800000;

178 
	gm©
[3]=0.435000;

180 if(!
¡rcmp
(
Çme
,"He"))

182 
	gm©
[0]=0.643137;

183 
	gm©
[1]=0.666667;

184 
	gm©
[2]=0.678431;

185 
	gm©
[3]=0.700000;

187 if(!
¡rcmp
(
Çme
,"Li"))

189 
	gm©
[0]=0.700000;

190 
	gm©
[1]=0.700000;

191 
	gm©
[2]=0.700000;

192 
	gm©
[3]=1.519900;

194 if(!
¡rcmp
(
Çme
,"Be"))

196 
	gm©
[0]=0.643137;

197 
	gm©
[1]=0.666667;

198 
	gm©
[2]=0.678431;

199 
	gm©
[3]=1.143000;

201 if(!
¡rcmp
(
Çme
,"B"))

203 
	gm©
[0]=0.900000;

204 
	gm©
[1]=0.400000;

205 
	gm©
[2]=0.000000;

206 
	gm©
[3]=0.975000;

208 if(!
¡rcmp
(
Çme
,"C"))

210 
	gm©
[0]=0.350000;

211 
	gm©
[1]=0.350000;

212 
	gm©
[2]=0.350000;

213 
	gm©
[3]=0.655000;

215 if(!
¡rcmp
(
Çme
,"N"))

217 
	gm©
[0]=0.200000;

218 
	gm©
[1]=0.200000;

219 
	gm©
[2]=0.800000;

220 
	gm©
[3]=0.750000;

222 if(!
¡rcmp
(
Çme
,"O"))

224 
	gm©
[0]=0.800000;

225 
	gm©
[1]=0.200000;

226 
	gm©
[2]=0.200000;

227 
	gm©
[3]=0.730000;

229 if(!
¡rcmp
(
Çme
,"F"))

231 
	gm©
[0]=0.700000;

232 
	gm©
[1]=0.850000;

233 
	gm©
[2]=0.450000;

234 
	gm©
[3]=0.720000;

236 if(!
¡rcmp
(
Çme
,"Ne"))

238 
	gm©
[0]=0.643137;

239 
	gm©
[1]=0.666667;

240 
	gm©
[2]=0.678431;

241 
	gm©
[3]=1.600000;

243 if(!
¡rcmp
(
Çme
,"Na"))

245 
	gm©
[0]=0.600000;

246 
	gm©
[1]=0.600000;

247 
	gm©
[2]=0.600000;

248 
	gm©
[3]=1.857900;

250 if(!
¡rcmp
(
Çme
,"Mg"))

252 
	gm©
[0]=0.600000;

253 
	gm©
[1]=0.600000;

254 
	gm©
[2]=0.700000;

255 
	gm©
[3]=1.604700;

257 if(!
¡rcmp
(
Çme
,"Al"))

259 
	gm©
[0]=0.643137;

260 
	gm©
[1]=0.666667;

261 
	gm©
[2]=0.678431;

262 
	gm©
[3]=1.431800;

264 if(!
¡rcmp
(
Çme
,"Si"))

266 
	gm©
[0]=0.690196;

267 
	gm©
[1]=0.768627;

268 
	gm©
[2]=0.870588;

269 
	gm©
[3]=1.175800;

271 if(!
¡rcmp
(
Çme
,"P"))

273 
	gm©
[0]=0.100000;

274 
	gm©
[1]=0.700000;

275 
	gm©
[2]=0.300000;

276 
	gm©
[3]=1.060000;

278 if(!
¡rcmp
(
Çme
,"S"))

280 
	gm©
[0]=0.950000;

281 
	gm©
[1]=0.900000;

282 
	gm©
[2]=0.200000;

283 
	gm©
[3]=1.020000;

285 if(!
¡rcmp
(
Çme
,"Cl"))

287 
	gm©
[0]=0.150000;

288 
	gm©
[1]=0.500000;

289 
	gm©
[2]=0.100000;

290 
	gm©
[3]=0.990000;

292 if(!
¡rcmp
(
Çme
,"Ar"))

294 
	gm©
[0]=0.643137;

295 
	gm©
[1]=0.666667;

296 
	gm©
[2]=0.678431;

297 
	gm©
[3]=1.900000;

299 if(!
¡rcmp
(
Çme
,"K"))

301 
	gm©
[0]=0.576471;

302 
	gm©
[1]=0.439216;

303 
	gm©
[2]=0.858824;

304 
	gm©
[3]=2.262000;

306 if(!
¡rcmp
(
Çme
,"Ca"))

308 
	gm©
[0]=0.800000;

309 
	gm©
[1]=0.800000;

310 
	gm©
[2]=0.700000;

311 
	gm©
[3]=1.975800;

313 if(!
¡rcmp
(
Çme
,"Sc"))

315 
	gm©
[0]=0.643137;

316 
	gm©
[1]=0.666667;

317 
	gm©
[2]=0.678431;

318 
	gm©
[3]=1.654500;

320 if(!
¡rcmp
(
Çme
,"Ti"))

322 
	gm©
[0]=0.643137;

323 
	gm©
[1]=0.666667;

324 
	gm©
[2]=0.678431;

325 
	gm©
[3]=1.475500;

327 if(!
¡rcmp
(
Çme
,"V"))

329 
	gm©
[0]=0.643137;

330 
	gm©
[1]=0.666667;

331 
	gm©
[2]=0.678431;

332 
	gm©
[3]=1.309000;

334 if(!
¡rcmp
(
Çme
,"Cr"))

336 
	gm©
[0]=0.000000;

337 
	gm©
[1]=0.800000;

338 
	gm©
[2]=0.000000;

339 
	gm©
[3]=1.249000;

341 if(!
¡rcmp
(
Çme
,"Mn"))

343 
	gm©
[0]=0.643137;

344 
	gm©
[1]=0.666667;

345 
	gm©
[2]=0.678431;

346 
	gm©
[3]=1.350000;

348 if(!
¡rcmp
(
Çme
,"Fe"))

350 
	gm©
[0]=0.517647;

351 
	gm©
[1]=0.576471;

352 
	gm©
[2]=0.652941;

353 
	gm©
[3]=1.241100;

355 if(!
¡rcmp
(
Çme
,"Co"))

357 
	gm©
[0]=0.643137;

358 
	gm©
[1]=0.666667;

359 
	gm©
[2]=0.678431;

360 
	gm©
[3]=1.253500;

362 if(!
¡rcmp
(
Çme
,"Ni"))

364 
	gm©
[0]=0.257255;

365 
	gm©
[1]=0.266667;

366 
	gm©
[2]=0.271373;

367 
	gm©
[3]=1.246000;

369 if(!
¡rcmp
(
Çme
,"Cu"))

371 
	gm©
[0]=0.950000;

372 
	gm©
[1]=0.790074;

373 
	gm©
[2]=0.013859;

374 
	gm©
[3]=1.278000;

376 if(!
¡rcmp
(
Çme
,"Zn"))

378 
	gm©
[0]=0.643137;

379 
	gm©
[1]=0.666667;

380 
	gm©
[2]=0.678431;

381 
	gm©
[3]=1.332500;

383 if(!
¡rcmp
(
Çme
,"Ga"))

385 
	gm©
[0]=0.900000;

386 
	gm©
[1]=0.000000;

387 
	gm©
[2]=1.000000;

388 
	gm©
[3]=1.350100;

390 if(!
¡rcmp
(
Çme
,"Ge"))

392 
	gm©
[0]=0.643137;

393 
	gm©
[1]=0.666667;

394 
	gm©
[2]=0.678431;

395 
	gm©
[3]=1.224800;

397 if(!
¡rcmp
(
Çme
,"As"))

399 
	gm©
[0]=1.000000;

400 
	gm©
[1]=1.000000;

401 
	gm©
[2]=0.300000;

402 
	gm©
[3]=1.200000;

404 if(!
¡rcmp
(
Çme
,"Se"))

406 
	gm©
[0]=0.643137;

407 
	gm©
[1]=0.666667;

408 
	gm©
[2]=0.678431;

409 
	gm©
[3]=1.160000;

411 if(!
¡rcmp
(
Çme
,"Br"))

413 
	gm©
[0]=0.500000;

414 
	gm©
[1]=0.080000;

415 
	gm©
[2]=0.120000;

416 
	gm©
[3]=1.140000;

418 if(!
¡rcmp
(
Çme
,"Kr"))

420 
	gm©
[0]=0.643137;

421 
	gm©
[1]=0.666667;

422 
	gm©
[2]=0.678431;

423 
	gm©
[3]=2.000000;

425 if(!
¡rcmp
(
Çme
,"Rb"))

427 
	gm©
[0]=0.643137;

428 
	gm©
[1]=0.666667;

429 
	gm©
[2]=0.678431;

430 
	gm©
[3]=2.470000;

432 if(!
¡rcmp
(
Çme
,"Sr"))

434 
	gm©
[0]=0.643137;

435 
	gm©
[1]=0.666667;

436 
	gm©
[2]=0.678431;

437 
	gm©
[3]=2.151300;

439 if(!
¡rcmp
(
Çme
,"Y"))

441 
	gm©
[0]=0.643137;

442 
	gm©
[1]=0.666667;

443 
	gm©
[2]=0.678431;

444 
	gm©
[3]=1.823700;

446 if(!
¡rcmp
(
Çme
,"Zr"))

448 
	gm©
[0]=0.643137;

449 
	gm©
[1]=0.666667;

450 
	gm©
[2]=0.678431;

451 
	gm©
[3]=1.615600;

453 if(!
¡rcmp
(
Çme
,"Nb"))

455 
	gm©
[0]=0.643137;

456 
	gm©
[1]=0.666667;

457 
	gm©
[2]=0.678431;

458 
	gm©
[3]=1.431800;

460 if(!
¡rcmp
(
Çme
,"Mo"))

462 
	gm©
[0]=0.643137;

463 
	gm©
[1]=0.666667;

464 
	gm©
[2]=0.678431;

465 
	gm©
[3]=1.362600;

467 if(!
¡rcmp
(
Çme
,"Tc"))

469 
	gm©
[0]=0.643137;

470 
	gm©
[1]=0.666667;

471 
	gm©
[2]=0.678431;

472 
	gm©
[3]=1.367500;

474 if(!
¡rcmp
(
Çme
,"Ru"))

476 
	gm©
[0]=0.643137;

477 
	gm©
[1]=0.666667;

478 
	gm©
[2]=0.678431;

479 
	gm©
[3]=1.352900;

481 if(!
¡rcmp
(
Çme
,"Rh"))

483 
	gm©
[0]=0.643137;

484 
	gm©
[1]=0.666667;

485 
	gm©
[2]=0.678431;

486 
	gm©
[3]=1.345000;

488 if(!
¡rcmp
(
Çme
,"Pd"))

490 
	gm©
[0]=0.643137;

491 
	gm©
[1]=0.666667;

492 
	gm©
[2]=0.678431;

493 
	gm©
[3]=1.375500;

495 if(!
¡rcmp
(
Çme
,"Ag"))

497 
	gm©
[0]=0.643137;

498 
	gm©
[1]=0.666667;

499 
	gm©
[2]=0.678431;

500 
	gm©
[3]=1.444700;

502 if(!
¡rcmp
(
Çme
,"Cd"))

504 
	gm©
[0]=0.643137;

505 
	gm©
[1]=0.666667;

506 
	gm©
[2]=0.678431;

507 
	gm©
[3]=1.489400;

509 if(!
¡rcmp
(
Çme
,"In"))

511 
	gm©
[0]=0.643137;

512 
	gm©
[1]=0.666667;

513 
	gm©
[2]=0.678431;

514 
	gm©
[3]=1.666200;

516 if(!
¡rcmp
(
Çme
,"Sn"))

518 
	gm©
[0]=0.643137;

519 
	gm©
[1]=0.666667;

520 
	gm©
[2]=0.678431;

521 
	gm©
[3]=1.537500;

523 if(!
¡rcmp
(
Çme
,"Sb"))

525 
	gm©
[0]=0.643137;

526 
	gm©
[1]=0.666667;

527 
	gm©
[2]=0.678431;

528 
	gm©
[3]=1.400000;

530 if(!
¡rcmp
(
Çme
,"Te"))

532 
	gm©
[0]=0.643137;

533 
	gm©
[1]=0.666667;

534 
	gm©
[2]=0.678431;

535 
	gm©
[3]=1.360000;

537 if(!
¡rcmp
(
Çme
,"I"))

539 
	gm©
[0]=0.500000;

540 
	gm©
[1]=0.100000;

541 
	gm©
[2]=0.500000;

542 
	gm©
[3]=1.330000;

544 if(!
¡rcmp
(
Çme
,"Xe"))

546 
	gm©
[0]=0.643137;

547 
	gm©
[1]=0.666667;

548 
	gm©
[2]=0.678431;

549 
	gm©
[3]=2.200000;

551 if(!
¡rcmp
(
Çme
,"Cs"))

553 
	gm©
[0]=0.643137;

554 
	gm©
[1]=0.666667;

555 
	gm©
[2]=0.678431;

556 
	gm©
[3]=2.632500;

558 if(!
¡rcmp
(
Çme
,"Ba"))

560 
	gm©
[0]=0.643137;

561 
	gm©
[1]=0.666667;

562 
	gm©
[2]=0.678431;

563 
	gm©
[3]=2.170500;

565 if(!
¡rcmp
(
Çme
,"La"))

567 
	gm©
[0]=0.643137;

568 
	gm©
[1]=0.666667;

569 
	gm©
[2]=0.678431;

570 
	gm©
[3]=1.872500;

572 if(!
¡rcmp
(
Çme
,"Ce"))

574 
	gm©
[0]=0.800000;

575 
	gm©
[1]=0.800000;

576 
	gm©
[2]=0.000000;

577 
	gm©
[3]=1.824300;

579 if(!
¡rcmp
(
Çme
,"Pr"))

581 
	gm©
[0]=0.643137;

582 
	gm©
[1]=0.666667;

583 
	gm©
[2]=0.678431;

584 
	gm©
[3]=1.836200;

586 if(!
¡rcmp
(
Çme
,"Nd"))

588 
	gm©
[0]=0.643137;

589 
	gm©
[1]=0.666667;

590 
	gm©
[2]=0.678431;

591 
	gm©
[3]=1.829500;

593 if(!
¡rcmp
(
Çme
,"Pm"))

595 
	gm©
[0]=0.643137;

596 
	gm©
[1]=0.666667;

597 
	gm©
[2]=0.678431;

598 
	gm©
[3]=1.809000;

600 if(!
¡rcmp
(
Çme
,"Sm"))

602 
	gm©
[0]=0.643137;

603 
	gm©
[1]=0.666667;

604 
	gm©
[2]=0.678431;

605 
	gm©
[3]=1.804000;

607 if(!
¡rcmp
(
Çme
,"Eu"))

609 
	gm©
[0]=0.643137;

610 
	gm©
[1]=0.666667;

611 
	gm©
[2]=0.678431;

612 
	gm©
[3]=1.984000;

614 if(!
¡rcmp
(
Çme
,"Gd"))

616 
	gm©
[0]=1.000000;

617 
	gm©
[1]=0.843137;

618 
	gm©
[2]=0.000000;

619 
	gm©
[3]=1.818000;

621 if(!
¡rcmp
(
Çme
,"Tb"))

623 
	gm©
[0]=0.643137;

624 
	gm©
[1]=0.666667;

625 
	gm©
[2]=0.678431;

626 
	gm©
[3]=1.800500;

628 if(!
¡rcmp
(
Çme
,"Dy"))

630 
	gm©
[0]=0.643137;

631 
	gm©
[1]=0.666667;

632 
	gm©
[2]=0.678431;

633 
	gm©
[3]=1.795100;

635 if(!
¡rcmp
(
Çme
,"Ho"))

637 
	gm©
[0]=0.643137;

638 
	gm©
[1]=0.666667;

639 
	gm©
[2]=0.678431;

640 
	gm©
[3]=1.788600;

642 if(!
¡rcmp
(
Çme
,"Er"))

644 
	gm©
[0]=0.643137;

645 
	gm©
[1]=0.666667;

646 
	gm©
[2]=0.678431;

647 
	gm©
[3]=1.779400;

649 if(!
¡rcmp
(
Çme
,"Tm"))

651 
	gm©
[0]=0.643137;

652 
	gm©
[1]=0.666667;

653 
	gm©
[2]=0.678431;

654 
	gm©
[3]=1.768700;

656 if(!
¡rcmp
(
Çme
,"Yb"))

658 
	gm©
[0]=0.643137;

659 
	gm©
[1]=0.666667;

660 
	gm©
[2]=0.678431;

661 
	gm©
[3]=1.939600;

663 if(!
¡rcmp
(
Çme
,"Lu"))

665 
	gm©
[0]=0.643137;

666 
	gm©
[1]=0.666667;

667 
	gm©
[2]=0.678431;

668 
	gm©
[3]=1.751500;

670 if(!
¡rcmp
(
Çme
,"Hf"))

672 
	gm©
[0]=0.643137;

673 
	gm©
[1]=0.666667;

674 
	gm©
[2]=0.678431;

675 
	gm©
[3]=1.597300;

677 if(!
¡rcmp
(
Çme
,"Ta"))

679 
	gm©
[0]=0.643137;

680 
	gm©
[1]=0.666667;

681 
	gm©
[2]=0.678431;

682 
	gm©
[3]=1.428000;

684 if(!
¡rcmp
(
Çme
,"W"))

686 
	gm©
[0]=0.643137;

687 
	gm©
[1]=0.666667;

688 
	gm©
[2]=0.678431;

689 
	gm©
[3]=1.370500;

691 if(!
¡rcmp
(
Çme
,"Re"))

693 
	gm©
[0]=0.643137;

694 
	gm©
[1]=0.666667;

695 
	gm©
[2]=0.678431;

696 
	gm©
[3]=1.380000;

698 if(!
¡rcmp
(
Çme
,"Os"))

700 
	gm©
[0]=0.643137;

701 
	gm©
[1]=0.666667;

702 
	gm©
[2]=0.678431;

703 
	gm©
[3]=1.367600;

705 if(!
¡rcmp
(
Çme
,"Ir"))

707 
	gm©
[0]=0.643137;

708 
	gm©
[1]=0.666667;

709 
	gm©
[2]=0.678431;

710 
	gm©
[3]=1.357300;

712 if(!
¡rcmp
(
Çme
,"Pt"))

714 
	gm©
[0]=0.643137;

715 
	gm©
[1]=0.666667;

716 
	gm©
[2]=0.678431;

717 
	gm©
[3]=1.387300;

719 if(!
¡rcmp
(
Çme
,"Au"))

721 
	gm©
[0]=0.900000;

722 
	gm©
[1]=0.800000;

723 
	gm©
[2]=0.000000;

724 
	gm©
[3]=1.441900;

726 if(!
¡rcmp
(
Çme
,"Hg"))

728 
	gm©
[0]=0.643137;

729 
	gm©
[1]=0.666667;

730 
	gm©
[2]=0.678431;

731 
	gm©
[3]=1.502500;

733 if(!
¡rcmp
(
Çme
,"Tl"))

735 
	gm©
[0]=0.643137;

736 
	gm©
[1]=0.666667;

737 
	gm©
[2]=0.678431;

738 
	gm©
[3]=1.728300;

740 if(!
¡rcmp
(
Çme
,"Pb"))

742 
	gm©
[0]=0.643137;

743 
	gm©
[1]=0.666667;

744 
	gm©
[2]=0.678431;

745 
	gm©
[3]=1.750100;

747 if(!
¡rcmp
(
Çme
,"Bi"))

749 
	gm©
[0]=0.643137;

750 
	gm©
[1]=0.666667;

751 
	gm©
[2]=0.678431;

752 
	gm©
[3]=1.460000;

754 if(!
¡rcmp
(
Çme
,"Po"))

756 
	gm©
[0]=0.643137;

757 
	gm©
[1]=0.666667;

758 
	gm©
[2]=0.678431;

759 
	gm©
[3]=1.460000;

761 if(!
¡rcmp
(
Çme
,"At"))

763 
	gm©
[0]=0.800000;

764 
	gm©
[1]=0.200000;

765 
	gm©
[2]=0.200000;

766 
	gm©
[3]=4.350000;

768 if(!
¡rcmp
(
Çme
,"Rn"))

770 
	gm©
[0]=0.643137;

771 
	gm©
[1]=0.666667;

772 
	gm©
[2]=0.678431;

773 
	gm©
[3]=1.430000;

775 if(!
¡rcmp
(
Çme
,"Fr"))

777 
	gm©
[0]=0.643137;

778 
	gm©
[1]=0.666667;

779 
	gm©
[2]=0.678431;

780 
	gm©
[3]=2.500000;

782 if(!
¡rcmp
(
Çme
,"Ra"))

784 
	gm©
[0]=0.643137;

785 
	gm©
[1]=0.666667;

786 
	gm©
[2]=0.678431;

787 
	gm©
[3]=2.140000;

789 if(!
¡rcmp
(
Çme
,"Ac"))

791 
	gm©
[0]=0.643137;

792 
	gm©
[1]=0.666667;

793 
	gm©
[2]=0.678431;

794 
	gm©
[3]=1.877500;

796 if(!
¡rcmp
(
Çme
,"Th"))

798 
	gm©
[0]=0.643137;

799 
	gm©
[1]=0.666667;

800 
	gm©
[2]=0.678431;

801 
	gm©
[3]=1.797500;

803 if(!
¡rcmp
(
Çme
,"Pa"))

805 
	gm©
[0]=0.643137;

806 
	gm©
[1]=0.666667;

807 
	gm©
[2]=0.678431;

808 
	gm©
[3]=1.608600;

810 if(!
¡rcmp
(
Çme
,"U"))

812 
	gm©
[0]=0.643137;

813 
	gm©
[1]=0.666667;

814 
	gm©
[2]=0.678431;

815 
	gm©
[3]=1.568300;

817 if(!
¡rcmp
(
Çme
,"Np"))

819 
	gm©
[0]=0.643137;

820 
	gm©
[1]=0.666667;

821 
	gm©
[2]=0.678431;

822 
	gm©
[3]=1.000000;

824 if(!
¡rcmp
(
Çme
,"Pu"))

826 
	gm©
[0]=0.643137;

827 
	gm©
[1]=0.666667;

828 
	gm©
[2]=0.678431;

829 
	gm©
[3]=1.000000;

831 if(!
¡rcmp
(
Çme
,"Am"))

833 
	gm©
[0]=0.643137;

834 
	gm©
[1]=0.666667;

835 
	gm©
[2]=0.678431;

836 
	gm©
[3]=1.000000;

838 if(!
¡rcmp
(
Çme
,"Cm"))

840 
	gm©
[0]=0.643137;

841 
	gm©
[1]=0.666667;

842 
	gm©
[2]=0.678431;

843 
	gm©
[3]=1.000000;

845 if(!
¡rcmp
(
Çme
,"Bk"))

847 
	gm©
[0]=0.643137;

848 
	gm©
[1]=0.666667;

849 
	gm©
[2]=0.678431;

850 
	gm©
[3]=1.000000;

852 if(!
¡rcmp
(
Çme
,"Cf"))

854 
	gm©
[0]=0.100000;

855 
	gm©
[1]=0.700000;

856 
	gm©
[2]=0.300000;

857 
	gm©
[3]=1.460000;

859 if(!
¡rcmp
(
Çme
,"Es"))

861 
	gm©
[0]=0.100000;

862 
	gm©
[1]=0.300000;

863 
	gm©
[2]=0.700000;

864 
	gm©
[3]=1.752000;

866 if(!
¡rcmp
(
Çme
,"Fm"))

868 
	gm©
[0]=0.643137;

869 
	gm©
[1]=0.666667;

870 
	gm©
[2]=0.678431;

871 
	gm©
[3]=1.000000;

873 if(!
¡rcmp
(
Çme
,"Md"))

875 
	gm©
[0]=0.643137;

876 
	gm©
[1]=0.666667;

877 
	gm©
[2]=0.678431;

878 
	gm©
[3]=1.000000;

880 if(!
¡rcmp
(
Çme
,"No"))

882 
	gm©
[0]=0.643137;

883 
	gm©
[1]=0.666667;

884 
	gm©
[2]=0.678431;

885 
	gm©
[3]=1.000000;

887 if(!
¡rcmp
(
Çme
,"Lr"))

889 
	gm©
[0]=0.643137;

890 
	gm©
[1]=0.666667;

891 
	gm©
[2]=0.678431;

892 
	gm©
[3]=1.000000;

894 if(!
¡rcmp
(
Çme
,"Rf"))

896 
	gm©
[0]=0.643137;

897 
	gm©
[1]=0.666667;

898 
	gm©
[2]=0.678431;

899 
	gm©
[3]=1.000000;

901 if(!
¡rcmp
(
Çme
,"Db"))

903 
	gm©
[0]=0.900000;

904 
	gm©
[1]=0.800000;

905 
	gm©
[2]=0.000000;

906 
	gm©
[3]=1.460000;

908 if(!
¡rcmp
(
Çme
,"Sg"))

910 
	gm©
[0]=0.643137;

911 
	gm©
[1]=0.666667;

912 
	gm©
[2]=0.678431;

913 
	gm©
[3]=1.000000;

915 if(!
¡rcmp
(
Çme
,"Bh"))

917 
	gm©
[0]=1.000000;

918 
	gm©
[1]=1.000000;

919 
	gm©
[2]=0.000000;

920 
	gm©
[3]=1.900000;

922 if(!
¡rcmp
(
Çme
,"Hs"))

924 
	gm©
[0]=0.643137;

925 
	gm©
[1]=0.666667;

926 
	gm©
[2]=0.678431;

927 
	gm©
[3]=1.000000;

929 if(!
¡rcmp
(
Çme
,"Mt"))

931 
	gm©
[0]=0.643137;

932 
	gm©
[1]=0.666667;

933 
	gm©
[2]=0.678431;

934 
	gm©
[3]=1.000000;

938 
	gm©
[0]=0.500000;

939 
	gm©
[1]=0.500000;

940 
	gm©
[2]=0.500000;

941 
	gm©
[3]=0.435000;

	@elements.h

5 #iâdeà
__MAPP__–em’ts__


6 
	#__MAPP__–em’ts__


	)

7 
	~"glob®.h
"

8 
	~"­i.h
"

9 
	~<¡dio.h
>

10 
	g_objeù
;

11 
_objeù
 
	tPyObjeù
;

12 
Çme¥aû
 
	gMAPP_NS


14 şas 
	cEËm’ts


16 
	g´iv©e
:

17 
´Ùeùed
:

18 
public
:

19 
v¬
<
size_t
> 
__ÃËms__
;

20 
size_t
 
	gÃËms
;

21 
–em_ty³
 
	g__ÃËms
;

22 
	g¡d
::
¡ršg
* 
Çmes
;

23 
ty³0
* 
	gmas£s
;

25 
EËm’ts
();

26 
EËm’ts
(const Elements&);

27 
EËm’ts
(Elements&&);

28 
	gEËm’ts
& 
	gİ”©Ü
=(cÚ¡ 
EËm’ts
&);

29 
	gEËm’ts
& 
	gİ”©Ü
=(
EËm’ts
&&);

30 
boŞ
 
	gİ”©Ü
==(cÚ¡ 
EËm’ts
&);

31 ~
EËm’ts
();

32 
–em_ty³
 
add_ty³
(cÚ¡ 
ty³0
,const *);

33 
–em_ty³
 
fšd
(const *);

34 
assign_cŞÜ_¿d
(cÚ¡ *,
ty³0
(&)[4]);

35 
PyObjeù
* 
g‘_diù
();

36 
size_t
* 
m­
(cÚ¡ 
¡d
::
¡ršg
*,const size_t);

	@example.cpp

1 
	~"­i.h
"

2 
	~"exam¶e.h
"

3 
	~<¡ruùmemb”.h
>

4 
	~"glob®.h
"

5 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

8 
PyM‘hodDef
 
	gExam¶ePythÚ
::
_m‘hods
[]=
Em±yPyM‘hodDef
(2);

10 
	gExam¶ePythÚ
::
	$£tup__m‘hods
()

12 
_m‘hods
[0].
ml_Çme
="func";

13 
_m‘hods
[0].
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

14 
_m‘hods
[0].
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

15 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

18 
Py_RETURN_NONE
;

22 
_m‘hods
[0].
ml_doc
=(*)

23 
R
"---(

24 
	`func
(
•s
)

26 
A
 
Úe
-
lše
 
summ¬y
 
th©
 
dÛs
 
nÙ
 
u£
 
v¬ŸbË
 
Çmes
 
Ü
 
the
 
funùiÚ
 
Çme
.

28 
P¬am‘”s


30 
•s
 : 
¬¿y_like


31 
hi


33 
	}
}

35 
PyMemb”Def
 
Exam¶ePythÚ
::
_memb”s
[]=
Em±yPyMemb”Def
(2);

37 
	gExam¶ePythÚ
::
	$£tup__memb”s
()

40 
	}
}

42 
PyG‘S‘Def
 
Exam¶ePythÚ
::
_g‘£t
[]=
Em±yPyG‘S‘Def
(2);

44 
	gExam¶ePythÚ
::
	$£tup__g‘£t
()

50 
	}
}

54 
Exam¶ePythÚ
::
	$£t_mass
(
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)

57 
	}
}

61 
PyObjeù
* 
	gExam¶ePythÚ
::
	$g‘_mass
(
PyObjeù
* 
£lf
,* 
şosu»
)

63  
NULL
;

64 
	}
}

68 
PyObjeù
* 
	gExam¶ePythÚ
::
	$_Ãw
(
PyTy³Objeù
 *
ty³
, 
PyObjeù
 *
¬gs
, PyObjeù *
kwds
)

70 
Objeù
 *
£lf
;

71 
£lf
 = (
Objeù
 *)
ty³
->
	`_®loc
(type,0);

72  (
PyObjeù
*)
£lf
;

73 
	}
}

77 
	gExam¶ePythÚ
::
	$_š™
(
PyObjeù
 *
£lf_
, PyObjeù *
¬gs
, PyObjeù *
kwds
)

87 
	}
}

91 
	gExam¶ePythÚ
::
	$_d—Îoc
(
PyObjeù
* 
£lf_
)

93 
Objeù
* 
£lf
=(Objeù*)
£lf_
;

94 
	`Py_TYPE
(
£lf
)->
	`_ä“
((
PyObjeù
*)self);

95 
	}
}

99 
PyObjeù
* 
	gExam¶ePythÚ
::
	$‹¡_func
(
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)

101 
Py_RETURN_NONE
;

102 
	}
}

104 
PyTy³Objeù
 
	gExam¶ePythÚ
::
Ty³Objeù
 ={
PyObjeù_HEAD_INIT
(
NULL
)};

106 
	gExam¶ePythÚ
::
	$£tup_
()

108 
Ty³Objeù
.
_Çme
="xmpl.obj";

109 
Ty³Objeù
.
_doc
="I will‡dd doc here";

111 
Ty³Objeù
.
_æags
=
Py_TPFLAGS_DEFAULT
 | 
Py_TPFLAGS_BASETYPE
;

112 
Ty³Objeù
.
_basicsize
=(
Objeù
);

114 
Ty³Objeù
.
_Ãw
=tp_new;

115 
Ty³Objeù
.
_š™
=tp_init;

116 
Ty³Objeù
.
_d—Îoc
=tp_dealloc;

118 
	`£tup__memb”s
();

119 
Ty³Objeù
.
_memb”s
=tp_members;

120 
	`£tup__g‘£t
();

121 
Ty³Objeù
.
_g‘£t
=tp_getset;

122 
	`£tup__m‘hods
();

123 
Ty³Objeù
.
_m‘hods
=tp_methods;

125 
ichk
=
	`PyTy³_R—dy
(&
Ty³Objeù
);

126 if(
ichk
<0)  ichk;

127 
	`Py_INCREF
(&
Ty³Objeù
);

128  
ichk
;

129 
	}
}

132 #ifdeà
IS_PY3K


133 
PyModuËDef
 
	gExam¶ePythÚ
::
moduË
=
Em±yModuË
;

135 
MOD_INIT
(
xm¶
,
MAPP_NS
::
Exam¶ePythÚ
::
	$š™_moduË
())

137 
PyObjeù
* 
Exam¶ePythÚ
::
	$š™_moduË
()

139 #ifdeà
IS_PY3K


140 
Exam¶ePythÚ
::
moduË
.
m_Çme
="xmpl";

141 
Exam¶ePythÚ
::
moduË
.
m_doc
="MIT Atomistic Parallel Package";

142 
Exam¶ePythÚ
::
moduË
.
m_m‘hods
=
NULL
;

143 
PyObjeù
* 
moduË_ob
=
	`PyModuË_C»©e
(&
Exam¶ePythÚ
::
moduË
);

145 
PyObjeù
* 
moduË_ob
=
	`Py_In™ModuË3
("xm¶",
NULL
,"MIT Atomistic Parallel Package");

147 
Exam¶ePythÚ
::
	`£tup_
();

148 if(
	`PyTy³_R—dy
(&
Exam¶ePythÚ
::
Ty³Objeù
)<0è 
NULL
;

149 
	`Py_INCREF
(&
Exam¶ePythÚ
::
Ty³Objeù
);

150 
	`PyModuË_AddObjeù
(
moduË_ob
,"obj",
»š‹½»t_ÿ¡
<
PyObjeù
*>(&
Exam¶ePythÚ
::
Ty³Objeù
));

151  
moduË_ob
;

152 
	}
}

156 
	~<io¡»am
>

157 
	~<äameobjeù.h
>

158 
	~<py”rÜs.h
>

159 
	~"xm©h.h
"

160 
	~"©oms_¡yËs.h
"

162 
	gExam¶ePythÚ
::
	$ml_‹¡
(
PyM‘hodDef
& 
_m‘hods
)

164 
_m‘hods
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

165 
_m‘hods
.
ml_Çme
="test";

166 
_m‘hods
.
ml_doc
="run simulation for‚ steps";

168 
_m‘hods
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

169 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

171 
FuncAPI
<
OP
<
AtomsDMD
>>
	`f
("test",{"atoms"});

172 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

173 
AtomsDMD
* 
©oms
=
»š‹½»t_ÿ¡
<AtomsDMD::
Objeù
*>(
f
.
v®
<0>().
ob
)->atoms;

174 
ÃËms
=
¡©ic_ÿ¡
<>(
©oms
->
–em’ts
.nelems);

175 
ty³0
* 
®pha_ave_lş
=
Ãw
y³0[
ÃËms
];

176 
ty³0
* 
®pha_ave
=
Ãw
y³0[
ÃËms
];

177 
ty³0
* 
n_lş
=
Ãw
y³0[
ÃËms
];

178 
ty³0
* 
n
=
Ãw
y³0[
ÃËms
];

179 
size_t
 
i
=0;i<
ÃËms
;i++è
®pha_ave_lş
[i]=
n_lş
[i]=0.0;

180 
ty³0
* 
c
=
©oms
->c->
	`begš
();

181 
ty³0
* 
®pha
=
©oms
->®pha->
	`begš
();

182 
–em_ty³
* 
–em
=
©oms
->–em->
	`begš
();

183 
Çtms_lş
=
©oms
->natms_lcl;

184 
c_dim
=
©oms
->c_dim;

185 
i
=0;i<
Çtms_lş
;i++)

187 
j
=0;j<
c_dim
;j++)

189 if(
c
[
j
]>=0.0)

191 
®pha_ave_lş
[
–em
[
j
]]+=
®pha
[j];

192 
n_lş
[
–em
[
j
]]++;

196 
c
+=
c_dim
;

197 
®pha
+=
c_dim
;

200 
	`MPI_AÎ»duû
(
®pha_ave_lş
,
®pha_ave
,
ÃËms
,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
©oms
->
wÜld
);

201 
	`MPI_AÎ»duû
(
n_lş
,
n
,
ÃËms
,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
©oms
->
wÜld
);

203 
i
=0;i<
ÃËms
;i++)

204 
®pha_ave
[
i
]/=
n
[i];

206 
size_t
* 
__ÃËms
=&(
©oms
->
–em’ts
.
ÃËms
);

207 
PyObjeù
* 
İ
=
v¬
<
ty³0
*>::
	`bud
(
®pha_ave
,&
__ÃËms
);

208 
d–‘e
 [] 
n
;

209 
d–‘e
 [] 
n_lş
;

210 
d–‘e
 [] 
®pha_ave
;

211 
d–‘e
 [] 
®pha_ave_lş
;

213  
İ
;

342 
	}
}

347 
	~"dyÇmic_md.h
"

348 
	~"ff_¡yËs.h
"

349 
	gExam¶ePythÚ
::
	$ml_phÚÚ
(
PyM‘hodDef
& 
_m‘hods
)

351 
_m‘hods
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

352 
_m‘hods
.
ml_Çme
="phonon";

353 
_m‘hods
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

354 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

423 
FuncAPI
<
OP
<
AtomsMD
>,
ty³0
> 
	`f
("phonon",{"atoms","max_disp"});

424 
f
.
logics
<1>()[0]=
	`VLogics
("gt",0.0);

425 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

428 
ty³0
 
di¥
=
f
.
v
<1>();

432 
AtomsMD
* 
©oms
=
»š‹½»t_ÿ¡
<AtomsMD::
Objeù
*>(
f
.
v®
<0>().
ob
)->atoms;

433 
FÜûF›ldMD
* 
ff
=
»š‹½»t_ÿ¡
<
AtomsMD
::
Objeù
*>(
f
.
v®
<0>().
ob
)->ff;

436 
DyÇmicMD
* 
dyÇmic
=
Ãw
 
	`DyÇmicMD
(
©oms
,
ff
,
çl£
,{},{},{});

437 
dyÇmic
->
	`š™
();

440 
Vec
<
ty³0
> 
	`v0
(
©oms
,
__dim__
);

441 
Vec
<
ty³0
> 
	`v1
(
©oms
,
__dim__
);

442 
Vec
<
ty³0
> 
	`v2
(
©oms
,
__dim__
);

443 
ty³0
 
x0
;

444 
x0
=
©oms
->
x
->
	`begš
()[0];

445 
©oms
->
x
->
	`begš
()[0]+=
di¥
;

446 
dyÇmic
->
	`upd©e
(
©oms
->
x
);

447 
ff
->
	`d”iv©ive
();

448 
	`memıy
(
v0
.
	`begš
(),
ff
->
f
->begš(),
©oms
->
Çtms_lş
*
__dim__
*(
ty³0
));

449 
©oms
->
x
->
	`begš
()[0]=
x0
;

452 
x0
=
©oms
->
x
->
	`begš
()[1];

453 
©oms
->
x
->
	`begš
()[1]+=
di¥
;

454 
dyÇmic
->
	`upd©e
(
©oms
->
x
);

455 
ff
->
	`d”iv©ive
();

456 
	`memıy
(
v1
.
	`begš
(),
ff
->
f
->begš(),
©oms
->
Çtms_lş
*
__dim__
*(
ty³0
));

457 
©oms
->
x
->
	`begš
()[1]=
x0
;

460 
x0
=
©oms
->
x
->
	`begš
()[2];

461 
©oms
->
x
->
	`begš
()[2]+=
di¥
;

462 
dyÇmic
->
	`upd©e
(
©oms
->
x
);

463 
ff
->
	`d”iv©ive
();

464 
	`memıy
(
v2
.
	`begš
(),
ff
->
f
->begš(),
©oms
->
Çtms_lş
*
__dim__
*(
ty³0
));

465 
©oms
->
x
->
	`begš
()[2]=
x0
;

470 
©oms
->
	`x2s_lş
();

472 
ty³0
 
B
[
__dim__
][__dim__]={{-0.5,0.5,0.5},{0.5,-0.5,0.5},{0.5,0.5,-0.5}};

473 
ty³0
 
s
[
__dim__
];

476 
	`´štf
("----------------------------------------------------\n");

478 
ty³0
* 
__s
=
©oms
->
x
->
	`begš
();

479 
ty³0
* 
__v0
=
v0
.
	`begš
();

480 
ty³0
* 
__v1
=
v1
.
	`begš
();

481 
ty³0
* 
__v2
=
v2
.
	`begš
();

482 
ty³0
 
mš
[
__dim__
]={0,0,0};

483 
ty³0
 
max
[
__dim__
]={0,0,0};

485 
i
=0;i<
©oms
->
Çtms_lş
;i++)

487 
j
=0;j<
__dim__
;j++)

489 
__v0
[
j
]/=-
di¥
;

490 
__v1
[
j
]/=-
di¥
;

491 
__v2
[
j
]/=-
di¥
;

493 
s
[
j
]=0.0;

494 
k
=0;k<
__dim__
;k++)

495 
s
[
j
]+=(
__s
[
k
]-0.5)*
B
[k][j]*8.0;

497 
mš
[
j
]=
	`MIN
(mš[j],
s
[j]);

498 
max
[
j
]=
	`MAX
(max[j],
s
[j]);

501 
	`´štf
("Exp[(%.0lf*k[[1]]+%.0lf*k[[2]]+%.0lf*k[[3]])*2*Pi*I]*{{%0.7lf,%0.7lf,%0.7lf},{%0.7lf,%0.7lf,%0.7lf},{%0.7lf,%0.7lf,%0.7lf}}",
s
[0],s[1],s[2],

502 
__v0
[0],__v0[1],__v0[2],

503 
__v1
[0],__v1[1],__v1[2],

504 
__v2
[0],__v2[1],__v2[2]);

507 
__v0
+=
__dim__
;

508 
__v1
+=
__dim__
;

509 
__v2
+=
__dim__
;

510 
__s
+=
__dim__
;

512 if(
i
!=
©oms
->
Çtms_lş
-1)

513 
	`´štf
("+\n");

515 
	`´štf
(";\n");

519 
	`´štf
("----------------------------------------------------\n");

520 
	`´štf
("mš %.0là%.0là%.0lf\n",
mš
[0],min[1],min[2]);

521 
	`´štf
("max %.0là%.0là%.0lf\n",
max
[0],max[1],max[2]);

522 
	`´štf
("----------------------------------------------------\n");

523 
dyÇmic
->
	`upd©e
(
©oms
->
x
);

525 
dyÇmic
->
	`fš
();

526 
d–‘e
 
dyÇmic
;

527 
Py_RETURN_NONE
;

531 
_m‘hods
.
ml_doc
=(*)
R
"---(

532 
quick
 
funùiÚ
 
ÿlcuÏ‹šg
 
phÚÚ
 
äeq


533 
u£
 
w™h
 
ÿutiÚ


536 
	}
}

540 
	gExam¶ePythÚ
::
	$ml_phÚÚ_1d
(
PyM‘hodDef
& 
_m‘hods
)

542 
_m‘hods
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

543 
_m‘hods
.
ml_Çme
="phonon_1d";

544 
_m‘hods
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

545 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

547 
FuncAPI
<
OP
<
AtomsMD
>,
ty³0
> 
	`f
("phonon",{"atoms","max_disp"});

548 
f
.
logics
<1>()[0]=
	`VLogics
("ge",0.0);

549 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

552 
ty³0
 
di¥
=
f
.
v
<1>();

556 
AtomsMD
* 
©oms
=
»š‹½»t_ÿ¡
<AtomsMD::
Objeù
*>(
f
.
v®
<0>().
ob
)->atoms;

557 
FÜûF›ldMD
* 
ff
=
»š‹½»t_ÿ¡
<
AtomsMD
::
Objeù
*>(
f
.
v®
<0>().
ob
)->ff;

560 
DyÇmicMD
* 
dyÇmic
=
Ãw
 
	`DyÇmicMD
(
©oms
,
ff
,
çl£
,{},{},{});

561 
dyÇmic
->
	`š™
();

564 
ty³0
 
x0
;

565 
N
=5;

567 
x0
=
©oms
->
x
->
	`begš
()[
N
*3];

568 
©oms
->
x
->
	`begš
()[
N
*3]+=
di¥
;

569 
dyÇmic
->
	`upd©e
(
©oms
->
x
);

570 
ff
->
	`d”iv©ive
();

571 
©oms
->
x
->
	`begš
()[1]=
x0
;

573 
i
=0;i<
N
+1;i++)

574 
	`´štf
("%lf\n",-
ff
->
f
->
	`begš
()[
i
*3]/
di¥
);

576 
dyÇmic
->
	`upd©e
(
©oms
->
x
);

578 
dyÇmic
->
	`fš
();

579 
d–‘e
 
dyÇmic
;

580 
Py_RETURN_NONE
;

584 
_m‘hods
.
ml_doc
=(*)
R
"---(

585 
quick
 
funùiÚ
 
ÿlcuÏ‹šg
 
phÚÚ
 
äeq


586 
u£
 
w™h
 
ÿutiÚ


589 
	}
}

593 
	gExam¶ePythÚ
::
	$ml_phÚÚ_1dd
(
PyM‘hodDef
& 
_m‘hods
)

595 
_m‘hods
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

596 
_m‘hods
.
ml_Çme
="phonon_1dd";

597 
_m‘hods
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

598 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

600 
FuncAPI
<
OP
<
AtomsMD
>,
ty³0
> 
	`f
("phonon",{"atoms","max_disp"});

601 
f
.
logics
<1>()[0]=
	`VLogics
("ge",0.0);

602 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

605 
ty³0
 
di¥
=
f
.
v
<1>();

609 
AtomsMD
* 
©oms
=
»š‹½»t_ÿ¡
<AtomsMD::
Objeù
*>(
f
.
v®
<0>().
ob
)->atoms;

610 
FÜûF›ldMD
* 
ff
=
»š‹½»t_ÿ¡
<
AtomsMD
::
Objeù
*>(
f
.
v®
<0>().
ob
)->ff;

613 
DyÇmicMD
* 
dyÇmic
=
Ãw
 
	`DyÇmicMD
(
©oms
,
ff
,
çl£
,{},{},{});

614 
dyÇmic
->
	`š™
();

617 
ty³0
 
x0
;

620 
i
=0;i<5;i++)

622 
x0
=
©oms
->
x
->
	`begš
()[
i
*3];

623 
©oms
->
x
->
	`begš
()[
i
*3]+=
di¥
;

624 
dyÇmic
->
	`upd©e
(
©oms
->
x
);

625 
ff
->
	`d”iv©ive
();

626 
©oms
->
x
->
	`begš
()[
i
*3]=
x0
;

628 
j
=0;j<10;j++)

630 
	`´štf
("J[[%d,%d]]=%.10lf;\n",
i
+1,
j
+1,-
ff
->
f
->
	`begš
()[j*3]/
di¥
);

631 
	`´štf
("J[[%d,%d]]=%.10lf;\n",11-(
i
+1),11-(
j
+1),-
ff
->
f
->
	`begš
()[j*3]/
di¥
);

637 
dyÇmic
->
	`upd©e
(
©oms
->
x
);

639 
dyÇmic
->
	`fš
();

640 
d–‘e
 
dyÇmic
;

641 
Py_RETURN_NONE
;

645 
_m‘hods
.
ml_doc
=(*)
R
"---(

646 
quick
 
funùiÚ
 
ÿlcuÏ‹šg
 
phÚÚ
 
äeq


647 
u£
 
w™h
 
ÿutiÚ


650 
	}
}

654 
	~"dyÇmic_dmd.h
"

655 
	gExam¶ePythÚ
::
	$ml_®pha
(
PyM‘hodDef
& 
_m‘hods
)

657 
_m‘hods
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

658 
_m‘hods
.
ml_Çme
="alpha";

659 
_m‘hods
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

660 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

663 
FuncAPI
<
OP
<
AtomsDMD
>,
ty³0
,ty³0,> 
	`f
("alpha",{"atoms","dalpha0","dalpha1","N"});

664 
f
.
logics
<1>()[0]=
	`VLogics
("lt",0.0);

665 
f
.
logics
<2>()[0]=
	`VLogics
("gt",0.0);

666 
f
.
logics
<3>()[0]=
	`VLogics
("gt",0);

667 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

670 
ty³0
 
di¥
=
f
.
v
<1>();

671 
n
=
f
.
v
<3>();

672 
ty³0
 
d–
=(
f
.
v
<2>()-
di¥
)/
n
;

675 
AtomsDMD
* 
©oms
=
»š‹½»t_ÿ¡
<AtomsDMD::
Objeù
*>(
f
.
v®
<0>().
ob
)->atoms;

676 
FÜûF›ldDMD
* 
ff
=
»š‹½»t_ÿ¡
<
AtomsDMD
::
Objeù
*>(
f
.
v®
<0>().
ob
)->ff;

679 
Vec
<
ty³0
> 
	`®pha0
(
©oms
,©oms->
c_dim
);

680 
DyÇmicDMD
* 
dyÇmic
=
Ãw
 
	`DyÇmicDMD
(
©oms
,
ff
,
çl£
,{},{&
®pha0
},{});

681 
dyÇmic
->
	`š™
();

682 
¿nk
=
©oms
->
comm_¿nk
;

684 
	`memıy
(
®pha0
.
	`begš
(),
©oms
->
®pha
->begš(),©oms->
Çtms_lş
*©oms->
c_dim
*(
ty³0
));

685 #ifdeà
OLD_UPDATE


686 
vec
* 
uvecs
[2];

687 
uvecs
[0]=
©oms
->
x
;

688 
uvecs
[1]=
©oms
->
®pha
;

693 if(!
¿nk
)

694 
	`´štf
("----------------------------------------------------\n");

695 
ty³0
 
’
;

696 
i
=0;i<
n
+1;i++)

698 
j
=0;j<
©oms
->
Çtms_lş
;j++è©oms->
®pha
->
	`begš
()[j]=
®pha0
.begš()[j]+
di¥
;

699 #ifdeà
OLD_UPDATE


700 
dyÇmic
->
	`upd©e
(
uvecs
,2);

702 
dyÇmic
->
upd©e
<
Œue
,true>();

704 
’
=
ff
->
	`v®ue
();

705 if(!
¿nk
)

708 
	`´štf
("%.12lf\t%.12lf\n",
di¥
,
’
);

711 
di¥
+=
d–
;

716 if(!
¿nk
)

717 
	`´štf
("----------------------------------------------------\n");

719 
	`memıy
(
©oms
->
®pha
->
	`begš
(),
®pha0
.begš(),©oms->
Çtms_lş
*©oms->
c_dim
*(
ty³0
));

720 #ifdeà
OLD_UPDATE


721 
dyÇmic
->
	`upd©e
(
uvecs
,2);

723 
dyÇmic
->
upd©e
<
Œue
,true>();

726 
dyÇmic
->
	`fš
();

727 
d–‘e
 
dyÇmic
;

729 
Py_RETURN_NONE
;

733 
_m‘hods
.
ml_doc
=(*)
R
"---(

734 
quick
 
funùiÚ
 
ÿlcuÏ‹šg
 
phÚÚ
 
äeq


735 
u£
 
w™h
 
ÿutiÚ


738 
	}
}

743 
	gExam¶ePythÚ
::
	$ml_d–_c
(
PyM‘hodDef
& 
_m‘hods
)

745 
_m‘hods
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

746 
_m‘hods
.
ml_Çme
="delta_c";

747 
_m‘hods
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

748 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

751 
FuncAPI
<
OP
<
AtomsDMD
>,
ty³0
> 
	`f
("delta_c",{"atoms","dc"});

752 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

755 
AtomsDMD
* 
©oms
=
»š‹½»t_ÿ¡
<AtomsDMD::
Objeù
*>(
f
.
v®
<0>().
ob
)->atoms;

756 
ty³0
 
di¥
=
f
.
v
<1>();

757 
ty³0
* 
c
=
©oms
->c->
	`begš
();

758 
c
[0]+=
di¥
;

760 
Py_RETURN_NONE
;

764 
_m‘hods
.
ml_doc
=(*)
R
"---(

765 
quick
 
funùiÚ
 
ÿlcuÏ‹šg
 
phÚÚ
 
äeq


766 
u£
 
w™h
 
ÿutiÚ


769 
	}
}

773 
	gExam¶ePythÚ
::
	$ml_mv_c
(
PyM‘hodDef
& 
_m‘hods
)

775 
_m‘hods
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

776 
_m‘hods
.
ml_Çme
="mv_c";

777 
_m‘hods
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

778 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

781 
FuncAPI
<
OP
<
AtomsDMD
>,
ty³0
> 
	`f
("mv_c",{"atoms","dc"});

782 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

785 
AtomsDMD
* 
©oms
=
»š‹½»t_ÿ¡
<AtomsDMD::
Objeù
*>(
f
.
v®
<0>().
ob
)->atoms;

786 
ty³0
 
x
=
f
.
v
<1>();

787 
ty³0
 
__x
=1.0-
x
;

788 
ty³0
* 
c
=
©oms
->c->
	`begš
();

789 
Çtms_lş
=
©oms
->natms_lcl;

790 
i
=0;i<
Çtms_lş
;i++,
c
+=2)

792 
c
[0]=
x
;

793 
c
[1]=
__x
;

796 
Py_RETURN_NONE
;

800 
_m‘hods
.
ml_doc
=(*)
R
"---(

801 
quick
 
funùiÚ
 
ÿlcuÏ‹šg
 
phÚÚ
 
äeq


802 
u£
 
w™h
 
ÿutiÚ


805 
	}
}

809 
	gExam¶ePythÚ
::
	$ml_mv_c2
(
PyM‘hodDef
& 
_m‘hods
)

811 
_m‘hods
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

812 
_m‘hods
.
ml_Çme
="mv_c2";

813 
_m‘hods
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

814 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

817 
FuncAPI
<
OP
<
AtomsDMD
>,
ty³0
> 
	`f
("mv_c2",{"atoms","dc"});

818 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

821 
AtomsDMD
* 
©oms
=
»š‹½»t_ÿ¡
<AtomsDMD::
Objeù
*>(
f
.
v®
<0>().
ob
)->atoms;

822 
ty³0
 
x
=
f
.
v
<1>();

825 if(
x
>0.25)

828 
ty³0
 
__ni
=(1.0-
x
)*4.0/3.0;

829 
ty³0
 
__®
=1.0-
__ni
;

831 
ty³0
* 
c
=
©oms
->c->
	`begš
();

832 
Çtms_lş
=
©oms
->natms_lcl;

833 
c
[0]=0.0;

834 
c
[1]=1.0;

835 
c
+=2;

837 
i
=1;i<
Çtms_lş
;i++,
c
+=2)

839 
c
[0]=
__ni
;

840 
c
[1]=
__®
;

845 
ty³0
* 
c
=
©oms
->c->
	`begš
();

846 
Çtms_lş
=
©oms
->natms_lcl;

847 
c
[0]=1.0-4.0*
x
;

848 
c
[1]=4.0*
x
;

849 
c
+=2;

851 
i
=1;i<
Çtms_lş
;i++,
c
+=2)

853 
c
[0]=1.0;

854 
c
[1]=0.0;

858 
Py_RETURN_NONE
;

862 
_m‘hods
.
ml_doc
=(*)
R
"---(

863 
quick
 
funùiÚ
 
ÿlcuÏ‹šg
 
phÚÚ
 
äeq


864 
u£
 
w™h
 
ÿutiÚ


867 
	}
}

871 
	gExam¶ePythÚ
::
	$ml_mv_c3
(
PyM‘hodDef
& 
_m‘hods
)

873 
_m‘hods
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

874 
_m‘hods
.
ml_Çme
="mv_c3";

875 
_m‘hods
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

876 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

879 
FuncAPI
<
OP
<
AtomsDMD
>,
ty³0
,ty³0> 
	`f
("mv_c3",{"atoms","x","a"});

880 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

883 
AtomsDMD
* 
©oms
=
»š‹½»t_ÿ¡
<AtomsDMD::
Objeù
*>(
f
.
v®
<0>().
ob
)->atoms;

884 
ty³0
 
x
=
f
.
v
<1>();

885 
ty³0
 
a
=
f
.
v
<2>();

886 
ty³0
 
b
=(4.0*
x
-
a
)/3.0;

889 
ty³0
* 
c
=
©oms
->c->
	`begš
();

890 
Çtms_lş
=
©oms
->natms_lcl;

891 
c
[0]=
a
;

892 
c
[1]=1.0-
a
;

893 
c
+=2;

895 
i
=1;i<
Çtms_lş
;i++,
c
+=2)

897 
c
[0]=
b
;

898 
c
[1]=1.0-
b
;

902 
Py_RETURN_NONE
;

906 
_m‘hods
.
ml_doc
=(*)
R
"---(

907 
quick
 
funùiÚ
 
ÿlcuÏ‹šg
 
phÚÚ
 
äeq


908 
u£
 
w™h
 
ÿutiÚ


911 
	}
}

915 
	gExam¶ePythÚ
::
	$ml_´t
(
PyM‘hodDef
& 
_m‘hods
)

917 
_m‘hods
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

918 
_m‘hods
.
ml_Çme
="prt";

919 
_m‘hods
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

920 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

923 
FuncAPI
<
OP
<
AtomsDMD
>> 
	`f
("prt",{"atoms"});

924 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

927 
AtomsDMD
* 
©oms
=
»š‹½»t_ÿ¡
<AtomsDMD::
Objeù
*>(
f
.
v®
<0>().
ob
)->atoms;

928 
ty³0
* 
c
=
©oms
->c->
	`begš
();

929 
ty³0
* 
®pha
=
©oms
->®pha->
	`begš
();

930 
	`´štf
("%.30lf\t%.18lf\n",
c
[0],
®pha
[0]);

932 
Py_RETURN_NONE
;

936 
_m‘hods
.
ml_doc
=(*)
R
"---(

937 
quick
 
funùiÚ
 
ÿlcuÏ‹šg
 
phÚÚ
 
äeq


938 
u£
 
w™h
 
ÿutiÚ


941 
	}
}

	@example.h

1 #iâdeà
__MAPP__exam¶e__


2 
	#__MAPP__exam¶e__


	)

3 
Çme¥aû
 
	gMAPP_NS


6 şas 
	cExam¶ePythÚ


8 
	gpublic
:

11 
PyObjeù_HEAD


12 
PyObjeù
* 
mass
;

14 }
	tObjeù
;

15 
PyTy³Objeù
 
	gTy³Objeù
;

17 
£t_mass
(
PyObjeù
*,PyObject*,*);

18 
PyObjeù
* 
g‘_mass
(PyObjeù* 
£lf
,*);

19 
PyObjeù
* 
_Ãw
(
PyTy³Objeù
*,PyObject*, PyObject*);

20 
_š™
(
PyObjeù
*, PyObject*,PyObject*);

21 
_d—Îoc
(
PyObjeù
*);

23 
PyObjeù
* 
‹¡_func
(PyObject*,PyObject*,PyObject*);

24 #ifdeà
IS_PY3K


25 
PyModuËDef
 
	gmoduË
;

27 
PyObjeù
* 
š™_moduË
();

29 
PyMemb”Def
 
	g_memb”s
[];

30 
£tup__memb”s
();

32 
PyG‘S‘Def
 
	g_g‘£t
[];

33 
£tup__g‘£t
();

35 
PyM‘hodDef
 
	g_m‘hods
[];

36 
£tup__m‘hods
();

37 
£tup_
();

39 
ml_‹¡
(
PyM‘hodDef
&);

40 
ml_phÚÚ
(
PyM‘hodDef
&);

41 
ml_phÚÚ_1d
(
PyM‘hodDef
&);

42 
ml_phÚÚ_1dd
(
PyM‘hodDef
&);

43 
ml_®pha
(
PyM‘hodDef
&);

44 
ml_d–_c
(
PyM‘hodDef
&);

45 
ml_mv_c
(
PyM‘hodDef
&);

46 
ml_mv_c2
(
PyM‘hodDef
&);

47 
ml_mv_c3
(
PyM‘hodDef
&);

48 
ml_´t
(
PyM‘hodDef
&);

	@exchange.cpp

1 #ifdeà
OLD_UPDATE


2 
	~"©oms.h
"

3 
	~"exchªge.h
"

4 
	~"comm.h
"

5 
	~"xm©h.h
"

10 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

22 
	gExchªge
::
	$Exchªge
(
Atoms
* 
©oms
,& 
__nxchng_vecs
):

23 
	`Çtms_lş
(
©oms
->
Çtms_lş
),

24 
	`x
(
©oms
->
x
),

25 
	`wÜld
(
©oms
->
comm
.
wÜld
),

26 
	`¿nk
(
©oms
->
comm
.
¿nk
),

27 
	`s_lo
(
©oms
->
comm
.
s_lo
),

28 
	`s_hi
(
©oms
->
comm
.
s_hi
),

29 
	`xchng_id
(
©oms
->
comm
.
xchng_id
),

31 
	`vecs
(
©oms
->
dyÇmic_vecs
),

32 
	`nvecs
(
©oms
->
ndyÇmic_vecs
),

33 
	$nxchng_vecs
(
__nxchng_vecs
)

35 
Algeb¿
::
V_eq
<
__dim__
*2>(&(
©oms
->
comm
.
Ãigh
[0][0]), &(neigh[0][0]));

36 
¢d_buff
[0]=¢d_buff[1]=
NULL
;

37 
¢d_buff_sz
[0]=snd_buff_sz[1]=0;

38 
¢d_buff_ıùy
[0]=snd_buff_cpcty[1]=0;

40 
rcv_buff
=
NULL
;

41 
rcv_buff_sz
=0;

42 
rcv_buff_ıùy
=0;

44 
tÙ_xchng_sz
=0;

45 
ivec
=0;ivec<
nxchng_vecs
;ivec++)

46 
tÙ_xchng_sz
+=
vecs
[
ivec
]->
by‹_sz
;

48 
	}
}

52 
	gExchªge
::~
	$Exchªge
()

54 
d–‘e
 [] 
¢d_buff
[0];

55 
d–‘e
 [] 
¢d_buff
[1];

56 
d–‘e
 [] 
rcv_buff
;

57 
	}
}

61 
šlše
 
	gExchªge
::
	$lßd
(& 
Ÿtm
,
idœ
)

63 if(
¢d_buff_ıùy
[
idœ
]<
¢d_buff_sz
[idœ]+
tÙ_xchng_sz
)

65 
by‹
* 
tmp_buff
=
Ãw
 by‹[
¢d_buff_sz
[
idœ
]+
tÙ_xchng_sz
+
buff_grw
];

66 
	`memıy
(
tmp_buff
,
¢d_buff
[
idœ
],
¢d_buff_sz
[idir]);

67 
d–‘e
 [] 
¢d_buff
[
idœ
];

68 
¢d_buff
[
idœ
]=
tmp_buff
;

69 
¢d_buff_ıùy
[
idœ
]=
¢d_buff_sz
[idœ]+
tÙ_xchng_sz
+
buff_grw
;

71 
by‹
* 
tmp_buff
=&
¢d_buff
[
idœ
][
¢d_buff_sz
[idir]];

73 
ivec
=0;ivec<
nxchng_vecs
;ivec++)

74 
vecs
[
ivec
]->
	`pİ_out
(
tmp_buff
,
Ÿtm
);

76 
¢d_buff_sz
[
idœ
]+=
tÙ_xchng_sz
;

77 
	}
}

81 
šlše
 
	gExchªge
::
	$lßd
(
by‹
*& 
buff
,& 
idœ
)

83 if(
¢d_buff_ıùy
[
idœ
]<
¢d_buff_sz
[idœ]+
tÙ_xchng_sz
)

85 
by‹
* 
tmp_buff
=
Ãw
 by‹[
¢d_buff_sz
[
idœ
]+
tÙ_xchng_sz
+
buff_grw
];

86 
	`memıy
(
tmp_buff
,
¢d_buff
[
idœ
],
¢d_buff_sz
[idir]);

87 
d–‘e
 [] 
¢d_buff
[
idœ
];

88 
¢d_buff
[
idœ
]=
tmp_buff
;

89 
¢d_buff_ıùy
[
idœ
]=
¢d_buff_sz
[idœ]+
tÙ_xchng_sz
+
buff_grw
;

91 
	`memıy
(&
¢d_buff
[
idœ
][
¢d_buff_sz
[idœ]],
buff
,
tÙ_xchng_sz
);

92 
¢d_buff_sz
[
idœ
]+=
tÙ_xchng_sz
;

93 
buff
+=
tÙ_xchng_sz
;

94 
	}
}

98 
šlše
 
	gExchªge
::
	$xchng_buff
(
idim
,
idœ
)

100 
rcv_buff_sz
=0;

101 
max_¢d_sz
;

102 
	`MPI_AÎ»duû
(&
¢d_buff_sz
[
idœ
],&
max_¢d_sz
,1,
MPI_INT
,
MPI_MAX
,
wÜld
);

103 if(
max_¢d_sz
==0)

106 
	`MPI_S’d»cv
(&
¢d_buff_sz
[
idœ
],1,
MPI_INT
,
Ãigh
[
idim
][idir],0,

107 &
rcv_buff_sz
,1,
MPI_INT
,
Ãigh
[
idim
][1-
idœ
],0,

108 
wÜld
,
MPI_STATUS_IGNORE
);

110 if(
rcv_buff_ıùy
<
rcv_buff_sz
)

112 
d–‘e
 [] 
rcv_buff
;

113 
rcv_buff
=
Ãw
 
by‹
[
rcv_buff_sz
+
buff_grw
];

114 
rcv_buff_ıùy
=
rcv_buff_sz
+
buff_grw
;

117 
	`MPI_S’d»cv
(
¢d_buff
[
idœ
],
¢d_buff_sz
[idœ],
MPI_BYTE
,
Ãigh
[
idim
][idir],0,

118 
rcv_buff
,
rcv_buff_sz
,
MPI_BYTE
,
Ãigh
[
idim
][1-
idœ
],0,

119 
wÜld
,
MPI_STATUS_IGNORE
);

122 
¢d_buff_sz
[
idœ
]=0;

129 
ivec
=0;ivec<
nxchng_vecs
;ivec++)

130 
vecs
[
ivec
]->
	`»£rve
(
rcv_buff_sz
/
tÙ_xchng_sz
);

133 
	}
}

137 
	gExchªge
::
	$fuÎ_xchng
()

139 
ivec
=0;ivec<
nxchng_vecs
;ivec++)

140 
vecs
[
ivec
]->
	`»size
(
Çtms_lş
);

141 
di¥
;

142 
ty³0
 
s
,
ds_lo
,
ds_hi
;

143 
Ÿtm
;

144 
xchng_lş
=0;

146 
idim
=0;idim<
__dim__
;idim++)

148 if(
¿nk
==
Ãigh
[
idim
][0] &&„ank==neigh[idim][1])

151 
di¥
=
idim
*(
ty³0
);

153 
¢d_buff_sz
[0]=snd_buff_sz[1]=0;

154 
Ÿtm
=0;

155 
ty³0
* 
s_±r
=
x
->
	`begš
()+
idim
;

156 
n
=
x
->
vec_sz
;

157 
Ÿtm
<
n
)

161 
s
=*
s_±r
;

162 if(
s_lo
[
idim
]<=
s
 && s<
s_hi
[idim])

164 
Ÿtm
++;

165 
s_±r
+=
__dim__
;

169 if(
s
>=
s_hi
[
idim
])

171 
ds_hi
=
s
-
s_hi
[
idim
];

172 
ds_lo
=1.0+
s_lo
[
idim
]-
s
;

176 
ds_hi
=1.0+
s
-
s_hi
[
idim
];

177 
ds_lo
=
s_lo
[
idim
]-
s
;

180 if(
ds_hi
<
ds_lo
)

181 
	`lßd
(
Ÿtm
,
¢d_to_äÁ
);

183 
	`lßd
(
Ÿtm
,
¢d_to_bhnd
);

184 
n
--;

187 if(
¢d_buff_sz
[0]+snd_buff_sz[1])

188 
xchng_lş
=1;

190 
by‹
* 
buff_tmp
;

191 
idœ
=0;idir<2;idir++)

193 
	`xchng_buff
(
idim
,
idœ
))

195 
buff_tmp
=
rcv_buff
;

196 
rcv_buff_sz
)

198 
s
=*(
ty³0
*)(
buff_tmp
+
di¥
);

199 if(
s_lo
[
idim
]<=
s
 && s<
s_hi
[idim])

200 
ivec
=0;ivec<
nxchng_vecs
;ivec++)

201 
vecs
[
ivec
]->
	`pİ_š
(
buff_tmp
);

203 
	`lßd
(
buff_tmp
,
idœ
);

205 
rcv_buff_sz
-=
tÙ_xchng_sz
;

211 
xchng
;

212 
	`MPI_AÎ»duû
(&
xchng_lş
,&
xchng
,1,
MPI_INT
,
MPI_MAX
,
wÜld
);

213 if(
xchng
è
xchng_id
++;

214 
Çtms_lş
=
x
->
vec_sz
;

215 
	}
}

219 
	gExchªge
::
	$fuÎ_xchng_®l
()

221 if(
nvecs
==
nxchng_vecs
è 
	`fuÎ_xchng
();

222 
__nxchng_vecs
=
nxchng_vecs
;

223 
__tÙ_xchng_sz
=
tÙ_xchng_sz
;

225 
nxchng_vecs
=
nvecs
;

226 
tÙ_xchng_sz
=0;

227 
ivec
=0;ivec<
nxchng_vecs
;ivec++)

228 
tÙ_xchng_sz
+=
vecs
[
ivec
]->
by‹_sz
;

229 
	`fuÎ_xchng
();

230 
nxchng_vecs
=
__nxchng_vecs
;

231 
tÙ_xchng_sz
=
__tÙ_xchng_sz
;

232 
	}
}

244 
	gUpd©e
::
	$Upd©e
(
Atoms
* 
©oms
,

245 & 
nupdt_vecs_
,& 
nxchng_vecs_
):

246 
	`Çtms_lş
(
©oms
->
Çtms_lş
),

247 
	`Çtms_ph
(
©oms
->
Çtms_ph
),

248 
	`H
(
©oms
->
H
),

249 
	`d•th_šv
(
©oms
->
d•th_šv
),

251 
	`¿nk
(
©oms
->
comm
.
¿nk
),

252 
	`s_lo
(
©oms
->
comm
.
s_lo
),

253 
	`s_hi
(
©oms
->
comm
.
s_hi
),

255 
	`max_cut
(
©oms
->
max_cut
),

256 
	`x
(
©oms
->
x
),

258 
	`vecs
(
©oms
->
dyÇmic_vecs
),

259 
	`nvecs
(
©oms
->
ndyÇmic_vecs
),

260 
	`nupdt_vecs
(
nupdt_vecs_
),

261 
	$nxchng_vecs
(
nxchng_vecs_
)

264 
Algeb¿
::
V_eq
<
__dim__
*2>(&(
©oms
->
comm
.
Ãigh
[0][0]),&(neigh[0][0]));

265 
¢d_buff
=
NULL
;

266 
¢d_buff_ıùy
=0;

268 
rcv_buff
=
NULL
;

269 
rcv_buff_ıùy
=0;

272 
tÙ_updt_vecs_sz
=0;

273 
ivec
=0;ivec<
nupdt_vecs
;ivec++)

274 
tÙ_updt_vecs_sz
+=
vecs
[
ivec
]->
by‹_sz
;

276 
icurs
=0;

277 
idim
=0;idim<
__dim__
;idim++)

279 if(
¿nk
==
Ãigh
[
idim
][0] &&„ank==neigh[idim][1])

280 
comm_mªag”
[
idim
]=
Ãw
 
	`LßdUnLßdUpd©eS–fComm
(
this
);

282 
comm_mªag”
[
idim
]=
Ãw
 
	`LßdUnLßdUpd©eComm
(
this
,
©oms
->
comm
.
wÜld
);

285 
pbc_cÜ»ùiÚ
[
idim
][0]=(
©oms
->
comm
.
coÜds
[idim]=÷toms->comm.
dims
[idim]-1);

286 
icurs
++;

289 
pbc_cÜ»ùiÚ
[
idim
][1]=(
©oms
->
comm
.
coÜds
[idim]==0);

290 
icurs
++;

293 
tÙ_ncomms
=0;

294 
¢d_©ms_l¡
=
NULL
;

295 
¢d_©ms_l¡_ıùy
=
¢d_©ms_l¡_sz
=
rcv_©ms_l¡_sz
=
NULL
;

296 
	}
}

300 
	gUpd©e
::~
	$Upd©e
()

302 
d–‘e
 [] 
rcv_buff
;

303 
d–‘e
 [] 
¢d_buff
;

305 
i
=0;i<
tÙ_ncomms
;i++)

306 
d–‘e
 [] 
¢d_©ms_l¡
[
i
];

308 
d–‘e
 [] 
¢d_©ms_l¡
;

309 
d–‘e
 [] 
¢d_©ms_l¡_ıùy
;

310 
d–‘e
 [] 
¢d_©ms_l¡_sz
;

311 
d–‘e
 [] 
rcv_©ms_l¡_sz
;

313 
idim
=0;idim<
__dim__
;idim++)

314 
d–‘e
 
comm_mªag”
[
idim
];

315 
	}
}

319 
	gUpd©e
::
	$»£t
()

321 
idim
=0;idim<
__dim__
;idim++)

322 
max_cut_s
[
idim
]=
max_cut
*
d•th_šv
[idim];

324 
icurs
=0;

325 
tÙ_ncomms_
=0;

326 
idim
=0;idim<
__dim__
;idim++)

329 
s_bnd
[
idim
][0]=
s_lo
[idim]+
max_cut_s
[idim];

330 
tÙ_ncomms_
+=
¡©ic_ÿ¡
<>(
max_cut_s
[
idim
]/(
s_hi
[idim]-
s_lo
[idim]))+1;

331 
ncomms
[
idim
][0]=
tÙ_ncomms_
;

332 
icurs
++;

334 
s_bnd
[
idim
][1]=
s_hi
[idim]-
max_cut_s
[idim];

335 
tÙ_ncomms_
+=
¡©ic_ÿ¡
<>(
max_cut_s
[
idim
]/(
s_hi
[idim]-
s_lo
[idim]))+1;

336 
ncomms
[
idim
][1]=
tÙ_ncomms_
;

337 
icurs
++;

340 if(
tÙ_ncomms_
==
tÙ_ncomms
)

343 
i
=0;i<
tÙ_ncomms
;i++)

344 
d–‘e
 [] 
¢d_©ms_l¡
[
i
];

345 
d–‘e
 [] 
¢d_©ms_l¡
;

346 
d–‘e
 [] 
¢d_©ms_l¡_ıùy
;

347 
d–‘e
 [] 
¢d_©ms_l¡_sz
;

348 
d–‘e
 [] 
rcv_©ms_l¡_sz
;

350 
tÙ_ncomms
=
tÙ_ncomms_
;

351 
¢d_©ms_l¡
=
Ãw
 *[
tÙ_ncomms
];

352 
¢d_©ms_l¡_ıùy
=
Ãw
 [
tÙ_ncomms
];

353 
¢d_©ms_l¡_sz
=
Ãw
 [
tÙ_ncomms
];

354 
rcv_©ms_l¡_sz
=
Ãw
 [
tÙ_ncomms
];

355 
i
=0;i<
tÙ_ncomms
;i++)

357 
¢d_©ms_l¡_ıùy
[
i
]=0;

358 
¢d_©ms_l¡
[
i
]=
NULL
;

360 
	}
}

364 
šlše
 
	gUpd©e
::
	$add_to_¢d_l¡
(& 
icomm
,& 
Ÿtm
)

366 if(
¢d_©ms_l¡_sz
[
icomm
]+1>
¢d_©ms_l¡_ıùy
[icomm])

368 * 
tmp_l¡
=
Ãw
 [
¢d_©ms_l¡_sz
[
icomm
]+1+
¢d_©ms_l¡_grw
];

369 
	`memıy
(
tmp_l¡
,
¢d_©ms_l¡
[
icomm
],
¢d_©ms_l¡_sz
[icomm]*());

370 
d–‘e
 [] 
¢d_©ms_l¡
[
icomm
];

371 
¢d_©ms_l¡
[
icomm
]=
tmp_l¡
;

372 
¢d_©ms_l¡_ıùy
[
icomm
]=
¢d_©ms_l¡_sz
[icomm]+1+
¢d_©ms_l¡_grw
;

374 
¢d_©ms_l¡
[
icomm
][
¢d_©ms_l¡_sz
[icomm]]=
Ÿtm
;

375 
¢d_©ms_l¡_sz
[
icomm
]++;

376 
	}
}

380 
šlše
 
	gUpd©e
::
	$»£rve_rcv_buff
(
xŒa
)

382 if(
rcv_buff_ıùy
<
xŒa
+
rcv_buff_sz
)

384 
d–‘e
 [] 
rcv_buff
;

385 
rcv_buff
=
Ãw
 
by‹
[
xŒa
+
rcv_buff_sz
+
rcv_buff_grw
];

386 
rcv_buff_ıùy
=
xŒa
+
rcv_buff_sz
+
rcv_buff_grw
;

388 
	}
}

392 
šlše
 
	gUpd©e
::
	$»£rve_¢d_buff
(
xŒa
)

394 if(
¢d_buff_ıùy
<
xŒa
+
¢d_buff_sz
)

396 
d–‘e
 [] 
¢d_buff
;

397 
¢d_buff
=
Ãw
 
by‹
[
xŒa
+
¢d_buff_sz
+
¢d_buff_grw
];

398 
¢d_buff_ıùy
=
xŒa
+
¢d_buff_sz
+
¢d_buff_grw
;

400 
	}
}

404 
	gUpd©e
::
	$upd©e
(
vec
** 
updt_vecs
,
nupdt_vecs
,
boŞ
 
x_x¡
)

406 
tÙ_by‹_sz
=0;

407 
ivec
=0;ivec<
nupdt_vecs
;ivec++)

409 
updt_vecs
[
ivec
]->
vec_sz
=
Çtms_lş
;

410 
tÙ_by‹_sz
+=
updt_vecs
[
ivec
]->
by‹_sz
;

412 
¢d_buff_sz
=
rcv_buff_sz
=0;

413 
	`»£rve_¢d_buff
(
tÙ_by‹_sz
*
max_¢d_©ms_l¡_sz
);

414 
	`»£rve_rcv_buff
(
tÙ_by‹_sz
*
max_rcv_©ms_l¡_sz
);

417 
icurs
=0;

418 
icomm
=0;

419 
idim
=0;idim<
__dim__
;idim++)

421 
idœ
=0;idir<2;idir++)

423 
icomm
<
ncomms
[
idim
][
idœ
])

425 
comm_mªag”
[
idim
]->
	`upd©e_muÉ
(
icomm


426 ,
Ãigh
[
idim
][
idœ
]

427 ,
Ãigh
[
idim
][1-
idœ
]

428 ,
updt_vecs
,
nupdt_vecs
,
tÙ_by‹_sz
);

430 if(
x_x¡
 && 
pbc_cÜ»ùiÚ
[
idim
][
idœ
])

432 
ty³0
* 
__x_vec
=
x
->
	`’d
()-
__dim__
;

433 if(
idœ
)

435 
Ÿtm
=0;Ÿtm<
rcv_©ms_l¡_sz
[
icomm
];Ÿtm++,
__x_vec
-=
__dim__
)

436 
jdim
=0;jdim<
idim
+1;jdim++)

437 
__x_vec
[
jdim
]-=
H
[
idim
][jdim];

442 
Ÿtm
=0;Ÿtm<
rcv_©ms_l¡_sz
[
icomm
];Ÿtm++,
__x_vec
-=
__dim__
)

443 
jdim
=0;jdim<
idim
+1;jdim++)

444 
__x_vec
[
jdim
]+=
H
[
idim
][jdim];

447 
icomm
++;

449 
icurs
++;

452 
	}
}

456 
	gUpd©e
::
	$upd©e
(
vec
* 
updt_vec
,
boŞ
 
x_x¡
)

458 
¢d_buff_sz
=0;

459 
	`»£rve_¢d_buff
(
updt_vec
->
by‹_sz
*
max_¢d_©ms_l¡_sz
);

460 
updt_vec
->
vec_sz
=
Çtms_lş
;

462 
icurs
=0;

463 
icomm
=0;

464 
idim
=0;idim<
__dim__
;idim++)

466 
idœ
=0;idir<2;idir++)

468 
icomm
<
ncomms
[
idim
][
idœ
])

470 
comm_mªag”
[
idim
]->
	`upd©e_sšg
(
icomm


471 ,
Ãigh
[
idim
][
idœ
]

472 ,
Ãigh
[
idim
][1-
idœ
]

473 ,
updt_vec
);

475 if(
x_x¡
 && 
pbc_cÜ»ùiÚ
[
idim
][
idœ
])

477 
ty³0
* 
__x_vec
=
x
->
	`’d
()-
__dim__
;

478 if(
idœ
)

480 
Ÿtm
=0;Ÿtm<
rcv_©ms_l¡_sz
[
icomm
];Ÿtm++,
__x_vec
-=
__dim__
)

481 
jdim
=0;jdim<
idim
+1;jdim++)

482 
__x_vec
[
jdim
]-=
H
[
idim
][jdim];

487 
Ÿtm
=0;Ÿtm<
rcv_©ms_l¡_sz
[
icomm
];Ÿtm++,
__x_vec
-=
__dim__
)

488 
jdim
=0;jdim<
idim
+1;jdim++)

489 
__x_vec
[
jdim
]+=
H
[
idim
][jdim];

493 
icomm
++;

495 
icurs
++;

498 
	}
}

502 
	gUpd©e
::
upd©e
(
vec
* 
updt_vec
,
ty³0
 (*
__dH
)[
__dim__
])

505 
	g¢d_buff_sz
=0;

506 
»£rve_¢d_buff
(
updt_vec
->
by‹_sz
*
max_¢d_©ms_l¡_sz
);

507 
	gupdt_vec
->
	gvec_sz
=
Çtms_lş
;

509 
	gicurs
=0;

510 
	gicomm
=0;

511 
	gidim
=0;idim<
	g__dim__
;idim++)

513 
	gidœ
=0;idir<2;idir++)

515 
	gicomm
<
	gncomms
[
idim
][
idœ
])

517 
	gcomm_mªag”
[
idim
]->
upd©e_sšg
(
icomm


518 ,
Ãigh
[
idim
][
idœ
]

519 ,
Ãigh
[
idim
][1-
idœ
]

520 ,
updt_vec
);

522 if(
	gpbc_cÜ»ùiÚ
[
idim
][
idœ
])

525 
ty³0
* 
	g__vec
=
¡©ic_ÿ¡
<ty³0*>(
updt_vec
->
’d
())-
__dim__
;

527 if(
	gidœ
)

529 
	gŸtm
=0;Ÿtm<
	grcv_©ms_l¡_sz
[
icomm
];Ÿtm++,
	g__vec
-=
__dim__
)

530 
jdim
=0;
	gjdim
<
	gidim
+1;jdim++)

531 
	g__vec
[
jdim
]-=
__dH
[
idim
][jdim];

535 
	gŸtm
=0;Ÿtm<
	grcv_©ms_l¡_sz
[
icomm
];Ÿtm++,
	g__vec
-=
__dim__
)

536 
jdim
=0;
	gjdim
<
	gidim
+1;jdim++)

537 
	g__vec
[
jdim
]+=
__dH
[
idim
][jdim];

540 
	gicomm
++;

542 
	gicurs
++;

549 
	gUpd©e
::
	$li¡
()

551 
Çtms_ph
=0;

552 
ty³0
* 
x_vec
;

553 
x_dim
=
x
->
dim
;

554 
icurs
=0;

555 
icomm
=0;

556 
lo_©m
,
hi_©m
;

557 
Ï¡_©m
;

558 
boŞ
 
dœ
;

559 
ty³0
 
šc
;

560 
max_¢d_©ms_l¡_sz
=
max_rcv_©ms_l¡_sz
=0;

562 
idim
=0;idim<
__dim__
;idim++)

565 
Ï¡_©m
=
x
->
vec_sz
;

567 
šc
=1.0;

568 
dœ
=
Œue
;

569 
idœ
=0;idir<2;idir++)

571 
lo_©m
=0;

572 
hi_©m
=
Ï¡_©m
;

573 
icomm
<
ncomms
[
idim
][
idœ
])

575 
¢d_buff_sz
=0;

576 
rcv_©ms_l¡_sz
[
icomm
]=
¢d_©ms_l¡_sz
[icomm]=0;

577 
x_vec
=
x
->
	`begš
();

578 
Ÿtm
=
lo_©m
;Ÿtm<
hi_©m
;iatm++)

579 if((
x_vec
[
Ÿtm
*
x_dim
+
idim
]<
s_bnd
[idim][
idœ
])==
dœ
)

580 
	`add_to_¢d_l¡
(
icomm
,
Ÿtm
);

582 
comm_mªag”
[
idim
]->
	`lßd_uÆßd
(
icomm


583 ,
Ãigh
[
idim
][
idœ
]

584 ,
Ãigh
[
idim
][1-
idœ
]);

586 
lo_©m
=
x
->
vec_sz
-
rcv_©ms_l¡_sz
[
icomm
];

587 
hi_©m
=
x
->
vec_sz
;

588 if(
pbc_cÜ»ùiÚ
[
idim
][
idœ
])

590 
x_vec
=
x
->
	`begš
();

591 
Ÿtm
=
lo_©m
;Ÿtm<
hi_©m
;iatm++)

592 
x_vec
[
Ÿtm
*
x_dim
+
idim
]+=
šc
;

594 
max_¢d_©ms_l¡_sz
=
	`MAX
(max_¢d_©ms_l¡_sz,
¢d_©ms_l¡_sz
[
icomm
]);

595 
max_rcv_©ms_l¡_sz
=
	`MAX
(max_rcv_©ms_l¡_sz,
rcv_©ms_l¡_sz
[
icomm
]);

596 
icomm
++;

598 
icurs
++;

599 
šc
-=2.0;

600 
dœ
=!dir;

603 
Çtms_ph
=
x
->
vec_sz
-
Çtms_lş
;

604 
ivec
=
nxchng_vecs
;ivec<
nvecs
;ivec++)

606 
vecs
[
ivec
]->
vec_sz
=0;

607 
vecs
[
ivec
]->
	`»size
(
x
->
vec_sz
);

609 
	}
}

613 
	gUpd©e
::
	$rm_rdndncy
()

615 
¢d_buff_sz
=
rcv_buff_sz
=0;

616 
	`»£rve_rcv_buff
(
max_¢d_©ms_l¡_sz
);

617 
	`»£rve_¢d_buff
(
Çtms_ph
);

619 
by‹
* 
m¬k
=
¢d_buff
;

623 
__rcv_©ms_l¡_sz
;

624 
__¢d_©ms_l¡_sz
=0;

625 
__¢d_©ms_l¡_ıùy
=
max_¢d_©ms_l¡_sz
;

626 * 
__¢d_©ms_l¡
=
NULL
;

627 if(
__¢d_©ms_l¡_ıùy
è
__¢d_©ms_l¡
=
Ãw
 [__snd_atms_lst_cpcty];

629 
Æocomm
;

630 
by‹
* 
__m¬k
=
m¬k
+
Çtms_ph
;

631 
icurs
=2*
__dim__
-1;

632 
__icomm
=
tÙ_ncomms
-1;

633 
max_¢d_©ms_l¡_sz
=
max_rcv_©ms_l¡_sz
=0;

634 
idim
=
__dim__
-1;idim>-1;idim--)

636 
idœ
=1;idir>-1;idir--)

638 if(
icurs
!=0)

639 
Æocomm
=
ncomms
[
idim
][
idœ
];

641 
Æocomm
=0;

643 
__icomm
>
Æocomm
-1)

645 
__m¬k
-=
rcv_©ms_l¡_sz
[
__icomm
];

646 
comm_mªag”
[
idim
]->
	`xchng_buff
(

647 
Ãigh
[
idim
][1-
idœ
],
rcv_©ms_l¡_sz
[
__icomm
],
__m¬k
,

648 
Ãigh
[
idim
][
idœ
],
¢d_©ms_l¡_sz
[
__icomm
],
rcv_buff
);

650 
__¢d_©ms_l¡_sz
=0;

651 
i
=0; i<
¢d_©ms_l¡_sz
[
__icomm
];i++)

653 if(
rcv_buff
[
i
]=='1')

655 if(
¢d_©ms_l¡
[
__icomm
][
i
]>=
Çtms_lş
)

656 
m¬k
[
¢d_©ms_l¡
[
__icomm
][
i
]-
Çtms_lş
]='1';

657 
__¢d_©ms_l¡
[
__¢d_©ms_l¡_sz
++]=
¢d_©ms_l¡
[
__icomm
][
i
];

660 
	`memıy
(
¢d_©ms_l¡
[
__icomm
],
__¢d_©ms_l¡
,
__¢d_©ms_l¡_sz
*());

661 
¢d_©ms_l¡_sz
[
__icomm
]=
__¢d_©ms_l¡_sz
;

663 
__rcv_©ms_l¡_sz
=0;

664 
i
=0; i<
rcv_©ms_l¡_sz
[
__icomm
];i++)

665 if(
__m¬k
[
i
]=='1')

666 
__rcv_©ms_l¡_sz
++;

667 
rcv_©ms_l¡_sz
[
__icomm
]=
__rcv_©ms_l¡_sz
;

669 
max_¢d_©ms_l¡_sz
=
	`MAX
(max_¢d_©ms_l¡_sz,
¢d_©ms_l¡_sz
[
__icomm
]);

670 
max_rcv_©ms_l¡_sz
=
	`MAX
(max_rcv_©ms_l¡_sz,
rcv_©ms_l¡_sz
[
__icomm
]);

672 
__icomm
--;

674 
icurs
--;

678 
d–‘e
 [] 
__¢d_©ms_l¡
;

680 
Şd_2_Ãw_ıùy
=
Çtms_lş
+
Çtms_ph
;

681 * 
Şd_2_Ãw
=
NULL
;

682 if(
Şd_2_Ãw_ıùy
è
Şd_2_Ãw
=
Ãw
 [old_2_new_cpcty];

684 
li¡_sz
=0;

685 
li¡_ıùy
=
Çtms_ph
;

686 * 
li¡
=
NULL
;

687 if(
li¡_ıùy
è
li¡
=
Ãw
 [list_cpcty];

689 
Ÿtm
=0;Ÿtm<
Çtms_lş
;iatm++)

690 
Şd_2_Ãw
[
Ÿtm
]=iatm;

692 
icurs
=
Çtms_lş
;

693 
Ÿtm
=
Çtms_lş
;Ÿtm<Çtms_lş+
Çtms_ph
;iatm++)

694 if(
m¬k
[
Ÿtm
-
Çtms_lş
]=='1')

696 
Şd_2_Ãw
[
Ÿtm
]=
icurs
++;

697 
li¡
[
li¡_sz
++]=
Ÿtm
;

700 
Ãw_Çtms_ph
=
li¡_sz
;

702 
icomm
=0;icomm<
tÙ_ncomms
;icomm++)

703 
i
=0; i<
¢d_©ms_l¡_sz
[
icomm
];i++)

704 
¢d_©ms_l¡
[
icomm
][
i
]=
Şd_2_Ãw
[snd_atms_lst[icomm][i]];

708 
d–‘e
 [] 
Şd_2_Ãw
;

710 * 
__li¡
=
li¡
;

712 
vec_sz
=
Çtms_lş
;

713 *
__li¡
==
Çtms_lş
+
icurs
)

715 
__li¡
++;

716 
vec_sz
++;

717 
li¡_sz
--;

720 
ivec
=0;ivec<
nupdt_vecs
;ivec++)

722 
vecs
[
ivec
]->
vec_sz
=vec_sz;

723 
vecs
[
ivec
]->
	`ıy_p¡
(
__li¡
,
li¡_sz
);

726 
d–‘e
 [] 
li¡
;

728 
Çtms_ph
=
Ãw_Çtms_ph
;

729 
	}
}

733 
	gUpd©e
::
LßdUnLßdUpd©eComm
::

734 
	$LßdUnLßdUpd©eComm
(
Upd©e
* 
__updt
,
MPI_Comm
& 
__wÜld
):

735 
	`LßdUnLßdUpd©e
(),

736 
	`wÜld
(
__wÜld
),

737 
	`¢d_©ms_l¡
(
__updt
->
¢d_©ms_l¡
),

738 
	`¢d_©ms_l¡_sz
(
__updt
->
¢d_©ms_l¡_sz
),

739 
	`rcv_©ms_l¡_sz
(
__updt
->
rcv_©ms_l¡_sz
),

740 
	`¢d_buff
(
__updt
->
¢d_buff
),

741 
	`¢d_buff_sz
(
__updt
->
¢d_buff_sz
),

742 
	`¢d_buff_ıùy
(
__updt
->
¢d_buff_ıùy
),

743 
	`rcv_buff
(
__updt
->
rcv_buff
),

744 
	`rcv_buff_sz
(
__updt
->
rcv_buff_sz
),

745 
	`rcv_buff_ıùy
(
__updt
->
rcv_buff_ıùy
),

746 
	`vecs
(
__updt
->
vecs
),

747 
	`nupdt_vecs
(
__updt
->
nupdt_vecs
),

748 
	`tÙ_updt_vecs_sz
(
__updt
->
tÙ_updt_vecs_sz
)

750 
	}
}

754 
šlše
 
	gUpd©e
::
LßdUnLßdUpd©eComm
::
lßd_uÆßd


755 (& 
__icomm
,& 
	g__¢d_p
,& 
	g__rcv_p
)

757 
	g¢d_buff_sz
=
¢d_©ms_l¡_sz
[
__icomm
]*
tÙ_updt_vecs_sz
;

758 if(
	g¢d_buff_ıùy
<
	g¢d_buff_sz
)

760 
	gd–‘e
 [] 
	g¢d_buff
;

761 
	g¢d_buff
=
Ãw
 
by‹
[
¢d_buff_sz
+
¢d_buff_grw
];

762 
	g¢d_buff_ıùy
=
¢d_buff_sz
+
¢d_buff_grw
;

765 
by‹
* 
	gtmp_¢d_buff
=
¢d_buff
;

766 
	givec
=0;ivec<
	gnupdt_vecs
;ivec++)

767 
	gvecs
[
ivec
]->
ıy
(
tmp_¢d_buff
,
¢d_©ms_l¡
[
__icomm
],
¢d_©ms_l¡_sz
[__icomm]);

769 
MPI_S’d»cv
(&
¢d_©ms_l¡_sz
[
__icomm
],1,
MPI_INT
,
__¢d_p
,0,

770 &
rcv_©ms_l¡_sz
[
__icomm
],1,
MPI_INT
,
__rcv_p
,0,

771 
wÜld
,
MPI_STATUS_IGNORE
);

773 
	grcv_buff_sz
=
rcv_©ms_l¡_sz
[
__icomm
]*
tÙ_updt_vecs_sz
;

774 if(
	grcv_buff_ıùy
<
	grcv_buff_sz
)

776 
	gd–‘e
 [] 
	grcv_buff
;

777 
	grcv_buff
=
Ãw
 
by‹
[
rcv_buff_sz
+
rcv_buff_grw
];

778 
	grcv_buff_ıùy
=
rcv_©ms_l¡_sz
[
__icomm
]*
tÙ_updt_vecs_sz
+
rcv_buff_grw
;

781 
MPI_S’d»cv
(
¢d_buff
,
¢d_buff_sz
,
MPI_BYTE
,
__¢d_p
,0,

782 
rcv_buff
,
rcv_buff_sz
,
MPI_BYTE
,
__rcv_p
,0,

783 
wÜld
,
MPI_STATUS_IGNORE
);

786 
by‹
* 
	gtmp_rcv_buff
=
rcv_buff
;

787 
	givec
=0;ivec<
	gnupdt_vecs
;ivec++)

789 
	gvecs
[
ivec
]->
»£rve
(
rcv_©ms_l¡_sz
[
__icomm
]);

790 
	gvecs
[
ivec
]->
p¡
(
tmp_rcv_buff
,
rcv_©ms_l¡_sz
[
__icomm
]);

796 
šlše
 
	gUpd©e
::
LßdUnLßdUpd©eComm
::
upd©e_muÉ


797 (& 
__icomm
,& 
	g__¢d_p
,& 
	g__rcv_p
,
	gvec
**& 
	g__vecs


798 ,& 
	g__nvecs
,& 
	g__vecs_by‹_sz
)

800 
by‹
* 
	gtmp_¢d_buff
=
¢d_buff
;

801 
	givec
=0;ivec<
	g__nvecs
;ivec++)

802 
	g__vecs
[
ivec
]->
ıy
(
tmp_¢d_buff
,
¢d_©ms_l¡
[
__icomm
],
¢d_©ms_l¡_sz
[__icomm]);

804 
MPI_S’d»cv
(
¢d_buff
,
¢d_©ms_l¡_sz
[
__icomm
]*
__vecs_by‹_sz
,
MPI_BYTE
,
__¢d_p
,0,

805 
rcv_buff
,
rcv_©ms_l¡_sz
[
__icomm
]*
__vecs_by‹_sz
,
MPI_BYTE
,
__rcv_p
,0,

806 
wÜld
,
MPI_STATUS_IGNORE
);

808 
by‹
* 
	gtmp_rcv_buff
=
rcv_buff
;

809 
	givec
=0;ivec<
	g__nvecs
;ivec++)

810 
	g__vecs
[
ivec
]->
p¡
(
tmp_rcv_buff
,
rcv_©ms_l¡_sz
[
__icomm
]);

815 
šlše
 
	gUpd©e
::
LßdUnLßdUpd©eComm
::
upd©e_sšg


816 (& 
__icomm
,& 
	g__¢d_p
,& 
	g__rcv_p
,
	gvec
*& 
	g__v
)

818 
by‹
* 
	gtmp_¢d_buff
=
¢d_buff
;

819 
	g__v
->
ıy
(
tmp_¢d_buff
,
¢d_©ms_l¡
[
__icomm
],
¢d_©ms_l¡_sz
[__icomm]);

821 
MPI_S’d»cv
(
¢d_buff
,
¢d_©ms_l¡_sz
[
__icomm
]*
__v
->
by‹_sz
,
MPI_BYTE
,
__¢d_p
,0,

822 
__v
->
’d
(),
rcv_©ms_l¡_sz
[
__icomm
]*__v->
by‹_sz
,
MPI_BYTE
,
__rcv_p
,0,

823 
wÜld
,
MPI_STATUS_IGNORE
);

824 
	g__v
->
	gvec_sz
+=
rcv_©ms_l¡_sz
[
__icomm
];

829 
šlše
 
	gUpd©e
::
LßdUnLßdUpd©eComm
::
xchng_buff


830 (& 
__¢d_p
,& 
	g__¢d_buff_sz
,
	gby‹
*& 
	g__¢d_buff


831 ,& 
	g__rcv_p
,& 
	g__rcv_buff_sz
,
	gby‹
*& 
	g__rcv_buff
)

833 
MPI_S’d»cv
(
__¢d_buff
,
__¢d_buff_sz
,
MPI_BYTE
,
__¢d_p
,0,

834 
__rcv_buff
,
__rcv_buff_sz
,
MPI_BYTE
,
__rcv_p
,0,

835 
wÜld
,
MPI_STATUS_IGNORE
);

840 
	gUpd©e
::
LßdUnLßdUpd©eS–fComm
::

841 
	$LßdUnLßdUpd©eS–fComm
(
Upd©e
* 
__updt
):

842 
	`LßdUnLßdUpd©e
(),

843 
	`¢d_©ms_l¡
(
__updt
->
¢d_©ms_l¡
),

844 
	`¢d_©ms_l¡_sz
(
__updt
->
¢d_©ms_l¡_sz
),

845 
	`rcv_©ms_l¡_sz
(
__updt
->
rcv_©ms_l¡_sz
),

846 
	`vecs
(
__updt
->
vecs
),

847 
	`nupdt_vecs
(
__updt
->
nupdt_vecs
)

849 
	}
}

853 
šlše
 
	gUpd©e
::
LßdUnLßdUpd©eS–fComm
::
lßd_uÆßd


854 (& 
__icomm
,&,&)

856 
	grcv_©ms_l¡_sz
[
__icomm
]=
¢d_©ms_l¡_sz
[__icomm];

858 
	givec
=0;ivec<
	gnupdt_vecs
;ivec++)

860 
	gvecs
[
ivec
]->
»£rve
(
rcv_©ms_l¡_sz
[
__icomm
]);

861 
	gvecs
[
ivec
]->
ıy_p¡
(
¢d_©ms_l¡
[
__icomm
],
rcv_©ms_l¡_sz
[__icomm]);

867 
šlše
 
	gUpd©e
::
LßdUnLßdUpd©eS–fComm
::
upd©e_muÉ


868 (& 
__icomm
,&,&,
	gvec
**& 
	gvecs


869 ,& 
	gnvecs
,&)

871 
	givec
=0;ivec<
	gnvecs
;ivec++)

872 
	gvecs
[
ivec
]->
ıy_p¡
(
¢d_©ms_l¡
[
__icomm
],
¢d_©ms_l¡_sz
[__icomm]);

877 
šlše
 
	gUpd©e
::
LßdUnLßdUpd©eS–fComm
::
upd©e_sšg


878 (& 
__icomm
,&,&,
	gvec
*& 
	gv
)

880 
	gv
->
ıy_p¡
(
¢d_©ms_l¡
[
__icomm
],
¢d_©ms_l¡_sz
[__icomm]);

885 
šlše
 
	gUpd©e
::
LßdUnLßdUpd©eS–fComm
::
xchng_buff


886 (&,& 
	g__¢d_buff_sz
,
	gby‹
*& 
	g__¢d_buff


887 ,&,& 
	g__rcv_buff_sz
,
	gby‹
*& 
	g__rcv_buff
)

889 
memıy
(
__rcv_buff
,
__¢d_buff
,
__rcv_buff_sz
);

	@exchange.h

1 #iâdeà
__MAPP__exchªge__


2 
	#__MAPP__exchªge__


	)

3 
	~"glob®.h
"

4 
	~<mpi.h
>

5 #ifdeà
OLD_UPDATE


14 
Çme¥aû
 
	gMAPP_NS


16 
	g‹m¶©e
<
	gty³Çme
> 
şass
 
	gVec
;

17 
şass
 
	gvec
;

18 şas 
	cExchªge


20 
	g´iv©e
:

23 & 
Çtms_lş
;

24 
	gVec
<
	gty³0
>*& 
	gx
;

25 & 
	gxchng_id
;

28 cÚ¡ 
	g¿nk
;

29 
	gÃigh
[
__dim__
][2];

30 
ty³0
 (&
s_lo
)[
__dim__
];

31 
ty³0
 (&
s_hi
)[
__dim__
];

34 
cÚ¡ex´
 
	gbuff_grw
=1024;

35 
by‹
* 
	g¢d_buff
[2];

36 
	g¢d_buff_sz
[2];

37 
	g¢d_buff_ıùy
[2];

39 
by‹
* 
	grcv_buff
;

40 
	grcv_buff_sz
;

41 
	grcv_buff_ıùy
;

43 
lßd
(&,);

44 
lßd
(
by‹
*&,&);

45 
xchng_buff
(,);

47 
	gvec
**& 
	gvecs
;

48 & 
	gnvecs
;

49 & 
	gnxchng_vecs
;

50 
	gtÙ_xchng_sz
;

52 
	gMPI_Comm
& 
	gwÜld
;

53 
	g´Ùeùed
:

54 
public
:

55 
Exchªge
(
şass
 
Atoms
*,&);

56 ~
Exchªge
();

57 
fuÎ_xchng
();

58 
fuÎ_xchng_®l
();

61 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

70 
Çme¥aû
 
	gMAPP_NS


73 şas 
	cUpd©e


75 
	g´iv©e
:

77 & 
Çtms_lş
;

78 & 
	gÇtms_ph
;

81 
ty³0
 (&
H
)[
__dim__
][__dim__];

82 
ty³0
 (&
d•th_šv
)[
__dim__
];

83 
ty³0
 (&
s_lo
)[
__dim__
];

84 
ty³0
 (&
s_hi
)[
__dim__
];

85 cÚ¡ 
	gty³0
& 
	gmax_cut
;

87 
ty³0
 
	gmax_cut_s
[
__dim__
];

88 cÚ¡ 
	g¿nk
;

89 
	gÃigh
[
__dim__
][2];

91 
	gVec
<
	gty³0
>*& 
	gx
;

93 
	gvec
**& 
	gvecs
;

94 & 
	gnvecs
;

95 & 
	gnxchng_vecs
;

96 & 
	gnupdt_vecs
;

97 
	gtÙ_updt_vecs_sz
;

99 
	gtÙ_ncomms
;

100 
	gncomms
[
__dim__
][2];

101 
boŞ
 
	gpbc_cÜ»ùiÚ
[
__dim__
][2];

102 
ty³0
 
	gs_bnd
[
__dim__
][2];

104 ** 
	g¢d_©ms_l¡
;

105 * 
	g¢d_©ms_l¡_sz
;

106 * 
	g¢d_©ms_l¡_ıùy
;

107 
	gmax_¢d_©ms_l¡_sz
;

108 
cÚ¡ex´
 
	g¢d_©ms_l¡_grw
=8;

110 * 
	grcv_©ms_l¡_sz
;

111 
	gmax_rcv_©ms_l¡_sz
;

113 
by‹
* 
	g¢d_buff
;

114 
	g¢d_buff_sz
;

115 
	g¢d_buff_ıùy
;

116 
cÚ¡ex´
 
	g¢d_buff_grw
=1024;

118 
by‹
* 
	grcv_buff
;

119 
	grcv_buff_sz
;

120 
	grcv_buff_ıùy
;

121 
cÚ¡ex´
 
	grcv_buff_grw
=1024;

123 
add_to_¢d_l¡
(&,&);

124 
»£rve_¢d_buff
();

125 
»£rve_rcv_buff
();

127 
şass
 
	gLßdUnLßdUpd©e
;

128 
şass
 
	gLßdUnLßdUpd©eComm
;

129 
şass
 
	gLßdUnLßdUpd©eS–fComm
;

130 
LßdUnLßdUpd©e
* 
	gcomm_mªag”
[
__dim__
];

132 
	g´Ùeùed
:

133 
public
:

134 
Upd©e
(
Atoms
*,&,&);

135 ~
Upd©e
();

136 
»£t
();

137 
upd©e
(
vec
*,
boŞ
);

138 
upd©e
(
vec
*,
ty³0
 (*)[
__dim__
]);

139 
upd©e
(
vec
**,,
boŞ
);

140 
li¡
();

141 
rm_rdndncy
();

147 
Çme¥aû
 
	gMAPP_NS


149 şas 
	cUpd©e
::
LßdUnLßdUpd©e


151 
´iv©e
:

152 
´Ùeùed
:

153 
public
:

154 
LßdUnLßdUpd©e
(){};

155 
	gvœtu®
 ~
LßdUnLßdUpd©e
(){};

156 
vœtu®
 
lßd_uÆßd
(&,&,&)=0;

157 
vœtu®
 
upd©e_muÉ
(&,&,&,
vec
**&,&,&)=0;

158 
vœtu®
 
upd©e_sšg
(&,&,&,
vec
*&)=0;

159 
vœtu®
 
xchng_buff
(&,&,
by‹
*&,&,&,byte*&)=0;

165 
Çme¥aû
 
	gMAPP_NS


167 şas 
	cUpd©e
::
LßdUnLßdUpd©eComm
:

168 
public
 
Upd©e
::
LßdUnLßdUpd©e


170 
´iv©e
:

172 **& 
¢d_©ms_l¡
;

173 *& 
	g¢d_©ms_l¡_sz
;

175 *& 
	grcv_©ms_l¡_sz
;

177 
	gvec
**& 
	gvecs
;

178 & 
	gnupdt_vecs
;

179 & 
	gtÙ_updt_vecs_sz
;

180 
	gMPI_Comm
& 
	gwÜld
;

182 
	gby‹
*& 
	g¢d_buff
;

183 & 
	g¢d_buff_sz
;

184 & 
	g¢d_buff_ıùy
;

186 
	gby‹
*& 
	grcv_buff
;

187 & 
	grcv_buff_sz
;

188 & 
	grcv_buff_ıùy
;

192 
	g´Ùeùed
:

193 
public
:

194 
LßdUnLßdUpd©eComm
(
Upd©e
*,
MPI_Comm
&);

195 
lßd_uÆßd
(&,&,&);

196 
upd©e_muÉ
(&,&,&,
vec
**&,&,&);

197 
upd©e_sšg
(&,&,&,
vec
*&);

198 
xchng_buff
(&,&,
by‹
*&,&,&,byte*&);

204 
Çme¥aû
 
	gMAPP_NS


206 şas 
	cUpd©e
::
LßdUnLßdUpd©eS–fComm
:

207 
public
 
Upd©e
::
LßdUnLßdUpd©e


209 
´iv©e
:

210 **& 
¢d_©ms_l¡
;

211 *& 
	g¢d_©ms_l¡_sz
;

213 *& 
	grcv_©ms_l¡_sz
;

215 
	gvec
**& 
	gvecs
;

216 & 
	gnupdt_vecs
;

217 
	g´Ùeùed
:

218 
public
:

219 
LßdUnLßdUpd©eS–fComm
(
Upd©e
*);

220 
lßd_uÆßd
(&,&,&);

221 
upd©e_muÉ
(&,&,&,
vec
**&,&,&);

222 
upd©e_sšg
(&,&,&,
vec
*&);

223 
xchng_buff
(&,&,
by‹
*&,&,&,byte*&);

235 
	~"©oms.h
"

236 
	~"xm©h.h
"

237 
Çme¥aû
 
	gMAPP_NS


239 
	g‹m¶©e
<
	gty³Çme
> 
şass
 
	gVec
;

240 
şass
 
	gvec
;

241 şas 
	cExchªge


243 
	g´iv©e
:

246 & 
Çtms_lş
;

247 
	gVec
<
	gty³0
>*& 
	gx
;

248 & 
	gxchng_id
;

251 cÚ¡ 
	g¿nk
;

252 
	gÃigh
[
__dim__
][2];

253 
ty³0
 (&
s_lo
)[
__dim__
];

254 
ty³0
 (&
s_hi
)[
__dim__
];

257 
cÚ¡ex´
 
	gbuff_grw
=1024;

258 
by‹
* 
	g¢d_buff
[2];

259 
	g¢d_buff_sz
[2];

260 
	g¢d_buff_ıùy
[2];

262 
by‹
* 
	grcv_buff
;

263 
	grcv_buff_sz
;

264 
	grcv_buff_ıùy
;

266 
	gvec
**& 
	gvecs
;

267 & 
	gnvecs
;

268 & 
	gnxchng_vecs
;

269 
	gtÙ_xchng_sz
;

271 
	gMPI_Comm
& 
	gwÜld
;

274 
	g‹m¶©e
<
	gidœ
>

275 
lßd
(& 
Ÿtm
)

277 if(
	g¢d_buff_ıùy
[
idœ
]<
	g¢d_buff_sz
[idœ]+
	gtÙ_xchng_sz
)

279 
by‹
* 
	gtmp_buff
=
Ãw
 by‹[
¢d_buff_sz
[
idœ
]+
tÙ_xchng_sz
+
buff_grw
];

280 
memıy
(
tmp_buff
,
¢d_buff
[
idœ
],
¢d_buff_sz
[idir]);

281 
	gd–‘e
 [] 
	g¢d_buff
[
idœ
];

282 
	g¢d_buff
[
idœ
]=
tmp_buff
;

283 
	g¢d_buff_ıùy
[
idœ
]=
¢d_buff_sz
[idœ]+
tÙ_xchng_sz
+
buff_grw
;

285 
by‹
* 
	gtmp_buff
=&
¢d_buff
[
idœ
][
¢d_buff_sz
[idir]];

287 
	givec
=0;ivec<
	gnxchng_vecs
;ivec++)

288 
	gvecs
[
ivec
]->
pİ_out
(
tmp_buff
,
Ÿtm
);

290 
	g¢d_buff_sz
[
idœ
]+=
tÙ_xchng_sz
;

292 
	g‹m¶©e
<
	gidœ
>

293 
lßd
(
by‹
*& 
buff
)

295 if(
	g¢d_buff_ıùy
[
idœ
]<
	g¢d_buff_sz
[idœ]+
	gtÙ_xchng_sz
)

297 
by‹
* 
	gtmp_buff
=
Ãw
 by‹[
¢d_buff_sz
[
idœ
]+
tÙ_xchng_sz
+
buff_grw
];

298 
memıy
(
tmp_buff
,
¢d_buff
[
idœ
],
¢d_buff_sz
[idir]);

299 
	gd–‘e
 [] 
	g¢d_buff
[
idœ
];

300 
	g¢d_buff
[
idœ
]=
tmp_buff
;

301 
	g¢d_buff_ıùy
[
idœ
]=
¢d_buff_sz
[idœ]+
tÙ_xchng_sz
+
buff_grw
;

303 
memıy
(&
¢d_buff
[
idœ
][
¢d_buff_sz
[idœ]],
buff
,
tÙ_xchng_sz
);

304 
	g¢d_buff_sz
[
idœ
]+=
tÙ_xchng_sz
;

305 
	gbuff
+=
tÙ_xchng_sz
;

312 
	g‹m¶©e
<
	gidim
,
	gidœ
>

313 
xchng_buff
()

315 
	gmax_¢d_sz
=1;

316 
	gnxchngs
=0;

317 
	gmax_¢d_sz
!=0)

319 
rcv_buff_sz
=0;

320 
MPI_AÎ»duû
(&
¢d_buff_sz
[
idœ
],&
max_¢d_sz
,1,
MPI_INT
,
MPI_MAX
,
wÜld
);

321 if(
	gmax_¢d_sz
==0)

324 
MPI_S’d»cv
(&
¢d_buff_sz
[
idœ
],1,
MPI_INT
,
Ãigh
[
idim
][idir],0,

325 &
rcv_buff_sz
,1,
MPI_INT
,
Ãigh
[
idim
][1-
idœ
],0,

326 
wÜld
,
MPI_STATUS_IGNORE
);

328 if(
	grcv_buff_ıùy
<
	grcv_buff_sz
)

330 
	gd–‘e
 [] 
	grcv_buff
;

331 
	grcv_buff
=
Ãw
 
by‹
[
rcv_buff_sz
+
buff_grw
];

332 
	grcv_buff_ıùy
=
rcv_buff_sz
+
buff_grw
;

335 
MPI_S’d»cv
(
¢d_buff
[
idœ
],
¢d_buff_sz
[idœ],
MPI_BYTE
,
Ãigh
[
idim
][idir],0,

336 
rcv_buff
,
rcv_buff_sz
,
MPI_BYTE
,
Ãigh
[
idim
][1-
idœ
],0,

337 
wÜld
,
MPI_STATUS_IGNORE
);

339 
	gnxchngs
++;

340 
	g¢d_buff_sz
[
idœ
]=0;

347 
	givec
=0;ivec<
	gnxchng_vecs
;ivec++)

348 
	gvecs
[
ivec
]->
»£rve
(
rcv_buff_sz
/
tÙ_xchng_sz
);

352 
ty³0
 
	gs
;

353 
by‹
* 
	gbuff_tmp
=
rcv_buff
;

354 
	grcv_buff_sz
)

356 
	gs
=
»š‹½»t_ÿ¡
<
ty³0
*>(
buff_tmp
)[
idim
];

357 if(
	gs_lo
[
idim
]<=
s
 && s<
s_hi
[idim])

358 
ivec
=0;
	givec
<
	gnxchng_vecs
;ivec++)

359 
	gvecs
[
ivec
]->
pİ_š
(
buff_tmp
);

361 
	glßd
<
	gidœ
>(
	gbuff_tmp
);

363 
	grcv_buff_sz
-=
tÙ_xchng_sz
;

366  
	gnxchngs
;

369 
	g‹m¶©e
<
	gidim
>

370 
lßd_up
()

372 if(
	g¿nk
==
Ãigh
[
idim
][0] && 
¿nk
==neigh[idim][1])

373  
lßd_up
<
idim
+1>();

375 
	g¢d_buff_sz
[0]=
¢d_buff_sz
[1]=0;

376 
	gŸtm
=0;

377 
ty³0
 
	gs
;

378 
ty³0
* 
	gs_±r
=
x
->
begš
()+
idim
;

379 
	gn
=
x
->
vec_sz
;

380 
	gŸtm
<
	gn
)

382 
	gs
=*
s_±r
;

383 if(
	gs
>=
s_hi
[
idim
])

388 if(
s
-
s_hi
[
idim
]<1.0+
s_lo
[idim]-s)

389 
lßd
<
¢d_to_äÁ
>(
Ÿtm
);

391 
	glßd
<
	g¢d_to_bhnd
>(
	gŸtm
);

392 
	gn
--;

394 if(
	gs
<
	gs_lo
[
idim
])

399 if(1.0+
	gs
-
	gs_hi
[
idim
]<
	gs_lo
[idim]-s)

400 
	glßd
<
	g¢d_to_äÁ
>(
	gŸtm
);

402 
	glßd
<
	g¢d_to_bhnd
>(
	gŸtm
);

403 
	gn
--;

407 
	gŸtm
++;

408 
	gs_±r
+=
__dim__
;

413  
	gxchng_buff
<
	gidim
,0>()+xchng_buff<idim,1>()

414 +
	glßd_up
<
	gidim
+1>();

418 
	g´Ùeùed
:

419 
public
:

420 
Exchªge
(
Atoms
* 
©oms
,& 
__nxchng_vecs
):

421 
Çtms_lş
(
©oms
->natms_lcl),

422 
x
(
©oms
->x),

423 
wÜld
(
©oms
->
comm
.world),

424 
¿nk
(
©oms
->
comm
.rank),

425 
s_lo
(
©oms
->
comm
.s_lo),

426 
s_hi
(
©oms
->
comm
.s_hi),

427 
xchng_id
(
©oms
->
comm
.xchng_id),

429 
vecs
(
©oms
->
dyÇmic_vecs
),

430 
nvecs
(
©oms
->
ndyÇmic_vecs
),

431 
nxchng_vecs
(
__nxchng_vecs
)

433 
	gAlgeb¿
::
V_eq
<
__dim__
*2>(&(
©oms
->
comm
.
Ãigh
[0][0]), &(
	gÃigh
[0][0]));

434 
	g¢d_buff
[0]=
¢d_buff
[1]=
NULL
;

435 
	g¢d_buff_sz
[0]=
¢d_buff_sz
[1]=0;

436 
	g¢d_buff_ıùy
[0]=
¢d_buff_ıùy
[1]=0;

438 
	grcv_buff
=
NULL
;

439 
	grcv_buff_sz
=0;

440 
	grcv_buff_ıùy
=0;

442 
	gtÙ_xchng_sz
=0;

443 
	givec
=0;ivec<
	gnxchng_vecs
;ivec++)

444 
	gtÙ_xchng_sz
+=
vecs
[
ivec
]->
by‹_sz
;

447 ~
Exchªge
()

449 
	gd–‘e
 [] 
	g¢d_buff
[0];

450 
	gd–‘e
 [] 
	g¢d_buff
[1];

451 
	gd–‘e
 [] 
	grcv_buff
;

453 
fuÎ_xchng_¡©ic
()

455 
	givec
=0;ivec<
	gnxchng_vecs
;ivec++)

456 
	gvecs
[
ivec
]->
»size
(
Çtms_lş
);

458 
fuÎ_xchng
()

460 
	givec
=0;ivec<
	gnxchng_vecs
;ivec++)

461 
	gvecs
[
ivec
]->
»size
(
Çtms_lş
);

462 if(
	glßd_up
<0>()è
	gxchng_id
++;

463 
	gÇtms_lş
=
x
->
vec_sz
;

468 
	g‹m¶©e
<>

469 
šlše
 
	gExchªge
::
lßd_up
<
__dim__
>(){ 0;}

479 
Çme¥aû
 
	gMAPP_NS


482 şas 
	cUpd©e


484 
	g´iv©e
:

486 
MPI_Comm
& 
wÜld
;

487 & 
	gÇtms_lş
;

488 & 
	gÇtms_ph
;

491 
ty³0
 (&
H
)[
__dim__
][__dim__];

492 
ty³0
 (&
d•th_šv
)[
__dim__
];

493 
ty³0
 (&
s_lo
)[
__dim__
];

494 
ty³0
 (&
s_hi
)[
__dim__
];

495 cÚ¡ 
	gty³0
& 
	gmax_cut
;

497 
ty³0
 
	gmax_cut_s
[
__dim__
];

498 cÚ¡ 
	g¿nk
;

499 
	gÃigh
[
__dim__
][2];

501 
	gVec
<
	gty³0
>*& 
	gx
;

503 
	gvec
**& 
	gvecs
;

504 & 
	gnvecs
;

505 & 
	gnxchng_vecs
;

506 & 
	gnupdt_vecs
;

507 
	gtÙ_updt_vecs_sz
;

509 
	gtÙ_ncomms
;

510 
	gncomms
[
__dim__
][2];

511 
boŞ
 
	gpbc_cÜ»ùiÚ
[
__dim__
][2];

512 
boŞ
 
	g£lf_comm
[
__dim__
];

513 
ty³0
 
	gs_bnd
[
__dim__
][2];

515 ** 
	g¢d_©ms_l¡
[
__dim__
][2];

516 * 
	g¢d_©ms_l¡_sz
[
__dim__
][2];

517 * 
	g¢d_©ms_l¡_ıùy
[
__dim__
][2];

518 
	gmax_¢d_©ms_l¡_sz
;

519 
cÚ¡ex´
 
	g¢d_©ms_l¡_grw
=8;

521 * 
	grcv_©ms_l¡_sz
[
__dim__
][2];

522 
	gmax_rcv_©ms_l¡_sz
;

524 
by‹
* 
	g¢d_buff
;

525 
	g¢d_buff_sz
;

526 
	g¢d_buff_ıùy
;

527 
cÚ¡ex´
 
	g¢d_buff_grw
=1024;

529 
by‹
* 
	grcv_buff
;

530 
	grcv_buff_sz
;

531 
	grcv_buff_ıùy
;

532 
cÚ¡ex´
 
	grcv_buff_grw
=1024;

535 
	g‹m¶©e
<
	gidim
>

536 
¡¬t
((*
__Ãigh
)[2],* 
__dims
,* 
__coÜds
)

538 
	g£lf_comm
[
idim
]=(
¿nk
==(*
__Ãigh
)[0] &&„ank==(*__neigh)[1]);

541 
	gpbc_cÜ»ùiÚ
[
idim
][0]=(*
__coÜds
==*
__dims
-1);

542 
	gÃigh
[
idim
][0]=(*
__Ãigh
)[0];

543 
	gncomms
[
idim
][0]=0;

544 
	g¢d_©ms_l¡
[
idim
][0]=
NULL
;

545 
	g¢d_©ms_l¡_sz
[
idim
][0]=
NULL
;

546 
	g¢d_©ms_l¡_ıùy
[
idim
][0]=
NULL
;

547 
	grcv_©ms_l¡_sz
[
idim
][0]=
NULL
;

550 
	gpbc_cÜ»ùiÚ
[
idim
][1]=(*
__coÜds
==0);

551 
	gncomms
[
idim
][1]=0;

552 
	gÃigh
[
idim
][1]=(*
__Ãigh
)[1];

553 
	g¢d_©ms_l¡
[
idim
][1]=
NULL
;

554 
	g¢d_©ms_l¡_sz
[
idim
][1]=
NULL
;

555 
	g¢d_©ms_l¡_ıùy
[
idim
][1]=
NULL
;

556 
	grcv_©ms_l¡_sz
[
idim
][1]=
NULL
;

558 
	g¡¬t
<
	gidim
+1>(
	g__Ãigh
+1,
	g__dims
+1,
	g__coÜds
+1);

561 
	g‹m¶©e
<
	gidim
,
	gidœ
>

562 
d—Îoc
()

564 
	gicomm
=0;icomm<
	gncomms
[
idim
][
idœ
];icomm++)

565 
	gd–‘e
 [] 
	g¢d_©ms_l¡
[
idim
][
idœ
][
icomm
];

566 
	gd–‘e
 [] 
	g¢d_©ms_l¡
[
idim
][
idœ
];

567 
	gd–‘e
 [] 
	g¢d_©ms_l¡_sz
[
idim
][
idœ
];

568 
	gd–‘e
 [] 
	g¢d_©ms_l¡_ıùy
[
idim
][
idœ
];

569 
	gd–‘e
 [] 
	grcv_©ms_l¡_sz
[
idim
][
idœ
];

571 
	g‹m¶©e
<
	gidim
,
	gidœ
>

572 
d—Îoc_®l
()

574 
	gd—Îoc
<
	gidim
,
	gidœ
>();

575 
	gd—Îoc_®l
<
	gidim
+
	gidœ
,1-idir>();

579 
	g‹m¶©e
<
	gidim
,
	gidœ
>

580 
»®loc
(
__ncomms
)

582 
	g¢d_©ms_l¡
[
idim
][
idœ
]=
Ãw
 *[
__ncomms
];

583 
	g¢d_©ms_l¡_sz
[
idim
][
idœ
]=
Ãw
 [
__ncomms
];

584 
	g¢d_©ms_l¡_ıùy
[
idim
][
idœ
]=
Ãw
 [
__ncomms
];

585 
	grcv_©ms_l¡_sz
[
idim
][
idœ
]=
Ãw
 [
__ncomms
];

586 
	gicomm
=0;icomm<
	g__ncomms
;icomm++)

588 
	g¢d_©ms_l¡
[
idim
][
idœ
][
icomm
]=
NULL
;

589 
	g¢d_©ms_l¡_ıùy
[
idim
][
idœ
][
icomm
]=0;

591 
	gncomms
[
idim
][
idœ
]=
__ncomms
;

593 
	g‹m¶©e
<
	gidim
>

594 
__»£t
(& 
__tÙ_ncomms
)

596 
	gmax_cut_s
[
idim
]=
max_cut
*
d•th_šv
[idim];

598 
	g__ncomms
;

600 
	gs_bnd
[
idim
][0]=
s_lo
[idim]+
max_cut_s
[idim];

601 
	g__ncomms
=
¡©ic_ÿ¡
<>(
max_cut_s
[
idim
]/(
s_hi
[idim]-
s_lo
[idim]))+1;

602 
	g__tÙ_ncomms
+=
__ncomms
;

603 if(
	g__ncomms
!=
ncomms
[
idim
][0])

605 
d—Îoc
<
idim
,0>();

606 
	g»®loc
<
	gidim
,0>(
	g__ncomms
);

609 
	gs_bnd
[
idim
][1]=
s_hi
[idim]-
max_cut_s
[idim];

610 
	g__ncomms
=
¡©ic_ÿ¡
<>(
max_cut_s
[
idim
]/(
s_hi
[idim]-
s_lo
[idim]))+1;

611 
	g__tÙ_ncomms
+=
__ncomms
;

612 if(
	g__ncomms
!=
ncomms
[
idim
][1])

614 
d—Îoc
<
idim
,1>();

615 
	g»®loc
<
	gidim
,1>(
	g__ncomms
);

617 
	g__»£t
<
	gidim
+1>(
	g__tÙ_ncomms
);

621 
»£rve_rcv_buff
(
xŒa
)

623 if(
	grcv_buff_ıùy
<
	gxŒa
+
	grcv_buff_sz
)

625 
	gd–‘e
 [] 
	grcv_buff
;

626 
	grcv_buff
=
Ãw
 
by‹
[
xŒa
+
rcv_buff_sz
+
rcv_buff_grw
];

627 
	grcv_buff_ıùy
=
xŒa
+
rcv_buff_sz
+
rcv_buff_grw
;

630 
»£rve_¢d_buff
(
xŒa
)

632 if(
	g¢d_buff_ıùy
<
	gxŒa
+
	g¢d_buff_sz
)

634 
	gd–‘e
 [] 
	g¢d_buff
;

635 
	g¢d_buff
=
Ãw
 
by‹
[
xŒa
+
¢d_buff_sz
+
¢d_buff_grw
];

636 
	g¢d_buff_ıùy
=
xŒa
+
¢d_buff_sz
+
¢d_buff_grw
;

640 
	g‹m¶©e
<
	gidim
,
	gidœ
>

641 
add_to_¢d_l¡
(& 
__icomm
,& 
Ÿtm
)

643 if(
	g¢d_©ms_l¡_sz
[
idim
][
idœ
][
__icomm
]+1>
	g¢d_©ms_l¡_ıùy
[idim][idir][__icomm])

645 * 
	gtmp_l¡
=
Ãw
 [
¢d_©ms_l¡_sz
[
idim
][
idœ
][
__icomm
]+1+
¢d_©ms_l¡_grw
];

646 
memıy
(
tmp_l¡
,
¢d_©ms_l¡
[
idim
][
idœ
][
__icomm
],
¢d_©ms_l¡_sz
[idim][idir][__icomm]*());

647 
	gd–‘e
 [] 
	g¢d_©ms_l¡
[
idim
][
idœ
][
__icomm
];

648 
	g¢d_©ms_l¡
[
idim
][
idœ
][
__icomm
]=
tmp_l¡
;

649 
	g¢d_©ms_l¡_ıùy
[
idim
][
idœ
][
__icomm
]=
¢d_©ms_l¡_sz
[idim][idœ][__icomm]+1+
¢d_©ms_l¡_grw
;

651 
	g¢d_©ms_l¡
[
idim
][
idœ
][
__icomm
][
¢d_©ms_l¡_sz
[idim][idœ][__icomm]]=
Ÿtm
;

652 
	g¢d_©ms_l¡_sz
[
idim
][
idœ
][
__icomm
]++;

657 
	g‹m¶©e
<
	gidim
,
	gidœ
>

658 
	glßd_uÆßd


659 (& 
	g__icomm
)

661 
	g¢d_buff_sz
=
¢d_©ms_l¡_sz
[
idim
][
idœ
][
__icomm
]*
tÙ_updt_vecs_sz
;

662 if(
	g¢d_buff_ıùy
<
	g¢d_buff_sz
)

664 
	gd–‘e
 [] 
	g¢d_buff
;

665 
	g¢d_buff
=
Ãw
 
by‹
[
¢d_buff_sz
+
¢d_buff_grw
];

666 
	g¢d_buff_ıùy
=
¢d_buff_sz
+
¢d_buff_grw
;

669 
by‹
* 
	gtmp_¢d_buff
=
¢d_buff
;

670 
	givec
=0;ivec<
	gnupdt_vecs
;ivec++)

671 
	gvecs
[
ivec
]->
ıy
(
tmp_¢d_buff
,
¢d_©ms_l¡
[
idim
][
idœ
][
__icomm
],
¢d_©ms_l¡_sz
[idim][idir][__icomm]);

673 
MPI_S’d»cv
(&
¢d_©ms_l¡_sz
[
idim
][
idœ
][
__icomm
],1,
MPI_INT
,
Ãigh
[idim][idir],0,

674 &
rcv_©ms_l¡_sz
[
idim
][
idœ
][
__icomm
],1,
MPI_INT
,
Ãigh
[idim][1-idir],0,

675 
wÜld
,
MPI_STATUS_IGNORE
);

677 
	grcv_buff_sz
=
rcv_©ms_l¡_sz
[
idim
][
idœ
][
__icomm
]*
tÙ_updt_vecs_sz
;

678 if(
	grcv_buff_ıùy
<
	grcv_buff_sz
)

680 
	gd–‘e
 [] 
	grcv_buff
;

681 
	grcv_buff
=
Ãw
 
by‹
[
rcv_buff_sz
+
rcv_buff_grw
];

682 
	grcv_buff_ıùy
=
rcv_©ms_l¡_sz
[
idim
][
idœ
][
__icomm
]*
tÙ_updt_vecs_sz
+
rcv_buff_grw
;

685 
MPI_S’d»cv
(
¢d_buff
,
¢d_buff_sz
,
MPI_BYTE
,
Ãigh
[
idim
][
idœ
],0,

686 
rcv_buff
,
rcv_buff_sz
,
MPI_BYTE
,
Ãigh
[
idim
][1-
idœ
],0,

687 
wÜld
,
MPI_STATUS_IGNORE
);

690 
by‹
* 
	gtmp_rcv_buff
=
rcv_buff
;

691 
	givec
=0;ivec<
	gnupdt_vecs
;ivec++)

693 
	gvecs
[
ivec
]->
»£rve
(
rcv_©ms_l¡_sz
[
idim
][
idœ
][
__icomm
]);

694 
	gvecs
[
ivec
]->
p¡
(
tmp_rcv_buff
,
rcv_©ms_l¡_sz
[
idim
][
idœ
][
__icomm
]);

700 
	g‹m¶©e
<
	gidim
,
	gidœ
>

701 
	g£lf_lßd_uÆßd


702 (& 
	g__icomm
)

704 
	grcv_©ms_l¡_sz
[
idim
][
idœ
][
__icomm
]=
¢d_©ms_l¡_sz
[idim][idir][__icomm];

706 
	givec
=0;ivec<
	gnupdt_vecs
;ivec++)

708 
	gvecs
[
ivec
]->
»£rve
(
rcv_©ms_l¡_sz
[
idim
][
idœ
][
__icomm
]);

709 
	gvecs
[
ivec
]->
ıy_p¡
(
¢d_©ms_l¡
[
idim
][
idœ
][
__icomm
],
rcv_©ms_l¡_sz
[idim][idir][__icomm]);

713 
	g‹m¶©e
<
	gidim
,
	gidœ
,
şass
 
	gVEC
>

714 
upd©e_v¬_ıy
(& 
__icomm
,
by‹
*& 
__¢d_buff
,
VEC
*& 
__v
)

716 
	g__v
->
ıy
(
__¢d_buff
,
¢d_©ms_l¡
[
idim
][
idœ
][
__icomm
],
¢d_©ms_l¡_sz
[idim][idir][__icomm]);

718 
	g‹m¶©e
<
	gidim
,
	gidœ
,
şass
 
	gVEC
,
	gşass
...
	gVS
>

719 
upd©e_v¬_ıy
(& 
__icomm
,
by‹
*& 
__¢d_buff
,
VEC
*& 
__v
,
VS
*&... 
__vs
)

721 
	gupd©e_v¬_ıy
<
	gidim
,
	gidœ
>(
	g__icomm
,
	g__¢d_buff
,
	g__v
);

722 
	gupd©e_v¬_ıy
<
	gidim
,
	gidœ
>(
	g__icomm
,
	g__¢d_buff
,
	g__vs
...);

725 
	g‹m¶©e
<
	gidim
,
	gidœ
,
şass
 
	gVEC
>

726 
upd©e_v¬_p¡
(& 
__icomm
,
by‹
*& 
__rcv_buff
,
VEC
*& 
__v
)

728 
	g__v
->
p¡
(
__rcv_buff
,
rcv_©ms_l¡_sz
[
idim
][
idœ
][
__icomm
]);

731 
	g‹m¶©e
<
	gidim
,
	gidœ
,
şass
 
	gVEC
,
	gşass
...
	gVS
>

732 
upd©e_v¬_p¡
(& 
__icomm
,
by‹
*& 
__rcv_buff
,
VEC
*& 
__v
,
VS
* ... 
__vs
)

734 
	gupd©e_v¬_p¡
<
	gidim
,
	gidœ
>(
	g__icomm
,
	g__rcv_buff
,
	g__v
);

735 
	gupd©e_v¬_p¡
<
	gidim
,
	gidœ
>(
	g__icomm
,
	g__rcv_buff
,
	g__vs
...);

739 
	g‹m¶©e
<
	gidim
,
	gidœ
,
şass
 
	gVEC
>

740 
upd©e_v¬
(& 
__icomm
,& 
__vecs_by‹_sz
,
VEC
*& 
__v
)

742 
by‹
* 
	gtmp_¢d_buff
=
¢d_buff
;

743 
	g__v
->
ıy
(
tmp_¢d_buff
,
¢d_©ms_l¡
[
idim
][
idœ
][
__icomm
],
¢d_©ms_l¡_sz
[idim][idir][__icomm]);

745 
MPI_S’d»cv
(
¢d_buff
,
¢d_©ms_l¡_sz
[
idim
][
idœ
][
__icomm
]*
__v
->
by‹_sz
,
MPI_BYTE
,
Ãigh
[idim][idir],0,

746 
__v
->
’d
(),
rcv_©ms_l¡_sz
[
idim
][
idœ
][
__icomm
]*__v->
by‹_sz
,
MPI_BYTE
,
Ãigh
[idim][1-idir],0,

747 
wÜld
,
MPI_STATUS_IGNORE
);

748 
	g__v
->
	gvec_sz
+=
rcv_©ms_l¡_sz
[
idim
][
idœ
][
__icomm
];

751 
	g‹m¶©e
<
	gidim
,
	gidœ
,
şass
 
	gVEC
,
	gşass
...
	gVS
>

752 
upd©e_v¬
(& 
__icomm
,& 
__vecs_by‹_sz
,
VEC
*& 
__v
,
VS
*&... 
__vs
)

754 
by‹
* 
	g__¢d_buff
=
¢d_buff
;

755 
	gupd©e_v¬_ıy
<
	gidim
,
	gidœ
>(
	g__icomm
,
	g__¢d_buff
,
	g__v
,
	g__vs
...);

756 
MPI_S’d»cv
(
¢d_buff
,
¢d_©ms_l¡_sz
[
idim
][
idœ
][
__icomm
]*
__vecs_by‹_sz
,
MPI_BYTE
,
Ãigh
[idim][idir],0,

757 
rcv_buff
,
rcv_©ms_l¡_sz
[
idim
][
idœ
][
__icomm
]*
__vecs_by‹_sz
,
MPI_BYTE
,
Ãigh
[idim][1-idir],0,

758 
wÜld
,
MPI_STATUS_IGNORE
);

760 
by‹
* 
	g__rcv_buff
=
rcv_buff
;

761 
	gupd©e_v¬_p¡
<
	gidim
,
	gidœ
>(
	g__icomm
,
	g__rcv_buff
,
	g__v
,
	g__vs
...);

765 
	g‹m¶©e
<
	gidim
,
	gidœ
,
şass
 
	gVEC
>

766 
£lf_upd©e_v¬
(& 
__icomm
,&,
VEC
*& 
__v
)

768 
	g__v
->
ıy_p¡
(
¢d_©ms_l¡
[
idim
][
idœ
][
__icomm
],
¢d_©ms_l¡_sz
[idim][idir][__icomm]);

770 
	g‹m¶©e
<
	gidim
,
	gidœ
,
şass
 
	gVEC
,
	gşass
...
	gVS
>

771 
£lf_upd©e_v¬
(& 
__icomm
,& 
__vecs_by‹_sz
,
VEC
*& 
__v
,
VS
*&... 
__vs
)

773 
	g£lf_upd©e_v¬
<
	gidim
,
	gidœ
>(
	g__icomm
,
	g__vecs_by‹_sz
,
	g__v
);

774 
	g£lf_upd©e_v¬
<
	gidim
,
	gidœ
>(
	g__icomm
,
	g__vecs_by‹_sz
,
	g__vs
...);

778 
	g‹m¶©e
<
	gidim
,
	gidœ
,
şass
 
	gF
,
	gşass
 ...
	gVS
>

779 
__upd©e
(
F
&& 
f
,& 
tÙ_by‹_sz
,
ty³0
 (&
__H
)[
__dim__
],
Vec
<ty³0>*& 
__x
,
VS
*&... 
vs
)

781 
	gicomm
=0;icomm<
	gncomms
[
idim
][
idœ
];icomm++)

783 if(
	g£lf_comm
[
idim
])

784 
	g£lf_upd©e_v¬
<
	gidim
,
	gidœ
>(
	gicomm
,
	gtÙ_by‹_sz
,
	g__x
,
	gvs
...);

786 
	gupd©e_v¬
<
	gidim
,
	gidœ
>(
	gicomm
,
	gtÙ_by‹_sz
,
	g__x
,
	gvs
...);

789 if(
	gpbc_cÜ»ùiÚ
[
idim
][
idœ
])

791 
ty³0
* 
	gx_vec
=
__x
->
’d
()-
__dim__
;

792 
	gŸtm
=0;Ÿtm<
	grcv_©ms_l¡_sz
[
idim
][
idœ
][
icomm
];Ÿtm++,
	gx_vec
-=
__dim__
)

793 
f
(
__H
,
x_vec
);

799 
	g‹m¶©e
<
	gidim
,
	gidœ
,
	gşass
 ...
	gVS
>

800 
__upd©e
(& 
tÙ_by‹_sz
,
VS
*&... 
vs
)

802 
	gicomm
=0;icomm<
	gncomms
[
idim
][
idœ
];icomm++)

804 if(
	g£lf_comm
[
idim
])

805 
	g£lf_upd©e_v¬
<
	gidim
,
	gidœ
>(
	gicomm
,
	gtÙ_by‹_sz
,
	gvs
...);

807 
	gupd©e_v¬
<
	gidim
,
	gidœ
>(
	gicomm
,
	gtÙ_by‹_sz
,
	gvs
...);

813 
	g‹m¶©e
<
	gidim
,
	gidœ
,
şass
 
	gF0
,şas 
	gF1
>

814 
___li¡
(
Ï¡_©m
,
F0
&& 
f0
,
F1
&& 
f1
)

816 
	glo_©m
=0;

817 
	ghi_©m
=
Ï¡_©m
;

818 
ty³0
* 
	gx_vec
;

819 
	gicomm
=0;icomm<
	gncomms
[
idim
][
idœ
];icomm++)

822 
	g¢d_buff_sz
=0;

823 
	grcv_©ms_l¡_sz
[
idim
][
idœ
][
icomm
]=
¢d_©ms_l¡_sz
[idim][idir][icomm]=0;

824 
	gx_vec
=
x
->
begš
()+
__dim__
*
lo_©m
+
idim
;

825 
	gŸtm
=
lo_©m
;Ÿtm<
	ghi_©m
;Ÿtm++,
	gx_vec
+=
__dim__
)

826 if(
f0
(*
x_vec
,
s_bnd
[
idim
][
idœ
]))

827 
	gadd_to_¢d_l¡
<
	gidim
,
	gidœ
>(
	gicomm
,
	gŸtm
);

829 if(
	g£lf_comm
[
idim
])

830 
	g£lf_lßd_uÆßd
<
	gidim
,
	gidœ
>(
	gicomm
);

832 
	glßd_uÆßd
<
	gidim
,
	gidœ
>(
	gicomm
);

835 
	glo_©m
=
x
->
vec_sz
-
rcv_©ms_l¡_sz
[
idim
][
idœ
][
icomm
];

836 
	ghi_©m
=
x
->
vec_sz
;

837 if(
	gpbc_cÜ»ùiÚ
[
idim
][
idœ
])

839 
	gx_vec
=
x
->
begš
()+
__dim__
*
lo_©m
+
idim
;

840 
	gŸtm
=
lo_©m
;Ÿtm<
	ghi_©m
;Ÿtm++,
	gx_vec
+=
__dim__
)

841 
f1
(*
x_vec
);

843 
	gmax_¢d_©ms_l¡_sz
=
MAX
(
max_¢d_©ms_l¡_sz
,
¢d_©ms_l¡_sz
[
idim
][
idœ
][
icomm
]);

844 
	gmax_rcv_©ms_l¡_sz
=
MAX
(
max_rcv_©ms_l¡_sz
,
rcv_©ms_l¡_sz
[
idim
][
idœ
][
icomm
]);

848 
	g‹m¶©e
<
	gidim
>

849 
__li¡
()

851 
	gÏ¡_©m
=
x
->
vec_sz
;

852 
	g___li¡
<
	gidim
,0>(
	gÏ¡_©m
,[](cÚ¡ 
	gty³0
& 
	gl
,cÚ¡y³0& 
	gr
)->
	gboŞ
{ (l<r);},[]Ñy³0& 
	g__x
){++__x;});

853 
	g___li¡
<
	gidim
,1>(
	gÏ¡_©m
,[](cÚ¡ 
	gty³0
& 
	gl
,cÚ¡y³0& 
	gr
)->
	gboŞ
{ (l>=
r
);},[]Ñy³0& 
	g__x
){--__x;});

854 
	g__li¡
<
	gidim
+1>();

858 
	g‹m¶©e
<
	gidim
>

859 şas 
	cH–³r


861 
	gpublic
:

862 
‹m¶©e
<
şass
... 
VS
>

863 
upd©e_w_x
(
Upd©e
& 
upd©e
,& 
tÙ_by‹_sz
,
ty³0
 (*
__H
)[
__dim__
],
VS
*&... 
vs
)

865 
	gupd©e
.
	g__upd©e
<
	gidim
,0>(
	gAlgeb¿
::
V_add
<
idim
+1,
	gty³0
>,
	gtÙ_by‹_sz
,*
	g__H
,
	gvs
...);

866 
	gupd©e
.
	g__upd©e
<
	gidim
,1>(
	gAlgeb¿
::
V_sub
<
idim
+1,
	gty³0
>,
	gtÙ_by‹_sz
,*
	g__H
,
	gvs
...);

867 
	gH–³r
<
	gidim
+1>::
upd©e_w_x
(
upd©e
,
tÙ_by‹_sz
,
__H
+1,
vs
...);

869 
	g‹m¶©e
<
	gşass
... 
	gVS
>

870 
upd©e_wo_x
(
Upd©e
& 
upd©e
,& 
tÙ_by‹_sz
,
VS
*&... 
vs
)

872 
	gupd©e
.
	g__upd©e
<
	gidim
,0>(
	gtÙ_by‹_sz
,
	gvs
...);

873 
	gupd©e
.
	g__upd©e
<
	gidim
,1>(
	gtÙ_by‹_sz
,
	gvs
...);

874 
	gH–³r
<
	gidim
+1>::
upd©e_wo_x
(
upd©e
,
tÙ_by‹_sz
,
vs
...);

880 
	g‹m¶©e
<
şass
 
	gVEC
>

881 
»£t_vs
(
VEC
*& 
__v
)

883 
	g__v
->
	gvec_sz
=
Çtms_lş
;

884  
	g__v
->
	gby‹_sz
;

886 
	g‹m¶©e
<
şass
 
	gVEC
,
	gşass
 ...
	gVS
>

887 
»£t_vs
(
VEC
*& 
__v
,
VS
*&... 
__vs
)

889  
»£t_vs
(
__v
)+»£t_vs(
__vs
...);

892 
	g‹m¶©e
<
	gidim
,
	gidœ
>

893 
	gxchng_buff


894 (& 
	g__icomm
,
	gby‹
*& 
	g__¢d_buff
,by‹*& 
	g__rcv_buff
)

896 
MPI_S’d»cv
(
__¢d_buff
,
rcv_©ms_l¡_sz
[
idim
][
idœ
][
__icomm
],
MPI_BYTE
,
Ãigh
[idim][1-idir],0,

897 
__rcv_buff
,
¢d_©ms_l¡_sz
[
idim
][
idœ
][
__icomm
],
MPI_BYTE
,
Ãigh
[idim][idir],0,

898 
wÜld
,
MPI_STATUS_IGNORE
);

900 
	g‹m¶©e
<
	gidim
,
	gidœ
>

901 
	g£lf_xchng_buff


902 (& 
	g__icomm
,
	gby‹
*& 
	g__¢d_buff
,by‹*& 
	g__rcv_buff
)

904 
memıy
(
__rcv_buff
,
__¢d_buff
,
¢d_©ms_l¡_sz
[
idim
][
idœ
][
__icomm
]);

908 
	g‹m¶©e
<
	gidim
,
	gidœ
>

909 
__rm_rdndncy
(
by‹
* 
m¬k
,by‹*& 
__m¬k
,* 
__¢d_©ms_l¡
)

911 
	g__¢d_©ms_l¡_sz
,
	g__rcv_©ms_l¡_sz
;

912 
	gicomm
=
ncomms
[
idim
][
idœ
];icomm>-1;icomm--)

914 
	g__m¬k
-=
rcv_©ms_l¡_sz
[
idim
][
idœ
][
icomm
];

915 if(
	g£lf_comm
[
idim
])

916 
	g£lf_xchng_buff
<
	gidim
,
	gidœ
>(
	gicomm
,
	g__m¬k
,
	grcv_buff
);

918 
	gxchng_buff
<
	gidim
,
	gidœ
>(
	gicomm
,
	g__m¬k
,
	grcv_buff
);

919 
	g__¢d_©ms_l¡_sz
=0;

920 
	gi
=0; i<
	g¢d_©ms_l¡_sz
[
idim
][
idœ
][
icomm
];i++)

922 if(
	grcv_buff
[
i
]=='1')

924 if(
¢d_©ms_l¡
[
idim
][
idœ
][
icomm
][
i
]>=
Çtms_lş
)

925 
m¬k
[
¢d_©ms_l¡
[
idim
][
idœ
][
icomm
][
i
]-
Çtms_lş
]='1';

926 
	g__¢d_©ms_l¡
[
__¢d_©ms_l¡_sz
++]=
¢d_©ms_l¡
[
idim
][
idœ
][
icomm
][
i
];

929 
memıy
(
¢d_©ms_l¡
[
idim
][
idœ
][
icomm
],
__¢d_©ms_l¡
,
__¢d_©ms_l¡_sz
*());

930 
	g¢d_©ms_l¡_sz
[
idim
][
idœ
][
icomm
]=
__¢d_©ms_l¡_sz
;

932 
	g__rcv_©ms_l¡_sz
=0;

933 
	gi
=0; i<
	grcv_©ms_l¡_sz
[
idim
][
idœ
][
icomm
];i++)

934 if(
	g__m¬k
[
i
]=='1')

935 
__rcv_©ms_l¡_sz
++;

936 
	grcv_©ms_l¡_sz
[
idim
][
idœ
][
icomm
]=
__rcv_©ms_l¡_sz
;

938 
	gmax_¢d_©ms_l¡_sz
=
MAX
(
max_¢d_©ms_l¡_sz
,
¢d_©ms_l¡_sz
[
idim
][
idœ
][
icomm
]);

939 
	gmax_rcv_©ms_l¡_sz
=
MAX
(
max_rcv_©ms_l¡_sz
,
rcv_©ms_l¡_sz
[
idim
][
idœ
][
icomm
]);

942 
	g__rm_rdndncy
<
	gidim
+
	gidœ
-1,1-idœ>(
	gm¬k
,
	g__m¬k
,
	g__¢d_©ms_l¡
);

945 
	g‹m¶©e
<
	gidim
,
	gidœ
>

946 
__rm_rdndncy_Şd_2_Ãw
(* 
Şd_2_Ãw
)

948 
	gicomm
=0;icomm<
	gncomms
[
idim
][
idœ
];icomm++)

949 
	gi
=0; i<
	g¢d_©ms_l¡_sz
[
idim
][
idœ
][
icomm
];i++)

950 
	g¢d_©ms_l¡
[
idim
][
idœ
][
icomm
][
i
]=
Şd_2_Ãw
[
¢d_©ms_l¡
[idim][idir][icomm][i]];

951 
	g__rm_rdndncy_Şd_2_Ãw
<
	gidim
+
	gidœ
,1-idœ>(
	gŞd_2_Ãw
);

954 
	g´Ùeùed
:

955 
public
:

956 
Upd©e
(
Atoms
* 
©oms
,

957 & 
__nupdt_vecs
,& 
__nxchng_vecs
):

958 
wÜld
(
©oms
->world),

959 
Çtms_lş
(
©oms
->natms_lcl),

960 
Çtms_ph
(
©oms
->natms_ph),

961 
H
(
©oms
->H),

962 
d•th_šv
(
©oms
->depth_inv),

964 
¿nk
(
©oms
->
comm
.rank),

965 
s_lo
(
©oms
->
comm
.s_lo),

966 
s_hi
(
©oms
->
comm
.s_hi),

968 
max_cut
(
©oms
->max_cut),

969 
x
(
©oms
->x),

971 
vecs
(
©oms
->
dyÇmic_vecs
),

972 
nvecs
(
©oms
->
ndyÇmic_vecs
),

973 
nupdt_vecs
(
__nupdt_vecs
),

974 
nxchng_vecs
(
__nxchng_vecs
)

976 
	g¡¬t
<0>(
	g©oms
->
	gcomm
.
	gÃigh
,©oms->comm.
	gdims
,©oms->comm.
	gcoÜds
);

977 
	g¢d_buff
=
NULL
;

978 
	g¢d_buff_ıùy
=0;

980 
	grcv_buff
=
NULL
;

981 
	grcv_buff_ıùy
=0;

983 
	gtÙ_ncomms
=0;

984 
	gtÙ_updt_vecs_sz
=0;

985 
	givec
=0;ivec<
	gnupdt_vecs
;ivec++)

986 
	gtÙ_updt_vecs_sz
+=
vecs
[
ivec
]->
by‹_sz
;

990 ~
Upd©e
()

992 
	gd–‘e
 [] 
	grcv_buff
;

993 
	gd–‘e
 [] 
	g¢d_buff
;

994 
	gd—Îoc_®l
<0,0>();

996 
»£t
()

998 
	g__tÙ_ncomms
=0;

999 
	g__»£t
<0>(
	g__tÙ_ncomms
);

1000 
	gtÙ_ncomms
=
__tÙ_ncomms
;

1002 
li¡
()

1004 
	gÇtms_ph
=0;

1005 
	gmax_¢d_©ms_l¡_sz
=
max_rcv_©ms_l¡_sz
=0;

1006 
	g__li¡
<0>();

1007 
	gÇtms_ph
=
x
->
vec_sz
-
Çtms_lş
;

1008 
	givec
=
nxchng_vecs
;ivec<
	gnvecs
;ivec++)

1010 
	gvecs
[
ivec
]->
	gvec_sz
=0;

1011 
	gvecs
[
ivec
]->
»size
(
x
->
vec_sz
);

1016 
upd©e_w_x
()

1018 
	gtÙ_by‹_sz
=
»£t_vs
(
x
);

1019 
	g¢d_buff_sz
=0;

1020 
»£rve_¢d_buff
(
tÙ_by‹_sz
*
max_¢d_©ms_l¡_sz
);

1021 
	gH–³r
<0>::
upd©e_w_x
(*
this
,
tÙ_by‹_sz
,
H
,
x
);

1025 
	g‹m¶©e
<
	gşass
 ...
	gVS
>

1026 
upd©e_w_x
(
VS
*&... 
__vs
)

1028 
	gtÙ_by‹_sz
=
»£t_vs
(
x
,
__vs
...);

1029 
	g¢d_buff_sz
=
rcv_buff_sz
=0;

1030 
»£rve_¢d_buff
(
tÙ_by‹_sz
*
max_¢d_©ms_l¡_sz
);

1031 
»£rve_rcv_buff
(
tÙ_by‹_sz
*
max_rcv_©ms_l¡_sz
);

1032 
	gH–³r
<0>::
upd©e_w_x
(*
this
,
tÙ_by‹_sz
,
H
,
x
,
__vs
...);

1036 
	g‹m¶©e
<
	gşass
 ...
	gVS
>

1037 
upd©e_w_x_w_dH
(
ty³0
 (*
__dH
)[
__dim__
],
Vec
<ty³0>*& 
__x
,
VS
*&... 
__vs
)

1039 
	gtÙ_by‹_sz
=
»£t_vs
(
__x
,
__vs
...);

1040 
	g¢d_buff_sz
=
rcv_buff_sz
=0;

1041 
»£rve_¢d_buff
(
tÙ_by‹_sz
*
max_¢d_©ms_l¡_sz
);

1042 
»£rve_rcv_buff
(
tÙ_by‹_sz
*
max_rcv_©ms_l¡_sz
);

1043 
	gH–³r
<0>::
upd©e_w_x
(*
this
,
tÙ_by‹_sz
,
__dH
,
__x
,
__vs
...);

1046 
upd©e_w_x_w_dH
(
ty³0
 (*
__dH
)[
__dim__
],
Vec
<ty³0>*& 
__x
)

1048 
	gtÙ_by‹_sz
=
»£t_vs
(
__x
);

1049 
	g¢d_buff_sz
=0;

1050 
»£rve_¢d_buff
(
tÙ_by‹_sz
*
max_¢d_©ms_l¡_sz
);

1051 
	gH–³r
<0>::
upd©e_w_x
(*
this
,
tÙ_by‹_sz
,
__dH
,
__x
);

1054 
	g‹m¶©e
<
şass
 
	gVEC
>

1055 
upd©e_wo_x
(
VEC
*& 
__v
)

1057 
	g__v
->
	gvec_sz
=
Çtms_lş
;

1058 
	g¢d_buff_sz
=0;

1059 
	gtÙ_by‹_sz
=
__v
->
by‹_sz
;

1060 
»£rve_¢d_buff
(
tÙ_by‹_sz
*
max_¢d_©ms_l¡_sz
);

1061 
	gH–³r
<0>::
upd©e_wo_x
(*
this
,
tÙ_by‹_sz
,
__v
);

1065 
	g‹m¶©e
<
	gşass
 ...
	gVS
>

1066 
upd©e_wo_x
(
VS
*&... 
__vs
)

1068 
	gtÙ_by‹_sz
=
»£t_vs
(
__vs
...);

1069 
	g¢d_buff_sz
=
rcv_buff_sz
=0;

1070 
»£rve_¢d_buff
(
tÙ_by‹_sz
*
max_¢d_©ms_l¡_sz
);

1071 
»£rve_rcv_buff
(
tÙ_by‹_sz
*
max_rcv_©ms_l¡_sz
);

1072 
	gH–³r
<0>::
upd©e_wo_x
(*
this
,
tÙ_by‹_sz
,
__vs
...);

1076 
rm_rdndncy
()

1078 
	g¢d_buff_sz
=
rcv_buff_sz
=0;

1079 
»£rve_rcv_buff
(
max_¢d_©ms_l¡_sz
);

1080 
»£rve_¢d_buff
(
Çtms_ph
);

1082 
by‹
* 
	gm¬k
=
¢d_buff
;

1086 
	g__¢d_©ms_l¡_ıùy
=
max_¢d_©ms_l¡_sz
;

1087 * 
	g__¢d_©ms_l¡
=
NULL
;

1088 if(
	g__¢d_©ms_l¡_ıùy
è
	g__¢d_©ms_l¡
=
Ãw
 [
__¢d_©ms_l¡_ıùy
];

1090 
by‹
* 
	g__m¬k
=
m¬k
+
Çtms_ph
;

1091 
	gmax_¢d_©ms_l¡_sz
=
max_rcv_©ms_l¡_sz
=0;

1092 
	g__rm_rdndncy
<
	g__dim__
-1,1>(
	gm¬k
,
	g__m¬k
,
	g__¢d_©ms_l¡
);

1093 
	gd–‘e
 [] 
	g__¢d_©ms_l¡
;

1095 
	gŞd_2_Ãw_ıùy
=
Çtms_lş
+
Çtms_ph
;

1096 * 
	gŞd_2_Ãw
=
NULL
;

1097 if(
	gŞd_2_Ãw_ıùy
è
	gŞd_2_Ãw
=
Ãw
 [
Şd_2_Ãw_ıùy
];

1099 
	gli¡_sz
=0;

1100 
	gli¡_ıùy
=
Çtms_ph
;

1101 * 
	gli¡
=
NULL
;

1102 if(
	gli¡_ıùy
è
	gli¡
=
Ãw
 [
li¡_ıùy
];

1104 
	gŸtm
=0;Ÿtm<
	gÇtms_lş
;iatm++)

1105 
	gŞd_2_Ãw
[
Ÿtm
]=iatm;

1107 
	gicurs
=
Çtms_lş
;

1108 
	gŸtm
=
Çtms_lş
;Ÿtm<
	gÇtms_lş
+
	gÇtms_ph
;iatm++)

1109 if(
	gm¬k
[
Ÿtm
-
Çtms_lş
]=='1')

1111 
Şd_2_Ãw
[
Ÿtm
]=
icurs
++;

1112 
	gli¡
[
li¡_sz
++]=
Ÿtm
;

1115 
	gÃw_Çtms_ph
=
li¡_sz
;

1116 
	g__rm_rdndncy_Şd_2_Ãw
<0,0>(
	gŞd_2_Ãw
);

1121 
	gd–‘e
 [] 
	gŞd_2_Ãw
;

1123 * 
	g__li¡
=
li¡
;

1125 
	gvec_sz
=
Çtms_lş
;

1126 *
	g__li¡
==
Çtms_lş
+
icurs
)

1128 
__li¡
++;

1129 
	gvec_sz
++;

1130 
	gli¡_sz
--;

1133 
	givec
=0;ivec<
	gnupdt_vecs
;ivec++)

1135 
	gvecs
[
ivec
]->
	gvec_sz
=
vec_sz
;

1136 
	gvecs
[
ivec
]->
ıy_p¡
(
__li¡
,
li¡_sz
);

1139 
	gd–‘e
 [] 
	gli¡
;

1141 
	gÇtms_ph
=
Ãw_Çtms_ph
;

1145 
	g‹m¶©e
<>

1146 
šlše
 
	gUpd©e
::
¡¬t
<
__dim__
>((*)[2],*,*){};

1147 
	g‹m¶©e
<>

1148 
šlše
 
	gUpd©e
::
__li¡
<
__dim__
>(){};

1149 
	g‹m¶©e
<>

1150 
šlše
 
	gUpd©e
::
__»£t
<
__dim__
>(&){};

1151 
	g‹m¶©e
<>

1152 
šlše
 
	gUpd©e
::
d—Îoc_®l
<
__dim__
,0>(){};

1153 
	g‹m¶©e
<>

1154 
šlše
 
	gUpd©e
::
__rm_rdndncy
<-1,1>(
	gby‹
*,byte*&,*){}

1155 
	g‹m¶©e
<>

1156 
šlše
 
	gUpd©e
::
__rm_rdndncy_Şd_2_Ãw
<
__dim__
,0>(*){}

1157 
	g‹m¶©e
<>

1158 
şass
 
	gUpd©e
::
H–³r
<
__dim__
>

1160 
public
:

1161 
‹m¶©e
<
şass
... 
VS
>

1162 
upd©e_w_x
(
Upd©e
&,&,
ty³0
 (*)[
__dim__
],
VS
*&...){}

1163 
	g‹m¶©e
<
	gşass
... 
	gVS
>

1164 
upd©e_wo_x
(
Upd©e
&,&,
VS
*&...){}

	@export.cpp

1 
	~"expÜt.h
"

2 
	~"©oms_¡yËs.h
"

3 
	~<¡ršg
>

4 
	~"memÜy.h
"

5 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

9 
	gExpÜtMD
::
ExpÜtMD
(
¡d
::
š™Ÿliz”_li¡
<cÚ¡ *> 
__def_vec_Çmes
,

10 
__Ãv”y
,
¡d
::
¡ršg
* 
__u£r_vec_Çmes
,
size_t
 
__nu£r_vecs
):

11 
	$ExpÜt
(
__def_vec_Çmes
,
__Ãv”y
,
__u£r_vec_Çmes
,
__nu£r_vecs
)

13 
	}
}

17 
	gExpÜtMD
::~
	$ExpÜtMD
()

19 
	}
}

23 
ExpÜtDMD
::ExpÜtDMD(
¡d
::
š™Ÿliz”_li¡
<cÚ¡ *> 
__def_vec_Çmes
,

24 
__Ãv”y
,
¡d
::
¡ršg
* 
__u£r_vec_Çmes
,
size_t
 
__nu£r_vecs
):

25 
	$ExpÜt
(
__def_vec_Çmes
,
__Ãv”y
,
__u£r_vec_Çmes
,
__nu£r_vecs
)

27 
	}
}

31 
	gExpÜtDMD
::~
	$ExpÜtDMD
()

33 
	}
}

37 
ExpÜt
::ExpÜt(
¡d
::
š™Ÿliz”_li¡
<cÚ¡ *> 
__def_vec_Çmes
,

38 
__Ãv”y
,
¡d
::
¡ršg
* 
__u£r_vec_Çmes
,
size_t
 
__nu£r_vecs
):

39 
Ãv”y
(
__Ãv”y
),

40 
nvecs
(0),

41 
vecs
(
NULL
),

42 
	$vec_Çmes
(
NULL
)

45 cÚ¡ * cÚ¡* 
___def_vec_Çmes
=
__def_vec_Çmes
.
	`begš
();

47 
boŞ
* 
v®id_u£r_vecs
=
NULL
;

48 
MemÜy
::
	`®loc
(
v®id_u£r_vecs
,
__nu£r_vecs
);

49 
size_t
 
i
=0;i<
__nu£r_vecs
;i++è
v®id_u£r_vecs
[i]=
Œue
;

50 
nu¤_vecs
=0;

51 
size_t
 
i
=0;i<
__nu£r_vecs
;i++)

54 
j
=0;j<
i
 && 
v®id_u£r_vecs
[i];j++)

55 if(
¡d
::
	`¡rcmp
(
__u£r_vec_Çmes
[
i
].
	`c_¡r
(),__u£r_vec_Çmes[
j
].c_str())==0)

56 
v®id_u£r_vecs
[
i
]=
çl£
;

58 
size_t
 
j
=0;j<
__def_vec_Çmes
.
	`size
(è&& 
v®id_u£r_vecs
[
i
];j++)

59 if(
¡d
::
	`¡rcmp
(
__u£r_vec_Çmes
[
i
].
	`c_¡r
(),
___def_vec_Çmes
[
j
])==0)

60 
v®id_u£r_vecs
[
i
]=
çl£
;

63 if(
v®id_u£r_vecs
[
i
])

64 
nu¤_vecs
++;

67 
ndef_vecs
=
¡©ic_ÿ¡
<>(
__def_vec_Çmes
.
	`size
());

68 
nvecs
=
nu¤_vecs
+
ndef_vecs
;

69 
vecs
=
Ãw
 
vec
*[
nvecs
];

70 
vec_Çmes
=
Ãw
 
¡d
::
¡ršg
[
nvecs
];

71 
nvecs
=0;

72 
size_t
 
i
=0;i<
__def_vec_Çmes
.
	`size
();i++)

73 
vec_Çmes
[
nvecs
++]=
___def_vec_Çmes
[
i
];

75 
size_t
 
i
=0;i<
__nu£r_vecs
;i++)

77 if(!
v®id_u£r_vecs
[
i
]) ;

78 
vec_Çmes
[
nvecs
++]=
__u£r_vec_Çmes
[
i
];

80 
MemÜy
::
	`d—Îoc
(
v®id_u£r_vecs
);

81 
	}
}

85 
	gExpÜt
::~
	$ExpÜt
()

87 
d–‘e
 [] 
vec_Çmes
;

88 
d–‘e
 [] 
vecs
;

89 
	}
}

93 
	gExpÜt
::
	$add_to_deçuÉ
(cÚ¡ * 
def_Çme
)

96 
¡d
::
¡ršg
* 
__vec_Çmes
=
Ãw
 std::¡ršg[
nvecs
+1];

97 
__vec_Çmes
[0]=
def_Çme
;

98 
i
=0;i<
nvecs
;i++)

99 
__vec_Çmes
[
i
+1]=
¡d
::
	`move
(
vec_Çmes
[i]);

100 
nvecs
++;

101 
ndef_vecs
++;

102 
d–‘e
 [] 
vec_Çmes
;

103 
d–‘e
 [] 
vecs
;

104 
vec_Çmes
=
__vec_Çmes
;

105 
vecs
=
Ãw
 
vec
*[
nvecs
];

106 
	}
}

110 
	gExpÜt
::
	$fšd_vecs
(
Atoms
* 
©oms
)

112 autØ
fšd_vec
=[](cÚ¡ 
¡d
::
¡ršg
& 
Çme
,
vec
** 
vs
,
nvs
)->vec*

114 
i
=0;i<
nvs
;i++)

115 if(
vs
[
i
]->
Çme
 && 
¡d
::
	`¡rcmp
Òame.
	`c_¡r
(),vs[i]->name)==0)

116  
vs
[
i
];

117  
NULL
;

120 
vec
** 
dyÇmic_vecs
=
©oms
->dynamic_vecs;

121 
ndyÇmic_vecs
=
©oms
->ndynamic_vecs;

122 
vec
** 
__vecs
=
©oms
->
vecs
;

123 
__nvecs
=
©oms
->
nvecs
;

124 
vec
* 
v
;

126 
ndims
=0;

127 if(
ndyÇmic_vecs
)

129 
i
=0;i<
nvecs
;i++)

131 
v
=
	`fšd_vec
(
vec_Çmes
[
i
],
dyÇmic_vecs
,
ndyÇmic_vecs
);

132 if(!
v
)

134 
vec
* 
__v
=
	`fšd_vec
(
vec_Çmes
[
i
],
__vecs
,
__nvecs
);

135 if(!
__v
)

136 
throw
 "ÿÂÙƒxpÜˆveùÜ '"+
¡d
::
	`¡ršg
(
vec_Çmes
[
i
])+"'o file, it does‚otƒxist";

139 if(
__v
->
	`is_em±y
())

140 
throw
 "ÿÂÙƒxpÜˆveùÜ '"+
¡d
::
	`¡ršg
(
vec_Çmes
[
i
])+"'o file, it isƒmpty";

142 
throw
 "ÿÂÙƒxpÜˆveùÜ '"+
¡d
::
	`¡ršg
(
vec_Çmes
[
i
])+"'o file, it is‚ot included inhis simulation (it is‡rchived)";

145 
ndims
+=
v
->
	`ndim_dump
();

147 
vecs
[
i
]=
v
;

152 
i
=0;i<
nvecs
;i++)

154 
v
=
	`fšd_vec
(
vec_Çmes
[
i
],
__vecs
,
__nvecs
);

155 if(!
v
)

157 
throw
 "ÿÂÙƒxpÜˆveùÜ '"+
¡d
::
	`¡ršg
(
vec_Çmes
[
i
])+"'o file, it does‚otƒxist";

162 if(
v
->
	`is_em±y
())

163 
throw
 "ÿÂÙƒxpÜˆveùÜ '"+
¡d
::
	`¡ršg
(
vec_Çmes
[
i
])+"'o file, it isƒmpty";

165 
ndims
+=
v
->
	`ndim_dump
();

167 
vecs
[
i
]=
v
;

170 
	}
}

174 
	gExpÜt
::
	$g©h”
(
vec
** 
vecs
,
nvecs
)

177 
i
=0;i<
nvecs
;i++)

178 
vecs
[
i
]->
	`š™_dump
();

180 
comm_size
=
vecs
[0]->
©oms
->comm_size;

181 
comm_¿nk
=
vecs
[0]->
©oms
->comm_rank;

182 
MPI_Comm
& 
wÜld
=
vecs
[0]->
©oms
->world;

183 
Çtms_lş
=
vecs
[0]->
©oms
->natms_lcl;

184 
Çtms_rcvd
=
Çtms_lş
;

186 
i
=1;i<
comm_size
;i++)

188 if(
comm_¿nk
==
i
)

191 
	`MPI_S’d
(&
Çtms_lş
,1,
MPI_INT
,0,
i
,
wÜld
);

192 
j
=0;j<
nvecs
;j++)

193 
	`MPI_S’d
(
vecs
[
j
]->
	`begš_dump
(),
Çtms_lş
*vecs[j]->
by‹_sz
,
MPI_BYTE
,0,
i
*(j+2),
wÜld
);

195 if(
comm_¿nk
==0)

197 
rcv_Çtms_lş
;

198 
	`MPI_Recv
(&
rcv_Çtms_lş
,1,
MPI_INT
,
i
,i,
wÜld
,
MPI_STATUS_IGNORE
);

200 
j
=0;j<
nvecs
;j++)

202 
size_dump
=
vecs
[
j
]->
by‹_sz
;

203 
by‹
* 
dump_d©a
=
»š‹½»t_ÿ¡
<by‹*>(
vecs
[
j
]->
	`begš_dump
())+
Çtms_rcvd
*
size_dump
;

204 
	`MPI_Recv
(
dump_d©a
,
rcv_Çtms_lş
*
size_dump
,
MPI_BYTE
,
i
,i*(
j
+2),
wÜld
,
MPI_STATUS_IGNORE
);

207 
Çtms_rcvd
+=
rcv_Çtms_lş
;

210 
	}
}

214 
	gExpÜt
::
	$»Ëa£
(
vec
** 
vecs
,
nvecs
)

216 
i
=0;i<
nvecs
;i++)

217 
vecs
[
i
]->
	`fš_dump
();

218 
	}
}

222 
boŞ
 
	gExpÜt
::
	$İ’
(cÚ¡ 
¿nk
,
MPI_Comm
& 
wÜld
, cÚ¡ * 
·th
,cÚ¡ * 
mode
,
FILE
*& 
å
)

224 
”r
=0;

225 if(
¿nk
==0)

227 
å
=
	`fİ’
(
·th
,
mode
);

228 if(!
å
)

229 
”r
=1;

232 
å
=
NULL
;

234 
	`MPI_Bÿ¡
(&
”r
,1,
MPI_INT
,0,
wÜld
);

235 if(
”r
è 
çl£
;

236  
Œue
;

237 
	}
}

241 
	gExpÜt
::
	$şo£
(cÚ¡ 
¿nk
,
MPI_Comm
& 
wÜld
,
FILE
*& 
å
)

243 if(
¿nk
==0è
	`fşo£
(
å
);

244 
	}
}

248 
	gExpÜt
::
	$g‘£t_d—fuÉ_vecs
(
PyG‘S‘Def
& 
g‘£t
)

250 
g‘£t
.
Çme
=(*)"default_vecs";

251 
g‘£t
.
doc
=(*)"default vectors included inhisƒxport object";

252 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

254 
size_t
 
sz
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
x´t
->
ndef_vecs
;

255 
¡d
::
¡ršg
* 
vec_Çmes
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
x´t
->vec_names;

256 
size_t
* 
sz_±r
=&
sz
;

257  
v¬
<
¡d
::
¡ršg
*>::
	`bud
(
vec_Çmes
,&
sz_±r
);

259 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

261 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,"readonly‡ttribute");

264 
	}
}

268 
	gExpÜt
::
	$g‘£t_exŒa_vecs
(
PyG‘S‘Def
& 
g‘£t
)

270 
g‘£t
.
Çme
=(*)"extra_vecs";

271 
g‘£t
.
doc
=(*)"extra vectors included inhisƒxport object";

272 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

274 
size_t
 
sz
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
x´t
->
nu¤_vecs
;

275 
¡d
::
¡ršg
* 
vec_Çmes
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
x´t
->vec_names+

276 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
x´t
->
ndef_vecs
;

277 
size_t
* 
sz_±r
=&
sz
;

278  
v¬
<
¡d
::
¡ršg
*>::
	`bud
(
vec_Çmes
,&
sz_±r
);

280 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

282 
V¬API
<
¡d
::
¡ršg
*> 
	`exŒa_vecs
("extra_vecs");

283 
ichk
=
exŒa_vecs
.
	`£t
(
İ
);

284 if(
ichk
==-1)  -1;

285 
nu¤_vecs
=
¡©ic_ÿ¡
<> (
exŒa_vecs
.
__v¬__
.
size
);

286 
ndef_vecs
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
x´t
->ndef_vecs;

287 
nvecs
=
nu¤_vecs
+
ndef_vecs
;

289 
¡d
::
¡ršg
* 
vec_Çmes
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
x´t
->vec_names;

290 
¡d
::
¡ršg
* 
__vec_Çmes
=
Ãw
 std::¡ršg[
nvecs
];

291 
i
=0;i<
ndef_vecs
;i++)

292 
__vec_Çmes
[
i
]=
¡d
::
	`move
(
vec_Çmes
[i]);

294 
i
=0;i<
nu¤_vecs
;i++)

295 
__vec_Çmes
[
i
+
ndef_vecs
]=
¡d
::
	`move
(
exŒa_vecs
.
v®
[i]);

298 
d–‘e
 [] 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
x´t
->
vecs
;

299 
d–‘e
 [] 
vec_Çmes
;

300 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
x´t
->
vecs
=
Ãw
 
vec
*[
nvecs
];

301 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
x´t
->
vec_Çmes
=
__vec_Çmes
;

302 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
x´t
->
nvecs
=nvecs;

303 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
x´t
->
nu¤_vecs
=nusr_vecs;

306 
	}
}

310 
	gExpÜt
::
	$g‘£t_Ãv”y
(
PyG‘S‘Def
& 
g‘£t
)

312 
g‘£t
.
Çme
=(*)"nevery";

313 
g‘£t
.
doc
=(*)"export‚every step";

314 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

317  
v¬
<>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
x´t
->
Ãv”y
);

319 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

321 
V¬API
<> 
	`Ãv”y
("nevery");

322 
Ãv”y
.
logics
[0]=
	`VLogics
("gt",0);

323 
ichk
=
Ãv”y
.
	`£t
(
İ
);

324 if(
ichk
==-1)  -1;

325 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
x´t
->
Ãv”y
òev”y.
v®
;

328 
	}
}

332 
PyObjeù
* 
	gExpÜtMD
::
	$__Ãw__
(
PyTy³Objeù
* 
ty³
,
PyObjeù
* 
¬gs
,PyObjeù* 
kwds
)

334 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
ty³
->
	`_®loc
(type,0));

335 
PyObjeù
* 
£lf
=
»š‹½»t_ÿ¡
<PyObjeù*>(
__£lf
);

336  
£lf
;

337 
	}
}

341 
	gExpÜtMD
::
	$__š™__
(
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)

343 
FuncAPI
<,
¡d
::
¡ršg
*> 
	`f
("__init__",{"nevery","extra_vecs"});

344 
f
.
nİtiÚ®s
=2;

345 
f
.
v®
<0>()=10000;

346 
f
.
logics
<0>()[0]=
	`VLogics
("gt",0);

350 if(
	`f
(
¬gs
,
kwds
)==-1)  -1;

351 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

352 
__£lf
->
x´t
=
Ãw
 
	`ExpÜtMD
({"–em","x"},
f
.
v®
<0>(),f.v®<1>(),f.
v
<1>().
size
);

354 
	}
}

358 
PyObjeù
* 
	gExpÜtMD
::
	$__®loc__
(
PyTy³Objeù
* 
ty³
,
Py_ssize_t
)

360 
Objeù
* 
__£lf
=
Ãw
 Object;

361 
	`Py_TYPE
(
__£lf
)=
ty³
;

362 
	`Py_REFCNT
(
__£lf
)=1;

363 
__£lf
->
x´t
=
NULL
;

364  
»š‹½»t_ÿ¡
<
PyObjeù
*>(
__£lf
);

365 
	}
}

369 
	gExpÜtMD
::
	$__d—Îoc__
(
PyObjeù
* 
£lf
)

371 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

372 
d–‘e
 
__£lf
->
x´t
;

373 
__£lf
->
x´t
=
NULL
;

374 
d–‘e
 
__£lf
;

375 
	}
}

379 
PyObjeù
* 
	gExpÜtMD
::
	$__ÿÎ__
(
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)

381 
FuncAPI
<
OP
<
AtomsMD
>,
¡d
::
¡ršg
> 
	`f
("__call__",{"atoms","file_name"});

383 if(
	`f
(
¬gs
,
kwds
)==-1è 
NULL
;

385 
»š‹½»t_ÿ¡
<
ExpÜtMD
::
Objeù
*>(
£lf
)->
x´t
->
©oms
ôeš‹½»t_ÿ¡<
AtomsMD
::Objeù*>(
f
.
v®
<0>().
ob
)->atoms;

386 
Œy


388 
»š‹½»t_ÿ¡
<
ExpÜtMD
::
Objeù
*>(
£lf
)->
x´t
->
	`wr™e
(
f
.
v®
<1>().
	`c_¡r
());

390 
	`ÿtch
(
¡d
::
¡ršg
& 
”r_msg
)

392 
»š‹½»t_ÿ¡
<
ExpÜtMD
::
Objeù
*>(
£lf
)->
x´t
->
©oms
=
NULL
;

393 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,
”r_msg
.
	`c_¡r
());

394  
NULL
;

397 
»š‹½»t_ÿ¡
<
ExpÜtMD
::
Objeù
*>(
£lf
)->
x´t
->
©oms
=
NULL
;

398 
Py_RETURN_NONE
;

399 
	}
}

401 
PyTy³Objeù
 
	gExpÜtMD
::
Ty³Objeù
={
PyObjeù_HEAD_INIT
(
NULL
)};

403 
	gExpÜtMD
::
	$£tup_
()

405 
Ty³Objeù
.
_Çme
="mapp.md.export";

406 
Ty³Objeù
.
_doc
="export";

408 
Ty³Objeù
.
_æags
=
Py_TPFLAGS_DEFAULT
;

409 
Ty³Objeù
.
_basicsize
=(
Objeù
);

411 
Ty³Objeù
.
_Ãw
=
__Ãw__
;

412 
Ty³Objeù
.
_š™
=
__š™__
;

413 
Ty³Objeù
.
_®loc
=
__®loc__
;

414 
Ty³Objeù
.
_d—Îoc
=
__d—Îoc__
;

415 
Ty³Objeù
.
_ÿÎ
=
__ÿÎ__
;

416 
	`£tup__m‘hods
();

417 
Ty³Objeù
.
_m‘hods
=
m‘hods
;

418 
	`£tup__g‘£t
();

419 
Ty³Objeù
.
_g‘£t
=
g‘£t
;

421 
ichk
=
	`PyTy³_R—dy
(&
Ty³Objeù
);

422 if(
ichk
<0)  ichk;

423 
	`Py_INCREF
(&
Ty³Objeù
);

424  
ichk
;

425 
	}
}

427 
PyG‘S‘Def
 
	gExpÜtMD
::
g‘£t
[]=
Em±yPyG‘S‘Def
(1);

429 
	gExpÜtMD
::
	$£tup__g‘£t
()

431 
	}
}

433 
PyM‘hodDef
 
ExpÜtMD
::
m‘hods
[]=
Em±yPyM‘hodDef
(1);

435 
	gExpÜtMD
::
	$£tup__m‘hods
()

437 
	}
}

441 
PyObjeù
* 
ExpÜtDMD
::
	$__Ãw__
(
PyTy³Objeù
* 
ty³
,
PyObjeù
* 
¬gs
,PyObjeù* 
kwds
)

443 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
ty³
->
	`_®loc
(type,0));

444 
PyObjeù
* 
£lf
=
»š‹½»t_ÿ¡
<PyObjeù*>(
__£lf
);

445  
£lf
;

446 
	}
}

450 
	gExpÜtDMD
::
	$__š™__
(
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)

452 
FuncAPI
<,
¡d
::
¡ršg
*> 
	`f
("__init__",{"nevery","extra_vecs"});

453 
f
.
nİtiÚ®s
=2;

454 
f
.
v®
<0>()=10000;

455 
f
.
logics
<0>()[0]=
	`VLogics
("gt",0);

459 if(
	`f
(
¬gs
,
kwds
)==-1)  -1;

460 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

461 
__£lf
->
x´t
=
Ãw
 
	`ExpÜtDMD
({"x","®pha","c"},
f
.
v®
<0>(),f.v®<1>(),f.
v
<1>().
size
);

463 
	}
}

467 
PyObjeù
* 
	gExpÜtDMD
::
	$__®loc__
(
PyTy³Objeù
* 
ty³
,
Py_ssize_t
)

469 
Objeù
* 
__£lf
=
Ãw
 Object;

470 
	`Py_TYPE
(
__£lf
)=
ty³
;

471 
	`Py_REFCNT
(
__£lf
)=1;

472 
__£lf
->
x´t
=
NULL
;

473  
»š‹½»t_ÿ¡
<
PyObjeù
*>(
__£lf
);

474 
	}
}

478 
	gExpÜtDMD
::
	$__d—Îoc__
(
PyObjeù
* 
£lf
)

480 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

481 
d–‘e
 
__£lf
->
x´t
;

482 
__£lf
->
x´t
=
NULL
;

483 
d–‘e
 
__£lf
;

484 
	}
}

488 
PyObjeù
* 
	gExpÜtDMD
::
	$__ÿÎ__
(
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)

490 
FuncAPI
<
OP
<
AtomsDMD
>,
¡d
::
¡ršg
> 
	`f
("__call__",{"atoms","file_name"});

492 if(
	`f
(
¬gs
,
kwds
)==-1è 
NULL
;

494 
»š‹½»t_ÿ¡
<
ExpÜtDMD
::
Objeù
*>(
£lf
)->
x´t
->
©oms
ôeš‹½»t_ÿ¡<
AtomsDMD
::Objeù*>(
f
.
v®
<0>().
ob
)->atoms;

495 
Œy


497 
»š‹½»t_ÿ¡
<
ExpÜtDMD
::
Objeù
*>(
£lf
)->
x´t
->
	`wr™e
(
f
.
v®
<1>().
	`c_¡r
());

499 
	`ÿtch
(
¡d
::
¡ršg
& 
”r_msg
)

501 
»š‹½»t_ÿ¡
<
ExpÜtDMD
::
Objeù
*>(
£lf
)->
x´t
->
©oms
=
NULL
;

502 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,
”r_msg
.
	`c_¡r
());

503  
NULL
;

506 
»š‹½»t_ÿ¡
<
ExpÜtDMD
::
Objeù
*>(
£lf
)->
x´t
->
©oms
=
NULL
;

507 
Py_RETURN_NONE
;

508 
	}
}

510 
PyTy³Objeù
 
	gExpÜtDMD
::
Ty³Objeù
={
PyObjeù_HEAD_INIT
(
NULL
)};

512 
	gExpÜtDMD
::
	$£tup_
()

514 
Ty³Objeù
.
_Çme
="mapp.dmd.export";

515 
Ty³Objeù
.
_doc
="export";

517 
Ty³Objeù
.
_æags
=
Py_TPFLAGS_DEFAULT
;

518 
Ty³Objeù
.
_basicsize
=(
Objeù
);

520 
Ty³Objeù
.
_Ãw
=
__Ãw__
;

521 
Ty³Objeù
.
_š™
=
__š™__
;

522 
Ty³Objeù
.
_®loc
=
__®loc__
;

523 
Ty³Objeù
.
_d—Îoc
=
__d—Îoc__
;

524 
Ty³Objeù
.
_ÿÎ
=
__ÿÎ__
;

526 
	`£tup__m‘hods
();

527 
Ty³Objeù
.
_m‘hods
=
m‘hods
;

528 
	`£tup__g‘£t
();

529 
Ty³Objeù
.
_g‘£t
=
g‘£t
;

531 
ichk
=
	`PyTy³_R—dy
(&
Ty³Objeù
);

532 if(
ichk
<0)  ichk;

533 
	`Py_INCREF
(&
Ty³Objeù
);

534  
ichk
;

535 
	}
}

537 
PyG‘S‘Def
 
	gExpÜtDMD
::
g‘£t
[]=
Em±yPyG‘S‘Def
(1);

539 
	gExpÜtDMD
::
	$£tup__g‘£t
()

541 
	}
}

543 
PyM‘hodDef
 
ExpÜtDMD
::
m‘hods
[]=
Em±yPyM‘hodDef
(1);

545 
	gExpÜtDMD
::
	$£tup__m‘hods
()

547 
	}
}

	@export.h

1 #iâdeà
__MAPP__expÜt__


2 
	#__MAPP__expÜt__


	)

3 
	~"­i.h
"

4 
	~<io¡»am
>

5 
Çme¥aû
 
	gMAPP_NS


7 şas 
	cExpÜt


9 
	g´iv©e
:

11 
´Ùeùed
:

12 
¡d
::
¡ršg
* 
vec_Çmes
;

13 
şass
 
vec
** 
	gvecs
;

14 
	gnvecs
;

15 
	gndef_vecs
;

16 
	gnu¤_vecs
;

17 
	gndims
;

18 
	gpublic
:

19 
Ãv”y
;

20 
ExpÜt
(
¡d
::
š™Ÿliz”_li¡
<cÚ¡ *>,,¡d::
¡ršg
*,
size_t
);

21 
add_to_deçuÉ
(const *);

22 
	gvœtu®
 ~
ExpÜt
();

23 
g©h”
(
şass
 
vec
**,);

24 
»Ëa£
(
şass
 
vec
**,);

25 
fšd_vecs
(
şass
 
Atoms
*);

27 
boŞ
 
İ’
(cÚ¡ ,
MPI_Comm
&,cÚ¡ *,cÚ¡ *,
FILE
*&);

28 
şo£
(cÚ¡ ,
MPI_Comm
&,
FILE
*&);

33 
PyObjeù_HEAD


34 
ExpÜt
* 
	gx´t
;

35 }
	tObjeù
;

37 
g‘£t_d—fuÉ_vecs
(
PyG‘S‘Def
&);

38 
g‘£t_exŒa_vecs
(
PyG‘S‘Def
&);

39 
g‘£t_Ãv”y
(
PyG‘S‘Def
&);

45 
Çme¥aû
 
	gMAPP_NS


47 şas 
	cExpÜtMD
: 
public
 
ExpÜt


49 
´iv©e
:

51 
´Ùeùed
:

52 
public
:

53 
şass
 
AtomsMD
* 
©oms
;

55 
ExpÜtMD
(
¡d
::
š™Ÿliz”_li¡
<cÚ¡ *>,,¡d::
¡ršg
*,
size_t
);

56 
	gvœtu®
 ~
ExpÜtMD
();

57 
vœtu®
 
š™
(){};

58 
vœtu®
 
wr™e
(){};

59 
vœtu®
 
wr™e
(const *){};

60 
vœtu®
 
fš
(){};

64 
PyObjeù_HEAD


65 
ExpÜtMD
* 
	gx´t
;

66 }
	tObjeù
;

68 
PyTy³Objeù
 
	gTy³Objeù
;

69 
PyObjeù
* 
__Ãw__
(
PyTy³Objeù
*,PyObject*, PyObject*);

70 
__š™__
(
PyObjeù
*, PyObject*,PyObject*);

71 
PyObjeù
* 
__®loc__
(
PyTy³Objeù
*,
Py_ssize_t
);

72 
__d—Îoc__
(
PyObjeù
*);

73 
PyObjeù
* 
__ÿÎ__
(PyObject*,PyObject*,PyObject*);

75 
PyM‘hodDef
 
	gm‘hods
[];

76 
£tup__m‘hods
();

78 
PyG‘S‘Def
 
	gg‘£t
[];

79 
£tup__g‘£t
();

81 
£tup_
();

84 
Çme¥aû
 
	gMAPP_NS


86 şas 
	cExpÜtDMD
: 
public
 
ExpÜt


88 
´iv©e
:

90 
´Ùeùed
:

91 
public
:

92 
şass
 
AtomsDMD
* 
©oms
;

94 
ExpÜtDMD
(
¡d
::
š™Ÿliz”_li¡
<cÚ¡ *>,,¡d::
¡ršg
*,
size_t
);

95 
	gvœtu®
 ~
ExpÜtDMD
();

96 
vœtu®
 
š™
(){};

97 
vœtu®
 
wr™e
(){};

98 
vœtu®
 
wr™e
(const *){};

99 
vœtu®
 
fš
(){};

103 
PyObjeù_HEAD


104 
ExpÜtDMD
* 
	gx´t
;

105 }
	tObjeù
;

107 
PyTy³Objeù
 
	gTy³Objeù
;

108 
PyObjeù
* 
__Ãw__
(
PyTy³Objeù
*,PyObject*, PyObject*);

109 
__š™__
(
PyObjeù
*, PyObject*,PyObject*);

110 
PyObjeù
* 
__®loc__
(
PyTy³Objeù
*,
Py_ssize_t
);

111 
__d—Îoc__
(
PyObjeù
*);

112 
PyObjeù
* 
__ÿÎ__
(PyObject*,PyObject*,PyObject*);

114 
PyM‘hodDef
 
	gm‘hods
[];

115 
£tup__m‘hods
();

117 
PyG‘S‘Def
 
	gg‘£t
[];

118 
£tup__g‘£t
();

120 
£tup_
();

	@export_cfg_dmd.cpp

1 
	~"expÜt_cfg_dmd.h
"

2 
	~"©oms_dmd.h
"

3 
	~"–em’ts.h
"

4 
	~"´št.h
"

8 
	gExpÜtCFGDMD
::
	$ExpÜtCFGDMD
(cÚ¡ 
¡d
::
¡ršg
& 
__·‰”n
,
__Ãv”y
,

9 
¡d
::
¡ršg
* 
u£r_vec_Çmes
,
size_t
 
nu£rvecs
,
boŞ
 
__sÜt
):

10 
	`ExpÜtDMD
({"x","®pha","c"
	}
},
	g__Ãv”y
,
	gu£r_vec_Çmes
,
	gnu£rvecs
),

11 
·‰”n
(
__·‰”n
+".%09d.cfg"),

12 
	$sÜt
(
__sÜt
)

14 if(
sÜt
è
	`add_to_deçuÉ
("id");

15 
	}
}

19 
	gExpÜtCFGDMD
::~
	$ExpÜtCFGDMD
()

21 
	}
}

25 
ExpÜtCFGDMD
::
	$wr™e_h—d”
(
FILE
* 
å
)

27 if(
©oms
->
comm_¿nk
) ;

29 
	`årštf
(
å
,"Numb” oà·¹işe ğ%d\n",
©oms
->
Çtms
);

30 
	`årštf
(
å
,"A = %.16lf Angstrom (basic†ength-scale)\n",1.0);

32 
i
=0;i<
__dim__
;i++)

33 
j
=0;j<
__dim__
;j++)

34 
	`årštf
(
å
,"H0(%d,%dèğ%.16làA\n",
i
+1,
j
+1,
©oms
->
H
[i][j]);

36 
	`årštf
(
å
,".NO_VELOCITY.\n");

37 
ÃËms
=
¡©ic_ÿ¡
<>(
©oms
->
–em’ts
.nelems);

39 if(
sÜt
)

40 
	`årštf
(
å
,"’Œy_couÁ = %d\n",
ndims
-1);

42 
	`årštf
(
å
,"’Œy_couÁ = %d\n",
ndims
);

44 
icmp
=0;

45 
i
=0;i<
ÃËms
;i++)

46 
	`årštf
(
å
,"auxŸry[%d] = %s_%d [»duûd un™]\n",
icmp
++,"®pha",
i
);

47 
i
=0;i<
ÃËms
;i++)

48 
	`årštf
(
å
,"auxŸry[%d] = %s_%d [»duûd un™]\n",
icmp
++,"c",
i
);

50 
vec
** 
u¤_vecs
=
vecs
+
ndef_vecs
;

52 
i
=0;i<
nu¤_vecs
;i++)

54 
d
=
u¤_vecs
[
i
]->
	`ndim_dump
();

55 
j
=0;j<
d
;j++)

56 
	`årštf
(
å
,"auxŸry[%d] = %s_%d [»duûd un™]\n",
icmp
++,
u¤_vecs
[
i
]->
Çme
,
j
);

58 
	}
}

62 
	gExpÜtCFGDMD
::
	$wr™e_body_sÜt
(
FILE
* 
å
)

64 
	`g©h”
(
vecs
,
nvecs
);

66 if(
©oms
->
comm_¿nk
==0)

68 
©oms
->
	`x2s_dump
();

69 
Çtms
=
©oms
->natms;

70 * 
id
=
©oms
->id->
	`begš_dump
();

71 * 
id_m­
=
Çtms
==0 ? 
NULL
:
Ãw
 [natms];

72 
i
=0;i<
Çtms
;i++è
id_m­
[
id
[i]]=i;

74 
¡d
::
¡ršg
* 
–em_Çmes
=
©oms
->
–em’ts
.
Çmes
;

75 
ty³0
* 
mas£s
=
©oms
->
–em’ts
.masses;

76 
ÃËms
=
¡©ic_ÿ¡
<>(
©oms
->
–em’ts
.nelems);

77 
ty³0
* 
c
=
©oms
->c->
	`begš_dump
();

78 
ty³0
* 
__c
=
c
;

79 
Ÿtm
;

81 
vec
** 
u¤_vecs
=
vecs
+
ndef_vecs
;

83 
cu¼_–em
,
__cu¼_–em
;

84 
fœ¡_–em
=-1;

85 if(
Çtms
è
fœ¡_–em
=
	`max_pos
(
c
,
ÃËms
);

86 
i
=0;i<
ÃËms
;i++)

87 if(
i
!=
fœ¡_–em
è
	`årštf
(
å
,"%lf\n%s\n",
mas£s
[i],
–em_Çmes
[i].
	`c_¡r
());

88 
cu¼_–em
=-1;

89 
i
=0;i<
Çtms
;i++)

91 
Ÿtm
=
id_m­
[
i
];

93 
__c
=
c
+
Ÿtm
*
ÃËms
;

94 
__cu¼_–em
=
	`max_pos
(
__c
, 
ÃËms
);

96 if(
__cu¼_–em
!=
cu¼_–em
)

98 
cu¼_–em
=
__cu¼_–em
;

99 
	`årštf
(
å
,"%lf\n",
mas£s
[
cu¼_–em
]);

100 
	`årštf
(
å
,"%s\n",
–em_Çmes
[
cu¼_–em
].
	`c_¡r
());

103 
©oms
->
x
->
	`´št
(
å
,
Ÿtm
);

104 
©oms
->
®pha
->
	`´št
(
å
,
Ÿtm
);

105 
©oms
->
c
->
	`´št
(
å
,
Ÿtm
);

107 
j
=0;j<
nu¤_vecs
;j++)

108 
u¤_vecs
[
j
]->
	`´št
(
å
,
Ÿtm
);

110 
	`årštf
(
å
,"\n");

114 
d–‘e
 [] 
id_m­
;

118 
	`»Ëa£
(
vecs
,
nvecs
);

119 
	}
}

123 
	gExpÜtCFGDMD
::
	$wr™e_body
(
FILE
* 
å
)

125 
	`g©h”
(
vecs
,
nvecs
);

127 if(
©oms
->
comm_¿nk
==0)

129 
©oms
->
	`x2s_dump
();

130 
Çtms
=
©oms
->natms;

131 
¡d
::
¡ršg
* 
–em_Çmes
=
©oms
->
–em’ts
.
Çmes
;

132 
ty³0
* 
mas£s
=
©oms
->
–em’ts
.masses;

133 
ÃËms
=
¡©ic_ÿ¡
<>(
©oms
->
–em’ts
.nelems);

134 
ty³0
* 
c
=
©oms
->c->
	`begš_dump
();

135 
ty³0
* 
__c
;

136 
vec
** 
u¤_vecs
=
vecs
+
ndef_vecs
;

138 
cu¼_–em
,
__cu¼_–em
;

139 
fœ¡_–em
=-1;

140 if(
Çtms
è
fœ¡_–em
=
	`max_pos
(
c
,
ÃËms
);

141 
i
=0;i<
ÃËms
;i++)

142 if(
i
!=
fœ¡_–em
è
	`årštf
(
å
,"%lf\n%s\n",
mas£s
[i],
–em_Çmes
[i].
	`c_¡r
());

143 
cu¼_–em
=-1;

145 
i
=0;i<
Çtms
;i++)

147 
__c
=
c
+
i
*
ÃËms
;

148 
__cu¼_–em
=
	`max_pos
(
__c
, 
ÃËms
);

150 if(
__cu¼_–em
!=
cu¼_–em
)

152 
cu¼_–em
=
__cu¼_–em
;

153 
	`årštf
(
å
,"%lf\n",
mas£s
[
cu¼_–em
]);

154 
	`årštf
(
å
,"%s\n",
–em_Çmes
[
cu¼_–em
].
	`c_¡r
());

157 
©oms
->
x
->
	`´št
(
å
,
i
);

158 
©oms
->
®pha
->
	`´št
(
å
,
i
);

159 
©oms
->
c
->
	`´št
(
å
,
i
);

160 
j
=0;j<
nu¤_vecs
;j++)

161 
u¤_vecs
[
j
]->
	`´št
(
å
,
i
);

163 
	`årštf
(
å
,"\n");

168 
	`»Ëa£
(
vecs
,
nvecs
);

169 
	}
}

173 
	gExpÜtCFGDMD
::
	$wr™e
(
¡ps
)

175 
FILE
* 
å
;

176 * 
fe_Çme
=
Pršt
::
	`v´štf
(
·‰”n
.
	`c_¡r
(),
¡ps
);

177 
boŞ
 
fe_chk
=
	`İ’
(
©oms
->
comm_¿nk
,©oms->
wÜld
,
fe_Çme
,"w",
å
);

178 
d–‘e
 [] 
fe_Çme
;

179 if(!
fe_chk
) ;

182 
	`wr™e_h—d”
(
å
);

183 if(
sÜt
è
	`wr™e_body_sÜt
(
å
);

184 
	`wr™e_body
(
å
);

186 
	`şo£
(
©oms
->
comm_¿nk
,©oms->
wÜld
,
å
);

187 
	}
}

191 
	gExpÜtCFGDMD
::
	$wr™e
(cÚ¡ * 
fe_Çme
)

193 
Œy


195 
	`š™
();

197 
	`ÿtch
(
¡d
::
¡ršg
& 
”r_msg
)

199 
	`fš
();

200 
throw
 
”r_msg
;

203 
FILE
* 
å
;

204 
boŞ
 
fe_chk
=
	`İ’
(
©oms
->
comm_¿nk
,©oms->
wÜld
,
fe_Çme
,"w",
å
);

205 if(!
fe_chk
)

207 
	`fš
();

211 
	`wr™e_h—d”
(
å
);

212 if(
sÜt
è
	`wr™e_body_sÜt
(
å
);

213 
	`wr™e_body
(
å
);

215 
	`şo£
(
©oms
->
comm_¿nk
,©oms->
wÜld
,
å
);

217 
	`fš
();

218 
	}
}

222 
	gExpÜtCFGDMD
::
	$š™
()

224 
Œy


226 
	`fšd_vecs
(
©oms
);

228 
	`ÿtch
(
¡d
::
¡ršg
& 
”r_msg
)

230 
throw
 
”r_msg
;

232 
	}
}

236 
	gExpÜtCFGDMD
::
	$fš
()

239 
	}
}

243 
PyObjeù
* 
ExpÜtCFGDMD
::
	$__Ãw__
(
PyTy³Objeù
* 
ty³
,
PyObjeù
* 
¬gs
,PyObjeù* 
kwds
)

245 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
ty³
->
	`_®loc
(type,0));

246 
PyObjeù
* 
£lf
=
»š‹½»t_ÿ¡
<PyObjeù*>(
__£lf
);

247  
£lf
;

248 
	}
}

252 
	gExpÜtCFGDMD
::
	$__š™__
(
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)

254 
FuncAPI
<
¡d
::
¡ršg
,,¡d::¡ršg*,
boŞ
> 
	`f
("__init__",{"file_pattern","nevery","extra_vecs","sort"});

255 
f
.
nİtiÚ®s
=3;

256 
f
.
logics
<1>()[0]=
	`VLogics
("gt",0);

258 
f
.
v®
<3>()=
çl£
;

259 
f
.
v®
<1>()=10000;

261 if(
	`f
(
¬gs
,
kwds
)==-1)  -1;

262 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

263 
__£lf
->
x´t
=
Ãw
 
	`ExpÜtCFGDMD
(
f
.
v®
<0>(),f.v®<1>(),f.v®<2>(),f.
v
<2>().
size
,f.val<3>());

265 
	}
}

269 
PyObjeù
* 
	gExpÜtCFGDMD
::
	$__®loc__
(
PyTy³Objeù
* 
ty³
,
Py_ssize_t
)

271 
Objeù
* 
__£lf
=
Ãw
 Object;

272 
	`Py_TYPE
(
__£lf
)=
ty³
;

273 
	`Py_REFCNT
(
__£lf
)=1;

274 
__£lf
->
x´t
=
NULL
;

275  
»š‹½»t_ÿ¡
<
PyObjeù
*>(
__£lf
);

276 
	}
}

280 
	gExpÜtCFGDMD
::
	$__d—Îoc__
(
PyObjeù
* 
£lf
)

282 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

283 
d–‘e
 
__£lf
->
x´t
;

284 
__£lf
->
x´t
=
NULL
;

285 
d–‘e
 
__£lf
;

286 
	}
}

288 
PyTy³Objeù
 
	gExpÜtCFGDMD
::
Ty³Objeù
={
PyObjeù_HEAD_INIT
(
NULL
)};

290 
	gExpÜtCFGDMD
::
	$£tup_
()

292 
Ty³Objeù
.
_Çme
="mapp.dmd.export_cfg";

293 
Ty³Objeù
.
_doc
="export‡tomeye";

295 
Ty³Objeù
.
_æags
=
Py_TPFLAGS_DEFAULT
;

296 
Ty³Objeù
.
_basicsize
=(
Objeù
);

298 
Ty³Objeù
.
_Ãw
=
__Ãw__
;

299 
Ty³Objeù
.
_š™
=
__š™__
;

300 
Ty³Objeù
.
_®loc
=
__®loc__
;

301 
Ty³Objeù
.
_d—Îoc
=
__d—Îoc__
;

302 
Ty³Objeù
.
_ÿÎ
=
__ÿÎ__
;

303 
	`£tup__m‘hods
();

304 
Ty³Objeù
.
_m‘hods
=
m‘hods
;

305 
	`£tup__g‘£t
();

306 
Ty³Objeù
.
_g‘£t
=
g‘£t
;

307 
Ty³Objeù
.
_ba£
=&
ExpÜtDMD
::TypeObject;

309 
ichk
=
	`PyTy³_R—dy
(&
Ty³Objeù
);

310 if(
ichk
<0)  ichk;

311 
	`Py_INCREF
(&
Ty³Objeù
);

312  
ichk
;

313 
	}
}

315 
PyG‘S‘Def
 
	gExpÜtCFGDMD
::
g‘£t
[]=
Em±yPyG‘S‘Def
(1);

317 
	gExpÜtCFGDMD
::
	$£tup__g‘£t
()

319 
	}
}

321 
PyM‘hodDef
 
ExpÜtCFGDMD
::
m‘hods
[]=
Em±yPyM‘hodDef
(1);

323 
	gExpÜtCFGDMD
::
	$£tup__m‘hods
()

325 
	}
}

	@export_cfg_dmd.h

1 #iâdeà
__MAPP__expÜt_cfg_dmd__


2 
	#__MAPP__expÜt_cfg_dmd__


	)

3 
	~"expÜt.h
"

5 
Çme¥aû
 
	gMAPP_NS


7 şas 
	cExpÜtCFGDMD
:
public
 
ExpÜtDMD


9 
´iv©e
:

10 
max_pos
(
ty³0
*& 
c
,cÚ¡ & 
ÃËms
)

12 
ty³0
 
	gmax_c
=*
c
;

13 
	g›Ëm
=0;

14 
	gi
=1;i<
	gÃËms
;i++)

15 if(
	gmax_c
<
	gc
[
i
])

17 
	gmax_c
=
c
[
i
];

18 
	g›Ëm
=
i
;

21  
	g›Ëm
;

24 
	g¡d
::
¡ršg
 
·‰”n
;

25 
boŞ
 
	gsÜt
;

27 
wr™e_h—d”
(
FILE
*);

28 
wr™e_body_sÜt
(
FILE
*);

29 
wr™e_body
(
FILE
*);

30 
	g´Ùeùed
:

31 
public
:

32 
ExpÜtCFGDMD
(cÚ¡ 
¡d
::
¡ršg
&,,¡d::¡ršg*,
size_t
,
boŞ
);

33 ~
ExpÜtCFGDMD
();

35 
š™
();

36 
wr™e
();

37 
wr™e
(const *);

38 
fš
();

42 
PyObjeù_HEAD


43 
ExpÜtCFGDMD
* 
	gx´t
;

44 }
	tObjeù
;

46 
PyTy³Objeù
 
	gTy³Objeù
;

47 
PyObjeù
* 
__Ãw__
(
PyTy³Objeù
*,PyObject*, PyObject*);

48 
__š™__
(
PyObjeù
*, PyObject*,PyObject*);

49 
PyObjeù
* 
__®loc__
(
PyTy³Objeù
*,
Py_ssize_t
);

50 
__d—Îoc__
(
PyObjeù
*);

52 
PyM‘hodDef
 
	gm‘hods
[];

53 
£tup__m‘hods
();

55 
PyG‘S‘Def
 
	gg‘£t
[];

56 
£tup__g‘£t
();

58 
£tup_
();

	@export_cfg_md.cpp

1 
	~"expÜt_cfg_md.h
"

2 
	~"©oms_md.h
"

3 
	~"–em’ts.h
"

4 
	~"´št.h
"

5 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

9 
	gExpÜtCFGMD
::
	$ExpÜtCFGMD
(cÚ¡ 
¡d
::
¡ršg
& 
__·‰”n
,
__Ãv”y
,

10 
¡d
::
¡ršg
* 
u£r_vec_Çmes
,
size_t
 
nu£rvecs
,
boŞ
 
__sÜt
):

11 
	`ExpÜtMD
({"–em","x"
	}
},
	g__Ãv”y
,
	gu£r_vec_Çmes
,
	gnu£rvecs
),

12 
·‰”n
(
__·‰”n
+".%09d.cfg"),

13 
	$sÜt
(
__sÜt
)

15 if(
sÜt
è
	`add_to_deçuÉ
("id");

16 
	}
}

20 
	gExpÜtCFGMD
::~
	$ExpÜtCFGMD
()

22 
	}
}

26 
ExpÜtCFGMD
::
	$wr™e_h—d”
(
FILE
* 
å
)

28 if(
©oms
->
comm_¿nk
) ;

30 
	`årštf
(
å
,"Numb” oà·¹işe ğ%d\n",
©oms
->
Çtms
);

31 
	`årštf
(
å
,"A = %.16lf Angstrom (basic†ength-scale)\n",1.0);

33 
i
=0;i<
__dim__
;i++)

34 
j
=0;j<
__dim__
;j++)

35 
	`årštf
(
å
,"H0(%d,%dèğ%.16làA\n",
i
+1,
j
+1,
©oms
->
H
[i][j]);

38 if(
x_d_šc
)

39 
	`årštf
(
å
,"R = 1.0\n");

41 
	`årštf
(
å
,".NO_VELOCITY.\n");

43 if(
sÜt
)

44 
	`årštf
(
å
,"’Œy_couÁ = %d\n",
ndims
-2);

46 
	`årštf
(
å
,"’Œy_couÁ = %d\n",
ndims
-1);

48 
vec
** 
u¤_vecs
=
vecs
+
ndef_vecs
;

49 
icmp
=0;

50 
i
=0;i<
nu¤_vecs
;i++)

52 if(
u¤_vecs
[
i
]==
©oms
->
x_d
) ;

53 
d
=
u¤_vecs
[
i
]->
	`ndim_dump
();

54 
j
=0;j<
d
;j++)

55 
	`årštf
(
å
,"auxŸry[%d] = %s_%d [»duûd un™]\n",
icmp
++,
u¤_vecs
[
i
]->
Çme
,
j
);

57 
	}
}

61 
	gExpÜtCFGMD
::
	$wr™e_body_sÜt
(
FILE
* 
å
)

63 
	`g©h”
(
vecs
,
nvecs
);

65 if(
©oms
->
comm_¿nk
==0)

67 
©oms
->
	`x2s_dump
();

68 if(
x_d_šc
è
©oms
->
	`x_d2s_d_dump
();

69 
Çtms
=
©oms
->natms;

70 * 
id
=
©oms
->id->
	`begš_dump
();

71 * 
id_m­
=
Çtms
==0 ? 
NULL
:
Ãw
 [natms];

72 
i
=0;i<
Çtms
;i++è
id_m­
[
id
[i]]=i;

74 
¡d
::
¡ršg
* 
–em_Çmes
=
©oms
->
–em’ts
.
Çmes
;

75 
ty³0
* 
mas£s
=
©oms
->
–em’ts
.masses;

76 
–em_ty³
* 
–em
=
©oms
->–em->
	`begš_dump
();

77 
cu¼_–em
=-1;

78 
__cu¼_–em
;

79 
Ÿtm
;

81 
vec
** 
u¤_vecs
=
vecs
+
ndef_vecs
;

82 
i
=0;i<
Çtms
;i++)

84 
Ÿtm
=
id_m­
[
i
];

86 
__cu¼_–em
=
–em
[
Ÿtm
];

87 if(
__cu¼_–em
!=
cu¼_–em
)

89 
cu¼_–em
=
__cu¼_–em
;

90 
	`årštf
(
å
,"%lf\n",
mas£s
[
cu¼_–em
]);

91 
	`årštf
(
å
,"%s\n",
–em_Çmes
[
cu¼_–em
].
	`c_¡r
());

94 
©oms
->
x
->
	`´št
(
å
,
Ÿtm
);

96 
j
=0;j<
nu¤_vecs
;j++)

97 
u¤_vecs
[
j
]->
	`´št
(
å
,
Ÿtm
);

99 
	`årštf
(
å
,"\n");

101 
d–‘e
 [] 
id_m­
;

104 
	`»Ëa£
(
vecs
,
nvecs
);

105 
	}
}

109 
	gExpÜtCFGMD
::
	$wr™e_body
(
FILE
* 
å
)

111 
	`g©h”
(
vecs
,
nvecs
);

113 if(
©oms
->
comm_¿nk
==0)

115 
©oms
->
	`x2s_dump
();

116 if(
x_d_šc
è
©oms
->
	`x_d2s_d_dump
();

117 
Çtms
=
©oms
->natms;

119 
¡d
::
¡ršg
* 
–em_Çmes
=
©oms
->
–em’ts
.
Çmes
;

120 
ty³0
* 
mas£s
=
©oms
->
–em’ts
.masses;

121 
–em_ty³
* 
–em
=
©oms
->–em->
	`begš_dump
();

122 
cu¼_–em
=-1;

123 
__cu¼_–em
;

125 
vec
** 
u¤_vecs
=
vecs
+
ndef_vecs
;

126 
i
=0;i<
Çtms
;i++)

129 
__cu¼_–em
=
–em
[
i
];

130 if(
__cu¼_–em
!=
cu¼_–em
)

132 
cu¼_–em
=
__cu¼_–em
;

133 
	`årštf
(
å
,"%lf\n",
mas£s
[
cu¼_–em
]);

134 
	`årštf
(
å
,"%s\n",
–em_Çmes
[
cu¼_–em
].
	`c_¡r
());

137 
©oms
->
x
->
	`´št
(
å
,
i
);

139 
j
=0;j<
nu¤_vecs
;j++)

140 
u¤_vecs
[
j
]->
	`´št
(
å
,
i
);

142 
	`årštf
(
å
,"\n");

146 
	`»Ëa£
(
vecs
,
nvecs
);

147 
	}
}

151 
	gExpÜtCFGMD
::
	$š™
()

153 
Œy


155 
	`fšd_vecs
(
©oms
);

157 
	`ÿtch
(
¡d
::
¡ršg
& 
”r_msg
)

159 
throw
 
”r_msg
;

162 
x_d_šc
=
çl£
;

163 
i
=0;i<
nvecs
 && !
x_d_šc
;i++)

164 if(
¡d
::
	`¡rcmp
(
vec_Çmes
[
i
].
	`c_¡r
(),"x_d")==0)

165 
x_d_šc
=
Œue
;

166 
	}
}

170 
	gExpÜtCFGMD
::
	$fš
()

173 
	}
}

177 
ExpÜtCFGMD
::
	$wr™e
(
¡ps
)

179 
FILE
* 
å
;

180 * 
fe_Çme
=
Pršt
::
	`v´štf
(
·‰”n
.
	`c_¡r
(),
¡ps
);

181 
boŞ
 
fe_chk
=
	`İ’
(
©oms
->
comm_¿nk
,©oms->
wÜld
,
fe_Çme
,"w",
å
);

182 
d–‘e
 [] 
fe_Çme
;

183 if(!
fe_chk
) ;

186 
	`wr™e_h—d”
(
å
);

187 if(
sÜt
è
	`wr™e_body_sÜt
(
å
);

188 
	`wr™e_body
(
å
);

190 
	`şo£
(
©oms
->
comm_¿nk
,©oms->
wÜld
,
å
);

191 
	}
}

195 
	gExpÜtCFGMD
::
	$wr™e
(cÚ¡ * 
fe_Çme
)

197 
Œy


199 
	`š™
();

201 
	`ÿtch
(
¡d
::
¡ršg
& 
”r_msg
)

203 
	`fš
();

204 
throw
 
”r_msg
;

207 
FILE
* 
å
;

208 
boŞ
 
fe_chk
=
	`İ’
(
©oms
->
comm_¿nk
,©oms->
wÜld
,
fe_Çme
,"w",
å
);

209 if(!
fe_chk
)

211 
	`fš
();

215 
	`wr™e_h—d”
(
å
);

216 if(
sÜt
è
	`wr™e_body_sÜt
(
å
);

217 
	`wr™e_body
(
å
);

219 
	`şo£
(
©oms
->
comm_¿nk
,©oms->
wÜld
,
å
);

221 
	`fš
();

222 
	}
}

226 
PyObjeù
* 
	gExpÜtCFGMD
::
	$__Ãw__
(
PyTy³Objeù
* 
ty³
,
PyObjeù
* 
¬gs
,PyObjeù* 
kwds
)

228 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
ty³
->
	`_®loc
(type,0));

229 
PyObjeù
* 
£lf
=
»š‹½»t_ÿ¡
<PyObjeù*>(
__£lf
);

230  
£lf
;

231 
	}
}

235 
	gExpÜtCFGMD
::
	$__š™__
(
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)

237 
FuncAPI
<
¡d
::
¡ršg
,,¡d::¡ršg*,
boŞ
> 
	`f
("__init__",{"file_pattern","nevery","extra_vecs","sort"});

238 
f
.
nİtiÚ®s
=3;

239 
f
.
logics
<1>()[0]=
	`VLogics
("gt",0);

240 
f
.
v®
<3>()=
çl£
;

241 
f
.
v®
<1>()=10000;

243 if(
	`f
(
¬gs
,
kwds
)==-1)  -1;

244 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

245 
__£lf
->
x´t
=
Ãw
 
	`ExpÜtCFGMD
(
f
.
v®
<0>(),f.v®<1>(),f.v®<2>(),f.
v
<2>().
size
,f.val<3>());

247 
	}
}

251 
PyObjeù
* 
	gExpÜtCFGMD
::
	$__®loc__
(
PyTy³Objeù
* 
ty³
,
Py_ssize_t
)

253 
Objeù
* 
__£lf
=
Ãw
 Object;

254 
	`Py_TYPE
(
__£lf
)=
ty³
;

255 
	`Py_REFCNT
(
__£lf
)=1;

256 
__£lf
->
x´t
=
NULL
;

257  
»š‹½»t_ÿ¡
<
PyObjeù
*>(
__£lf
);

258 
	}
}

262 
	gExpÜtCFGMD
::
	$__d—Îoc__
(
PyObjeù
* 
£lf
)

264 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

265 
d–‘e
 
__£lf
->
x´t
;

266 
__£lf
->
x´t
=
NULL
;

267 
d–‘e
 
__£lf
;

268 
	}
}

270 
PyTy³Objeù
 
	gExpÜtCFGMD
::
Ty³Objeù
={
PyObjeù_HEAD_INIT
(
NULL
)};

272 
	gExpÜtCFGMD
::
	$£tup_
()

274 
Ty³Objeù
.
_Çme
="mapp.md.export_cfg";

275 
Ty³Objeù
.
_doc
="export‡tomeye";

277 
Ty³Objeù
.
_æags
=
Py_TPFLAGS_DEFAULT
;

278 
Ty³Objeù
.
_basicsize
=(
Objeù
);

280 
Ty³Objeù
.
_Ãw
=
__Ãw__
;

281 
Ty³Objeù
.
_š™
=
__š™__
;

282 
Ty³Objeù
.
_®loc
=
__®loc__
;

283 
Ty³Objeù
.
_d—Îoc
=
__d—Îoc__
;

284 
Ty³Objeù
.
_ÿÎ
=
__ÿÎ__
;

285 
	`£tup__m‘hods
();

286 
Ty³Objeù
.
_m‘hods
=
m‘hods
;

287 
	`£tup__g‘£t
();

288 
Ty³Objeù
.
_g‘£t
=
g‘£t
;

289 
Ty³Objeù
.
_ba£
=&
ExpÜtMD
::TypeObject;

291 
ichk
=
	`PyTy³_R—dy
(&
Ty³Objeù
);

292 if(
ichk
<0)  ichk;

293 
	`Py_INCREF
(&
Ty³Objeù
);

294  
ichk
;

295 
	}
}

297 
PyG‘S‘Def
 
	gExpÜtCFGMD
::
g‘£t
[]=
Em±yPyG‘S‘Def
(3);

299 
	gExpÜtCFGMD
::
	$£tup__g‘£t
()

301 
	`g‘£t_d—fuÉ_vecs
(
g‘£t
[0]);

302 
	`g‘£t_exŒa_vecs
(
g‘£t
[1]);

303 
	}
}

305 
PyM‘hodDef
 
	gExpÜtCFGMD
::
m‘hods
[]=
Em±yPyM‘hodDef
(1);

307 
	gExpÜtCFGMD
::
	$£tup__m‘hods
()

309 
	}
}

	@export_cfg_md.h

1 #iâdeà
__MAPP__expÜt_cfg_md__


2 
	#__MAPP__expÜt_cfg_md__


	)

3 
	~"expÜt.h
"

5 
Çme¥aû
 
	gMAPP_NS


7 şas 
	cExpÜtCFGMD
:
public
 
ExpÜtMD


9 
´iv©e
:

11 
¡d
::
¡ršg
 
·‰”n
;

12 
boŞ
 
	gsÜt
;

13 
boŞ
 
	gx_d_šc
;

14 
wr™e_h—d”
(
FILE
*);

15 
wr™e_body_sÜt
(
FILE
*);

16 
wr™e_body
(
FILE
*);

17 
	g´Ùeùed
:

18 
public
:

19 
ExpÜtCFGMD
(cÚ¡ 
¡d
::
¡ršg
&,,¡d::¡ršg*,
size_t
,
boŞ
);

20 ~
ExpÜtCFGMD
();

22 
š™
();

23 
wr™e
();

24 
wr™e
(const *);

25 
fš
();

29 
PyObjeù_HEAD


30 
ExpÜtCFGMD
* 
	gx´t
;

31 }
	tObjeù
;

33 
PyTy³Objeù
 
	gTy³Objeù
;

34 
PyObjeù
* 
__Ãw__
(
PyTy³Objeù
*,PyObject*, PyObject*);

35 
__š™__
(
PyObjeù
*, PyObject*,PyObject*);

36 
PyObjeù
* 
__®loc__
(
PyTy³Objeù
*,
Py_ssize_t
);

37 
__d—Îoc__
(
PyObjeù
*);

39 
PyM‘hodDef
 
	gm‘hods
[];

40 
£tup__m‘hods
();

42 
PyG‘S‘Def
 
	gg‘£t
[];

43 
£tup__g‘£t
();

45 
£tup_
();

	@export_styles.h

1 
	~"expÜt_cfg_md.h
"

2 
	~"expÜt_cfg_dmd.h
"

	@ff.cpp

5 
	~"ff.h
"

6 
	~"MAPP.h
"

7 
	~"–em’ts.h
"

8 
	~"tim”.h
"

9 
	~"memÜy.h
"

10 
	~"©oms.h
"

11 
	~"comm.h
"

12 
	~"xm©h.h
"

13 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

17 
	gFÜûF›ld
::
	$FÜûF›ld
(
Atoms
* 
__©oms
):

18 
	`ÃËms
(
__©oms
->
–em’ts
.
ÃËms
),

19 
	`wÜld
(
__©oms
->
comm
.
wÜld
)

21 
MemÜy
::
	`®loc
(
cut
,
ÃËms
,nelems);

22 
MemÜy
::
	`®loc
(
cut_sq
,
ÃËms
,nelems);

23 
MemÜy
::
	`®loc
(
cut_sk_sq
,
ÃËms
,nelems);

24 
MemÜy
::
	`®loc
(
rsq_üd
,
ÃËms
);

25 
	}
}

29 
	gFÜûF›ld
::~
	$FÜûF›ld
()

31 
MemÜy
::
	`d—Îoc
(
rsq_üd
);

32 
MemÜy
::
	`d—Îoc
(
cut_sk_sq
);

33 
MemÜy
::
	`d—Îoc
(
cut_sq
);

34 
MemÜy
::
	`d—Îoc
(
cut
);

35 
	}
}

	@ff.h

5 #iâdeà
__MAPP__ff__


6 
	#__MAPP__ff__


	)

7 
	~"glob®.h
"

8 
	~"comm.h
"

9 
	~"©oms.h
"

10 
	~"exchªge.h
"

11 
Çme¥aû
 
	gMAPP_NS


13 şas 
	cFÜûF›ld


15 
	g´iv©e
:

16 
´Ùeùed
:

17 
Upd©e
* 
updt
;

18 #ifdeà
OLD_UPDATE


19 
upd©e
(
vec
* 
__v
)

21 
	gupdt
->
upd©e
(
__v
,
çl£
);

24 
	g‹m¶©e
<
	gşass
...
	gVS
>

25 
upd©e
(
VS
*&... 
__vs
)

27 
	gupdt
->
upd©e_wo_x
(
__vs
...);

30 cÚ¡ 
size_t
 
	gÃËms
;

31 
vœtu®
 
__fÜû_ÿlc
()=0;

32 
vœtu®
 
__’”gy_ÿlc
()=0;

34 
ty³0
 
	g__vec
[
__nvoigt__
+1];

35 
ty³0
 
	g__vec_lş
[
__nvoigt__
+1];

37 
	gMPI_Comm
& 
	gwÜld
;

38 
	gpublic
:

39 
FÜûF›ld
(
Atoms
*);

40 
	gvœtu®
 ~
FÜûF›ld
();

43 
vœtu®
 
´e_š™
()=0;

44 
vœtu®
 
po¡_fš
()=0;

45 
vœtu®
 
š™
()=0;

46 
vœtu®
 
fš
()=0;

47 
ty³0
* 
	grsq_üd
;

48 
ty³0
** 
	gcut
;

49 
ty³0
** 
	gcut_sq
;

50 
ty³0
** 
	gcut_sk_sq
;

53 
vœtu®
 
ty³0
 
v®ue
()=0;

54 
vœtu®
 
ty³0
* 
d”iv©ive
()=0;

	@ff_dmd.cpp

1 
	~"ff_dmd.h
"

2 
	~"©oms_dmd.h
"

3 
	~"ÃighbÜ_dmd.h
"

4 
	~"xm©h.h
"

5 
	~"memÜy.h
"

6 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

10 
	gFÜûF›ldDMD
::
	$FÜûF›ldDMD
(
AtomsDMD
* 
__©oms
):

11 
	`FÜûF›ld
(
__©oms
),

12 
	`©oms
(
__©oms
),

13 
	`ave_mu
(
NULL
),

14 
	`rsq_üd
(
NULL
),

15 
	$r_üd
(
NULL
)

17 
MemÜy
::
	`®loc
(
ave_mu
,
ÃËms
);

18 
MemÜy
::
	`®loc
(
cut_sk
,
ÃËms
,nelems);

19 
MemÜy
::
	`®loc
(
rsq_üd
,
ÃËms
);

20 
MemÜy
::
	`®loc
(
r_üd
,
ÃËms
);

21 
ÃighbÜ
=
Ãw
 
	`NeighbÜDMD
(
__©oms
,
cut_sk
,
rsq_üd
);

22 
f
=
Ãw
 
Vec
<
ty³0
>(
©oms
,
__dim__
,"f");

23 
f_®pha
=
Ãw
 
DMDVec
<
ty³0
>(
©oms
,0.0,"f_alpha");

24 
c_d
=
Ãw
 
DMDVec
<
ty³0
>(
©oms
,0.0,"c_d");

25 
mu
=
Ãw
 
DMDVec
<
ty³0
>(
©oms
,0.0,"mu");

26 
	}
}

30 
	gFÜûF›ldDMD
::~
	$FÜûF›ldDMD
()

32 
d–‘e
 
mu
;

33 
d–‘e
 
c_d
;

34 
d–‘e
 
f_®pha
;

35 
d–‘e
 
f
;

36 
d–‘e
 
ÃighbÜ
;

37 
MemÜy
::
	`d—Îoc
(
r_üd
);

38 
MemÜy
::
	`d—Îoc
(
rsq_üd
);

39 
MemÜy
::
	`d—Îoc
(
cut_sk
);

40 
MemÜy
::
	`d—Îoc
(
ave_mu
);

41 
	}
}

45 
	gFÜûF›ldDMD
::
	$ÿlc_ndof
()

47 
nx_dof
=
©oms
->
Çtms
*
__dim__
;

48 if(!
©oms
->
x_dof
->
	`is_em±y
())

50 cÚ¡ 
n
=
©oms
->
Çtms_lş
*
__dim__
;

51 
nx_dof_lş
=
n
;

52 
boŞ
* 
x_dof
=
©oms
->x_dof->
	`begš
();

53 
i
=0;i<
n
;i++èif(!
x_dof
[i]è
nx_dof_lş
--;

54 
	`MPI_AÎ»duû
(&
nx_dof_lş
,&
nx_dof
,1,
Vec
<>::
MPI_T
,
MPI_SUM
,
wÜld
);

57 
ÇÍha_dof
=
©oms
->
Çtms
*©oms->
c_dim
;

58 if(!
©oms
->
®pha_dof
->
	`is_em±y
())

60 cÚ¡ 
n
=
©oms
->
Çtms_lş
*©oms->
c_dim
;

61 
ÇÍha_dof_lş
=
n
;

62 
boŞ
* 
®pha_dof
=
©oms
->®pha_dof->
	`begš
();

63 
i
=0;i<
n
;i++èif(!
®pha_dof
[i]è
ÇÍha_dof_lş
--;

64 
	`MPI_AÎ»duû
(&
ÇÍha_dof_lş
,&
ÇÍha_dof
,1,
Vec
<>::
MPI_T
,
MPI_SUM
,
wÜld
);

68 
nc_dof
=
©oms
->
Çtms
*©oms->
c_dim
;

69 if(!
©oms
->
c_dof
->
	`is_em±y
())

71 cÚ¡ 
n
=
©oms
->
Çtms_lş
*©oms->
c_dim
;

72 
nc_dof_lş
=
n
;

73 
boŞ
* 
c_dof
=
©oms
->c_dof->
	`begš
();

74 
i
=0;i<
n
;i++èif(!
c_dof
[i]è
nc_dof_lş
--;

75 
	`MPI_AÎ»duû
(&
nc_dof_lş
,&
nc_dof
,1,
Vec
<>::
MPI_T
,
MPI_SUM
,
wÜld
);

77 
	}
}

81 
	gFÜûF›ldDMD
::
	$»£t
()

83 
ty³0
* 
__f
=
f
->
	`begš
();

84 cÚ¡ 
n
=
©oms
->
Çtms_lş
*
__dim__
;

85 
i
=0;i<
n
;i++è
__f
[i]=0.0;

86 
__f
=
f_®pha
->
	`begš
();

87 cÚ¡ 
m
=
©oms
->
Çtms_lş
*
c_dim
;

88 
i
=0;i<
m
;i++è
__f
[i]=0.0;

89 
i
=0;i<
__nvoigt__
+2;i++è
__vec_lş
[i]=0.0;

90 
	}
}

94 
	gFÜûF›ldDMD
::
	$impo£_dof
(
ty³0
* 
__f
,ty³0* 
__f_®pha
)

96 if(!
dof_em±y
)

98 
boŞ
* 
dof
=
©oms
->
x_dof
->
	`begš
();

99 cÚ¡ 
n
=
©oms
->
Çtms_lş
*
__dim__
;

100 
i
=0;i<
n
;i++è
__f
[i]=
dof
[i] ? __f[i]:0.0;

103 if(!
dof_®pha_em±y
)

105 
boŞ
* 
dof
=
©oms
->
®pha_dof
->
	`begš
();

106 cÚ¡ 
n
=
©oms
->
Çtms_lş
*
c_dim
;

107 
i
=0;i<
n
;i++è
__f_®pha
[i]=
dof
[i] ? __f_alpha[i]:0.0;

109 
	}
}

113 
ty³0
 
	gFÜûF›ldDMD
::
	$nÜm_sq
(
ty³0
* 
__f
,ty³0* 
__f_®pha
)

115 
ty³0
 
”r_lş
=0.0,
”r
;

116 
n
=
©oms
->
Çtms_lş
*
__dim__
;

117 
i
=0;i<
n
;i++è
”r_lş
+=
__f
[i]*__f[i];

118 
n
=
©oms
->
Çtms_lş
*
c_dim
;

119 
i
=0;i<
n
;i++è
”r_lş
+=
__f_®pha
[i]*__f_alpha[i];

121 
	`MPI_AÎ»duû
(&
”r_lş
,&
”r
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

122  
”r
;

123 
	}
}

127 
	gFÜûF›ldDMD
::
	$»£t_c_d
()

129 
ty³0
* 
__c_d
=
c_d
->
	`begš
();

130 cÚ¡ 
n
=
©oms
->
Çtms_lş
*
c_dim
;

131 
i
=0;i<
n
;i++è
__c_d
[i]=0.0;

132 
	}
}

136 
	gFÜûF›ldDMD
::
	$´e_š™
()

138 
dof_em±y
=
©oms
->
x_dof
->
	`is_em±y
();

139 
dof_®pha_em±y
=
©oms
->
®pha_dof
->
	`is_em±y
();

140 
dof_c_em±y
=
©oms
->
c_dof
->
	`is_em±y
();

142 
ty³0
 
tmp
;

143 
max_cut
=0.0;

144 
size_t
 
i
=0;i<
ÃËms
;i++)

146 
size_t
 
j
=0;j<
i
+1;j++)

148 
tmp
=
cut
[
i
][
j
];

149 
max_cut
=
	`MAX
(max_cut,
tmp
);

150 
cut_sq
[
i
][
j
]=cut_sq[j][i]=
tmp
*tmp;

151 
tmp
+=
©oms
->
comm
.
skš
;

152 
cut_sk
[
i
][
j
]=cut_sk[j][i]=
tmp
;

153 
cut_sk_sq
[
i
][
j
]=cut_sk_sq[j][i]=
tmp
*tmp;

155 
rsq_üd
[
i
]=
r_üd
[i]*r_crd[i];

157 
c_dim
=
©oms
->
c
->
dim
;

158 
	}
}

162 
	gFÜûF›ldDMD
::
	$po¡_fš
()

164 
	}
}

168 
ty³0
 
FÜûF›ldDMD
::
	$v®ue
()

171 
__vec_lş
[0]=__vec_lş[1+
__nvoigt__
]=0.0;

172 
	`__’”gy_ÿlc
();

173 
ty³0
 
’
;

174 
	`MPI_AÎ»duû
(&
__vec_lş
[0],&
’
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

176  
’
;

177 
	}
}

181 
ty³0
* 
	gFÜûF›ldDMD
::
	$d”iv©ive
()

183 
	`»£t
();

184 
	`__fÜû_ÿlc
();

185 
	`MPI_AÎ»duû
(
__vec_lş
,
__vec
,
__nvoigt__
+2,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

186 
Algeb¿
::
Do
<
__nvoigt__
>::
	`func
([
this
](
i
){
__vec
[i+1]*=-1.0;});

187 
Algeb¿
::
	`DyadicV_2_MSY
(
__vec
+1,
F_H
);

188 
©oms
->
ã
=
__vec
[0];

189 
ty³0
 
vŞ_Ãg
=-
©oms
->
vŞ
;

190 
Algeb¿
::
Do
<
__nvoigt__
>::
	`func
([
this
,&
vŞ_Ãg
](
i
){
__vec
[i+1]/=vol_neg;});

191 
Algeb¿
::
	`DyadicV_2_MSY
(
__vec
+1,
©oms
->
S_ã
);

192 
©oms
->
s
=
__vec
[1+
__nvoigt__
];

194 
	`impo£_dof
(
f
->
	`begš
(),
f_®pha
->begin());

195  
__vec
;

196 
	}
}

197 
	~"dyÇmic_dmd.h
"

201 
	gFÜûF›ldDMD
::
	$ÿlc_th”mo
()

203 
DyÇmicDMD
 
	`__dyÇmic
(
©oms
,
this
,
çl£
,{},{},{});

204 
__dyÇmic
.
	`š™
();

205 
	`ÿlc_ndof
();

206 
	`d”iv©ive
();

210 
ty³0
* 
mu_sum_lş
=
NULL
;

211 
MemÜy
::
	`®loc
(
mu_sum_lş
,
ÃËms
);

212 
size_t
 
i
=0;i<
ÃËms
;i++è
mu_sum_lş
[i]=
ave_mu
[i]=0.0;

214 
ty³0
* 
sum_lş
=
NULL
;

215 
ty³0
* 
sum
=
NULL
;

216 
MemÜy
::
	`®loc
(
sum_lş
,
ÃËms
);

217 
MemÜy
::
	`®loc
(
sum
,
ÃËms
);

218 
size_t
 
i
=0;i<
ÃËms
;i++è
sum_lş
[i]=
sum
[i]=0.0;

221 
ty³0
* 
mu_vec
=
mu
->
	`begš
();

222 
ty³0
 cÚ¡* 
c
=
©oms
->c->
	`begš
();

223 
–em_ty³
 cÚ¡* 
–em_vec
=
©oms
->
–em
->
	`begš
();

224 cÚ¡ 
n
=
©oms
->
Çtms_lş
*
c_dim
;

225 
i
=0;i<
n
;i++)

226 if(
c
[
i
]!=-1.0)

228 
mu_sum_lş
[
–em_vec
[
i
]]+=
mu_vec
[i];

229 ++
sum_lş
[
–em_vec
[
i
]];

231 
	`MPI_AÎ»duû
(
mu_sum_lş
,
ave_mu
,
¡©ic_ÿ¡
<>(
ÃËms
),
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

232 
	`MPI_AÎ»duû
(
sum_lş
,
sum
,
¡©ic_ÿ¡
<>(
ÃËms
),
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

233 
size_t
 
i
=0;i<
ÃËms
;i++èif(
sum
[i]!=0.0è
ave_mu
[i]/=sum[i];

235 
MemÜy
::
	`d—Îoc
(
sum_lş
);

236 
MemÜy
::
	`d—Îoc
(
sum
);

237 
MemÜy
::
	`d—Îoc
(
mu_sum_lş
);

239 
__dyÇmic
.
	`fš
();

242 
	}
}

338 
	gFÜûF›ldDMD
::
	$fÜû_ÿlc_¡©ic
()

340 
	`»£t
();

341 
	`__fÜû_ÿlc_¡©ic
();

342 
	`MPI_AÎ»duû
(
__vec_lş
,
__vec
,
__nvoigt__
+2,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

343 
Algeb¿
::
Do
<
__nvoigt__
>::
	`func
([
this
](
i
){
__vec
[i+1]*=-1.0;});

344 
Algeb¿
::
	`DyadicV_2_MSY
(
__vec
+1,
F_H
);

345 
©oms
->
ã
=
__vec
[0];

346 
ty³0
 
vŞ_Ãg
=-
©oms
->
vŞ
;

347 
Algeb¿
::
Do
<
__nvoigt__
>::
	`func
([
this
,&
vŞ_Ãg
](
i
){
__vec
[i+1]/=vol_neg;});

348 
Algeb¿
::
	`DyadicV_2_MSY
(
__vec
+1,
©oms
->
S_ã
);

349 
©oms
->
s
=
__vec
[1+
__nvoigt__
];

351 
	`impo£_dof
(
f
->
	`begš
(),
f_®pha
->begin());

352 
	}
}

356 
	gFÜûF›ldDMD
::
	$c_d_ÿlc
()

358 
	`»£t_c_d
();

359 
	`__c_d_ÿlc
();

361 
	`impo£_dof
(
f
->
	`begš
(),
f_®pha
->begin());

362 
”r
=
	`sq¹
(
	`nÜm_sq
(
f
->
	`begš
(),
f_®pha
->begin()));

363 
	}
}

367 
ty³0
 
	gFÜûF›ldDMD
::
	$c_dd_nÜm
()

369 
	`»£t_c_d
();

370 
	`__c_d_ÿlc
();

371 
	`__J
(
c_d
,
f_®pha
);

372 
n
=
©oms
->
Çtms_lş
*
c_dim
;

373 
ty³0
* 
__f_®pha
=
f_®pha
->
	`begš
();

374 
ty³0
 
nÜm_lş
=0.0;

375 
i
=0;i<
n
;i++)

376 
nÜm_lş
+=
__f_®pha
[
i
]*__f_alpha[i];

377 
ty³0
 
nÜm
;

378 
	`MPI_AÎ»duû
(&
nÜm_lş
,&
nÜm
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

379  
	`sq¹
(
nÜm
);

380 
	}
}

384 
	gFÜûF›ldDMD
::
J
(
Vec
<
ty³0
>* 
x
,Vec<ty³0>* 
Jx
)

386 
__J
(
x
,
Jx
);

391 
ty³0
* 
	gFÜûF›ldDMD
::
J
(
Vec
<ty³0>* 
x_±r
,Vec<ty³0>* 
®pha_±r
,Vec<ty³0>* 
Jx_±r
,Vec<ty³0>* 
J®pha_±r
)

393 
	gAlgeb¿
::
z”o
<
__nvoigt__
+2>(
__vec_lş
);

394 
__J
(
x_±r
,
®pha_±r
,
Jx_±r
,
J®pha_±r
);

395 
impo£_dof
(
Jx_±r
->
begš
(),
J®pha_±r
->begin());

396 
MPI_AÎ»duû
(
__vec_lş
,
__vec
,
__nvoigt__
,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

397  
	g__vec
;

402 
ty³0
 
	gFÜûF›ldDMD
::
´•J_n_»s
(
Vec
<ty³0>* 
x_±r
,Vec<ty³0>* 
®pha_±r
)

404 
	gAlgeb¿
::
z”o
<
__nvoigt__
+2>(
__vec_lş
);

405 
__´•J_n_»s
(
x_±r
,
®pha_±r
);

406 
MPI_AÎ»duû
(
__vec_lş
,
__vec
,
__nvoigt__
+2,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

407 
	gAlgeb¿
::
Do
<
__nvoigt__
>::
func
([
this
](
i
){
__vec
[i+1]*=-1.0;});

408 
	gAlgeb¿
::
DyadicV_2_MSY
(
__vec
+1,
F_H
);

409 
	g©oms
->
	gã
=
__vec
[0];

410 
ty³0
 
	gvŞ_Ãg
=-
©oms
->
vŞ
;

411 
	gAlgeb¿
::
Do
<
__nvoigt__
>::
func
([
this
,&
vŞ_Ãg
](
i
){
__vec
[i+1]/=vol_neg;});

412 
	gAlgeb¿
::
DyadicV_2_MSY
(
__vec
+1,
©oms
->
S_ã
);

413 
	g©oms
->
	gs
=
__vec
[1+
__nvoigt__
];

415 
impo£_dof
(
x_±r
->
begš
(),
®pha_±r
->begin());

416 
ty³0
 
	g”r_sq
=
nÜm_sq
(
x_±r
->
begš
(),
®pha_±r
->begin());

417 
	g”r
=
sq¹
(
”r_sq
);

418  
	g”r_sq
;

	@ff_dmd.h

1 #iâdeà
__MAPP__ff_dmd__


2 
	#__MAPP__ff_dmd__


	)

3 
	~"ff.h
"

4 
Çme¥aû
 
	gMAPP_NS


6 
	g‹m¶©e
<
	gşass
> 
şass
 
	gDMDVec
;

7 şas 
	cFÜûF›ldDMD
 : 
public
 
FÜûF›ld


9 
ä›nd
 
şass
 
DyÇmicDMD
;

10 
	g‹m¶©e
<
	gboŞ
,bool,bool>

11 
ä›nd
 
şass
 
	gNewDyÇmicDMD
;

12 
	g´iv©e
:

13 
»£t
();

14 
»£t_c_d
();

15 
	g´Ùeùed
:

16 
ty³0
 
__vec
[
__nvoigt__
+2];

17 
ty³0
 
	g__vec_lş
[
__nvoigt__
+2];

18 
şass
 
AtomsDMD
* 
	g©oms
;

20 
´e_š™
();

21 
po¡_fš
();

22 
impo£_dof
(
ty³0
*,type0*);

23 
ty³0
 
nÜm_sq
(type0*,type0*);

25 
vœtu®
 
__fÜû_ÿlc_¡©ic
()=0;

26 
vœtu®
 
__c_d_ÿlc
()=0;

27 
vœtu®
 
__J
(
Vec
<
ty³0
>*,Vec<type0>*)=0;

28 
vœtu®
 
__J
(
Vec
<
ty³0
>*,Vec<type0>*,Vec<type0>*,Vec<type0>*)=0;

29 
vœtu®
 
__´•J_n_»s
(
Vec
<
ty³0
>*,Vec<type0>*)=0;

30 
	gpublic
:

31 
boŞ
 
dof_em±y
,
	gdof_®pha_em±y
,
	gdof_c_em±y
;

33 
ty³0
 
	gmax_cut
;

34 
şass
 
NeighbÜDMD
* 
	gÃighbÜ
;

35 
	gc_dim
;

36 
ty³0
* 
	grsq_üd
;

37 
ty³0
* 
	gr_üd
;

38 
ty³0
** 
	gcut_sk
;

39 
ty³0
* 
	gave_mu
;

40 
	gVec
<
	gty³0
>* 
	gf
;

41 
	gDMDVec
<
	gty³0
>* 
	gf_®pha
;

42 
	gDMDVec
<
	gty³0
>* 
	gc_d
;

43 
	gDMDVec
<
	gty³0
>* 
	gmu
;

44 
ty³0
 
	gF_H
[
__dim__
][__dim__];

47 
FÜûF›ldDMD
(
şass
 
AtomsDMD
*);

48 
	gvœtu®
 ~
FÜûF›ldDMD
();

50 
fÜû_ÿlc_tim”
();

52 
ty³0
 
v®ue
();

53 
ty³0
* 
d”iv©ive
();

58 
vœtu®
 
š™_¡©ic
()=0;

59 
vœtu®
 
fš_¡©ic
()=0;

60 
fÜû_ÿlc_¡©ic
();

61 
c_d_ÿlc
();

62 
ty³0
 
c_dd_nÜm
();

63 
J
(
Vec
<
ty³0
>*,Vec<type0>*);

67 
vœtu®
 
ty³0
 
´•J_n_»s
(
Vec
<type0>*,Vec<type0>*);

68 
ty³0
* 
J
(
Vec
<type0>*,Vec<type0>*,Vec<type0>*,Vec<type0>*);

70 
ÿlc_th”mo
();

71 
ty³0
 
	g”r
;

72 
ty³0
 
	gc_d_nÜm
;

74 
ÿlc_ndof
();

75 
	gnx_dof
,
	gÇÍha_dof
,
	gnc_dof
;

	@ff_eam.cpp

1 
	~"ff_—m.h
"

2 
	~"ÃighbÜ_md.h
"

3 
	~"©oms_md.h
"

4 
	~"–em’ts.h
"

5 
	~"memÜy.h
"

6 
	~"­i.h
"

7 
	~"impÜt_—m.h
"

8 
	~"dyÇmic_md.h
"

9 
	~"gcmc.h
"

10 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

14 
	gFÜûF›ldEAM
::
FÜûF›ldEAM
(
AtomsMD
* 
©oms
,

15 
ty³0
 
__dr
,ty³0 
__drho
,
size_t
 
__Ä
,size_ˆ
__Äho
,

16 
ty³0
(***&& 
__r_phi_¬r
)[4],ty³0(***&& 
__rho_¬r
)[4],ty³0(**&& 
__F_¬r
)[4],

17 
ty³0
**&& 
__cut
):

18 
FÜûF›ldMD
(
©oms
),

19 
max_·œs
(0),

20 
drhoi_dr
(
NULL
),

21 
drhoj_dr
(
NULL
),

22 
dr
(
__dr
),

23 
drho
(
__drho
),

24 
Ä
(
__Ä
),

25 
Äho
(
__Äho
),

26 
r_phi_¬r
(
__r_phi_¬r
),

27 
rho_¬r
(
__rho_¬r
),

28 
	$F_¬r
(
__F_¬r
)

30 
gcmc_n_cutoff
=2;

31 
gcmc_n_v¬s
=2;

32 
gcmc_g_’abËd
=
Œue
;

34 
__r_phi_¬r
=
NULL
;

35 
__rho_¬r
=
NULL
;

36 
__F_¬r
=
NULL
;

38 
size_t
 
i
=0;i<
ÃËms
;i++)

39 
size_t
 
j
=0;j<
i
+1;j++)

41 
cut
[
i
][
j
]=cut[j][i]=
__cut
[i][j];

42 
cut_sq
[
i
][
j
]=cut_sq[j][i]=
__cut
[i][j]*__cut[i][j];

44 
MemÜy
::
	`d—Îoc
(
__cut
);

46 
dr_šv
=1.0/
dr
;

47 
drho_šv
=1.0/
drho
;

48 
rho_max
=
¡©ic_ÿ¡
<
ty³0
>(
Äho
)*
drho
;

49 
	}
}

53 
	gFÜûF›ldEAM
::~
	$FÜûF›ldEAM
()

55 
MemÜy
::
	`d—Îoc
(
drhoj_dr
);

56 
MemÜy
::
	`d—Îoc
(
drhoi_dr
);

57 
MemÜy
::
	`d—Îoc
(
F_¬r
);

58 
MemÜy
::
	`d—Îoc
(
rho_¬r
);

59 
MemÜy
::
	`d—Îoc
(
r_phi_¬r
);

60 
	}
}

64 
	gFÜûF›ldEAM
::
	$__fÜû_ÿlc
()

66 if(
max_·œs
<
ÃighbÜ
->
no_·œs
)

68 
MemÜy
::
	`d—Îoc
(
drhoj_dr
);

69 
MemÜy
::
	`d—Îoc
(
drhoi_dr
);

70 
max_·œs
=
ÃighbÜ
->
no_·œs
;

71 
MemÜy
::
	`®loc
(
drhoi_dr
,
max_·œs
);

72 
MemÜy
::
	`®loc
(
drhoj_dr
,
max_·œs
);

75 
ty³0
* 
xvec
=
©oms
->
x
->
	`begš
();

76 
ty³0
* 
fvec
=
f
->
	`begš
();

77 
–em_ty³
* 
evec
=
©oms
->
–em
->
	`begš
();

78 
ty³0
* 
rho
=
rho_±r
->
	`begš
();

79 
ty³0
* 
dF
=
dF_±r
->
	`begš
();

81 
Ÿtm
,
j©m
;

82 
icomp
,
jcomp
;

83 
–em_ty³
 
›Ëm
,
j–em
;

84 
ty³0
 
dx0
,
dx1
,
dx2
,
rsq
,
z2p
,
z2
;

85 
ty³0
 
r
,
p
,
r_šv
,
åaœ
,
tmp0
,
tmp1
;

86 
ty³0
 
drho_i_dr
,
drho_j_dr
,
dphi_dr
;

87 
ty³0
 
rho_i
,
rho_j
,
phi
;

88 
size_t
 
m
,
i¡¬t
;

89 
ty³0
* 
cÛf
;

91 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->neighbor_list;

92 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->neighbor_list_size;

94 cÚ¡ 
Çtms_lş
=
©oms
->natms_lcl;

95 
Ÿtm
=0;Ÿtm<
Çtms_lş
;Ÿtm++è
rho
[iatm]=0.0;

97 
i¡¬t
=0;

98 
Ÿtm
=0;Ÿtm<
Çtms_lş
;iatm++)

100 
›Ëm
=
evec
[
Ÿtm
];

101 
icomp
=3*
Ÿtm
;

102 
j
=0;j<
ÃighbÜ_li¡_size
[
Ÿtm
];j++)

104 
j©m
=
ÃighbÜ_li¡
[
Ÿtm
][
j
];

105 
j–em
=
evec
[
j©m
];

107 
jcomp
=3*
j©m
;

108 
dx0
=
xvec
[
icomp
]-xvec[
jcomp
];

109 
dx1
=
xvec
[
icomp
+1]-xvec[
jcomp
+1];

110 
dx2
=
xvec
[
icomp
+2]-xvec[
jcomp
+2];

111 
rsq
=
dx0
*dx0+
dx1
*dx1+
dx2
*dx2;

112 
drhoi_dr
[
i¡¬t
]=
drhoj_dr
[istart]=0.0;

114 if(
rsq
>=
cut_sq
[
›Ëm
][
j–em
])

116 
i¡¬t
++;

120 
r
=
	`sq¹
(
rsq
);

121 
r_šv
=1.0/
r
;

122 
p
=
r
*
dr_šv
;

123 
m
=
¡©ic_ÿ¡
<
size_t
>(
p
);

124 
m
=
	`MIN
(m,
Ä
-2);

126 
p
-=
m
;

127 
p
=
	`MIN
(p,1.0);

129 
cÛf
=
rho_¬r
[
j–em
][
›Ëm
][
m
];

130 
rho_i
=((
cÛf
[3]*
p
+coef[2])*p+coef[1])*p+coef[0];

131 
drho_i_dr
=((3.0*
cÛf
[3]*
p
+2.0*cÛf[2])*p+cÛf[1])*
dr_šv
;

132 
cÛf
=
rho_¬r
[
›Ëm
][
j–em
][
m
];

133 
rho_j
=((
cÛf
[3]*
p
+coef[2])*p+coef[1])*p+coef[0];

134 
drho_j_dr
=((3.0*
cÛf
[3]*
p
+2.0*cÛf[2])*p+cÛf[1])*
dr_šv
;

136 
cÛf
=
r_phi_¬r
[
›Ëm
][
j–em
][
m
];

137 
z2p
=((3.0*
cÛf
[3]*
p
+2.0*cÛf[2])*p+cÛf[1])*
dr_šv
;

138 
z2
=((
cÛf
[3]*
p
+coef[2])*p+coef[1])*p+coef[0];

140 
phi
=
z2
*
r_šv
;

141 
dphi_dr
=
z2p
*
r_šv
-
phi
*r_inv;

143 
rho
[
Ÿtm
]+=
rho_i
;

144 if(
j©m
<
Çtms_lş
)

145 
rho
[
j©m
]+=
rho_j
;

147 
åaœ
=-
dphi_dr
*
r_šv
;

149 
fvec
[
icomp
]+=
åaœ
*
dx0
;

150 
fvec
[
icomp
+1]+=
åaœ
*
dx1
;

151 
fvec
[
icomp
+2]+=
åaœ
*
dx2
;

153 if(
j©m
<
Çtms_lş
)

155 
fvec
[
jcomp
]-=
åaœ
*
dx0
;

156 
fvec
[
jcomp
+1]-=
åaœ
*
dx1
;

157 
fvec
[
jcomp
+2]-=
åaœ
*
dx2
;

160 if(
j©m
>=
Çtms_lş
)

162 
åaœ
*=0.5;

163 
phi
*=0.5;

166 
__vec_lş
[0]+=
phi
;

167 
__vec_lş
[1]-=
åaœ
*
dx0
*dx0;

168 
__vec_lş
[2]-=
åaœ
*
dx0
*
dx1
;

169 
__vec_lş
[3]-=
åaœ
*
dx0
*
dx2
;

170 
__vec_lş
[4]-=
åaœ
*
dx1
*dx1;

171 
__vec_lş
[5]-=
åaœ
*
dx1
*
dx2
;

172 
__vec_lş
[6]-=
åaœ
*
dx2
*dx2;

174 
drhoi_dr
[
i¡¬t
]=-
drho_i_dr
*
r_šv
;

175 
drhoj_dr
[
i¡¬t
]=-
drho_j_dr
*
r_šv
;

177 
i¡¬t
++;

179 
p
=
rho
[
Ÿtm
]*
drho_šv
;

180 
m
=
¡©ic_ÿ¡
<
size_t
>(
p
);

181 
m
=
	`MIN
(m,
Äho
-2);

182 
p
-=
m
;

183 
p
=
	`MIN
(p,1.0);

184 
cÛf
=
F_¬r
[
›Ëm
][
m
];

185 
tmp1
=((3.0*
cÛf
[3]*
p
+2.0*cÛf[2])*p+cÛf[1])*
drho_šv
;

186 
tmp0
=((
cÛf
[3]*
p
+coef[2])*p+coef[1])*p+coef[0];

187 if(
rho
[
Ÿtm
]>
rho_max
)

188 
tmp0
+=
tmp1
*(
rho
[
Ÿtm
]-
rho_max
);

189 
__vec_lş
[0]+=
tmp0
;

190 
dF
[
Ÿtm
]=
tmp1
;

193 
	`upd©e
(
dF_±r
);

196 
i¡¬t
=0;

197 
Ÿtm
=0;Ÿtm<
Çtms_lş
;iatm++)

199 
›Ëm
=
evec
[
Ÿtm
];

200 
icomp
=3*
Ÿtm
;

201 
j
=0;j<
ÃighbÜ_li¡_size
[
Ÿtm
];j++)

203 if(
drhoi_dr
[
i¡¬t
]!=0.0 || 
drhoj_dr
[istart]!=0.0)

205 
j©m
=
ÃighbÜ_li¡
[
Ÿtm
][
j
];

206 
j–em
=
evec
[
j©m
];

207 
jcomp
=3*
j©m
;

209 
åaœ
=
dF
[
Ÿtm
]*
drhoi_dr
[
i¡¬t
]+dF[
j©m
]*
drhoj_dr
[istart];

211 
dx0
=
xvec
[
icomp
]-xvec[
jcomp
];

212 
dx1
=
xvec
[
icomp
+1]-xvec[
jcomp
+1];

213 
dx2
=
xvec
[
icomp
+2]-xvec[
jcomp
+2];

215 
fvec
[
icomp
]+=
dx0
*
åaœ
;

216 
fvec
[
icomp
+1]+=
dx1
*
åaœ
;

217 
fvec
[
icomp
+2]+=
dx2
*
åaœ
;

219 if(
j©m
<
Çtms_lş
)

221 
fvec
[
jcomp
]-=
dx0
*
åaœ
;

222 
fvec
[
jcomp
+1]-=
dx1
*
åaœ
;

223 
fvec
[
jcomp
+2]-=
dx2
*
åaœ
;

226 if(
j©m
>=
Çtms_lş
)

227 
åaœ
*=0.5;

229 
__vec_lş
[1]-=
åaœ
*
dx0
*dx0;

230 
__vec_lş
[2]-=
åaœ
*
dx0
*
dx1
;

231 
__vec_lş
[3]-=
åaœ
*
dx0
*
dx2
;

232 
__vec_lş
[4]-=
åaœ
*
dx1
*dx1;

233 
__vec_lş
[5]-=
åaœ
*
dx1
*
dx2
;

234 
__vec_lş
[6]-=
åaœ
*
dx2
*dx2;

236 
i¡¬t
++;

239 
	}
}

243 
	gFÜûF›ldEAM
::
	$__’”gy_ÿlc
()

245 
ty³0
* 
xvec
=
©oms
->
x
->
	`begš
();

246 
ty³0
* 
rho
=
rho_±r
->
	`begš
();

247 
–em_ty³
* 
evec
=
©oms
->
–em
->
	`begš
();

249 
Ÿtm
,
j©m
;

250 
icomp
,
jcomp
;

251 
–em_ty³
 
›Ëm
,
j–em
;

252 
ty³0
 
dx0
,
dx1
,
dx2
,
rsq
;

253 
ty³0
 
r
,
p
,
phi
,
tmp0
;

254 
size_t
 
m
;

255 
ty³0
* 
cÛf
;

257 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->neighbor_list;

258 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->neighbor_list_size;

259 cÚ¡ 
Çtms_lş
=
©oms
->natms_lcl;

260 
Ÿtm
=0;Ÿtm<
Çtms_lş
;Ÿtm++è
rho
[iatm]=0.0;

262 
Ÿtm
=0;Ÿtm<
Çtms_lş
;iatm++)

264 
›Ëm
=
evec
[
Ÿtm
];

265 
icomp
=3*
Ÿtm
;

266 
j
=0;j<
ÃighbÜ_li¡_size
[
Ÿtm
];j++)

268 
j©m
=
ÃighbÜ_li¡
[
Ÿtm
][
j
];

269 
j–em
=
evec
[
j©m
];

271 
jcomp
=3*
j©m
;

272 
dx0
=
xvec
[
icomp
]-xvec[
jcomp
];

273 
dx1
=
xvec
[
icomp
+1]-xvec[
jcomp
+1];

274 
dx2
=
xvec
[
icomp
+2]-xvec[
jcomp
+2];

275 
rsq
=
dx0
*dx0+
dx1
*dx1+
dx2
*dx2;

277 if(
rsq
<
cut_sq
[
›Ëm
][
j–em
])

279 
r
=
	`sq¹
(
rsq
);

281 
p
=
r
*
dr_šv
;

282 
m
=
¡©ic_ÿ¡
<
size_t
>(
p
);

283 
m
=
	`MIN
(m,
Ä
-2);

284 
p
-=
m
;

285 
p
=
	`MIN
(p,1.0);

287 
cÛf
=
r_phi_¬r
[
›Ëm
][
j–em
][
m
];

288 
phi
=(((
cÛf
[3]*
p
+cÛf[2])*p+cÛf[1])*p+cÛf[0])/
r
;

290 
cÛf
=
rho_¬r
[
j–em
][
›Ëm
][
m
];

291 
rho
[
Ÿtm
]+=((
cÛf
[3]*
p
+coef[2])*p+coef[1])*p+coef[0];

292 if(
j©m
<
Çtms_lş
)

294 
cÛf
=
rho_¬r
[
›Ëm
][
j–em
][
m
];

295 
rho
[
j©m
]+=((
cÛf
[3]*
p
+coef[2])*p+coef[1])*p+coef[0];

296 
__vec_lş
[0]+=
phi
;

299 
__vec_lş
[0]+=0.5*
phi
;

305 
p
=
rho
[
Ÿtm
]*
drho_šv
;

306 
m
=
¡©ic_ÿ¡
<
size_t
>(
p
);

307 
m
=
	`MIN
(m,
Äho
-2);

308 
p
-=
m
;

309 
p
=
	`MIN
(p,1.0);

310 
cÛf
=
F_¬r
[
›Ëm
][
m
];

311 
tmp0
=((
cÛf
[3]*
p
+coef[2])*p+coef[1])*p+coef[0];

312 if(
rho
[
Ÿtm
]>
rho_max
)

313 
tmp0
+=((3.0*
cÛf
[3]*
p
+2.0*cÛf[2])*p+cÛf[1])*
drho_šv
*(
rho
[
Ÿtm
]-
rho_max
);

314 
__vec_lş
[0]+=
tmp0
;

317 
	}
}

322 
	gFÜûF›ldEAM
::
	$´e_xchng_’”gy
(
GCMC
* 
gcmc
)

324 & 
icomm
=
gcmc
->icomm;

325 
ty³0
 
’
;

326 
ty³0
 
rho_Ÿtm_lş
;

328 & 
Ÿtm
=
gcmc
->iatm;

329 
–em_ty³
& 
›Ëm
=
gcmc
->ielem;

331 & 
j©m
=
gcmc
->jatm;

332 
–em_ty³
& 
j–em
=
gcmc
->jelem;

334 
ty³0
&
rsq
=
gcmc
->rsq;

336 
ty³0
 
r
,
p
;

337 
size_t
 
m
;

338 
ty³0
* 
cÛf
;

339 
ty³0
 
c0
=1.0,
’0
=0.0;

341 
ty³0
* 
rho
=
rho_±r
->
	`begš
();

342 
ty³0
* 
rho_xchng
=
rho_xchng_±r
->
	`begš
();

343 * 
g
=
gcmc
->
g_vec_p
->
	`begš
();

344 cÚ¡ 
Çtms_lş
=
©oms
->natms_lcl;

345 
i
=0;i<
Çtms_lş
;i++)

346 
rho_xchng
[
i
]=
rho
[i];

348 
gcmc
->
	`»£t_icomm
();
icomm
!=-1;gcmc->
	`Ãxt_icomm
())

350 
c0
=1.0;

351 if(
gcmc
->
xchng_mode
==
DEL_MODE
è
c0
=-1.0;

352 if(
gcmc
->
xchng_mode
==
NOEX_MODE
) ;

354 
’
=
rho_Ÿtm_lş
=0.0;

355 
gcmc
->
	`»£t_Ÿtm
();
Ÿtm
!=-1;gcmc->
	`Ãxt_Ÿtm
())

356 
gcmc
->
	`»£t_j©m
();
j©m
!=-1;gcmc->
	`Ãxt_j©m
())

358 
r
=
	`sq¹
(
rsq
);

360 
p
=
r
*
dr_šv
;

361 
m
=
¡©ic_ÿ¡
<
size_t
>(
p
);

362 
m
=
	`MIN
(m,
Ä
-2);

363 
p
-=
m
;

364 
p
=
	`MIN
(p,1.0);

366 
cÛf
=
r_phi_¬r
[
›Ëm
][
j–em
][
m
];

368 if(
j©m
<
Çtms_lş
)

370 
’
+=(((
cÛf
[3]*
p
+cÛf[2])*p+cÛf[1])*p+cÛf[0])/
r
;

371 
cÛf
=
rho_¬r
[
›Ëm
][
j–em
][
m
];

372 
rho_xchng
[
j©m
]+=
c0
*(((
cÛf
[3]*
p
+coef[2])*p+coef[1])*p+coef[0]);

375 
’
+=0.5*(((
cÛf
[3]*
p
+cÛf[2])*p+cÛf[1])*p+cÛf[0])/
r
;

378 
cÛf
=
rho_¬r
[
j–em
][
›Ëm
][
m
];

379 
rho_Ÿtm_lş
+=((
cÛf
[3]*
p
+coef[2])*p+coef[1])*p+coef[0];

384 
ty³0
* 
F
=
F_±r
->
	`begš
();

385 
ty³0
* 
F_xchng
=
F_xchng_±r
->
	`begš
();

386 
–em_ty³
* 
evec
=
©oms
->
–em
->
	`begš
();

388 
ty³0
 
tmp0
;

389 
’0
=0.0;

390 
i
=0;i<
Çtms_lş
;i++)

391 if(
g
[
i
]==
icomm
)

393 
tmp0
=
rho_xchng
[
i
];

394 
p
=
tmp0
*
drho_šv
;

395 
m
=
¡©ic_ÿ¡
<
size_t
>(
p
);

396 
m
=
	`MIN
(m,
Äho
-2);

397 
p
-=
m
;

398 
p
=
	`MIN
(p,1.0);

399 
cÛf
=
F_¬r
[
evec
[
i
]][
m
];

400 
F_xchng
[
i
]=((
cÛf
[3]*
p
+coef[2])*p+coef[1])*p+coef[0];

401 if(
tmp0
>
rho_max
)

402 
F_xchng
[
i
]+=((3.0*
cÛf
[3]*
p
+2.0*cÛf[2])*p+cÛf[1])*
drho_šv
*(
tmp0
-
rho_max
);

403 
’0
+=
F_xchng
[
i
]-
F
[i];

406 
’
+=
’0
*
c0
;

408 
gcmc
->
lş_v¬s
[0]=
’
;

409 
gcmc
->
lş_v¬s
[1]=
rho_Ÿtm_lş
;

412 
	}
}

417 
ty³0
 
	gFÜûF›ldEAM
::
	$xchng_’”gy
(
GCMC
* 
gcmc
)

419 & 
icomm
=
gcmc
->icomm;

420 
gcmc
->
	`»£t_icomm
();
icomm
!=-1;gcmc->
	`Ãxt_icomm
())

421 
	`MPI_Reduû
(
gcmc
->
lş_v¬s
,gcmc->
v¬s
,2,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,gcmc->
cu¼_roÙ
,*gcmc->
cu¼_comm
);

424 if(
gcmc
->
im_roÙ
)

427 
gcmc
->
	`»£t_icomm
();

428 if(
gcmc
->
xchng_mode
==
NOEX_MODE
)  0.0;

429 
ty³0
 
rho_Ÿtm
,
’
;

430 
size_t
 
m
;

431 
ty³0
* 
cÛf
;

433 
’
=
gcmc
->
v¬s
[0];

434 
rho_Ÿtm
=
gcmc
->
v¬s
[1];

435 
ty³0
 
p
=
rho_Ÿtm
*
drho_šv
;

436 
m
=
¡©ic_ÿ¡
<
size_t
>(
p
);

437 
m
=
	`MIN
(m,
Äho
-2);

438 
p
-=
m
;

439 
p
=
	`MIN
(p,1.0);

440 
cÛf
=
F_¬r
[
gcmc
->
›Ëm
][
m
];

441 
ty³0
 
F_Ÿtm
=((
cÛf
[3]*
p
+coef[2])*p+coef[1])*p+coef[0];

442 if(
rho_Ÿtm
>
rho_max
)

443 
F_Ÿtm
+=((3.0*
cÛf
[3]*
p
+2.0*cÛf[2])*p+cÛf[1])*
drho_šv
*(
rho_Ÿtm
-
rho_max
);

445 
’
+=
F_Ÿtm
;

446  
’
;

449 
	}
}

454 
	gFÜûF›ldEAM
::
	$po¡_xchng_’”gy
(
GCMC
* 
gcmc
)

456 * 
g
=
gcmc
->
g_vec_p
->
	`begš
();

457 
ty³0
* 
rho
=
rho_±r
->
	`begš
();

458 
ty³0
* 
F
=
F_±r
->
	`begš
();

460 
ty³0
* 
rho_xchng
=
rho_xchng_±r
->
	`begš
();

461 
ty³0
* 
F_xchng
=
F_xchng_±r
->
	`begš
();

462 cÚ¡ 
Çtms_lş
=
©oms
->natms_lcl;

463 
i
=0;i<
Çtms_lş
;i++)

464 if(
g
[
i
]==0)

466 
rho
[
i
]=
rho_xchng
[i];

467 
F
[
i
]=
F_xchng
[i];

470 if(
gcmc
->
im_roÙ
 && gcmc->
xchng_mode
==
INS_MODE
 && gcmc->
roÙ_succ
)

472 
rho
[
Çtms_lş
-1]=
gcmc
->
v¬s
[1];

473 
ty³0
 
p
=
rho
[
Çtms_lş
-1]*
drho_šv
;

474 
size_t
 
m
=
¡©ic_ÿ¡
<size_t>(
p
);

475 
m
=
	`MIN
(m,
Äho
-2);

476 
p
-=
m
;

477 
p
=
	`MIN
(p,1.0);

478 
ty³0
* 
cÛf
=
F_¬r
[
gcmc
->
›Ëm
][
m
];

479 
F
[
Çtms_lş
-1]=((
cÛf
[3]*
p
+coef[2])*p+coef[1])*p+coef[0];

480 if(
rho
[
Çtms_lş
-1]>
rho_max
)

481 
F
[
Çtms_lş
-1]+=((3.0*
cÛf
[3]*
p
+2.0*cÛf[2])*p+cÛf[1])*
drho_šv
*(
rho
[Çtms_lş-1]-
rho_max
);

483 
	}
}

487 
	gFÜûF›ldEAM
::
	$š™
()

489 
	`´e_š™
();

490 
rho_±r
=
Ãw
 
Vec
<
ty³0
>(
©oms
,1,"rho");

491 
dF_±r
=
Ãw
 
Vec
<
ty³0
>(
©oms
,1);

493 
	}
}

497 
	gFÜûF›ldEAM
::
	$fš
()

499 
MemÜy
::
	`d—Îoc
(
drhoj_dr
);

500 
MemÜy
::
	`d—Îoc
(
drhoi_dr
);

501 
max_·œs
=0;

502 
d–‘e
 
dF_±r
;

503 
d–‘e
 
rho_±r
;

504 
	`po¡_fš
();

505 
	}
}

509 
	gFÜûF›ldEAM
::
	$š™_xchng
()

511 
F_±r
=
Ãw
 
Vec
<
ty³0
>(
©oms
,1);

512 
rho_xchng_±r
=
Ãw
 
Vec
<
ty³0
>(
©oms
,1);

513 
F_xchng_±r
=
Ãw
 
Vec
<
ty³0
>(
©oms
,1);

515 
ty³0
* 
xvec
=
©oms
->
x
->
	`begš
();

516 
ty³0
* 
rho
=
rho_±r
->
	`begš
();

517 
ty³0
* 
F
=
F_±r
->
	`begš
();

518 
ty³0
* 
rho_xchng
=
rho_xchng_±r
->
	`begš
();

519 
ty³0
* 
F_xchng
=
F_xchng_±r
->
	`begš
();

520 
–em_ty³
* 
evec
=
©oms
->
–em
->
	`begš
();

522 
Ÿtm
,
j©m
;

523 
icomp
,
jcomp
;

524 
–em_ty³
 
›Ëm
,
j–em
;

525 
ty³0
 
dx0
,
dx1
,
dx2
,
rsq
;

526 
ty³0
 
r
,
p
;

527 
size_t
 
m
;

528 
ty³0
* 
cÛf
;

530 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->neighbor_list;

531 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->neighbor_list_size;

532 cÚ¡ 
Çtms_lş
=
©oms
->natms_lcl;

533 
Ÿtm
=0;Ÿtm<
Çtms_lş
;Ÿtm++è
rho
[Ÿtm]=
rho_xchng
[Ÿtm]=
F_xchng
[iatm]=0.0;

535 
Ÿtm
=0;Ÿtm<
Çtms_lş
;iatm++)

537 
›Ëm
=
evec
[
Ÿtm
];

538 
icomp
=3*
Ÿtm
;

539 
j
=0;j<
ÃighbÜ_li¡_size
[
Ÿtm
];j++)

541 
j©m
=
ÃighbÜ_li¡
[
Ÿtm
][
j
];

542 
j–em
=
evec
[
j©m
];

544 
jcomp
=3*
j©m
;

545 
dx0
=
xvec
[
icomp
]-xvec[
jcomp
];

546 
dx1
=
xvec
[
icomp
+1]-xvec[
jcomp
+1];

547 
dx2
=
xvec
[
icomp
+2]-xvec[
jcomp
+2];

548 
rsq
=
dx0
*dx0+
dx1
*dx1+
dx2
*dx2;

550 if(
rsq
<
cut_sq
[
›Ëm
][
j–em
])

552 
r
=
	`sq¹
(
rsq
);

554 
p
=
r
*
dr_šv
;

555 
m
=
¡©ic_ÿ¡
<
size_t
>(
p
);

556 
m
=
	`MIN
(m,
Ä
-2);

557 
p
-=
m
;

558 
p
=
	`MIN
(p,1.0);

560 
cÛf
=
r_phi_¬r
[
›Ëm
][
j–em
][
m
];

562 
cÛf
=
rho_¬r
[
j–em
][
›Ëm
][
m
];

563 
rho
[
Ÿtm
]+=((
cÛf
[3]*
p
+coef[2])*p+coef[1])*p+coef[0];

564 if(
j©m
<
Çtms_lş
)

566 
cÛf
=
rho_¬r
[
›Ëm
][
j–em
][
m
];

567 
rho
[
j©m
]+=((
cÛf
[3]*
p
+coef[2])*p+coef[1])*p+coef[0];

572 
p
=
rho
[
Ÿtm
]*
drho_šv
;

573 
m
=
¡©ic_ÿ¡
<
size_t
>(
p
);

574 
m
=
	`MIN
(m,
Äho
-2);

575 
p
-=
m
;

576 
p
=
	`MIN
(p,1.0);

577 
›Ëm
=
evec
[
Ÿtm
];

578 
cÛf
=
F_¬r
[
›Ëm
][
m
];

579 
F
[
Ÿtm
]=((
cÛf
[3]*
p
+coef[2])*p+coef[1])*p+coef[0];

581 
	}
}

585 
	gFÜûF›ldEAM
::
	$fš_xchng
()

587 
d–‘e
 
F_xchng_±r
;

588 
d–‘e
 
rho_xchng_±r
;

589 
d–‘e
 
F_±r
;

590 
	}
}

594 
	gFÜûF›ldEAM
::
	$ml_Ãw
(
PyM‘hodDef
& 
m‘hod_0
,PyM‘hodDef& 
m‘hod_1
,PyM‘hodDef& 
m‘hod_2
)

596 
m‘hod_0
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

597 
m‘hod_0
.
ml_Çme
="ff_eam_funcfl";

598 
m‘hod_0
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

599 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

601 
AtomsMD
::
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<AtomsMD::Objeù*>(
£lf
);

603 
FuncAPI
<
¡d
::
¡ršg
*,¡d::¡ršg*> 
	`f
("ff_eam_funcfl",{"funcfl_files","elems"});

604 
f
.
nİtiÚ®s
=1;

605 cÚ¡ 
¡d
::
¡ršg
* 
Çmes
=
__£lf
->
©oms
->
–em’ts
.names;

606 cÚ¡ 
size_t
 
ÃËms
=
__£lf
->
©oms
->
–em’ts
.nelems;

607 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

608 if(
f
.
»m­
<1,0>("–em’t ´e£Á iÀsy¡em",
Çmes
,
ÃËms
)è 
NULL
;

610 
size_t
 
Ä
,
Äho
;

611 
ty³0
 
dr
,
drho
;

612 
ty³0
** 
r_c
;

613 
	`ty³0
(** 
F
)[4]=
NULL
;

614 
	`ty³0
(*** 
r_phi
)[4]=
NULL
;

615 
	`ty³0
(*** 
rho
)[4]=
NULL
;

616 
Œy


618 
ImpÜtEAM
::
	`funcæ
(
ÃËms
,
f
.
v®
<0>(),
dr
,
drho
,
Ä
,
Äho
,
r_phi
,
rho
,
F
,
r_c
);

620 
	`ÿtch
(* 
”r_msg
)

622 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,
”r_msg
);

623 
d–‘e
 [] 
”r_msg
;

624  
NULL
;

627 
d–‘e
 
__£lf
->
ff
;

628 
__£lf
->
ff
=
Ãw
 
	`FÜûF›ldEAM
(__£lf->
©oms
,
dr
,
drho
,
Ä
,
Äho
,
¡d
::
	`move
(
r_phi
),¡d::move(
rho
),¡d::move(
F
),¡d::move(
r_c
));

629 
Py_RETURN_NONE
;

631 
m‘hod_0
.
ml_doc
=(*)
R
"---(

632 
	`ff_—m_funcæ
(
funcæ_fes
,
–ems
=
NÚe
)

634 
TabuÏ‹d
 
EAM
 
fÜû
 
f›ld
 
giv’
 
by
 
FuncFL
 
fe
/
s


636 
Assigns
 
EAM
 
fÜû
 
f›ld
 
to
 
sy¡em


638 
P¬am‘”s


640 
funcæ_fes
 : 
¡ršg
[
ÃËms
]

641 
li¡
 
of
 
»Ïtive
 
·ths
 
to
 
DYNAMO
 
fes
 
w™h
 
FuncFL
 
fÜm©


642 
–ems
 : 
¡ršg
[
ÃËms
]

643 
m­pšg
 
–em’ts


645 
R‘uºs


647 
NÚe


649 
NÙes


651 
This
 
is
 
buÏ‹d
 
fÜm
 
of
 
Embedded
 
Atom
 
	`M‘hod
 (
EAM
è
pÙ’tŸl


654 
Exam¶es


656 
Ni


660 >>> 
äom
 
m­p
 
impÜt
 
md


661 >>> 
sim
=
md
.
	`cfg
("configs/Ni.cfg")

662 >>> 
sim
.
	`ff_—m_funcæ
("potentials/Ni_u3.eam")

668 
m‘hod_1
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

669 
m‘hod_1
.
ml_Çme
="ff_eam_setfl";

670 
m‘hod_1
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

671 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

673 
AtomsMD
::
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<AtomsMD::Objeù*>(
£lf
);

674 
size_t
& 
ÃËms
=
__£lf
->
©oms
->
–em’ts
.nelems;

675 
FuncAPI
<
¡d
::
¡ršg
> 
	`f
("ff_eam_setfl",{"setfl_file"});

676 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

679 
size_t
 
Ä
,
Äho
;

680 
ty³0
 
dr
,
drho
;

681 
ty³0
** 
r_c
;

682 
	`ty³0
(** 
F
)[4]=
NULL
;

683 
	`ty³0
(*** 
r_phi
)[4]=
NULL
;

684 
	`ty³0
(*** 
rho
)[4]=
NULL
;

685 
Œy


687 
ImpÜtEAM
::
	`£tæ
(
ÃËms
,
__£lf
->
©oms
->
–em’ts
.
Çmes
,
f
.
v®
<0>(),
dr
,
drho
,
Ä
,
Äho
,
r_phi
,
rho
,
F
,
r_c
);

689 
	`ÿtch
(* 
”r_msg
)

691 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,
”r_msg
);

692 
d–‘e
 [] 
”r_msg
;

693  
NULL
;

696 
d–‘e
 
__£lf
->
ff
;

697 
__£lf
->
ff
=
Ãw
 
	`FÜûF›ldEAM
(__£lf->
©oms
,
dr
,
drho
,
Ä
,
Äho
,
¡d
::
	`move
(
r_phi
),¡d::move(
rho
),¡d::move(
F
),¡d::move(
r_c
));

698 
Py_RETURN_NONE
;

700 
m‘hod_1
.
ml_doc
=(*)
R
"---(

701 
	`ff_—m_£tæ
(
£tæ_fe
)

703 
TabuÏ‹d
 
EAM
 
fÜû
 
f›ld
 
giv’
 
by
 
a
 
sšgË
 
S‘FL
 
fe


705 
Assigns
 
EAM
 
fÜû
 
f›ld
 
to
 
sy¡em


707 
P¬am‘”s


709 
£tæ_fe
 : 
¡ršg


710 
»Ïtive
 
·th
 
to
 
DYNAMO
 
fe
 
w™h
 
S‘FL
 
fÜm©


712 
R‘uºs


714 
NÚe


716 
NÙes


718 
This
 
is
 
buÏ‹d
 
fÜm
 
of
 
Embedded
 
Atom
 
	`M‘hod
 (
EAM
è
pÙ’tŸl


721 
Exam¶es


723 
Cu


727 >>> 
äom
 
m­p
 
impÜt
 
md


728 >>> 
sim
=
md
.
	`cfg
("configs/Cu.cfg")

729 >>> 
sim
.
	`ff_—m_£tæ
("potentials/Cu_mishin.eam.alloy")

736 
m‘hod_2
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

737 
m‘hod_2
.
ml_Çme
="ff_eam_fs";

738 
m‘hod_2
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

739 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

741 
AtomsMD
::
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<AtomsMD::Objeù*>(
£lf
);

742 
size_t
& 
ÃËms
=
__£lf
->
©oms
->
–em’ts
.nelems;

743 
FuncAPI
<
¡d
::
¡ršg
> 
	`f
("ff_eam_fs",{"fs_file"});

744 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

746 
size_t
 
Ä
,
Äho
;

747 
ty³0
 
dr
,
drho
;

748 
ty³0
** 
r_c
;

749 
	`ty³0
(** 
F
)[4]=
NULL
;

750 
	`ty³0
(*** 
r_phi
)[4]=
NULL
;

751 
	`ty³0
(*** 
rho
)[4]=
NULL
;

752 
Œy


754 
ImpÜtEAM
::
	`fs
(
ÃËms
,
__£lf
->
©oms
->
–em’ts
.
Çmes
,
f
.
v®
<0>(),
dr
,
drho
,
Ä
,
Äho
,
r_phi
,
rho
,
F
,
r_c
);

756 
	`ÿtch
(* 
”r_msg
)

758 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,
”r_msg
);

759 
d–‘e
 [] 
”r_msg
;

760  
NULL
;

763 
d–‘e
 
__£lf
->
ff
;

764 
__£lf
->
ff
=
Ãw
 
	`FÜûF›ldEAM
(__£lf->
©oms
,
dr
,
drho
,
Ä
,
Äho
,
¡d
::
	`move
(
r_phi
),¡d::move(
rho
),¡d::move(
F
),¡d::move(
r_c
));

765 
Py_RETURN_NONE
;

767 
m‘hod_2
.
ml_doc
=(*)
R
"---(

768 
	`ff_—m_fs
(
fs_fe
)

770 
TabuÏ‹d
 
Fšnis
-
Sšşaœ
 
EAM


772 
Assigns
 
Fšnis
-
Sšşaœ
 
EAM
 
fÜû
 
f›ld
 
to
 
sy¡em
. 
FÜ
 
ex¶ª©iÚ
 
of
 
the
 
·¿m‘”
 
£e
h
NÙes
 
£ùiÚ
.

774 
P¬am‘”s


776 
fs_fe
 : 
¡ršg


777 
»Ïtive
 
·th
 
to
 
DYNAMO
 
fe
 
w™h
 
fs
 
fÜm©


779 
R‘uºs


781 
NÚe


783 
NÙes


785 
This
 
is
 
buÏ‹d
 
fÜm
 
of
 
Fšnis
-
Sšşaœ
 
Embedded
 
Atom
 
	`M‘hod
 (
EAM
è
pÙ’tŸl


788 
Exam¶es


790 
IrÚ
 
Hydrogº
 
mixtu»


793 >>> 
äom
 
m­p
 
impÜt
 
md


794 >>> 
sim
=
md
.
	`cfg
("configs/FeH.cfg")

795 >>> 
sim
.
	`ff_—m_fs
("potentials/FeH.eam.fs")

801 
	}
}

	@ff_eam.h

1 #iâdeà
__MAPP__ff_—m__


2 
	#__MAPP__ff_—m__


	)

3 
	~"ff_md.h
"

4 
Çme¥aû
 
	gMAPP_NS


6 şas 
	cFÜûF›ldEAM
: 
public
 
FÜûF›ldMD


8 
´iv©e
:

9 
Vec
<
ty³0
>* 
rho_±r
;

10 
	gVec
<
	gty³0
>* 
	gF_±r
;

11 
	gVec
<
	gty³0
>* 
	gdF_±r
;

12 
	gVec
<
	gty³0
>* 
	grho_xchng_±r
;

13 
	gVec
<
	gty³0
>* 
	gF_xchng_±r
;

15 
size_t
 
	gÄ
,
	gÄho
;

16 
ty³0
 
	gdr
,
	gdrho
,
	gdr_šv
,
	gdrho_šv
,
	grho_max
;

17 
ty³0
(** 
F_¬r
)[4];

18 
ty³0
(*** 
r_phi_¬r
)[4];

19 
ty³0
(*** 
rho_¬r
)[4];

23 
ty³0
* 
	gdrhoi_dr
;

24 
ty³0
* 
	gdrhoj_dr
;

25 
size_t
 
	gmax_·œs
;

27 
	g´Ùeùed
:

29 
__fÜû_ÿlc
();

30 
__’”gy_ÿlc
();

31 
´e_xchng_’”gy
(
GCMC
*);

32 
ty³0
 
xchng_’”gy
(
GCMC
*);

33 
po¡_xchng_’”gy
(
GCMC
*);

34 
	gpublic
:

35 
FÜûF›ldEAM
(
AtomsMD
*,

36 
ty³0
,ty³0,
size_t
,size_t,

37 
ty³0
(***&&)[4],type0(***&&)[4],type0(**&&)[4],

38 
ty³0
**&&);

39 ~
FÜûF›ldEAM
();

41 
ml_Ãw
(
PyM‘hodDef
&,PyMethodDef&,PyMethodDef&);

43 
š™
();

44 
fš
();

45 
š™_xchng
();

46 
fš_xchng
();

	@ff_eam_dmd.cpp

1 
	~"ff_—m_dmd.h
"

2 
	~<¡dlib.h
>

3 
	~"ÃighbÜ_dmd.h
"

4 
	~"–em’ts.h
"

5 
	~"memÜy.h
"

6 
	~"xm©h.h
"

7 
	~"©oms_dmd.h
"

8 
	~"MAPP.h
"

9 
	~"dyÇmic_dmd.h
"

10 
	~"impÜt_—m.h
"

11 
	~<lim™s
>

12 
	#PI_IN_SQ
 0.564189583547756286948079451561

	)

13 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

17 
	gFÜûF›ldEAMDMD
::

18 
FÜûF›ldEAMDMD
(
AtomsDMD
* 
©oms
,

19 
ty³0
 
__dr
,ty³0 
__drho
,
size_t
 
__Ä
,size_ˆ
__Äho
,

20 
ty³0
(***&& 
__r_phi_¬r
)[4],ty³0(***&& 
__rho_¬r
)[4],ty³0(**&& 
__F_¬r
)[5],

21 
ty³0
**&& 
__cut
,ty³0*&& 
__r_üd
,ty³0*&& 
__z‘a
):

22 
FÜûF›ldDMD
(
©oms
),

23 
dr
(
__dr
),

24 
drho
(
__drho
),

25 
Ä
(
__Ä
),

26 
Äho
(
__Äho
),

27 
r_phi_¬r
(
__r_phi_¬r
),

28 
r_rho_¬r
(
__rho_¬r
),

29 
F_¬r
(
__F_¬r
),

30 
rho_phi
(
NULL
),

31 
drho_phi_dr
(
NULL
),

32 
drho_phi_d®pha
(
NULL
),

33 
ddrho_phi_drdr
(
NULL
),

34 
ddrho_phi_drd®pha
(
NULL
),

35 
ddrho_phi_d®phad®pha
(
NULL
),

36 
max_·œs0
(0),

37 
max_·œs1
(0),

38 
M_IJ
(
NULL
),

39 
vec0
(
NULL
),

40 
vec1
(
NULL
),

41 
vec2
(
NULL
),

42 
vec3
(
NULL
),

43 
dE_±r
(
NULL
),

44 
ddE_±r
(
NULL
),

45 
cv_±r
(
NULL
),

46 
N
(
©oms
->N)

49 
	g__r_phi_¬r
=
NULL
;

50 
	g__rho_¬r
=
NULL
;

51 
	g__F_¬r
=
NULL
;

53 
	gdr_šv
=1.0/
dr
;

54 
	gdrho_šv
=1.0/
drho
;

55 
	grho_max
=
¡©ic_ÿ¡
<
ty³0
>(
Äho
)*
drho
;

57 
	gkbT
=
b‘a
=-1.0;

61 
	gMemÜy
::
®loc
(
xi
,
N
);

62 
	gMemÜy
::
®loc
(
wi_0
,
N
);

63 
	gMemÜy
::
®loc
(
wi_1
,
N
);

64 
	gMemÜy
::
®loc
(
z‘a
,
ÃËms
);

65 
	gMemÜy
::
®loc
(
c_0
,
ÃËms
);

66 
	gMemÜy
::
®loc
(
c_1
,
ÃËms
);

68 
memıy
(
xi
,
©oms
->xi,
N
*(
ty³0
));

69 
memıy
(
wi_0
,
©oms
->
wi
,
N
*(
ty³0
));

70 
	gi
=0;i<
	gN
;i++)

71 
	gwi_1
[
i
]=
wi_0
[i]*
xi
[i];

74 
–em_ty³
 
	g–em_i
=0;–em_i<
	gÃËms
;elem_i++)

76 
	gr_üd
[
–em_i
]=
__r_üd
[elem_i];

77 
	gz‘a
[
–em_i
]=
__z‘a
[elem_i];

79 
	gMemÜy
::
d—Îoc
(
__r_üd
);

80 
	gMemÜy
::
d—Îoc
(
__z‘a
);

82 
–em_ty³
 
	g–em_i
=0;–em_i<
	gÃËms
;elem_i++)

84 
size_t
 
	gi
=0;i<
	gÄ
;i++)

85 
	gr_rho_¬r
[
–em_i
][0][
i
][0]*=
¡©ic_ÿ¡
<
ty³0
>(i)*
dr
;

86 
	gImpÜtEAM
::
š‹½Ş©e
(
Ä
,
dr
,
r_rho_¬r
[
–em_i
][0]);

87 
–em_ty³
 
	g–em_j
=1;–em_j<
	gÃËms
;elem_j++)

89 if(
	gr_rho_¬r
[
–em_i
][
–em_j
]!=
r_rho_¬r
[elem_i][elem_j-1])

91 
size_t
 
i
=0;
	gi
<
	gÄ
;i++)

92 
	gr_rho_¬r
[
–em_i
][
–em_j
][
i
][0]*=
¡©ic_ÿ¡
<
ty³0
>(i)*
dr
;

93 
	gImpÜtEAM
::
š‹½Ş©e
(
Ä
,
dr
,
r_rho_¬r
[
–em_i
][
–em_j
]);

99 
ty³0
 
	gtmp
;

100 
size_t
 
	gi
=0;i<
	gÃËms
;i++)

101 
size_t
 
	gj
=0;j<
	gi
+1;j++)

103 
	gcut
[
i
][
j
]=
cut
[j][i]=
__cut
[i][j];

104 
	gtmp
=
__cut
[
i
][
j
];

105 
	gcut_sq
[
i
][
j
]=
cut_sq
[j][i]=
tmp
*tmp;

107 
	gMemÜy
::
d—Îoc
(
__cut
);

112 
	gFÜûF›ldEAMDMD
::~
	$FÜûF›ldEAMDMD
()

114 
MemÜy
::
	`d—Îoc
(
F_¬r
);

115 
MemÜy
::
	`d—Îoc
(
r_rho_¬r
);

116 
MemÜy
::
	`d—Îoc
(
r_phi_¬r
);

118 
MemÜy
::
	`d—Îoc
(
z‘a
);

119 
MemÜy
::
	`d—Îoc
(
c_1
);

120 
MemÜy
::
	`d—Îoc
(
c_0
);

121 
MemÜy
::
	`d—Îoc
(
wi_1
);

122 
MemÜy
::
	`d—Îoc
(
wi_0
);

123 
MemÜy
::
	`d—Îoc
(
xi
);

125 
	}
}

129 
	gFÜûF›ldEAMDMD
::
	$__fÜû_ÿlc
()

131 if(
max_·œs0
<
ÃighbÜ
->
no_·œs
)

133 
d–‘e
 [] 
rho_phi
;

134 
d–‘e
 [] 
drho_phi_dr
;

135 
d–‘e
 [] 
drho_phi_d®pha
;

137 
max_·œs0
=
ÃighbÜ
->
no_·œs
;

138 
size_t
 
no_0
=
max_·œs0
*3;

139 
MemÜy
::
	`®loc
(
rho_phi
,
no_0
);

140 
MemÜy
::
	`®loc
(
drho_phi_dr
,
no_0
);

141 
MemÜy
::
	`®loc
(
drho_phi_d®pha
,
no_0
);

144 
i
=0;i<
max_·œs0
*3;i++è
rho_phi
[i]=
drho_phi_dr
[i]=
drho_phi_d®pha
[i]=0.0;

150 
ty³0
 
r
,
r_šv
;

151 
size_t
 
m
;

152 
ty³0
* 
cÛf
;

153 
ty³0
 
tmp0
,
tmp1
;

154 
ty³0
 
åaœ
,
­aœ
;

156 
ty³0
 
p
,
cv_i
;

158 
ty³0
 
dx_ij
[
__dim__
];

160 
ty³0
 cÚ¡* 
c
=
©oms
->c->
	`begš
();

164 
ty³0
* 
dE
=
dE_±r
->
	`begš
();

165 
ty³0
* 
mu_vec
=
mu
->
	`begš
();

166 
ty³0
* 
rho
=
E_±r
->
	`begš
();

167 cÚ¡ 
n
=
©oms
->
Çtms_lş
*
c_dim
;

168 
i
=0;i<
n
;i++è
rho
[i]=0.0;

170 
–em_ty³
 cÚ¡* 
–em_vec
=
©oms
->
–em
->
	`begš
();

172 
ty³0
 
®pha_ij
,
rsq
;

173 
–em_ty³
 
–em_i
,
–em_j
;

177 cÚ¡ 
ty³0
* 
x
=
©oms
->x->
	`begš
();

178 cÚ¡ 
ty³0
* 
®pha
=
©oms
->®pha->
	`begš
();

179 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->neighbor_list;

180 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->neighbor_list_size;

181 
size_t
 
i¡¬t
=0;

182 
i
=0;i<
n
;i++)

184 
ty³0
 
c_i
=
c
[
i
];

185 if(
c_i
<0.0) ;

186 
–em_i
=
–em_vec
[
i
];

187 cÚ¡ 
Ãigh_sz
=
ÃighbÜ_li¡_size
[
i
];

188 
j
,
__j
=0;__j<
Ãigh_sz
;__j++,
i¡¬t
+=3)

190 
j
=
ÃighbÜ_li¡
[
i
][
__j
];

191 
–em_j
=
–em_vec
[
j
];

192 
rsq
=
Algeb¿
::
RSQ
<
__dim__
>(
x
+(
i
/
c_dim
)*__dim__,x+(
j
/c_dim)*__dim__);

193 
r
=
	`sq¹
(
rsq
);

194 
ty³0
 
®pha_ij_sq
=
®pha
[
i
]*®pha[i]+®pha[
j
]*alpha[j];

195 
®pha_ij
=
	`sq¹
(
®pha_ij_sq
);

196 if(
r
-
®pha_ij
*
xi
[
N
-1]>=
cut
[
–em_i
][
–em_j
]) ;

197 
ty³0
 
uµ”
=(
r
+
cut
[
–em_i
][
–em_j
])/
®pha_ij
;

198 
ty³0
 
low”
=(
r
-
cut
[
–em_i
][
–em_j
])/
®pha_ij
;

199 
ty³0
 
__r
,
p
,
tmp0
,
xi2
;

200 
ty³0
* 
cÛf
;

203 
ty³0
 
H
[3][5]{
	`DESIG2
(3,5,0.0)};

204 
l
=0;l<
N
;l++)

206 if(
xi
[
l
]<=
low”
 && xi[l]>=
uµ”
) ;

208 
xi2
=
xi
[
l
]*xi[l];

210 
__r
=
r
-
xi
[
l
]*
®pha_ij
;

211 
p
=
	`çbs
(
__r
)*
dr_šv
;

212 
m
=
¡©ic_ÿ¡
<
size_t
>(
p
);

213 
m
=
	`MIN
(m,
Ä
-2);

214 
p
-=
m
;

215 
p
=
	`MIN
(p,1.0);

217 
cÛf
=
r_phi_¬r
[
–em_i
][
–em_j
][
m
];

218 
tmp0
=((
cÛf
[3]*
p
+coef[2])*p+coef[1])*p+coef[0];

219 if(
__r
<0.0è
tmp0
*=-1.0;

220 
tmp0
*=
wi_0
[
l
];

221 
H
[0][0]+=
tmp0
;

222 
H
[0][1]+=
tmp0
*
xi
[
l
];

223 
H
[0][2]+=
tmp0
*
xi2
;

226 
cÛf
=
r_rho_¬r
[
–em_i
][
–em_j
][
m
];

227 
tmp0
=((
cÛf
[3]*
p
+coef[2])*p+coef[1])*p+coef[0];

228 if(
__r
<0.0è
tmp0
*=-1.0;

229 
tmp0
*=
wi_0
[
l
];

230 
H
[1][0]+=
tmp0
;

231 
H
[1][1]+=
tmp0
*
xi
[
l
];

232 
H
[1][2]+=
tmp0
*
xi2
;

234 
cÛf
=
r_rho_¬r
[
–em_j
][
–em_i
][
m
];

235 
tmp0
=((
cÛf
[3]*
p
+coef[2])*p+coef[1])*p+coef[0];

236 if(
__r
<0.0è
tmp0
*=-1.0;

237 
tmp0
*=
wi_0
[
l
];

238 
H
[2][0]+=
tmp0
;

239 
H
[2][1]+=
tmp0
*
xi
[
l
];

240 
H
[2][2]+=
tmp0
*
xi2
;

243 
r_šv
=1.0/
r
;

244 
ty³0
 
r2_šv
=
r_šv
*r_inv;

245 
ty³0
 
®pha_šv
=1.0/
®pha_ij
;

246 
ty³0
 
®pha2_šv
=
®pha_šv
*alpha_inv;

247 
ty³0
 
®pha4_šv
=
®pha2_šv
*alpha2_inv;

248 
ty³0
 
r2®pha2_šv
=
r2_šv
*
®pha2_šv
;

251 
Algeb¿
::
Do
<3>::
	`func
([&
i¡¬t
,&
H
,&
r_šv
,&
r2_šv
,&
®pha2_šv
,&
r2®pha2_šv
,&
®pha_ij_sq
,&
®pha_šv
,&
rsq
,&
®pha4_šv
,
this
]

252 (
i
)

254 
rho_phi
[
i¡¬t
+
i
]=
PI_IN_SQ
*
r_šv
*
H
[i][0];

255 
drho_phi_dr
[
i¡¬t
+
i
]=-
r2_šv
*(
rho_phi
[i¡¬t+i]+2.0*
PI_IN_SQ
*
®pha_šv
*
H
[i][1]);

256 
drho_phi_d®pha
[
i¡¬t
+
i
]=-
®pha2_šv
*(
rho_phi
[i¡¬t+i]-2.0*
PI_IN_SQ
*
r_šv
*
H
[i][2]);

260 
rho
[
i
]+=
c
[
j
]*
rho_phi
[
i¡¬t
+2];

262 if(
j
<
n
)

264 
rho
[
j
]+=
c_i
*
rho_phi
[
i¡¬t
+1];

265 
__vec_lş
[0]+=
c_i
*
c
[
j
]*
rho_phi
[
i¡¬t
];

268 
__vec_lş
[0]+=0.5*
c_i
*
c
[
j
]*
rho_phi
[
i¡¬t
];

273 
p
=
rho
[
i
]*
drho_šv
;

274 
m
=
¡©ic_ÿ¡
<
size_t
>(
p
);

275 
m
=
	`MIN
(m,
Äho
-2);

276 
p
-=
m
;

277 
p
=
	`MIN
(p,1.0);

278 
cÛf
=
F_¬r
[
–em_i
][
m
];

280 
tmp0
=(((
cÛf
[4]*
p
+coef[3])*p+coef[2])*p+coef[1])*p+coef[0];

281 
tmp1
=(((4.0*
cÛf
[4]*
p
+3.0*cÛf[3])*p+2.0*cÛf[2])*p+cÛf[1])*
drho_šv
;

283 if(
rho
[
i
]>
rho_max
è
tmp0
+=
tmp1
*(rho[i]-rho_max);

285 
rho
[
i
]=
tmp0
;

286 
dE
[
i
]=
tmp1
;

287 
mu_vec
[
i
]=
tmp0
;

289 
__vec_lş
[0]+=
c_i
*(
tmp0
+
c_0
[
–em_i
]-3.0*
kbT
*
	`log
(
®pha
[
i
]));

290 
__vec_lş
[1+
__nvoigt__
]+=
	`ÿlc_’t
(
c_i
);

293 cÚ¡ 
__Çtms
=
©oms
->
Çtms_lş
;

295 
i
=0;i<
__Çtms
;i++)

297 
cv_i
=1.0;

298 
ic
=0;ic<
c_dim
;ic++)

299 if(
c
[
i
*
c_dim
+
ic
]>0.0)

300 
cv_i
-=
c
[
i
*
c_dim
+
ic
];

301 
__vec_lş
[1+
__nvoigt__
]+=
	`ÿlc_’t
(
cv_i
);

304 
__vec_lş
[0]+=
kbT
*__vec_lş[1+
__nvoigt__
];

305 
	`upd©e
(
dE_±r
);

307 
ty³0
* 
fvec
=
f
->
	`begš
();

308 
ty³0
* 
f_®phavec
=
f_®pha
->
	`begš
();

309 
ty³0
 
f_i
[
__dim__
]={
	`DESIG
(__dim__,0.0)};

310 
ty³0
 
x_i
[
__dim__
];

311 
i¡¬t
=0;

312 
i
=0;i<
n
;i++)

314 if(
i
%
c_dim
==0)

316 
Algeb¿
::
z”o
<
__dim__
>(
f_i
);

317 
Algeb¿
::
V_eq
<
__dim__
>(
x
+(
i
/
c_dim
)*__dim__,
x_i
);

320 
ty³0
 
c_i
=
c
[
i
];

321 
ty³0
 
®pha_i
=
®pha
[
i
];

322 
ty³0
 
dE_i
=
dE
[
i
];

323 
ty³0
 
f_®pha_i
=0.0;

324 
ty³0
 
mu_i
=0.0;

325 cÚ¡ 
Ãigh_sz
=
ÃighbÜ_li¡_size
[
i
];

326 
j
,
__j
=0;__j<
Ãigh_sz
;__j++,
i¡¬t
+=3)

328 
j
=
ÃighbÜ_li¡
[
i
][
__j
];

329 
Algeb¿
::
DX
<
__dim__
>(
x_i
,
x
+(
j
/
c_dim
)*__dim__,
dx_ij
);

331 
åaœ
=-(
drho_phi_dr
[
i¡¬t
+2]*
dE_i
+drho_phi_dr[i¡¬t+1]*
dE
[
j
]+drho_phi_dr[i¡¬t])*
c_i
*
c
[j];

332 
­aœ
=-(
drho_phi_d®pha
[
i¡¬t
+2]*
dE_i
+drho_phi_d®pha[i¡¬t+1]*
dE
[
j
]+drho_phi_d®pha[i¡¬t])*
c_i
*
c
[j];

333 
mu_i
+=
c
[
j
]*(
rho_phi
[
i¡¬t
]+rho_phi[i¡¬t+1]*
dE
[j]);

334 if(
j
<
n
è
mu_vec
[j]+=
c_i
*(
rho_phi
[
i¡¬t
]+rho_phi[i¡¬t+2]*
dE_i
);

336 
Algeb¿
::
V_add_x_mul_V
<
__dim__
>(
åaœ
,
dx_ij
,
f_i
);

337 
f_®pha_i
+=
®pha_i
*
­aœ
;

338 if(
j
<
n
)

340 
Algeb¿
::
V_add_x_mul_V
<
__dim__
>(-
åaœ
,
dx_ij
,
fvec
+(
j
/
c_dim
)*__dim__);

341 
f_®phavec
[
j
]+=
®pha
[j]*
­aœ
;

344 
åaœ
*=0.5;

345 
Algeb¿
::
DyadicV
<
__dim__
>(-
åaœ
,
dx_ij
,&
__vec_lş
[1]);

348 
f_®pha_i
+=3.0*
kbT
*
c_i
/
®pha_i
;

349 
f_®phavec
[
i
]+=
f_®pha_i
;

350 
mu_vec
[
i
]+=
mu_i
;

352 if((
i
+1)%
c_dim
==0)

353 
Algeb¿
::
V_add
<
__dim__
>(
f_i
,
fvec
+__dim__*(
i
/
c_dim
));

356 
ty³0
 
nÜm_sq_lş
=0.0;

357 
i
=0;i<
n
;i++)

358 
nÜm_sq_lş
+=
f_®phavec
[
i
]*f_alphavec[i];

359 cÚ¡ 
Çtms_lş
=
©oms
->natms_lcl;

360 
i
=0;i<
Çtms_lş
;i++,
fvec
+=
__dim__
)

361 
nÜm_sq_lş
+=
Algeb¿
::
RSQ
<
__dim__
>(
fvec
,fvec);

362 
	}
}

366 
	gFÜûF›ldEAMDMD
::
__´•J_n_»s
(
Vec
<
ty³0
>* 
fvec_±r
,Vec<ty³0>* 
f_®phavec_±r
)

369 if(
	gmax_·œs0
<
	gÃighbÜ
->
	gno_·œs
)

371 
	gd–‘e
 [] 
	grho_phi
;

372 
	gd–‘e
 [] 
	gdrho_phi_dr
;

373 
	gd–‘e
 [] 
	gdrho_phi_d®pha
;

375 
	gmax_·œs0
=
ÃighbÜ
->
no_·œs
;

376 
size_t
 
	gno_0
=
max_·œs0
*3;

377 
	gMemÜy
::
®loc
(
rho_phi
,
no_0
);

378 
	gMemÜy
::
®loc
(
drho_phi_dr
,
no_0
);

379 
	gMemÜy
::
®loc
(
drho_phi_d®pha
,
no_0
);

382 if(
	gmax_·œs1
<
	gÃighbÜ
->
	gno_·œs
)

384 
	gd–‘e
 [] 
	gddrho_phi_drdr
;

385 
	gd–‘e
 [] 
	gddrho_phi_d®phad®pha
;

386 
	gd–‘e
 [] 
	gddrho_phi_drd®pha
;

387 
	gmax_·œs1
=
ÃighbÜ
->
no_·œs
;

388 
size_t
 
	gno_0
=
max_·œs1
*3;

389 
	gMemÜy
::
®loc
(
ddrho_phi_drdr
,
no_0
);

390 
	gMemÜy
::
®loc
(
ddrho_phi_drd®pha
,
no_0
);

391 
	gMemÜy
::
®loc
(
ddrho_phi_d®phad®pha
,
no_0
);

394 
	gi
=0;i<
	gmax_·œs0
*3;i++è
	grho_phi
[
i
]=
drho_phi_dr
[i]=
drho_phi_d®pha
[i]=0.0;

395 
	gi
=0;i<
	gmax_·œs1
*3;i++è
	gddrho_phi_drdr
[
i
]=
ddrho_phi_d®phad®pha
[i]=
ddrho_phi_drd®pha
[i]=0.0;

397 
ty³0
 
	gr
,
	gr_šv
;

398 
size_t
 
	gm
;

399 
ty³0
* 
	gcÛf
;

401 
ty³0
 
	gp
;

403 cÚ¡ 
	gn
=
©oms
->
Çtms_lş
*
c_dim
;

404 cÚ¡ 
ty³0
* 
	gc
=
©oms
->
c
->
begš
();

405 cÚ¡ 
ty³0
* 
	gx
=
©oms
->
x
->
begš
();

406 cÚ¡ 
ty³0
* 
	g®pha
=
©oms
->
®pha
->
begš
();

407 
ty³0
* 
	gE
=
E_±r
->
begš
();

408 
ty³0
* 
	gdE
=
dE_±r
->
begš
();

409 
ty³0
* 
	gddE
=
ddE_±r
->
begš
();

410 
ty³0
* 
	grho
=
E
;

411 
	gi
=0;i<
	gn
;i++è
	grho
[
i
]=0.0;

413 
–em_ty³
 cÚ¡* 
	g–em_vec
=
©oms
->
–em
->
begš
();

415 
ty³0
 
	g®pha_ij
,
	g®pha_ij_sq
,
	grsq
,
	g__rho
;

416 
–em_ty³
 
	g–em_i
,
	g–em_j
;

418 ** 
	gÃighbÜ_li¡
=
ÃighbÜ
->
ÃighbÜ_li¡
;

419 * 
	gÃighbÜ_li¡_size
=
ÃighbÜ
->
ÃighbÜ_li¡_size
;

420 
size_t
 
	gi¡¬t
=0;

421 
	gi
=0;i<
	gn
;i++)

423 
ty³0
 
	gc_i
=
c
[
i
];

424 if(
	gc_i
<0.0) ;

425 
	g–em_i
=
–em_vec
[
i
];

426 cÚ¡ 
	gÃigh_sz
=
ÃighbÜ_li¡_size
[
i
];

427 
	gj
,
	g__j
=0;__j<
	gÃigh_sz
;__j++,
	gi¡¬t
+=3)

429 
j
=
ÃighbÜ_li¡
[
i
][
__j
];

430 
	g–em_j
=
–em_vec
[
j
];

431 
	grsq
=
Algeb¿
::
RSQ
<
__dim__
>(
x
+(
i
/
c_dim
)*__dim__,
	gx
+(
	gj
/
	gc_dim
)*
	g__dim__
);

432 
	gr
=
sq¹
(
rsq
);

433 
	g®pha_ij_sq
=
®pha
[
i
]*®pha[i]+®pha[
j
]*alpha[j];

434 
	g®pha_ij
=
sq¹
(
®pha_ij_sq
);

435 if(
	gr
-
®pha_ij
*
	gxi
[
N
-1]>=
cut
[
–em_i
][
–em_j
]) ;

436 
ty³0
 
	guµ”
=(
r
+
cut
[
–em_i
][
–em_j
])/
®pha_ij
;

437 
ty³0
 
	glow”
=(
r
-
cut
[
–em_i
][
–em_j
])/
®pha_ij
;

438 
ty³0
 
	g__r
,
	gp
,
	gtmp0
,
	gxi2
,
	gxi3
,
	gxi4
;

439 
ty³0
* 
	gcÛf
;

443 
ty³0
 
	gH
[3][5]{
DESIG2
(3,5,0.0)};

444 
	gl
=0;l<
	gN
;l++)

446 if(
	gxi
[
l
]<=
low”
 && 
xi
[l]>=
uµ”
) ;

448 
	gxi2
=
xi
[
l
]*xi[l];

449 
	gxi3
=
xi
[
l
]*
xi2
;

450 
	gxi4
=
xi2
*xi2;

452 
	g__r
=
r
-
xi
[
l
]*
®pha_ij
;

453 
	gp
=
çbs
(
__r
)*
dr_šv
;

454 
	gm
=
¡©ic_ÿ¡
<
size_t
>(
p
);

455 
	gm
=
MIN
(
m
,
Ä
-2);

456 
	gp
-=
m
;

457 
	gp
=
MIN
(
p
,1.0);

459 
	gcÛf
=
r_phi_¬r
[
–em_i
][
–em_j
][
m
];

460 
	gtmp0
=((
cÛf
[3]*
p
+coef[2])*p+coef[1])*p+coef[0];

461 if(
	g__r
<0.0è
	gtmp0
*=-1.0;

462 
	gtmp0
*=
wi_0
[
l
];

463 
	gH
[0][0]+=
tmp0
;

464 
	gH
[0][1]+=
tmp0
*
xi
[
l
];

465 
	gH
[0][2]+=
tmp0
*
xi2
;

466 
	gH
[0][3]+=
tmp0
*
xi3
;

467 
	gH
[0][4]+=
tmp0
*
xi4
;

470 
	gcÛf
=
r_rho_¬r
[
–em_i
][
–em_j
][
m
];

471 
	gtmp0
=((
cÛf
[3]*
p
+coef[2])*p+coef[1])*p+coef[0];

472 if(
	g__r
<0.0è
	gtmp0
*=-1.0;

473 
	gtmp0
*=
wi_0
[
l
];

474 
	gH
[1][0]+=
tmp0
;

475 
	gH
[1][1]+=
tmp0
*
xi
[
l
];

476 
	gH
[1][2]+=
tmp0
*
xi2
;

477 
	gH
[1][3]+=
tmp0
*
xi3
;

478 
	gH
[1][4]+=
tmp0
*
xi4
;

480 
	gcÛf
=
r_rho_¬r
[
–em_j
][
–em_i
][
m
];

481 
	gtmp0
=((
cÛf
[3]*
p
+coef[2])*p+coef[1])*p+coef[0];

482 if(
	g__r
<0.0è
	gtmp0
*=-1.0;

483 
	gtmp0
*=
wi_0
[
l
];

484 
	gH
[2][0]+=
tmp0
;

485 
	gH
[2][1]+=
tmp0
*
xi
[
l
];

486 
	gH
[2][2]+=
tmp0
*
xi2
;

487 
	gH
[2][3]+=
tmp0
*
xi3
;

488 
	gH
[2][4]+=
tmp0
*
xi4
;

493 
	gr_šv
=1.0/
r
;

494 
ty³0
 
	gr2_šv
=
r_šv
*r_inv;

495 
ty³0
 
	g®pha_šv
=1.0/
®pha_ij
;

496 
ty³0
 
	g®pha2_šv
=
®pha_šv
*alpha_inv;

497 
ty³0
 
	g®pha4_šv
=
®pha2_šv
*alpha2_inv;

498 
ty³0
 
	gr2®pha2_šv
=
r2_šv
*
®pha2_šv
;

501 
	gAlgeb¿
::
Do
<3>::
func
([&
i¡¬t
,&
H
,&
r_šv
,&
r2_šv
,&
®pha2_šv
,&
r2®pha2_šv
,&
®pha_ij_sq
,&
®pha_šv
,&
rsq
,&
®pha4_šv
,
this
]

502 (
i
)

504 
rho_phi
[
i¡¬t
+
i
]=
PI_IN_SQ
*
r_šv
*
H
[i][0];

505 
drho_phi_dr
[
i¡¬t
+
i
]=-
r2_šv
*(
rho_phi
[i¡¬t+i]+2.0*
PI_IN_SQ
*
®pha_šv
*
H
[i][1]);

506 
drho_phi_d®pha
[
i¡¬t
+
i
]=-
®pha2_šv
*(
rho_phi
[i¡¬t+i]-2.0*
PI_IN_SQ
*
r_šv
*
H
[i][2]);

507 
ddrho_phi_drdr
[
i¡¬t
+
i
]=-
r2_šv
*(3.0*
drho_phi_dr
[i¡¬t+i]-2.0*
drho_phi_d®pha
[istart+i]);

508 
ddrho_phi_drd®pha
[
i¡¬t
+
i
]=-
r2®pha2_šv
*(3.0*
rho_phi
[i¡¬t+i]+3.0*
rsq
*
drho_phi_dr
[i¡¬t+i]+
®pha_ij_sq
*
drho_phi_d®pha
[i¡¬t+i]+4.0*
PI_IN_SQ
*
®pha_šv
*
H
[i][3]);

509 
ddrho_phi_d®phad®pha
[
i¡¬t
+
i
]=-
®pha4_šv
*(3.0*
rho_phi
[i¡¬t+i]+6.0*
®pha_ij_sq
*
drho_phi_d®pha
[i¡¬t+i]-4.0*
PI_IN_SQ
*
r_šv
*
H
[i][4]);

513 
	grho
[
i
]+=
c
[
j
]*
rho_phi
[
i¡¬t
+2];

515 if(
	gj
<
	gn
)

517 
	grho
[
j
]+=
c_i
*
rho_phi
[
i¡¬t
+1];

518 
	g__vec_lş
[0]+=
c_i
*
c
[
j
]*
rho_phi
[
i¡¬t
];

521 
	g__vec_lş
[0]+=0.5*
c_i
*
c
[
j
]*
rho_phi
[
i¡¬t
];

524 
	g__rho
=
rho
[
i
];

525 
	gp
=
__rho
*
drho_šv
;

526 
	gm
=
¡©ic_ÿ¡
<
size_t
>(
p
);

527 
	gm
=
MIN
(
m
,
Äho
-2);

528 
	gp
-=
m
;

529 
	gp
=
MIN
(
p
,1.0);

530 
	gcÛf
=
F_¬r
[
–em_i
][
m
];

533 
	gE
[
i
]=(((
cÛf
[4]*
p
+coef[3])*p+coef[2])*p+coef[1])*p+coef[0];

534 
	gdE
[
i
]=(((4.0*
cÛf
[4]*
p
+3.0*cÛf[3])*p+2.0*cÛf[2])*p+cÛf[1])*
drho_šv
;

537 if(
	g__rho
>
	grho_max
)

539 
	gE
[
i
]+=
dE
[i]*(
__rho
-
rho_max
);

540 
	gddE
[
i
]=0.0;

544 
	gddE
[
i
]=(((12.0*
cÛf
[4]*
p
+6.0*cÛf[3])*p+2.0*cÛf[2]))*
drho_šv
*drho_inv;

547 
	g__vec_lş
[0]+=
c_i
*(
E
[
i
]+
c_0
[
–em_i
]-3.0*
kbT
*
log
(
®pha
[i]));

548 
	g__vec_lş
[1+
__nvoigt__
]+=
ÿlc_’t
(
c_i
);

551 cÚ¡ 
	g__Çtms
=
©oms
->
Çtms_lş
;

552 
ty³0
 
	gcv_i
;

553 
	gi
=0;i<
	g__Çtms
;i++)

555 
	gcv_i
=1.0;

556 
	gic
=0;ic<
	gc_dim
;ic++)

557 if(
	gc
[
i
*
c_dim
+
ic
]>0.0)

558 
	gcv_i
-=
c
[
i
*
c_dim
+
ic
];

559 
	g__vec_lş
[1+
__nvoigt__
]+=
ÿlc_’t
(
cv_i
);

561 
	g__vec_lş
[0]+=
kbT
*
__vec_lş
[1+
__nvoigt__
];

563 
upd©e
(
dE_±r
);

566 
ty³0
* 
	gf_cÛf
=
mu
->
begš
();

567 if(
	gc_dim
!=1)

569 
ty³0
 
c_tÙ
;

570 
	gi
=0;i<
	g__Çtms
;i++)

572 
	gc_tÙ
=0.0;

573 
	gic
=0;ic<
	gc_dim
;ic++)

574 if(
	gc
[
i
*
c_dim
+
ic
]>0.0)

575 
	gc_tÙ
+=
c
[
i
*
c_dim
+
ic
];

576 if(
	gc_tÙ
==0.0)

578 
ic
=0;
	gic
<
	gc_dim
;ic++)

580 if(
	gc
[
i
*
c_dim
+
ic
]==0.0)

581 
f_cÛf
[
i
*
c_dim
+
ic
]=1.0;

583 
	gf_cÛf
[
i
*
c_dim
+
ic
]=0.0;

588 
	gic
=0;ic<
	gc_dim
;ic++)

590 if(
	gc
[
i
*
c_dim
+
ic
]>=0.0)

591 
f_cÛf
[
i
*
c_dim
+
ic
]=
c
[i*c_dim+ic]/
c_tÙ
;

593 
	gf_cÛf
[
i
*
c_dim
+
ic
]=0.0;

601 
	gi
=0;i<
	gn
;i++)

602 if(
	gc
[
i
]>=0.0)

603 
f_cÛf
[
i
]=1.0;

607 cÚ¡ 
	gÇtms_lş
=
©oms
->
Çtms_lş
;

608 
	gdE
=
dE_±r
->
begš
();

609 
ty³0
* 
	gfvec
=
fvec_±r
->
begš
();

610 
ty³0
* 
	gf_®phavec
=
f_®phavec_±r
->
begš
();

611 
	gi
=0;i<
	gn
;i++è
	gf_®phavec
[
i
]=0.0;

612 
	gi
=0;i<
Çtms_lş
*
	g__dim__
;i++è
	gfvec
[
i
]=0.0;

615 
ty³0
 
	gf_i
[
__dim__
]={
DESIG
(__dim__,0.0)};

616 
ty³0
 
	gx_i
[
__dim__
];

617 
ty³0
 
	gdx_ij
[
__dim__
];

618 
ty³0
 
	gåaœ
,
	g­aœ
;

619 
	gi¡¬t
=0;

620 
	gi
=0;i<
	gn
;i++)

622 if(
	gi
%
	gc_dim
==0)

624 
Algeb¿
::
z”o
<
__dim__
>(
f_i
);

625 
	gAlgeb¿
::
V_eq
<
__dim__
>(
x
+(
i
/
c_dim
)*__dim__,
	gx_i
);

628 
ty³0
 
	gc_i
=
c
[
i
];

629 
ty³0
 
	g®pha_i
=
®pha
[
i
];

630 
ty³0
 
	gdE_i
=
dE
[
i
];

631 
ty³0
 
	gf_®pha_i
=0.0;

632 cÚ¡ 
	gÃigh_sz
=
ÃighbÜ_li¡_size
[
i
];

633 
	gj
,
	g__j
=0;__j<
	gÃigh_sz
;__j++,
	gi¡¬t
+=3)

635 
j
=
ÃighbÜ_li¡
[
i
][
__j
];

636 
	gAlgeb¿
::
DX
<
__dim__
>(
x_i
,
	gx
+(
	gj
/
	gc_dim
)*
	g__dim__
,
	gdx_ij
);

638 
	gåaœ
=(
drho_phi_dr
[
i¡¬t
+2]*
dE_i
+drho_phi_dr[i¡¬t+1]*
dE
[
j
]+drho_phi_dr[istart]);

639 
	g­aœ
=(
drho_phi_d®pha
[
i¡¬t
+2]*
dE_i
+drho_phi_d®pha[i¡¬t+1]*
dE
[
j
]+drho_phi_dalpha[istart]);

641 
	gAlgeb¿
::
V_add_x_mul_V
<
__dim__
>(
åaœ
*
c
[
j
]*
f_cÛf
[
i
],
	gdx_ij
,
	gf_i
);

642 
	gf_®pha_i
+=
®pha_i
*
­aœ
*
c
[
j
];

644 if(
	gj
<
	gn
)

646 
	gAlgeb¿
::
V_add_x_mul_V
<
__dim__
>(-
åaœ
*
c_i
*
f_cÛf
[
j
],
	gdx_ij
,
	gfvec
+(
	gj
/
	gc_dim
)*
	g__dim__
);

647 
	gf_®phavec
[
j
]+=
®pha
[j]*
­aœ
*
c_i
;

650 
	gåaœ
*=0.5;

652 
	gAlgeb¿
::
DyadicV
<
__dim__
>(
åaœ
*
c_i
*
c
[
j
],
	gdx_ij
,&
	g__vec_lş
[1]);

656 
	gf_®pha_i
-=3.0*
kbT
/
®pha_i
;

657 
	gf_®phavec
[
i
]+=
f_®pha_i
;

659 if((
	gi
+1)%
	gc_dim
==0)

660 
Algeb¿
::
V_add
<
__dim__
>(
f_i
,
	gfvec
+
	g__dim__
*(
	gi
/
	gc_dim
));

666 
	gFÜûF›ldEAMDMD
::
__J
(
Vec
<
ty³0
>* 
dx_±r
,Vec<ty³0>* 
d®pha_±r
,Vec<ty³0>* 
Adx_±r
,Vec<ty³0>* 
Ad®pha_±r
)

668 
ty³0
* 
	gd–dE
=
E_±r
->
begš
();

669 cÚ¡ 
	gn
=
©oms
->
Çtms_lş
*
c_dim
;

670 cÚ¡ 
	gÂ
=
©oms
->
Çtms_lş
*
__dim__
;

674 
ty³0
 cÚ¡* 
	gc
=
©oms
->
c
->
begš
();

675 cÚ¡ 
ty³0
* 
	gx
=
©oms
->
x
->
begš
();

676 cÚ¡ 
ty³0
* 
	g®pha
=
©oms
->
®pha
->
begš
();

677 
ty³0
* 
	gddE
=
ddE_±r
->
begš
();

678 
ty³0
* 
	gdE
=
dE_±r
->
begš
();

679 ** 
	gÃighbÜ_li¡
=
ÃighbÜ
->
ÃighbÜ_li¡
;

680 * 
	gÃighbÜ_li¡_size
=
ÃighbÜ
->
ÃighbÜ_li¡_size
;

683 
ty³0
* 
	gdx
=
dx_±r
->
begš
();

684 
ty³0
* 
	gd®pha
=
d®pha_±r
->
begš
();

687 
ty³0
* 
	gAdx
=
Adx_±r
->
begš
();

688 
ty³0
* 
	gAd®pha
=
Ad®pha_±r
->
begš
();

690 
ty³0
* 
	gf_cÛf
=
mu
->
begš
();

692 
ty³0
 
	gdx_ij
[
__dim__
];

693 
ty³0
 
	gddx_ij
[
__dim__
];

694 
ty³0
 
	gx_i
[
__dim__
];

695 
ty³0
 
	gdx_i
[
__dim__
];

696 
ty³0
 
	gAdx_i
[
__dim__
];

698 
ty³0
 
	g·œ_®pha_0
,
	g·œ_®pha_1
,
	gdf_·œ
,
	gf_·œ
,
	ga
,
	gb
,
	g®pha_i
,
	gd®pha_i
,
	gAd®pha_i
;

699 
	gi
=0;i<
	gn
;i++)

700 
	gAd®pha
[
i
]=
d–dE
[i]=0.0;

701 
	gi
=0;i<
	gÂ
;i++)

702 
	gAdx
[
i
]=0.0;

705 
size_t
 
	gi¡¬t
=0;

706 
	gi
=0;i<
	gn
;i++)

708 if(
	gi
%
	gc_dim
==0)

710 
Algeb¿
::
V_eq
<
__dim__
>(
x
+(
i
/
c_dim
)*__dim__,
x_i
);

711 
	gAlgeb¿
::
V_eq
<
__dim__
>(
dx
+(
i
/
c_dim
)*__dim__,
	gdx_i
);

712 
	gAlgeb¿
::
z”o
<
__dim__
>(
Adx_i
);

715 
	g®pha_i
=
®pha
[
i
];

716 
	gd®pha_i
=
d®pha
[
i
];

717 
	gAd®pha_i
=0.0;

719 
ty³0
 
	gc_i
=
c
[
i
];

720 if(
	gc_i
<0.0) ;

722 cÚ¡ 
	gÃigh_sz
=
ÃighbÜ_li¡_size
[
i
];

723 
	gj
,
	g__j
=0;__j<
	gÃigh_sz
;__j++,
	gi¡¬t
+=3)

725 
j
=
ÃighbÜ_li¡
[
i
][
__j
];

728 
	gAlgeb¿
::
DX
<
__dim__
>(
x_i
,
	gx
+(
	gj
/
	gc_dim
)*
	g__dim__
,
	gdx_ij
);

729 
	gAlgeb¿
::
DX
<
__dim__
>(
dx_i
,
	gdx
+(
	gj
/
	gc_dim
)*
	g__dim__
,
	gddx_ij
);

731 
	ga
=
Algeb¿
::
V_mul_V
<
__dim__
>(
dx_ij
,
	gddx_ij
);

732 
	gb
=
®pha_i
*
d®pha_i
+
®pha
[
j
]*
d®pha
[j];

734 
	g·œ_®pha_0
=-(

735 (
ddrho_phi_drd®pha
[
i¡¬t
]+ddrho_phi_drd®pha[i¡¬t+2]*
dE
[
i
]+ddrho_phi_drd®pha[i¡¬t+1]*dE[
j
])*
a


736 +(
ddrho_phi_d®phad®pha
[
i¡¬t
]+ddrho_phi_d®phad®pha[i¡¬t+2]*
dE
[
i
]+ddrho_phi_d®phad®pha[i¡¬t+1]*dE[
j
])*
b
);

738 
	g·œ_®pha_1
=-(
drho_phi_d®pha
[
i¡¬t
]+drho_phi_d®pha[i¡¬t+2]*
dE
[
i
]+drho_phi_d®pha[i¡¬t+1]*dE[
j
]);

742 
	gdf_·œ
=-(

743 (
ddrho_phi_drd®pha
[
i¡¬t
]+ddrho_phi_drd®pha[i¡¬t+2]*
dE
[
i
]+ddrho_phi_drd®pha[i¡¬t+1]*dE[
j
])*
b


744 +(
ddrho_phi_drdr
[
i¡¬t
]+ddrho_phi_drdr[i¡¬t+2]*
dE
[
i
]+ddrho_phi_drdr[i¡¬t+1]*dE[
j
])*
a
);

746 
	gf_·œ
=-(
drho_phi_dr
[
i¡¬t
]+drho_phi_dr[i¡¬t+2]*
dE
[
i
]+drho_phi_dr[i¡¬t+1]*dE[
j
]);

751 
	gd–dE
[
i
]+=(
a
*
drho_phi_dr
[
i¡¬t
+2]+
b
*
drho_phi_d®pha
[i¡¬t+2])*
ddE
[i]*
c
[
j
];

752 
	gAlgeb¿
::
V_add_x_mul_V
<
__dim__
>(
df_·œ
*
c
[
j
]*
f_cÛf
[
i
],
	gdx_ij
,
	gAdx_i
);

753 
	gAlgeb¿
::
V_add_x_mul_V
<
__dim__
>(
f_·œ
*
c
[
j
]*
f_cÛf
[
i
],
	gddx_ij
,
	gAdx_i
);

754 
	gAd®pha_i
+=
c
[
j
]*(
·œ_®pha_0
*
®pha_i
+
·œ_®pha_1
*
d®pha_i
);

756 if(
	gj
<
	gn
)

758 
	gd–dE
[
j
]+=(
a
*
drho_phi_dr
[
i¡¬t
+1]+
b
*
drho_phi_d®pha
[i¡¬t+1])*
ddE
[j]*
c
[
i
];

759 
	gAlgeb¿
::
V_add_x_mul_V
<
__dim__
>(-
df_·œ
*
c
[
i
]*
f_cÛf
[
j
],
	gdx_ij
,
	gAdx
+(
	gj
/
	gc_dim
)*
	g__dim__
);

760 
	gAlgeb¿
::
V_add_x_mul_V
<
__dim__
>(-
f_·œ
*
c
[
i
]*
f_cÛf
[
j
],
	gddx_ij
,
	gAdx
+(
	gj
/
	gc_dim
)*
	g__dim__
);

761 
	gAd®pha
[
j
]+=
c
[
i
]*(
·œ_®pha_0
*
®pha
[j]+
·œ_®pha_1
*
d®pha
[j]);

765 
	gf_·œ
*=0.5;

766 
	gdf_·œ
*=0.5;

769 
	gAlgeb¿
::
DyadicV
<
__dim__
>(-
df_·œ
*
c_i
*
c
[
j
],
	gdx_ij
,
	g__vec_lş
);

770 
	gAlgeb¿
::
DyadicV
<
__dim__
>(-
f_·œ
*
c_i
*
c
[
j
],
	gddx_ij
,
	gdx_ij
,
	g__vec_lş
);

775 
	gAd®pha
[
i
]+=
Ad®pha_i
;

776 if((
	gi
+1)%
	gc_dim
==0)

777 
Algeb¿
::
V_add
<
__dim__
>(
Adx_i
,
	gAdx
+
	g__dim__
*(
	gi
/
	gc_dim
));

780 
upd©e
(
E_±r
);

782 
	gd–dE
=
E_±r
->
begš
();

783 
	gi¡¬t
=0;

785 
	gi
=0;i<
	gn
;i++)

787 if(
	gi
%
	gc_dim
==0)

789 
Algeb¿
::
z”o
<
__dim__
>(
Adx_i
);

790 
	gAlgeb¿
::
V_eq
<
__dim__
>(
x
+(
i
/
c_dim
)*__dim__,
	gx_i
);

793 
	g®pha_i
=
®pha
[
i
];

794 
	gd®pha_i
=
d®pha
[
i
];

795 
	gAd®pha_i
=0.0;

797 
ty³0
 
	gc_i
=
c
[
i
];

798 if(
	gc_i
<0.0) ;

800 cÚ¡ 
	gÃigh_sz
=
ÃighbÜ_li¡_size
[
i
];

801 
	gj
,
	g__j
=0;__j<
	gÃigh_sz
;__j++,
	gi¡¬t
+=3)

803 
j
=
ÃighbÜ_li¡
[
i
][
__j
];

804 
	gAlgeb¿
::
DX
<
__dim__
>(
x_i
,
	gx
+(
	gj
/
	gc_dim
)*
	g__dim__
,
	gdx_ij
);

806 
	gdf_·œ
=-(
drho_phi_dr
[
i¡¬t
+2]*
d–dE
[
i
]+drho_phi_dr[i¡¬t+1]*d–dE[
j
]);

807 
	g·œ_®pha_0
=-(
drho_phi_d®pha
[
i¡¬t
+2]*
d–dE
[
i
]+drho_phi_d®pha[i¡¬t+1]*d–dE[
j
]);

809 
	gAlgeb¿
::
V_add_x_mul_V
<
__dim__
>(
df_·œ
*
c
[
j
]*
f_cÛf
[
i
],
	gdx_ij
,
	gAdx_i
);

810 
	gAd®pha_i
+=
®pha_i
*
·œ_®pha_0
*
c
[
j
];

812 if(
	gj
<
	gn
)

814 
	gAlgeb¿
::
V_add_x_mul_V
<
__dim__
>(-
df_·œ
*
c_i
*
f_cÛf
[
j
],
	gdx_ij
,
	gAdx
+(
	gj
/
	gc_dim
)*
	g__dim__
);

815 
	gAd®pha
[
j
]+=
®pha
[j]*
·œ_®pha_0
*
c_i
;

818 
	gdf_·œ
*=0.5;

820 
	gAlgeb¿
::
DyadicV
<
__dim__
>(-
df_·œ
*
c_i
*
c
[
j
],
	gdx_ij
,
	g__vec_lş
);

825 
	gAd®pha
[
i
]+=
Ad®pha_i
-3.0*
kbT
*
d®pha_i
/(
®pha_i
*alpha_i);

826 if((
	gi
+1)%
	gc_dim
==0)

827 
Algeb¿
::
V_add
<
__dim__
>(
Adx_i
,
	gAdx
+
	g__dim__
*(
	gi
/
	gc_dim
));

833 
	gFÜûF›ldEAMDMD
::
	$__’”gy_ÿlc
()

835 
ty³0
* 
rho
=
ddE_±r
->
	`begš
();

836 cÚ¡ 
n
=
©oms
->
Çtms_lş
*
c_dim
;

837 
i
=0;i<
n
;i++è
rho
[i]=0.0;

839 
–em_ty³
 cÚ¡* 
–em_vec
=
©oms
->
–em
->
	`begš
();

841 
ty³0
 
®pha_ij
,
rsq
,
r
,
r_šv
,
p
,
tmp0
,
tmp1
;

842 
–em_ty³
 
–em_i
,
–em_j
;

843 
size_t
 
m
;

845 cÚ¡ 
ty³0
* 
x
=
©oms
->x->
	`begš
();

846 cÚ¡ 
ty³0
* 
®pha
=
©oms
->®pha->
	`begš
();

847 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->neighbor_list;

848 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->neighbor_list_size;

849 
ty³0
 cÚ¡* 
c
=
©oms
->c->
	`begš
();

850 
ty³0
 cÚ¡* 
cÛf
;

852 
size_t
 
i¡¬t
=0;

853 
i
=0;i<
n
;i++)

855 
–em_i
=
–em_vec
[
i
];

856 cÚ¡ 
Ãigh_sz
=
ÃighbÜ_li¡_size
[
i
];

857 
j
,
__j
=0;__j<
Ãigh_sz
;__j++,
i¡¬t
+=3)

859 
j
=
ÃighbÜ_li¡
[
i
][
__j
];

860 
–em_j
=
–em_vec
[
j
];

861 
rsq
=
Algeb¿
::
RSQ
<
__dim__
>(
x
+(
i
/
c_dim
)*__dim__,x+(
j
/c_dim)*__dim__);

862 
r
=
	`sq¹
(
rsq
);

863 
®pha_ij
=
	`sq¹
(
®pha
[
i
]*®pha[i]+®pha[
j
]*alpha[j]);

864 if(
r
-
®pha_ij
*
xi
[
N
-1]>=
cut
[
–em_i
][
–em_j
]) ;

866 
ty³0
 
uµ”
=(
r
+
cut
[
–em_i
][
–em_j
])/
®pha_ij
;

867 
ty³0
 
low”
=(
r
-
cut
[
–em_i
][
–em_j
])/
®pha_ij
;

868 
ty³0
 
__r
,
p
,
tmp0
,
tmp1
;

869 
ty³0
* 
cÛf
;

871 
r_šv
=1.0/
r
;

873 
ty³0
 
__¬r
[3]{
	`DESIG
(3,0.0)};

874 
l
=0;l<
N
;l++)

876 if(
xi
[
l
]<=
low”
 && xi[l]>=
uµ”
) ;

878 
__r
=
r
-
xi
[
l
]*
®pha_ij
;

879 
p
=
	`çbs
(
__r
)*
dr_šv
;

880 
m
=
¡©ic_ÿ¡
<
size_t
>(
p
);

881 
m
=
	`MIN
(m,
Ä
-2);

882 
p
-=
m
;

883 
p
=
	`MIN
(p,1.0);

885 
cÛf
=
r_phi_¬r
[
–em_i
][
–em_j
][
m
];

886 
tmp0
=((
cÛf
[3]*
p
+coef[2])*p+coef[1])*p+coef[0];

887 
tmp1
=((3.0*
cÛf
[3]*
p
+2.0*cÛf[2])*p+cÛf[1])*
dr_šv
;

888 if(
__r
<0.0è
tmp0
*=-1.0;

889 
__¬r
[0]+=
wi_0
[
l
]*
tmp0
;

892 
cÛf
=
r_rho_¬r
[
–em_i
][
–em_j
][
m
];

893 
tmp0
=((
cÛf
[3]*
p
+coef[2])*p+coef[1])*p+coef[0];

894 
tmp1
=((3.0*
cÛf
[3]*
p
+2.0*cÛf[2])*p+cÛf[1])*
dr_šv
;

895 if(
__r
<0.0è
tmp0
*=-1.0;

896 
__¬r
[1]+=
wi_0
[
l
]*
tmp0
;

898 
cÛf
=
r_rho_¬r
[
–em_j
][
–em_i
][
m
];

899 
tmp0
=((
cÛf
[3]*
p
+coef[2])*p+coef[1])*p+coef[0];

900 
tmp1
=((3.0*
cÛf
[3]*
p
+2.0*cÛf[2])*p+cÛf[1])*
dr_šv
;

901 if(
__r
<0.0è
tmp0
*=-1.0;

902 
__¬r
[2]+=
wi_0
[
l
]*
tmp0
;

905 
tmp0
=
PI_IN_SQ
*
r_šv
;

907 
Algeb¿
::
Do
<3>::
	`func
([&
__¬r
,&
tmp0
,
this
](
i
)

909 
__¬r
[
i
]*=
tmp0
;

912 
rho
[
i
]+=
c
[
j
]*
__¬r
[2];

914 if(
j
<
n
)

916 
rho
[
j
]+=
c
[
i
]*
__¬r
[1];

917 
__vec_lş
[0]+=
c
[
i
]*c[
j
]*
__¬r
[0];

920 
__vec_lş
[0]+=0.5*
c
[
i
]*c[
j
]*
__¬r
[0];

924 if(
c
[
i
]<0.0) ;

925 
tmp0
=
rho
[
i
];

926 
p
=
tmp0
*
drho_šv
;

927 
m
=
¡©ic_ÿ¡
<
size_t
>(
p
);

928 
m
=
	`MIN
(m,
Äho
-2);

929 
p
-=
m
;

930 
p
=
	`MIN
(p,1.0);

931 
cÛf
=
F_¬r
[
–em_i
][
m
];

932 
tmp1
=(((
cÛf
[4]*
p
+coef[3])*p+coef[2])*p+coef[1])*p+coef[0];

933 if(
rho
[
i
]>
rho_max
)

934 
tmp1
+=(((4.0*
cÛf
[4]*
p
+3.0*cÛf[3])*p+2.0*cÛf[2])*p+cÛf[1])*
drho_šv
*(
tmp0
-
rho_max
);

936 if(
c
[
i
]!=0.0)

937 
__vec_lş
[0]+=
c
[
i
]*(
tmp1
+
c_0
[
–em_i
]-3.0*
kbT
*
	`log
(
®pha
[i]));

938 
__vec_lş
[1+
__nvoigt__
]+=
	`ÿlc_’t
(
c
[
i
]);

940 cÚ¡ 
__Çtms
=
©oms
->
Çtms_lş
;

941 
ty³0
 
cv_i
;

942 
i
=0;i<
__Çtms
;i++)

944 
cv_i
=1.0;

945 
ic
=0;ic<
c_dim
;ic++)

946 if(
c
[
i
*
c_dim
+
ic
]>0.0)

947 
cv_i
-=
c
[
i
*
c_dim
+
ic
];

948 
__vec_lş
[1+
__nvoigt__
]+=
	`ÿlc_’t
(
cv_i
);

950 
__vec_lş
[0]+=
kbT
*__vec_lş[1+
__nvoigt__
];

951 
	}
}

955 
	gFÜûF›ldEAMDMD
::
	$š™
()

957 
	`´e_š™
();

958 
	`£t_‹mp
();

961 
cv_±r
=
Ãw
 
Vec
<
ty³0
>(
©oms
,1);

962 
E_±r
=
Ãw
 
Vec
<
ty³0
>(
©oms
,
c_dim
);

963 
dE_±r
=
Ãw
 
Vec
<
ty³0
>(
©oms
,
c_dim
);

964 
ddE_±r
=
Ãw
 
Vec
<
ty³0
>(
©oms
,
c_dim
);

965 
	}
}

969 
	gFÜûF›ldEAMDMD
::
	$fš
()

972 
MemÜy
::
	`d—Îoc
(
rho_phi
);

973 
MemÜy
::
	`d—Îoc
(
drho_phi_dr
);

974 
MemÜy
::
	`d—Îoc
(
drho_phi_d®pha
);

977 
MemÜy
::
	`d—Îoc
(
ddrho_phi_drdr
);

978 
MemÜy
::
	`d—Îoc
(
ddrho_phi_d®phad®pha
);

979 
MemÜy
::
	`d—Îoc
(
ddrho_phi_drd®pha
);

980 
max_·œs0
=
max_·œs1
=0;

982 
d–‘e
 
ddE_±r
;

983 
d–‘e
 
dE_±r
;

984 
d–‘e
 
E_±r
;

985 
d–‘e
 
cv_±r
;

987 
dE_±r
=
ddE_±r
=
cv_±r
=
vec0
=
vec1
=
vec2
=
vec3
=
NULL
;

988 
	`po¡_fš
();

989 
	}
}

993 
	gFÜûF›ldEAMDMD
::
	$š™_¡©ic
()

995 
MemÜy
::
	`®loc
(
M_IJ
,4*
ÃighbÜ
->
no_·œs_2nd
);

996 
vec0
=
Ãw
 
Vec
<
ty³0
>(
©oms
,
c_dim
);

997 
vec1
=
Ãw
 
Vec
<
ty³0
>(
©oms
,1);

998 
vec2
=
Ãw
 
Vec
<
ty³0
>(
©oms
,
c_dim
);

999 
vec3
=
Ãw
 
Vec
<
ty³0
>(
©oms
,
c_dim
);

1000 
fcÛf_±r
=
Ãw
 
Vec
<
ty³0
>(
©oms
,1);

1002 cÚ¡ 
__Çtms_lş
=
©oms
->
Çtms_lş
;

1003 
ty³0
* 
f_cÛf
=
fcÛf_±r
->
	`begš
();

1004 
ty³0
* 
c
=
©oms
->c->
	`begš
();

1005 if(
c_dim
!=1)

1007 
ty³0
 
c_tÙ
;

1008 
i
=0;i<
__Çtms_lş
;i++)

1010 
c_tÙ
=0.0;

1011 
ic
=0;ic<
c_dim
;ic++)

1012 if(
c
[
i
*
c_dim
+
ic
]>0.0)

1013 
c_tÙ
+=
c
[
i
*
c_dim
+
ic
];

1014 if(
c_tÙ
==0.0)

1016 
ic
=0;ic<
c_dim
;ic++)

1018 if(
c
[
i
*
c_dim
+
ic
]==0.0)

1019 
f_cÛf
[
i
*
c_dim
+
ic
]=1.0;

1021 
f_cÛf
[
i
*
c_dim
+
ic
]=0.0;

1026 
ic
=0;ic<
c_dim
;ic++)

1028 if(
c
[
i
*
c_dim
+
ic
]>=0.0)

1029 
f_cÛf
[
i
*
c_dim
+
ic
]=
c
[i*c_dim+ic]/
c_tÙ
;

1031 
f_cÛf
[
i
*
c_dim
+
ic
]=0.0;

1039 cÚ¡ 
n
=
__Çtms_lş
*
c_dim
;

1040 
i
=0;i<
n
;i++)

1041 if(
c
[
i
]>=0.0)

1042 
f_cÛf
[
i
]=1.0;

1044 
	}
}

1048 
	gFÜûF›ldEAMDMD
::
	$fš_¡©ic
()

1050 
d–‘e
 
fcÛf_±r
;

1051 
d–‘e
 
vec3
;

1052 
d–‘e
 
vec2
;

1053 
d–‘e
 
vec1
;

1054 
d–‘e
 
vec0
;

1055 
MemÜy
::
	`d—Îoc
(
M_IJ
);

1056 
	}
}

1060 
	gFÜûF›ldEAMDMD
::
	$£t_‹mp
()

1062 
ty³0
 
T
=
©oms
->
‹mp
;

1063 
ty³0
 
kb
=
©oms
->
kB
;

1064 
ty³0
 
hP
=
©oms
->hP;

1065 
ty³0
 
mass
;

1066 
ty³0
 
deb_l
;

1068 
size_t
 
i
=0;i<
ÃËms
;i++)

1070 
mass
=
©oms
->
–em’ts
.
mas£s
[
i
];

1071 
c_1
[
i
]=
	`sq¹
(0.5*
kb
*
T
/
mass
)/
M_PI
;

1072 
deb_l
=
hP
*hP/(2.0*
M_PI
*M_PI*
mass
*
kb
*
T
);

1073 
c_0
[
i
]=1.5*
kb
*
T
*(
	`log
(
deb_l
)-1.0);

1076 
kbT
=
kb
*
T
;

1077 
b‘a
=1.0/
kbT
;

1078 
	}
}

1082 
šlše
 
ty³0
 
	gFÜûF›ldEAMDMD
::
	$ÿlc_’t
(
ty³0
 
x
)

1084 if(
x
==0.0)  0.0;

1085  
x
*
	`log
(x);

1086 
	}
}

1102 
	gFÜûF›ldEAMDMD
::
	$ÿlc_mu
()

1111 cÚ¡ 
ty³0
* 
®pha
=
©oms
->®pha->
	`begš
();

1112 
ty³0
 cÚ¡* 
c
=
©oms
->c->
	`begš
();

1113 
–em_ty³
 cÚ¡* 
–em_vec
=
©oms
->
–em
->
	`begš
();

1116 
ty³0
* 
cv
=
cv_±r
->
	`begš
();

1118 
Çtms_lş
=
©oms
->natms_lcl;

1119 
ty³0
 
’
=0.0;

1120 
i
=0;i<
Çtms_lş
;i++)

1122 
ty³0
 
cv_i
=1.0;

1123 
j
=0;j<
c_dim
;j++)

1124 if(
c
[
i
*
c_dim
+
j
]>0.0)

1126 
__vec_lş
[1+
__nvoigt__
]+=
	`ÿlc_’t
(
c
[
i
*
c_dim
+
j
]);

1127 
’
+=
c
[
i
*
c_dim
+
j
]*

1128 (
c_0
[
–em_vec
[
i
*
c_dim
+
j
]]-3.0*
kbT
*
	`log
(
®pha
[i*c_dim+j]));

1129 
cv_i
-=
c
[
i
*
c_dim
+
j
];

1131 
cv
[
i
]=
cv_i
;

1132 
__vec_lş
[1+
__nvoigt__
]+=
	`ÿlc_’t
(
cv_i
);

1135 
__vec_lş
[0]+=
’
;

1136 
__vec_lş
[0]+=
kbT
*__vec_lş[1+
__nvoigt__
];

1142 
ÇÎ
=
Çtms_lş
+
©oms
->
Çtms_ph
;

1143 
i
=
Çtms_lş
;i<
ÇÎ
;i++)

1145 
ty³0
 
cv_i
=1.0;

1146 
j
=0;j<
c_dim
;j++)

1147 if(
c
[
i
*
c_dim
+
j
]>0.0)

1148 
cv_i
-=
c
[
i
*
c_dim
+
j
];

1149 
cv
[
i
]=
cv_i
;

1158 
ty³0
* 
rho
=
E_±r
->
	`begš
();

1159 
ty³0
* 
mu_vec
=
mu
->
	`begš
();

1161 
n
=
©oms
->
Çtms_lş
*
c_dim
;

1162 
i
=0;i<
n
;i++è
mu_vec
[i]=
rho
[i]=0.0;

1164 
size_t
 
m
;

1165 
ty³0
 
p
,
__E
,
__dE
,
__rho
;

1166 
ty³0
* 
cÛf
;

1169 
ty³0
* 
dE
=
dE_±r
->
	`begš
();

1170 
ty³0
* 
ddE
=
ddE_±r
->
	`begš
();

1171 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->neighbor_list;

1172 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->neighbor_list_size;

1173 
size_t
 
i¡¬t
=0;

1174 
i
=0;i<
n
;i++)

1176 if(
c
[
i
]<0.0) ;

1177 cÚ¡ 
Ãigh_sz
=
ÃighbÜ_li¡_size
[
i
];

1178 
j
,
__j
=0;__j<
Ãigh_sz
;__j++,
i¡¬t
+=3)

1180 
j
=
ÃighbÜ_li¡
[
i
][
__j
];

1181 
rho
[
i
]+=
c
[
j
]*
rho_phi
[
i¡¬t
+2];

1183 if(
j
<
n
)

1184 
rho
[
j
]+=
c
[
i
]*
rho_phi
[
i¡¬t
+1];

1187 
__rho
=
rho
[
i
];

1188 
p
=
__rho
*
drho_šv
;

1189 
m
=
¡©ic_ÿ¡
<
size_t
>(
p
);

1190 
m
=
	`MIN
(m,
Äho
-2);

1191 
p
-=
m
;

1192 
p
=
	`MIN
(p,1.0);

1193 
cÛf
=
F_¬r
[
–em_vec
[
i
]][
m
];

1195 
__E
=(((
cÛf
[4]*
p
+coef[3])*p+coef[2])*p+coef[1])*p+coef[0];

1196 
__dE
=(((4.0*
cÛf
[4]*
p
+3.0*cÛf[3])*p+2.0*cÛf[2])*p+cÛf[1])*
drho_šv
;

1197 
ddE
[
i
]=(((12.0*
cÛf
[4]*
p
+6.0*cÛf[3])*p+2.0*cÛf[2]))*
drho_šv
*drho_inv;

1198 if(
__rho
>
rho_max
)

1199 
__E
+=
__dE
*(
__rho
-
rho_max
);

1201 
__vec_lş
[0]+=
c
[
i
]*
__E
;

1202 
rho
[
i
]=
__E
;

1203 
mu_vec
[
i
]+=
__E
;

1204 
dE
[
i
]=
__dE
;

1207 
	`upd©e
(
dE_±r
);

1210 
ty³0
* 
fcÛf
=
fcÛf_±r
->
	`begš
();

1211 
ty³0
* 
çÍha
=
f_®pha
->
	`begš
();

1212 
ty³0
* 
fvec
=
f
->
	`begš
();

1213 
	`mem£t
(
çÍha
,0,(
ty³0
)*
n
);

1214 
	`mem£t
(
fvec
,0,(
ty³0
)*
__dim__
*
©oms
->
Çtms_lş
);

1246 
ty³0
* 
x
=
©oms
->x->
	`begš
();

1247 
ty³0
 
f_i
[
__dim__
]={
	`DESIG
(__dim__,0.0)};

1248 
ty³0
 
x_i
[
__dim__
];

1249 
ty³0
 
dx_ij
[
__dim__
];

1250 
ty³0
 
åaœ
,
­aœ
;

1251 
i¡¬t
=0;

1252 
i
=0;i<
n
;i++)

1254 if(
i
%
c_dim
==0)

1256 
Algeb¿
::
z”o
<
__dim__
>(
f_i
);

1257 
Algeb¿
::
V_eq
<
__dim__
>(
x
+(
i
/
c_dim
)*__dim__,
x_i
);

1260 
ty³0
 
c_i
=
c
[
i
];

1261 
ty³0
 
®pha_i
=
®pha
[
i
];

1262 
ty³0
 
dE_i
=
dE
[
i
];

1263 
ty³0
 
f_®pha_i
=0.0;

1264 cÚ¡ 
Ãigh_sz
=
ÃighbÜ_li¡_size
[
i
];

1265 
j
,
__j
=0;__j<
Ãigh_sz
;__j++,
i¡¬t
+=3)

1267 
j
=
ÃighbÜ_li¡
[
i
][
__j
];

1268 
mu_vec
[
i
]+=
c
[
j
]*(
rho_phi
[
i¡¬t
]+rho_phi[i¡¬t+1]*
dE
[j]);

1269 
Algeb¿
::
DX
<
__dim__
>(
x_i
,
x
+(
j
/
c_dim
)*__dim__,
dx_ij
);

1271 
åaœ
=(
drho_phi_dr
[
i¡¬t
+2]*
dE_i
+drho_phi_dr[i¡¬t+1]*
dE
[
j
]+drho_phi_dr[istart]);

1272 
­aœ
=(
drho_phi_d®pha
[
i¡¬t
+2]*
dE_i
+drho_phi_d®pha[i¡¬t+1]*
dE
[
j
]+drho_phi_dalpha[istart]);

1274 
Algeb¿
::
V_add_x_mul_V
<
__dim__
>(
åaœ
*
c
[
j
]*
fcÛf
[
i
],
dx_ij
,
f_i
);

1275 
f_®pha_i
+=
®pha_i
*
­aœ
*
c
[
j
];

1277 if(
j
<
n
)

1279 
mu_vec
[
j
]+=
c
[
i
]*(
rho_phi
[
i¡¬t
]+rho_phi[i¡¬t+2]*
dE
[i]);

1280 
Algeb¿
::
V_add_x_mul_V
<
__dim__
>(-
åaœ
*
c_i
*
fcÛf
[
j
],
dx_ij
,
fvec
+(j/
c_dim
)*__dim__);

1281 
çÍha
[
j
]+=
®pha
[j]*
­aœ
*
c_i
;

1282 
__vec_lş
[0]+=
c
[
i
]*c[
j
]*
rho_phi
[
i¡¬t
];

1285 
__vec_lş
[0]+=0.5*
c
[
i
]*c[
j
]*
rho_phi
[
i¡¬t
];

1288 
f_®pha_i
-=3.0*
kbT
/
®pha_i
;

1289 
çÍha
[
i
]+=
f_®pha_i
;

1291 if((
i
+1)%
c_dim
==0)

1292 
Algeb¿
::
V_add
<
__dim__
>(
f_i
,
fvec
+__dim__*(
i
/
c_dim
));

1296 
	`upd©e
(
mu
);

1299 
	}
}

1303 
	gFÜûF›ldEAMDMD
::
	$__fÜû_ÿlc_¡©ic
()

1305 
n
=
©oms
->
Çtms_lş
*
c_dim
;

1306 
ty³0
 cÚ¡* 
E
=
E_±r
->
	`begš
();

1307 
ty³0
 cÚ¡* 
c
=
©oms
->c->
	`begš
();

1308 
ty³0
 cÚ¡* 
cv
=
cv_±r
->
	`begš
();

1309 
ty³0
 cÚ¡* 
®pha
=
©oms
->®pha->
	`begš
();

1310 
–em_ty³
 cÚ¡* 
–em
=
©oms
->–em->
	`begš
();

1311 
i
=0;i<
n
;i++)

1313 if(
i
%
c_dim
==0)

1314 
__vec_lş
[1+
__nvoigt__
]+=
	`ÿlc_’t
(
cv
[
i
]);

1315 if(
c
[
i
]>=0.0)

1317 
__vec_lş
[0]+=
c
[
i
]*(
E
[i]+
c_0
[
–em
[i]]-3.0*
kbT
*
	`log
(
®pha
[i]));

1318 
__vec_lş
[1+
__nvoigt__
]+=
	`ÿlc_’t
(
c
[
i
]);

1322 
__vec_lş
[0]+=
kbT
*__vec_lş[1+
__nvoigt__
];

1324 
ty³0
 cÚ¡* 
dE
=
dE_±r
->
	`begš
();

1325 
ty³0
 cÚ¡* 
x
=
©oms
->x->
	`begš
();

1329 
ty³0
 
x_i
[
__dim__
];

1330 
ty³0
 
dx_ij
[
__dim__
];

1332 
ty³0
 
åaœ
;

1333 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->neighbor_list;

1334 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->neighbor_list_size;

1335 
size_t
 
i¡¬t
=0;

1336 
i
=0;i<
n
;i++)

1338 if(
i
%
c_dim
==0è
Algeb¿
::
V_eq
<
__dim__
>(
x
+(i/c_dim)*__dim__,
x_i
);

1339 
ty³0
 
c_i
=
c
[
i
];

1340 
ty³0
 
dE_i
=
dE
[
i
];

1341 cÚ¡ 
Ãigh_sz
=
ÃighbÜ_li¡_size
[
i
];

1343 
j
,
__j
=0;__j<
Ãigh_sz
;__j++,
i¡¬t
+=3)

1345 
j
=
ÃighbÜ_li¡
[
i
][
__j
];

1346 
Algeb¿
::
DX
<
__dim__
>(
x_i
,
x
+(
j
/
c_dim
)*__dim__,
dx_ij
);

1347 
åaœ
=-(
drho_phi_dr
[
i¡¬t
+2]*
dE_i
+drho_phi_dr[i¡¬t+1]*
dE
[
j
]+drho_phi_dr[i¡¬t])*
c_i
*
c
[j];

1348 if(
j
<
n
)

1349 
__vec_lş
[0]+=
rho_phi
[
i¡¬t
]*
c_i
*
c
[
j
];

1352 
åaœ
*=0.5;

1353 
__vec_lş
[0]+=0.5*
rho_phi
[
i¡¬t
]*
c_i
*
c
[
j
];

1356 
Algeb¿
::
DyadicV
<
__dim__
>(-
åaœ
,
dx_ij
,&
__vec_lş
[1]);

1359 
	}
}

1377 
	gFÜûF›ldEAMDMD
::
	$__c_d_ÿlc
()

1379 
	`ÿlc_mu
();

1382 cÚ¡ 
ty³0
* 
x
=
©oms
->x->
	`begš
();

1383 cÚ¡ 
ty³0
* 
®pha
=
©oms
->®pha->
	`begš
();

1384 cÚ¡ 
ty³0
* 
c
=
©oms
->c->
	`begš
();

1385 cÚ¡ 
–em_ty³
* 
–em_vec
=
©oms
->
–em
->
	`begš
();

1386 
ty³0
* 
__c_d
=
c_d
->
	`begš
();

1390 
ty³0
* 
cv
=
cv_±r
->
	`begš
();

1391 
ty³0
* 
mu_vec
=
mu
->
	`begš
();

1394 
ty³0
 
rsq
,
®pha_i
,
®pha_j
,
®pha_sq_i
,
®pha_sq_j
,
gamma_i
,
gamma_j
,
mu_i
,
mu_ji
;

1395 
ty³0
 
Q_i
,
gamma_ij_šv
,
th‘a_i
,
th‘a_j
,
d_i
,
d_j
,
cÛf0
;

1396 
ty³0
 
dc_ij
,
c_1_›Ëm
,
z‘a_›Ëm
;

1397 
size_t
 
i¡¬t
=0;

1398 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->
ÃighbÜ_li¡_2nd
;

1399 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->
ÃighbÜ_li¡_size_2nd
;

1400 cÚ¡ 
n
=
©oms
->
Çtms_lş
*
c_dim
;

1402 
ty³0
 
c_d_nÜm_lş
=0.0;

1403 
i
=0;i<
n
;i++)

1405 if(
c
[
i
]<0.0) ;

1406 
®pha_i
=
®pha
[
i
];

1407 
®pha_sq_i
=
®pha_i
*alpha_i;

1408 
mu_i
=
mu_vec
[
i
];

1409 
c_1_›Ëm
=
c_1
[
–em_vec
[
i
]];

1410 
z‘a_›Ëm
=
z‘a
[
–em_vec
[
i
]];

1411 cÚ¡ 
Ãigh_sz
=
ÃighbÜ_li¡_size
[
i
];

1412 
j
,
__j
=0;__j<
Ãigh_sz
;__j++,
i¡¬t
+=4)

1414 
j
=
ÃighbÜ_li¡
[
i
][
__j
];

1415 if(!
dof_c_em±y
 && !(
©oms
->
c_dof
->
	`begš
()[
i
] &&‡toms->c_dof->begš()[
j
]))

1417 
M_IJ
[
i¡¬t
]=0.0;

1418 
M_IJ
[
i¡¬t
+1]=0.0;

1419 
M_IJ
[
i¡¬t
+2]=0.0;

1420 
M_IJ
[
i¡¬t
+3]=0.0;

1423 
®pha_j
=
®pha
[
j
];

1424 
®pha_sq_j
=
®pha_j
*alpha_j;

1425 
rsq
=
Algeb¿
::
RSQ
<
__dim__
>(
x
+(
i
/
c_dim
)*__dim__,x+(
j
/c_dim)*__dim__);

1426 
gamma_i
=
rsq
/(
z‘a_›Ëm
*
®pha_sq_i
);

1427 
gamma_j
=
rsq
/(
z‘a_›Ëm
*
®pha_sq_j
);

1428 
mu_ji
=
b‘a
*(
mu_vec
[
j
]-
mu_i
);

1429 
	`ÿlc_Q
(
gamma_i
,
gamma_j
,
mu_ji
,
Q_i
,
gamma_ij_šv
,
th‘a_i
);

1432 
cÛf0
=-
c_1_›Ëm
*
rsq
*
gamma_ij_šv
*
	`exp
(-
Q_i
+0.5*
mu_ji
);

1444 
th‘a_j
=
th‘a_i
+1.0;

1446 
dc_ij
=
cÛf0
*(
c
[
i
]*
cv
[
j
/
c_dim
]*
	`exp
(-0.5*
mu_ji
)/(
®pha_sq_i
*
®pha_i
)-c[j]*cv[i/c_dim]*exp(0.5*mu_ji)/(
®pha_sq_j
*
®pha_j
));

1453 
d_i
=
	`exp
(-0.5*
mu_ji
)/(
®pha_sq_i
*
®pha_i
);

1454 
d_j
=
	`exp
(0.5*
mu_ji
)/(
®pha_sq_j
*
®pha_j
);

1456 
M_IJ
[
i¡¬t
]=
b‘a
*(
th‘a_i
*
c
[
i
]*
cv
[
j
/
c_dim
]*
d_i
-
th‘a_j
*c[j]*cv[i/c_dim]*
d_j
);

1457 
M_IJ
[
i¡¬t
+1]=
d_i
;

1458 
M_IJ
[
i¡¬t
+2]=
d_j
;

1459 
M_IJ
[
i¡¬t
+3]=
cÛf0
;

1462 
__c_d
[
i
]+=
dc_ij
;

1464 if(
j
<
n
)

1465 
__c_d
[
j
]-=
dc_ij
;

1467 
c_d_nÜm_lş
=
	`MAX
(c_d_nÜm_lş,
	`çbs
(
__c_d
[
i
]));

1470 
	`MPI_AÎ»duû
(&
c_d_nÜm_lş
,&
c_d_nÜm
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_MAX
,
©oms
->
wÜld
);

1471 
	}
}

1493 
	gFÜûF›ldEAMDMD
::
__J
(
Vec
<
ty³0
>* 
x_±r
,Vec<ty³0>* 
Ax_±r
)

1495 
upd©e
(
x_±r
);

1498 
ty³0
* 
	gc
=
©oms
->
c
->
begš
();

1501 
ty³0
* 
	gddE
=
ddE_±r
->
begš
();

1502 
ty³0
* 
	gdE
=
dE_±r
->
begš
();

1503 
ty³0
* 
	gb0
=
vec0
->
begš
();

1506 
ty³0
* 
	gx
=
x_±r
->
begš
();

1507 
ty³0
* 
	gAx
=
Ax_±r
->
begš
();

1509 ** 
	gÃighbÜ_li¡
=
ÃighbÜ
->
ÃighbÜ_li¡
;

1510 * 
	gÃighbÜ_li¡_size
=
ÃighbÜ
->
ÃighbÜ_li¡_size
;

1511 
size_t
 
	gi¡¬t
=0;

1512 cÚ¡ 
	gn
=
©oms
->
Çtms_lş
*
c_dim
;

1513 
	gi
=0;i<
	gn
;i++è
	gb0
[
i
]=
Ax
[i]=0.0;

1514 
	gi
=0;i<
	gn
;i++)

1516 cÚ¡ 
	gÃigh_sz
=
ÃighbÜ_li¡_size
[
i
];

1517 
ty³0
 
	gci_dEEi
=
c
[
i
]*
ddE
[i];

1518 
	gj
,
	g__j
=0;__j<
	gÃigh_sz
;__j++,
	gi¡¬t
+=3)

1520 
j
=
ÃighbÜ_li¡
[
i
][
__j
];

1521 
	gAx
[
i
]+=
ci_dEEi
*
rho_phi
[
i¡¬t
+2]*
x
[
j
];

1522 if(
	gj
<
	gn
)

1523 
	gAx
[
j
]+=
c
[j]*
ddE
[j]*
rho_phi
[
i¡¬t
+1]*
x
[
i
];

1527 
upd©e
(
Ax_±r
);

1530 
ty³0
 
	gtmp0
;

1531 
	gi¡¬t
=0;

1532 
	gi
=0;i<
	gn
;i++)

1534 cÚ¡ 
	gÃigh_sz
=
ÃighbÜ_li¡_size
[
i
];

1535 
	gj
,
	g__j
=0;__j<
	gÃigh_sz
;__j++,
	gi¡¬t
+=3)

1537 
j
=
ÃighbÜ_li¡
[
i
][
__j
];

1538 
	gtmp0
=
rho_phi
[
i¡¬t
]+
dE
[
i
]*rho_phi[i¡¬t+2]+dE[
j
]*rho_phi[istart+1];

1539 
	gb0
[
i
]+=
rho_phi
[
i¡¬t
+1]*
Ax
[
j
]+
tmp0
*
x
[j];

1540 if(
	gj
<
	gn
)

1541 
	gb0
[
j
]+=
rho_phi
[
i¡¬t
+2]*
Ax
[
i
]+
tmp0
*
x
[i];

1545 
upd©e
(
vec0
);

1549 
ty³0
* 
	gxv
=
vec1
->
begš
();

1550 
ty³0
* 
	gcv
=
cv_±r
->
begš
();

1552 cÚ¡ 
	gÇÎ
=
©oms
->
Çtms_lş
+©oms->
Çtms_ph
;

1553 
	gi
=0;i<
	gÇÎ
;i++)

1555 
	gxv
[
i
]=0.0;

1556 
	gj
=0;j<
	gc_dim
;j++)

1557 if(
	gc
[
i
*
c_dim
+
j
]>=0.0)

1558 
xv
[
i
]+=
x
[i*
c_dim
+
j
];

1561 
	gi
=0;i<
	gn
;i++)

1562 
	gAx
[
i
]=0.0;

1565 
	gÃighbÜ_li¡
=
ÃighbÜ
->
ÃighbÜ_li¡_2nd
;

1566 
	gÃighbÜ_li¡_size
=
ÃighbÜ
->
ÃighbÜ_li¡_size_2nd
;

1567 
	gi¡¬t
=0;

1568 
	gi
=0;i<
	gn
;i++)

1570 cÚ¡ 
	gÃigh_sz
=
ÃighbÜ_li¡_size
[
i
];

1571 
	gj
,
	g__j
=0;__j<
	gÃigh_sz
;__j++,
	gi¡¬t
+=4)

1573 
j
=
ÃighbÜ_li¡
[
i
][
__j
];

1575 
	gtmp0
=
M_IJ
[
i¡¬t
]*(
b0
[
j
]-b0[
i
]);

1576 
	gtmp0
+=
M_IJ
[
i¡¬t
+1]*(
cv
[
j
/
c_dim
]*
x
[
i
]-
c
[i]*
xv
[j/c_dim]);

1577 
	gtmp0
-=
M_IJ
[
i¡¬t
+2]*(
cv
[
i
/
c_dim
]*
x
[
j
]-
c
[j]*
xv
[i/c_dim]);

1578 
	gtmp0
*=
M_IJ
[
i¡¬t
+3];

1579 
	gAx
[
i
]+=
tmp0
;

1581 if(
	gj
<
	gn
è
	gAx
[
j
]-=
tmp0
;

1595 
šlše
 
	gFÜûF›ldEAMDMD
::

1596 
	$ÿlc_Q
(
ty³0
& 
gamma_i
,ty³0& 
gamma_j
,ty³0& 
mu_ji


1597 ,
ty³0
& 
Q
,ty³0& 
®pha_Q_sq
)

1599 
ty³0
 
z0
;

1600 
ty³0
 
a
=5.0*(
gamma_i
-
gamma_j
-6.0*
mu_ji
);

1601 
ty³0
 
xi
=-2.0*(
gamma_i
+
gamma_j
);

1602 
ty³0
 
d
=
	`sq¹
((
xi
-
a
)*(xi-a)-8.0*a*
gamma_i
);

1603 
z0
=-4.0*
gamma_i
/((
xi
-
a
)-
d
);

1612 
Q
=
z0
*z0*(1.0-z0)*(1.0-z0)*((1.0-z0)*
gamma_i
+z0*
gamma_j
);

1613 
Q
+=
z0
*z0*z0*(6.0*z0*z0-15.0*z0+10.0)*
mu_ji
;

1614 
®pha_Q_sq
=1.0/((1.0-
z0
)*
gamma_i
+z0*
gamma_j
);

1615 
	}
}

1629 
šlše
 
	gFÜûF›ldEAMDMD
::

1630 
	$ÿlc_Q
(
ty³0
& 
gamma_i
,ty³0& 
gamma_j
,ty³0& 
mu_ji


1631 ,
ty³0
& 
Q
,ty³0& 
®pha_Q_sq
,ty³0& 
th‘a
)

1633 
ty³0
 
z0
,
dz0
,
dQ
;

1634 
ty³0
 
a
=5.0*(
gamma_i
-
gamma_j
-6.0*
mu_ji
);

1635 
ty³0
 
xi
=-2.0*(
gamma_i
+
gamma_j
);

1636 
ty³0
 
d–_sq¹
=
	`sq¹
((
xi
-
a
)*(xi-a)-8.0*a*
gamma_i
);

1637 
z0
=-4.0*
gamma_i
/((
xi
-
a
)-
d–_sq¹
);

1638 
dz0
=30.0*
z0
*(1.0-z0)/
d–_sq¹
;

1644 
dQ
=
z0
*z0*z0*(6.0*z0*z0-15.0*z0+10.0);

1645 
Q
=
z0
*z0*(1.0-z0)*(1.0-z0)*((1.0-z0)*
gamma_i
+z0*
gamma_j
);

1646 
Q
+=
dQ
*
mu_ji
;

1648 
®pha_Q_sq
=1.0/((1.0-
z0
)*
gamma_i
+z0*
gamma_j
);

1649 
th‘a
=
®pha_Q_sq
*(
gamma_i
-
gamma_j
)*
dz0
-
dQ
;

1651 
	}
}

1655 
	gFÜûF›ldEAMDMD
::
	$ml_Ãw
(
PyM‘hodDef
& 
m‘hod_0
,PyM‘hodDef& 
m‘hod_1
,PyM‘hodDef& 
m‘hod_2
)

1657 
m‘hod_0
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

1658 
m‘hod_0
.
ml_Çme
="ff_eam_funcfl";

1659 
m‘hod_0
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

1660 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

1662 
AtomsDMD
::
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<AtomsDMD::Objeù*>(
£lf
);

1663 
FuncAPI
<
¡d
::
¡ršg
*,
ty³0
*,ty³0*,¡d::¡ršg*> 
	`f
("ff_eam_funcfl",{"funcfl_files","r_crd","C","elems"});

1664 
f
.
nİtiÚ®s
=1;

1665 
f
.
logics
<1>()[0]=
	`VLogics
("gt",0.0);

1666 
f
.
logics
<2>()[0]=
	`VLogics
("gt",0.0);

1668 cÚ¡ 
¡d
::
¡ršg
* 
Çmes
=
__£lf
->
©oms
->
–em’ts
.names;

1669 cÚ¡ 
size_t
 
ÃËms
=
__£lf
->
©oms
->
–em’ts
.nelems;

1670 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

1671 if(
f
.
»m­
<3,0,1,2>("–em’t ´e£Á iÀsy¡em",
Çmes
,
ÃËms
)è 
NULL
;

1673 
size_t
 
Ä
,
Äho
;

1674 
ty³0
 
dr
,
drho
;

1675 
ty³0
** 
r_c
;

1676 
	`ty³0
(** 
F
)[5]=
NULL
;

1677 
	`ty³0
(*** 
r_phi
)[4]=
NULL
;

1678 
	`ty³0
(*** 
rho
)[4]=
NULL
;

1679 
Œy


1681 
ImpÜtEAM
::
	`funcæ
(
ÃËms
,
f
.
v®
<0>(),
dr
,
drho
,
Ä
,
Äho
,
r_phi
,
rho
,
F
,
r_c
);

1683 
	`ÿtch
(* 
”r_msg
)

1685 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,
”r_msg
);

1686 
d–‘e
 [] 
”r_msg
;

1687  
NULL
;

1690 
size_t
 
i
=0;i<
ÃËms
;i++)

1691 if(
f
.
v
<1>()[
i
]>
r_c
[i][i])

1693 
MemÜy
::
	`d—Îoc
(
r_c
);

1694 
MemÜy
::
	`d—Îoc
(
F
);

1695 
MemÜy
::
	`d—Îoc
(
r_phi
);

1696 
MemÜy
::
	`d—Îoc
(
rho
);

1697 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"r_üd[%zu] should bËs thª„_c[%zu][%zu]",
i
,i,i);

1698  
NULL
;

1701 
d–‘e
 
__£lf
->
ff
;

1702 
__£lf
->
ff
=
Ãw
 
	`FÜûF›ldEAMDMD
(__£lf->
©oms
,
dr
,
drho
,
Ä
,
Äho
,
¡d
::
	`move
(
r_phi
),¡d::move(
rho
),¡d::move(
F
),¡d::move(
r_c
),
f
.
mov
<1>(),f.mov<2>());

1703 
Py_RETURN_NONE
;

1705 
m‘hod_0
.
ml_doc
=(*)
R
"---(

1706 
	`ff_—m_funcæ
(
funcæ_fes
,
r_üd
,
C
,
–ems
=
NÚe
)

1708 
TabuÏ‹d
 
EAM
 
fÜû
 
f›ld
 
giv’
 
by
 
FuncFL
 
fe
/
s


1710 
Assigns
 
EAM
 
fÜû
 
f›ld
 
to
 
sy¡em


1712 
P¬am‘”s


1714 
funcæ_fes
 : 
¡ršg
[
ÃËms
]

1715 
li¡
 
of
 
»Ïtive
 
·ths
 
to
 
DYNAMO
 
fes
 
w™h
 
FuncFL
 
fÜm©


1716 
r_üd
 : [
ÃËms
]

1717 
cutoff
 
¿dius
 
mass
 
exchªge


1718 
C
 : [
ÃËms
]

1719 
dim’siÚËss
 
çùÜ
 
—ch
 
–em’t
, 
£e
 :
»f
:`
h”e
 <
ma¡”
-ref>`

1720 
–ems
 : 
¡ršg
[
ÃËms
]

1721 
m­pšg
 
–em’ts


1723 
R‘uºs


1725 
NÚe


1727 
NÙes


1729 
This
 
is
 
buÏ‹d
 
fÜm
 
of
 
Embedded
 
Atom
 
	`M‘hod
 (
EAM
è
pÙ’tŸl


1732 
Exam¶es


1734 
Ni


1738 >>> 
äom
 
m­p
 
impÜt
 
dmd


1739 >>> 
sim
=
dmd
.
	`cfg
(5,"configs/Ni-DMD.cfg")

1740 >>> 
sim
.
	`ff_—m_funcæ
("potentials/niu3.eam")

1746 
m‘hod_1
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

1747 
m‘hod_1
.
ml_Çme
="ff_eam_setfl";

1748 
m‘hod_1
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

1749 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

1751 
AtomsDMD
::
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<AtomsDMD::Objeù*>(
£lf
);

1752 
FuncAPI
<
¡d
::
¡ršg
,
ty³0
*,ty³0*,¡d::¡ršg*> 
	`f
("ff_eam_setfl",{"setfl_file","r_crd","C","elems"});

1753 
f
.
nİtiÚ®s
=1;

1754 
f
.
logics
<1>()[0]=
	`VLogics
("gt",0.0);

1755 
f
.
logics
<2>()[0]=
	`VLogics
("gt",0.0);

1757 cÚ¡ 
¡d
::
¡ršg
* 
Çmes
=
__£lf
->
©oms
->
–em’ts
.names;

1758 cÚ¡ 
size_t
 
ÃËms
=
__£lf
->
©oms
->
–em’ts
.nelems;

1759 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

1760 if(
f
.
»m­
<3,2,1>("–em’t ´e£Á iÀsy¡em",
Çmes
,
ÃËms
)è 
NULL
;

1763 
size_t
 
Ä
,
Äho
;

1764 
ty³0
 
dr
,
drho
;

1765 
ty³0
** 
r_c
;

1766 
	`ty³0
(** 
F
)[5]=
NULL
;

1767 
	`ty³0
(*** 
r_phi
)[4]=
NULL
;

1768 
	`ty³0
(*** 
rho
)[4]=
NULL
;

1769 
Œy


1771 
ImpÜtEAM
::
	`£tæ
(
ÃËms
,
__£lf
->
©oms
->
–em’ts
.
Çmes
,
f
.
v®
<0>(),
dr
,
drho
,
Ä
,
Äho
,
r_phi
,
rho
,
F
,
r_c
);

1773 
	`ÿtch
(* 
”r_msg
)

1775 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,
”r_msg
);

1776 
d–‘e
 [] 
”r_msg
;

1777  
NULL
;

1780 
size_t
 
i
=0;i<
ÃËms
;i++)

1781 if(
f
.
v
<1>()[
i
]>
r_c
[i][i])

1783 
MemÜy
::
	`d—Îoc
(
r_c
);

1784 
MemÜy
::
	`d—Îoc
(
F
);

1785 
MemÜy
::
	`d—Îoc
(
r_phi
);

1786 
MemÜy
::
	`d—Îoc
(
rho
);

1787 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"r_üd[%zu] should bËs thª„_c[%zu][%zu]",
i
,i,i);

1788  
NULL
;

1791 
d–‘e
 
__£lf
->
ff
;

1792 
__£lf
->
ff
=
Ãw
 
	`FÜûF›ldEAMDMD
(__£lf->
©oms
,
dr
,
drho
,
Ä
,
Äho
,
¡d
::
	`move
(
r_phi
),¡d::move(
rho
),¡d::move(
F
),¡d::move(
r_c
),
f
.
mov
<1>(),f.mov<2>());

1793 
Py_RETURN_NONE
;

1795 
m‘hod_1
.
ml_doc
=(*)
R
"---(

1796 
	`ff_—m_£tæ
(
£tæ_fe
,
r_üd
,
C
,
–ems
=
NÚe
)

1798 
TabuÏ‹d
 
EAM
 
fÜû
 
f›ld
 
giv’
 
by
 
a
 
sšgË
 
S‘FL
 
fe


1800 
Assigns
 
EAM
 
fÜû
 
f›ld
 
to
 
sy¡em


1802 
P¬am‘”s


1804 
£tæ_fe
 : 
¡ršg


1805 
»Ïtive
 
·th
 
to
 
DYNAMO
 
fe
 
w™h
 
S‘FL
 
fÜm©


1806 
r_üd
 : [
ÃËms
]

1807 
cutoff
 
¿dius
 
mass
 
exchªge


1808 
C
 : [
ÃËms
]

1809 
dim’siÚËss
 
çùÜ
 
—ch
 
–em’t
, 
£e
 :
»f
:`
h”e
 <
ma¡”
-ref>`

1810 
–ems
 : 
¡ršg
[
ÃËms
]

1811 
m­pšg
 
–em’ts


1813 
R‘uºs


1815 
NÚe


1817 
NÙes


1819 
This
 
is
 
buÏ‹d
 
fÜm
 
of
 
Embedded
 
Atom
 
	`M‘hod
 (
EAM
è
pÙ’tŸl


1822 
Exam¶es


1824 
Cu


1828 >>> 
äom
 
m­p
 
impÜt
 
dmd


1829 >>> 
sim
=
dmd
.
	`cfg
(5,"configs/Cu-DMD.cfg")

1830 >>> 
sim
.
	`ff_—m_£tæ
("potentials/Cu_mishin.eam.alloy")

1836 
m‘hod_2
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

1837 
m‘hod_2
.
ml_Çme
="ff_eam_fs";

1838 
m‘hod_2
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

1839 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

1841 
AtomsDMD
::
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<AtomsDMD::Objeù*>(
£lf
);

1842 
FuncAPI
<
¡d
::
¡ršg
,
ty³0
*,ty³0*,¡d::¡ršg*> 
	`f
("ff_eam_fs",{"fs_file","r_crd","C","elems"});

1843 
f
.
nİtiÚ®s
=1;

1844 
f
.
logics
<1>()[0]=
	`VLogics
("gt",0.0);

1845 
f
.
logics
<2>()[0]=
	`VLogics
("gt",0.0);

1847 cÚ¡ 
¡d
::
¡ršg
* 
Çmes
=
__£lf
->
©oms
->
–em’ts
.names;

1848 cÚ¡ 
size_t
 
ÃËms
=
__£lf
->
©oms
->
–em’ts
.nelems;

1849 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

1850 if(
f
.
»m­
<3,2,1>("–em’t ´e£Á iÀsy¡em",
Çmes
,
ÃËms
)è 
NULL
;

1852 
size_t
 
Ä
,
Äho
;

1853 
ty³0
 
dr
,
drho
;

1854 
ty³0
** 
r_c
;

1855 
	`ty³0
(** 
F
)[5]=
NULL
;

1856 
	`ty³0
(*** 
r_phi
)[4]=
NULL
;

1857 
	`ty³0
(*** 
rho
)[4]=
NULL
;

1858 
Œy


1860 
ImpÜtEAM
::
	`fs
(
ÃËms
,
__£lf
->
©oms
->
–em’ts
.
Çmes
,
f
.
v®
<0>(),
dr
,
drho
,
Ä
,
Äho
,
r_phi
,
rho
,
F
,
r_c
);

1862 
	`ÿtch
(* 
”r_msg
)

1864 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,
”r_msg
);

1865 
d–‘e
 [] 
”r_msg
;

1866  
NULL
;

1869 
size_t
 
i
=0;i<
ÃËms
;i++)

1870 if(
f
.
v
<1>()[
i
]>
r_c
[i][i])

1872 
MemÜy
::
	`d—Îoc
(
r_c
);

1873 
MemÜy
::
	`d—Îoc
(
F
);

1874 
MemÜy
::
	`d—Îoc
(
r_phi
);

1875 
MemÜy
::
	`d—Îoc
(
rho
);

1876 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"r_üd[%zu] should bËs thª„_c[%zu][%zu]",
i
,i,i);

1877  
NULL
;

1880 
d–‘e
 
__£lf
->
ff
;

1881 
__£lf
->
ff
=
Ãw
 
	`FÜûF›ldEAMDMD
(__£lf->
©oms
,
dr
,
drho
,
Ä
,
Äho
,
¡d
::
	`move
(
r_phi
),¡d::move(
rho
),¡d::move(
F
),¡d::move(
r_c
),
f
.
mov
<1>(),f.mov<2>());

1882 
Py_RETURN_NONE
;

1884 
m‘hod_2
.
ml_doc
=(*)
R
"---(

1885 
	`ff_—m_fs
(
fs_fe
,
r_üd
,
C
,
–ems
=
NÚe
)

1887 
TabuÏ‹d
 
Fšnis
-
Sšşaœ
 
EAM


1889 
Assigns
 
Fšnis
-
Sšşaœ
 
EAM
 
fÜû
 
f›ld
 
to
 
sy¡em
. 
FÜ
 
ex¶ª©iÚ
 
of
 
the
 
·¿m‘”
 
£e
h
NÙes
 
£ùiÚ
.

1891 
P¬am‘”s


1893 
fs_fe
 : 
¡ršg


1894 
»Ïtive
 
·th
 
to
 
DYNAMO
 
fe
 
w™h
 
fs
 
fÜm©


1895 
r_üd
 : [
ÃËms
]

1896 
cutoff
 
¿dius
 
mass
 
exchªge


1897 
C
 : [
ÃËms
]

1898 
dim’siÚËss
 
çùÜ
 
—ch
 
–em’t
, 
£e
 :
»f
:`
h”e
 <
ma¡”
-ref>`

1899 
–ems
 : 
¡ršg
[
ÃËms
]

1900 
m­pšg
 
–em’ts


1902 
R‘uºs


1904 
NÚe


1906 
NÙes


1908 
This
 
is
 
buÏ‹d
 
fÜm
 
of
 
Fšnis
-
Sšşaœ
 
Embedded
 
Atom
 
	`M‘hod
 (
EAM
è
pÙ’tŸl


1910 
CÚsid”
 
the
 
g’”®
 
fÜm
 
of
 
EAM
 
pÙ’tŸl
:

1913 .. 
m©h
:: 
U
=\
äac
{1}{2}\
sum_
{
i
}\sum_{
j
\
Ãq
 i}\
phi_
{\
gamma
 \
d–
}{(
x_
{
ij
}è}+\
sum_i
 
E_
\gamm¨\
	`Ëá
(\sum_{j\Ãq i} \
rho_
{\d–\gamma}(x_{ij}è\
right
),

1916 
From
 
h”e
 
Ú
, 
g»ek
 
su³rscts
/
subsüts
 
¬e
 
u£d
 
to
 
»ãr
Ø
–em’ts
 
´e£Á
 
the
 
sy¡em
; :
m©h
:`\
gamma
`, 
ªd
 :m©h:`\
d–
` 
d’Ùe
 
ty³
 
of
 
©om
 :m©h:`
i
`‡nd‡tom :m©h:`
j
`, 
»³ùiv–y
. :m©h:`
E
`, :m©h:`\
rho
`,‡nd :m©h:`\
phi
`‡» 
embeddšg
, 
–eùrÚ
 
d’s™y
,‡nd 
·œ
 
funùiÚs
, 
»¥eùiv–y
. 
Also
 :m©h:`
x_
{
ij
}` 
»ãrs
Ø
di¡ªû
 
b‘w“n
 :m©h:`i`‡nd :m©h:`j`. 
Now
h
muÉi
 
compÚ’t
 
fÜmuÏtiÚ
 oà
DMD
 
ä“
 
’”gy
 
would
 
be
:

1918 .. 
m©h
::

1919 
F
=&\
äac
{1}{2}\
sum_
{
i
,\
gamma
,
j
\
Ãq
 i,\
d–
}
c_i
^\gamm¨
c_j
^\d– \
omega_
{\gamm¨\d–}\
	`Ëá
(
x_
{
ij
}\
right
)+\sum_{i,\gamma} c_i^\gamm¨
E_
\gamm¨\Ëá(\sum_{j\Ãq i,\d–} c_j^{\d–}\
psi_
{\d–\gamma}\Ëá(x_{ij}\right)\right)-3
k_BT
\sum_{i,\gamma} c_i^\gamm¨\
log
\Ëá(\
sq¹
{\
pi
 
e
}\
®pha_i
^\gamma/\
Lambda_
\gamma\right)\\

1920 &+
k_BT
\
sum_
{
i
,\
gamma
} 
c_i
^\gamma\
log
 c_i^\gamma+k_BT\sum_{i}c_i^
v
\
	`log
 (c_i^v),

1922 
wh”e


1924 .. 
m©h
:: \
Lambda_
\
gamma
=\
äac
{
h
}{\
sq¹
{2\
pi
 
m_
\gamm¨
k_BT
}}, \
quad
 
c_i
^
v
=1-\
sum_
{\gamma}c_i^\gamma,

1926 .. 
m©h
:: \
omega_
{\
gamma
\
d–
}(
x_
{
ij
})ğ\
äac
{1}{\
	`Ëá
(\
®pha
^{\gamma\d–}
_
{ij}\
sq¹
{\
pi
}\
right
)^{3}}\
d
^3\
m©hbf
{
x
} \
exp
{\
biggl
[-\Ëá(\äac{\m©hbf{x}_{ij} -\m©hbf{x}}{\®pha^{\gamma\d–}_{ij}}\right)^2\
biggr
]}\
phi_
{\gamma\delta}(|\mathbf{x}|)

1928 .. 
m©h
:: \
psi_
{\
gamma
\
d–
}(
x_
{
ij
})=\
äac
{1}{\
	`Ëá
(\
®pha
^{\gamma\d–}
_
{ij}\
sq¹
{\
pi
}\
right
)^{3}}\
d
^3\
m©hbf
{
x
} \
exp
{\
biggl
[-\Ëá(\äac{\m©hbf{x}_{ij} -\m©hbf{x}}{\®pha^{\gamma\d–}_{ij}}\right)^2\
biggr
]}\
rho_
{\gamma\delta}(|\mathbf{x}|)

1930 .. 
m©h
:: \
®pha
^{\
gamma
\
d–
}
_
{
ij
}=\
sq¹
{{\
®pha_i
^{\gamma}}^2+{\
®pha_j
^{\d–}}^2},\
quad
 \
m©hbf
{
x
}_{
ji
}=\m©hbf{x}
_j
-\m©hbf{x}
_i


1932 
The
 
num”iÿl
 
ev®u©iÚ
 
of
 
the£
 
š‹g¿ls
 
is
 
discus£d
 :
»f
:`
h”e
 <
š‹g
-ref>`.

1936 
ReÿÎšg
 
th©


1938 .. 
m©h
:: \
ÏngË
 
U
 \
¿ngË
 &ğ\
äac
{\
·¹Ÿl
 }{\·¹ŸÈ\
b‘a
}\
	`Ëá
(\b‘¨
F
 \
right
)

1940 
the
 
av”age
 
pÙ’tŸl
 
’”gy
 
is


1943 .. 
m©h
:: \
ÏngË
 
U
 \
¿ngË
 = \
äac
{1}{2}\
sum_
{
i
,\
gamma
,
j
\
Ãq
 i,\
d–
}
c_i
^\gamm¨
c_j
^\d– \
omega_
{\gamm¨\d–}\
	`Ëá
(
x_
{
ij
}\
right
)+\sum_{i,\gamma} c_i^\gamm¨
E_
\gamm¨\Ëá(\sum_{j\Ãq i,\d–} c_j^{\d–}\
psi_
{\d–\gamma}\Ëá(x_{ij}\right)\rightè-\äac{3}{2} 
k_B
 
T


1946 
Exam¶es


1948 
IrÚ
 
Hydrogº
 
mixtu»


1950 >>> 
äom
 
m­p
 
impÜt
 
dmd


1951 >>> 
sim
=
dmd
.
	`cfg
(5,"configs/FeH-DMD.cfg")

1952 >>> 
sim
.
	`ff_—m_fs
("potentials/FeH.eam.fs")

1954 
	}
}

	@ff_eam_dmd.h

1 #iâdeà
__MAPP__ff_—m_dmd__


2 
	#__MAPP__ff_—m_dmd__


	)

3 
	~"ff_dmd.h
"

4 
Çme¥aû
 
	gMAPP_NS


6 
	g‹m¶©e
<
	gşass
> 
şass
 
	gDMDVec
;

7 şas 
	cFÜûF›ldEAMDMD
 : 
public
 
FÜûF›ldDMD


9 
´iv©e
:

10 
size_t
 
Ä
,
	gÄho
;

11 
ty³0
 
	gdr
,
	gdrho
,
	gdr_šv
,
	gdrho_šv
,
	grho_max
;

12 
ty³0
(** 
F_¬r
)[5];

13 
ty³0
(*** 
r_phi_¬r
)[4];

14 
ty³0
(*** 
r_rho_¬r
)[4];

18 
	gVec
<
	gty³0
>* 
	gE_±r
;

19 
	gVec
<
	gty³0
>* 
	gdE_±r
;

20 
	gVec
<
	gty³0
>* 
	gddE_±r
;

21 
	gVec
<
	gty³0
>* 
	gcv_±r
;

23 
	gVec
<
	gty³0
>* 
	gvec0
;

24 
	gVec
<
	gty³0
>* 
	gvec1
;

25 
	gVec
<
	gty³0
>* 
	gvec2
;

26 
	gVec
<
	gty³0
>* 
	gvec3
;

27 
	gVec
<
	gty³0
>* 
	gfcÛf_±r
;

31 
ty³0
 
	gkbT
,
	gb‘a
;

32 
ty³0
* 
	gc_0
;

33 
ty³0
* 
	gc_1
;

34 
ty³0
* 
	gz‘a
;

37 
ty³0
* 
	grho_phi
;

38 
ty³0
* 
	gdrho_phi_dr
;

39 
ty³0
* 
	gdrho_phi_d®pha
;

40 
ty³0
* 
	gddrho_phi_drdr
;

41 
ty³0
* 
	gddrho_phi_drd®pha
;

42 
ty³0
* 
	gddrho_phi_d®phad®pha
;

43 
size_t
 
	gmax_·œs0
,
	gmax_·œs1
;

47 
ty³0
* 
	gxi
;

48 
ty³0
* 
	gwi_0
;

49 
ty³0
* 
	gwi_1
;

50 cÚ¡ 
	gN
;

54 
ty³0
 
ÿlc_’t
(type0);

55 
ÿlc_mu
();

56 
£t_‹mp
();

59 
ty³0
* 
	gM_IJ
;

62 
ÿlc_Q
(
ty³0
&,type0&,type0&,type0&,type0&);

63 
ÿlc_Q
(
ty³0
&,type0&,type0&,type0&,type0&,type0&);

67 
	g´Ùeùed
:

68 
__fÜû_ÿlc_¡©ic
();

69 
__fÜû_ÿlc
();

70 
__’”gy_ÿlc
();

71 
__c_d_ÿlc
();

72 
__J
(
Vec
<
ty³0
>*,Vec<type0>*);

73 
__´•J_n_»s
(
Vec
<
ty³0
>*,Vec<type0>*);

74 
__J
(
Vec
<
ty³0
>*,Vec<type0>*,Vec<type0>*,Vec<type0>*);

75 
	gpublic
:

76 
FÜûF›ldEAMDMD
(
şass
 
AtomsDMD
*,

77 
ty³0
,ty³0,
size_t
,size_t,

78 
ty³0
(***&&)[4],type0(***&&)[4],type0(**&&)[5],

79 
ty³0
**&&,type0*&&,type0*&&);

81 ~
FÜûF›ldEAMDMD
();

82 
š™
();

83 
fš
();

85 
š™_¡©ic
();

86 
fš_¡©ic
();

89 
ml_Ãw
(
PyM‘hodDef
&,PyMethodDef&,PyMethodDef&);

	@ff_eam_dmd_cluster.cpp

1 
	~"ff_—m_dmd_şu¡”.h
"

2 
	~<¡dlib.h
>

3 
	~"ÃighbÜ_dmd_sc.h
"

4 
	~"–em’ts.h
"

5 
	~"memÜy.h
"

6 
	~"xm©h.h
"

7 
	~"©oms_dmd.h
"

8 
	~"MAPP.h
"

9 
	~"dyÇmic_dmd.h
"

10 
	~"impÜt_—m.h
"

11 
	~<lim™s
>

12 
	#PI_IN_SQ
 0.564189583547756286948079451561

	)

13 
	#TOL
 1.0e-9

	)

15 
	#CONST
 1.0

	)

16 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

20 
	gFÜûF›ldEAMDMDCLUSTER
::

21 
FÜûF›ldEAMDMDCLUSTER
(
AtomsDMD
* 
©oms
,

22 
ty³0
 
__dr
,ty³0 
__drho
,
size_t
 
__Ä
,size_ˆ
__Äho
,

23 
ty³0
(***&& 
__r_phi_¬r
)[4],ty³0(***&& 
__rho_¬r
)[4],ty³0(**&& 
__F_¬r
)[5],

24 
ty³0
**&& 
__cut
,ty³0*&& 
__r_üd
,ty³0*&& 
__z‘a
):

25 
FÜûF›ldDMD
(
©oms
),

26 
dr
(
__dr
),

27 
drho
(
__drho
),

28 
Ä
(
__Ä
),

29 
Äho
(
__Äho
),

30 
r_phi_¬r
(
__r_phi_¬r
),

31 
r_rho_¬r
(
__rho_¬r
),

32 
F_¬r
(
__F_¬r
),

33 
rho_phi
(
NULL
),

34 
drho_phi_dr
(
NULL
),

35 
drho_phi_d®pha
(
NULL
),

36 
B_·œ
(
NULL
),

37 
is_·œ
(
NULL
),

38 
max_·œs
(0),

39 
vec0
(
NULL
),

40 
vec1
(
NULL
),

41 
vec2
(
NULL
),

42 
vec3
(
NULL
),

43 
dE_±r
(
NULL
),

44 
rho_±r
(
NULL
),

45 
d_±r
(
NULL
),

46 
b_±r
(
NULL
),

47 
th‘a_±r
(
NULL
),

48 
N
(
©oms
->N)

51 
	g__r_phi_¬r
=
NULL
;

52 
	g__rho_¬r
=
NULL
;

53 
	g__F_¬r
=
NULL
;

55 
	gdr_šv
=1.0/
dr
;

56 
	gdrho_šv
=1.0/
drho
;

57 
	grho_max
=
¡©ic_ÿ¡
<
ty³0
>(
Äho
)*
drho
;

59 
	gkbT
=
b‘a
=-1.0;

63 
	gMemÜy
::
®loc
(
xi
,
N
);

64 
	gMemÜy
::
®loc
(
wi_0
,
N
);

65 
	gMemÜy
::
®loc
(
wi_1
,
N
);

66 
	gMemÜy
::
®loc
(
z‘a
,
ÃËms
);

67 
	gMemÜy
::
®loc
(
c_0
,
ÃËms
);

68 
	gMemÜy
::
®loc
(
c_1
,
ÃËms
);

70 
memıy
(
xi
,
©oms
->xi,
N
*(
ty³0
));

71 
memıy
(
wi_0
,
©oms
->
wi
,
N
*(
ty³0
));

72 
	gi
=0;i<
	gN
;i++)

73 
	gwi_1
[
i
]=
wi_0
[i]*
xi
[i];

76 
–em_ty³
 
	g–em_i
=0;–em_i<
	gÃËms
;elem_i++)

78 
	gr_üd
[
–em_i
]=
__r_üd
[elem_i];

79 
	gz‘a
[
–em_i
]=
__z‘a
[elem_i];

81 
	gMemÜy
::
d—Îoc
(
__r_üd
);

82 
	gMemÜy
::
d—Îoc
(
__z‘a
);

84 
–em_ty³
 
	g–em_i
=0;–em_i<
	gÃËms
;elem_i++)

86 
size_t
 
	gi
=0;i<
	gÄ
;i++)

87 
	gr_rho_¬r
[
–em_i
][0][
i
][0]*=
¡©ic_ÿ¡
<
ty³0
>(i)*
dr
;

88 
	gImpÜtEAM
::
š‹½Ş©e
(
Ä
,
dr
,
r_rho_¬r
[
–em_i
][0]);

89 
–em_ty³
 
	g–em_j
=1;–em_j<
	gÃËms
;elem_j++)

91 if(
	gr_rho_¬r
[
–em_i
][
–em_j
]!=
r_rho_¬r
[elem_i][elem_j-1])

93 
size_t
 
i
=0;
	gi
<
	gÄ
;i++)

94 
	gr_rho_¬r
[
–em_i
][
–em_j
][
i
][0]*=
¡©ic_ÿ¡
<
ty³0
>(i)*
dr
;

95 
	gImpÜtEAM
::
š‹½Ş©e
(
Ä
,
dr
,
r_rho_¬r
[
–em_i
][
–em_j
]);

101 
ty³0
 
	gtmp
;

102 
size_t
 
	gi
=0;i<
	gÃËms
;i++)

103 
size_t
 
	gj
=0;j<
	gi
+1;j++)

105 
	gcut
[
i
][
j
]=
cut
[j][i]=
__cut
[i][j];

106 
	gtmp
=
__cut
[
i
][
j
];

107 
	gcut_sq
[
i
][
j
]=
cut_sq
[j][i]=
tmp
*tmp;

109 
	gMemÜy
::
d—Îoc
(
__cut
);

111 
d–‘e
 
	gÃighbÜ
;

112 
	gÃighbÜ
=
Ãw
 
NeighbÜDMDSC
(
©oms
,
cut_sk
,
rsq_üd
);

117 
	gFÜûF›ldEAMDMDCLUSTER
::~
	$FÜûF›ldEAMDMDCLUSTER
()

119 
MemÜy
::
	`d—Îoc
(
F_¬r
);

120 
MemÜy
::
	`d—Îoc
(
r_rho_¬r
);

121 
MemÜy
::
	`d—Îoc
(
r_phi_¬r
);

123 
MemÜy
::
	`d—Îoc
(
z‘a
);

124 
MemÜy
::
	`d—Îoc
(
c_1
);

125 
MemÜy
::
	`d—Îoc
(
c_0
);

126 
MemÜy
::
	`d—Îoc
(
wi_1
);

127 
MemÜy
::
	`d—Îoc
(
wi_0
);

128 
MemÜy
::
	`d—Îoc
(
xi
);

130 
	}
}

134 
	gFÜûF›ldEAMDMDCLUSTER
::
	$ÿlc_·œ
(
ty³0
 
r
,ty³0* 
®pha_i
,ty³0* 
®pha_j
,ty³0*& 
__rho_phi
,type0*&,type0*&)

135 {
	}
}

139 
	gFÜûF›ldEAMDMDCLUSTER
::
	$__fÜû_ÿlc
()

141 if(
max_·œs
<
ÃighbÜ
->
no_·œs
)

143 
d–‘e
 [] 
rho_phi
;

144 
d–‘e
 [] 
drho_phi_dr
;

145 
d–‘e
 [] 
drho_phi_d®pha
;

146 
d–‘e
 [] 
B_·œ
;

147 
d–‘e
 [] 
is_·œ
;

149 
max_·œs
=
ÃighbÜ
->
no_·œs
;

150 
size_t
 
no_0
=3*
max_·œs
*
c_dim
*c_dim;

151 
MemÜy
::
	`®loc
(
rho_phi
,
no_0
);

152 
MemÜy
::
	`®loc
(
drho_phi_dr
,
no_0
);

153 
MemÜy
::
	`®loc
(
drho_phi_d®pha
,
no_0
);

154 
MemÜy
::
	`®loc
(
B_·œ
,
c_dim
*c_dim*
max_·œs
);

155 
MemÜy
::
	`®loc
(
is_·œ
,
max_·œs
);

158 
i
=0;i<
max_·œs
*
c_dim
*c_dim*3;i++è
rho_phi
[i]=
drho_phi_dr
[i]=
drho_phi_d®pha
[i]=0.0;

159 
i
=0;i<
max_·œs
*
c_dim
*c_dim;i++è
B_·œ
[i]=0.0;

160 
i
=0;i<
max_·œs
;i++è
is_·œ
[i]=
çl£
;

166 
ty³0
 
r
,
r_šv
;

167 
size_t
 
m
;

168 
ty³0
* 
cÛf
;

169 
ty³0
 
tmp0
,
tmp1
;

170 
ty³0
 
p
,
cv_i
;

172 
ty³0
 cÚ¡* 
c
=
©oms
->c->
	`begš
();

176 
ty³0
* 
dE
=
dE_±r
->
	`begš
();

177 
ty³0
* 
rho
=
rho_±r
->
	`begš
();

178 
i
=0;i<
©oms
->
Çtms_lş
*
c_dim
;i++è
rho
[i]=0.0;

180 
ty³0
 
®pha_ij_sq
,
®pha_ij
,
rsq
;

184 cÚ¡ 
ty³0
* 
x
=
©oms
->x->
	`begš
();

185 cÚ¡ 
ty³0
* 
®pha
=
©oms
->®pha->
	`begš
();

186 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->neighbor_list;

187 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->neighbor_list_size;

188 
Çtms_lş
=
©oms
->natms_lcl;

189 
ty³0
 
’t_lş
=0.0,
vib_lş
=0.0;

190 
size_t
 
i¡¬t
=0,
ii¡¬t
;

191 
i
=0;i<
Çtms_lş
;i++)

193 cÚ¡ 
Ãigh_sz
=
ÃighbÜ_li¡_size
[
i
];

194 
j
,
__j
=0;__j<
Ãigh_sz
;__j++)

196 
j
=
ÃighbÜ_li¡
[
i
][
__j
];

197 
rsq
=
Algeb¿
::
RSQ
<
__dim__
>(
x
+
i
*__dim__,x+
j
*__dim__);

198 
r
=
	`sq¹
(
rsq
);

200 
ic
=0;ic<
c_dim
;ic++)

201 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3)

203 
®pha_ij_sq
=
®pha
[
i
*
c_dim
+
ic
]*®pha[i*c_dim+ic]+®pha[
j
*c_dim+
jc
]*alpha[j*c_dim+jc];

204 
®pha_ij
=
	`sq¹
(
®pha_ij_sq
);

205 if(
r
-
®pha_ij
*
xi
[
N
-1]>=
cut
[
ic
][
jc
]) ;

207 
is_·œ
[
i¡¬t
/(3*
c_dim
*c_dim)]=
Œue
;

209 
ty³0
 
uµ”
=(
r
+
cut
[
ic
][
jc
])/
®pha_ij
;

210 
ty³0
 
low”
=(
r
-
cut
[
ic
][
jc
])/
®pha_ij
;

211 
ty³0
 
__r
,
p
,
tmp0
,
xi2
;

212 
ty³0
* 
cÛf
;

215 
ty³0
 
H
[3][3]{
	`DESIG2
(3,3,0.0)};

216 
l
=0;l<
N
;l++)

218 if(
xi
[
l
]<=
low”
 && xi[l]>=
uµ”
) ;

220 
xi2
=
xi
[
l
]*xi[l];

222 
__r
=
r
-
xi
[
l
]*
®pha_ij
;

223 
p
=
	`çbs
(
__r
)*
dr_šv
;

224 
m
=
¡©ic_ÿ¡
<
size_t
>(
p
);

225 
m
=
	`MIN
(m,
Ä
-2);

226 
p
-=
m
;

227 
p
=
	`MIN
(p,1.0);

229 
cÛf
=
r_phi_¬r
[
ic
][
jc
][
m
];

230 
tmp0
=((
cÛf
[3]*
p
+coef[2])*p+coef[1])*p+coef[0];

231 if(
__r
<0.0è
tmp0
*=-1.0;

232 
tmp0
*=
wi_0
[
l
];

233 
H
[0][0]+=
tmp0
;

234 
H
[0][1]+=
tmp0
*
xi
[
l
];

235 
H
[0][2]+=
tmp0
*
xi2
;

238 
cÛf
=
r_rho_¬r
[
ic
][
jc
][
m
];

239 
tmp0
=((
cÛf
[3]*
p
+coef[2])*p+coef[1])*p+coef[0];

240 if(
__r
<0.0è
tmp0
*=-1.0;

241 
tmp0
*=
wi_0
[
l
];

242 
H
[1][0]+=
tmp0
;

243 
H
[1][1]+=
tmp0
*
xi
[
l
];

244 
H
[1][2]+=
tmp0
*
xi2
;

246 
cÛf
=
r_rho_¬r
[
jc
][
ic
][
m
];

247 
tmp0
=((
cÛf
[3]*
p
+coef[2])*p+coef[1])*p+coef[0];

248 if(
__r
<0.0è
tmp0
*=-1.0;

249 
tmp0
*=
wi_0
[
l
];

250 
H
[2][0]+=
tmp0
;

251 
H
[2][1]+=
tmp0
*
xi
[
l
];

252 
H
[2][2]+=
tmp0
*
xi2
;

255 
r_šv
=1.0/
r
;

256 
ty³0
 
r2_šv
=
r_šv
*r_inv;

257 
ty³0
 
®pha_šv
=1.0/
®pha_ij
;

258 
ty³0
 
®pha2_šv
=
®pha_šv
*alpha_inv;

259 
ty³0
 
®pha4_šv
=
®pha2_šv
*alpha2_inv;

260 
ty³0
 
r2®pha2_šv
=
r2_šv
*
®pha2_šv
;

263 
Algeb¿
::
Do
<3>::
	`func
([&
i¡¬t
,&
H
,&
r_šv
,&
r2_šv
,&
®pha2_šv
,&
r2®pha2_šv
,&
®pha_ij_sq
,&
®pha_šv
,&
rsq
,&
®pha4_šv
,
this
]

264 (
i
)

266 
rho_phi
[
i¡¬t
+
i
]=
PI_IN_SQ
*
r_šv
*
H
[i][0];

267 
drho_phi_dr
[
i¡¬t
+
i
]=-
r2_šv
*(
rho_phi
[i¡¬t+i]+2.0*
PI_IN_SQ
*
®pha_šv
*
H
[i][1]);

268 
drho_phi_d®pha
[
i¡¬t
+
i
]=-
®pha2_šv
*(
rho_phi
[i¡¬t+i]-2.0*
PI_IN_SQ
*
r_šv
*
H
[i][2]);

272 
rho
[
i
*
c_dim
+
ic
]+=
c
[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
+2];

274 if(
j
<
Çtms_lş
)

276 
rho
[
j
*
c_dim
+
jc
]+=
c
[
i
*c_dim+
ic
]*
rho_phi
[
i¡¬t
+1];

277 
__vec_lş
[0]+=
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
];

280 
__vec_lş
[0]+=0.5*
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
];

285 
cv_i
=1.0;

286 
ic
=0;ic<
c_dim
;ic++)

288 
p
=
rho
[
i
*
c_dim
+
ic
]*
drho_šv
;

289 
m
=
¡©ic_ÿ¡
<
size_t
>(
p
);

290 
m
=
	`MIN
(m,
Äho
-2);

291 
p
-=
m
;

292 
p
=
	`MIN
(p,1.0);

293 
cÛf
=
F_¬r
[
ic
][
m
];

295 
tmp0
=(((
cÛf
[4]*
p
+coef[3])*p+coef[2])*p+coef[1])*p+coef[0];

296 
tmp1
=(((4.0*
cÛf
[4]*
p
+3.0*cÛf[3])*p+2.0*cÛf[2])*p+cÛf[1])*
drho_šv
;

298 if(
rho
[
i
*
c_dim
+
ic
]>
rho_max
è
tmp0
+=
tmp1
*(rho[i*c_dim+ic]-rho_max);

300 
dE
[
i
*
c_dim
+
ic
]=
tmp1
;

301 
__vec_lş
[0]+=
c
[
i
*
c_dim
+
ic
]*
tmp0
;

304 
vib_lş
+=
c
[
i
*
c_dim
+
ic
]*(
c_0
[ic]-3.0*
kbT
*
	`log
(
®pha
[i*c_dim+ic]));

305 
’t_lş
+=
	`ÿlc_’t
(
c
[
i
*
c_dim
+
ic
]);

306 
cv_i
-=
c
[
i
*
c_dim
+
ic
];

309 
’t_lş
+=
	`ÿlc_’t
(
cv_i
);

311 
	`upd©e
(
dE_±r
);

313 
	`___sc_loİ
();

314 
__vec_lş
[0]+=
vib_lş
;

315 
__vec_lş
[1+
__nvoigt__
]+=
’t_lş
;

316 
__vec_lş
[0]+=
kbT
*
’t_lş
;

320 
ty³0
* 
fvec
=
f
->
	`begš
();

321 
ty³0
* 
f_®phavec
=
f_®pha
->
	`begš
();

322 
ty³0
 
dx_ij
[
__dim__
];

323 
ty³0
 
åaœ
,
­aœ
;

324 
i¡¬t
=
ii¡¬t
=0;

325 
i
=0;i<
Çtms_lş
;i++)

328 cÚ¡ 
Ãigh_sz
=
ÃighbÜ_li¡_size
[
i
];

329 
j
,
__j
=0;__j<
Ãigh_sz
;__j++)

331 
j
=
ÃighbÜ_li¡
[
i
][
__j
];

332 
Algeb¿
::
DX
<
__dim__
>(
x
+
i
*__dim__,x+
j
*__dim__,
dx_ij
);

333 
åaœ
=0.0;

335 if(
j
<
Çtms_lş
)

337 
ic
=0;ic<
c_dim
;ic++)

338 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

340 
åaœ
-=(
drho_phi_dr
[
i¡¬t
+2]*
dE
[
i
*
c_dim
+
ic
]+drho_phi_dr[i¡¬t+1]*dE[
j
*c_dim+
jc
]+drho_phi_dr[i¡¬t])*
B_·œ
[
ii¡¬t
];

341 
­aœ
=-(
drho_phi_d®pha
[
i¡¬t
+2]*
dE
[
i
*
c_dim
+
ic
]+drho_phi_d®pha[i¡¬t+1]*dE[
j
*c_dim+
jc
]+drho_phi_d®pha[i¡¬t])*
B_·œ
[
ii¡¬t
];

342 
f_®phavec
[
i
*
c_dim
+
ic
]+=
­aœ
*
®pha
[i*c_dim+ic];

343 
f_®phavec
[
j
*
c_dim
+
jc
]+=
­aœ
*
®pha
[j*c_dim+jc];

347 
Algeb¿
::
V_add_x_mul_V
<
__dim__
>(
åaœ
,
dx_ij
,
fvec
+
i
*__dim__);

348 
Algeb¿
::
V_add_x_mul_V
<
__dim__
>(-
åaœ
,
dx_ij
,
fvec
+
j
*__dim__);

352 
ic
=0;ic<
c_dim
;ic++)

353 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

355 
åaœ
-=(
drho_phi_dr
[
i¡¬t
+2]*
dE
[
i
*
c_dim
+
ic
]+drho_phi_dr[i¡¬t+1]*dE[
j
*c_dim+
jc
]+drho_phi_dr[i¡¬t])*
B_·œ
[
ii¡¬t
];

356 
­aœ
=-(
drho_phi_d®pha
[
i¡¬t
+2]*
dE
[
i
*
c_dim
+
ic
]+drho_phi_d®pha[i¡¬t+1]*dE[
j
*c_dim+
jc
]+drho_phi_d®pha[i¡¬t])*
B_·œ
[
ii¡¬t
];

357 
f_®phavec
[
i
*
c_dim
+
ic
]+=
­aœ
*
®pha
[i*c_dim+ic];

359 
Algeb¿
::
V_add_x_mul_V
<
__dim__
>(
åaœ
,
dx_ij
,
fvec
+
i
*__dim__);

360 
åaœ
*=0.5;

363 
Algeb¿
::
DyadicV
<
__dim__
>(-
åaœ
,
dx_ij
,&
__vec_lş
[1]);

367 
ic
=0;ic<
c_dim
;ic++)

368 
f_®phavec
[
i
*
c_dim
+
ic
]+=3.0*
kbT
*
c
[i*c_dim+ic]/
®pha
[i*c_dim+ic];

373 
	}
}

377 
	gFÜûF›ldEAMDMDCLUSTER
::
	$__’”gy_ÿlc
()

379 if(
max_·œs
<
ÃighbÜ
->
no_·œs
)

381 
d–‘e
 [] 
rho_phi
;

382 
d–‘e
 [] 
drho_phi_dr
;

383 
d–‘e
 [] 
drho_phi_d®pha
;

384 
d–‘e
 [] 
B_·œ
;

385 
d–‘e
 [] 
is_·œ
;

387 
max_·œs
=
ÃighbÜ
->
no_·œs
;

388 
size_t
 
no_0
=3*
max_·œs
*
c_dim
*c_dim;

389 
MemÜy
::
	`®loc
(
rho_phi
,
no_0
);

390 
MemÜy
::
	`®loc
(
drho_phi_dr
,
no_0
);

391 
MemÜy
::
	`®loc
(
drho_phi_d®pha
,
no_0
);

392 
MemÜy
::
	`®loc
(
B_·œ
,
c_dim
*c_dim*
max_·œs
);

393 
MemÜy
::
	`®loc
(
is_·œ
,
max_·œs
);

396 
i
=0;i<
max_·œs
*
c_dim
*c_dim*3;i++è
rho_phi
[i]=
drho_phi_dr
[i]=
drho_phi_d®pha
[i]=0.0;

397 
i
=0;i<
max_·œs
*
c_dim
*c_dim;i++è
B_·œ
[i]=0.0;

398 
i
=0;i<
max_·œs
;i++è
is_·œ
[i]=
çl£
;

404 
ty³0
 
r
,
r_šv
;

405 
size_t
 
m
;

406 
ty³0
* 
cÛf
;

407 
ty³0
 
tmp0
,
tmp1
;

408 
ty³0
 
p
,
cv_i
;

410 
ty³0
 cÚ¡* 
c
=
©oms
->c->
	`begš
();

414 
ty³0
* 
dE
=
dE_±r
->
	`begš
();

415 
ty³0
* 
rho
=
rho_±r
->
	`begš
();

416 
Çtms_lş
=
©oms
->natms_lcl;

417 
i
=0;i<
Çtms_lş
*
c_dim
;i++è
rho
[i]=0.0;

419 
ty³0
 
®pha_ij_sq
,
®pha_ij
,
rsq
;

423 cÚ¡ 
ty³0
* 
x
=
©oms
->x->
	`begš
();

424 cÚ¡ 
ty³0
* 
®pha
=
©oms
->®pha->
	`begš
();

425 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->neighbor_list;

426 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->neighbor_list_size;

428 
ty³0
 
’t_lş
=0.0,
vib_lş
=0.0;

429 
size_t
 
i¡¬t
=0;

430 
i
=0;i<
Çtms_lş
;i++)

432 cÚ¡ 
Ãigh_sz
=
ÃighbÜ_li¡_size
[
i
];

433 
j
,
__j
=0;__j<
Ãigh_sz
;__j++)

435 
j
=
ÃighbÜ_li¡
[
i
][
__j
];

436 
rsq
=
Algeb¿
::
RSQ
<
__dim__
>(
x
+
i
*__dim__,x+
j
*__dim__);

437 
r
=
	`sq¹
(
rsq
);

439 
ic
=0;ic<
c_dim
;ic++)

440 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3)

442 
®pha_ij_sq
=
®pha
[
i
*
c_dim
+
ic
]*®pha[i*c_dim+ic]+®pha[
j
*c_dim+
jc
]*alpha[j*c_dim+jc];

443 
®pha_ij
=
	`sq¹
(
®pha_ij_sq
);

444 if(
r
-
®pha_ij
*
xi
[
N
-1]>=
cut
[
ic
][
jc
]) ;

446 
is_·œ
[
i¡¬t
/(3*
c_dim
*c_dim)]=
Œue
;

447 
ty³0
 
uµ”
=(
r
+
cut
[
ic
][
jc
])/
®pha_ij
;

448 
ty³0
 
low”
=(
r
-
cut
[
ic
][
jc
])/
®pha_ij
;

449 
ty³0
 
__r
,
p
,
tmp0
,
xi2
;

450 
ty³0
* 
cÛf
;

453 
ty³0
 
H
[3][1]{
	`DESIG2
(3,1,0.0)};

454 
l
=0;l<
N
;l++)

456 if(
xi
[
l
]<=
low”
 && xi[l]>=
uµ”
) ;

458 
xi2
=
xi
[
l
]*xi[l];

460 
__r
=
r
-
xi
[
l
]*
®pha_ij
;

461 
p
=
	`çbs
(
__r
)*
dr_šv
;

462 
m
=
¡©ic_ÿ¡
<
size_t
>(
p
);

463 
m
=
	`MIN
(m,
Ä
-2);

464 
p
-=
m
;

465 
p
=
	`MIN
(p,1.0);

467 
cÛf
=
r_phi_¬r
[
ic
][
jc
][
m
];

468 
tmp0
=((
cÛf
[3]*
p
+coef[2])*p+coef[1])*p+coef[0];

469 if(
__r
<0.0è
tmp0
*=-1.0;

470 
tmp0
*=
wi_0
[
l
];

471 
H
[0][0]+=
tmp0
;

475 
cÛf
=
r_rho_¬r
[
ic
][
jc
][
m
];

476 
tmp0
=((
cÛf
[3]*
p
+coef[2])*p+coef[1])*p+coef[0];

477 if(
__r
<0.0è
tmp0
*=-1.0;

478 
tmp0
*=
wi_0
[
l
];

479 
H
[1][0]+=
tmp0
;

482 
cÛf
=
r_rho_¬r
[
jc
][
ic
][
m
];

483 
tmp0
=((
cÛf
[3]*
p
+coef[2])*p+coef[1])*p+coef[0];

484 if(
__r
<0.0è
tmp0
*=-1.0;

485 
tmp0
*=
wi_0
[
l
];

486 
H
[2][0]+=
tmp0
;

490 
r_šv
=1.0/
r
;

494 
Algeb¿
::
Do
<3>::
	`func
([&
i¡¬t
,&
H
,&
r_šv
,
this
]

495 (
i
)

497 
rho_phi
[
i¡¬t
+
i
]=
PI_IN_SQ
*
r_šv
*
H
[i][0];

501 
rho
[
i
*
c_dim
+
ic
]+=
c
[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
+2];

503 if(
j
<
Çtms_lş
)

505 
rho
[
j
*
c_dim
+
jc
]+=
c
[
i
*c_dim+
ic
]*
rho_phi
[
i¡¬t
+1];

506 
__vec_lş
[0]+=
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
];

509 
__vec_lş
[0]+=0.5*
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
];

514 
cv_i
=1.0;

515 
ic
=0;ic<
c_dim
;ic++)

517 
p
=
rho
[
i
*
c_dim
+
ic
]*
drho_šv
;

518 
m
=
¡©ic_ÿ¡
<
size_t
>(
p
);

519 
m
=
	`MIN
(m,
Äho
-2);

520 
p
-=
m
;

521 
p
=
	`MIN
(p,1.0);

522 
cÛf
=
F_¬r
[
ic
][
m
];

524 
tmp0
=(((
cÛf
[4]*
p
+coef[3])*p+coef[2])*p+coef[1])*p+coef[0];

525 
tmp1
=(((4.0*
cÛf
[4]*
p
+3.0*cÛf[3])*p+2.0*cÛf[2])*p+cÛf[1])*
drho_šv
;

527 if(
rho
[
i
*
c_dim
+
ic
]>
rho_max
è
tmp0
+=
tmp1
*(rho[i*c_dim+ic]-rho_max);

529 
dE
[
i
*
c_dim
+
ic
]=
tmp1
;

530 
__vec_lş
[0]+=
c
[
i
*
c_dim
+
ic
]*
tmp0
;

533 
vib_lş
+=
c
[
i
*
c_dim
+
ic
]*(
c_0
[ic]-3.0*
kbT
*
	`log
(
®pha
[i*c_dim+ic]));

534 
’t_lş
+=
	`ÿlc_’t
(
c
[
i
*
c_dim
+
ic
]);

535 
cv_i
-=
c
[
i
*
c_dim
+
ic
];

538 
’t_lş
+=
	`ÿlc_’t
(
cv_i
);

541 
	`upd©e
(
dE_±r
);

543 
	`___sc_loİ
();

544 
__vec_lş
[0]+=
vib_lş
;

545 
__vec_lş
[1+
__nvoigt__
]+=
’t_lş
;

546 
__vec_lş
[0]+=
kbT
*
’t_lş
;

547 
	}
}

551 
	gFÜûF›ldEAMDMDCLUSTER
::
	$sc_loİ
()

555 
ty³0
* 
dE
=
dE_±r
->
	`begš
();

556 
ty³0
* 
rho
=
rho_±r
->
	`begš
();

558 
ty³0
* 
cÛf
;

559 
size_t
 
m
,
ii¡¬t
,
i¡¬t
;

560 
ty³0
 
´ev_’
,
cu¼_’
;

561 
	`MPI_AÎ»duû
(
__vec_lş
,&
´ev_’
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

562 
ty³0
 
p
,
’_diff
=1.0,
tmp0
,
tmp1
;

563 
Çtms_lş
=
©oms
->natms_lcl;

564 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->neighbor_list;

565 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->neighbor_list_size;

566 
ty³0
 cÚ¡* 
c
=
©oms
->c->
	`begš
();

567 
ty³0
* 
b
=
b_±r
->
	`begš
();

568 
ty³0
 
³_lş
=0.0,
’t_cÜr_lş
=0.0;

569 
ty³0
 
cu¼_’_lş
=0.0;

570 
’_diff
>
TOL
)

572 
i
=0;i<
Çtms_lş
*
c_dim
;i++è
rho
[i]=0.0;

573 
i
=0;i<
Çtms_lş
;i++è
b
[i]=0.0;

576 
i¡¬t
=0;

577 
ii¡¬t
=0;

578 
³_lş
=
’t_cÜr_lş
=0.0;

579 
i
=0;i<
Çtms_lş
;i++)

581 cÚ¡ 
Ãigh_sz
=
ÃighbÜ_li¡_size
[
i
];

582 
j
,
__j
=0;__j<
Ãigh_sz
;__j++)

584 
j
=
ÃighbÜ_li¡
[
i
][
__j
];

586 if(! 
is_·œ
[
ii¡¬t
/4])

589 
B_·œ
[
ii¡¬t
]=
c
[
i
*
c_dim
]*c[
j
*c_dim];

590 
B_·œ
[
ii¡¬t
+1]=
c
[
i
*
c_dim
]*c[
j
*c_dim+1];

591 
B_·œ
[
ii¡¬t
+2]=
c
[
i
*
c_dim
+1]*c[
j
*c_dim];

592 
B_·œ
[
ii¡¬t
+3]=
c
[
i
*
c_dim
+1]*c[
j
*c_dim+1];

595 if(
j
<
Çtms_lş
)

597 
ic
=0;ic<
c_dim
;ic++)

598 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

600 
³_lş
+=
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
];

601 
rho
[
i
*
c_dim
+
ic
]+=
c
[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
+2];

602 
rho
[
j
*
c_dim
+
jc
]+=
c
[
i
*c_dim+
ic
]*
rho_phi
[
i¡¬t
+1];

607 
ic
=0;ic<
c_dim
;ic++)

608 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

610 
³_lş
+=0.5*
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
];

611 
rho
[
i
*
c_dim
+
ic
]+=
c
[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
+2];

618 
ty³0
 
m
=0.0;

619 
ic
=0;ic<
c_dim
;ic++)

620 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3)

622 if(
ic
==
jc
)

623 
m
+=-
b‘a
*(
rho_phi
[
i¡¬t
+2]*
dE
[
i
*
c_dim
+
ic
]+rho_phi[i¡¬t+1]*dE[
j
*c_dim+
jc
]+rho_phi[istart]);

625 
m
-=-
b‘a
*(
rho_phi
[
i¡¬t
+2]*
dE
[
i
*
c_dim
+
ic
]+rho_phi[i¡¬t+1]*dE[
j
*c_dim+
jc
]+rho_phi[istart]);

627 
i¡¬t
-=3*
c_dim
*c_dim;

630 
ty³0
 
u
;

632 if(
m
!=0.0)

635 
ty³0
 
__a
,
__b
,
__c
,
__d–
;

637 if((
c
[
i
*
c_dim
]==0.0 && c[
j
*c_dim]==0.0) || (c[i*c_dim]==1.0 && c[j*c_dim]==1.0))

639 
u
=
c
[
i
*
c_dim
];

643 
__a
=0.0;

645 if(
m
<0.0)

647 
__a
=
	`exp
(
m
)-1.0;

648 
__b
=-1.0-(
c
[
j
*
c_dim
]+c[
i
*c_dim])*
__a
;

649 
__c
=
c
[
j
*
c_dim
]*c[
i
*c_dim]*(
__a
+1.0);

653 
__a
=1.0-
	`exp
(-
m
);

654 
__b
=-(
c
[
j
*
c_dim
]+c[
i
*c_dim]-1.0)*
__a
-1.0;

655 
__c
=
c
[
j
*
c_dim
]*c[
i
*c_dim];

658 
ty³0
 
__x0
=0.0,
__x1
=0.0;

659 if(
__a
==0.0)

663 
u
=-
__c
/
__b
;

667 
__d–
=
	`sq¹
(
__b
*__b-4.0*
__a
*
__c
);

669 
__x1
=0.5*(-
__b
+
__d–
)/
__a
;

670 
__x0
=0.5*(-
__b
-
__d–
)/
__a
;

671 if(
__x0
<=
c
[
i
*
c_dim
] && __x0<=c[
j
*c_dim] && __x0>=0.0)

672 
u
=
__x0
;

674 
u
=
__x1
;

680 
B_·œ
[
ii¡¬t
]=
u
;

681 
B_·œ
[
ii¡¬t
+1]=
c
[
i
*
c_dim
]-
u
;

682 
B_·œ
[
ii¡¬t
+2]=
c
[
j
*
c_dim
]-
u
;

683 
B_·œ
[
ii¡¬t
+3]=1.0-
c
[
i
*
c_dim
]-c[
j
*c_dim]+
u
;

686 if(
j
<
Çtms_lş
)

688 
’t_cÜr_lş
+=
	`ÿlc_’t
(
B_·œ
[
ii¡¬t
]);

689 
b
[
i
]+=
u
;

690 
b
[
j
]+=
u
;

691 
ic
=0;ic<
c_dim
;ic++)

692 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

694 
³_lş
+=
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
];

695 if(
c
[
i
*
c_dim
+
ic
]>0.0)

696 
rho
[
i
*
c_dim
+
ic
]+=
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
+2]/
c
[i*c_dim+ic];

697 if(
c
[
j
*
c_dim
+
jc
]>0.0)

698 
rho
[
j
*
c_dim
+
jc
]+=
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
+1]/
c
[j*c_dim+jc];

705 
b
[
i
]+=
u
;

706 
’t_cÜr_lş
+=0.5*
	`ÿlc_’t
(
B_·œ
[
ii¡¬t
]);

707 
ic
=0;ic<
c_dim
;ic++)

708 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

710 
³_lş
+=0.5*
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
];

711 if(
c
[
i
*
c_dim
+
ic
]>0.0)

712 
rho
[
i
*
c_dim
+
ic
]+=
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
+2]/
c
[i*c_dim+ic];

720 
B_·œ
[
ii¡¬t
]=
c
[
i
*
c_dim
]*c[
j
*c_dim];

721 
B_·œ
[
ii¡¬t
+1]=
c
[
i
*
c_dim
]*c[
j
*c_dim+1];

722 
B_·œ
[
ii¡¬t
+2]=
c
[
i
*
c_dim
+1]*c[
j
*c_dim];

723 
B_·œ
[
ii¡¬t
+3]=
c
[
i
*
c_dim
+1]*c[
j
*c_dim+1];

726 if(
j
<
Çtms_lş
)

728 
b
[
i
]+=
c
[i*
c_dim
]*c[
j
*c_dim];

729 
b
[
j
]+=
c
[
i
*
c_dim
]*c[j*c_dim];

730 
ic
=0;ic<
c_dim
;ic++)

731 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

733 
³_lş
+=
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
];

734 
rho
[
i
*
c_dim
+
ic
]+=
c
[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
+2];

735 
rho
[
j
*
c_dim
+
jc
]+=
c
[
i
*c_dim+
ic
]*
rho_phi
[
i¡¬t
+1];

741 
b
[
i
]+=
c
[i*
c_dim
]*c[
j
*c_dim];

742 
ic
=0;ic<
c_dim
;ic++)

743 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

745 
³_lş
+=0.5*
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
];

746 
rho
[
i
*
c_dim
+
ic
]+=
c
[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
+2];

754 
ic
=0;ic<
c_dim
;ic++)

757 
p
=
rho
[
i
*
c_dim
+
ic
]*
drho_šv
;

758 
m
=
¡©ic_ÿ¡
<
size_t
>(
p
);

759 
m
=
	`MIN
(m,
Äho
-2);

760 
p
-=
m
;

761 
p
=
	`MIN
(p,1.0);

762 
cÛf
=
F_¬r
[
ic
][
m
];

764 
tmp0
=(((
cÛf
[4]*
p
+coef[3])*p+coef[2])*p+coef[1])*p+coef[0];

765 
tmp1
=(((4.0*
cÛf
[4]*
p
+3.0*cÛf[3])*p+2.0*cÛf[2])*p+cÛf[1])*
drho_šv
;

767 if(
rho
[
i
*
c_dim
+
ic
]>
rho_max
è
tmp0
+=
tmp1
*(rho[i*c_dim+ic]-rho_max);

769 
dE
[
i
*
c_dim
+
ic
]=
tmp1
;

770 
³_lş
+=
c
[
i
*
c_dim
+
ic
]*
tmp0
;

778 
cu¼_’_lş
=
³_lş
+
’t_cÜr_lş
*
kbT
;

779 
	`MPI_AÎ»duû
(&
cu¼_’_lş
,&
cu¼_’
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

781 
’_diff
=
	`çbs
(
cu¼_’
-
´ev_’
);

782 
´ev_’
=
cu¼_’
;

783 
	`upd©e
(
dE_±r
);

787 
	`upd©e
(
b_±r
);

789 
ty³0
* 
th‘a
=
th‘a_±r
->
	`begš
();

790 
ty³0
* 
d
=
d_±r
->
	`begš
();

791 
i
=0;i<
Çtms_lş
+
©oms
->
Çtms_ph
;i++è
th‘a
[i]=
c
[2*i];

792 
’_diff
=1.0;

793 
ty³0
 
cu¼_ã_lş
=0.0,
cu¼_ã
=0.0;

795 
i
=0;i<
Çtms_lş
;i++è
d
[i]=0.0;

796 
ii¡¬t
=0;

797 
i
=0;i<
Çtms_lş
;i++)

799 cÚ¡ 
Ãigh_sz
=
ÃighbÜ_li¡_size
[
i
];

800 
j
,
__j
=0;__j<
Ãigh_sz
;__j++,
ii¡¬t
++)

802 
j
=
ÃighbÜ_li¡
[
i
][
__j
];

803 if(! 
is_·œ
[
ii¡¬t
]) ;

804 
d
[
i
]+=
th‘a
[
j
];

805 if(
j
<
Çtms_lş
)

806 
d
[
j
]+=
th‘a
[
i
];

808 if(
th‘a
[
i
]!=0.0 ||heta[i]!=1.0)

810 
cu¼_ã_lş
+=(1.0-
c
[
i
*
c_dim
])*
	`log
(1.0-
th‘a
[i])+(c[i*c_dim]-
b
[i])*log(theta[i]);

812 
cu¼_ã_lş
+=0.5*(
th‘a
[
i
]*
d
[i]-
b
[i]);

815 
	`MPI_AÎ»duû
(&
cu¼_ã_lş
,&
cu¼_ã
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

816 
	`upd©e
(
b_±r
);

818 
ty³0
 
´ev_ã
=
cu¼_ã
;

821 
’_diff
>
TOL
)

826 
i
=0;i<
Çtms_lş
;i++)

828 if(
d
[
i
]!=0.0)

831 
ty³0
 
d–_sq
=(
d
[
i
]+
b
[i]-1.0)*(d[i]+b[i]-1.0)-4.0*(b[i]-
c
[i*
c_dim
])*d[i];

833 
ty³0
 
d–
=
	`sq¹
(
d–_sq
);

834 
ty³0
 
th‘a_i0
=0.5*(
d
[
i
]+
b
[i]-1.0-
d–
)/d[i];

835 
ty³0
 
th‘a_i1
=0.5*(
d
[
i
]+
b
[i]-1.0+
d–
)/d[i];

836 
boŞ
 
th‘a0_acc
=
çl£
;

837 
boŞ
 
th‘a1_acc
=
çl£
;

838 if(0.0<=
th‘a_i0
 &&heta_i0<=1.0)

839 
th‘a0_acc
=
Œue
;

840 if(0.0<=
th‘a_i1
 &&heta_i1<=1.0)

841 
th‘a1_acc
=
Œue
;

842 if(
th‘a0_acc
 && 
th‘a1_acc
)

844 
ty³0
 
d0
=
	`çbs
(
c
[
i
*
c_dim
]-
th‘a_i0
);

845 
ty³0
 
d1
=
	`çbs
(
c
[
i
*
c_dim
]-
th‘a_i1
);

847 if(
d0
<
d1
)

848 
th‘a
[
i
]=
th‘a_i0
;

849 
th‘a
[
i
]=
th‘a_i1
;

853 if(
th‘a0_acc
)

854 
th‘a
[
i
]=
th‘a_i0
;

856 
th‘a
[
i
]=
th‘a_i1
;

863 
th‘a
[
i
]=(
c
[i*
c_dim
]-
b
[i])/(1.0-b[i]);

870 
i
=0;i<
Çtms_lş
;i++è
d
[i]=0.0;

871 
cu¼_ã_lş
=0.0;

872 
ii¡¬t
=0;

873 
i
=0;i<
Çtms_lş
;i++)

875 cÚ¡ 
Ãigh_sz
=
ÃighbÜ_li¡_size
[
i
];

876 
j
,
__j
=0;__j<
Ãigh_sz
;__j++,
ii¡¬t
++)

878 
j
=
ÃighbÜ_li¡
[
i
][
__j
];

879 if(! 
is_·œ
[
ii¡¬t
]) ;

880 
d
[
i
]+=
th‘a
[
j
];

881 if(
j
<
Çtms_lş
)

882 
d
[
j
]+=
th‘a
[
i
];

885 if(
th‘a
[
i
]!=0.0 &&heta[i]!=1.0)

887 
cu¼_ã_lş
+=(1.0-
c
[
i
*
c_dim
])*
	`log
(1.0-
th‘a
[i])+(c[i*c_dim]-
b
[i])*log(theta[i]);

892 
cu¼_ã_lş
+=0.5*(
th‘a
[
i
]*
d
[i]-
b
[i]);

896 
	`upd©e
(
d_±r
);

898 
	`MPI_AÎ»duû
(&
cu¼_ã_lş
,&
cu¼_ã
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

900 
’_diff
=
	`çbs
(
cu¼_ã
-
´ev_ã
);

901 
´ev_ã
=
cu¼_ã
;

906 
i
=0;i<
Çtms_lş
;i++)

907 
	`´štf
("th‘a[%d] %%%| %e\n",
i
,
th‘a
[i],th‘a[i]*
d
[i],
b
[i],theta[i]+b[i]*(1.0-theta[i])-theta[i]*(1.0-theta[i])*d[i]);

909 
__vec_lş
[1+
__nvoigt__
]=
’t_cÜr_lş
+
cu¼_ã_lş
;

914 
__vec_lş
[0]=
³_lş
+
kbT
*(
’t_cÜr_lş
+
cu¼_ã_lş
);

920 
	}
}

924 
	gFÜûF›ldEAMDMDCLUSTER
::
	$_sc_loİ
()

928 
ty³0
* 
dE
=
dE_±r
->
	`begš
();

929 
ty³0
* 
rho
=
rho_±r
->
	`begš
();

931 
ty³0
* 
cÛf
;

932 
size_t
 
m
,
ii¡¬t
,
i¡¬t
;

933 
ty³0
 
´ev_’
,
cu¼_’
;

934 
	`MPI_AÎ»duû
(
__vec_lş
,&
´ev_’
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

935 
ty³0
 
p
,
’_diff
=1.0,
tmp0
,
tmp1
;

936 
Çtms_lş
=
©oms
->natms_lcl;

937 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->neighbor_list;

938 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->neighbor_list_size;

939 
ty³0
 cÚ¡* 
c
=
©oms
->c->
	`begš
();

940 
ty³0
 
³_lş
=0.0,
’t_cÜr_lş
=0.0;

941 
ty³0
 
cu¼_’_lş
=0.0;

942 
’_diff
>
TOL
)

944 
i
=0;i<
Çtms_lş
*
c_dim
;i++è
rho
[i]=0.0;

947 
i¡¬t
=0;

948 
ii¡¬t
=0;

949 
³_lş
=
’t_cÜr_lş
=0.0;

950 
i
=0;i<
Çtms_lş
;i++)

952 cÚ¡ 
Ãigh_sz
=
ÃighbÜ_li¡_size
[
i
];

953 
j
,
__j
=0;__j<
Ãigh_sz
;__j++)

955 
j
=
ÃighbÜ_li¡
[
i
][
__j
];

957 if(! 
is_·œ
[
ii¡¬t
/4])

960 
B_·œ
[
ii¡¬t
]=
c
[
i
*
c_dim
]*c[
j
*c_dim];

961 
B_·œ
[
ii¡¬t
+1]=
c
[
i
*
c_dim
]*c[
j
*c_dim+1];

962 
B_·œ
[
ii¡¬t
+2]=
c
[
i
*
c_dim
+1]*c[
j
*c_dim];

963 
B_·œ
[
ii¡¬t
+3]=
c
[
i
*
c_dim
+1]*c[
j
*c_dim+1];

966 if(
j
<
Çtms_lş
)

968 
ic
=0;ic<
c_dim
;ic++)

969 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

971 
³_lş
+=
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
];

972 
rho
[
i
*
c_dim
+
ic
]+=
c
[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
+2];

973 
rho
[
j
*
c_dim
+
jc
]+=
c
[
i
*c_dim+
ic
]*
rho_phi
[
i¡¬t
+1];

978 
ic
=0;ic<
c_dim
;ic++)

979 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

981 
³_lş
+=0.5*
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
];

982 
rho
[
i
*
c_dim
+
ic
]+=
c
[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
+2];

989 
ty³0
 
m
=0.0;

990 
ic
=0;ic<
c_dim
;ic++)

991 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3)

993 if(
ic
==
jc
)

994 
m
+=-
b‘a
*(
rho_phi
[
i¡¬t
+2]*
dE
[
i
*
c_dim
+
ic
]+rho_phi[i¡¬t+1]*dE[
j
*c_dim+
jc
]+rho_phi[istart]);

996 
m
-=-
b‘a
*(
rho_phi
[
i¡¬t
+2]*
dE
[
i
*
c_dim
+
ic
]+rho_phi[i¡¬t+1]*dE[
j
*c_dim+
jc
]+rho_phi[istart]);

998 
i¡¬t
-=3*
c_dim
*c_dim;

1001 
ty³0
 
u
;

1003 if(
m
!=0.0)

1006 
ty³0
 
__a
,
__b
,
__c
,
__d–
;

1008 if((
c
[
i
*
c_dim
]==0.0 && c[
j
*c_dim]==0.0) || (c[i*c_dim]==1.0 && c[j*c_dim]==1.0))

1010 
u
=
c
[
i
*
c_dim
];

1014 
__a
=0.0;

1016 if(
m
<0.0)

1018 
__a
=
	`exp
(
m
)-1.0;

1019 
__b
=-1.0-(
c
[
j
*
c_dim
]+c[
i
*c_dim])*
__a
;

1020 
__c
=
c
[
j
*
c_dim
]*c[
i
*c_dim]*(
__a
+1.0);

1024 
__a
=1.0-
	`exp
(-
m
);

1025 
__b
=-(
c
[
j
*
c_dim
]+c[
i
*c_dim]-1.0)*
__a
-1.0;

1026 
__c
=
c
[
j
*
c_dim
]*c[
i
*c_dim];

1029 
ty³0
 
__x0
=0.0,
__x1
=0.0;

1030 if(
__a
==0.0)

1034 
u
=-
__c
/
__b
;

1038 
__d–
=
	`sq¹
(
__b
*__b-4.0*
__a
*
__c
);

1040 
__x1
=0.5*(-
__b
+
__d–
)/
__a
;

1041 
__x0
=0.5*(-
__b
-
__d–
)/
__a
;

1042 if(
__x0
<=
c
[
i
*
c_dim
] && __x0<=c[
j
*c_dim] && __x0>=0.0)

1043 
u
=
__x0
;

1045 
u
=
__x1
;

1051 
B_·œ
[
ii¡¬t
]=
u
;

1052 
B_·œ
[
ii¡¬t
+1]=
c
[
i
*
c_dim
]-
u
;

1053 
B_·œ
[
ii¡¬t
+2]=
c
[
j
*
c_dim
]-
u
;

1054 
B_·œ
[
ii¡¬t
+3]=1.0-
c
[
i
*
c_dim
]-c[
j
*c_dim]+
u
;

1056 
ty³0
 
•s_ij
=-1.0;

1057 if(
c
[
i
*
c_dim
]*c[i*c_dim]!=0.0)

1058 
•s_ij
=
u
/(
c
[
i
*
c_dim
]*c[
j
*c_dim])-1.0;

1060 if(
j
<
Çtms_lş
)

1062 
’t_cÜr_lş
+=(
	`ÿlc_’t
(1.0+
•s_ij
)-•s_ij)*(
c
[
i
*
c_dim
]*c[
j
*c_dim]);

1064 
ic
=0;ic<
c_dim
;ic++)

1065 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

1067 
³_lş
+=
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
];

1068 if(
c
[
i
*
c_dim
+
ic
]>0.0)

1069 
rho
[
i
*
c_dim
+
ic
]+=
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
+2]/
c
[i*c_dim+ic];

1070 if(
c
[
j
*
c_dim
+
jc
]>0.0)

1071 
rho
[
j
*
c_dim
+
jc
]+=
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
+1]/
c
[j*c_dim+jc];

1078 
’t_cÜr_lş
+=0.5*(
	`ÿlc_’t
(1.0+
•s_ij
)-•s_ij)*(
c
[
i
*
c_dim
]*c[
j
*c_dim]);

1081 
ic
=0;ic<
c_dim
;ic++)

1082 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

1084 
³_lş
+=0.5*
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
];

1085 if(
c
[
i
*
c_dim
+
ic
]>0.0)

1086 
rho
[
i
*
c_dim
+
ic
]+=
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
+2]/
c
[i*c_dim+ic];

1094 
B_·œ
[
ii¡¬t
]=
c
[
i
*
c_dim
]*c[
j
*c_dim];

1095 
B_·œ
[
ii¡¬t
+1]=
c
[
i
*
c_dim
]*c[
j
*c_dim+1];

1096 
B_·œ
[
ii¡¬t
+2]=
c
[
i
*
c_dim
+1]*c[
j
*c_dim];

1097 
B_·œ
[
ii¡¬t
+3]=
c
[
i
*
c_dim
+1]*c[
j
*c_dim+1];

1100 if(
j
<
Çtms_lş
)

1102 
ic
=0;ic<
c_dim
;ic++)

1103 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

1105 
³_lş
+=
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
];

1106 
rho
[
i
*
c_dim
+
ic
]+=
c
[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
+2];

1107 
rho
[
j
*
c_dim
+
jc
]+=
c
[
i
*c_dim+
ic
]*
rho_phi
[
i¡¬t
+1];

1113 
ic
=0;ic<
c_dim
;ic++)

1114 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

1116 
³_lş
+=0.5*
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
];

1117 
rho
[
i
*
c_dim
+
ic
]+=
c
[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
+2];

1125 
ic
=0;ic<
c_dim
;ic++)

1128 
p
=
rho
[
i
*
c_dim
+
ic
]*
drho_šv
;

1129 
m
=
¡©ic_ÿ¡
<
size_t
>(
p
);

1130 
m
=
	`MIN
(m,
Äho
-2);

1131 
p
-=
m
;

1132 
p
=
	`MIN
(p,1.0);

1133 
cÛf
=
F_¬r
[
ic
][
m
];

1135 
tmp0
=(((
cÛf
[4]*
p
+coef[3])*p+coef[2])*p+coef[1])*p+coef[0];

1136 
tmp1
=(((4.0*
cÛf
[4]*
p
+3.0*cÛf[3])*p+2.0*cÛf[2])*p+cÛf[1])*
drho_šv
;

1138 if(
rho
[
i
*
c_dim
+
ic
]>
rho_max
è
tmp0
+=
tmp1
*(rho[i*c_dim+ic]-rho_max);

1140 
dE
[
i
*
c_dim
+
ic
]=
tmp1
;

1141 
³_lş
+=
c
[
i
*
c_dim
+
ic
]*
tmp0
;

1149 
cu¼_’_lş
=
³_lş
+
’t_cÜr_lş
*
kbT
;

1150 
	`MPI_AÎ»duû
(&
cu¼_’_lş
,&
cu¼_’
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

1152 
’_diff
=
	`çbs
(
cu¼_’
-
´ev_’
);

1153 
´ev_’
=
cu¼_’
;

1154 
	`upd©e
(
dE_±r
);

1159 
__vec_lş
[1+
__nvoigt__
]=
’t_cÜr_lş
;

1161 
__vec_lş
[0]=
³_lş
+
kbT
*
’t_cÜr_lş
;

1163 
	}
}

1167 
	gFÜûF›ldEAMDMDCLUSTER
::
	$__sc_loİ
()

1171 
ty³0
* 
dE
=
dE_±r
->
	`begš
();

1172 
ty³0
* 
rho
=
rho_±r
->
	`begš
();

1174 
ty³0
* 
cÛf
;

1175 
size_t
 
m
,
ii¡¬t
,
i¡¬t
;

1176 
ty³0
 
’t_cÜr_lş
=0.0,
´ev_’
,
cu¼_’
;

1177 
	`MPI_AÎ»duû
(
__vec_lş
,&
´ev_’
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

1178 
ty³0
 
p
,
’_diff
=1.0,
tmp0
,
tmp1
;

1179 
Çtms_lş
=
©oms
->natms_lcl;

1180 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->neighbor_list;

1181 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->neighbor_list_size;

1182 
ty³0
 cÚ¡* 
c
=
©oms
->c->
	`begš
();

1184 
’_diff
>
TOL
)

1186 
i
=0;i<
Çtms_lş
*
c_dim
;i++è
rho
[i]=0.0;

1188 
__vec_lş
[0]=__vec_lş[1+
__nvoigt__
]=0.0;

1189 
i¡¬t
=0;

1190 
ii¡¬t
=0;

1191 
’t_cÜr_lş
=0.0;

1192 
i
=0;i<
Çtms_lş
;i++)

1194 cÚ¡ 
Ãigh_sz
=
ÃighbÜ_li¡_size
[
i
];

1195 
j
,
__j
=0;__j<
Ãigh_sz
;__j++)

1197 
j
=
ÃighbÜ_li¡
[
i
][
__j
];

1199 
ty³0
 
oo
=
c
[
i
*
c_dim
]*c[
j
*c_dim]*(1.0-c[i*c_dim])*(1.0-c[j*c_dim]);

1200 
ty³0
 
d–_mš
=
	`MAX
(-
c
[
i
*
c_dim
]*c[
j
*c_dim],-(1.0-c[i*c_dim])*(1.0-c[j*c_dim]));

1201 
ty³0
 
d–_max
=
	`MIN
(
c
[
i
*
c_dim
]*(1.0-c[
j
*c_dim]),(1.0-c[i*c_dim])*c[j*c_dim]);

1203 
ty³0
 
m
=0.0;

1204 
ic
=0;ic<
c_dim
;ic++)

1205 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3)

1207 if(
ic
==
jc
)

1208 
m
+=-
b‘a
*(
rho_phi
[
i¡¬t
+2]*
dE
[
i
*
c_dim
+
ic
]+rho_phi[i¡¬t+1]*dE[
j
*c_dim+
jc
]+rho_phi[istart]);

1210 
m
-=-
b‘a
*(
rho_phi
[
i¡¬t
+2]*
dE
[
i
*
c_dim
+
ic
]+rho_phi[i¡¬t+1]*dE[
j
*c_dim+
jc
]+rho_phi[istart]);

1213 
i¡¬t
-=3*
c_dim
*c_dim;

1215 
m
*=
oo
;

1216 
ty³0
 
d–
=
m
;

1217 if(
d–
>
d–_max
)

1218 
d–
=
d–_max
;

1219 if(
d–
<
d–_mš
)

1220 
d–
=
d–_mš
;

1223 if(
d–
!=0.0)

1227 
B_·œ
[
ii¡¬t
]=
c
[
i
*
c_dim
]*c[
j
*c_dim]+
d–
;

1228 
B_·œ
[
ii¡¬t
+1]=
c
[
i
*
c_dim
]*(1.0-c[
j
*c_dim])-
d–
;

1229 
B_·œ
[
ii¡¬t
+2]=
c
[
j
*
c_dim
]*(1.0-c[
i
*c_dim])-
d–
;

1230 
B_·œ
[
ii¡¬t
+3]=(1.0-
c
[
i
*
c_dim
])*(1.0-c[
j
*c_dim])+
d–
;

1233 if(
j
<
Çtms_lş
)

1235 if(
oo
!=0.0)

1236 
’t_cÜr_lş
+=0.5*
oo
*
	`log
(1.0+
d–
*delta/(oo*oo));

1238 
ic
=0;ic<
c_dim
;ic++)

1239 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

1241 
__vec_lş
[0]+=
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
];

1242 if(
c
[
i
*
c_dim
+
ic
]>0.0)

1243 
rho
[
i
*
c_dim
+
ic
]+=
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
+2]/
c
[i*c_dim+ic];

1244 if(
c
[
j
*
c_dim
+
jc
]>0.0)

1245 
rho
[
j
*
c_dim
+
jc
]+=
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
+1]/
c
[j*c_dim+jc];

1250 if(
oo
!=0.0)

1251 
’t_cÜr_lş
+=0.25*
oo
*
	`log
(1.0+
d–
*delta/(oo*oo));

1253 
ic
=0;ic<
c_dim
;ic++)

1254 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

1256 
__vec_lş
[0]+=0.5*
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
];

1257 if(
c
[
i
*
c_dim
+
ic
]>0.0)

1258 
rho
[
i
*
c_dim
+
ic
]+=
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
+2]/
c
[i*c_dim+ic];

1265 
B_·œ
[
ii¡¬t
]=
c
[
i
*
c_dim
]*c[
j
*c_dim];

1266 
B_·œ
[
ii¡¬t
+1]=
c
[
i
*
c_dim
]*c[
j
*c_dim+1];

1267 
B_·œ
[
ii¡¬t
+2]=
c
[
i
*
c_dim
+1]*c[
j
*c_dim];

1268 
B_·œ
[
ii¡¬t
+3]=
c
[
i
*
c_dim
+1]*c[
j
*c_dim+1];

1271 if(
j
<
Çtms_lş
)

1273 
ic
=0;ic<
c_dim
;ic++)

1274 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

1276 
__vec_lş
[0]+=
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
];

1277 
rho
[
i
*
c_dim
+
ic
]+=
c
[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
+2];

1278 
rho
[
j
*
c_dim
+
jc
]+=
c
[
i
*c_dim+
ic
]*
rho_phi
[
i¡¬t
+1];

1283 
ic
=0;ic<
c_dim
;ic++)

1284 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

1286 
__vec_lş
[0]+=0.5*
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
];

1287 
rho
[
i
*
c_dim
+
ic
]+=
c
[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
+2];

1295 
ic
=0;ic<
c_dim
;ic++)

1298 
p
=
rho
[
i
*
c_dim
+
ic
]*
drho_šv
;

1299 
m
=
¡©ic_ÿ¡
<
size_t
>(
p
);

1300 
m
=
	`MIN
(m,
Äho
-2);

1301 
p
-=
m
;

1302 
p
=
	`MIN
(p,1.0);

1303 
cÛf
=
F_¬r
[
ic
][
m
];

1305 
tmp0
=(((
cÛf
[4]*
p
+coef[3])*p+coef[2])*p+coef[1])*p+coef[0];

1306 
tmp1
=(((4.0*
cÛf
[4]*
p
+3.0*cÛf[3])*p+2.0*cÛf[2])*p+cÛf[1])*
drho_šv
;

1308 if(
rho
[
i
*
c_dim
+
ic
]>
rho_max
è
tmp0
+=
tmp1
*(rho[i*c_dim+ic]-rho_max);

1310 
dE
[
i
*
c_dim
+
ic
]=
tmp1
;

1311 
__vec_lş
[0]+=
c
[
i
*
c_dim
+
ic
]*
tmp0
;

1319 
__vec_lş
[1+
__nvoigt__
]+=
’t_cÜr_lş
;

1320 
__vec_lş
[0]+=
’t_cÜr_lş
*
kbT
;

1322 
	`MPI_AÎ»duû
(
__vec_lş
,&
cu¼_’
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

1323 
’_diff
=
	`çbs
(
cu¼_’
-
´ev_’
);

1325 
´ev_’
=
cu¼_’
;

1326 
	`upd©e
(
dE_±r
);

1330 #ifdeà
SC_DMD


1331 
©oms
->
BB
=
‰
;

1333 
	}
}

1337 
	gFÜûF›ldEAMDMDCLUSTER
::
	$___sc_loİ
()

1341 
ty³0
* 
dE
=
dE_±r
->
	`begš
();

1342 
ty³0
* 
rho
=
rho_±r
->
	`begš
();

1344 
ty³0
* 
cÛf
;

1346 
size_t
 
m
,
ii¡¬t
,
i¡¬t
;

1347 
ty³0
 
’t_cÜr_lş
=0.0,
´ev_’
,
cu¼_’
;

1348 
	`MPI_AÎ»duû
(
__vec_lş
,&
´ev_’
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

1349 
ty³0
 
p
,
’_diff
=1.0,
tmp0
,
tmp1
;

1350 
Çtms_lş
=
©oms
->natms_lcl;

1351 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->neighbor_list;

1352 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->neighbor_list_size;

1353 
ty³0
 cÚ¡* 
c
=
©oms
->c->
	`begš
();

1354 
ty³0
* 
x
=
©oms
->x->
	`begš
();

1356 
ty³0
 
‰
=0.0;

1357 
’_diff
>
TOL
)

1359 
i
=0;i<
Çtms_lş
*
c_dim
;i++è
rho
[i]=0.0;

1361 
__vec_lş
[0]=__vec_lş[1+
__nvoigt__
]=0.0;

1362 
i¡¬t
=0;

1363 
ii¡¬t
=0;

1364 
’t_cÜr_lş
=0.0;

1365 
i
=0;i<
Çtms_lş
;i++)

1367 cÚ¡ 
Ãigh_sz
=
ÃighbÜ_li¡_size
[
i
];

1368 
j
,
__j
=0;__j<
Ãigh_sz
;__j++)

1370 
j
=
ÃighbÜ_li¡
[
i
][
__j
];

1372 
ty³0
 
m
=0.0,
u
;

1373 
ic
=0;ic<
c_dim
;ic++)

1374 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3)

1376 if(
ic
==
jc
)

1377 
m
-=-
b‘a
*(
rho_phi
[
i¡¬t
+2]*
dE
[
i
*
c_dim
+
ic
]+rho_phi[i¡¬t+1]*dE[
j
*c_dim+
jc
]+rho_phi[istart]);

1379 
m
+=-
b‘a
*(
rho_phi
[
i¡¬t
+2]*
dE
[
i
*
c_dim
+
ic
]+rho_phi[i¡¬t+1]*dE[
j
*c_dim+
jc
]+rho_phi[istart]);

1381 
i¡¬t
-=3*
c_dim
*c_dim;

1385 
ty³0
 
rsq
=
Algeb¿
::
RSQ
<
__dim__
>(
x
+
i
*__dim__,x+
j
*__dim__)/(
©oms
->
H
[0][0]*atoms->H[0][0]);

1386 if(
m
!=0.0 && 
rsq
<.9)

1389 
ty³0
 
__a
,
__b
,
__c
,
__d–
;

1391 if((
c
[
i
*
c_dim
]==0.0 && c[
j
*c_dim]==0.0) || (c[i*c_dim]==1.0 && c[j*c_dim]==1.0))

1393 
u
=
c
[
i
*
c_dim
];

1397 
__a
=0.0;

1399 if(
m
<0.0)

1401 
__a
=
	`exp
(
m
)-1.0;

1402 
__b
=-1.0-(
c
[
j
*
c_dim
]+c[
i
*c_dim])*
__a
;

1403 
__c
=
c
[
j
*
c_dim
]*c[
i
*c_dim]*(
__a
+1.0);

1407 
__a
=1.0-
	`exp
(-
m
);

1408 
__b
=-(
c
[
j
*
c_dim
]+c[
i
*c_dim]-1.0)*
__a
-1.0;

1409 
__c
=
c
[
j
*
c_dim
]*c[
i
*c_dim];

1417 
ty³0
 
__x0
=0.0,
__x1
=0.0;

1418 if(
__a
==0.0)

1422 
u
=-
__c
/
__b
;

1426 
__d–
=
	`sq¹
(
__b
*__b-4.0*
__a
*
__c
);

1428 
__x1
=0.5*(-
__b
+
__d–
)/
__a
;

1429 
__x0
=0.5*(-
__b
-
__d–
)/
__a
;

1430 if(
__x0
<=
c
[
i
*
c_dim
] && __x0<=c[
j
*c_dim] && __x0>=0.0)

1431 
u
=
__x0
;

1433 
u
=
__x1
;

1444 if(
i
==0 && 
j
==1)

1446 if(
c
[
i
*
c_dim
]==1.0)

1447 
‰
=1.0;

1449 
‰
=(1.0-
c
[
i
*
c_dim
]-c[
j
*c_dim]+
u
)/((1.0-c[i*c_dim])*(1.0-c[i*c_dim]));

1453 
B_·œ
[
ii¡¬t
]=
u
;

1454 
B_·œ
[
ii¡¬t
+1]=
c
[
i
*
c_dim
]-
u
;

1455 
B_·œ
[
ii¡¬t
+2]=
c
[
j
*
c_dim
]-
u
;

1456 
B_·œ
[
ii¡¬t
+3]=1.0-
c
[
i
*
c_dim
]-c[
j
*c_dim]+
u
;

1459 if(
j
<
Çtms_lş
)

1461 
ic
=0;ic<
c_dim
;ic++)

1462 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

1464 
__vec_lş
[0]+=
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
];

1465 if(
c
[
i
*
c_dim
+
ic
]>0.0)

1466 
rho
[
i
*
c_dim
+
ic
]+=
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
+2]/
c
[i*c_dim+ic];

1467 if(
c
[
j
*
c_dim
+
jc
]>0.0)

1468 
rho
[
j
*
c_dim
+
jc
]+=
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
+1]/
c
[j*c_dim+jc];

1474 if(
B_·œ
[
ii¡¬t
]>0.0 && 
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]>0.0)

1476 
’t_cÜr_lş
-=
B_·œ
[
ii¡¬t
]*
	`log
(B_·œ[ii¡¬t]/(
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]));

1483 
ic
=0;ic<
c_dim
;ic++)

1484 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

1486 
__vec_lş
[0]+=0.5*
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
];

1487 if(
c
[
i
*
c_dim
+
ic
]>0.0)

1488 
rho
[
i
*
c_dim
+
ic
]+=
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
+2]/
c
[i*c_dim+ic];

1493 if(
B_·œ
[
ii¡¬t
]>0.0 && 
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]>0.0)

1495 
’t_cÜr_lş
-=0.5*
B_·œ
[
ii¡¬t
]*
	`log
(B_·œ[ii¡¬t]/(
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]));

1503 
B_·œ
[
ii¡¬t
]=
c
[
i
*
c_dim
]*c[
j
*c_dim];

1504 
B_·œ
[
ii¡¬t
+1]=
c
[
i
*
c_dim
]*c[
j
*c_dim+1];

1505 
B_·œ
[
ii¡¬t
+2]=
c
[
i
*
c_dim
+1]*c[
j
*c_dim];

1506 
B_·œ
[
ii¡¬t
+3]=
c
[
i
*
c_dim
+1]*c[
j
*c_dim+1];

1509 if(
j
<
Çtms_lş
)

1511 
ic
=0;ic<
c_dim
;ic++)

1512 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

1514 
__vec_lş
[0]+=
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
];

1515 
rho
[
i
*
c_dim
+
ic
]+=
c
[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
+2];

1516 
rho
[
j
*
c_dim
+
jc
]+=
c
[
i
*c_dim+
ic
]*
rho_phi
[
i¡¬t
+1];

1521 
ic
=0;ic<
c_dim
;ic++)

1522 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

1524 
__vec_lş
[0]+=0.5*
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
];

1525 
rho
[
i
*
c_dim
+
ic
]+=
c
[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
+2];

1533 
ic
=0;ic<
c_dim
;ic++)

1536 
p
=
rho
[
i
*
c_dim
+
ic
]*
drho_šv
;

1537 
m
=
¡©ic_ÿ¡
<
size_t
>(
p
);

1538 
m
=
	`MIN
(m,
Äho
-2);

1539 
p
-=
m
;

1540 
p
=
	`MIN
(p,1.0);

1541 
cÛf
=
F_¬r
[
ic
][
m
];

1543 
tmp0
=(((
cÛf
[4]*
p
+coef[3])*p+coef[2])*p+coef[1])*p+coef[0];

1544 
tmp1
=(((4.0*
cÛf
[4]*
p
+3.0*cÛf[3])*p+2.0*cÛf[2])*p+cÛf[1])*
drho_šv
;

1546 if(
rho
[
i
*
c_dim
+
ic
]>
rho_max
è
tmp0
+=
tmp1
*(rho[i*c_dim+ic]-rho_max);

1548 
dE
[
i
*
c_dim
+
ic
]=
tmp1
;

1549 
__vec_lş
[0]+=
c
[
i
*
c_dim
+
ic
]*
tmp0
;

1557 
__vec_lş
[1+
__nvoigt__
]+=
’t_cÜr_lş
;

1558 
__vec_lş
[0]+=
’t_cÜr_lş
*
kbT
;

1560 
	`MPI_AÎ»duû
(
__vec_lş
,&
cu¼_’
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

1561 
’_diff
=
	`çbs
(
cu¼_’
-
´ev_’
);

1563 
´ev_’
=
cu¼_’
;

1564 
	`upd©e
(
dE_±r
);

1568 #ifdeà
SC_DMD


1569 
©oms
->
BB
=
‰
;

1573 
	}
}

1577 
	gFÜûF›ldEAMDMDCLUSTER
::
__´•J_n_»s
(
Vec
<
ty³0
>*,Vec<type0>*)

1582 
	gFÜûF›ldEAMDMDCLUSTER
::
__J
(
Vec
<
ty³0
>*,Vec<type0>*,Vec<type0>*,Vec<type0>*)

1587 
	gFÜûF›ldEAMDMDCLUSTER
::
	$š™
()

1589 
	`´e_š™
();

1590 
	`£t_‹mp
();

1593 
d_±r
=
Ãw
 
Vec
<
ty³0
>(
©oms
,1);

1594 
b_±r
=
Ãw
 
Vec
<
ty³0
>(
©oms
,1);

1595 
th‘a_±r
=
Ãw
 
Vec
<
ty³0
>(
©oms
,1);

1596 
E_±r
=
Ãw
 
Vec
<
ty³0
>(
©oms
,
c_dim
);

1597 
dE_±r
=
Ãw
 
Vec
<
ty³0
>(
©oms
,
c_dim
);

1598 
rho_±r
=
Ãw
 
Vec
<
ty³0
>(
©oms
,
c_dim
);

1599 
	}
}

1603 
	gFÜûF›ldEAMDMDCLUSTER
::
	$fš
()

1606 
MemÜy
::
	`d—Îoc
(
rho_phi
);

1607 
MemÜy
::
	`d—Îoc
(
drho_phi_dr
);

1608 
MemÜy
::
	`d—Îoc
(
drho_phi_d®pha
);

1609 
MemÜy
::
	`d—Îoc
(
B_·œ
);

1610 
MemÜy
::
	`d—Îoc
(
is_·œ
);

1611 
max_·œs
=0;

1613 
d–‘e
 
rho_±r
;

1614 
d–‘e
 
dE_±r
;

1615 
d–‘e
 
E_±r
;

1616 
d–‘e
 
th‘a_±r
;

1617 
d–‘e
 
b_±r
;

1618 
d–‘e
 
d_±r
;

1620 
dE_±r
=
rho_±r
=
d_±r
=
vec0
=
vec1
=
vec2
=
vec3
=
NULL
;

1621 
	`po¡_fš
();

1622 
	}
}

1626 
	gFÜûF›ldEAMDMDCLUSTER
::
	$£t_‹mp
()

1628 
ty³0
 
T
=
©oms
->
‹mp
;

1629 
ty³0
 
kb
=
©oms
->
kB
;

1630 
ty³0
 
hP
=
©oms
->hP;

1631 
ty³0
 
mass
;

1632 
ty³0
 
deb_l
;

1634 
size_t
 
i
=0;i<
ÃËms
;i++)

1636 
mass
=
©oms
->
–em’ts
.
mas£s
[
i
];

1637 
c_1
[
i
]=
	`sq¹
(0.5*
kb
*
T
/
mass
)/
M_PI
;

1638 
deb_l
=
hP
*hP/(2.0*
M_PI
*M_PI*
mass
*
kb
*
T
);

1639 
c_0
[
i
]=1.5*
kb
*
T
*(
	`log
(
deb_l
)-1.0);

1642 
kbT
=
kb
*
T
;

1643 
b‘a
=1.0/
kbT
;

1644 
	}
}

1648 
šlše
 
ty³0
 
	gFÜûF›ldEAMDMDCLUSTER
::
	$ÿlc_’t
(
ty³0
 
x
)

1650 if(
x
==0.0)  0.0;

1651  
x
*
	`log
(x);

1652 
	}
}

1657 
	gFÜûF›ldEAMDMDCLUSTER
::
	$ml_Ãw
(
PyM‘hodDef
& 
m‘hod_0
,PyM‘hodDef& 
m‘hod_1
,PyM‘hodDef& 
m‘hod_2
)

1659 
m‘hod_0
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

1660 
m‘hod_0
.
ml_Çme
="ff_eam_funcfl_cluster";

1661 
m‘hod_0
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

1662 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

1664 
AtomsDMD
::
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<AtomsDMD::Objeù*>(
£lf
);

1665 
FuncAPI
<
¡d
::
¡ršg
*,
ty³0
*,ty³0*,¡d::¡ršg*> 
	`f
("ff_eam_funcfl_cluster",{"funcfl_files","r_crd","C","elems"});

1666 
f
.
nİtiÚ®s
=1;

1667 
f
.
logics
<1>()[0]=
	`VLogics
("gt",0.0);

1668 
f
.
logics
<2>()[0]=
	`VLogics
("gt",0.0);

1670 cÚ¡ 
¡d
::
¡ršg
* 
Çmes
=
__£lf
->
©oms
->
–em’ts
.names;

1671 cÚ¡ 
size_t
 
ÃËms
=
__£lf
->
©oms
->
–em’ts
.nelems;

1672 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

1673 if(
f
.
»m­
<3,0,1,2>("–em’t ´e£Á iÀsy¡em",
Çmes
,
ÃËms
)è 
NULL
;

1675 
size_t
 
Ä
,
Äho
;

1676 
ty³0
 
dr
,
drho
;

1677 
ty³0
** 
r_c
;

1678 
	`ty³0
(** 
F
)[5]=
NULL
;

1679 
	`ty³0
(*** 
r_phi
)[4]=
NULL
;

1680 
	`ty³0
(*** 
rho
)[4]=
NULL
;

1681 
Œy


1683 
ImpÜtEAM
::
	`funcæ
(
ÃËms
,
f
.
v®
<0>(),
dr
,
drho
,
Ä
,
Äho
,
r_phi
,
rho
,
F
,
r_c
);

1685 
	`ÿtch
(* 
”r_msg
)

1687 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,
”r_msg
);

1688 
d–‘e
 [] 
”r_msg
;

1689  
NULL
;

1692 
size_t
 
i
=0;i<
ÃËms
;i++)

1693 if(
f
.
v
<1>()[
i
]>
r_c
[i][i])

1695 
MemÜy
::
	`d—Îoc
(
r_c
);

1696 
MemÜy
::
	`d—Îoc
(
F
);

1697 
MemÜy
::
	`d—Îoc
(
r_phi
);

1698 
MemÜy
::
	`d—Îoc
(
rho
);

1699 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"r_üd[%zu] should bËs thª„_c[%zu][%zu]",
i
,i,i);

1700  
NULL
;

1703 
d–‘e
 
__£lf
->
ff
;

1704 
__£lf
->
ff
=
Ãw
 
	`FÜûF›ldEAMDMDCLUSTER
(__£lf->
©oms
,
dr
,
drho
,
Ä
,
Äho
,
¡d
::
	`move
(
r_phi
),¡d::move(
rho
),¡d::move(
F
),¡d::move(
r_c
),
f
.
mov
<1>(),f.mov<2>());

1705 
Py_RETURN_NONE
;

1707 
m‘hod_0
.
ml_doc
=(*)
R
"---(

1708 
	`ff_—m_funcæ
(
funcæ_fes
,
r_üd
,
C
,
–ems
=
NÚe
)

1710 
TabuÏ‹d
 
EAM
 
fÜû
 
f›ld
 
giv’
 
by
 
FuncFL
 
fe
/
s


1712 
Assigns
 
EAM
 
fÜû
 
f›ld
 
to
 
sy¡em


1714 
P¬am‘”s


1716 
funcæ_fes
 : 
¡ršg
[
ÃËms
]

1717 
li¡
 
of
 
»Ïtive
 
·ths
 
to
 
DYNAMO
 
fes
 
w™h
 
FuncFL
 
fÜm©


1718 
r_üd
 : [
ÃËms
]

1719 
cutoff
 
¿dius
 
mass
 
exchªge


1720 
C
 : [
ÃËms
]

1721 
dim’siÚËss
 
çùÜ
 
—ch
 
–em’t
, 
£e
 :
»f
:`
h”e
 <
ma¡”
-ref>`

1722 
–ems
 : 
¡ršg
[
ÃËms
]

1723 
m­pšg
 
–em’ts


1725 
R‘uºs


1727 
NÚe


1729 
NÙes


1731 
This
 
is
 
buÏ‹d
 
fÜm
 
of
 
Embedded
 
Atom
 
	`M‘hod
 (
EAM
è
pÙ’tŸl


1734 
Exam¶es


1736 
Ni


1740 >>> 
äom
 
m­p
 
impÜt
 
dmd


1741 >>> 
sim
=
dmd
.
	`cfg
(5,"configs/Ni-DMD.cfg")

1742 >>> 
sim
.
	`ff_—m_funcæ
("potentials/niu3.eam")

1748 
m‘hod_1
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

1749 
m‘hod_1
.
ml_Çme
="ff_eam_setfl_cluster";

1750 
m‘hod_1
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

1751 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

1753 
AtomsDMD
::
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<AtomsDMD::Objeù*>(
£lf
);

1754 
FuncAPI
<
¡d
::
¡ršg
,
ty³0
*,ty³0*,¡d::¡ršg*> 
	`f
("ff_eam_setfl_cluster",{"setfl_file","r_crd","C","elems"});

1755 
f
.
nİtiÚ®s
=1;

1756 
f
.
logics
<1>()[0]=
	`VLogics
("gt",0.0);

1757 
f
.
logics
<2>()[0]=
	`VLogics
("gt",0.0);

1759 cÚ¡ 
¡d
::
¡ršg
* 
Çmes
=
__£lf
->
©oms
->
–em’ts
.names;

1760 cÚ¡ 
size_t
 
ÃËms
=
__£lf
->
©oms
->
–em’ts
.nelems;

1761 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

1762 if(
f
.
»m­
<3,2,1>("–em’t ´e£Á iÀsy¡em",
Çmes
,
ÃËms
)è 
NULL
;

1765 
size_t
 
Ä
,
Äho
;

1766 
ty³0
 
dr
,
drho
;

1767 
ty³0
** 
r_c
;

1768 
	`ty³0
(** 
F
)[5]=
NULL
;

1769 
	`ty³0
(*** 
r_phi
)[4]=
NULL
;

1770 
	`ty³0
(*** 
rho
)[4]=
NULL
;

1771 
Œy


1773 
ImpÜtEAM
::
	`£tæ
(
ÃËms
,
__£lf
->
©oms
->
–em’ts
.
Çmes
,
f
.
v®
<0>(),
dr
,
drho
,
Ä
,
Äho
,
r_phi
,
rho
,
F
,
r_c
);

1775 
	`ÿtch
(* 
”r_msg
)

1777 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,
”r_msg
);

1778 
d–‘e
 [] 
”r_msg
;

1779  
NULL
;

1782 
size_t
 
i
=0;i<
ÃËms
;i++)

1783 if(
f
.
v
<1>()[
i
]>
r_c
[i][i])

1785 
MemÜy
::
	`d—Îoc
(
r_c
);

1786 
MemÜy
::
	`d—Îoc
(
F
);

1787 
MemÜy
::
	`d—Îoc
(
r_phi
);

1788 
MemÜy
::
	`d—Îoc
(
rho
);

1789 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"r_üd[%zu] should bËs thª„_c[%zu][%zu]",
i
,i,i);

1790  
NULL
;

1793 
d–‘e
 
__£lf
->
ff
;

1794 
__£lf
->
ff
=
Ãw
 
	`FÜûF›ldEAMDMDCLUSTER
(__£lf->
©oms
,
dr
,
drho
,
Ä
,
Äho
,
¡d
::
	`move
(
r_phi
),¡d::move(
rho
),¡d::move(
F
),¡d::move(
r_c
),
f
.
mov
<1>(),f.mov<2>());

1795 
Py_RETURN_NONE
;

1797 
m‘hod_1
.
ml_doc
=(*)
R
"---(

1798 
	`ff_—m_£tæ
(
£tæ_fe
,
r_üd
,
C
,
–ems
=
NÚe
)

1800 
TabuÏ‹d
 
EAM
 
fÜû
 
f›ld
 
giv’
 
by
 
a
 
sšgË
 
S‘FL
 
fe


1802 
Assigns
 
EAM
 
fÜû
 
f›ld
 
to
 
sy¡em


1804 
P¬am‘”s


1806 
£tæ_fe
 : 
¡ršg


1807 
»Ïtive
 
·th
 
to
 
DYNAMO
 
fe
 
w™h
 
S‘FL
 
fÜm©


1808 
r_üd
 : [
ÃËms
]

1809 
cutoff
 
¿dius
 
mass
 
exchªge


1810 
C
 : [
ÃËms
]

1811 
dim’siÚËss
 
çùÜ
 
—ch
 
–em’t
, 
£e
 :
»f
:`
h”e
 <
ma¡”
-ref>`

1812 
–ems
 : 
¡ršg
[
ÃËms
]

1813 
m­pšg
 
–em’ts


1815 
R‘uºs


1817 
NÚe


1819 
NÙes


1821 
This
 
is
 
buÏ‹d
 
fÜm
 
of
 
Embedded
 
Atom
 
	`M‘hod
 (
EAM
è
pÙ’tŸl


1824 
Exam¶es


1826 
Cu


1830 >>> 
äom
 
m­p
 
impÜt
 
dmd


1831 >>> 
sim
=
dmd
.
	`cfg
(5,"configs/Cu-DMD.cfg")

1832 >>> 
sim
.
	`ff_—m_£tæ
("potentials/Cu_mishin.eam.alloy")

1838 
m‘hod_2
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

1839 
m‘hod_2
.
ml_Çme
="ff_eam_fs_cluster";

1840 
m‘hod_2
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

1841 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

1843 
AtomsDMD
::
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<AtomsDMD::Objeù*>(
£lf
);

1844 
FuncAPI
<
¡d
::
¡ršg
,
ty³0
*,ty³0*,¡d::¡ršg*> 
	`f
("ff_eam_fs_cluster",{"fs_file","r_crd","C","elems"});

1845 
f
.
nİtiÚ®s
=1;

1846 
f
.
logics
<1>()[0]=
	`VLogics
("gt",0.0);

1847 
f
.
logics
<2>()[0]=
	`VLogics
("gt",0.0);

1849 cÚ¡ 
¡d
::
¡ršg
* 
Çmes
=
__£lf
->
©oms
->
–em’ts
.names;

1850 cÚ¡ 
size_t
 
ÃËms
=
__£lf
->
©oms
->
–em’ts
.nelems;

1851 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

1852 if(
f
.
»m­
<3,2,1>("–em’t ´e£Á iÀsy¡em",
Çmes
,
ÃËms
)è 
NULL
;

1854 
size_t
 
Ä
,
Äho
;

1855 
ty³0
 
dr
,
drho
;

1856 
ty³0
** 
r_c
;

1857 
	`ty³0
(** 
F
)[5]=
NULL
;

1858 
	`ty³0
(*** 
r_phi
)[4]=
NULL
;

1859 
	`ty³0
(*** 
rho
)[4]=
NULL
;

1860 
Œy


1862 
ImpÜtEAM
::
	`fs
(
ÃËms
,
__£lf
->
©oms
->
–em’ts
.
Çmes
,
f
.
v®
<0>(),
dr
,
drho
,
Ä
,
Äho
,
r_phi
,
rho
,
F
,
r_c
);

1864 
	`ÿtch
(* 
”r_msg
)

1866 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,
”r_msg
);

1867 
d–‘e
 [] 
”r_msg
;

1868  
NULL
;

1871 
size_t
 
i
=0;i<
ÃËms
;i++)

1872 if(
f
.
v
<1>()[
i
]>
r_c
[i][i])

1874 
MemÜy
::
	`d—Îoc
(
r_c
);

1875 
MemÜy
::
	`d—Îoc
(
F
);

1876 
MemÜy
::
	`d—Îoc
(
r_phi
);

1877 
MemÜy
::
	`d—Îoc
(
rho
);

1878 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"r_üd[%zu] should bËs thª„_c[%zu][%zu]",
i
,i,i);

1879  
NULL
;

1882 
d–‘e
 
__£lf
->
ff
;

1883 
__£lf
->
ff
=
Ãw
 
	`FÜûF›ldEAMDMDCLUSTER
(__£lf->
©oms
,
dr
,
drho
,
Ä
,
Äho
,
¡d
::
	`move
(
r_phi
),¡d::move(
rho
),¡d::move(
F
),¡d::move(
r_c
),
f
.
mov
<1>(),f.mov<2>());

1884 
Py_RETURN_NONE
;

1886 
m‘hod_2
.
ml_doc
=(*)
R
"---(

1887 
	`ff_—m_fs
(
fs_fe
,
r_üd
,
C
,
–ems
=
NÚe
)

1889 
TabuÏ‹d
 
Fšnis
-
Sšşaœ
 
EAM


1891 
Assigns
 
Fšnis
-
Sšşaœ
 
EAM
 
fÜû
 
f›ld
 
to
 
sy¡em
. 
FÜ
 
ex¶ª©iÚ
 
of
 
the
 
·¿m‘”
 
£e
h
NÙes
 
£ùiÚ
.

1893 
P¬am‘”s


1895 
fs_fe
 : 
¡ršg


1896 
»Ïtive
 
·th
 
to
 
DYNAMO
 
fe
 
w™h
 
fs
 
fÜm©


1897 
r_üd
 : [
ÃËms
]

1898 
cutoff
 
¿dius
 
mass
 
exchªge


1899 
C
 : [
ÃËms
]

1900 
dim’siÚËss
 
çùÜ
 
—ch
 
–em’t
, 
£e
 :
»f
:`
h”e
 <
ma¡”
-ref>`

1901 
–ems
 : 
¡ršg
[
ÃËms
]

1902 
m­pšg
 
–em’ts


1904 
R‘uºs


1906 
NÚe


1908 
NÙes


1910 
This
 
is
 
buÏ‹d
 
fÜm
 
of
 
Fšnis
-
Sšşaœ
 
Embedded
 
Atom
 
	`M‘hod
 (
EAM
è
pÙ’tŸl


1912 
CÚsid”
 
the
 
g’”®
 
fÜm
 
of
 
EAM
 
pÙ’tŸl
:

1915 .. 
m©h
:: 
U
=\
äac
{1}{2}\
sum_
{
i
}\sum_{
j
\
Ãq
 i}\
phi_
{\
gamma
 \
d–
}{(
x_
{
ij
}è}+\
sum_i
 
E_
\gamm¨\
	`Ëá
(\sum_{j\Ãq i} \
rho_
{\d–\gamma}(x_{ij}è\
right
),

1918 
From
 
h”e
 
Ú
, 
g»ek
 
su³rscts
/
subsüts
 
¬e
 
u£d
 
to
 
»ãr
Ø
–em’ts
 
´e£Á
 
the
 
sy¡em
; :
m©h
:`\
gamma
`, 
ªd
 :m©h:`\
d–
` 
d’Ùe
 
ty³
 
of
 
©om
 :m©h:`
i
`‡nd‡tom :m©h:`
j
`, 
»³ùiv–y
. :m©h:`
E
`, :m©h:`\
rho
`,‡nd :m©h:`\
phi
`‡» 
embeddšg
, 
–eùrÚ
 
d’s™y
,‡nd 
·œ
 
funùiÚs
, 
»¥eùiv–y
. 
Also
 :m©h:`
x_
{
ij
}` 
»ãrs
Ø
di¡ªû
 
b‘w“n
 :m©h:`i`‡nd :m©h:`j`. 
Now
h
muÉi
 
compÚ’t
 
fÜmuÏtiÚ
 oà
DMD
 
ä“
 
’”gy
 
would
 
be
:

1920 .. 
m©h
::

1921 
F
=&\
äac
{1}{2}\
sum_
{
i
,\
gamma
,
j
\
Ãq
 i,\
d–
}
c_i
^\gamm¨
c_j
^\d– \
omega_
{\gamm¨\d–}\
	`Ëá
(
x_
{
ij
}\
right
)+\sum_{i,\gamma} c_i^\gamm¨
E_
\gamm¨\Ëá(\sum_{j\Ãq i,\d–} c_j^{\d–}\
psi_
{\d–\gamma}\Ëá(x_{ij}\right)\right)-3
k_BT
\sum_{i,\gamma} c_i^\gamm¨\
log
\Ëá(\
sq¹
{\
pi
 
e
}\
®pha_i
^\gamma/\
Lambda_
\gamma\right)\\

1922 &+
k_BT
\
sum_
{
i
,\
gamma
} 
c_i
^\gamma\
log
 c_i^\gamma+k_BT\sum_{i}c_i^
v
\
	`log
 (c_i^v),

1924 
wh”e


1926 .. 
m©h
:: \
Lambda_
\
gamma
=\
äac
{
h
}{\
sq¹
{2\
pi
 
m_
\gamm¨
k_BT
}}, \
quad
 
c_i
^
v
=1-\
sum_
{\gamma}c_i^\gamma,

1928 .. 
m©h
:: \
omega_
{\
gamma
\
d–
}(
x_
{
ij
})ğ\
äac
{1}{\
	`Ëá
(\
®pha
^{\gamma\d–}
_
{ij}\
sq¹
{\
pi
}\
right
)^{3}}\
d
^3\
m©hbf
{
x
} \
exp
{\
biggl
[-\Ëá(\äac{\m©hbf{x}_{ij} -\m©hbf{x}}{\®pha^{\gamma\d–}_{ij}}\right)^2\
biggr
]}\
phi_
{\gamma\delta}(|\mathbf{x}|)

1930 .. 
m©h
:: \
psi_
{\
gamma
\
d–
}(
x_
{
ij
})=\
äac
{1}{\
	`Ëá
(\
®pha
^{\gamma\d–}
_
{ij}\
sq¹
{\
pi
}\
right
)^{3}}\
d
^3\
m©hbf
{
x
} \
exp
{\
biggl
[-\Ëá(\äac{\m©hbf{x}_{ij} -\m©hbf{x}}{\®pha^{\gamma\d–}_{ij}}\right)^2\
biggr
]}\
rho_
{\gamma\delta}(|\mathbf{x}|)

1932 .. 
m©h
:: \
®pha
^{\
gamma
\
d–
}
_
{
ij
}=\
sq¹
{{\
®pha_i
^{\gamma}}^2+{\
®pha_j
^{\d–}}^2},\
quad
 \
m©hbf
{
x
}_{
ji
}=\m©hbf{x}
_j
-\m©hbf{x}
_i


1934 
The
 
num”iÿl
 
ev®u©iÚ
 
of
 
the£
 
š‹g¿ls
 
is
 
discus£d
 :
»f
:`
h”e
 <
š‹g
-ref>`.

1938 
ReÿÎšg
 
th©


1940 .. 
m©h
:: \
ÏngË
 
U
 \
¿ngË
 &ğ\
äac
{\
·¹Ÿl
 }{\·¹ŸÈ\
b‘a
}\
	`Ëá
(\b‘¨
F
 \
right
)

1942 
the
 
av”age
 
pÙ’tŸl
 
’”gy
 
is


1945 .. 
m©h
:: \
ÏngË
 
U
 \
¿ngË
 = \
äac
{1}{2}\
sum_
{
i
,\
gamma
,
j
\
Ãq
 i,\
d–
}
c_i
^\gamm¨
c_j
^\d– \
omega_
{\gamm¨\d–}\
	`Ëá
(
x_
{
ij
}\
right
)+\sum_{i,\gamma} c_i^\gamm¨
E_
\gamm¨\Ëá(\sum_{j\Ãq i,\d–} c_j^{\d–}\
psi_
{\d–\gamma}\Ëá(x_{ij}\right)\rightè-\äac{3}{2} 
k_B
 
T


1948 
Exam¶es


1950 
IrÚ
 
Hydrogº
 
mixtu»


1952 >>> 
äom
 
m­p
 
impÜt
 
dmd


1953 >>> 
sim
=
dmd
.
	`cfg
(5,"configs/FeH-DMD.cfg")

1954 >>> 
sim
.
	`ff_—m_fs
("potentials/FeH.eam.fs")

1956 
	}
}

	@ff_eam_dmd_cluster.h

1 #iâdeà
__MAPP__ff_—m_dmd_şu¡”__


2 
	#__MAPP__ff_—m_dmd_şu¡”__


	)

3 
	~"ff_dmd.h
"

4 
Çme¥aû
 
	gMAPP_NS


6 
	g‹m¶©e
<
	gşass
> 
şass
 
	gDMDVec
;

7 şas 
	cFÜûF›ldEAMDMDCLUSTER
 : 
public
 
FÜûF›ldDMD


9 
´iv©e
:

10 
size_t
 
Ä
,
	gÄho
;

11 
ty³0
 
	gdr
,
	gdrho
,
	gdr_šv
,
	gdrho_šv
,
	grho_max
;

12 
ty³0
(** 
F_¬r
)[5];

13 
ty³0
(*** 
r_phi_¬r
)[4];

14 
ty³0
(*** 
r_rho_¬r
)[4];

18 
	gVec
<
	gty³0
>* 
	gE_±r
;

19 
	gVec
<
	gty³0
>* 
	gdE_±r
;

20 
	gVec
<
	gty³0
>* 
	grho_±r
;

21 
	gVec
<
	gty³0
>* 
	gb_±r
;

22 
	gVec
<
	gty³0
>* 
	gd_±r
;

23 
	gVec
<
	gty³0
>* 
	gth‘a_±r
;

25 
	gVec
<
	gty³0
>* 
	gvec0
;

26 
	gVec
<
	gty³0
>* 
	gvec1
;

27 
	gVec
<
	gty³0
>* 
	gvec2
;

28 
	gVec
<
	gty³0
>* 
	gvec3
;

29 
	gVec
<
	gty³0
>* 
	gfcÛf_±r
;

33 
ty³0
 
	gkbT
,
	gb‘a
;

34 
ty³0
* 
	gc_0
;

35 
ty³0
* 
	gc_1
;

36 
ty³0
* 
	gz‘a
;

39 
ty³0
* 
	grho_phi
;

40 
ty³0
* 
	gdrho_phi_dr
;

41 
ty³0
* 
	gdrho_phi_d®pha
;

42 
ty³0
* 
	gB_·œ
;

43 
boŞ
* 
	gis_·œ
;

44 
size_t
 
	gmax_·œs
;

48 
ty³0
* 
	gxi
;

49 
ty³0
* 
	gwi_0
;

50 
ty³0
* 
	gwi_1
;

51 cÚ¡ 
	gN
;

55 
ty³0
 
ÿlc_’t
(type0);

56 
£t_‹mp
();

59 
ÿlc_·œ
(
ty³0
,type0*,type0*,type0*&,type0*&,type0*&);

62 
ÿlc_Q
(
ty³0
&,type0&,type0&,type0&,type0&);

63 
ÿlc_Q
(
ty³0
&,type0&,type0&,type0&,type0&,type0&);

66 
sc_loİ
();

67 
_sc_loİ
();

68 
__sc_loİ
();

69 
___sc_loİ
();

72 
	g´Ùeùed
:

73 
__fÜû_ÿlc
();

74 
__’”gy_ÿlc
();

75 
__fÜû_ÿlc_¡©ic
(){};

76 
__c_d_ÿlc
(){};

77 
__J
(
Vec
<
ty³0
>*,Vec<type0>*){};

78 
__´•J_n_»s
(
Vec
<
ty³0
>*,Vec<type0>*);

79 
__J
(
Vec
<
ty³0
>*,Vec<type0>*,Vec<type0>*,Vec<type0>*);

80 
	gpublic
:

82 
š™_¡©ic
(){};

83 
fš_¡©ic
(){};

84 
FÜûF›ldEAMDMDCLUSTER
(
şass
 
AtomsDMD
*,

85 
ty³0
,ty³0,
size_t
,size_t,

86 
ty³0
(***&&)[4],type0(***&&)[4],type0(**&&)[5],

87 
ty³0
**&&,type0*&&,type0*&&);

89 ~
FÜûF›ldEAMDMDCLUSTER
();

90 
š™
();

91 
fš
();

96 
ty³0
* 
ave_mu
(){ 
	gNULL
;};

97 
ml_Ãw
(
PyM‘hodDef
&,PyMethodDef&,PyMethodDef&);

	@ff_eam_dmd_sc.cpp

1 
	~"ff_—m_dmd_sc.h
"

2 
	~<¡dlib.h
>

3 
	~"ÃighbÜ_dmd_sc.h
"

4 
	~"–em’ts.h
"

5 
	~"memÜy.h
"

6 
	~"xm©h.h
"

7 
	~"©oms_dmd.h
"

8 
	~"MAPP.h
"

9 
	~"dyÇmic_dmd.h
"

10 
	~"impÜt_—m.h
"

11 
	~<lim™s
>

12 
	#PI_IN_SQ
 0.564189583547756286948079451561

	)

13 
	#TOL
 1.0e-12

	)

15 
	#CONST
 1.0

	)

16 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

20 
	gFÜûF›ldEAMDMDSC
::

21 
FÜûF›ldEAMDMDSC
(
AtomsDMD
* 
©oms
,

22 
ty³0
 
__dr
,ty³0 
__drho
,
size_t
 
__Ä
,size_ˆ
__Äho
,

23 
ty³0
(***&& 
__r_phi_¬r
)[4],ty³0(***&& 
__rho_¬r
)[4],ty³0(**&& 
__F_¬r
)[5],

24 
ty³0
**&& 
__cut
,ty³0*&& 
__r_üd
,ty³0*&& 
__z‘a
):

25 
FÜûF›ldDMD
(
©oms
),

26 
dr
(
__dr
),

27 
drho
(
__drho
),

28 
Ä
(
__Ä
),

29 
Äho
(
__Äho
),

30 
r_phi_¬r
(
__r_phi_¬r
),

31 
r_rho_¬r
(
__rho_¬r
),

32 
F_¬r
(
__F_¬r
),

33 
rho_phi
(
NULL
),

34 
drho_phi_dr
(
NULL
),

35 
drho_phi_d®pha
(
NULL
),

36 
B_·œ
(
NULL
),

37 
max_·œs
(0),

38 
vec0
(
NULL
),

39 
vec1
(
NULL
),

40 
vec2
(
NULL
),

41 
vec3
(
NULL
),

42 
dE_±r
(
NULL
),

43 
rho_±r
(
NULL
),

44 
cv_±r
(
NULL
),

45 
N
(
©oms
->N)

48 
	g__r_phi_¬r
=
NULL
;

49 
	g__rho_¬r
=
NULL
;

50 
	g__F_¬r
=
NULL
;

52 
	gdr_šv
=1.0/
dr
;

53 
	gdrho_šv
=1.0/
drho
;

54 
	grho_max
=
¡©ic_ÿ¡
<
ty³0
>(
Äho
)*
drho
;

56 
	gkbT
=
b‘a
=-1.0;

60 
	gMemÜy
::
®loc
(
xi
,
N
);

61 
	gMemÜy
::
®loc
(
wi_0
,
N
);

62 
	gMemÜy
::
®loc
(
wi_1
,
N
);

63 
	gMemÜy
::
®loc
(
z‘a
,
ÃËms
);

64 
	gMemÜy
::
®loc
(
c_0
,
ÃËms
);

65 
	gMemÜy
::
®loc
(
c_1
,
ÃËms
);

67 
memıy
(
xi
,
©oms
->xi,
N
*(
ty³0
));

68 
memıy
(
wi_0
,
©oms
->
wi
,
N
*(
ty³0
));

69 
	gi
=0;i<
	gN
;i++)

70 
	gwi_1
[
i
]=
wi_0
[i]*
xi
[i];

73 
–em_ty³
 
	g–em_i
=0;–em_i<
	gÃËms
;elem_i++)

75 
	gr_üd
[
–em_i
]=
__r_üd
[elem_i];

76 
	gz‘a
[
–em_i
]=
__z‘a
[elem_i];

78 
	gMemÜy
::
d—Îoc
(
__r_üd
);

79 
	gMemÜy
::
d—Îoc
(
__z‘a
);

81 
–em_ty³
 
	g–em_i
=0;–em_i<
	gÃËms
;elem_i++)

83 
size_t
 
	gi
=0;i<
	gÄ
;i++)

84 
	gr_rho_¬r
[
–em_i
][0][
i
][0]*=
¡©ic_ÿ¡
<
ty³0
>(i)*
dr
;

85 
	gImpÜtEAM
::
š‹½Ş©e
(
Ä
,
dr
,
r_rho_¬r
[
–em_i
][0]);

86 
–em_ty³
 
	g–em_j
=1;–em_j<
	gÃËms
;elem_j++)

88 if(
	gr_rho_¬r
[
–em_i
][
–em_j
]!=
r_rho_¬r
[elem_i][elem_j-1])

90 
size_t
 
i
=0;
	gi
<
	gÄ
;i++)

91 
	gr_rho_¬r
[
–em_i
][
–em_j
][
i
][0]*=
¡©ic_ÿ¡
<
ty³0
>(i)*
dr
;

92 
	gImpÜtEAM
::
š‹½Ş©e
(
Ä
,
dr
,
r_rho_¬r
[
–em_i
][
–em_j
]);

98 
ty³0
 
	gtmp
;

99 
size_t
 
	gi
=0;i<
	gÃËms
;i++)

100 
size_t
 
	gj
=0;j<
	gi
+1;j++)

102 
	gcut
[
i
][
j
]=
cut
[j][i]=
__cut
[i][j];

103 
	gtmp
=
__cut
[
i
][
j
];

104 
	gcut_sq
[
i
][
j
]=
cut_sq
[j][i]=
tmp
*tmp;

106 
	gMemÜy
::
d—Îoc
(
__cut
);

108 
d–‘e
 
	gÃighbÜ
;

109 
	gÃighbÜ
=
Ãw
 
NeighbÜDMDSC
(
©oms
,
cut_sk
,
rsq_üd
);

114 
	gFÜûF›ldEAMDMDSC
::~
	$FÜûF›ldEAMDMDSC
()

116 
MemÜy
::
	`d—Îoc
(
F_¬r
);

117 
MemÜy
::
	`d—Îoc
(
r_rho_¬r
);

118 
MemÜy
::
	`d—Îoc
(
r_phi_¬r
);

120 
MemÜy
::
	`d—Îoc
(
z‘a
);

121 
MemÜy
::
	`d—Îoc
(
c_1
);

122 
MemÜy
::
	`d—Îoc
(
c_0
);

123 
MemÜy
::
	`d—Îoc
(
wi_1
);

124 
MemÜy
::
	`d—Îoc
(
wi_0
);

125 
MemÜy
::
	`d—Îoc
(
xi
);

127 
	}
}

131 
	gFÜûF›ldEAMDMDSC
::
	$ÿlc_·œ
(
ty³0
 
r
,ty³0* 
®pha_i
,ty³0* 
®pha_j
,ty³0*& 
__rho_phi
,type0*&,type0*&)

132 {
	}
}

136 
	gFÜûF›ldEAMDMDSC
::
	$__fÜû_ÿlc
()

138 if(
max_·œs
<
ÃighbÜ
->
no_·œs
)

140 
d–‘e
 [] 
rho_phi
;

141 
d–‘e
 [] 
drho_phi_dr
;

142 
d–‘e
 [] 
drho_phi_d®pha
;

144 
max_·œs
=
ÃighbÜ
->
no_·œs
;

145 
size_t
 
no_0
=3*
max_·œs
*
c_dim
*c_dim;

146 
MemÜy
::
	`®loc
(
rho_phi
,
no_0
);

147 
MemÜy
::
	`®loc
(
drho_phi_dr
,
no_0
);

148 
MemÜy
::
	`®loc
(
drho_phi_d®pha
,
no_0
);

149 
MemÜy
::
	`®loc
(
B_·œ
,
c_dim
*c_dim*
max_·œs
);

152 
i
=0;i<
max_·œs
*
c_dim
*c_dim*3;i++è
rho_phi
[i]=
drho_phi_dr
[i]=
drho_phi_d®pha
[i]=0.0;

153 
i
=0;i<
max_·œs
*
c_dim
*c_dim;i++è
B_·œ
[i]=0.0;

159 
ty³0
 
r
,
r_šv
;

160 
size_t
 
m
;

161 
ty³0
* 
cÛf
;

162 
ty³0
 
tmp0
,
tmp1
;

163 
ty³0
 
p
,
cv_i
;

165 
ty³0
 cÚ¡* 
c
=
©oms
->c->
	`begš
();

169 
ty³0
* 
dE
=
dE_±r
->
	`begš
();

170 
ty³0
* 
rho
=
rho_±r
->
	`begš
();

171 
i
=0;i<
©oms
->
Çtms_lş
*
c_dim
;i++è
rho
[i]=0.0;

173 
ty³0
 
®pha_ij_sq
,
®pha_ij
,
rsq
;

177 cÚ¡ 
ty³0
* 
x
=
©oms
->x->
	`begš
();

178 cÚ¡ 
ty³0
* 
®pha
=
©oms
->®pha->
	`begš
();

179 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->neighbor_list;

180 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->neighbor_list_size;

181 
Çtms_lş
=
©oms
->natms_lcl;

182 
ty³0
 
’t_lş
=0.0,
vib_lş
=0.0;

183 
size_t
 
i¡¬t
=0,
ii¡¬t
;

184 
i
=0;i<
Çtms_lş
;i++)

186 cÚ¡ 
Ãigh_sz
=
ÃighbÜ_li¡_size
[
i
];

187 
j
,
__j
=0;__j<
Ãigh_sz
;__j++)

189 
j
=
ÃighbÜ_li¡
[
i
][
__j
];

190 
rsq
=
Algeb¿
::
RSQ
<
__dim__
>(
x
+
i
*__dim__,x+
j
*__dim__);

191 
r
=
	`sq¹
(
rsq
);

193 
ic
=0;ic<
c_dim
;ic++)

194 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3)

196 
®pha_ij_sq
=
®pha
[
i
*
c_dim
+
ic
]*®pha[i*c_dim+ic]+®pha[
j
*c_dim+
jc
]*alpha[j*c_dim+jc];

197 
®pha_ij
=
	`sq¹
(
®pha_ij_sq
);

198 if(
r
-
®pha_ij
*
xi
[
N
-1]>=
cut
[
ic
][
jc
]) ;

200 
ty³0
 
uµ”
=(
r
+
cut
[
ic
][
jc
])/
®pha_ij
;

201 
ty³0
 
low”
=(
r
-
cut
[
ic
][
jc
])/
®pha_ij
;

202 
ty³0
 
__r
,
p
,
tmp0
,
xi2
;

203 
ty³0
* 
cÛf
;

206 
ty³0
 
H
[3][3]{
	`DESIG2
(3,3,0.0)};

207 
l
=0;l<
N
;l++)

209 if(
xi
[
l
]<=
low”
 && xi[l]>=
uµ”
) ;

211 
xi2
=
xi
[
l
]*xi[l];

213 
__r
=
r
-
xi
[
l
]*
®pha_ij
;

214 
p
=
	`çbs
(
__r
)*
dr_šv
;

215 
m
=
¡©ic_ÿ¡
<
size_t
>(
p
);

216 
m
=
	`MIN
(m,
Ä
-2);

217 
p
-=
m
;

218 
p
=
	`MIN
(p,1.0);

220 
cÛf
=
r_phi_¬r
[
ic
][
jc
][
m
];

221 
tmp0
=((
cÛf
[3]*
p
+coef[2])*p+coef[1])*p+coef[0];

222 if(
__r
<0.0è
tmp0
*=-1.0;

223 
tmp0
*=
wi_0
[
l
];

224 
H
[0][0]+=
tmp0
;

225 
H
[0][1]+=
tmp0
*
xi
[
l
];

226 
H
[0][2]+=
tmp0
*
xi2
;

229 
cÛf
=
r_rho_¬r
[
ic
][
jc
][
m
];

230 
tmp0
=((
cÛf
[3]*
p
+coef[2])*p+coef[1])*p+coef[0];

231 if(
__r
<0.0è
tmp0
*=-1.0;

232 
tmp0
*=
wi_0
[
l
];

233 
H
[1][0]+=
tmp0
;

234 
H
[1][1]+=
tmp0
*
xi
[
l
];

235 
H
[1][2]+=
tmp0
*
xi2
;

237 
cÛf
=
r_rho_¬r
[
jc
][
ic
][
m
];

238 
tmp0
=((
cÛf
[3]*
p
+coef[2])*p+coef[1])*p+coef[0];

239 if(
__r
<0.0è
tmp0
*=-1.0;

240 
tmp0
*=
wi_0
[
l
];

241 
H
[2][0]+=
tmp0
;

242 
H
[2][1]+=
tmp0
*
xi
[
l
];

243 
H
[2][2]+=
tmp0
*
xi2
;

246 
r_šv
=1.0/
r
;

247 
ty³0
 
r2_šv
=
r_šv
*r_inv;

248 
ty³0
 
®pha_šv
=1.0/
®pha_ij
;

249 
ty³0
 
®pha2_šv
=
®pha_šv
*alpha_inv;

250 
ty³0
 
®pha4_šv
=
®pha2_šv
*alpha2_inv;

251 
ty³0
 
r2®pha2_šv
=
r2_šv
*
®pha2_šv
;

254 
Algeb¿
::
Do
<3>::
	`func
([&
i¡¬t
,&
H
,&
r_šv
,&
r2_šv
,&
®pha2_šv
,&
r2®pha2_šv
,&
®pha_ij_sq
,&
®pha_šv
,&
rsq
,&
®pha4_šv
,
this
]

255 (
i
)

257 
rho_phi
[
i¡¬t
+
i
]=
PI_IN_SQ
*
r_šv
*
H
[i][0];

258 
drho_phi_dr
[
i¡¬t
+
i
]=-
r2_šv
*(
rho_phi
[i¡¬t+i]+2.0*
PI_IN_SQ
*
®pha_šv
*
H
[i][1]);

259 
drho_phi_d®pha
[
i¡¬t
+
i
]=-
®pha2_šv
*(
rho_phi
[i¡¬t+i]-2.0*
PI_IN_SQ
*
r_šv
*
H
[i][2]);

263 
rho
[
i
*
c_dim
+
ic
]+=
c
[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
+2];

265 if(
j
<
Çtms_lş
)

267 
rho
[
j
*
c_dim
+
jc
]+=
c
[
i
*c_dim+
ic
]*
rho_phi
[
i¡¬t
+1];

268 
__vec_lş
[0]+=
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
];

271 
__vec_lş
[0]+=0.5*
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
];

276 
cv_i
=1.0;

277 
ic
=0;ic<
c_dim
;ic++)

279 
p
=
rho
[
i
*
c_dim
+
ic
]*
drho_šv
;

280 
m
=
¡©ic_ÿ¡
<
size_t
>(
p
);

281 
m
=
	`MIN
(m,
Äho
-2);

282 
p
-=
m
;

283 
p
=
	`MIN
(p,1.0);

284 
cÛf
=
F_¬r
[
ic
][
m
];

286 
tmp0
=(((
cÛf
[4]*
p
+coef[3])*p+coef[2])*p+coef[1])*p+coef[0];

287 
tmp1
=(((4.0*
cÛf
[4]*
p
+3.0*cÛf[3])*p+2.0*cÛf[2])*p+cÛf[1])*
drho_šv
;

289 if(
rho
[
i
*
c_dim
+
ic
]>
rho_max
è
tmp0
+=
tmp1
*(rho[i*c_dim+ic]-rho_max);

291 
dE
[
i
*
c_dim
+
ic
]=
tmp1
;

292 
__vec_lş
[0]+=
c
[
i
*
c_dim
+
ic
]*
tmp0
;

295 
vib_lş
+=
c
[
i
*
c_dim
+
ic
]*(
c_0
[ic]-3.0*
kbT
*
	`log
(
®pha
[i*c_dim+ic]));

296 
’t_lş
+=
	`ÿlc_’t
(
c
[
i
*
c_dim
+
ic
]);

297 
cv_i
-=
c
[
i
*
c_dim
+
ic
];

300 
’t_lş
+=
	`ÿlc_’t
(
cv_i
);

303 
	`upd©e
(
dE_±r
);

308 
__vec_lş
[1+
__nvoigt__
]+=
’t_lş
;

309 
__vec_lş
[0]+=
kbT
*
’t_lş
+
vib_lş
;

313 
ty³0
* 
fvec
=
f
->
	`begš
();

314 
ty³0
* 
f_®phavec
=
f_®pha
->
	`begš
();

315 
ty³0
 
dx_ij
[
__dim__
];

316 
ty³0
 
åaœ
,
­aœ
;

317 
i¡¬t
=
ii¡¬t
=0;

318 
i
=0;i<
Çtms_lş
;i++)

321 cÚ¡ 
Ãigh_sz
=
ÃighbÜ_li¡_size
[
i
];

322 
j
,
__j
=0;__j<
Ãigh_sz
;__j++)

324 
j
=
ÃighbÜ_li¡
[
i
][
__j
];

325 
Algeb¿
::
DX
<
__dim__
>(
x
+
i
*__dim__,x+
j
*__dim__,
dx_ij
);

326 
åaœ
=0.0;

328 if(
j
<
Çtms_lş
)

330 
ic
=0;ic<
c_dim
;ic++)

331 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

333 
åaœ
-=(
drho_phi_dr
[
i¡¬t
+2]*
dE
[
i
*
c_dim
+
ic
]+drho_phi_dr[i¡¬t+1]*dE[
j
*c_dim+
jc
]+drho_phi_dr[i¡¬t])*
c
[i*c_dim+ic]*c[j*c_dim+jc];

334 
­aœ
=-(
drho_phi_d®pha
[
i¡¬t
+2]*
dE
[
i
*
c_dim
+
ic
]+drho_phi_d®pha[i¡¬t+1]*dE[
j
*c_dim+
jc
]+drho_phi_d®pha[i¡¬t])*
c
[i*c_dim+ic]*c[j*c_dim+jc];

335 
f_®phavec
[
i
*
c_dim
+
ic
]+=
­aœ
*
®pha
[i*c_dim+ic];

336 
f_®phavec
[
j
*
c_dim
+
jc
]+=
­aœ
*
®pha
[j*c_dim+jc];

340 
Algeb¿
::
V_add_x_mul_V
<
__dim__
>(
åaœ
,
dx_ij
,
fvec
+
i
*__dim__);

341 
Algeb¿
::
V_add_x_mul_V
<
__dim__
>(-
åaœ
,
dx_ij
,
fvec
+
j
*__dim__);

345 
ic
=0;ic<
c_dim
;ic++)

346 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

348 
åaœ
-=(
drho_phi_dr
[
i¡¬t
+2]*
dE
[
i
*
c_dim
+
ic
]+drho_phi_dr[i¡¬t+1]*dE[
j
*c_dim+
jc
]+drho_phi_dr[i¡¬t])*
c
[i*c_dim+ic]*c[j*c_dim+jc];

349 
­aœ
=-(
drho_phi_d®pha
[
i¡¬t
+2]*
dE
[
i
*
c_dim
+
ic
]+drho_phi_d®pha[i¡¬t+1]*dE[
j
*c_dim+
jc
]+drho_phi_d®pha[i¡¬t])*
c
[i*c_dim+ic]*c[j*c_dim+jc];

350 
f_®phavec
[
i
*
c_dim
+
ic
]+=
­aœ
*
®pha
[i*c_dim+ic];

352 
Algeb¿
::
V_add_x_mul_V
<
__dim__
>(
åaœ
,
dx_ij
,
fvec
+
i
*__dim__);

353 
åaœ
*=0.5;

356 
Algeb¿
::
DyadicV
<
__dim__
>(-
åaœ
,
dx_ij
,&
__vec_lş
[1]);

360 
ic
=0;ic<
c_dim
;ic++)

361 
f_®phavec
[
i
*
c_dim
+
ic
]+=3.0*
kbT
*
c
[i*c_dim+ic]/
®pha
[i*c_dim+ic];

366 
	}
}

370 
	gFÜûF›ldEAMDMDSC
::
	$__’”gy_ÿlc
()

372 if(
max_·œs
<
ÃighbÜ
->
no_·œs
)

374 
d–‘e
 [] 
rho_phi
;

375 
d–‘e
 [] 
drho_phi_dr
;

376 
d–‘e
 [] 
drho_phi_d®pha
;

377 
d–‘e
 [] 
B_·œ
;

379 
max_·œs
=
ÃighbÜ
->
no_·œs
;

380 
size_t
 
no_0
=3*
max_·œs
*
c_dim
*c_dim;

381 
MemÜy
::
	`®loc
(
rho_phi
,
no_0
);

382 
MemÜy
::
	`®loc
(
drho_phi_dr
,
no_0
);

383 
MemÜy
::
	`®loc
(
drho_phi_d®pha
,
no_0
);

384 
MemÜy
::
	`®loc
(
B_·œ
,
c_dim
*c_dim*
max_·œs
);

387 
i
=0;i<
max_·œs
*
c_dim
*c_dim*3;i++è
rho_phi
[i]=
drho_phi_dr
[i]=
drho_phi_d®pha
[i]=0.0;

388 
i
=0;i<
max_·œs
*
c_dim
*c_dim;i++è
B_·œ
[i]=0.0;

394 
ty³0
 
r
,
r_šv
;

395 
size_t
 
m
;

396 
ty³0
* 
cÛf
;

397 
ty³0
 
tmp0
,
tmp1
;

398 
ty³0
 
p
,
cv_i
;

400 
ty³0
 cÚ¡* 
c
=
©oms
->c->
	`begš
();

404 
ty³0
* 
dE
=
dE_±r
->
	`begš
();

405 
ty³0
* 
rho
=
rho_±r
->
	`begš
();

406 
Çtms_lş
=
©oms
->natms_lcl;

407 
i
=0;i<
Çtms_lş
*
c_dim
;i++è
rho
[i]=0.0;

409 
ty³0
 
®pha_ij_sq
,
®pha_ij
,
rsq
;

413 cÚ¡ 
ty³0
* 
x
=
©oms
->x->
	`begš
();

414 cÚ¡ 
ty³0
* 
®pha
=
©oms
->®pha->
	`begš
();

415 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->neighbor_list;

416 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->neighbor_list_size;

418 
ty³0
 
’t_lş
=0.0,
vib_lş
=0.0;

419 
size_t
 
i¡¬t
=0;

420 
i
=0;i<
Çtms_lş
;i++)

422 cÚ¡ 
Ãigh_sz
=
ÃighbÜ_li¡_size
[
i
];

423 
j
,
__j
=0;__j<
Ãigh_sz
;__j++)

425 
j
=
ÃighbÜ_li¡
[
i
][
__j
];

426 
rsq
=
Algeb¿
::
RSQ
<
__dim__
>(
x
+
i
*__dim__,x+
j
*__dim__);

427 
r
=
	`sq¹
(
rsq
);

429 
ic
=0;ic<
c_dim
;ic++)

430 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3)

432 
®pha_ij_sq
=
®pha
[
i
*
c_dim
+
ic
]*®pha[i*c_dim+ic]+®pha[
j
*c_dim+
jc
]*alpha[j*c_dim+jc];

433 
®pha_ij
=
	`sq¹
(
®pha_ij_sq
);

434 if(
r
-
®pha_ij
*
xi
[
N
-1]>=
cut
[
ic
][
jc
]) ;

436 
ty³0
 
uµ”
=(
r
+
cut
[
ic
][
jc
])/
®pha_ij
;

437 
ty³0
 
low”
=(
r
-
cut
[
ic
][
jc
])/
®pha_ij
;

438 
ty³0
 
__r
,
p
,
tmp0
,
xi2
;

439 
ty³0
* 
cÛf
;

442 
ty³0
 
H
[3][1]{
	`DESIG2
(3,1,0.0)};

443 
l
=0;l<
N
;l++)

445 if(
xi
[
l
]<=
low”
 && xi[l]>=
uµ”
) ;

447 
xi2
=
xi
[
l
]*xi[l];

449 
__r
=
r
-
xi
[
l
]*
®pha_ij
;

450 
p
=
	`çbs
(
__r
)*
dr_šv
;

451 
m
=
¡©ic_ÿ¡
<
size_t
>(
p
);

452 
m
=
	`MIN
(m,
Ä
-2);

453 
p
-=
m
;

454 
p
=
	`MIN
(p,1.0);

456 
cÛf
=
r_phi_¬r
[
ic
][
jc
][
m
];

457 
tmp0
=((
cÛf
[3]*
p
+coef[2])*p+coef[1])*p+coef[0];

458 if(
__r
<0.0è
tmp0
*=-1.0;

459 
tmp0
*=
wi_0
[
l
];

460 
H
[0][0]+=
tmp0
;

464 
cÛf
=
r_rho_¬r
[
ic
][
jc
][
m
];

465 
tmp0
=((
cÛf
[3]*
p
+coef[2])*p+coef[1])*p+coef[0];

466 if(
__r
<0.0è
tmp0
*=-1.0;

467 
tmp0
*=
wi_0
[
l
];

468 
H
[1][0]+=
tmp0
;

471 
cÛf
=
r_rho_¬r
[
jc
][
ic
][
m
];

472 
tmp0
=((
cÛf
[3]*
p
+coef[2])*p+coef[1])*p+coef[0];

473 if(
__r
<0.0è
tmp0
*=-1.0;

474 
tmp0
*=
wi_0
[
l
];

475 
H
[2][0]+=
tmp0
;

479 
r_šv
=1.0/
r
;

483 
Algeb¿
::
Do
<3>::
	`func
([&
i¡¬t
,&
H
,&
r_šv
,
this
]

484 (
i
)

486 
rho_phi
[
i¡¬t
+
i
]=
PI_IN_SQ
*
r_šv
*
H
[i][0];

490 
rho
[
i
*
c_dim
+
ic
]+=
c
[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
+2];

492 if(
j
<
Çtms_lş
)

494 
rho
[
j
*
c_dim
+
jc
]+=
c
[
i
*c_dim+
ic
]*
rho_phi
[
i¡¬t
+1];

495 
__vec_lş
[0]+=
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
];

498 
__vec_lş
[0]+=0.5*
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
];

503 
cv_i
=1.0;

504 
ic
=0;ic<
c_dim
;ic++)

506 
p
=
rho
[
i
*
c_dim
+
ic
]*
drho_šv
;

507 
m
=
¡©ic_ÿ¡
<
size_t
>(
p
);

508 
m
=
	`MIN
(m,
Äho
-2);

509 
p
-=
m
;

510 
p
=
	`MIN
(p,1.0);

511 
cÛf
=
F_¬r
[
ic
][
m
];

513 
tmp0
=(((
cÛf
[4]*
p
+coef[3])*p+coef[2])*p+coef[1])*p+coef[0];

514 
tmp1
=(((4.0*
cÛf
[4]*
p
+3.0*cÛf[3])*p+2.0*cÛf[2])*p+cÛf[1])*
drho_šv
;

516 if(
rho
[
i
*
c_dim
+
ic
]>
rho_max
è
tmp0
+=
tmp1
*(rho[i*c_dim+ic]-rho_max);

518 
dE
[
i
*
c_dim
+
ic
]=
tmp1
;

519 
__vec_lş
[0]+=
c
[
i
*
c_dim
+
ic
]*
tmp0
;

522 
vib_lş
+=
c
[
i
*
c_dim
+
ic
]*(
c_0
[ic]-3.0*
kbT
*
	`log
(
®pha
[i*c_dim+ic]));

523 
’t_lş
+=
	`ÿlc_’t
(
c
[
i
*
c_dim
+
ic
]);

524 
cv_i
-=
c
[
i
*
c_dim
+
ic
];

527 
’t_lş
+=
	`ÿlc_’t
(
cv_i
);

530 
	`upd©e
(
dE_±r
);

535 
__vec_lş
[1+
__nvoigt__
]+=
’t_lş
;

536 
__vec_lş
[0]+=
kbT
*
’t_lş
+
vib_lş
;

539 
	}
}

543 
	gFÜûF›ldEAMDMDSC
::
	$sc_loİ___
()

547 
ty³0
* 
dE
=
dE_±r
->
	`begš
();

548 
ty³0
* 
rho
=
rho_±r
->
	`begš
();

550 
ty³0
* 
cÛf
;

551 
ty³0
 
A
[2][2]{
	`DESIG2
(2,2,1.0)};

552 
size_t
 
m
,
ii¡¬t
,
i¡¬t
;

553 
ty³0
 
’t_cÜr_lş
=0.0,
´ev_’
,
cu¼_’
;

554 
	`MPI_AÎ»duû
(
__vec_lş
,&
´ev_’
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

555 
ty³0
 
p
,
’_diff
=1.0,
tmp0
,
tmp1
;

556 
Çtms_lş
=
©oms
->natms_lcl;

557 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->neighbor_list;

558 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->neighbor_list_size;

559 
ty³0
 cÚ¡* 
c
=
©oms
->c->
	`begš
();

560 
ty³0
 
‰
=0.0;

561 
’_diff
>
TOL
)

563 
i
=0;i<
Çtms_lş
*
c_dim
;i++è
rho
[i]=0.0;

565 
__vec_lş
[0]=__vec_lş[1+
__nvoigt__
]=0.0;

566 
i¡¬t
=0;

567 
ii¡¬t
=0;

568 
’t_cÜr_lş
=0.0;

569 
i
=0;i<
Çtms_lş
;i++)

571 cÚ¡ 
Ãigh_sz
=
ÃighbÜ_li¡_size
[
i
];

572 
j
,
__j
=0;__j<
Ãigh_sz
;__j++)

574 
j
=
ÃighbÜ_li¡
[
i
][
__j
];

577 
ic
=0;ic<
c_dim
;ic++)

578 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3)

579 
A
[
ic
][
jc
]=-0.5*
b‘a
*(
rho_phi
[
i¡¬t
+2]*
dE
[
i
*
c_dim
+ic]+rho_phi[i¡¬t+1]*dE[
j
*c_dim+jc]+rho_phi[istart]);

580 
i¡¬t
-=3*
c_dim
*c_dim;

583 
ty³0
 
m
=
A
[0][0]+A[1][1]-A[0][1]-A[1][0],
u
;

584 if(
m
!=0.0)

587 
ty³0
 
__a
,
__b
,
__c
,
__d–
;

589 if((
c
[
i
*
c_dim
]==0.0 && c[
j
*c_dim]==0.0) || (c[i*c_dim]==1.0 && c[j*c_dim]==1.0))

591 
u
=
c
[
i
*
c_dim
];

595 
__a
=0.0;

596 
ty³0
 
__x0
=0.0,
__x1
=0.0;

597 if(
m
<0.0)

599 
__a
=
	`exp
(
m
)-1.0;

600 
__b
=-1.0-(
c
[
j
*
c_dim
]+c[
i
*c_dim])*
__a
;

601 
__c
=
c
[
j
*
c_dim
]*c[
i
*c_dim]*(
__a
+1.0);

602 
__d–
=
	`sq¹
(
__b
*__b-4.0*
__a
*
__c
);

604 
__x1
=0.5*(-
__b
-
__d–
)/
__a
;

605 
__x0
=0.5*(-
__b
+
__d–
)/
__a
;

609 
__a
=1.0-
	`exp
(-
m
);

610 
__b
=-(
c
[
j
*
c_dim
]+c[
i
*c_dim]-1.0)*
__a
-1.0;

611 
__c
=
c
[
j
*
c_dim
]*c[
i
*c_dim];

612 
__d–
=
	`sq¹
(
__b
*__b-4.0*
__a
*
__c
);

614 
__x1
=0.5*(-
__b
+
__d–
)/
__a
;

615 
__x0
=0.5*(-
__b
-
__d–
)/
__a
;

618 if(
__a
==0.0)

622 
u
=-
__c
/
__b
;

627 if(
__x0
<=
c
[
i
*
c_dim
] && __x0<=c[
j
*c_dim] && __x0>=0.0)

628 
u
=
__x0
;

630 
u
=
__x1
;

638 if(
i
==0 && 
j
==1)

640 if(
c
[
i
*
c_dim
]==1.0)

641 
‰
=1.0;

643 
‰
=(1.0-
c
[
i
*
c_dim
]-c[
j
*c_dim]+
u
)/((1.0-c[i*c_dim])*(1.0-c[i*c_dim]));

647 
B_·œ
[
ii¡¬t
]=
u
;

648 
B_·œ
[
ii¡¬t
+1]=
c
[
i
*
c_dim
]-
u
;

649 
B_·œ
[
ii¡¬t
+2]=
c
[
j
*
c_dim
]-
u
;

650 
B_·œ
[
ii¡¬t
+3]=1.0-
c
[
i
*
c_dim
]-c[
j
*c_dim]+
u
;

653 if(
j
<
Çtms_lş
)

655 
ic
=0;ic<
c_dim
;ic++)

656 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

658 
__vec_lş
[0]+=
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
];

659 if(
c
[
i
*
c_dim
+
ic
]>0.0)

660 
rho
[
i
*
c_dim
+
ic
]+=
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
+2]/
c
[i*c_dim+ic];

661 if(
c
[
j
*
c_dim
+
jc
]>0.0)

662 
rho
[
j
*
c_dim
+
jc
]+=
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
+1]/
c
[j*c_dim+jc];

665 
’t_cÜr_lş
+=-
CONST
*
	`ÿlc_’t
(
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]);

668 if(
B_·œ
[
ii¡¬t
]>0.0 && 
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]>0.0)

670 
’t_cÜr_lş
+=
CONST
*
B_·œ
[
ii¡¬t
]*
	`log
(B_·œ[ii¡¬t]*B_·œ[ii¡¬t]/(
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]));

676 
ic
=0;ic<
c_dim
;ic++)

677 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

679 
__vec_lş
[0]+=0.5*
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
];

680 if(
c
[
i
*
c_dim
+
ic
]>0.0)

681 
rho
[
i
*
c_dim
+
ic
]+=
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
+2]/
c
[i*c_dim+ic];

683 
’t_cÜr_lş
+=-0.5*
CONST
*
	`ÿlc_’t
(
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]);

686 if(
B_·œ
[
ii¡¬t
]>0.0 && 
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]>0.0)

688 
’t_cÜr_lş
+=0.5*
CONST
*
B_·œ
[
ii¡¬t
]*
	`log
(B_·œ[ii¡¬t]*B_·œ[ii¡¬t]/(
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]));

696 
B_·œ
[
ii¡¬t
]=
c
[
i
*
c_dim
]*c[
j
*c_dim];

697 
B_·œ
[
ii¡¬t
+1]=
c
[
i
*
c_dim
]*c[
j
*c_dim+1];

698 
B_·œ
[
ii¡¬t
+2]=
c
[
i
*
c_dim
+1]*c[
j
*c_dim];

699 
B_·œ
[
ii¡¬t
+3]=
c
[
i
*
c_dim
+1]*c[
j
*c_dim+1];

702 if(
j
<
Çtms_lş
)

704 
ic
=0;ic<
c_dim
;ic++)

705 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

707 
__vec_lş
[0]+=
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
];

708 
rho
[
i
*
c_dim
+
ic
]+=
c
[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
+2];

709 
rho
[
j
*
c_dim
+
jc
]+=
c
[
i
*c_dim+
ic
]*
rho_phi
[
i¡¬t
+1];

714 
ic
=0;ic<
c_dim
;ic++)

715 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

717 
__vec_lş
[0]+=0.5*
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
];

718 
rho
[
i
*
c_dim
+
ic
]+=
c
[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
+2];

726 
ic
=0;ic<
c_dim
;ic++)

729 
p
=
rho
[
i
*
c_dim
+
ic
]*
drho_šv
;

730 
m
=
¡©ic_ÿ¡
<
size_t
>(
p
);

731 
m
=
	`MIN
(m,
Äho
-2);

732 
p
-=
m
;

733 
p
=
	`MIN
(p,1.0);

734 
cÛf
=
F_¬r
[
ic
][
m
];

736 
tmp0
=(((
cÛf
[4]*
p
+coef[3])*p+coef[2])*p+coef[1])*p+coef[0];

737 
tmp1
=(((4.0*
cÛf
[4]*
p
+3.0*cÛf[3])*p+2.0*cÛf[2])*p+cÛf[1])*
drho_šv
;

739 if(
rho
[
i
*
c_dim
+
ic
]>
rho_max
è
tmp0
+=
tmp1
*(rho[i*c_dim+ic]-rho_max);

741 
dE
[
i
*
c_dim
+
ic
]=
tmp1
;

742 
__vec_lş
[0]+=
c
[
i
*
c_dim
+
ic
]*
tmp0
;

750 
__vec_lş
[1+
__nvoigt__
]+=
’t_cÜr_lş
;

751 
__vec_lş
[0]+=
’t_cÜr_lş
*
kbT
;

753 
	`MPI_AÎ»duû
(
__vec_lş
,&
cu¼_’
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

754 
’_diff
=
	`çbs
(
cu¼_’
-
´ev_’
);

756 
´ev_’
=
cu¼_’
;

757 
	`upd©e
(
dE_±r
);

759 #ifdeà
SC_DMD


760 
©oms
->
BB
=
‰
;

762 
	}
}

766 
	gFÜûF›ldEAMDMDSC
::
	$sc_loİ
()

770 
ty³0
* 
dE
=
dE_±r
->
	`begš
();

771 
ty³0
* 
rho
=
rho_±r
->
	`begš
();

773 
ty³0
* 
cÛf
;

774 
ty³0
 
A
[2][2]{
	`DESIG2
(2,2,1.0)};

775 
size_t
 
m
,
ii¡¬t
,
i¡¬t
;

776 
ty³0
 
’t_cÜr_lş
=0.0,
´ev_’
,
cu¼_’
;

777 
	`MPI_AÎ»duû
(
__vec_lş
,&
´ev_’
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

778 
ty³0
 
p
,
’_diff
=1.0,
tmp0
,
tmp1
;

779 
Çtms_lş
=
©oms
->natms_lcl;

780 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->neighbor_list;

781 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->neighbor_list_size;

782 
ty³0
 cÚ¡* 
c
=
©oms
->c->
	`begš
();

783 
ty³0
* 
x
=
©oms
->x->
	`begš
();

785 
ty³0
 
‰
=0.0;

786 
’_diff
>
TOL
)

788 
i
=0;i<
Çtms_lş
*
c_dim
;i++è
rho
[i]=0.0;

790 
__vec_lş
[0]=__vec_lş[1+
__nvoigt__
]=0.0;

791 
i¡¬t
=0;

792 
ii¡¬t
=0;

793 
’t_cÜr_lş
=0.0;

794 
i
=0;i<
Çtms_lş
;i++)

796 cÚ¡ 
Ãigh_sz
=
ÃighbÜ_li¡_size
[
i
];

797 
j
,
__j
=0;__j<
Ãigh_sz
;__j++)

799 
j
=
ÃighbÜ_li¡
[
i
][
__j
];

802 
ic
=0;ic<
c_dim
;ic++)

803 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3)

804 
A
[
ic
][
jc
]=-12.0*
b‘a
*(
rho_phi
[
i¡¬t
+2]*
dE
[
i
*
c_dim
+ic]+rho_phi[i¡¬t+1]*dE[
j
*c_dim+jc]+rho_phi[istart]);

805 
i¡¬t
-=3*
c_dim
*c_dim;

808 
ty³0
 
m
=
A
[0][0]+A[1][1]-A[0][1]-A[1][0],
u
;

809 
ty³0
 
rsq
=
Algeb¿
::
RSQ
<
__dim__
>(
x
+
i
*__dim__,x+
j
*__dim__)/(
©oms
->
H
[0][0]*atoms->H[0][0]);

810 if(
m
!=0.0 && 
rsq
<.9)

813 
ty³0
 
__a
,
__b
,
__c
,
__d–
;

815 if((
c
[
i
*
c_dim
]==0.0 && c[
j
*c_dim]==0.0) || (c[i*c_dim]==1.0 && c[j*c_dim]==1.0))

817 
u
=
c
[
i
*
c_dim
];

821 
__a
=0.0;

823 if(
m
<0.0)

825 
__a
=
	`exp
(
m
)-1.0;

826 
__b
=-1.0-(
c
[
j
*
c_dim
]+c[
i
*c_dim])*
__a
;

827 
__c
=
c
[
j
*
c_dim
]*c[
i
*c_dim]*(
__a
+1.0);

831 
__a
=1.0-
	`exp
(-
m
);

832 
__b
=-(
c
[
j
*
c_dim
]+c[
i
*c_dim]-1.0)*
__a
-1.0;

833 
__c
=
c
[
j
*
c_dim
]*c[
i
*c_dim];

841 
ty³0
 
__x0
=0.0,
__x1
=0.0;

842 if(
__a
==0.0)

846 
u
=-
__c
/
__b
;

850 
__d–
=
	`sq¹
(
__b
*__b-4.0*
__a
*
__c
);

852 
__x1
=0.5*(-
__b
+
__d–
)/
__a
;

853 
__x0
=0.5*(-
__b
-
__d–
)/
__a
;

854 if(
__x0
<=
c
[
i
*
c_dim
] && __x0<=c[
j
*c_dim] && __x0>=0.0)

855 
u
=
__x0
;

857 
u
=
__x1
;

868 if(
i
==0 && 
j
==1)

870 if(
c
[
i
*
c_dim
]==1.0)

871 
‰
=1.0;

873 
‰
=(1.0-
c
[
i
*
c_dim
]-c[
j
*c_dim]+
u
)/((1.0-c[i*c_dim])*(1.0-c[i*c_dim]));

877 
B_·œ
[
ii¡¬t
]=
u
;

878 
B_·œ
[
ii¡¬t
+1]=
c
[
i
*
c_dim
]-
u
;

879 
B_·œ
[
ii¡¬t
+2]=
c
[
j
*
c_dim
]-
u
;

880 
B_·œ
[
ii¡¬t
+3]=1.0-
c
[
i
*
c_dim
]-c[
j
*c_dim]+
u
;

883 if(
j
<
Çtms_lş
)

885 
ic
=0;ic<
c_dim
;ic++)

886 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

888 
__vec_lş
[0]+=
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
];

889 if(
c
[
i
*
c_dim
+
ic
]>0.0)

890 
rho
[
i
*
c_dim
+
ic
]+=
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
+2]/
c
[i*c_dim+ic];

891 if(
c
[
j
*
c_dim
+
jc
]>0.0)

892 
rho
[
j
*
c_dim
+
jc
]+=
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
+1]/
c
[j*c_dim+jc];

898 if(
B_·œ
[
ii¡¬t
]>0.0 && 
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]>0.0)

900 
’t_cÜr_lş
+=
B_·œ
[
ii¡¬t
]*
	`log
(B_·œ[ii¡¬t]/(
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]))/12.0;

907 
ic
=0;ic<
c_dim
;ic++)

908 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

910 
__vec_lş
[0]+=0.5*
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
];

911 if(
c
[
i
*
c_dim
+
ic
]>0.0)

912 
rho
[
i
*
c_dim
+
ic
]+=
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
+2]/
c
[i*c_dim+ic];

917 if(
B_·œ
[
ii¡¬t
]>0.0 && 
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]>0.0)

919 
’t_cÜr_lş
+=
B_·œ
[
ii¡¬t
]*
	`log
(B_·œ[ii¡¬t]/(
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]))/24.0;

927 
B_·œ
[
ii¡¬t
]=
c
[
i
*
c_dim
]*c[
j
*c_dim];

928 
B_·œ
[
ii¡¬t
+1]=
c
[
i
*
c_dim
]*c[
j
*c_dim+1];

929 
B_·œ
[
ii¡¬t
+2]=
c
[
i
*
c_dim
+1]*c[
j
*c_dim];

930 
B_·œ
[
ii¡¬t
+3]=
c
[
i
*
c_dim
+1]*c[
j
*c_dim+1];

933 if(
j
<
Çtms_lş
)

935 
ic
=0;ic<
c_dim
;ic++)

936 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

938 
__vec_lş
[0]+=
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
];

939 
rho
[
i
*
c_dim
+
ic
]+=
c
[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
+2];

940 
rho
[
j
*
c_dim
+
jc
]+=
c
[
i
*c_dim+
ic
]*
rho_phi
[
i¡¬t
+1];

945 
ic
=0;ic<
c_dim
;ic++)

946 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

948 
__vec_lş
[0]+=0.5*
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
];

949 
rho
[
i
*
c_dim
+
ic
]+=
c
[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
+2];

957 
ic
=0;ic<
c_dim
;ic++)

960 
p
=
rho
[
i
*
c_dim
+
ic
]*
drho_šv
;

961 
m
=
¡©ic_ÿ¡
<
size_t
>(
p
);

962 
m
=
	`MIN
(m,
Äho
-2);

963 
p
-=
m
;

964 
p
=
	`MIN
(p,1.0);

965 
cÛf
=
F_¬r
[
ic
][
m
];

967 
tmp0
=(((
cÛf
[4]*
p
+coef[3])*p+coef[2])*p+coef[1])*p+coef[0];

968 
tmp1
=(((4.0*
cÛf
[4]*
p
+3.0*cÛf[3])*p+2.0*cÛf[2])*p+cÛf[1])*
drho_šv
;

970 if(
rho
[
i
*
c_dim
+
ic
]>
rho_max
è
tmp0
+=
tmp1
*(rho[i*c_dim+ic]-rho_max);

972 
dE
[
i
*
c_dim
+
ic
]=
tmp1
;

973 
__vec_lş
[0]+=
c
[
i
*
c_dim
+
ic
]*
tmp0
;

981 
__vec_lş
[1+
__nvoigt__
]+=
’t_cÜr_lş
;

982 
__vec_lş
[0]+=
’t_cÜr_lş
*
kbT
;

984 
	`MPI_AÎ»duû
(
__vec_lş
,&
cu¼_’
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

985 
’_diff
=
	`çbs
(
cu¼_’
-
´ev_’
);

987 
´ev_’
=
cu¼_’
;

988 
	`upd©e
(
dE_±r
);

991 #ifdeà
SC_DMD


992 
©oms
->
BB
=
‰
;

996 
	}
}

1000 
	gFÜûF›ldEAMDMDSC
::
	$sc_loİ__Z6_2nd
()

1004 
ty³0
* 
dE
=
dE_±r
->
	`begš
();

1005 
ty³0
* 
rho
=
rho_±r
->
	`begš
();

1007 
ty³0
* 
cÛf
;

1008 
ty³0
 
A
[2][2]{
	`DESIG2
(2,2,1.0)};

1009 
size_t
 
m
,
ii¡¬t
,
i¡¬t
;

1010 
ty³0
 
’t_cÜr_lş
=0.0,
´ev_’
,
cu¼_’
;

1011 
	`MPI_AÎ»duû
(
__vec_lş
,&
´ev_’
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

1012 
ty³0
 
p
,
’_diff
=1.0,
tmp0
,
tmp1
;

1013 
Çtms_lş
=
©oms
->natms_lcl;

1014 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->neighbor_list;

1015 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->neighbor_list_size;

1016 
ty³0
 cÚ¡* 
c
=
©oms
->c->
	`begš
();

1017 
ty³0
* 
x
=
©oms
->x->
	`begš
();

1019 
ty³0
 
‰
=0.0;

1023 
’_diff
>
TOL
)

1025 
i
=0;i<
Çtms_lş
*
c_dim
;i++è
rho
[i]=0.0;

1027 
__vec_lş
[0]=__vec_lş[1+
__nvoigt__
]=0.0;

1028 
i¡¬t
=0;

1029 
ii¡¬t
=0;

1030 
’t_cÜr_lş
=0.0;

1032 
i
=0;i<
Çtms_lş
;i++)

1035 cÚ¡ 
Ãigh_sz
=
ÃighbÜ_li¡_size
[
i
];

1036 
j
,
__j
=0;__j<
Ãigh_sz
;__j++)

1038 
j
=
ÃighbÜ_li¡
[
i
][
__j
];

1041 
ic
=0;ic<
c_dim
;ic++)

1042 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3)

1043 
A
[
ic
][
jc
]=-6.0*
b‘a
*(
rho_phi
[
i¡¬t
+2]*
dE
[
i
*
c_dim
+ic]+rho_phi[i¡¬t+1]*dE[
j
*c_dim+jc]+rho_phi[istart]);

1044 
i¡¬t
-=3*
c_dim
*c_dim;

1047 
ty³0
 
m
=
A
[0][0]+A[1][1]-A[0][1]-A[1][0],
u
;

1048 
ty³0
 
rsq
=
Algeb¿
::
RSQ
<
__dim__
>(
x
+
i
*__dim__,x+
j
*__dim__)/(
©oms
->
H
[0][0]*atoms->H[0][0]);

1049 if(
m
!=0.0 && (0.8<
rsq
 &&„sq<1.2))

1052 
ty³0
 
__a
,
__b
,
__c
,
__d–
;

1054 if((
c
[
i
*
c_dim
]==0.0 && c[
j
*c_dim]==0.0) || (c[i*c_dim]==1.0 && c[j*c_dim]==1.0))

1056 
u
=
c
[
i
*
c_dim
];

1060 
__a
=0.0;

1061 
ty³0
 
__x0
=0.0,
__x1
=0.0;

1064 if(
m
<0.0)

1066 
__a
=
	`exp
(
m
)-1.0;

1067 
__b
=-1.0-(
c
[
j
*
c_dim
]+c[
i
*c_dim])*
__a
;

1068 
__c
=
c
[
j
*
c_dim
]*c[
i
*c_dim]*(
__a
+1.0);

1070 
__d–
=
	`sq¹
(
__b
*__b-4.0*
__a
*
__c
);

1072 
__x0
=0.5*(-
__b
-
__d–
)/
__a
;

1073 
__x1
=0.5*(-
__b
+
__d–
)/
__a
;

1078 
__a
=1.0-
	`exp
(-
m
);

1079 
__b
=-(
c
[
j
*
c_dim
]+c[
i
*c_dim]-1.0)*
__a
-1.0;

1080 
__c
=
c
[
j
*
c_dim
]*c[
i
*c_dim];

1082 
__d–
=
	`sq¹
(
__b
*__b-4.0*
__a
*
__c
);

1084 
__x0
=0.5*(-
__b
+
__d–
)/
__a
;

1085 
__x1
=0.5*(-
__b
-
__d–
)/
__a
;

1092 if(
__a
==0.0)

1096 
u
=-
__c
/
__b
;

1101 if(
__x0
<=
c
[
i
*
c_dim
] && __x0<=c[
j
*c_dim] && __x0>=0.0)

1102 
u
=
__x0
;

1104 
u
=
__x1
;

1111 if(
c
[
i
*
c_dim
]==0.0)

1112 
‰
=1.0;

1115 
‰
=
u
/(
c
[
i
*
c_dim
]*c[i*c_dim]);

1133 
B_·œ
[
ii¡¬t
]=
u
;

1134 
B_·œ
[
ii¡¬t
+1]=
c
[
i
*
c_dim
]-
u
;

1135 
B_·œ
[
ii¡¬t
+2]=
c
[
j
*
c_dim
]-
u
;

1136 
B_·œ
[
ii¡¬t
+3]=1.0-
c
[
i
*
c_dim
]-c[
j
*c_dim]+
u
;

1138 if(
j
<
Çtms_lş
)

1140 
ic
=0;ic<
c_dim
;ic++)

1141 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

1143 
__vec_lş
[0]+=
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
];

1144 if(
c
[
i
*
c_dim
+
ic
]>0.0)

1145 
rho
[
i
*
c_dim
+
ic
]+=
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
+2]/
c
[i*c_dim+ic];

1146 if(
c
[
j
*
c_dim
+
jc
]>0.0)

1147 
rho
[
j
*
c_dim
+
jc
]+=
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
+1]/
c
[j*c_dim+jc];

1153 if(
B_·œ
[
ii¡¬t
]>0.0 && 
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]>0.0)

1155 
’t_cÜr_lş
+=
B_·œ
[
ii¡¬t
]*
	`log
(B_·œ[ii¡¬t]/(
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]))/6.0;

1162 
ic
=0;ic<
c_dim
;ic++)

1163 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

1165 
__vec_lş
[0]+=0.5*
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
];

1166 if(
c
[
i
*
c_dim
+
ic
]>0.0)

1167 
rho
[
i
*
c_dim
+
ic
]+=
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
+2]/
c
[i*c_dim+ic];

1172 if(
B_·œ
[
ii¡¬t
]>0.0 && 
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]>0.0)

1174 
’t_cÜr_lş
+=
B_·œ
[
ii¡¬t
]*
	`log
(B_·œ[ii¡¬t]/(
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]))/12.0;

1182 
B_·œ
[
ii¡¬t
]=
c
[
i
*
c_dim
]*c[
j
*c_dim];

1183 
B_·œ
[
ii¡¬t
+1]=
c
[
i
*
c_dim
]*c[
j
*c_dim+1];

1184 
B_·œ
[
ii¡¬t
+2]=
c
[
i
*
c_dim
+1]*c[
j
*c_dim];

1185 
B_·œ
[
ii¡¬t
+3]=
c
[
i
*
c_dim
+1]*c[
j
*c_dim+1];

1198 if(
j
<
Çtms_lş
)

1200 
ic
=0;ic<
c_dim
;ic++)

1201 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

1203 
__vec_lş
[0]+=
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
];

1204 
rho
[
i
*
c_dim
+
ic
]+=
c
[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
+2];

1205 
rho
[
j
*
c_dim
+
jc
]+=
c
[
i
*c_dim+
ic
]*
rho_phi
[
i¡¬t
+1];

1210 
ic
=0;ic<
c_dim
;ic++)

1211 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

1213 
__vec_lş
[0]+=0.5*
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
];

1214 
rho
[
i
*
c_dim
+
ic
]+=
c
[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
+2];

1222 
ic
=0;ic<
c_dim
;ic++)

1225 
p
=
rho
[
i
*
c_dim
+
ic
]*
drho_šv
;

1226 
m
=
¡©ic_ÿ¡
<
size_t
>(
p
);

1227 
m
=
	`MIN
(m,
Äho
-2);

1228 
p
-=
m
;

1229 
p
=
	`MIN
(p,1.0);

1230 
cÛf
=
F_¬r
[
ic
][
m
];

1232 
tmp0
=(((
cÛf
[4]*
p
+coef[3])*p+coef[2])*p+coef[1])*p+coef[0];

1233 
tmp1
=(((4.0*
cÛf
[4]*
p
+3.0*cÛf[3])*p+2.0*cÛf[2])*p+cÛf[1])*
drho_šv
;

1235 if(
rho
[
i
*
c_dim
+
ic
]>
rho_max
è
tmp0
+=
tmp1
*(rho[i*c_dim+ic]-rho_max);

1237 
dE
[
i
*
c_dim
+
ic
]=
tmp1
;

1238 
__vec_lş
[0]+=
c
[
i
*
c_dim
+
ic
]*
tmp0
;

1246 
__vec_lş
[1+
__nvoigt__
]+=
’t_cÜr_lş
;

1247 
__vec_lş
[0]+=
’t_cÜr_lş
*
kbT
;

1248 
	`MPI_AÎ»duû
(
__vec_lş
,&
cu¼_’
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

1249 
’_diff
=
	`çbs
(
cu¼_’
-
´ev_’
);

1250 
´ev_’
=
cu¼_’
;

1251 
	`upd©e
(
dE_±r
);

1256 #ifdeà
SC_DMD


1257 
©oms
->
BB
=
‰
;

1261 
	}
}

1265 
	gFÜûF›ldEAMDMDSC
::
	$sc_loİ__
()

1270 
ty³0
* 
dE
=
dE_±r
->
	`begš
();

1271 
ty³0
* 
rho
=
rho_±r
->
	`begš
();

1273 
ty³0
* 
cÛf
;

1274 
ty³0
 
A
[2][2]{
	`DESIG2
(2,2,1.0)};

1275 
size_t
 
m
,
ii¡¬t
,
i¡¬t
;

1276 
ty³0
 
’t_cÜr_lş
=0.0,
´ev_’
,
cu¼_’
;

1277 
	`MPI_AÎ»duû
(
__vec_lş
,&
´ev_’
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

1278 
ty³0
 
p
,
’_diff
=1.0,
tmp0
,
tmp1
;

1279 
Çtms_lş
=
©oms
->natms_lcl;

1280 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->neighbor_list;

1281 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->neighbor_list_size;

1282 
ty³0
 cÚ¡* 
c
=
©oms
->c->
	`begš
();

1283 
’_diff
>
TOL
)

1285 
i
=0;i<
Çtms_lş
*
c_dim
;i++è
rho
[i]=0.0;

1287 
__vec_lş
[0]=__vec_lş[1+
__nvoigt__
]=0.0;

1288 
i¡¬t
=0;

1289 
ii¡¬t
=0;

1290 
’t_cÜr_lş
=0.0;

1291 
i
=0;i<
Çtms_lş
;i++)

1293 cÚ¡ 
Ãigh_sz
=
ÃighbÜ_li¡_size
[
i
];

1294 
j
,
__j
=0;__j<
Ãigh_sz
;__j++)

1296 
j
=
ÃighbÜ_li¡
[
i
][
__j
];

1299 
ic
=0;ic<
c_dim
;ic++)

1300 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3)

1301 
A
[
ic
][
jc
]=
	`exp
(-0.5*
b‘a
*((
rho_phi
[
i¡¬t
+2]*
dE
[
i
*
c_dim
+ic]+rho_phi[i¡¬t+1]*dE[
j
*c_dim+jc]+rho_phi[istart]))/8.0);

1303 
i¡¬t
-=3*
c_dim
*c_dim;

1305 if(
A
[0][0]!=1.0 && A[0][1]!=1.0 && A[1][0]!=1.0 && A[1][1]!=1.0)

1307 
ty³0
 
u
=0.0;

1308 if(
c
[
i
*
c_dim
]!=0.0 && c[
j
*c_dim]!=0.0)

1310 
ty³0
 
__a
=
c
[
j
*
c_dim
]*
A
[0][1]*A[1][1]/(A[1][0]*A[0][0]);

1311 
ty³0
 
__b
=(
c
[
j
*
c_dim
]-c[
i
*c_dim])*
A
[1][1]/A[1][0]+(c[j*c_dim]+c[i*c_dim]-1.0)*A[0][1]/A[0][0];

1312 if(
__a
==0.0)

1314 
u
=
c
[
i
*
c_dim
]/(1.0-(
A
[0][1]/A[0][0])*(c[
j
*c_dim]-1.0)/
__b
);

1318 
ty³0
 
d–
=
	`sq¹
(
__b
*__b-4.0*
__a
*(
c
[
j
*
c_dim
]-1.0));

1319 
ty³0
 
x0
=
c
[
i
*
c_dim
]/(1.0+(
A
[0][1]/A[0][0])*0.5*(-
__b
-
d–
)/
__a
);

1320 
ty³0
 
x1
=
c
[
i
*
c_dim
]/(1.0+(
A
[0][1]/A[0][0])*0.5*(-
__b
+
d–
)/
__a
);

1322 if(
x0
<=
c
[
i
*
c_dim
] && x0<=c[
j
*c_dim] && x0>=0.0)

1323 
u
=
x0
;

1325 
u
=
x1
;

1333 
B_·œ
[
ii¡¬t
]=
u
;

1334 
B_·œ
[
ii¡¬t
+1]=
c
[
i
*
c_dim
]-
u
;

1335 
B_·œ
[
ii¡¬t
+2]=
c
[
j
*
c_dim
]-
u
;

1336 
B_·œ
[
ii¡¬t
+3]=1.0-
c
[
i
*
c_dim
]-c[
j
*c_dim]+
u
;

1339 if(
j
<
Çtms_lş
)

1341 
ic
=0;ic<
c_dim
;ic++)

1342 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

1344 
__vec_lş
[0]+=
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
];

1345 if(
c
[
i
*
c_dim
+
ic
]>0.0)

1346 
rho
[
i
*
c_dim
+
ic
]+=
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
+2]/
c
[i*c_dim+ic];

1347 if(
c
[
j
*
c_dim
+
jc
]>0.0)

1348 
rho
[
j
*
c_dim
+
jc
]+=
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
+1]/
c
[j*c_dim+jc];

1349 if(
B_·œ
[
ii¡¬t
]>0.0)

1350 
’t_cÜr_lş
+=
	`ÿlc_’t
(
	`çbs
(
B_·œ
[
ii¡¬t
]-
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]))*8.0;

1357 
ic
=0;ic<
c_dim
;ic++)

1358 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

1360 
__vec_lş
[0]+=0.5*
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
];

1361 if(
c
[
i
*
c_dim
+
ic
]>0.0)

1362 
rho
[
i
*
c_dim
+
ic
]+=
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
+2]/
c
[i*c_dim+ic];

1363 if(
B_·œ
[
ii¡¬t
]>0.0)

1364 
’t_cÜr_lş
+=
	`ÿlc_’t
(
	`çbs
(
B_·œ
[
ii¡¬t
]-
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]))*4.0;

1371 
B_·œ
[
ii¡¬t
]=0.0;

1372 
B_·œ
[
ii¡¬t
+1]=0.0;

1373 
B_·œ
[
ii¡¬t
+2]=0.0;

1374 
B_·œ
[
ii¡¬t
+3]=0.0;

1377 if(
j
<
Çtms_lş
)

1379 
ic
=0;ic<
c_dim
;ic++)

1380 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

1382 
__vec_lş
[0]+=
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
];

1383 
rho
[
i
*
c_dim
+
ic
]+=
c
[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
+2];

1384 
rho
[
j
*
c_dim
+
jc
]+=
c
[
i
*c_dim+
ic
]*
rho_phi
[
i¡¬t
+1];

1389 
ic
=0;ic<
c_dim
;ic++)

1390 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

1392 
__vec_lş
[0]+=0.5*
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
];

1393 
rho
[
i
*
c_dim
+
ic
]+=
c
[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
+2];

1405 
ic
=0;ic<
c_dim
;ic++)

1408 
p
=
rho
[
i
*
c_dim
+
ic
]*
drho_šv
;

1409 
m
=
¡©ic_ÿ¡
<
size_t
>(
p
);

1410 
m
=
	`MIN
(m,
Äho
-2);

1411 
p
-=
m
;

1412 
p
=
	`MIN
(p,1.0);

1413 
cÛf
=
F_¬r
[
ic
][
m
];

1415 
tmp0
=(((
cÛf
[4]*
p
+coef[3])*p+coef[2])*p+coef[1])*p+coef[0];

1416 
tmp1
=(((4.0*
cÛf
[4]*
p
+3.0*cÛf[3])*p+2.0*cÛf[2])*p+cÛf[1])*
drho_šv
;

1418 if(
rho
[
i
*
c_dim
+
ic
]>
rho_max
è
tmp0
+=
tmp1
*(rho[i*c_dim+ic]-rho_max);

1420 
dE
[
i
*
c_dim
+
ic
]=
tmp1
;

1421 
__vec_lş
[0]+=
c
[
i
*
c_dim
+
ic
]*
tmp0
;

1426 
__vec_lş
[1+
__nvoigt__
]+=
’t_cÜr_lş
;

1427 
__vec_lş
[0]+=
’t_cÜr_lş
*
kbT
;

1429 
	`MPI_AÎ»duû
(
__vec_lş
,&
cu¼_’
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

1430 
’_diff
=
	`çbs
(
cu¼_’
-
´ev_’
);

1431 
´ev_’
=
cu¼_’
;

1432 
	`upd©e
(
dE_±r
);

1460 
	}
}

1461 
	~"ls.h
"

1465 
	gFÜûF›ldEAMDMDSC
::
	$sc_loİ_şu¡”
()

1469 
ty³0
* 
dE
=
dE_±r
->
	`begš
();

1470 
ty³0
* 
rho
=
rho_±r
->
	`begš
();

1472 
ty³0
* 
cÛf
;

1473 
ty³0
 
A
[2][2]{
	`DESIG2
(2,2,1.0)};

1474 
size_t
 
m
,
ii¡¬t
,
i¡¬t
;

1475 
ty³0
 
´ev_’
,
cu¼_’
;

1476 
	`MPI_AÎ»duû
(
__vec_lş
,&
´ev_’
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

1477 
ty³0
 
p
,
’_diff
=1.0,
tmp0
,
tmp1
;

1478 
Çtms_lş
=
©oms
->natms_lcl;

1479 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->neighbor_list;

1480 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->neighbor_list_size;

1481 
ty³0
 cÚ¡* 
c
=
©oms
->c->
	`begš
();

1482 
’_diff
>
TOL
)

1484 
i
=0;i<
Çtms_lş
*
c_dim
;i++è
rho
[i]=0.0;

1486 
__vec_lş
[0]=__vec_lş[1+
__nvoigt__
]=0.0;

1487 
i¡¬t
=0;

1488 
ii¡¬t
=0;

1489 
i
=0;i<
Çtms_lş
;i++)

1491 cÚ¡ 
Ãigh_sz
=
ÃighbÜ_li¡_size
[
i
];

1492 
j
,
__j
=0;__j<
Ãigh_sz
;__j++)

1494 
j
=
ÃighbÜ_li¡
[
i
][
__j
];

1497 
ic
=0;ic<
c_dim
;ic++)

1498 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3)

1499 
A
[
ic
][
jc
]=-
b‘a
*(
rho_phi
[
i¡¬t
+2]*
dE
[
i
*
c_dim
+ic]+rho_phi[i¡¬t+1]*dE[
j
*c_dim+jc]+rho_phi[istart]);

1500 
i¡¬t
-=3*
c_dim
*c_dim;

1502 if(
A
[0][0]!=0.0 || A[0][1]!=0.0 || A[1][0]!=0.0 || A[1][1]!=0.0)

1504 
ty³0
 
r0
=
	`exp
(
A
[0][1]-A[0][0]);

1505 
ty³0
 
r1
=
	`exp
(
A
[1][1]-A[1][0]);

1506 
ty³0
 
u
=0.0;

1507 if(
c
[
i
*
c_dim
]!=0.0 && c[
j
*c_dim]!=0.0)

1510 
ty³0
 
__a
=
c
[
j
*
c_dim
]*
r0
*
r1
;

1511 
ty³0
 
__b
=(
c
[
j
*
c_dim
]+c[
i
*c_dim]-1.0)*
r0
+(c[j*c_dim]-c[i*c_dim])*
r1
;

1512 
ty³0
 
__c
=-(1.0-
c
[
j
*
c_dim
]);

1514 if(
__a
==0.0)

1516 
u
=
c
[
i
*
c_dim
]/(1.0-
r0
*
__c
/
__b
);

1520 
ty³0
 
d–
=
	`sq¹
(
__b
*__b-4.0*
__a
*
__c
);

1521 
ty³0
 
x0
=
c
[
i
*
c_dim
]/(1.0+
r0
*0.5*(-
__b
-
d–
)/
__a
);

1522 
ty³0
 
x1
=
c
[
i
*
c_dim
]/(1.0+
r0
*0.5*(-
__b
+
d–
)/
__a
);

1524 if(
x0
<=
c
[
i
*
c_dim
] && x0<=c[
j
*c_dim] && x0>=0.0)

1525 
u
=
x0
;

1527 
u
=
x1
;

1535 
B_·œ
[
ii¡¬t
]=
u
;

1536 
B_·œ
[
ii¡¬t
+1]=
c
[
i
*
c_dim
]-
u
;

1537 
B_·œ
[
ii¡¬t
+2]=
c
[
j
*
c_dim
]-
u
;

1538 
B_·œ
[
ii¡¬t
+3]=1.0-
c
[
i
*
c_dim
]-c[
j
*c_dim]+
u
;

1541 if(
j
<
Çtms_lş
)

1543 
ic
=0;ic<
c_dim
;ic++)

1544 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

1546 
__vec_lş
[0]+=
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
];

1547 if(
c
[
i
*
c_dim
+
ic
]>0.0)

1548 
rho
[
i
*
c_dim
+
ic
]+=
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
+2]/
c
[i*c_dim+ic];

1549 if(
c
[
j
*
c_dim
+
jc
]>0.0)

1550 
rho
[
j
*
c_dim
+
jc
]+=
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
+1]/
c
[j*c_dim+jc];

1555 
ic
=0;ic<
c_dim
;ic++)

1556 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

1558 
__vec_lş
[0]+=0.5*
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
];

1559 if(
c
[
i
*
c_dim
+
ic
]>0.0)

1560 
rho
[
i
*
c_dim
+
ic
]+=
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
+2]/
c
[i*c_dim+ic];

1568 
B_·œ
[
ii¡¬t
]=0.0;

1569 
B_·œ
[
ii¡¬t
+1]=0.0;

1570 
B_·œ
[
ii¡¬t
+2]=0.0;

1571 
B_·œ
[
ii¡¬t
+3]=0.0;

1574 if(
j
<
Çtms_lş
)

1576 
ic
=0;ic<
c_dim
;ic++)

1577 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

1579 
__vec_lş
[0]+=
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
];

1580 
rho
[
i
*
c_dim
+
ic
]+=
c
[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
+2];

1581 
rho
[
j
*
c_dim
+
jc
]+=
c
[
i
*c_dim+
ic
]*
rho_phi
[
i¡¬t
+1];

1586 
ic
=0;ic<
c_dim
;ic++)

1587 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

1589 
__vec_lş
[0]+=0.5*
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
];

1590 
rho
[
i
*
c_dim
+
ic
]+=
c
[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
+2];

1602 
ic
=0;ic<
c_dim
;ic++)

1605 
p
=
rho
[
i
*
c_dim
+
ic
]*
drho_šv
;

1606 
m
=
¡©ic_ÿ¡
<
size_t
>(
p
);

1607 
m
=
	`MIN
(m,
Äho
-2);

1608 
p
-=
m
;

1609 
p
=
	`MIN
(p,1.0);

1610 
cÛf
=
F_¬r
[
ic
][
m
];

1612 
tmp0
=(((
cÛf
[4]*
p
+coef[3])*p+coef[2])*p+coef[1])*p+coef[0];

1613 
tmp1
=(((4.0*
cÛf
[4]*
p
+3.0*cÛf[3])*p+2.0*cÛf[2])*p+cÛf[1])*
drho_šv
;

1615 if(
rho
[
i
*
c_dim
+
ic
]>
rho_max
è
tmp0
+=
tmp1
*(rho[i*c_dim+ic]-rho_max);

1617 
dE
[
i
*
c_dim
+
ic
]=
tmp1
;

1618 
__vec_lş
[0]+=
c
[
i
*
c_dim
+
ic
]*
tmp0
;

1623 
	`MPI_AÎ»duû
(
__vec_lş
,&
cu¼_’
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

1624 
’_diff
=
	`çbs
(
cu¼_’
-
´ev_’
);

1625 
´ev_’
=
cu¼_’
;

1626 
	`upd©e
(
dE_±r
);

1630 
ty³0
 
__q
=0.0,
__l
=0.0,
__n
=0.0;

1631 
ii¡¬t
=0.0;

1632 
j
,
__j
=0;__j<
ÃighbÜ_li¡_size
[0];__j++)

1634 
j
=
ÃighbÜ_li¡
[0][
__j
];

1635 if(
B_·œ
[
ii¡¬t
]>0.0)

1637 
__q
+=
B_·œ
[
ii¡¬t
];

1638 
__l
+=
	`ÿlc_’t
(
B_·œ
[
ii¡¬t
]);

1639 
__n
++;

1642 
ii¡¬t
+=
c_dim
*c_dim;

1645 
ty³0
 
__a
=
c
[0]-
__n
*
__q
;

1646 
ty³0
 
__b
=1.0-
c
[0];

1647 
ty³0
 
__c
=0.5*
__n
;

1648 
ty³0
 
__d
=0.5*(
__l
-
__q
);

1652 şas 
	cFunc


1654 
public
:

1655 
ty³0
 
a
;

1656 
ty³0
 
b
;

1657 
ty³0
 
c
;

1658 
ty³0
 
d
,
x0
;

1659 
ty³0
 
dœ
;

1661 
	`Func
(
ty³0
 
__a
,ty³0 
__b
,ty³0 
__c
,ty³0 
__d
,ty³0 
__x0
):

1662 
	`a
(
__a
),

1663 
	`b
(
__b
),

1664 
	`c
(
__c
),

1665 
	`d
(
__d
),

1666 
	`x0
(
__x0
)

1668 if(
x0
==0.0)

1669 
x0
+=
¡d
::
num”ic_lim™s
<
ty³0
>::
	`•sÚ
();

1670 if(
x0
==1.0)

1671 
x0
-=
¡d
::
num”ic_lim™s
<
ty³0
>::
	`•sÚ
();

1673 if(
	`dm
(
x0
)<0.0)

1674 
dœ
=1.0;

1676 
dœ
=-1.0;

1679 
ty³0
 
	`m
Ñy³0 
x
)

1681  
a
*
	`log
(
x
)+
b
*log(1.0-x)+
c
*x*x+
d
;

1683 
ty³0
 
	`dm
Ñy³0 
x
)

1685  
a
/
x
-
b
/(1.0-x)+2.0*
c
*x;

1688 
	`F_»£t
(){}

1690 
ty³0
 
	`F
Ñy³0 
x
)

1692 
x
*=
dœ
;

1693 if(
x
+
x0
>1.0)

1694  
	`m
(1.0-
¡d
::
num”ic_lim™s
<
ty³0
>::
	`•sÚ
());

1695 if(
x
+
x0
<0.0)

1696  
	`m
(
¡d
::
num”ic_lim™s
<
ty³0
>::
	`•sÚ
());

1698  
	`m
(
x
);

1700 
	`ls_´•
(
ty³0
& 
dç
,ty³0& 
h_nÜm
,ty³0& 
max_a
)

1702 
h_nÜm
=0.0;

1703 if(
dœ
==1.0)

1705 
max_a
=1.0-
¡d
::
num”ic_lim™s
<
ty³0
>::
	`•sÚ
()-
x0
;

1706 
dç
=
	`dm
(
x0
);

1710 
max_a
=
x0
-
¡d
::
num”ic_lim™s
<
ty³0
>::
	`•sÚ
();

1711 
dç
=-
	`dm
(
x0
);

1714 
	}
};

1718 
Func
 
	gfunc
=Func(
__a
,
__b
,
__c
,
__d
,
c
[0]);

1719 
LšeS—rchB»Á
 
	gls
=LineSearchBrent();

1720 
ty³0
 
	gdd
;

1721 
ty³0
 
	g’
=
func
.
F
(
c
[0]);

1722 
´štf
("%lf*Log[x]+%lf*Log[1-x]+%lf*x^2+%lf\n",
__a
,
__b
,
__c
,
__d
);

1724 
	gls
.
mš
(&
func
,
’
,
dd
,1);

1726 
´štf
("aá” %e\n",
’
);

1729 if(
	gc
[0]==0.0 || 
c
[0]==1.0)

1731 
__vec_lş
[1+
__nvoigt__
]=0.0;

1734 
	g__vec_lş
[1+
__nvoigt__
]=
¡©ic_ÿ¡
<
ty³0
>(
©oms
->
Çtms
)*
’
;

1852 
	gFÜûF›ldEAMDMDSC
::
__´•J_n_»s
(
Vec
<
ty³0
>*,Vec<type0>*)

1857 
	gFÜûF›ldEAMDMDSC
::
__J
(
Vec
<
ty³0
>*,Vec<type0>*,Vec<type0>*,Vec<type0>*)

1862 
	gFÜûF›ldEAMDMDSC
::
	$š™
()

1864 
	`´e_š™
();

1865 
	`£t_‹mp
();

1867 
cv_±r
=
Ãw
 
Vec
<
ty³0
>(
©oms
,1);

1868 
p_±r
=
Ãw
 
Vec
<
ty³0
>(
©oms
,1);

1869 
c_tde_±r
=
Ãw
 
Vec
<
ty³0
>(
©oms
,1);

1870 
E_±r
=
Ãw
 
Vec
<
ty³0
>(
©oms
,
c_dim
);

1871 
dE_±r
=
Ãw
 
Vec
<
ty³0
>(
©oms
,
c_dim
);

1872 
rho_±r
=
Ãw
 
Vec
<
ty³0
>(
©oms
,
c_dim
);

1873 
	}
}

1877 
	gFÜûF›ldEAMDMDSC
::
	$fš
()

1880 
MemÜy
::
	`d—Îoc
(
rho_phi
);

1881 
MemÜy
::
	`d—Îoc
(
drho_phi_dr
);

1882 
MemÜy
::
	`d—Îoc
(
drho_phi_d®pha
);

1883 
MemÜy
::
	`d—Îoc
(
B_·œ
);

1884 
max_·œs
=0;

1886 
d–‘e
 
rho_±r
;

1887 
d–‘e
 
dE_±r
;

1888 
d–‘e
 
E_±r
;

1889 
d–‘e
 
c_tde_±r
;

1890 
d–‘e
 
p_±r
;

1891 
d–‘e
 
cv_±r
;

1893 
dE_±r
=
rho_±r
=
cv_±r
=
vec0
=
vec1
=
vec2
=
vec3
=
NULL
;

1894 
	`po¡_fš
();

1895 
	}
}

1899 
	gFÜûF›ldEAMDMDSC
::
	$£t_‹mp
()

1901 
ty³0
 
T
=
©oms
->
‹mp
;

1902 
ty³0
 
kb
=
©oms
->
kB
;

1903 
ty³0
 
hP
=
©oms
->hP;

1904 
ty³0
 
mass
;

1905 
ty³0
 
deb_l
;

1907 
size_t
 
i
=0;i<
ÃËms
;i++)

1909 
mass
=
©oms
->
–em’ts
.
mas£s
[
i
];

1910 
c_1
[
i
]=
	`sq¹
(0.5*
kb
*
T
/
mass
)/
M_PI
;

1911 
deb_l
=
hP
*hP/(2.0*
M_PI
*M_PI*
mass
*
kb
*
T
);

1912 
c_0
[
i
]=1.5*
kb
*
T
*(
	`log
(
deb_l
)-1.0);

1915 
kbT
=
kb
*
T
;

1916 
b‘a
=1.0/
kbT
;

1917 
	}
}

1921 
šlše
 
ty³0
 
	gFÜûF›ldEAMDMDSC
::
	$ÿlc_’t
(
ty³0
 
x
)

1923 if(
x
==0.0)  0.0;

1924  
x
*
	`log
(x);

1925 
	}
}

1930 
	gFÜûF›ldEAMDMDSC
::
	$ml_Ãw
(
PyM‘hodDef
& 
m‘hod_0
,PyM‘hodDef& 
m‘hod_1
,PyM‘hodDef& 
m‘hod_2
)

1932 
m‘hod_0
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

1933 
m‘hod_0
.
ml_Çme
="ff_eam_funcfl_sc";

1934 
m‘hod_0
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

1935 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

1937 
AtomsDMD
::
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<AtomsDMD::Objeù*>(
£lf
);

1938 
FuncAPI
<
¡d
::
¡ršg
*,
ty³0
*,ty³0*,¡d::¡ršg*> 
	`f
("ff_eam_funcfl_sc",{"funcfl_files","r_crd","C","elems"});

1939 
f
.
nİtiÚ®s
=1;

1940 
f
.
logics
<1>()[0]=
	`VLogics
("gt",0.0);

1941 
f
.
logics
<2>()[0]=
	`VLogics
("gt",0.0);

1943 cÚ¡ 
¡d
::
¡ršg
* 
Çmes
=
__£lf
->
©oms
->
–em’ts
.names;

1944 cÚ¡ 
size_t
 
ÃËms
=
__£lf
->
©oms
->
–em’ts
.nelems;

1945 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

1946 if(
f
.
»m­
<3,0,1,2>("–em’t ´e£Á iÀsy¡em",
Çmes
,
ÃËms
)è 
NULL
;

1948 
size_t
 
Ä
,
Äho
;

1949 
ty³0
 
dr
,
drho
;

1950 
ty³0
** 
r_c
;

1951 
	`ty³0
(** 
F
)[5]=
NULL
;

1952 
	`ty³0
(*** 
r_phi
)[4]=
NULL
;

1953 
	`ty³0
(*** 
rho
)[4]=
NULL
;

1954 
Œy


1956 
ImpÜtEAM
::
	`funcæ
(
ÃËms
,
f
.
v®
<0>(),
dr
,
drho
,
Ä
,
Äho
,
r_phi
,
rho
,
F
,
r_c
);

1958 
	`ÿtch
(* 
”r_msg
)

1960 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,
”r_msg
);

1961 
d–‘e
 [] 
”r_msg
;

1962  
NULL
;

1965 
size_t
 
i
=0;i<
ÃËms
;i++)

1966 if(
f
.
v
<1>()[
i
]>
r_c
[i][i])

1968 
MemÜy
::
	`d—Îoc
(
r_c
);

1969 
MemÜy
::
	`d—Îoc
(
F
);

1970 
MemÜy
::
	`d—Îoc
(
r_phi
);

1971 
MemÜy
::
	`d—Îoc
(
rho
);

1972 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"r_üd[%zu] should bËs thª„_c[%zu][%zu]",
i
,i,i);

1973  
NULL
;

1976 
d–‘e
 
__£lf
->
ff
;

1977 
__£lf
->
ff
=
Ãw
 
	`FÜûF›ldEAMDMDSC
(__£lf->
©oms
,
dr
,
drho
,
Ä
,
Äho
,
¡d
::
	`move
(
r_phi
),¡d::move(
rho
),¡d::move(
F
),¡d::move(
r_c
),
f
.
mov
<1>(),f.mov<2>());

1978 
Py_RETURN_NONE
;

1980 
m‘hod_0
.
ml_doc
=(*)
R
"---(

1981 
	`ff_—m_funcæ
(
funcæ_fes
,
r_üd
,
C
,
–ems
=
NÚe
)

1983 
TabuÏ‹d
 
EAM
 
fÜû
 
f›ld
 
giv’
 
by
 
FuncFL
 
fe
/
s


1985 
Assigns
 
EAM
 
fÜû
 
f›ld
 
to
 
sy¡em


1987 
P¬am‘”s


1989 
funcæ_fes
 : 
¡ršg
[
ÃËms
]

1990 
li¡
 
of
 
»Ïtive
 
·ths
 
to
 
DYNAMO
 
fes
 
w™h
 
FuncFL
 
fÜm©


1991 
r_üd
 : [
ÃËms
]

1992 
cutoff
 
¿dius
 
mass
 
exchªge


1993 
C
 : [
ÃËms
]

1994 
dim’siÚËss
 
çùÜ
 
—ch
 
–em’t
, 
£e
 :
»f
:`
h”e
 <
ma¡”
-ref>`

1995 
–ems
 : 
¡ršg
[
ÃËms
]

1996 
m­pšg
 
–em’ts


1998 
R‘uºs


2000 
NÚe


2002 
NÙes


2004 
This
 
is
 
buÏ‹d
 
fÜm
 
of
 
Embedded
 
Atom
 
	`M‘hod
 (
EAM
è
pÙ’tŸl


2007 
Exam¶es


2009 
Ni


2013 >>> 
äom
 
m­p
 
impÜt
 
dmd


2014 >>> 
sim
=
dmd
.
	`cfg
(5,"configs/Ni-DMD.cfg")

2015 >>> 
sim
.
	`ff_—m_funcæ
("potentials/niu3.eam")

2021 
m‘hod_1
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

2022 
m‘hod_1
.
ml_Çme
="ff_eam_setfl_sc";

2023 
m‘hod_1
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

2024 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

2026 
AtomsDMD
::
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<AtomsDMD::Objeù*>(
£lf
);

2027 
FuncAPI
<
¡d
::
¡ršg
,
ty³0
*,ty³0*,¡d::¡ršg*> 
	`f
("ff_eam_setfl_sc",{"setfl_file","r_crd","C","elems"});

2028 
f
.
nİtiÚ®s
=1;

2029 
f
.
logics
<1>()[0]=
	`VLogics
("gt",0.0);

2030 
f
.
logics
<2>()[0]=
	`VLogics
("gt",0.0);

2032 cÚ¡ 
¡d
::
¡ršg
* 
Çmes
=
__£lf
->
©oms
->
–em’ts
.names;

2033 cÚ¡ 
size_t
 
ÃËms
=
__£lf
->
©oms
->
–em’ts
.nelems;

2034 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

2035 if(
f
.
»m­
<3,2,1>("–em’t ´e£Á iÀsy¡em",
Çmes
,
ÃËms
)è 
NULL
;

2038 
size_t
 
Ä
,
Äho
;

2039 
ty³0
 
dr
,
drho
;

2040 
ty³0
** 
r_c
;

2041 
	`ty³0
(** 
F
)[5]=
NULL
;

2042 
	`ty³0
(*** 
r_phi
)[4]=
NULL
;

2043 
	`ty³0
(*** 
rho
)[4]=
NULL
;

2044 
Œy


2046 
ImpÜtEAM
::
	`£tæ
(
ÃËms
,
__£lf
->
©oms
->
–em’ts
.
Çmes
,
f
.
v®
<0>(),
dr
,
drho
,
Ä
,
Äho
,
r_phi
,
rho
,
F
,
r_c
);

2048 
	`ÿtch
(* 
”r_msg
)

2050 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,
”r_msg
);

2051 
d–‘e
 [] 
”r_msg
;

2052  
NULL
;

2055 
size_t
 
i
=0;i<
ÃËms
;i++)

2056 if(
f
.
v
<1>()[
i
]>
r_c
[i][i])

2058 
MemÜy
::
	`d—Îoc
(
r_c
);

2059 
MemÜy
::
	`d—Îoc
(
F
);

2060 
MemÜy
::
	`d—Îoc
(
r_phi
);

2061 
MemÜy
::
	`d—Îoc
(
rho
);

2062 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"r_üd[%zu] should bËs thª„_c[%zu][%zu]",
i
,i,i);

2063  
NULL
;

2066 
d–‘e
 
__£lf
->
ff
;

2067 
__£lf
->
ff
=
Ãw
 
	`FÜûF›ldEAMDMDSC
(__£lf->
©oms
,
dr
,
drho
,
Ä
,
Äho
,
¡d
::
	`move
(
r_phi
),¡d::move(
rho
),¡d::move(
F
),¡d::move(
r_c
),
f
.
mov
<1>(),f.mov<2>());

2068 
Py_RETURN_NONE
;

2070 
m‘hod_1
.
ml_doc
=(*)
R
"---(

2071 
	`ff_—m_£tæ
(
£tæ_fe
,
r_üd
,
C
,
–ems
=
NÚe
)

2073 
TabuÏ‹d
 
EAM
 
fÜû
 
f›ld
 
giv’
 
by
 
a
 
sšgË
 
S‘FL
 
fe


2075 
Assigns
 
EAM
 
fÜû
 
f›ld
 
to
 
sy¡em


2077 
P¬am‘”s


2079 
£tæ_fe
 : 
¡ršg


2080 
»Ïtive
 
·th
 
to
 
DYNAMO
 
fe
 
w™h
 
S‘FL
 
fÜm©


2081 
r_üd
 : [
ÃËms
]

2082 
cutoff
 
¿dius
 
mass
 
exchªge


2083 
C
 : [
ÃËms
]

2084 
dim’siÚËss
 
çùÜ
 
—ch
 
–em’t
, 
£e
 :
»f
:`
h”e
 <
ma¡”
-ref>`

2085 
–ems
 : 
¡ršg
[
ÃËms
]

2086 
m­pšg
 
–em’ts


2088 
R‘uºs


2090 
NÚe


2092 
NÙes


2094 
This
 
is
 
buÏ‹d
 
fÜm
 
of
 
Embedded
 
Atom
 
	`M‘hod
 (
EAM
è
pÙ’tŸl


2097 
Exam¶es


2099 
Cu


2103 >>> 
äom
 
m­p
 
impÜt
 
dmd


2104 >>> 
sim
=
dmd
.
	`cfg
(5,"configs/Cu-DMD.cfg")

2105 >>> 
sim
.
	`ff_—m_£tæ
("potentials/Cu_mishin.eam.alloy")

2111 
m‘hod_2
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

2112 
m‘hod_2
.
ml_Çme
="ff_eam_fs_sc";

2113 
m‘hod_2
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

2114 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

2116 
AtomsDMD
::
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<AtomsDMD::Objeù*>(
£lf
);

2117 
FuncAPI
<
¡d
::
¡ršg
,
ty³0
*,ty³0*,¡d::¡ršg*> 
	`f
("ff_eam_fs_sc",{"fs_file","r_crd","C","elems"});

2118 
f
.
nİtiÚ®s
=1;

2119 
f
.
logics
<1>()[0]=
	`VLogics
("gt",0.0);

2120 
f
.
logics
<2>()[0]=
	`VLogics
("gt",0.0);

2122 cÚ¡ 
¡d
::
¡ršg
* 
Çmes
=
__£lf
->
©oms
->
–em’ts
.names;

2123 cÚ¡ 
size_t
 
ÃËms
=
__£lf
->
©oms
->
–em’ts
.nelems;

2124 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

2125 if(
f
.
»m­
<3,2,1>("–em’t ´e£Á iÀsy¡em",
Çmes
,
ÃËms
)è 
NULL
;

2127 
size_t
 
Ä
,
Äho
;

2128 
ty³0
 
dr
,
drho
;

2129 
ty³0
** 
r_c
;

2130 
	`ty³0
(** 
F
)[5]=
NULL
;

2131 
	`ty³0
(*** 
r_phi
)[4]=
NULL
;

2132 
	`ty³0
(*** 
rho
)[4]=
NULL
;

2133 
Œy


2135 
ImpÜtEAM
::
	`fs
(
ÃËms
,
__£lf
->
©oms
->
–em’ts
.
Çmes
,
f
.
v®
<0>(),
dr
,
drho
,
Ä
,
Äho
,
r_phi
,
rho
,
F
,
r_c
);

2137 
	`ÿtch
(* 
”r_msg
)

2139 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,
”r_msg
);

2140 
d–‘e
 [] 
”r_msg
;

2141  
NULL
;

2144 
size_t
 
i
=0;i<
ÃËms
;i++)

2145 if(
f
.
v
<1>()[
i
]>
r_c
[i][i])

2147 
MemÜy
::
	`d—Îoc
(
r_c
);

2148 
MemÜy
::
	`d—Îoc
(
F
);

2149 
MemÜy
::
	`d—Îoc
(
r_phi
);

2150 
MemÜy
::
	`d—Îoc
(
rho
);

2151 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"r_üd[%zu] should bËs thª„_c[%zu][%zu]",
i
,i,i);

2152  
NULL
;

2155 
d–‘e
 
__£lf
->
ff
;

2156 
__£lf
->
ff
=
Ãw
 
	`FÜûF›ldEAMDMDSC
(__£lf->
©oms
,
dr
,
drho
,
Ä
,
Äho
,
¡d
::
	`move
(
r_phi
),¡d::move(
rho
),¡d::move(
F
),¡d::move(
r_c
),
f
.
mov
<1>(),f.mov<2>());

2157 
Py_RETURN_NONE
;

2159 
m‘hod_2
.
ml_doc
=(*)
R
"---(

2160 
	`ff_—m_fs
(
fs_fe
,
r_üd
,
C
,
–ems
=
NÚe
)

2162 
TabuÏ‹d
 
Fšnis
-
Sšşaœ
 
EAM


2164 
Assigns
 
Fšnis
-
Sšşaœ
 
EAM
 
fÜû
 
f›ld
 
to
 
sy¡em
. 
FÜ
 
ex¶ª©iÚ
 
of
 
the
 
·¿m‘”
 
£e
h
NÙes
 
£ùiÚ
.

2166 
P¬am‘”s


2168 
fs_fe
 : 
¡ršg


2169 
»Ïtive
 
·th
 
to
 
DYNAMO
 
fe
 
w™h
 
fs
 
fÜm©


2170 
r_üd
 : [
ÃËms
]

2171 
cutoff
 
¿dius
 
mass
 
exchªge


2172 
C
 : [
ÃËms
]

2173 
dim’siÚËss
 
çùÜ
 
—ch
 
–em’t
, 
£e
 :
»f
:`
h”e
 <
ma¡”
-ref>`

2174 
–ems
 : 
¡ršg
[
ÃËms
]

2175 
m­pšg
 
–em’ts


2177 
R‘uºs


2179 
NÚe


2181 
NÙes


2183 
This
 
is
 
buÏ‹d
 
fÜm
 
of
 
Fšnis
-
Sšşaœ
 
Embedded
 
Atom
 
	`M‘hod
 (
EAM
è
pÙ’tŸl


2185 
CÚsid”
 
the
 
g’”®
 
fÜm
 
of
 
EAM
 
pÙ’tŸl
:

2188 .. 
m©h
:: 
U
=\
äac
{1}{2}\
sum_
{
i
}\sum_{
j
\
Ãq
 i}\
phi_
{\
gamma
 \
d–
}{(
x_
{
ij
}è}+\
sum_i
 
E_
\gamm¨\
	`Ëá
(\sum_{j\Ãq i} \
rho_
{\d–\gamma}(x_{ij}è\
right
),

2191 
From
 
h”e
 
Ú
, 
g»ek
 
su³rscts
/
subsüts
 
¬e
 
u£d
 
to
 
»ãr
Ø
–em’ts
 
´e£Á
 
the
 
sy¡em
; :
m©h
:`\
gamma
`, 
ªd
 :m©h:`\
d–
` 
d’Ùe
 
ty³
 
of
 
©om
 :m©h:`
i
`‡nd‡tom :m©h:`
j
`, 
»³ùiv–y
. :m©h:`
E
`, :m©h:`\
rho
`,‡nd :m©h:`\
phi
`‡» 
embeddšg
, 
–eùrÚ
 
d’s™y
,‡nd 
·œ
 
funùiÚs
, 
»¥eùiv–y
. 
Also
 :m©h:`
x_
{
ij
}` 
»ãrs
Ø
di¡ªû
 
b‘w“n
 :m©h:`i`‡nd :m©h:`j`. 
Now
h
muÉi
 
compÚ’t
 
fÜmuÏtiÚ
 oà
DMD
 
ä“
 
’”gy
 
would
 
be
:

2193 .. 
m©h
::

2194 
F
=&\
äac
{1}{2}\
sum_
{
i
,\
gamma
,
j
\
Ãq
 i,\
d–
}
c_i
^\gamm¨
c_j
^\d– \
omega_
{\gamm¨\d–}\
	`Ëá
(
x_
{
ij
}\
right
)+\sum_{i,\gamma} c_i^\gamm¨
E_
\gamm¨\Ëá(\sum_{j\Ãq i,\d–} c_j^{\d–}\
psi_
{\d–\gamma}\Ëá(x_{ij}\right)\right)-3
k_BT
\sum_{i,\gamma} c_i^\gamm¨\
log
\Ëá(\
sq¹
{\
pi
 
e
}\
®pha_i
^\gamma/\
Lambda_
\gamma\right)\\

2195 &+
k_BT
\
sum_
{
i
,\
gamma
} 
c_i
^\gamma\
log
 c_i^\gamma+k_BT\sum_{i}c_i^
v
\
	`log
 (c_i^v),

2197 
wh”e


2199 .. 
m©h
:: \
Lambda_
\
gamma
=\
äac
{
h
}{\
sq¹
{2\
pi
 
m_
\gamm¨
k_BT
}}, \
quad
 
c_i
^
v
=1-\
sum_
{\gamma}c_i^\gamma,

2201 .. 
m©h
:: \
omega_
{\
gamma
\
d–
}(
x_
{
ij
})ğ\
äac
{1}{\
	`Ëá
(\
®pha
^{\gamma\d–}
_
{ij}\
sq¹
{\
pi
}\
right
)^{3}}\
d
^3\
m©hbf
{
x
} \
exp
{\
biggl
[-\Ëá(\äac{\m©hbf{x}_{ij} -\m©hbf{x}}{\®pha^{\gamma\d–}_{ij}}\right)^2\
biggr
]}\
phi_
{\gamma\delta}(|\mathbf{x}|)

2203 .. 
m©h
:: \
psi_
{\
gamma
\
d–
}(
x_
{
ij
})=\
äac
{1}{\
	`Ëá
(\
®pha
^{\gamma\d–}
_
{ij}\
sq¹
{\
pi
}\
right
)^{3}}\
d
^3\
m©hbf
{
x
} \
exp
{\
biggl
[-\Ëá(\äac{\m©hbf{x}_{ij} -\m©hbf{x}}{\®pha^{\gamma\d–}_{ij}}\right)^2\
biggr
]}\
rho_
{\gamma\delta}(|\mathbf{x}|)

2205 .. 
m©h
:: \
®pha
^{\
gamma
\
d–
}
_
{
ij
}=\
sq¹
{{\
®pha_i
^{\gamma}}^2+{\
®pha_j
^{\d–}}^2},\
quad
 \
m©hbf
{
x
}_{
ji
}=\m©hbf{x}
_j
-\m©hbf{x}
_i


2207 
The
 
num”iÿl
 
ev®u©iÚ
 
of
 
the£
 
š‹g¿ls
 
is
 
discus£d
 :
»f
:`
h”e
 <
š‹g
-ref>`.

2211 
ReÿÎšg
 
th©


2213 .. 
m©h
:: \
ÏngË
 
U
 \
¿ngË
 &ğ\
äac
{\
·¹Ÿl
 }{\·¹ŸÈ\
b‘a
}\
	`Ëá
(\b‘¨
F
 \
right
)

2215 
the
 
av”age
 
pÙ’tŸl
 
’”gy
 
is


2218 .. 
m©h
:: \
ÏngË
 
U
 \
¿ngË
 = \
äac
{1}{2}\
sum_
{
i
,\
gamma
,
j
\
Ãq
 i,\
d–
}
c_i
^\gamm¨
c_j
^\d– \
omega_
{\gamm¨\d–}\
	`Ëá
(
x_
{
ij
}\
right
)+\sum_{i,\gamma} c_i^\gamm¨
E_
\gamm¨\Ëá(\sum_{j\Ãq i,\d–} c_j^{\d–}\
psi_
{\d–\gamma}\Ëá(x_{ij}\right)\rightè-\äac{3}{2} 
k_B
 
T


2221 
Exam¶es


2223 
IrÚ
 
Hydrogº
 
mixtu»


2225 >>> 
äom
 
m­p
 
impÜt
 
dmd


2226 >>> 
sim
=
dmd
.
	`cfg
(5,"configs/FeH-DMD.cfg")

2227 >>> 
sim
.
	`ff_—m_fs
("potentials/FeH.eam.fs")

2229 
	}
}

	@ff_eam_dmd_sc.h

1 #iâdeà
__MAPP__ff_—m_dmd_sc__


2 
	#__MAPP__ff_—m_dmd_sc__


	)

3 
	~"ff_dmd.h
"

4 
Çme¥aû
 
	gMAPP_NS


6 
	g‹m¶©e
<
	gşass
> 
şass
 
	gDMDVec
;

7 şas 
	cFÜûF›ldEAMDMDSC
 : 
public
 
FÜûF›ldDMD


9 
´iv©e
:

10 
size_t
 
Ä
,
	gÄho
;

11 
ty³0
 
	gdr
,
	gdrho
,
	gdr_šv
,
	gdrho_šv
,
	grho_max
;

12 
ty³0
(** 
F_¬r
)[5];

13 
ty³0
(*** 
r_phi_¬r
)[4];

14 
ty³0
(*** 
r_rho_¬r
)[4];

18 
	gVec
<
	gty³0
>* 
	gE_±r
;

19 
	gVec
<
	gty³0
>* 
	gdE_±r
;

20 
	gVec
<
	gty³0
>* 
	grho_±r
;

21 
	gVec
<
	gty³0
>* 
	gcv_±r
;

22 
	gVec
<
	gty³0
>* 
	gp_±r
;

23 
	gVec
<
	gty³0
>* 
	gc_tde_±r
;

25 
	gVec
<
	gty³0
>* 
	gvec0
;

26 
	gVec
<
	gty³0
>* 
	gvec1
;

27 
	gVec
<
	gty³0
>* 
	gvec2
;

28 
	gVec
<
	gty³0
>* 
	gvec3
;

29 
	gVec
<
	gty³0
>* 
	gfcÛf_±r
;

33 
ty³0
 
	gkbT
,
	gb‘a
;

34 
ty³0
* 
	gc_0
;

35 
ty³0
* 
	gc_1
;

36 
ty³0
* 
	gz‘a
;

39 
ty³0
* 
	grho_phi
;

40 
ty³0
* 
	gdrho_phi_dr
;

41 
ty³0
* 
	gdrho_phi_d®pha
;

42 
ty³0
* 
	gB_·œ
;

43 * 
	gNN
;

44 
size_t
 
	gmax_·œs
;

48 
ty³0
* 
	gxi
;

49 
ty³0
* 
	gwi_0
;

50 
ty³0
* 
	gwi_1
;

51 cÚ¡ 
	gN
;

55 
ty³0
 
ÿlc_’t
(type0);

56 
£t_‹mp
();

59 
ÿlc_·œ
(
ty³0
,type0*,type0*,type0*&,type0*&,type0*&);

62 
ÿlc_Q
(
ty³0
&,type0&,type0&,type0&,type0&);

63 
ÿlc_Q
(
ty³0
&,type0&,type0&,type0&,type0&,type0&);

66 
sc_loİ
();

67 
sc_loİ_v¬
();

68 
sc_loİ__
();

69 
sc_loİ___
();

70 
sc_loİ____
();

71 
sc_loİ_şu¡”
();

72 
sc_loİ__Z6_2nd
();

75 
	g´Ùeùed
:

76 
__fÜû_ÿlc
();

77 
__’”gy_ÿlc
();

78 
__fÜû_ÿlc_¡©ic
(){};

79 
__c_d_ÿlc
(){};

80 
__J
(
Vec
<
ty³0
>*,Vec<type0>*){};

81 
__´•J_n_»s
(
Vec
<
ty³0
>*,Vec<type0>*);

82 
__J
(
Vec
<
ty³0
>*,Vec<type0>*,Vec<type0>*,Vec<type0>*);

83 
	gpublic
:

85 
š™_¡©ic
(){};

86 
fš_¡©ic
(){};

87 
FÜûF›ldEAMDMDSC
(
şass
 
AtomsDMD
*,

88 
ty³0
,ty³0,
size_t
,size_t,

89 
ty³0
(***&&)[4],type0(***&&)[4],type0(**&&)[5],

90 
ty³0
**&&,type0*&&,type0*&&);

92 ~
FÜûF›ldEAMDMDSC
();

93 
š™
();

94 
fš
();

99 
ty³0
* 
ave_mu
(){ 
	gNULL
;};

100 
ml_Ãw
(
PyM‘hodDef
&,PyMethodDef&,PyMethodDef&);

	@ff_eam_dmd_scc.cpp

1 
	~"ff_—m_dmd_scc.h
"

2 
	~<¡dlib.h
>

3 
	~"ÃighbÜ_dmd_sc.h
"

4 
	~"–em’ts.h
"

5 
	~"memÜy.h
"

6 
	~"xm©h.h
"

7 
	~"©oms_dmd.h
"

8 
	~"MAPP.h
"

9 
	~"dyÇmic_dmd.h
"

10 
	~"impÜt_—m.h
"

11 
	~<lim™s
>

12 
	#PI_IN_SQ
 0.564189583547756286948079451561

	)

13 
	#TOL
 1.0e-8

	)

14 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

15 
	#ROUND
(
rsq
,
dr_sq
è
¡©ic_ÿ¡
<>(
	`æoÜ
Ôsq/dr_sq+0.5))

	)

16 #ifdeà
SC_DMD


20 
	gFÜûF›ldEAMDMDSCC
::

21 
FÜûF›ldEAMDMDSCC
(
AtomsDMD
* 
©oms
,

22 
ty³0
 
__dr
,ty³0 
__drho
,
size_t
 
__Ä
,size_ˆ
__Äho
,

23 
ty³0
(***&& 
__r_phi_¬r
)[4],ty³0(***&& 
__rho_¬r
)[4],ty³0(**&& 
__F_¬r
)[5],

24 
ty³0
**&& 
__cut
,ty³0*&& 
__r_üd
,ty³0*&& 
__z‘a
):

25 
FÜûF›ldDMD
(
©oms
),

26 
dr
(
__dr
),

27 
drho
(
__drho
),

28 
Ä
(
__Ä
),

29 
Äho
(
__Äho
),

30 
r_phi_¬r
(
__r_phi_¬r
),

31 
r_rho_¬r
(
__rho_¬r
),

32 
F_¬r
(
__F_¬r
),

33 
rho_phi
(
NULL
),

34 
drho_phi_dr
(
NULL
),

35 
drho_phi_d®pha
(
NULL
),

36 
B_·œ
(
NULL
),

37 
max_·œs
(0),

38 
vec0
(
NULL
),

39 
vec1
(
NULL
),

40 
vec2
(
NULL
),

41 
vec3
(
NULL
),

42 
dE_±r
(
NULL
),

43 
rho_±r
(
NULL
),

44 
cv_±r
(
NULL
),

45 
N
(
©oms
->N)

48 
	g__r_phi_¬r
=
NULL
;

49 
	g__rho_¬r
=
NULL
;

50 
	g__F_¬r
=
NULL
;

52 
	gdr_šv
=1.0/
dr
;

53 
	gdrho_šv
=1.0/
drho
;

54 
	grho_max
=
¡©ic_ÿ¡
<
ty³0
>(
Äho
)*
drho
;

56 
	gkbT
=
b‘a
=-1.0;

60 
	gMemÜy
::
®loc
(
xi
,
N
);

61 
	gMemÜy
::
®loc
(
wi_0
,
N
);

62 
	gMemÜy
::
®loc
(
wi_1
,
N
);

63 
	gMemÜy
::
®loc
(
z‘a
,
ÃËms
);

64 
	gMemÜy
::
®loc
(
c_0
,
ÃËms
);

65 
	gMemÜy
::
®loc
(
c_1
,
ÃËms
);

67 
memıy
(
xi
,
©oms
->xi,
N
*(
ty³0
));

68 
memıy
(
wi_0
,
©oms
->
wi
,
N
*(
ty³0
));

69 
	gi
=0;i<
	gN
;i++)

70 
	gwi_1
[
i
]=
wi_0
[i]*
xi
[i];

73 
–em_ty³
 
	g–em_i
=0;–em_i<
	gÃËms
;elem_i++)

75 
	gr_üd
[
–em_i
]=
__r_üd
[elem_i];

76 
	gz‘a
[
–em_i
]=
__z‘a
[elem_i];

78 
	gMemÜy
::
d—Îoc
(
__r_üd
);

79 
	gMemÜy
::
d—Îoc
(
__z‘a
);

81 
–em_ty³
 
	g–em_i
=0;–em_i<
	gÃËms
;elem_i++)

83 
size_t
 
	gi
=0;i<
	gÄ
;i++)

84 
	gr_rho_¬r
[
–em_i
][0][
i
][0]*=
¡©ic_ÿ¡
<
ty³0
>(i)*
dr
;

85 
	gImpÜtEAM
::
š‹½Ş©e
(
Ä
,
dr
,
r_rho_¬r
[
–em_i
][0]);

86 
–em_ty³
 
	g–em_j
=1;–em_j<
	gÃËms
;elem_j++)

88 if(
	gr_rho_¬r
[
–em_i
][
–em_j
]!=
r_rho_¬r
[elem_i][elem_j-1])

90 
size_t
 
i
=0;
	gi
<
	gÄ
;i++)

91 
	gr_rho_¬r
[
–em_i
][
–em_j
][
i
][0]*=
¡©ic_ÿ¡
<
ty³0
>(i)*
dr
;

92 
	gImpÜtEAM
::
š‹½Ş©e
(
Ä
,
dr
,
r_rho_¬r
[
–em_i
][
–em_j
]);

98 
ty³0
 
	gtmp
;

99 
size_t
 
	gi
=0;i<
	gÃËms
;i++)

100 
size_t
 
	gj
=0;j<
	gi
+1;j++)

102 
	gcut
[
i
][
j
]=
cut
[j][i]=
__cut
[i][j];

103 
	gtmp
=
__cut
[
i
][
j
];

104 
	gcut_sq
[
i
][
j
]=
cut_sq
[j][i]=
tmp
*tmp;

106 
	gMemÜy
::
d—Îoc
(
__cut
);

108 
d–‘e
 
	gÃighbÜ
;

109 
	gÃighbÜ
=
Ãw
 
NeighbÜDMDSC
(
©oms
,
cut_sk
,
rsq_üd
);

114 
	gFÜûF›ldEAMDMDSCC
::~
	$FÜûF›ldEAMDMDSCC
()

116 
MemÜy
::
	`d—Îoc
(
F_¬r
);

117 
MemÜy
::
	`d—Îoc
(
r_rho_¬r
);

118 
MemÜy
::
	`d—Îoc
(
r_phi_¬r
);

120 
MemÜy
::
	`d—Îoc
(
z‘a
);

121 
MemÜy
::
	`d—Îoc
(
c_1
);

122 
MemÜy
::
	`d—Îoc
(
c_0
);

123 
MemÜy
::
	`d—Îoc
(
wi_1
);

124 
MemÜy
::
	`d—Îoc
(
wi_0
);

125 
MemÜy
::
	`d—Îoc
(
xi
);

127 
	}
}

131 
	gFÜûF›ldEAMDMDSCC
::
	$ÿlc_·œ
(
ty³0
 
r
,ty³0* 
®pha_i
,ty³0* 
®pha_j
,ty³0*& 
__rho_phi
,type0*&,type0*&)

132 {
	}
}

136 
	gFÜûF›ldEAMDMDSCC
::
	$fÜû_ÿlc
()

138 if(
max_·œs
<
ÃighbÜ
->
no_·œs
)

140 
d–‘e
 [] 
rho_phi
;

141 
d–‘e
 [] 
drho_phi_dr
;

142 
d–‘e
 [] 
drho_phi_d®pha
;

144 
max_·œs
=
ÃighbÜ
->
no_·œs
;

145 
size_t
 
no_0
=3*
max_·œs
*
c_dim
*c_dim;

146 
MemÜy
::
	`®loc
(
rho_phi
,
no_0
);

147 
MemÜy
::
	`®loc
(
drho_phi_dr
,
no_0
);

148 
MemÜy
::
	`®loc
(
drho_phi_d®pha
,
no_0
);

149 
MemÜy
::
	`®loc
(
B_·œ
,
c_dim
*c_dim*
max_·œs
);

152 
i
=0;i<
max_·œs
*
c_dim
*c_dim*3;i++è
rho_phi
[i]=
drho_phi_dr
[i]=
drho_phi_d®pha
[i]=0.0;

153 
i
=0;i<
max_·œs
*
c_dim
*c_dim;i++è
B_·œ
[i]=0.0;

159 
ty³0
 
r
,
r_šv
;

160 
size_t
 
m
;

161 
ty³0
* 
cÛf
;

162 
ty³0
 
tmp0
,
tmp1
;

163 
ty³0
 
p
,
cv_i
;

165 
ty³0
 cÚ¡* 
c
=
©oms
->c->
	`begš
();

169 
ty³0
* 
dE
=
dE_±r
->
	`begš
();

170 
ty³0
* 
rho
=
rho_±r
->
	`begš
();

171 
i
=0;i<
©oms
->
Çtms_lş
*
c_dim
;i++è
rho
[i]=0.0;

173 
ty³0
 
®pha_ij_sq
,
®pha_ij
,
rsq
;

177 cÚ¡ 
ty³0
* 
x
=
©oms
->x->
	`begš
();

178 cÚ¡ 
ty³0
* 
®pha
=
©oms
->®pha->
	`begš
();

179 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->neighbor_list;

180 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->neighbor_list_size;

181 
Çtms_lş
=
©oms
->natms_lcl;

182 
ty³0
 
’t_lş
=0.0,
vib_lş
=0.0;

183 
size_t
 
i¡¬t
=0,
ii¡¬t
;

184 
i
=0;i<
Çtms_lş
;i++)

186 cÚ¡ 
Ãigh_sz
=
ÃighbÜ_li¡_size
[
i
];

187 
j
,
__j
=0;__j<
Ãigh_sz
;__j++)

189 
j
=
ÃighbÜ_li¡
[
i
][
__j
];

190 
rsq
=
Algeb¿
::
RSQ
<
__dim__
>(
x
+
i
*__dim__,x+
j
*__dim__);

191 
r
=
	`sq¹
(
rsq
);

193 
ic
=0;ic<
c_dim
;ic++)

194 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3)

196 
®pha_ij_sq
=
®pha
[
i
*
c_dim
+
ic
]*®pha[i*c_dim+ic]+®pha[
j
*c_dim+
jc
]*alpha[j*c_dim+jc];

197 
®pha_ij
=
	`sq¹
(
®pha_ij_sq
);

198 if(
r
-
®pha_ij
*
xi
[
N
-1]>=
cut
[
ic
][
jc
]) ;

200 
ty³0
 
uµ”
=(
r
+
cut
[
ic
][
jc
])/
®pha_ij
;

201 
ty³0
 
low”
=(
r
-
cut
[
ic
][
jc
])/
®pha_ij
;

202 
ty³0
 
__r
,
p
,
tmp0
,
xi2
;

203 
ty³0
* 
cÛf
;

206 
ty³0
 
H
[3][3]{
	`DESIG2
(3,3,0.0)};

207 
l
=0;l<
N
;l++)

209 if(
xi
[
l
]<=
low”
 && xi[l]>=
uµ”
) ;

211 
xi2
=
xi
[
l
]*xi[l];

213 
__r
=
r
-
xi
[
l
]*
®pha_ij
;

214 
p
=
	`çbs
(
__r
)*
dr_šv
;

215 
m
=
¡©ic_ÿ¡
<
size_t
>(
p
);

216 
m
=
	`MIN
(m,
Ä
-2);

217 
p
-=
m
;

218 
p
=
	`MIN
(p,1.0);

220 
cÛf
=
r_phi_¬r
[
ic
][
jc
][
m
];

221 
tmp0
=((
cÛf
[3]*
p
+coef[2])*p+coef[1])*p+coef[0];

222 if(
__r
<0.0è
tmp0
*=-1.0;

223 
tmp0
*=
wi_0
[
l
];

224 
H
[0][0]+=
tmp0
;

225 
H
[0][1]+=
tmp0
*
xi
[
l
];

226 
H
[0][2]+=
tmp0
*
xi2
;

229 
cÛf
=
r_rho_¬r
[
ic
][
jc
][
m
];

230 
tmp0
=((
cÛf
[3]*
p
+coef[2])*p+coef[1])*p+coef[0];

231 if(
__r
<0.0è
tmp0
*=-1.0;

232 
tmp0
*=
wi_0
[
l
];

233 
H
[1][0]+=
tmp0
;

234 
H
[1][1]+=
tmp0
*
xi
[
l
];

235 
H
[1][2]+=
tmp0
*
xi2
;

237 
cÛf
=
r_rho_¬r
[
jc
][
ic
][
m
];

238 
tmp0
=((
cÛf
[3]*
p
+coef[2])*p+coef[1])*p+coef[0];

239 if(
__r
<0.0è
tmp0
*=-1.0;

240 
tmp0
*=
wi_0
[
l
];

241 
H
[2][0]+=
tmp0
;

242 
H
[2][1]+=
tmp0
*
xi
[
l
];

243 
H
[2][2]+=
tmp0
*
xi2
;

246 
r_šv
=1.0/
r
;

247 
ty³0
 
r2_šv
=
r_šv
*r_inv;

248 
ty³0
 
®pha_šv
=1.0/
®pha_ij
;

249 
ty³0
 
®pha2_šv
=
®pha_šv
*alpha_inv;

250 
ty³0
 
®pha4_šv
=
®pha2_šv
*alpha2_inv;

251 
ty³0
 
r2®pha2_šv
=
r2_šv
*
®pha2_šv
;

254 
Algeb¿
::
Do
<3>::
	`func
([&
i¡¬t
,&
H
,&
r_šv
,&
r2_šv
,&
®pha2_šv
,&
r2®pha2_šv
,&
®pha_ij_sq
,&
®pha_šv
,&
rsq
,&
®pha4_šv
,
this
]

255 (
i
)

257 
rho_phi
[
i¡¬t
+
i
]=
PI_IN_SQ
*
r_šv
*
H
[i][0];

258 
drho_phi_dr
[
i¡¬t
+
i
]=-
r2_šv
*(
rho_phi
[i¡¬t+i]+2.0*
PI_IN_SQ
*
®pha_šv
*
H
[i][1]);

259 
drho_phi_d®pha
[
i¡¬t
+
i
]=-
®pha2_šv
*(
rho_phi
[i¡¬t+i]-2.0*
PI_IN_SQ
*
r_šv
*
H
[i][2]);

263 
rho
[
i
*
c_dim
+
ic
]+=
c
[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
+2];

265 if(
j
<
Çtms_lş
)

267 
rho
[
j
*
c_dim
+
jc
]+=
c
[
i
*c_dim+
ic
]*
rho_phi
[
i¡¬t
+1];

268 
__vec_lş
[0]+=
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
];

271 
__vec_lş
[0]+=0.5*
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
];

276 
cv_i
=1.0;

277 
ic
=0;ic<
c_dim
;ic++)

279 
p
=
rho
[
i
*
c_dim
+
ic
]*
drho_šv
;

280 
m
=
¡©ic_ÿ¡
<
size_t
>(
p
);

281 
m
=
	`MIN
(m,
Äho
-2);

282 
p
-=
m
;

283 
p
=
	`MIN
(p,1.0);

284 
cÛf
=
F_¬r
[
ic
][
m
];

286 
tmp0
=(((
cÛf
[4]*
p
+coef[3])*p+coef[2])*p+coef[1])*p+coef[0];

287 
tmp1
=(((4.0*
cÛf
[4]*
p
+3.0*cÛf[3])*p+2.0*cÛf[2])*p+cÛf[1])*
drho_šv
;

289 if(
rho
[
i
*
c_dim
+
ic
]>
rho_max
è
tmp0
+=
tmp1
*(rho[i*c_dim+ic]-rho_max);

291 
dE
[
i
*
c_dim
+
ic
]=
tmp1
;

292 
__vec_lş
[0]+=
c
[
i
*
c_dim
+
ic
]*
tmp0
;

295 
vib_lş
+=
c
[
i
*
c_dim
+
ic
]*(
c_0
[ic]-3.0*
kbT
*
	`log
(
®pha
[i*c_dim+ic]));

296 
’t_lş
+=
	`ÿlc_’t
(
c
[
i
*
c_dim
+
ic
]);

297 
cv_i
-=
c
[
i
*
c_dim
+
ic
];

300 
’t_lş
+=
	`ÿlc_’t
(
cv_i
);

303 
dyÇmic
->
	`upd©e
(
dE_±r
);

305 
	`sc_loİ
();

307 
__vec_lş
[1+
__nvoigt__
]+=
’t_lş
;

308 
__vec_lş
[0]+=
kbT
*
’t_lş
+
vib_lş
;

313 
ty³0
* 
fvec
=
f
->
	`begš
();

314 
ty³0
* 
f_®phavec
=
f_®pha
->
	`begš
();

315 
ty³0
 
dx_ij
[
__dim__
];

316 
ty³0
 
åaœ
,
­aœ
;

317 #ifdeà
SC_DMD


318 
ty³0
 
d–
=
©oms
->delta;

320 
i¡¬t
=
ii¡¬t
=0;

321 
i
=0;i<
Çtms_lş
;i++)

324 cÚ¡ 
Ãigh_sz
=
ÃighbÜ_li¡_size
[
i
];

325 
j
,
__j
=0;__j<
Ãigh_sz
;__j++)

327 
j
=
ÃighbÜ_li¡
[
i
][
__j
];

328 
Algeb¿
::
DX
<
__dim__
>(
x
+
i
*__dim__,x+
j
*__dim__,
dx_ij
);

330 
ty³0
 
·œ_çc
=1.0-
d–
*(
c
[
i
*
c_dim
]-c[
j
*c_dim])*(c[i*c_dim]-c[j*c_dim]);

333 
åaœ
=0.0;

335 if(
j
<
Çtms_lş
)

337 
ic
=0;ic<
c_dim
;ic++)

338 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

340 
åaœ
-=(
drho_phi_dr
[
i¡¬t
+2]*
dE
[
i
*
c_dim
+
ic
]+drho_phi_dr[i¡¬t+1]*dE[
j
*c_dim+
jc
]+drho_phi_dr[i¡¬t])*
c
[i*c_dim+ic]*c[j*c_dim+jc]*
·œ_çc
;

341 
­aœ
=-(
drho_phi_d®pha
[
i¡¬t
+2]*
dE
[
i
*
c_dim
+
ic
]+drho_phi_d®pha[i¡¬t+1]*dE[
j
*c_dim+
jc
]+drho_phi_d®pha[i¡¬t])*
c
[i*c_dim+ic]*c[j*c_dim+jc]*
·œ_çc
;

342 
f_®phavec
[
i
*
c_dim
+
ic
]+=
­aœ
*
®pha
[i*c_dim+ic];

343 
f_®phavec
[
j
*
c_dim
+
jc
]+=
­aœ
*
®pha
[j*c_dim+jc];

347 
Algeb¿
::
V_add_x_mul_V
<
__dim__
>(
åaœ
,
dx_ij
,
fvec
+
i
*__dim__);

348 
Algeb¿
::
V_add_x_mul_V
<
__dim__
>(-
åaœ
,
dx_ij
,
fvec
+
j
*__dim__);

352 
ic
=0;ic<
c_dim
;ic++)

353 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

355 
åaœ
-=(
drho_phi_dr
[
i¡¬t
+2]*
dE
[
i
*
c_dim
+
ic
]+drho_phi_dr[i¡¬t+1]*dE[
j
*c_dim+
jc
]+drho_phi_dr[i¡¬t])*
c
[i*c_dim+ic]*c[j*c_dim+jc]*
·œ_çc
;

356 
­aœ
=-(
drho_phi_d®pha
[
i¡¬t
+2]*
dE
[
i
*
c_dim
+
ic
]+drho_phi_d®pha[i¡¬t+1]*dE[
j
*c_dim+
jc
]+drho_phi_d®pha[i¡¬t])*
c
[i*c_dim+ic]*c[j*c_dim+jc]*
·œ_çc
;

357 
f_®phavec
[
i
*
c_dim
+
ic
]+=
­aœ
*
®pha
[i*c_dim+ic];

359 
Algeb¿
::
V_add_x_mul_V
<
__dim__
>(
åaœ
,
dx_ij
,
fvec
+
i
*__dim__);

360 
åaœ
*=0.5;

363 
Algeb¿
::
DyadicV
<
__dim__
>(-
åaœ
,
dx_ij
,&
__vec_lş
[1]);

367 
ic
=0;ic<
c_dim
;ic++)

368 
f_®phavec
[
i
*
c_dim
+
ic
]+=3.0*
kbT
*
c
[i*c_dim+ic]/
®pha
[i*c_dim+ic];

373 
	}
}

377 
	gFÜûF›ldEAMDMDSCC
::
	$’”gy_ÿlc
()

379 if(
max_·œs
<
ÃighbÜ
->
no_·œs
)

381 
d–‘e
 [] 
rho_phi
;

382 
d–‘e
 [] 
drho_phi_dr
;

383 
d–‘e
 [] 
drho_phi_d®pha
;

384 
d–‘e
 [] 
B_·œ
;

386 
max_·œs
=
ÃighbÜ
->
no_·œs
;

387 
size_t
 
no_0
=3*
max_·œs
*
c_dim
*c_dim;

388 
MemÜy
::
	`®loc
(
rho_phi
,
no_0
);

389 
MemÜy
::
	`®loc
(
drho_phi_dr
,
no_0
);

390 
MemÜy
::
	`®loc
(
drho_phi_d®pha
,
no_0
);

391 
MemÜy
::
	`®loc
(
B_·œ
,
c_dim
*c_dim*
max_·œs
);

394 
i
=0;i<
max_·œs
*
c_dim
*c_dim*3;i++è
rho_phi
[i]=
drho_phi_dr
[i]=
drho_phi_d®pha
[i]=0.0;

395 
i
=0;i<
max_·œs
*
c_dim
*c_dim;i++è
B_·œ
[i]=0.0;

401 
ty³0
 
r
,
r_šv
;

402 
size_t
 
m
;

403 
ty³0
* 
cÛf
;

404 
ty³0
 
tmp0
,
tmp1
;

405 
ty³0
 
p
,
cv_i
;

407 
ty³0
 cÚ¡* 
c
=
©oms
->c->
	`begš
();

411 
ty³0
* 
dE
=
dE_±r
->
	`begš
();

412 
ty³0
* 
rho
=
rho_±r
->
	`begš
();

413 
Çtms_lş
=
©oms
->natms_lcl;

414 
i
=0;i<
Çtms_lş
*
c_dim
;i++è
rho
[i]=0.0;

416 
ty³0
 
®pha_ij_sq
,
®pha_ij
,
rsq
;

420 cÚ¡ 
ty³0
* 
x
=
©oms
->x->
	`begš
();

421 cÚ¡ 
ty³0
* 
®pha
=
©oms
->®pha->
	`begš
();

422 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->neighbor_list;

423 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->neighbor_list_size;

425 
ty³0
 
’t_lş
=0.0,
vib_lş
=0.0;

426 
size_t
 
i¡¬t
=0;

427 
i
=0;i<
Çtms_lş
;i++)

429 cÚ¡ 
Ãigh_sz
=
ÃighbÜ_li¡_size
[
i
];

430 
j
,
__j
=0;__j<
Ãigh_sz
;__j++)

432 
j
=
ÃighbÜ_li¡
[
i
][
__j
];

433 
rsq
=
Algeb¿
::
RSQ
<
__dim__
>(
x
+
i
*__dim__,x+
j
*__dim__);

434 
r
=
	`sq¹
(
rsq
);

436 
ic
=0;ic<
c_dim
;ic++)

437 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3)

439 
®pha_ij_sq
=
®pha
[
i
*
c_dim
+
ic
]*®pha[i*c_dim+ic]+®pha[
j
*c_dim+
jc
]*alpha[j*c_dim+jc];

440 
®pha_ij
=
	`sq¹
(
®pha_ij_sq
);

441 if(
r
-
®pha_ij
*
xi
[
N
-1]>=
cut
[
ic
][
jc
]) ;

443 
ty³0
 
uµ”
=(
r
+
cut
[
ic
][
jc
])/
®pha_ij
;

444 
ty³0
 
low”
=(
r
-
cut
[
ic
][
jc
])/
®pha_ij
;

445 
ty³0
 
__r
,
p
,
tmp0
,
xi2
;

446 
ty³0
* 
cÛf
;

449 
ty³0
 
H
[3][1]{
	`DESIG2
(3,1,0.0)};

450 
l
=0;l<
N
;l++)

452 if(
xi
[
l
]<=
low”
 && xi[l]>=
uµ”
) ;

454 
xi2
=
xi
[
l
]*xi[l];

456 
__r
=
r
-
xi
[
l
]*
®pha_ij
;

457 
p
=
	`çbs
(
__r
)*
dr_šv
;

458 
m
=
¡©ic_ÿ¡
<
size_t
>(
p
);

459 
m
=
	`MIN
(m,
Ä
-2);

460 
p
-=
m
;

461 
p
=
	`MIN
(p,1.0);

463 
cÛf
=
r_phi_¬r
[
ic
][
jc
][
m
];

464 
tmp0
=((
cÛf
[3]*
p
+coef[2])*p+coef[1])*p+coef[0];

465 if(
__r
<0.0è
tmp0
*=-1.0;

466 
tmp0
*=
wi_0
[
l
];

467 
H
[0][0]+=
tmp0
;

471 
cÛf
=
r_rho_¬r
[
ic
][
jc
][
m
];

472 
tmp0
=((
cÛf
[3]*
p
+coef[2])*p+coef[1])*p+coef[0];

473 if(
__r
<0.0è
tmp0
*=-1.0;

474 
tmp0
*=
wi_0
[
l
];

475 
H
[1][0]+=
tmp0
;

478 
cÛf
=
r_rho_¬r
[
jc
][
ic
][
m
];

479 
tmp0
=((
cÛf
[3]*
p
+coef[2])*p+coef[1])*p+coef[0];

480 if(
__r
<0.0è
tmp0
*=-1.0;

481 
tmp0
*=
wi_0
[
l
];

482 
H
[2][0]+=
tmp0
;

486 
r_šv
=1.0/
r
;

490 
Algeb¿
::
Do
<3>::
	`func
([&
i¡¬t
,&
H
,&
r_šv
,
this
]

491 (
i
)

493 
rho_phi
[
i¡¬t
+
i
]=
PI_IN_SQ
*
r_šv
*
H
[i][0];

497 
rho
[
i
*
c_dim
+
ic
]+=
c
[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
+2];

499 if(
j
<
Çtms_lş
)

501 
rho
[
j
*
c_dim
+
jc
]+=
c
[
i
*c_dim+
ic
]*
rho_phi
[
i¡¬t
+1];

502 
__vec_lş
[0]+=
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
];

505 
__vec_lş
[0]+=0.5*
c
[
i
*
c_dim
+
ic
]*c[
j
*c_dim+
jc
]*
rho_phi
[
i¡¬t
];

510 
cv_i
=1.0;

511 
ic
=0;ic<
c_dim
;ic++)

513 
p
=
rho
[
i
*
c_dim
+
ic
]*
drho_šv
;

514 
m
=
¡©ic_ÿ¡
<
size_t
>(
p
);

515 
m
=
	`MIN
(m,
Äho
-2);

516 
p
-=
m
;

517 
p
=
	`MIN
(p,1.0);

518 
cÛf
=
F_¬r
[
ic
][
m
];

520 
tmp0
=(((
cÛf
[4]*
p
+coef[3])*p+coef[2])*p+coef[1])*p+coef[0];

521 
tmp1
=(((4.0*
cÛf
[4]*
p
+3.0*cÛf[3])*p+2.0*cÛf[2])*p+cÛf[1])*
drho_šv
;

523 if(
rho
[
i
*
c_dim
+
ic
]>
rho_max
è
tmp0
+=
tmp1
*(rho[i*c_dim+ic]-rho_max);

525 
dE
[
i
*
c_dim
+
ic
]=
tmp1
;

526 
__vec_lş
[0]+=
c
[
i
*
c_dim
+
ic
]*
tmp0
;

529 
vib_lş
+=
c
[
i
*
c_dim
+
ic
]*(
c_0
[ic]-3.0*
kbT
*
	`log
(
®pha
[i*c_dim+ic]));

530 
’t_lş
+=
	`ÿlc_’t
(
c
[
i
*
c_dim
+
ic
]);

531 
cv_i
-=
c
[
i
*
c_dim
+
ic
];

534 
’t_lş
+=
	`ÿlc_’t
(
cv_i
);

537 
dyÇmic
->
	`upd©e
(
dE_±r
);

539 
	`sc_loİ
();

541 
__vec_lş
[1+
__nvoigt__
]+=
’t_lş
;

542 
__vec_lş
[0]+=
kbT
*
’t_lş
+
vib_lş
;

545 
	}
}

549 
	gFÜûF›ldEAMDMDSCC
::
	$sc_loİ
()

553 
ty³0
* 
dE
=
dE_±r
->
	`begš
();

554 
ty³0
* 
rho
=
rho_±r
->
	`begš
();

556 
ty³0
* 
cÛf
;

557 
size_t
 
m
,
ii¡¬t
,
i¡¬t
;

559 
ty³0
 
p
,
tmp0
,
tmp1
;

560 
Çtms_lş
=
©oms
->natms_lcl;

561 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->neighbor_list;

562 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->neighbor_list_size;

563 
ty³0
 cÚ¡* 
c
=
©oms
->c->
	`begš
();

569 
i
=0;i<
Çtms_lş
*
c_dim
;i++è
rho
[i]=0.0;

571 
__vec_lş
[0]=__vec_lş[1+
__nvoigt__
]=0.0;

572 
i¡¬t
=0;

573 
ii¡¬t
=0;

574 #ifdeà
SC_DMD


575 
ty³0
 
d–
=
©oms
->delta;

578 
i
=0;i<
Çtms_lş
;i++)

581 cÚ¡ 
Ãigh_sz
=
ÃighbÜ_li¡_size
[
i
];

582 
j
,
__j
=0;__j<
Ãigh_sz
;__j++)

584 
j
=
ÃighbÜ_li¡
[
i
][
__j
];

585 
B_·œ
[
ii¡¬t
]=
c
[
i
*
c_dim
]*c[
j
*c_dim];

586 
B_·œ
[
ii¡¬t
+1]=
c
[
i
*
c_dim
]*c[
j
*c_dim+1];

587 
B_·œ
[
ii¡¬t
+2]=
c
[
i
*
c_dim
+1]*c[
j
*c_dim];

588 
B_·œ
[
ii¡¬t
+3]=
c
[
i
*
c_dim
+1]*c[
j
*c_dim+1];

590 
ty³0
 
dc_sq
=(
c
[
i
*
c_dim
]-c[
j
*c_dim])*(c[i*c_dim]-c[j*c_dim]);

591 if(
j
<
Çtms_lş
)

593 
ic
=0;ic<
c_dim
;ic++)

594 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

596 
__vec_lş
[0]+=(1.0-
d–
*
dc_sq
)*
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
];

597 if(
c
[
i
*
c_dim
+
ic
]>0.0)

598 
rho
[
i
*
c_dim
+
ic
]+=(1.0-
d–
*
dc_sq
)*
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
+2]/
c
[i*c_dim+ic];

599 if(
c
[
j
*
c_dim
+
jc
]>0.0)

600 
rho
[
j
*
c_dim
+
jc
]+=(1.0-
d–
*
dc_sq
)*
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
+1]/
c
[j*c_dim+jc];

607 
ic
=0;ic<
c_dim
;ic++)

608 
jc
=0;jc<
c_dim
;jc++,
i¡¬t
+=3,
ii¡¬t
++)

610 
__vec_lş
[0]+=0.5*(1.0-
d–
*
dc_sq
)*
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
];

611 if(
c
[
i
*
c_dim
+
ic
]>0.0)

612 
rho
[
i
*
c_dim
+
ic
]+=(1.0-
d–
*
dc_sq
)*
B_·œ
[
ii¡¬t
]*
rho_phi
[
i¡¬t
+2]/
c
[i*c_dim+ic];

676 
ic
=0;ic<
c_dim
;ic++)

679 
p
=
rho
[
i
*
c_dim
+
ic
]*
drho_šv
;

680 
m
=
¡©ic_ÿ¡
<
size_t
>(
p
);

681 
m
=
	`MIN
(m,
Äho
-2);

682 
p
-=
m
;

683 
p
=
	`MIN
(p,1.0);

684 
cÛf
=
F_¬r
[
ic
][
m
];

686 
tmp0
=(((
cÛf
[4]*
p
+coef[3])*p+coef[2])*p+coef[1])*p+coef[0];

687 
tmp1
=(((4.0*
cÛf
[4]*
p
+3.0*cÛf[3])*p+2.0*cÛf[2])*p+cÛf[1])*
drho_šv
;

689 if(
rho
[
i
*
c_dim
+
ic
]>
rho_max
è
tmp0
+=
tmp1
*(rho[i*c_dim+ic]-rho_max);

691 
dE
[
i
*
c_dim
+
ic
]=
tmp1
;

692 
__vec_lş
[0]+=
c
[
i
*
c_dim
+
ic
]*
tmp0
;

700 
dyÇmic
->
	`upd©e
(
dE_±r
);

707 
	}
}

711 
	gFÜûF›ldEAMDMDSCC
::
´•
(
Vec
<
ty³0
>*,Vec<type0>*)

716 
	gFÜûF›ldEAMDMDSCC
::
J
(
VecT’s
<
ty³0
,2>& 
Dx
,VecT’s<ty³0,2>& 
ADx
)

721 
	gFÜûF›ldEAMDMDSCC
::
	$š™
()

723 
	`´e_š™
();

724 
	`£t_‹mp
();

727 
cv_±r
=
Ãw
 
Vec
<
ty³0
>(
©oms
,1);

728 
E_±r
=
Ãw
 
Vec
<
ty³0
>(
©oms
,
c_dim
);

729 
dE_±r
=
Ãw
 
Vec
<
ty³0
>(
©oms
,
c_dim
);

730 
rho_±r
=
Ãw
 
Vec
<
ty³0
>(
©oms
,
c_dim
);

731 
	}
}

735 
	gFÜûF›ldEAMDMDSCC
::
	$fš
()

738 
MemÜy
::
	`d—Îoc
(
rho_phi
);

739 
MemÜy
::
	`d—Îoc
(
drho_phi_dr
);

740 
MemÜy
::
	`d—Îoc
(
drho_phi_d®pha
);

741 
MemÜy
::
	`d—Îoc
(
B_·œ
);

742 
max_·œs
=0;

744 
d–‘e
 
rho_±r
;

745 
d–‘e
 
dE_±r
;

746 
d–‘e
 
E_±r
;

747 
d–‘e
 
cv_±r
;

749 
dE_±r
=
rho_±r
=
cv_±r
=
vec0
=
vec1
=
vec2
=
vec3
=
NULL
;

750 
	`po¡_fš
();

751 
	}
}

755 
	gFÜûF›ldEAMDMDSCC
::
	$£t_‹mp
()

757 
ty³0
 
T
=
©oms
->
‹mp
;

758 
ty³0
 
kb
=
©oms
->
kB
;

759 
ty³0
 
hP
=
©oms
->hP;

760 
ty³0
 
mass
;

761 
ty³0
 
deb_l
;

763 
size_t
 
i
=0;i<
ÃËms
;i++)

765 
mass
=
©oms
->
–em’ts
.
mas£s
[
i
];

766 
c_1
[
i
]=
	`sq¹
(0.5*
kb
*
T
/
mass
)/
M_PI
;

767 
deb_l
=
hP
*hP/(2.0*
M_PI
*M_PI*
mass
*
kb
*
T
);

768 
c_0
[
i
]=1.5*
kb
*
T
*(
	`log
(
deb_l
)-1.0);

771 
kbT
=
kb
*
T
;

772 
b‘a
=1.0/
kbT
;

773 
	}
}

777 
šlše
 
ty³0
 
	gFÜûF›ldEAMDMDSCC
::
	$ÿlc_’t
(
ty³0
 
x
)

779 if(
x
==0.0)  0.0;

780  
x
*
	`log
(x);

781 
	}
}

785 
	gFÜûF›ldEAMDMDSCC
::
	$ml_Ãw
(
PyM‘hodDef
& 
m‘hod_0
,PyM‘hodDef& 
m‘hod_1
,PyM‘hodDef& 
m‘hod_2
)

787 
m‘hod_0
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

788 
m‘hod_0
.
ml_Çme
="ff_eam_funcfl_scc";

789 
m‘hod_0
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

790 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

792 
AtomsDMD
::
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<AtomsDMD::Objeù*>(
£lf
);

793 
FuncAPI
<
¡d
::
¡ršg
*,
ty³0
*,ty³0*,¡d::¡ršg*> 
	`f
("ff_eam_funcfl_scc",{"funcfl_files","r_crd","C","elems"});

794 
f
.
nİtiÚ®s
=1;

795 
f
.
logics
<1>()[0]=
	`VLogics
("gt",0.0);

796 
f
.
logics
<2>()[0]=
	`VLogics
("gt",0.0);

798 cÚ¡ 
¡d
::
¡ršg
* 
Çmes
=
__£lf
->
©oms
->
–em’ts
.names;

799 cÚ¡ 
size_t
 
ÃËms
=
__£lf
->
©oms
->
–em’ts
.nelems;

800 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

801 if(
f
.
»m­
<3,0,1,2>("–em’t ´e£Á iÀsy¡em",
Çmes
,
ÃËms
)è 
NULL
;

803 
size_t
 
Ä
,
Äho
;

804 
ty³0
 
dr
,
drho
;

805 
ty³0
** 
r_c
;

806 
	`ty³0
(** 
F
)[5]=
NULL
;

807 
	`ty³0
(*** 
r_phi
)[4]=
NULL
;

808 
	`ty³0
(*** 
rho
)[4]=
NULL
;

809 
Œy


811 
ImpÜtEAM
::
	`funcæ
(
ÃËms
,
f
.
v®
<0>(),
dr
,
drho
,
Ä
,
Äho
,
r_phi
,
rho
,
F
,
r_c
);

813 
	`ÿtch
(* 
”r_msg
)

815 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,
”r_msg
);

816 
d–‘e
 [] 
”r_msg
;

817  
NULL
;

820 
size_t
 
i
=0;i<
ÃËms
;i++)

821 if(
f
.
v
<1>()[
i
]>
r_c
[i][i])

823 
MemÜy
::
	`d—Îoc
(
r_c
);

824 
MemÜy
::
	`d—Îoc
(
F
);

825 
MemÜy
::
	`d—Îoc
(
r_phi
);

826 
MemÜy
::
	`d—Îoc
(
rho
);

827 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"r_üd[%zu] should bËs thª„_c[%zu][%zu]",
i
,i,i);

828  
NULL
;

831 
d–‘e
 
__£lf
->
ff
;

832 
__£lf
->
ff
=
Ãw
 
	`FÜûF›ldEAMDMDSCC
(__£lf->
©oms
,
dr
,
drho
,
Ä
,
Äho
,
¡d
::
	`move
(
r_phi
),¡d::move(
rho
),¡d::move(
F
),¡d::move(
r_c
),
f
.
mov
<1>(),f.mov<2>());

833 
Py_RETURN_NONE
;

835 
m‘hod_0
.
ml_doc
=(*)
R
"---(

836 
	`ff_—m_funcæ
(
funcæ_fes
,
r_üd
,
C
,
–ems
=
NÚe
)

838 
TabuÏ‹d
 
EAM
 
fÜû
 
f›ld
 
giv’
 
by
 
FuncFL
 
fe
/
s


840 
Assigns
 
EAM
 
fÜû
 
f›ld
 
to
 
sy¡em


842 
P¬am‘”s


844 
funcæ_fes
 : 
¡ršg
[
ÃËms
]

845 
li¡
 
of
 
»Ïtive
 
·ths
 
to
 
DYNAMO
 
fes
 
w™h
 
FuncFL
 
fÜm©


846 
r_üd
 : [
ÃËms
]

847 
cutoff
 
¿dius
 
mass
 
exchªge


848 
C
 : [
ÃËms
]

849 
dim’siÚËss
 
çùÜ
 
—ch
 
–em’t
, 
£e
 :
»f
:`
h”e
 <
ma¡”
-ref>`

850 
–ems
 : 
¡ršg
[
ÃËms
]

851 
m­pšg
 
–em’ts


853 
R‘uºs


855 
NÚe


857 
NÙes


859 
This
 
is
 
buÏ‹d
 
fÜm
 
of
 
Embedded
 
Atom
 
	`M‘hod
 (
EAM
è
pÙ’tŸl


862 
Exam¶es


864 
Ni


868 >>> 
äom
 
m­p
 
impÜt
 
dmd


869 >>> 
sim
=
dmd
.
	`cfg
(5,"configs/Ni-DMD.cfg")

870 >>> 
sim
.
	`ff_—m_funcæ
("potentials/niu3.eam")

876 
m‘hod_1
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

877 
m‘hod_1
.
ml_Çme
="ff_eam_setfl_scc";

878 
m‘hod_1
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

879 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

881 
AtomsDMD
::
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<AtomsDMD::Objeù*>(
£lf
);

882 
FuncAPI
<
¡d
::
¡ršg
,
ty³0
*,ty³0*,¡d::¡ršg*> 
	`f
("ff_eam_setfl_scc",{"setfl_file","r_crd","C","elems"});

883 
f
.
nİtiÚ®s
=1;

884 
f
.
logics
<1>()[0]=
	`VLogics
("gt",0.0);

885 
f
.
logics
<2>()[0]=
	`VLogics
("gt",0.0);

887 cÚ¡ 
¡d
::
¡ršg
* 
Çmes
=
__£lf
->
©oms
->
–em’ts
.names;

888 cÚ¡ 
size_t
 
ÃËms
=
__£lf
->
©oms
->
–em’ts
.nelems;

889 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

890 if(
f
.
»m­
<3,2,1>("–em’t ´e£Á iÀsy¡em",
Çmes
,
ÃËms
)è 
NULL
;

893 
size_t
 
Ä
,
Äho
;

894 
ty³0
 
dr
,
drho
;

895 
ty³0
** 
r_c
;

896 
	`ty³0
(** 
F
)[5]=
NULL
;

897 
	`ty³0
(*** 
r_phi
)[4]=
NULL
;

898 
	`ty³0
(*** 
rho
)[4]=
NULL
;

899 
Œy


901 
ImpÜtEAM
::
	`£tæ
(
ÃËms
,
__£lf
->
©oms
->
–em’ts
.
Çmes
,
f
.
v®
<0>(),
dr
,
drho
,
Ä
,
Äho
,
r_phi
,
rho
,
F
,
r_c
);

903 
	`ÿtch
(* 
”r_msg
)

905 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,
”r_msg
);

906 
d–‘e
 [] 
”r_msg
;

907  
NULL
;

910 
size_t
 
i
=0;i<
ÃËms
;i++)

911 if(
f
.
v
<1>()[
i
]>
r_c
[i][i])

913 
MemÜy
::
	`d—Îoc
(
r_c
);

914 
MemÜy
::
	`d—Îoc
(
F
);

915 
MemÜy
::
	`d—Îoc
(
r_phi
);

916 
MemÜy
::
	`d—Îoc
(
rho
);

917 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"r_üd[%zu] should bËs thª„_c[%zu][%zu]",
i
,i,i);

918  
NULL
;

921 
d–‘e
 
__£lf
->
ff
;

922 
__£lf
->
ff
=
Ãw
 
	`FÜûF›ldEAMDMDSCC
(__£lf->
©oms
,
dr
,
drho
,
Ä
,
Äho
,
¡d
::
	`move
(
r_phi
),¡d::move(
rho
),¡d::move(
F
),¡d::move(
r_c
),
f
.
mov
<1>(),f.mov<2>());

923 
Py_RETURN_NONE
;

925 
m‘hod_1
.
ml_doc
=(*)
R
"---(

926 
	`ff_—m_£tæ
(
£tæ_fe
,
r_üd
,
C
,
–ems
=
NÚe
)

928 
TabuÏ‹d
 
EAM
 
fÜû
 
f›ld
 
giv’
 
by
 
a
 
sšgË
 
S‘FL
 
fe


930 
Assigns
 
EAM
 
fÜû
 
f›ld
 
to
 
sy¡em


932 
P¬am‘”s


934 
£tæ_fe
 : 
¡ršg


935 
»Ïtive
 
·th
 
to
 
DYNAMO
 
fe
 
w™h
 
S‘FL
 
fÜm©


936 
r_üd
 : [
ÃËms
]

937 
cutoff
 
¿dius
 
mass
 
exchªge


938 
C
 : [
ÃËms
]

939 
dim’siÚËss
 
çùÜ
 
—ch
 
–em’t
, 
£e
 :
»f
:`
h”e
 <
ma¡”
-ref>`

940 
–ems
 : 
¡ršg
[
ÃËms
]

941 
m­pšg
 
–em’ts


943 
R‘uºs


945 
NÚe


947 
NÙes


949 
This
 
is
 
buÏ‹d
 
fÜm
 
of
 
Embedded
 
Atom
 
	`M‘hod
 (
EAM
è
pÙ’tŸl


952 
Exam¶es


954 
Cu


958 >>> 
äom
 
m­p
 
impÜt
 
dmd


959 >>> 
sim
=
dmd
.
	`cfg
(5,"configs/Cu-DMD.cfg")

960 >>> 
sim
.
	`ff_—m_£tæ
("potentials/Cu_mishin.eam.alloy")

966 
m‘hod_2
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

967 
m‘hod_2
.
ml_Çme
="ff_eam_fs_scc";

968 
m‘hod_2
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

969 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

971 
AtomsDMD
::
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<AtomsDMD::Objeù*>(
£lf
);

972 
FuncAPI
<
¡d
::
¡ršg
,
ty³0
*,ty³0*,¡d::¡ršg*> 
	`f
("ff_eam_fs_scc",{"fs_file","r_crd","C","elems"});

973 
f
.
nİtiÚ®s
=1;

974 
f
.
logics
<1>()[0]=
	`VLogics
("gt",0.0);

975 
f
.
logics
<2>()[0]=
	`VLogics
("gt",0.0);

977 cÚ¡ 
¡d
::
¡ršg
* 
Çmes
=
__£lf
->
©oms
->
–em’ts
.names;

978 cÚ¡ 
size_t
 
ÃËms
=
__£lf
->
©oms
->
–em’ts
.nelems;

979 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

980 if(
f
.
»m­
<3,2,1>("–em’t ´e£Á iÀsy¡em",
Çmes
,
ÃËms
)è 
NULL
;

982 
size_t
 
Ä
,
Äho
;

983 
ty³0
 
dr
,
drho
;

984 
ty³0
** 
r_c
;

985 
	`ty³0
(** 
F
)[5]=
NULL
;

986 
	`ty³0
(*** 
r_phi
)[4]=
NULL
;

987 
	`ty³0
(*** 
rho
)[4]=
NULL
;

988 
Œy


990 
ImpÜtEAM
::
	`fs
(
ÃËms
,
__£lf
->
©oms
->
–em’ts
.
Çmes
,
f
.
v®
<0>(),
dr
,
drho
,
Ä
,
Äho
,
r_phi
,
rho
,
F
,
r_c
);

992 
	`ÿtch
(* 
”r_msg
)

994 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,
”r_msg
);

995 
d–‘e
 [] 
”r_msg
;

996  
NULL
;

999 
size_t
 
i
=0;i<
ÃËms
;i++)

1000 if(
f
.
v
<1>()[
i
]>
r_c
[i][i])

1002 
MemÜy
::
	`d—Îoc
(
r_c
);

1003 
MemÜy
::
	`d—Îoc
(
F
);

1004 
MemÜy
::
	`d—Îoc
(
r_phi
);

1005 
MemÜy
::
	`d—Îoc
(
rho
);

1006 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"r_üd[%zu] should bËs thª„_c[%zu][%zu]",
i
,i,i);

1007  
NULL
;

1010 
d–‘e
 
__£lf
->
ff
;

1011 
__£lf
->
ff
=
Ãw
 
	`FÜûF›ldEAMDMDSCC
(__£lf->
©oms
,
dr
,
drho
,
Ä
,
Äho
,
¡d
::
	`move
(
r_phi
),¡d::move(
rho
),¡d::move(
F
),¡d::move(
r_c
),
f
.
mov
<1>(),f.mov<2>());

1012 
Py_RETURN_NONE
;

1014 
m‘hod_2
.
ml_doc
=(*)
R
"---(

1015 
	`ff_—m_fs
(
fs_fe
,
r_üd
,
C
,
–ems
=
NÚe
)

1017 
TabuÏ‹d
 
Fšnis
-
Sšşaœ
 
EAM


1019 
Assigns
 
Fšnis
-
Sšşaœ
 
EAM
 
fÜû
 
f›ld
 
to
 
sy¡em
. 
FÜ
 
ex¶ª©iÚ
 
of
 
the
 
·¿m‘”
 
£e
h
NÙes
 
£ùiÚ
.

1021 
P¬am‘”s


1023 
fs_fe
 : 
¡ršg


1024 
»Ïtive
 
·th
 
to
 
DYNAMO
 
fe
 
w™h
 
fs
 
fÜm©


1025 
r_üd
 : [
ÃËms
]

1026 
cutoff
 
¿dius
 
mass
 
exchªge


1027 
C
 : [
ÃËms
]

1028 
dim’siÚËss
 
çùÜ
 
—ch
 
–em’t
, 
£e
 :
»f
:`
h”e
 <
ma¡”
-ref>`

1029 
–ems
 : 
¡ršg
[
ÃËms
]

1030 
m­pšg
 
–em’ts


1032 
R‘uºs


1034 
NÚe


1036 
NÙes


1038 
This
 
is
 
buÏ‹d
 
fÜm
 
of
 
Fšnis
-
Sšşaœ
 
Embedded
 
Atom
 
	`M‘hod
 (
EAM
è
pÙ’tŸl


1040 
CÚsid”
 
the
 
g’”®
 
fÜm
 
of
 
EAM
 
pÙ’tŸl
:

1043 .. 
m©h
:: 
U
=\
äac
{1}{2}\
sum_
{
i
}\sum_{
j
\
Ãq
 i}\
phi_
{\
gamma
 \
d–
}{(
x_
{
ij
}è}+\
sum_i
 
E_
\gamm¨\
	`Ëá
(\sum_{j\Ãq i} \
rho_
{\d–\gamma}(x_{ij}è\
right
),

1046 
From
 
h”e
 
Ú
, 
g»ek
 
su³rscts
/
subsüts
 
¬e
 
u£d
 
to
 
»ãr
Ø
–em’ts
 
´e£Á
 
the
 
sy¡em
; :
m©h
:`\
gamma
`, 
ªd
 :m©h:`\
d–
` 
d’Ùe
 
ty³
 
of
 
©om
 :m©h:`
i
`‡nd‡tom :m©h:`
j
`, 
»³ùiv–y
. :m©h:`
E
`, :m©h:`\
rho
`,‡nd :m©h:`\
phi
`‡» 
embeddšg
, 
–eùrÚ
 
d’s™y
,‡nd 
·œ
 
funùiÚs
, 
»¥eùiv–y
. 
Also
 :m©h:`
x_
{
ij
}` 
»ãrs
Ø
di¡ªû
 
b‘w“n
 :m©h:`i`‡nd :m©h:`j`. 
Now
h
muÉi
 
compÚ’t
 
fÜmuÏtiÚ
 oà
DMD
 
ä“
 
’”gy
 
would
 
be
:

1048 .. 
m©h
::

1049 
F
=&\
äac
{1}{2}\
sum_
{
i
,\
gamma
,
j
\
Ãq
 i,\
d–
}
c_i
^\gamm¨
c_j
^\d– \
omega_
{\gamm¨\d–}\
	`Ëá
(
x_
{
ij
}\
right
)+\sum_{i,\gamma} c_i^\gamm¨
E_
\gamm¨\Ëá(\sum_{j\Ãq i,\d–} c_j^{\d–}\
psi_
{\d–\gamma}\Ëá(x_{ij}\right)\right)-3
k_BT
\sum_{i,\gamma} c_i^\gamm¨\
log
\Ëá(\
sq¹
{\
pi
 
e
}\
®pha_i
^\gamma/\
Lambda_
\gamma\right)\\

1050 &+
k_BT
\
sum_
{
i
,\
gamma
} 
c_i
^\gamma\
log
 c_i^\gamma+k_BT\sum_{i}c_i^
v
\
	`log
 (c_i^v),

1052 
wh”e


1054 .. 
m©h
:: \
Lambda_
\
gamma
=\
äac
{
h
}{\
sq¹
{2\
pi
 
m_
\gamm¨
k_BT
}}, \
quad
 
c_i
^
v
=1-\
sum_
{\gamma}c_i^\gamma,

1056 .. 
m©h
:: \
omega_
{\
gamma
\
d–
}(
x_
{
ij
})ğ\
äac
{1}{\
	`Ëá
(\
®pha
^{\gamma\d–}
_
{ij}\
sq¹
{\
pi
}\
right
)^{3}}\
d
^3\
m©hbf
{
x
} \
exp
{\
biggl
[-\Ëá(\äac{\m©hbf{x}_{ij} -\m©hbf{x}}{\®pha^{\gamma\d–}_{ij}}\right)^2\
biggr
]}\
phi_
{\gamma\delta}(|\mathbf{x}|)

1058 .. 
m©h
:: \
psi_
{\
gamma
\
d–
}(
x_
{
ij
})=\
äac
{1}{\
	`Ëá
(\
®pha
^{\gamma\d–}
_
{ij}\
sq¹
{\
pi
}\
right
)^{3}}\
d
^3\
m©hbf
{
x
} \
exp
{\
biggl
[-\Ëá(\äac{\m©hbf{x}_{ij} -\m©hbf{x}}{\®pha^{\gamma\d–}_{ij}}\right)^2\
biggr
]}\
rho_
{\gamma\delta}(|\mathbf{x}|)

1060 .. 
m©h
:: \
®pha
^{\
gamma
\
d–
}
_
{
ij
}=\
sq¹
{{\
®pha_i
^{\gamma}}^2+{\
®pha_j
^{\d–}}^2},\
quad
 \
m©hbf
{
x
}_{
ji
}=\m©hbf{x}
_j
-\m©hbf{x}
_i


1062 
The
 
num”iÿl
 
ev®u©iÚ
 
of
 
the£
 
š‹g¿ls
 
is
 
discus£d
 :
»f
:`
h”e
 <
š‹g
-ref>`.

1066 
ReÿÎšg
 
th©


1068 .. 
m©h
:: \
ÏngË
 
U
 \
¿ngË
 &ğ\
äac
{\
·¹Ÿl
 }{\·¹ŸÈ\
b‘a
}\
	`Ëá
(\b‘¨
F
 \
right
)

1070 
the
 
av”age
 
pÙ’tŸl
 
’”gy
 
is


1073 .. 
m©h
:: \
ÏngË
 
U
 \
¿ngË
 = \
äac
{1}{2}\
sum_
{
i
,\
gamma
,
j
\
Ãq
 i,\
d–
}
c_i
^\gamm¨
c_j
^\d– \
omega_
{\gamm¨\d–}\
	`Ëá
(
x_
{
ij
}\
right
)+\sum_{i,\gamma} c_i^\gamm¨
E_
\gamm¨\Ëá(\sum_{j\Ãq i,\d–} c_j^{\d–}\
psi_
{\d–\gamma}\Ëá(x_{ij}\right)\rightè-\äac{3}{2} 
k_B
 
T


1076 
Exam¶es


1078 
IrÚ
 
Hydrogº
 
mixtu»


1080 >>> 
äom
 
m­p
 
impÜt
 
dmd


1081 >>> 
sim
=
dmd
.
	`cfg
(5,"configs/FeH-DMD.cfg")

1082 >>> 
sim
.
	`ff_—m_fs
("potentials/FeH.eam.fs")

1084 
	}
}

	@ff_eam_dmd_scc.h

1 #iâdeà
__MAPP__ff_—m_dmd_scc__


2 
	#__MAPP__ff_—m_dmd_scc__


	)

3 
	~"ff_dmd.h
"

4 
Çme¥aû
 
	gMAPP_NS


6 
	g‹m¶©e
<
	gşass
> 
şass
 
	gDMDVec
;

7 şas 
	cFÜûF›ldEAMDMDSCC
 : 
public
 
FÜûF›ldDMD


9 
´iv©e
:

10 
size_t
 
Ä
,
	gÄho
;

11 
ty³0
 
	gdr
,
	gdrho
,
	gdr_šv
,
	gdrho_šv
,
	grho_max
;

12 
ty³0
(** 
F_¬r
)[5];

13 
ty³0
(*** 
r_phi_¬r
)[4];

14 
ty³0
(*** 
r_rho_¬r
)[4];

18 
	gVec
<
	gty³0
>* 
	gE_±r
;

19 
	gVec
<
	gty³0
>* 
	gdE_±r
;

20 
	gVec
<
	gty³0
>* 
	grho_±r
;

21 
	gVec
<
	gty³0
>* 
	gcv_±r
;

23 
	gVec
<
	gty³0
>* 
	gvec0
;

24 
	gVec
<
	gty³0
>* 
	gvec1
;

25 
	gVec
<
	gty³0
>* 
	gvec2
;

26 
	gVec
<
	gty³0
>* 
	gvec3
;

27 
	gVec
<
	gty³0
>* 
	gfcÛf_±r
;

31 
ty³0
 
	gkbT
,
	gb‘a
;

32 
ty³0
* 
	gc_0
;

33 
ty³0
* 
	gc_1
;

34 
ty³0
* 
	gz‘a
;

37 
ty³0
* 
	grho_phi
;

38 
ty³0
* 
	gdrho_phi_dr
;

39 
ty³0
* 
	gdrho_phi_d®pha
;

40 
ty³0
* 
	gB_·œ
;

41 * 
	gNN
;

42 
	gmax_NN
;

43 
ty³0
 (* 
Bs
)[2][2];

44 
size_t
 
	gmax_·œs
;

48 
ty³0
* 
	gxi
;

49 
ty³0
* 
	gwi_0
;

50 
ty³0
* 
	gwi_1
;

51 cÚ¡ 
	gN
;

55 
ty³0
 
ÿlc_’t
(type0);

56 
£t_‹mp
();

59 
ÿlc_·œ
(
ty³0
,type0*,type0*,type0*&,type0*&,type0*&);

62 
ÿlc_Q
(
ty³0
&,type0&,type0&,type0&,type0&);

63 
ÿlc_Q
(
ty³0
&,type0&,type0&,type0&,type0&,type0&);

66 
sc_loİ
();

69 
	g´Ùeùed
:

70 
__fÜû_ÿlc
();

71 
__’”gy_ÿlc
();

72 
__fÜû_ÿlc_¡©ic
(){};

73 
__c_d_ÿlc
(){};

74 
__J
(
Vec
<
ty³0
>*,Vec<type0>*){};

75 
__´•J_n_»s
(
Vec
<
ty³0
>*,Vec<type0>*);

76 
__J
(
Vec
<
ty³0
>*,Vec<type0>*,Vec<type0>*,Vec<type0>*);

77 
	gpublic
:

79 
š™_¡©ic
(){};

80 
fš_¡©ic
(){};

81 
FÜûF›ldEAMDMDSCC
(
şass
 
AtomsDMD
*,

82 
ty³0
,ty³0,
size_t
,size_t,

83 
ty³0
(***&&)[4],type0(***&&)[4],type0(**&&)[5],

84 
ty³0
**&&,type0*&&,type0*&&);

86 ~
FÜûF›ldEAMDMDSCC
();

87 
š™
();

88 
fš
();

91 
ty³0
* 
ave_mu
(){ 
	gNULL
;};

92 
ml_Ãw
(
PyM‘hodDef
&,PyMethodDef&,PyMethodDef&);

	@ff_eam_fit.cpp

1 
	~"ff_—m_f™.h
"

2 
	~"ÃighbÜ_md.h
"

3 
	~"©oms_md.h
"

4 
	~"–em’ts.h
"

5 
	~"memÜy.h
"

6 
	~"dyÇmic_md.h
"

7 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

15 
	gFÜûF›ldEAMF™
::
FÜûF›ldEAMF™
(
AtomsMD
* 
__©oms
,

16 
ty³0
(***&& 
__rho_AR
)[2],

17 
size_t
**&& 
__rho_sz
,

18 
ty³0
(***&& 
__phi_AR
)[2],

19 
size_t
**&& 
__phi_sz
,

20 
ty³0
(*&& 
__F_A
)[3]

22 
FÜûF›ldMD
(
__©oms
),

23 
rho_sz
(
__rho_sz
),

24 
phi_sz
(
__phi_sz
),

25 
	$®loc
(
Œue
)

28 
__rho_sz
=
NULL
;

29 
__phi_sz
=
NULL
;

31 
size_t
 
ÃËms
=2;

32 
size_t
 
tÙ_sz
=0;

33 
size_t
 
›Ëm
=0;›Ëm<
ÃËms
;ielem++)

34 
size_t
 
j–em
=0;j–em<
ÃËms
;jelem++)

37 
tÙ_sz
+=
rho_sz
[
›Ëm
][
j–em
];

38 
tÙ_sz
+=
phi_sz
[
›Ëm
][
j–em
];

41 
ty³0
* 
__d©a
=
NULL
;

42 
MemÜy
::
	`®loc
(
__d©a
,2*
tÙ_sz
+6);

44 
MemÜy
::
	`®loc
(
rho_A
,
ÃËms
,nelems);

45 
MemÜy
::
	`®loc
(
phi_A
,
ÃËms
,nelems);

46 
MemÜy
::
	`®loc
(
F_A
,
ÃËms
);

47 
MemÜy
::
	`®loc
(
rho_R
,
ÃËms
,nelems);

48 
MemÜy
::
	`®loc
(
phi_R
,
ÃËms
,nelems);

50 
size_t
 
__i
=0;

51 
size_t
 
›Ëm
=0;›Ëm<
ÃËms
;ielem++)

52 
size_t
 
j–em
=0;j–em<
ÃËms
;jelem++)

54 
rho_A
[
›Ëm
][
j–em
]=
__d©a
+
__i
;

55 
size_t
 
i
=0;i<
rho_sz
[
›Ëm
][
j–em
];i++)

56 
__d©a
[
__i
++]=
__rho_AR
[
›Ëm
][
j–em
][
i
][0];

59 
size_t
 
›Ëm
=0;›Ëm<
ÃËms
;ielem++)

60 
size_t
 
j–em
=0;j–em<
ÃËms
;jelem++)

62 
phi_A
[
›Ëm
][
j–em
]=
__d©a
+
__i
;

63 
size_t
 
i
=0;i<
phi_sz
[
›Ëm
][
j–em
];i++)

64 
__d©a
[
__i
++]=
__phi_AR
[
›Ëm
][
j–em
][
i
][0];

67 
size_t
 
›Ëm
=0;›Ëm<
ÃËms
;ielem++)

69 
F_A
[
›Ëm
]=
__d©a
+
__i
;

70 
size_t
 
i
=0;i<3;i++)

71 
__d©a
[
__i
++]=
__F_A
[
›Ëm
][
i
];

74 
size_t
 
›Ëm
=0;›Ëm<
ÃËms
;ielem++)

75 
size_t
 
j–em
=0;j–em<
ÃËms
;jelem++)

77 
rho_R
[
›Ëm
][
j–em
]=
__d©a
+
__i
;

78 
size_t
 
i
=0;i<
rho_sz
[
›Ëm
][
j–em
];i++)

79 
__d©a
[
__i
++]=
__rho_AR
[
›Ëm
][
j–em
][
i
][1];

82 
size_t
 
›Ëm
=0;›Ëm<
ÃËms
;ielem++)

83 
size_t
 
j–em
=0;j–em<
ÃËms
;jelem++)

85 
phi_R
[
›Ëm
][
j–em
]=
__d©a
+
__i
;

86 
size_t
 
i
=0;i<
phi_sz
[
›Ëm
][
j–em
];i++)

87 
__d©a
[
__i
++]=
__phi_AR
[
›Ëm
][
j–em
][
i
][1];

91 
MemÜy
::
	`d—Îoc
(
__rho_AR
);

92 
__rho_AR
=
NULL
;

93 
MemÜy
::
	`d—Îoc
(
__phi_AR
);

94 
__phi_AR
=
NULL
;

95 
MemÜy
::
	`d—Îoc
(
__F_A
);

96 
__F_A
=
NULL
;

100 
MemÜy
::
	`®loc
(
phi_cut
,
ÃËms
,nelems);

101 
MemÜy
::
	`®loc
(
rho_cut
,
ÃËms
,nelems);

103 
size_t
 
›Ëm
=0;›Ëm<
ÃËms
;ielem++)

104 
size_t
 
j–em
=0;j–em<
ÃËms
;jelem++)

105 
cut
[
›Ëm
][
j–em
]=0.0;

107 
size_t
 
›Ëm
=0;›Ëm<
ÃËms
;ielem++)

108 
size_t
 
j–em
=0;j–em<
ÃËms
;jelem++)

110 if(
rho_sz
[
›Ëm
][
j–em
])

112 
	`sÜt_AR_ij
(
rho_A
[
›Ëm
][
j–em
],
rho_R
[›Ëm][j–em],
rho_sz
[ielem][jelem]);

113 
rho_cut
[
›Ëm
][
j–em
]=
rho_R
[ielem][jelem][0];

117 if(
phi_sz
[
›Ëm
][
j–em
])

119 
	`sÜt_AR_ij
(
phi_A
[
›Ëm
][
j–em
],
phi_R
[›Ëm][j–em],
phi_sz
[ielem][jelem]);

120 
phi_cut
[
j–em
][
›Ëm
]õhi_cut[›Ëm][j–em]=
phi_R
[ielem][jelem][0];

123 
phi_cut
[1][1]=
	`MAX
(2.8,
rho_cut
[1][1]);

125 
size_t
 
›Ëm
=0;›Ëm<
ÃËms
;ielem++)

126 
size_t
 
j–em
=
›Ëm
;j–em<
ÃËms
;jelem++)

128 
cut
[
›Ëm
][
j–em
]=cut[j–em][›Ëm]=
	`MAX
(
phi_cut
[›Ëm][j–em],MAX(
rho_cut
[ielem][jelem],rho_cut[jelem][ielem]));

129 
cut_sq
[
›Ëm
][
j–em
]=cut_sq[j–em][›Ëm]=
cut
[ielem][jelem]*cut[ielem][jelem];

151 
	}
}

155 
	gFÜûF›ldEAMF™
::
	$FÜûF›ldEAMF™
(

156 
AtomsMD
* 
__©oms
,

157 
ty³0
***& 
__rho_A
,

158 
ty³0
***& 
__rho_R
,

159 
size_t
**& 
__rho_sz
,

160 
ty³0
***& 
__phi_A
,

161 
ty³0
***& 
__phi_R
,

162 
size_t
**& 
__phi_sz
,

163 
ty³0
**& 
__F_A
):

164 
	`FÜûF›ldMD
(
__©oms
),

165 
	`rho_A
(
__rho_A
),

166 
	`rho_R
(
__rho_R
),

167 
	`rho_sz
(
__rho_sz
),

168 
	`phi_A
(
__phi_A
),

169 
	`phi_R
(
__phi_R
),

170 
	`phi_sz
(
__phi_sz
),

171 
	`F_A
(
__F_A
),

172 
	$®loc
(
çl£
)

175 
MemÜy
::
	`®loc
(
phi_cut
,
ÃËms
,nelems);

176 
MemÜy
::
	`®loc
(
rho_cut
,
ÃËms
,nelems);

178 
size_t
 
›Ëm
=0;›Ëm<
ÃËms
;ielem++)

179 
size_t
 
j–em
=0;j–em<
ÃËms
;jelem++)

180 
cut
[
›Ëm
][
j–em
]=0.0;

182 
size_t
 
›Ëm
=0;›Ëm<
ÃËms
;ielem++)

183 
size_t
 
j–em
=0;j–em<
ÃËms
;jelem++)

185 if(
rho_sz
[
›Ëm
][
j–em
])

187 
	`sÜt_AR_ij
(
rho_A
[
›Ëm
][
j–em
],
rho_R
[›Ëm][j–em],
rho_sz
[ielem][jelem]);

188 
rho_cut
[
›Ëm
][
j–em
]=
rho_R
[ielem][jelem][0];

192 if(
phi_sz
[
›Ëm
][
j–em
])

194 
	`sÜt_AR_ij
(
phi_A
[
›Ëm
][
j–em
],
phi_R
[›Ëm][j–em],
phi_sz
[ielem][jelem]);

195 
phi_cut
[
j–em
][
›Ëm
]õhi_cut[›Ëm][j–em]=
phi_R
[ielem][jelem][0];

198 
phi_cut
[1][1]=
	`MAX
(2.8,
rho_cut
[1][1]);

200 
size_t
 
›Ëm
=0;›Ëm<
ÃËms
;ielem++)

201 
size_t
 
j–em
=
›Ëm
;j–em<
ÃËms
;jelem++)

203 
cut
[
›Ëm
][
j–em
]=cut[j–em][›Ëm]=
	`MAX
(
phi_cut
[›Ëm][j–em],MAX(
rho_cut
[ielem][jelem],rho_cut[jelem][ielem]));

204 
cut_sq
[
›Ëm
][
j–em
]=cut_sq[j–em][›Ëm]=
cut
[ielem][jelem]*cut[ielem][jelem];

206 
	}
}

210 
	gFÜûF›ldEAMF™
::~
	$FÜûF›ldEAMF™
()

212 if(
®loc
)

214 **
phi_R
=
NULL
;

215 **
rho_R
=
NULL
;

216 *
F_A
=
NULL
;

217 **
phi_A
=
NULL
;

219 
MemÜy
::
	`d—Îoc
(
phi_R
);

220 
MemÜy
::
	`d—Îoc
(
rho_R
);

221 
MemÜy
::
	`d—Îoc
(
F_A
);

222 
MemÜy
::
	`d—Îoc
(
phi_A
);

223 
MemÜy
::
	`d—Îoc
(
rho_A
);

227 
MemÜy
::
	`d—Îoc
(
rho_cut
);

228 
MemÜy
::
	`d—Îoc
(
phi_cut
);

229 
	}
}

233 
	gFÜûF›ldEAMF™
::
	$sÜt_AR_ij
(
ty³0
*& 
A_ij
,ty³0*& 
R_ij
,
size_t
 
sz
)

236 
size_t
* 
key
=
NULL
;

237 
MemÜy
::
	`®loc
(
key
,
sz
);

238 
size_t
 
i
=0;i<
sz
;i++è
key
[i]=i;

240 
XM©h
::
	`quicksÜt
(
key
,key+
sz
,

241 [&
R_ij
](
size_t
* 
¿nk_i
,size_t* 
¿nk_j
)

242 { (
R_ij
[*
¿nk_i
]>R_ij[*
¿nk_j
]);},

243 [&
R_ij
,&
A_ij
](
size_t
* 
¿nk_i
,size_t* 
¿nk_j
)

245 
¡d
::
	`sw­
(
R_ij
[*
¿nk_i
],R_ij[*
¿nk_j
]);

246 
¡d
::
	`sw­
(
A_ij
[*
¿nk_i
],A_ij[*
¿nk_j
]);

249 
MemÜy
::
	`d—Îoc
(
key
);

251 
	}
}

255 
	gFÜûF›ldEAMF™
::
	$__fÜû_ÿlc
()

257 
ty³0
* 
xvec
=
©oms
->
x
->
	`begš
();

258 
ty³0
* 
fvec
=
f
->
	`begš
();

259 
ty³0
* 
rho
=
rho_±r
->
	`begš
();

260 
–em_ty³
* 
evec
=
©oms
->
–em
->
	`begš
();

262 
Ÿtm
,
j©m
;

263 
–em_ty³
 
›Ëm
,
j–em
;

264 
ty³0
 
r
,
rsq
;

265 
ty³0
 
åaœ
;

266 
ty³0
 
dx_ij
[
__dim__
];

267 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->neighbor_list;

268 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->neighbor_list_size;

269 cÚ¡ 
Çtms_lş
=
©oms
->natms_lcl;

270 
i
=0;i<
Çtms_lş
;i++)

271 
rho
[
i
]=0.0;

273 
Ÿtm
=0;Ÿtm<
Çtms_lş
;iatm++)

276 
›Ëm
=
evec
[
Ÿtm
];

277 
j
=0;j<
ÃighbÜ_li¡_size
[
Ÿtm
];j++)

279 
j©m
=
ÃighbÜ_li¡
[
Ÿtm
][
j
];

280 
j–em
=
evec
[
j©m
];

281 
rsq
=
Algeb¿
::
RSQ
<
__dim__
>(
xvec
+
Ÿtm
*__dim__,xvec+
j©m
*__dim__);

282 if(
rsq
>=
cut_sq
[
›Ëm
][
j–em
]) ;

283 
r
=
	`sq¹
(
rsq
);

286 
rho
[
Ÿtm
]+=
	`ÿlc_rho
(
j–em
,
›Ëm
,
r
);

287 if(
j©m
<
Çtms_lş
)

289 
rho
[
j©m
]+=
	`ÿlc_rho
(
›Ëm
,
j–em
,
r
);

290 
__vec_lş
[0]+=
	`ÿlc_phi
(
›Ëm
,
j–em
,
r
);;

293 
__vec_lş
[0]+=0.5*
	`ÿlc_phi
(
›Ëm
,
j–em
,
r
);;

296 
__vec_lş
[0]+=
	`ÿlc_F
(
›Ëm
,
rho
[
Ÿtm
]);

305 
	`upd©e
(
rho_±r
);

309 
Ÿtm
=0;Ÿtm<
Çtms_lş
;iatm++)

311 
›Ëm
=
evec
[
Ÿtm
];

313 
j
=0;j<
ÃighbÜ_li¡_size
[
Ÿtm
];j++)

315 
j©m
=
ÃighbÜ_li¡
[
Ÿtm
][
j
];

316 
j–em
=
evec
[
j©m
];

318 
rsq
=
Algeb¿
::
DX_RSQ
<
__dim__
>(
xvec
+
Ÿtm
*__dim__,xvec+
j©m
*__dim__,
dx_ij
);

319 if(
rsq
>=
cut_sq
[
›Ëm
][
j–em
]) ;

321 
r
=
	`sq¹
(
rsq
);

322 
åaœ
=-(
	`ÿlc_dF
(
›Ëm
,
rho
[
Ÿtm
])*
	`ÿlc_drho
(
j–em
,›Ëm,
r
)+

323 
	`ÿlc_dF
(
j–em
,
rho
[
j©m
])*
	`ÿlc_drho
(
›Ëm
,j–em,
r
)+

324 
	`ÿlc_dphi
(
›Ëm
,
j–em
,
r
))/r;

325 if(
åaœ
==0.0) ;

327 
Algeb¿
::
V_add_x_mul_V
<
__dim__
>(
åaœ
,
dx_ij
,
fvec
+
Ÿtm
*__dim__);

328 if(
j©m
<
Çtms_lş
)

329 
Algeb¿
::
V_add_x_mul_V
<
__dim__
>(-
åaœ
,
dx_ij
,
fvec
+
j©m
*__dim__);

331 
åaœ
*=0.5;

333 
Algeb¿
::
DyadicV
<
__dim__
>(-
åaœ
,
dx_ij
,&
__vec_lş
[1]);

336 
ty³0
 
f_sum_lş
[
__dim__
];

337 
Algeb¿
::
z”o
<
__dim__
>(
f_sum_lş
);

338 
i
=0;i<
Çtms_lş
;i++)

339 
Algeb¿
::
V_add
<
__dim__
>(
fvec
+__dim__*
i
,
f_sum_lş
);

341 
ty³0
 
f_cÜr
[
__dim__
];

342 
	`MPI_AÎ»duû
(
f_sum_lş
,
f_cÜr
,
__dim__
,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

343 
ty³0
 
a
=-1.0/
¡©ic_ÿ¡
<ty³0>(
©oms
->
Çtms
);

344 
Algeb¿
::
Do
<
__dim__
>::
	`func
([&
a
,&
f_cÜr
](
i
){f_corr[i]*=a;});

345 
i
=0;i<
Çtms_lş
;i++)

346 
Algeb¿
::
V_add
<
__dim__
>(
f_cÜr
,
fvec
+__dim__*
i
);

348 
	}
}

354 
	gFÜûF›ldEAMF™
::
	$__’”gy_ÿlc
()

356 
ty³0
* 
xvec
=
©oms
->
x
->
	`begš
();

357 
ty³0
* 
rho
=
rho_±r
->
	`begš
();

358 
–em_ty³
* 
evec
=
©oms
->
–em
->
	`begš
();

360 
Ÿtm
,
j©m
;

361 
–em_ty³
 
›Ëm
,
j–em
;

362 
ty³0
 
r
,
rsq
;

364 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->neighbor_list;

365 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->neighbor_list_size;

366 cÚ¡ 
Çtms_lş
=
©oms
->natms_lcl;

367 
i
=0;i<
Çtms_lş
;i++)

368 
rho
[
i
]=0.0;

370 
Ÿtm
=0;Ÿtm<
Çtms_lş
;iatm++)

372 
›Ëm
=
evec
[
Ÿtm
];

373 
j
=0;j<
ÃighbÜ_li¡_size
[
Ÿtm
];j++)

375 
j©m
=
ÃighbÜ_li¡
[
Ÿtm
][
j
];

376 
j–em
=
evec
[
j©m
];

377 
rsq
=
Algeb¿
::
RSQ
<
__dim__
>(
xvec
+
Ÿtm
*__dim__,xvec+
j©m
*__dim__);

378 if(
rsq
>=
cut_sq
[
›Ëm
][
j–em
]) ;

379 
r
=
	`sq¹
(
rsq
);

382 
rho
[
Ÿtm
]+=
	`ÿlc_rho
(
j–em
,
›Ëm
,
r
);

383 if(
j©m
<
Çtms_lş
)

385 
rho
[
j©m
]+=
	`ÿlc_rho
(
›Ëm
,
j–em
,
r
);

386 
__vec_lş
[0]+=
	`ÿlc_phi
(
›Ëm
,
j–em
,
r
);

389 
__vec_lş
[0]+=0.5*
	`ÿlc_phi
(
›Ëm
,
j–em
,
r
);

392 
__vec_lş
[0]+=
	`ÿlc_F
(
›Ëm
,
rho
[
Ÿtm
]);

399 
	}
}

405 
	gFÜûF›ldEAMF™
::
	$´•4d”iv
()

407 
ty³0
* 
xvec
=
©oms
->
x
->
	`begš
();

408 
ty³0
* 
fvec
=
f
->
	`begš
();

409 
ty³0
* 
rho
=
rho_±r
->
	`begš
();

410 
–em_ty³
* 
evec
=
©oms
->
–em
->
	`begš
();

412 
Ÿtm
,
j©m
;

413 
–em_ty³
 
›Ëm
,
j–em
;

414 
ty³0
 
r
,
rsq
;

415 
ty³0
 
åaœ
;

416 
ty³0
 
dx_ij
[
__dim__
];

417 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->neighbor_list;

418 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->neighbor_list_size;

419 cÚ¡ 
Çtms_lş
=
©oms
->natms_lcl;

420 
i
=0;i<
Çtms_lş
;i++)

421 
rho
[
i
]=0.0;

423 
Ÿtm
=0;Ÿtm<
Çtms_lş
;iatm++)

425 
›Ëm
=
evec
[
Ÿtm
];

426 
j
=0;j<
ÃighbÜ_li¡_size
[
Ÿtm
];j++)

428 
j©m
=
ÃighbÜ_li¡
[
Ÿtm
][
j
];

429 
j–em
=
evec
[
j©m
];

430 
rsq
=
Algeb¿
::
RSQ
<
__dim__
>(
xvec
+
Ÿtm
*__dim__,xvec+
j©m
*__dim__);

431 if(
rsq
>=
cut_sq
[
›Ëm
][
j–em
]) ;

432 
r
=
	`sq¹
(
rsq
);

435 
rho
[
Ÿtm
]+=
	`ÿlc_rho
(
j–em
,
›Ëm
,
r
);

437 if(
j©m
<
Çtms_lş
)

438 
rho
[
j©m
]+=
	`ÿlc_rho
(
›Ëm
,
j–em
,
r
);

443 
	`upd©e
(
rho_±r
);

446 
ty³0
* 
S
=
S_±r
->
	`begš
();

447 
i
=0;i<
Çtms_lş
*
__nvoigt__
;i++)

448 
S
[
i
]=0.0;

449 
ty³0
 
drho_ji
,
drho_ij
;

450 
Ÿtm
=0;Ÿtm<
Çtms_lş
;iatm++)

452 
›Ëm
=
evec
[
Ÿtm
];

454 
j
=0;j<
ÃighbÜ_li¡_size
[
Ÿtm
];j++)

456 
j©m
=
ÃighbÜ_li¡
[
Ÿtm
][
j
];

457 
j–em
=
evec
[
j©m
];

459 
rsq
=
Algeb¿
::
DX_RSQ
<
__dim__
>(
xvec
+
Ÿtm
*__dim__,xvec+
j©m
*__dim__,
dx_ij
);

460 if(
rsq
>=
cut_sq
[
›Ëm
][
j–em
]) ;

462 
r
=
	`sq¹
(
rsq
);

463 
drho_ji
=
	`ÿlc_drho
(
j–em
,
›Ëm
,
r
);

464 
drho_ij
=
	`ÿlc_drho
(
›Ëm
,
j–em
,
r
);

465 
åaœ
=-(
	`ÿlc_dF
(
›Ëm
,
rho
[
Ÿtm
])*
drho_ji
+ÿlc_dF(
j–em
,rho[
j©m
])*
drho_ij
+
	`ÿlc_dphi
(›Ëm,j–em,
r
))/r;

466 if(
åaœ
==0.0) ;

468 
Algeb¿
::
V_add_x_mul_V
<
__dim__
>(
åaœ
,
dx_ij
,
fvec
+
Ÿtm
*__dim__);

469 
Algeb¿
::
DyadicV
<
__dim__
>(
drho_ji
/
r
,
dx_ij
,
S
+
__nvoigt__
*
Ÿtm
);

470 if(
j©m
<
Çtms_lş
)

472 
Algeb¿
::
V_add_x_mul_V
<
__dim__
>(-
åaœ
,
dx_ij
,
fvec
+
j©m
*__dim__);

473 
Algeb¿
::
DyadicV
<
__dim__
>(
drho_ij
/
r
,
dx_ij
,
S
+
__nvoigt__
*
j©m
);

476 
åaœ
*=0.5;

485 
	}
}

489 
	gFÜûF›ldEAMF™
::
	$š™
()

491 
	`´e_š™
();

492 
rho_±r
=
Ãw
 
Vec
<
ty³0
>(
©oms
,1,"rho");

493 
S_±r
=
Ãw
 
Vec
<
ty³0
>(
©oms
,1+
__nvoigt__
);

494 
	}
}

498 
	gFÜûF›ldEAMF™
::
	$fš
()

500 
d–‘e
 
S_±r
;

501 
d–‘e
 
rho_±r
;

502 
	`po¡_fš
();

503 
	}
}

507 
	gFÜûF›ldEAMF™
::
	$š™_xchng
()

509 
	}
}

513 
FÜûF›ldEAMF™
::
	$fš_xchng
()

515 
	}
}

519 
FÜûF›ldEAMF™
::
	$´e_xchng_’”gy
(
GCMC
*)

521 
	}
}

525 
ty³0
 
FÜûF›ldEAMF™
::
	$xchng_’”gy
(
GCMC
*)

528 
	}
}

532 
	gFÜûF›ldEAMF™
::
	$po¡_xchng_’”gy
(
GCMC
*)

534 
	}
}

538 
FÜûF›ldEAMF™
::
drho_A
(
–em_ty³
 
i
,–em_ty³ 
j
,
ty³0
 
A
,ty³0 
R
,ty³0(&
tmp_vec
)[1+
__nvoigt__
])

540 
	gVec
<
	gty³0
>* 
	gDrho_±r
=
Ãw
 
Vec
<
ty³0
>(
©oms
,1);

542 
ty³0
* 
	gxvec
=
©oms
->
x
->
begš
();

543 
–em_ty³
* 
	gevec
=
©oms
->
–em
->
begš
();

544 
ty³0
* 
	gDrho
=
Drho_±r
->
begš
();

545 
ty³0
* 
	grho
=
rho_±r
->
begš
();

546 
ty³0
* 
	gS
=
S_±r
->
begš
();

548 
	gŸtm
,
	gj©m
;

549 
–em_ty³
 
	g›Ëm
,
	gj–em
;

550 
ty³0
 
	gr
;

551 
ty³0
 
	gDrho_ij
,
	gDdrho_ij
;

552 
ty³0
 
	gdx_ij
[
__dim__
];

554 ** 
	gÃighbÜ_li¡
=
ÃighbÜ
->
ÃighbÜ_li¡
;

555 * 
	gÃighbÜ_li¡_size
=
ÃighbÜ
->
ÃighbÜ_li¡_size
;

556 cÚ¡ 
	gÇtms_lş
=
©oms
->
Çtms_lş
;

557 
	gi
=0;i<
	gÇtms_lş
;i++)

558 
	gDrho
[
i
]=0.0;

560 
ty³0
 
	gtmp_vec_lş
[1+
__nvoigt__
];

561 
	gAlgeb¿
::
z”o
<1+
__nvoigt__
>(
tmp_vec_lş
);

564 
	gŸtm
=0;Ÿtm<
	gÇtms_lş
;iatm++)

566 
	g›Ëm
=
evec
[
Ÿtm
];

567 
	g__j
=0;__j<
	gÃighbÜ_li¡_size
[
Ÿtm
];__j++)

569 
	gj©m
=
ÃighbÜ_li¡
[
Ÿtm
][
__j
];

570 
	gj–em
=
evec
[
j©m
];

572 if(!((
	g›Ëm
==
i
 && 
j–em
==
j
è|| (
›Ëm
==j && jelem==i))) ;

573 
	gr
=
sq¹
(
Algeb¿
::
DX_RSQ
<
__dim__
>(
xvec
+
Ÿtm
*__dim__,xvec+
j©m
*__dim__,
dx_ij
));

574 if(
	gr
>=
R
) ;

576 
	gDrho_ij
=(
R
-
r
)*(R-r)*(R-r);

577 
	gDdrho_ij
=-3.0*(
R
-
r
)*(R-r);

579 if(
	g›Ëm
==
j
)

581 
Drho
[
Ÿtm
]+=
Drho_ij
;

582 
	gAlgeb¿
::
DyadicV
<
__dim__
>(
Ddrho_ij
*
ÿlc_dF
(
j
,
rho
[
Ÿtm
])/
	gr
,
	gdx_ij
,&
	gtmp_vec_lş
[1]);

585 if(
	gj©m
<
	gÇtms_lş
 && 
	gj–em
==
j
)

587 
Drho
[
j©m
]+=
Drho_ij
;

588 
	gAlgeb¿
::
DyadicV
<
__dim__
>(
Ddrho_ij
*
ÿlc_dF
(
j
,
rho
[
j©m
])/
	gr
,
	gdx_ij
,&
	gtmp_vec_lş
[1]);

592 if(
	gj
==
›Ëm
)

594 
Algeb¿
::
V_add_x_mul_V
<
__nvoigt__
>(
Drho
[
Ÿtm
]*
ÿlc_ddF
(
j
,
rho
[Ÿtm]),
S
+Ÿtm*__nvoigt__,&
tmp_vec_lş
[1]);

595 
	gtmp_vec_lş
[0]+=
ÿlc_dF
(
j
,
rho
[
Ÿtm
])*
	gDrho
[iatm];

647 
MPI_AÎ»duû
(
tmp_vec_lş
,
tmp_vec
,
__nvoigt__
+1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

648 cÚ¡ 
ty³0
 
	gvŞ
=
©oms
->
vŞ
;

649 
	gAlgeb¿
::
Do
<
__nvoigt__
>::
func
([&
tmp_vec
,&
vŞ
](
i
){tmp_vec[i+1]/=vol;});

654 
	gFÜûF›ldEAMF™
::
dphi_A
(
–em_ty³
 
i
,–em_ty³ 
j
,
ty³0
 
A
,ty³0 
R
,ty³0(&
tmp_vec
)[1+
__nvoigt__
])

656 
ty³0
* 
	gxvec
=
©oms
->
x
->
begš
();

657 
–em_ty³
* 
	gevec
=
©oms
->
–em
->
begš
();

660 
	gŸtm
,
	gj©m
;

661 
–em_ty³
 
	g›Ëm
,
	gj–em
;

662 
ty³0
 
	gr
;

663 
ty³0
 
	gDphi_ij
,
	gDdphi_ij
;

664 
ty³0
 
	gdx_ij
[
__dim__
];

666 ** 
	gÃighbÜ_li¡
=
ÃighbÜ
->
ÃighbÜ_li¡
;

667 * 
	gÃighbÜ_li¡_size
=
ÃighbÜ
->
ÃighbÜ_li¡_size
;

668 cÚ¡ 
	gÇtms_lş
=
©oms
->
Çtms_lş
;

669 
ty³0
 
	gtmp_vec_lş
[1+
__nvoigt__
];

670 
	gAlgeb¿
::
z”o
<1+
__nvoigt__
>(
tmp_vec_lş
);

672 
	gŸtm
=0;Ÿtm<
	gÇtms_lş
;iatm++)

674 
	g›Ëm
=
evec
[
Ÿtm
];

675 
	g__j
=0;__j<
	gÃighbÜ_li¡_size
[
Ÿtm
];__j++)

677 
	gj©m
=
ÃighbÜ_li¡
[
Ÿtm
][
__j
];

678 
	gj–em
=
evec
[
j©m
];

680 if(!((
	g›Ëm
==
i
 && 
j–em
==
j
è|| (
›Ëm
==j && jelem==i))) ;

681 
	gr
=
sq¹
(
Algeb¿
::
DX_RSQ
<
__dim__
>(
xvec
+
Ÿtm
*__dim__,xvec+
j©m
*__dim__,
dx_ij
));

682 if(
	gr
>=
R
) ;

684 
	gDphi_ij
=(
R
-
r
)*(R-r)*(R-r);

685 
	gDdphi_ij
=-3.0*(
R
-
r
)*(R-r);

688 if(
	gj©m
<
	gÇtms_lş
)

690 
	gtmp_vec_lş
[0]+=
Dphi_ij
;

691 
	gAlgeb¿
::
DyadicV
<
__dim__
>(
Ddphi_ij
/
r
,
	gdx_ij
,&
	gtmp_vec_lş
[1]);

695 
	gtmp_vec_lş
[0]+=0.5*
Dphi_ij
;

696 
	gAlgeb¿
::
DyadicV
<
__dim__
>(0.5*
Ddphi_ij
/
r
,
	gdx_ij
,&
	gtmp_vec_lş
[1]);

703 
MPI_AÎ»duû
(
tmp_vec_lş
,
tmp_vec
,
__nvoigt__
+1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

704 cÚ¡ 
ty³0
 
	gvŞ
=
©oms
->
vŞ
;

705 
	gAlgeb¿
::
Do
<
__nvoigt__
>::
func
([&
tmp_vec
,&
vŞ
](
i
){tmp_vec[i+1]/=vol;});

711 
	gFÜûF›ldEAMF™
::
dFH_A
(
ty³0
(&
tmp_A_vec
)[1+
__nvoigt__
],ty³0(&
tmp_rho0_vec
)[1+__nvoigt__],ty³0(&
tmp_®pha_vec
)[1+__nvoigt__])

714 
ty³0
* 
	gS
=
S_±r
->
begš
();

717 
–em_ty³
* 
	gevec
=
©oms
->
–em
->
begš
();

718 
ty³0
* 
	grho
=
rho_±r
->
begš
();

722 
	gŸtm
;

723 
–em_ty³
 
	g›Ëm
;

724 
ty³0
 
	gDFH_DA
,
	gDFH_Drho0
,
	gDFH_D®pha
;

725 
ty³0
 
	gDdFH_DA
,
	gDdFH_Drho0
,
	gDdFH_D®pha
;

731 cÚ¡ 
	gÇtms_lş
=
©oms
->
Çtms_lş
;

733 
ty³0
 
	gtmp_A_vec_lş
[1+
__nvoigt__
];

734 
	gAlgeb¿
::
z”o
<1+
__nvoigt__
>(
tmp_A_vec_lş
);

735 
ty³0
 
	gtmp_rho0_vec_lş
[1+
__nvoigt__
];

736 
	gAlgeb¿
::
z”o
<1+
__nvoigt__
>(
tmp_rho0_vec_lş
);

737 
ty³0
 
	gtmp_®pha_vec_lş
[1+
__nvoigt__
];

738 
	gAlgeb¿
::
z”o
<1+
__nvoigt__
>(
tmp_®pha_vec_lş
);

741 
	gŸtm
=0;Ÿtm<
	gÇtms_lş
;iatm++)

743 
	g›Ëm
=
evec
[
Ÿtm
];

744 if(
	g›Ëm
!=1) ;

746 
ÿlc_DFH
(
rho
[
Ÿtm
],
DFH_DA
,
DFH_Drho0
,
DFH_D®pha
);

747 
ÿlc_DdFH
(
rho
[
Ÿtm
],
DdFH_DA
,
DdFH_Drho0
,
DdFH_D®pha
);

748 
	gtmp_A_vec_lş
[0]+=
DFH_DA
;

749 
	gAlgeb¿
::
V_add_x_mul_V
<
__nvoigt__
>(
DdFH_DA
,
	gS
+
Ÿtm
*
	g__nvoigt__
,&
	gtmp_A_vec_lş
[1]);

750 
	gtmp_rho0_vec_lş
[0]+=
DFH_Drho0
;

751 
	gAlgeb¿
::
V_add_x_mul_V
<
__nvoigt__
>(
DdFH_Drho0
,
	gS
+
Ÿtm
*
	g__nvoigt__
,&
	gtmp_rho0_vec_lş
[1]);

752 
	gtmp_®pha_vec_lş
[0]+=
DFH_D®pha
;

753 
	gAlgeb¿
::
V_add_x_mul_V
<
__nvoigt__
>(
DdFH_D®pha
,
	gS
+
Ÿtm
*
	g__nvoigt__
,&
	gtmp_®pha_vec_lş
[1]);

790 
MPI_AÎ»duû
(
tmp_A_vec_lş
,
tmp_A_vec
,
__nvoigt__
+1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

791 
MPI_AÎ»duû
(
tmp_rho0_vec_lş
,
tmp_rho0_vec
,
__nvoigt__
+1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

792 
MPI_AÎ»duû
(
tmp_®pha_vec_lş
,
tmp_®pha_vec
,
__nvoigt__
+1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

795 cÚ¡ 
ty³0
 
	gvŞ
=
©oms
->
vŞ
;

796 
	gAlgeb¿
::
Do
<
__nvoigt__
>::
func
([&
tmp_A_vec
,&
tmp_rho0_vec
,&
tmp_®pha_vec
,&
vŞ
](
i
)

797 {
tmp_A_vec
[
i
+1]/=
vŞ
; 
tmp_rho0_vec
[i+1]/=vŞ; 
tmp_®pha_vec
[i+1]/=vol;});

803 
	gFÜûF›ldEAMF™
::
ÿlc_d”iv
(

804 
boŞ
***& 
Arho_dof
,
ty³0
 (***& 
DArho
)[1+
__nvoigt__
],

805 
boŞ
***& 
Aphi_dof
,
ty³0
 (***& 
DAphi
)[1+
__nvoigt__
],

806 
boŞ
**& 
AF_dof
,
ty³0
 (**& 
DAF
)[1+
__nvoigt__
])

810 
´•4d”iv
();

811 
–em_ty³
 
	gÃËms
=2;

812 
–em_ty³
 
	g›Ëm
=0;›Ëm<
	gÃËms
;ielem++)

813 
–em_ty³
 
	gj–em
=0;j–em<
	gÃËms
;jelem++)

814 
size_t
 
	gi
=0;i<
	grho_sz
[
›Ëm
][
j–em
];i++)

816 if(
	gArho_dof
[
›Ëm
][
j–em
][
i
])

817 
drho_A
(
›Ëm
,
j–em
,
rho_A
[›Ëm][j–em][
i
],
rho_R
[›Ëm][j–em][i],
DArho
[ielem][jelem][i]);

819 
	gAlgeb¿
::
z”o
<1+
__nvoigt__
>(
DArho
[
›Ëm
][
j–em
][
i
]);

822 
–em_ty³
 
	g›Ëm
=0;›Ëm<
	gÃËms
;ielem++)

823 
–em_ty³
 
	gj–em
=0;j–em<
	g›Ëm
+1;jelem++)

824 
size_t
 
	gi
=0;i<
	gphi_sz
[
›Ëm
][
j–em
];i++)

826 if(
	gAphi_dof
[
›Ëm
][
j–em
][
i
])

827 
dphi_A
(
›Ëm
,
j–em
,
phi_A
[›Ëm][j–em][
i
],
phi_R
[›Ëm][j–em][i],
DAphi
[ielem][jelem][i]);

829 
	gAlgeb¿
::
z”o
<1+
__nvoigt__
>(
DAphi
[
›Ëm
][
j–em
][
i
]);

830 if(
	g›Ëm
!=
j–em
)

831 
Algeb¿
::
V_eq
<1+
__nvoigt__
>(
DAphi
[
›Ëm
][
j–em
][
i
],
	gDAphi
[jelem][ielem][i]);

834 
size_t
 
	gi
=0;i<3;i++)

836 
	gAlgeb¿
::
z”o
<1+
__nvoigt__
>(
DAF
[0][
i
]);

837 
	gAlgeb¿
::
z”o
<1+
__nvoigt__
>(
DAF
[1][
i
]);

839 if(
	gAF_dof
[1][0] || AF_dof[1][1] || AF_dof[1][2])

841 
dFH_A
(
DAF
[1][0],DAF[1][1],DAF[1][2]);

843 
size_t
 
	gi
=0;i<3;i++)

844 if(!
	gAF_dof
[1][
i
])

845 
	gAlgeb¿
::
z”o
<1+
__nvoigt__
>(
DAF
[1][
i
]);

852 
size_t
 
	gFÜûF›ldEAMF™
::
	$g‘_rFeH
(
ty³0
*& 
Rs
,*& 
Ns
)

856 
ty³0
* 
xvec
=
©oms
->
x
->
	`begš
();

857 
ty³0
* 
rho
=
rho_±r
->
	`begš
();

858 
–em_ty³
* 
evec
=
©oms
->
–em
->
	`begš
();

860 
Ÿtm
,
j©m
;

861 
–em_ty³
 
›Ëm
,
j–em
;

862 
ty³0
 
r
,
rsq
;

864 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->neighbor_list;

865 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->neighbor_list_size;

866 cÚ¡ 
Çtms_lş
=
©oms
->natms_lcl;

867 
i
=0;i<
Çtms_lş
;i++)

868 
rho
[
i
]=0.0;

870 
ty³0
* 
rs_lş
=
NULL
;

871 
MemÜy
::
	`®loc
(
rs_lş
,
Çtms_lş
);

872 
n_lş
=0;

874 
Ÿtm
=0;Ÿtm<
Çtms_lş
;iatm++)

876 
›Ëm
=
evec
[
Ÿtm
];

877 
j
=0;j<
ÃighbÜ_li¡_size
[
Ÿtm
];j++)

879 
j©m
=
ÃighbÜ_li¡
[
Ÿtm
][
j
];

880 
j–em
=
evec
[
j©m
];

881 if(!((
›Ëm
==1&&
j–em
==0è|| ((›Ëm==0&&j–em==1)&&
j©m
<
Çtms_lş
))) ;

887 
rsq
=
Algeb¿
::
RSQ
<
__dim__
>(
xvec
+
Ÿtm
*__dim__,xvec+
j©m
*__dim__);

888 if(
rsq
>=
cut_sq
[
›Ëm
][
j–em
]) ;

889 
r
=
	`sq¹
(
rsq
);

891 
rs_lş
[
n_lş
++]=
r
;

897 
n
;

898 
	`MPI_AÎ»duû
(&
n_lş
,&
n
,1,
Vec
<>::
MPI_T
,
MPI_SUM
,
wÜld
);

899 
ty³0
* 
rs
=
NULL
;

900 
MemÜy
::
	`®loc
(
rs
,
n
);

901 
__n_lş
;

902 
ty³0
* 
__rs
=
rs
;

903 
i
=0;i<
©oms
->
comm_size
;i++)

905 
__n_lş
=
n_lş
;

906 
	`MPI_Bÿ¡
(&
__n_lş
,1,
Vec
<>::
MPI_T
,
i
,
wÜld
);

907 if(
©oms
->
comm_¿nk
==
i
)

908 
	`memıy
(
__rs
,
rs_lş
,
__n_lş
*(
ty³0
));

910 
	`MPI_Bÿ¡
(
__rs
,
__n_lş
,
Vec
<
ty³0
>::
MPI_T
,
i
,
wÜld
);

911 
__rs
+=
__n_lş
;

913 
MemÜy
::
	`d—Îoc
(
rs_lş
);

915 
XM©h
::
	`quicksÜt
(
rs
,rs+
n
,

916 [](
ty³0
* 
r_i
,ty³0* 
r_j
)

917 { (*
r_i
<*
r_j
);},

918 [](
ty³0
* 
r_i
,ty³0* 
r_j
)

920 
¡d
::
	`sw­
(*
r_i
,*
r_j
);

923 
ty³0
 
tŞ
=1.0e-5;

924 
i0
=0,
i1
=0;

925 
ty³0
 
r0
,
n0
;

926 
size_t
 
sz
=0;

928 
ty³0
* 
__Rs
=
NULL
;

929 
MemÜy
::
	`®loc
(
__Rs
,
n
);

930 * 
__Ns
=
NULL
;

931 
MemÜy
::
	`®loc
(
__Ns
,
n
);

933 
i0
<
n
)

935 
r0
=0.0;

936 
n0
=0.0;

937 
i1
<
n
 && 
	`çbs
(
rs
[i1]-rs[
i0
])<
tŞ
)

939 
r0
+=
rs
[
i1
];

940 
n0
++;

941 
i1
++;

943 
r0
/=
n0
;

945 
__Rs
[
sz
]=
r0
;

946 
__Ns
[
sz
]=
¡©ic_ÿ¡
<>(
n0
);

947 
sz
++;

948 
i0
=
i1
;

950 
MemÜy
::
	`d—Îoc
(
rs
);

952 
Rs
=
NULL
;

953 
MemÜy
::
	`®loc
(
Rs
,
sz
);

954 
Ns
=
NULL
;

955 
MemÜy
::
	`®loc
(
Ns
,
sz
);

956 
	`memıy
(
Rs
,
__Rs
,
sz
*(
ty³0
));

957 
	`memıy
(
Ns
,
__Ns
,
sz
*());

959 
MemÜy
::
	`d—Îoc
(
__Rs
);

960 
MemÜy
::
	`d—Îoc
(
__Ns
);

963  
sz
;

967 
	}
}

978 
ty³0
 
	gFÜûF›ldEAMF™
::
	$ÿlc_F
(
–em_ty³
 
i
,
ty³0
 
rho
)

980 if(
i
==0)

981  
F_A
[0][0]*
	`sq¹
(
rho
)+F_A[0][1]*rho*rho+F_A[0][2]*rho*rho*rho*rho;

983 
ty³0
 
rhob
=
rho
/
F_A
[1][1];

984 
ty³0
 
‘a
=
	`pow
(
rhob
,
F_A
[1][2]);

985 
ty³0
 
çÍha
=
	`pow
((1.0-3.0/(2.0*
F_A
[1][2]-1.0))/4.0,1.0-2.0/F_A[1][2]);

986  
F_A
[1][0]*(
‘a
*Ó-2.0)+
çÍha
*
rhob
*rhob);

988 
	}
}

992 
ty³0
 
	gFÜûF›ldEAMF™
::
	$ÿlc_dF
(
–em_ty³
 
i
,
ty³0
 
rho
)

994 if(
i
==0)

995  0.5*
F_A
[0][0]/
	`sq¹
(
rho
)+2.0*F_A[0][1]*rho+4.0*F_A[0][2]*rho*rho*rho;

996 if(
rho
==0.0)  0.0;

997 
ty³0
 
rhob
=
rho
/
F_A
[1][1];

998 
ty³0
 
‘a
=
	`pow
(
rhob
,
F_A
[1][2]);

999 
ty³0
 
çÍha
=
	`pow
((1.0-3.0/(2.0*
F_A
[1][2]-1.0))/4.0,1.0-2.0/F_A[1][2]);

1000  2.0*
F_A
[1][0]*(F_A[1][2]*
‘a
*Ó-1.0)+
çÍha
*
rhob
*rhob)/
rho
;

1001 
	}
}

1005 
ty³0
 
	gFÜûF›ldEAMF™
::
	$ÿlc_ddF
(
–em_ty³
 
i
,
ty³0
 
rho
)

1007 if(
i
==0)

1008  -0.25*
F_A
[0][0]/
	`sq¹
(
rho
*rho*rho)+2.0*F_A[0][1]+12.0*F_A[0][2]*rho*rho;

1009 if(
rho
==0.0)  0.0;

1010 
ty³0
 
rhob
=
rho
/
F_A
[1][1];

1011 
ty³0
 
‘a
=
	`pow
(
rhob
,
F_A
[1][2]);

1012 
ty³0
 
çÍha
=
	`pow
((1.0-3.0/(2.0*
F_A
[1][2]-1.0))/4.0,1.0-2.0/F_A[1][2]);

1013  2.0*
F_A
[1][0]*(F_A[1][2]*
‘a
*((2.0*F_A[1][2]-1.0)*‘a+1.0-F_A[1][2])+
çÍha
*
rhob
*rhob)/(
rho
*rho);

1015 
	}
}

1019 
	gFÜûF›ldEAMF™
::
	$ÿlc_DFH
(
ty³0
& 
rho
,ty³0& 
DF_DA
,ty³0& 
DF_Drho0
,ty³0& 
DF_D®pha
)

1021 if(
rho
==0.0)

1023 
DF_DA
=0.0;

1024 
DF_Drho0
=0.0;

1025 
DF_D®pha
=0.0;

1028 
ty³0
 
rhob
=
rho
/
F_A
[1][1];

1029 
ty³0
 
‘a
=
	`pow
(
rhob
,
F_A
[1][2]);

1030 
ty³0
 
çÍha
=
	`pow
((1.0-3.0/(2.0*
F_A
[1][2]-1.0))/4.0,1.0-2.0/F_A[1][2]);

1031 
ty³0
 
dlogçÍha
=(2.0*
	`log
((1.0-3.0/(2.0*
F_A
[1][2]-1.0))/4.0)/F_A[1][2]+3.0/(2.0*F_A[1][2]-1.0))/F_A[1][2];

1032 
DF_DA
=
‘a
*Ó-2.0)+
çÍha
*
rhob
*rhob;

1033 
DF_Drho0
=-2.0*
F_A
[1][0]*(F_A[1][2]*
‘a
*Ó-1.0)+
çÍha
*
rhob
*rhob)/F_A[1][1];

1034 
DF_D®pha
=
F_A
[1][0]*(2.0*
‘a
*Ó-1.0)*
	`log
(
rhob
)+
dlogçÍha
*
çÍha
*rhob*rhob);

1035 
	}
}

1039 
	gFÜûF›ldEAMF™
::
	$ÿlc_DdFH
(
ty³0
& 
rho
,ty³0& 
DdF_DA
,ty³0& 
DdF_Drho0
,ty³0& 
DdF_D®pha
)

1041 if(
rho
==0.0)

1043 
DdF_DA
=0.0;

1044 
DdF_Drho0
=0.0;

1045 
DdF_D®pha
=0.0;

1048 
ty³0
 
rhob
=
rho
/
F_A
[1][1];

1049 
ty³0
 
‘a
=
	`pow
(
rhob
,
F_A
[1][2]);

1050 
ty³0
 
çÍha
=
	`pow
((1.0-3.0/(2.0*
F_A
[1][2]-1.0))/4.0,1.0-2.0/F_A[1][2]);

1051 
ty³0
 
dlogçÍha
=(2.0*
	`log
((1.0-3.0/(2.0*
F_A
[1][2]-1.0))/4.0)/F_A[1][2]+3.0/(2.0*F_A[1][2]-1.0))/F_A[1][2];

1052 
DdF_DA
=2.0*(
F_A
[1][2]*
‘a
*Ó-1.0)+
çÍha
*
rhob
*rhob)/
rho
;

1053 
DdF_Drho0
=-2.0*
F_A
[1][0]*(F_A[1][2]*F_A[1][2]*
‘a
*(2.0*eta-1.0)

1054 +2.0*
çÍha
*
rhob
*rhob)/(
F_A
[1][1]*
rho
);

1055 
DdF_D®pha
=2.0*
F_A
[1][0]*(
‘a
*((1.0+F_A[1][2]*
	`log
(
rhob
))*(2.0*‘a-1.0)-‘a)+
dlogçÍha
*
çÍha
*rhob*rhob)/
rho
;

1056 
	}
}

1060 
ty³0
 
	gFÜûF›ldEAMF™
::
	$EHH
(
ty³0
 
r
)

1062 if(
r
>=2.8)  0.0;

1064  1.2105506230313432 + (33.34234844583974 - 97.08416920979838*
r
)*
	`exp
(-2.5871227340727088*r)- 0.3714821016657931*r;

1065 
	}
}

1069 
ty³0
 
	gFÜûF›ldEAMF™
::
	$dEHH
(
ty³0
 
r
)

1071 if(
r
>=2.8)  0.0;

1073  -0.3714821016657931 + (-183.34491688140423 + 251.16866128123107*
r
)*
	`exp
(-2.5871227340727088*r);

1074 
	}
}

1078 
ty³0
 
	gFÜûF›ldEAMF™
::
	$ddEHH
(
ty³0
 
r
)

1080 if(
r
>=2.8)  0.0;

1082  (725.5044639217831 - 649.8041536872805*
r
)*
	`exp
(-2.5871227340727088*r);

1083 
	}
}

1087 
ty³0
 
	gFÜûF›ldEAMF™
::
	$ÿlc_rho
(
–em_ty³
 
i
,–em_ty³ 
j
,
ty³0
 
r
)

1089 if(
r
>=
rho_cut
[
i
][
j
])  0.0;

1090 
ty³0
 
ªs
=0.0;

1091 
size_t
 
__i
=0;__i<
rho_sz
[
i
][
j
] && 
r
<
rho_R
[i][j][__i];__i++)

1092 
ªs
+=
rho_A
[
i
][
j
][
__i
]*(
rho_R
[i][j][__i]-
r
)*(rho_R[i][j][__i]-r)*(rho_R[i][j][__i]-r);

1093  
ªs
;

1094 
	}
}

1098 
ty³0
 
	gFÜûF›ldEAMF™
::
	$ÿlc_drho
(
–em_ty³
 
i
,–em_ty³ 
j
,
ty³0
 
r
)

1100 if(
r
>=
rho_cut
[
i
][
j
])  0.0;

1101 
ty³0
 
ªs
=0.0;

1102 
size_t
 
__i
=0;__i<
rho_sz
[
i
][
j
] && 
r
<
rho_R
[i][j][__i];__i++)

1103 
ªs
-=3.0*
rho_A
[
i
][
j
][
__i
]*(
rho_R
[i][j][__i]-
r
)*(rho_R[i][j][__i]-r);

1104  
ªs
;

1105 
	}
}

1109 
ty³0
 
	gFÜûF›ldEAMF™
::
	$ÿlc_phi
(
–em_ty³
 
i
,–em_ty³ 
j
,
ty³0
 
r
)

1111 if(
r
>=
phi_cut
[
i
][
j
])  0.0;

1119 
ty³0
 
ªs
=0.0;

1120 
size_t
 
__i
=0;__i<
phi_sz
[
i
][
j
] && 
r
<
phi_R
[i][j][__i];__i++)

1121 
ªs
+=
phi_A
[
i
][
j
][
__i
]*(
phi_R
[i][j][__i]-
r
)*(phi_R[i][j][__i]-r)*(phi_R[i][j][__i]-r);

1122  
ªs
;

1124 
	}
}

1128 
ty³0
 
	gFÜûF›ldEAMF™
::
	$ÿlc_dphi
(
–em_ty³
 
i
,–em_ty³ 
j
,
ty³0
 
r
)

1130 if(
r
>=
phi_cut
[
i
][
j
])  0.0;

1139 
ty³0
 
ªs
=0.0;

1140 
size_t
 
__i
=0;__i<
phi_sz
[
i
][
j
] && 
r
<
phi_R
[i][j][__i];__i++)

1141 
ªs
-=3.0*
phi_A
[
i
][
j
][
__i
]*(
phi_R
[i][j][__i]-
r
)*(phi_R[i][j][__i]-r);

1142  
ªs
;

1144 
	}
}

1177 
	gFÜûF›ldEAMF™
::
	$ml_Ãw
(
PyM‘hodDef
& 
_m‘hods
)

1179 
_m‘hods
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

1180 
_m‘hods
.
ml_Çme
="ff_eam_fit";

1182 
_m‘hods
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

1183 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

1185 
AtomsMD
::
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<AtomsMD::Objeù*>(
£lf
);

1187 
FuncAPI
<
	`ty³0
(***)[2],
symm
<ty³0(***)[2]>,ty³0(*)[3]>
	`f
("ff_eam_fit",{"rho_AR","phi_AR","F_A"});

1190 cÚ¡ 
size_t
 
ÃËms
=
__£lf
->
©oms
->
–em’ts
.nelems;

1191 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

1193 
size_t
** 
rho_sz
=
NULL
;

1194 
MemÜy
::
	`®loc
(
rho_sz
,
ÃËms
,nelems);

1195 
size_t
** 
phi_sz
=
NULL
;

1196 
MemÜy
::
	`®loc
(
phi_sz
,
ÃËms
,nelems);

1197 
size_t
 
›Ëm
=0;›Ëm<
ÃËms
;ielem++)

1198 
size_t
 
j–em
=0;j–em<
ÃËms
;jelem++)

1200 
rho_sz
[
›Ëm
][
j–em
]=
f
.
v
<0>()[›Ëm][j–em].
size
;

1201 
phi_sz
[
›Ëm
][
j–em
]=
f
.
v
<1>()[›Ëm][j–em].
size
;

1205 
d–‘e
 
__£lf
->
ff
;

1206 
__£lf
->
ff
=
Ãw
 
	`FÜûF›ldEAMF™
(__£lf->
©oms
,
f
.
mov
<0>(),
¡d
::
	`move
(
rho_sz
),f.mov<1>(),¡d::move(
phi_sz
),f.mov<2>());

1208 
Py_RETURN_NONE
;

1211 
_m‘hods
.
ml_doc
=(*)"";

1212 
	}
}

	@ff_eam_fit.h

1 #iâdeà
__MAPP__ff_—m_f™__


2 
	#__MAPP__ff_—m_f™__


	)

3 
	~"ff_md.h
"

4 
Çme¥aû
 
	gMAPP_NS


6 şas 
	cFÜûF›ldEAMF™
: 
public
 
FÜûF›ldMD


8 
´iv©e
:

9 
´Ùeùed
:

10 
__fÜû_ÿlc
();

11 
__’”gy_ÿlc
();

12 
´e_xchng_’”gy
(
GCMC
*);

13 
ty³0
 
xchng_’”gy
(
GCMC
*);

14 
po¡_xchng_’”gy
(
GCMC
*);

15 
	gpublic
:

16 
FÜûF›ldEAMF™
(
şass
 
AtomsMD
*,
ty³0
(***&&)[2],
size_t
**&&,type0(***&&)[2],size_t**&&,type0(*&&)[3]);

17 
FÜûF›ldEAMF™
(
şass
 
AtomsMD
*,
ty³0
***&,ty³0***&,
size_t
**&,type0***&,type0***&,size_t**&,type0**&);

18 ~
FÜûF›ldEAMF™
();

20 
ml_Ãw
(
PyM‘hodDef
&);

21 
š™
();

22 
fš
();

23 
š™_xchng
();

24 
fš_xchng
();

25 
ÿlc_d”iv
(
boŞ
***&,
ty³0
 (***&)[1+
__nvoigt__
]

26 ,
boŞ
***&,
ty³0
 (***&)[1+
__nvoigt__
]

27 ,
boŞ
**&,
ty³0
(**&)[1+
__nvoigt__
]);

28 
size_t
 
g‘_rFeH
(
ty³0
*&,*&);

43 
boŞ
 
	g®loc
;

44 
ty³0
 *** 
	grho_A
;

45 
ty³0
 *** 
	grho_R
;

46 
size_t
** 
	grho_sz
;

48 
ty³0
 *** 
	gphi_A
;

49 
ty³0
 *** 
	gphi_R
;

50 
size_t
** 
	gphi_sz
;

52 
ty³0
** 
	gF_A
;

54 
sÜt_AR_ij
(
ty³0
*&,ty³0*&,
size_t
);

55 
ty³0
** 
	grho_cut
;

56 
ty³0
** 
	gphi_cut
;

59 
	gVec
<
	gty³0
>* 
	grho_±r
;

60 
	gVec
<
	gty³0
>* 
	gS_±r
;

62 
´•4d”iv
();

64 
drho_A
(
–em_ty³
,–em_ty³,
ty³0
,ty³0,ty³0(&)[1+
__nvoigt__
]);

65 
dphi_A
(
–em_ty³
,–em_ty³,
ty³0
,ty³0,ty³0(&)[1+
__nvoigt__
]);

66 
dFH_A
(
ty³0
(&)[1+
__nvoigt__
],type0(&)[1+__nvoigt__],type0(&)[1+__nvoigt__]);

69 
ÿlc_DFH
(
ty³0
&,type0&,type0&,type0&);

70 
ÿlc_DdFH
(
ty³0
&,type0&,type0&,type0&);

71 
ty³0
 
EHH
(type0);

72 
ty³0
 
dEHH
(type0);

73 
ty³0
 
ddEHH
(type0);

77 
ty³0
 
ÿlc_F
(
–em_ty³
,type0);

78 
ty³0
 
ÿlc_dF
(
–em_ty³
,type0);

79 
ty³0
 
ÿlc_ddF
(
–em_ty³
,type0);

81 
ty³0
 
ÿlc_rho
(
–em_ty³
,elem_type,type0);

82 
ty³0
 
ÿlc_drho
(
–em_ty³
,elem_type,type0);

83 
ty³0
 
ÿlc_phi
(
–em_ty³
,elem_type,type0);

84 
ty³0
 
ÿlc_dphi
(
–em_ty³
,elem_type,type0);

	@ff_eam_fit_o.cpp

1 
	~"ff_—m_f™_o.h
"

2 
	~"ÃighbÜ_md.h
"

3 
	~"©oms_md.h
"

4 
	~"–em’ts.h
"

5 
	~"memÜy.h
"

6 
	~"dyÇmic_md.h
"

7 
	#rho_Fe_gauge
 26.0

	)

8 
ty³0
 
	gFÜûF›ldEAMF™O
::
rc_rho_H
=2.8;

9 
ty³0
 
	gFÜûF›ldEAMF™O
::
rc_rho_Fe
=4.2;

10 
ty³0
 
	gFÜûF›ldEAMF™O
::
rc_phi_FeFe
=5.3;

11 
ty³0
 
	gFÜûF›ldEAMF™O
::
rc_phi_FeH
=4.2;

12 
ty³0
 
	gFÜûF›ldEAMF™O
::
rc_phi_HH
=2.8;

14 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

15 
ty³0
 
	gFÜûF›ldEAMF™O
::
r0_FeFe
=1.0;

16 
ty³0
 
	gFÜûF›ldEAMF™O
::
r1_FeFe
=2.05;

17 
ty³0
 
	gFÜûF›ldEAMF™O
::
AR_rho_Fe
[3][2]=

18 {{11.686859407970/
rho_Fe_gauge
,2.4},

19 {-0.01471074009883/
rho_Fe_gauge
,3.2},

20 {0.47193527075943/
rho_Fe_gauge
,4.2}};

22 
ty³0
 
	gFÜûF›ldEAMF™O
::
AR_phi_FeFe
[13][2]=

36 
ty³0
 
	gFÜûF›ldEAMF™O
::
B_phi_FeFe
[4]={7.4122709384068,-0.64180690713367,-2.6043547961722,0.6262539393123};

37 
ty³0
 
	gFÜûF›ldEAMF™O
::
A_F_Fe
[3]={-1.0*
sq¹
(
rho_Fe_gauge
),-6.7314115586063e-4*rho_Fe_gauge*rho_Fe_gauge,7.6514905604792e-8*rho_Fe_gauge*rho_Fe_gauge*rho_Fe_gauge*rho_Fe_gauge};

38 #ifdeà
FeH_SPLINE


39 
ty³0
 
	gFÜûF›ldEAMF™O
::
R_phi_FeH
[
Åhi_FeH
]={1.1,1.2,1.3,1.4,1.5,1.6,1.7,1.8,2.0,2.2,2.4,2.6,2.8,3.0,3.3,3.6,3.9,4.2};

49 
	gFÜûF›ldEAMF™O
::
FÜûF›ldEAMF™O
(
AtomsMD
* 
__©oms
,

50 
ty³0
(&
__A_rho_H
)[
Äho_H
],ty³0(&
__A_phi_FeH
)[
Åhi_FeH
],ty³0(&
__A_phi_HH
)[
Åhi_HH
],ty³0(&
__A_F_H
)[
nF_H
]):

51 
	$FÜûF›ldMD
(
__©oms
)

53 
A_rho_H
=
v
+
rho_H_off£t
;

54 
A_phi_FeH
=
v
+
phi_FeH_off£t
;

55 
A_phi_HH
=
v
+
phi_HH_off£t
;

56 
A_F_H
=
v
+
F_H_off£t
;

58 
dA_rho_H
=
dv
+
rho_H_off£t
;

59 
dA_phi_FeH
=
dv
+
phi_FeH_off£t
;

60 
dA_phi_HH
=
dv
+
phi_HH_off£t
;

61 
dA_F_H
=
dv
+
F_H_off£t
;

64 
dA_rho_H_lş
=
dv_lş
+
rho_H_off£t
;

65 
dA_phi_FeH_lş
=
dv_lş
+
phi_FeH_off£t
;

66 
dA_phi_HH_lş
=
dv_lş
+
phi_HH_off£t
;

67 
dA_F_H_lş
=
dv_lş
+
F_H_off£t
;

71 
Algeb¿
::
V_eq
<
Äho_H
>(
__A_rho_H
,
A_rho_H
);

72 
Algeb¿
::
V_eq
<
Åhi_FeH
>(
__A_phi_FeH
,
A_phi_FeH
);

73 
Algeb¿
::
V_eq
<
Åhi_HH
>(
__A_phi_HH
,
A_phi_HH
);

74 
Algeb¿
::
V_eq
<
nF_H
>(
__A_F_H
,
A_F_H
);

76 if(
ÃËms
==2)

78 
cut
[0][0]=
rc_phi_FeFe
;

79 
cut
[0][1]=cut[1][0]=
rc_phi_FeH
;

80 
cut
[1][1]=
rc_phi_HH
;

83 
cut
[0][0]=
rc_phi_FeFe
;

85 
size_t
 
›Ëm
=0;›Ëm<
ÃËms
;ielem++)

86 
size_t
 
j–em
=
›Ëm
;j–em<
ÃËms
;jelem++)

87 
cut_sq
[
›Ëm
][
j–em
]=cut_sq[j–em][›Ëm]=
cut
[ielem][jelem]*cut[ielem][jelem];

90 
Algeb¿
::
Do
<
nHv¬s
>::
	`func
([
this
](
i
){
dof
[i]=
Œue
;});

92 
	}
}

96 
	gFÜûF›ldEAMF™O
::~
	$FÜûF›ldEAMF™O
()

99 
	}
}

103 
FÜûF›ldEAMF™O
::
	$__fÜû_ÿlc
()

105 
ty³0
* 
xvec
=
©oms
->
x
->
	`begš
();

106 
ty³0
* 
fvec
=
f
->
	`begš
();

107 
ty³0
* 
rho
=
rho_±r
->
	`begš
();

108 
–em_ty³
* 
evec
=
©oms
->
–em
->
	`begš
();

110 
Ÿtm
,
j©m
;

111 
–em_ty³
 
›Ëm
,
j–em
;

112 
ty³0
 
r
,
rsq
;

113 
ty³0
 
åaœ
;

114 
ty³0
 
dx_ij
[
__dim__
];

115 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->neighbor_list;

116 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->neighbor_list_size;

117 cÚ¡ 
Çtms_lş
=
©oms
->natms_lcl;

118 
i
=0;i<
Çtms_lş
;i++)

119 
rho
[
i
]=0.0;

121 
Ÿtm
=0;Ÿtm<
Çtms_lş
;iatm++)

124 
›Ëm
=
evec
[
Ÿtm
];

125 
j
=0;j<
ÃighbÜ_li¡_size
[
Ÿtm
];j++)

127 
j©m
=
ÃighbÜ_li¡
[
Ÿtm
][
j
];

128 
j–em
=
evec
[
j©m
];

129 
rsq
=
Algeb¿
::
RSQ
<
__dim__
>(
xvec
+
Ÿtm
*__dim__,xvec+
j©m
*__dim__);

130 if(
rsq
>=
cut_sq
[
›Ëm
][
j–em
]) ;

131 
r
=
	`sq¹
(
rsq
);

134 
rho
[
Ÿtm
]+=
	`ÿlc_rho
(
j–em
,
r
);

135 if(
j©m
<
Çtms_lş
)

137 
rho
[
j©m
]+=
	`ÿlc_rho
(
›Ëm
,
r
);

138 
__vec_lş
[0]+=
	`ÿlc_phi
(
›Ëm
,
j–em
,
r
);;

141 
__vec_lş
[0]+=0.5*
	`ÿlc_phi
(
›Ëm
,
j–em
,
r
);;

143 
__vec_lş
[0]+=
	`ÿlc_F
(
›Ëm
,
rho
[
Ÿtm
]);

146 
	`upd©e
(
rho_±r
);

149 
Ÿtm
=0;Ÿtm<
Çtms_lş
;iatm++)

151 
›Ëm
=
evec
[
Ÿtm
];

153 
j
=0;j<
ÃighbÜ_li¡_size
[
Ÿtm
];j++)

155 
j©m
=
ÃighbÜ_li¡
[
Ÿtm
][
j
];

156 
j–em
=
evec
[
j©m
];

158 
rsq
=
Algeb¿
::
DX_RSQ
<
__dim__
>(
xvec
+
Ÿtm
*__dim__,xvec+
j©m
*__dim__,
dx_ij
);

159 if(
rsq
>=
cut_sq
[
›Ëm
][
j–em
]) ;

161 
r
=
	`sq¹
(
rsq
);

162 
åaœ
=-(
	`ÿlc_dF
(
›Ëm
,
rho
[
Ÿtm
])*
	`ÿlc_drho
(
j–em
,
r
)+

163 
	`ÿlc_dF
(
j–em
,
rho
[
j©m
])*
	`ÿlc_drho
(
›Ëm
,
r
)+

164 
	`ÿlc_dphi
(
›Ëm
,
j–em
,
r
))/r;

166 if(
åaœ
==0.0) ;

168 
Algeb¿
::
V_add_x_mul_V
<
__dim__
>(
åaœ
,
dx_ij
,
fvec
+
Ÿtm
*__dim__);

169 if(
j©m
<
Çtms_lş
)

170 
Algeb¿
::
V_add_x_mul_V
<
__dim__
>(-
åaœ
,
dx_ij
,
fvec
+
j©m
*__dim__);

172 
åaœ
*=0.5;

174 
Algeb¿
::
DyadicV
<
__dim__
>(-
åaœ
,
dx_ij
,&
__vec_lş
[1]);

177 
ty³0
 
f_sum_lş
[
__dim__
];

178 
Algeb¿
::
z”o
<
__dim__
>(
f_sum_lş
);

179 
i
=0;i<
Çtms_lş
;i++)

180 
Algeb¿
::
V_add
<
__dim__
>(
fvec
+__dim__*
i
,
f_sum_lş
);

182 
ty³0
 
f_cÜr
[
__dim__
];

183 
	`MPI_AÎ»duû
(
f_sum_lş
,
f_cÜr
,
__dim__
,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

184 
ty³0
 
a
=-1.0/
¡©ic_ÿ¡
<ty³0>(
©oms
->
Çtms
);

185 
Algeb¿
::
Do
<
__dim__
>::
	`func
([&
a
,&
f_cÜr
](
i
){f_corr[i]*=a;});

186 
i
=0;i<
Çtms_lş
;i++)

187 
Algeb¿
::
V_add
<
__dim__
>(
f_cÜr
,
fvec
+__dim__*
i
);

188 
	}
}

194 
	gFÜûF›ldEAMF™O
::
	$__’”gy_ÿlc
()

196 
ty³0
* 
xvec
=
©oms
->
x
->
	`begš
();

197 
ty³0
* 
rho
=
rho_±r
->
	`begš
();

198 
–em_ty³
* 
evec
=
©oms
->
–em
->
	`begš
();

200 
Ÿtm
,
j©m
;

201 
–em_ty³
 
›Ëm
,
j–em
;

202 
ty³0
 
r
,
rsq
;

204 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->neighbor_list;

205 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->neighbor_list_size;

206 cÚ¡ 
Çtms_lş
=
©oms
->natms_lcl;

207 
i
=0;i<
Çtms_lş
;i++)

208 
rho
[
i
]=0.0;

210 
Ÿtm
=0;Ÿtm<
Çtms_lş
;iatm++)

212 
›Ëm
=
evec
[
Ÿtm
];

213 
j
=0;j<
ÃighbÜ_li¡_size
[
Ÿtm
];j++)

215 
j©m
=
ÃighbÜ_li¡
[
Ÿtm
][
j
];

216 
j–em
=
evec
[
j©m
];

217 
rsq
=
Algeb¿
::
RSQ
<
__dim__
>(
xvec
+
Ÿtm
*__dim__,xvec+
j©m
*__dim__);

218 if(
rsq
>=
cut_sq
[
›Ëm
][
j–em
]) ;

219 
r
=
	`sq¹
(
rsq
);

222 
rho
[
Ÿtm
]+=
	`ÿlc_rho
(
j–em
,
r
);

223 if(
j©m
<
Çtms_lş
)

225 
rho
[
j©m
]+=
	`ÿlc_rho
(
›Ëm
,
r
);

226 
__vec_lş
[0]+=
	`ÿlc_phi
(
›Ëm
,
j–em
,
r
);

229 
__vec_lş
[0]+=0.5*
	`ÿlc_phi
(
›Ëm
,
j–em
,
r
);

232 
__vec_lş
[0]+=
	`ÿlc_F
(
›Ëm
,
rho
[
Ÿtm
]);

234 
	}
}

238 
ty³0
 
	gFÜûF›ldEAMF™O
::
	$m—n_rho_H
()

240 
ty³0
* 
rho
=
rho_±r
->
	`begš
();

241 
–em_ty³
* 
evec
=
©oms
->
–em
->
	`begš
();

242 cÚ¡ 
Çtms_lş
=
©oms
->natms_lcl;

243 
ty³0
 
d©a_lş
[2]={0.0,0.0};

244 
ty³0
 
d©a
[2];

245 
i
=0;i<
Çtms_lş
;i++)

246 if(
evec
[
i
]==1)

248 
d©a_lş
[0]+=
rho
[
i
];

249 
d©a_lş
[1]++;

251 
	`MPI_AÎ»duû
(
d©a_lş
,
d©a
,2,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

252 if(
d©a
[1]==0.0)  0.0;

253  
d©a
[0]/data[1];

254 
	}
}

258 
	gFÜûF›ldEAMF™O
::
	$g¿d›Á
()

260 
Algeb¿
::
z”o
<
nHv¬s
>(
dv_lş
);

261 
ty³0
* 
xvec
=
©oms
->
x
->
	`begš
();

262 
ty³0
* 
rho
=
rho_±r
->
	`begš
();

263 
–em_ty³
* 
evec
=
©oms
->
–em
->
	`begš
();

265 
Ÿtm
,
j©m
;

266 
–em_ty³
 
›Ëm
,
j–em
;

267 
ty³0
 
r
,
rsq
,
dFi
;

269 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->neighbor_list;

270 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->neighbor_list_size;

271 cÚ¡ 
Çtms_lş
=
©oms
->natms_lcl;

272 
i
=0;i<
Çtms_lş
;i++)

273 
rho
[
i
]=0.0;

278 
Ÿtm
=0;Ÿtm<
Çtms_lş
;iatm++)

280 
›Ëm
=
evec
[
Ÿtm
];

281 
j
=0;j<
ÃighbÜ_li¡_size
[
Ÿtm
];j++)

283 
j©m
=
ÃighbÜ_li¡
[
Ÿtm
][
j
];

284 
j–em
=
evec
[
j©m
];

285 
rsq
=
Algeb¿
::
RSQ
<
__dim__
>(
xvec
+
Ÿtm
*__dim__,xvec+
j©m
*__dim__);

286 if(
rsq
>=
cut_sq
[
›Ëm
][
j–em
]) ;

287 
r
=
	`sq¹
(
rsq
);

289 if(((
›Ëm
==0 && 
j–em
==1è|| (›Ëm==1 && j–em==0)è&& 
r
<
rc_phi_FeH
)

290 
	`ÿlc_Dphi_FeH
(
r
,
j©m
<
Çtms_lş
);

292 if((
›Ëm
==1 && 
j–em
==1è&& 
r
<
rc_phi_FeH
)

293 
	`ÿlc_Dphi_HH
(
r
,
j©m
<
Çtms_lş
);

295 
rho
[
Ÿtm
]+=
	`ÿlc_rho
(
j–em
,
r
);

296 if(
j©m
<
Çtms_lş
)

297 
rho
[
j©m
]+=
	`ÿlc_rho
(
›Ëm
,
r
);

300 if(
›Ëm
==1è
	`ÿlc_DF_H
(
rho
[
Ÿtm
]);

301 
	`ÿlc_DF_Fe
(
rho
[
Ÿtm
]);

306 
ty³0
 
dFj
;

308 
Ÿtm
=0;Ÿtm<
Çtms_lş
;iatm++)

310 
›Ëm
=
evec
[
Ÿtm
];

311 
dFi
=
	`ÿlc_dF
(
›Ëm
,
rho
[
Ÿtm
]);

312 
j
=0;j<
ÃighbÜ_li¡_size
[
Ÿtm
];j++)

314 
j©m
=
ÃighbÜ_li¡
[
Ÿtm
][
j
];

315 
j–em
=
evec
[
j©m
];

316 
rsq
=
Algeb¿
::
RSQ
<
__dim__
>(
xvec
+
Ÿtm
*__dim__,xvec+
j©m
*__dim__);

317 if(
rsq
>=
cut_sq
[
›Ëm
][
j–em
]) ;

318 
r
=
	`sq¹
(
rsq
);

321 
dFj
=
j©m
<
Çtms_lş
 ? 
	`ÿlc_dF
(
j–em
,
rho
[jatm]):0.0;

323 if(
›Ëm
==0 && 
j–em
==0)

325 
	`ÿlc_Drho_Fe
(
dFi
+
dFj
,
r
);

327 if(
›Ëm
==1 && 
j–em
==1)

329 
	`ÿlc_Drho_H
(
dFi
+
dFj
,
r
);

331 if(
›Ëm
==1 && 
j–em
==0)

333 
	`ÿlc_Drho_Fe
(
dFi
,
r
);

334 
	`ÿlc_Drho_H
(
dFj
,
r
);

338 
	`ÿlc_Drho_H
(
dFi
,
r
);

339 
	`ÿlc_Drho_Fe
(
dFj
,
r
);

346 
	`MPI_AÎ»duû
(
dv_lş
,
dv
,
nHv¬s
,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

347 
	}
}

351 
	gFÜûF›ldEAMF™O
::
	$f_sq_g¿d›Á
()

353 
Algeb¿
::
z”o
<
nHv¬s
>(
dv_lş
);

354 
ty³0
* 
xvec
=
©oms
->
x
->
	`begš
();

355 
ty³0
* 
rho
=
rho_±r
->
	`begš
();

356 
–em_ty³
* 
evec
=
©oms
->
–em
->
	`begš
();

358 
Ÿtm
,
j©m
;

359 
–em_ty³
 
›Ëm
,
j–em
;

360 
ty³0
 
r
,
rsq
,
dFi
,
åaœ
;

362 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->neighbor_list;

363 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->neighbor_list_size;

364 cÚ¡ 
Çtms_lş
=
©oms
->natms_lcl;

365 
i
=0;i<
Çtms_lş
;i++)

366 
rho
[
i
]=0.0;

371 
Ÿtm
=0;Ÿtm<
Çtms_lş
;iatm++)

373 
›Ëm
=
evec
[
Ÿtm
];

374 
j
=0;j<
ÃighbÜ_li¡_size
[
Ÿtm
];j++)

376 
j©m
=
ÃighbÜ_li¡
[
Ÿtm
][
j
];

377 
j–em
=
evec
[
j©m
];

378 
rsq
=
Algeb¿
::
RSQ
<
__dim__
>(
xvec
+
Ÿtm
*__dim__,xvec+
j©m
*__dim__);

379 if(
rsq
>=
cut_sq
[
›Ëm
][
j–em
]) ;

380 
r
=
	`sq¹
(
rsq
);

382 if(((
›Ëm
==0 && 
j–em
==1è|| (›Ëm==1 && j–em==0)è&& 
r
<
rc_phi_FeH
)

383 
	`ÿlc_Dphi_FeH
(
r
,
j©m
<
Çtms_lş
);

385 if((
›Ëm
==1 && 
j–em
==1è&& 
r
<
rc_phi_FeH
)

386 
	`ÿlc_Dphi_HH
(
r
,
j©m
<
Çtms_lş
);

388 
rho
[
Ÿtm
]+=
	`ÿlc_rho
(
j–em
,
r
);

389 if(
j©m
<
Çtms_lş
)

390 
rho
[
j©m
]+=
	`ÿlc_rho
(
›Ëm
,
r
);

393 if(
›Ëm
==1è
	`ÿlc_DF_H
(
rho
[
Ÿtm
]);

394 
	`ÿlc_DF_Fe
(
rho
[
Ÿtm
]);

399 
ty³0
 
dFj
;

401 
Ÿtm
=0;Ÿtm<
Çtms_lş
;iatm++)

403 
›Ëm
=
evec
[
Ÿtm
];

404 
dFi
=
	`ÿlc_dF
(
›Ëm
,
rho
[
Ÿtm
]);

405 
j
=0;j<
ÃighbÜ_li¡_size
[
Ÿtm
];j++)

407 
j©m
=
ÃighbÜ_li¡
[
Ÿtm
][
j
];

408 
j–em
=
evec
[
j©m
];

409 
rsq
=
Algeb¿
::
RSQ
<
__dim__
>(
xvec
+
Ÿtm
*__dim__,xvec+
j©m
*__dim__);

410 if(
rsq
>=
cut_sq
[
›Ëm
][
j–em
]) ;

411 
r
=
	`sq¹
(
rsq
);

414 
åaœ
=-(
	`ÿlc_dF
(
›Ëm
,
rho
[
Ÿtm
])*
	`ÿlc_drho
(
j–em
,
r
)+

415 
	`ÿlc_dF
(
j–em
,
rho
[
j©m
])*
	`ÿlc_drho
(
›Ëm
,
r
)+

416 
	`ÿlc_dphi
(
›Ëm
,
j–em
,
r
));

418 
dFj
=
j©m
<
Çtms_lş
 ? 
	`ÿlc_dF
(
j–em
,
rho
[jatm]):0.0;

420 if(
›Ëm
==0 && 
j–em
==0)

422 
	`ÿlc_Drho_Fe
(
dFi
+
dFj
,
r
);

424 if(
›Ëm
==1 && 
j–em
==1)

426 
	`ÿlc_Drho_H
(
dFi
+
dFj
,
r
);

428 if(
›Ëm
==1 && 
j–em
==0)

430 
	`ÿlc_Drho_Fe
(
dFi
,
r
);

431 
	`ÿlc_Drho_H
(
dFj
,
r
);

435 
	`ÿlc_Drho_H
(
dFi
,
r
);

436 
	`ÿlc_Drho_Fe
(
dFj
,
r
);

443 
	`MPI_AÎ»duû
(
dv_lş
,
dv
,
nHv¬s
,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

444 
	}
}

448 
size_t
 
	gFÜûF›ldEAMF™O
::
	$g‘_rFeH
(
ty³0
*& 
Rs
,ty³0*& 
Fs
,*& 
Ns
)

452 
ty³0
* 
xvec
=
©oms
->
x
->
	`begš
();

453 
ty³0
* 
rho
=
rho_±r
->
	`begš
();

454 
–em_ty³
* 
evec
=
©oms
->
–em
->
	`begš
();

456 
Ÿtm
,
j©m
;

457 
–em_ty³
 
›Ëm
,
j–em
;

458 
ty³0
 
r
,
rsq
,
åaœ
;

460 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->neighbor_list;

461 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->neighbor_list_size;

462 cÚ¡ 
Çtms_lş
=
©oms
->natms_lcl;

463 
ty³0
* 
rs_lş
=
NULL
;

464 
ty³0
* 
fs_lş
=
NULL
;

465 
sz_lş
=
Çtms_lş
;

466 
MemÜy
::
	`®loc
(
rs_lş
,
sz_lş
);

467 
MemÜy
::
	`®loc
(
fs_lş
,
sz_lş
);

468 
n_lş
=0;

470 
Ÿtm
=0;Ÿtm<
Çtms_lş
;iatm++)

472 
›Ëm
=
evec
[
Ÿtm
];

473 
j
=0;j<
ÃighbÜ_li¡_size
[
Ÿtm
];j++)

475 
j©m
=
ÃighbÜ_li¡
[
Ÿtm
][
j
];

476 
j–em
=
evec
[
j©m
];

477 if(!((
›Ëm
==1&&
j–em
==0è|| ((›Ëm==0&&j–em==1)&&
j©m
<
Çtms_lş
))) ;

483 
rsq
=
Algeb¿
::
RSQ
<
__dim__
>(
xvec
+
Ÿtm
*__dim__,xvec+
j©m
*__dim__);

484 if(
rsq
>=
cut_sq
[
›Ëm
][
j–em
]) ;

485 
r
=
	`sq¹
(
rsq
);

486 
åaœ
=-(
	`ÿlc_dF
(
›Ëm
,
rho
[
Ÿtm
])*
	`ÿlc_drho
(
j–em
,
r
)+

487 
	`ÿlc_dF
(
j–em
,
rho
[
j©m
])*
	`ÿlc_drho
(
›Ëm
,
r
)+

488 
	`ÿlc_dphi
(
›Ëm
,
j–em
,
r
));

489 if(
n_lş
+1>=
sz_lş
)

491 
MemÜy
::
	`grow
(
rs_lş
,
sz_lş
,sz_lcl+100);

492 
MemÜy
::
	`grow
(
fs_lş
,
sz_lş
,sz_lcl+100);

493 
sz_lş
+=100;

495 
fs_lş
[
n_lş
]=
åaœ
;

496 
rs_lş
[
n_lş
]=
r
;

497 ++
n_lş
;

502 
n
;

503 
	`MPI_AÎ»duû
(&
n_lş
,&
n
,1,
Vec
<>::
MPI_T
,
MPI_SUM
,
wÜld
);

504 
ty³0
* 
rs
=
NULL
;

505 
MemÜy
::
	`®loc
(
rs
,
n
);

506 
ty³0
* 
fs
=
NULL
;

507 
MemÜy
::
	`®loc
(
fs
,
n
);

508 
__n_lş
;

509 
ty³0
* 
__rs
=
rs
;

510 
ty³0
* 
__fs
=
fs
;

511 
i
=0;i<
©oms
->
comm_size
;i++)

513 
__n_lş
=
n_lş
;

514 
	`MPI_Bÿ¡
(&
__n_lş
,1,
Vec
<>::
MPI_T
,
i
,
wÜld
);

515 if(
©oms
->
comm_¿nk
==
i
)

517 
	`memıy
(
__rs
,
rs_lş
,
__n_lş
*(
ty³0
));

518 
	`memıy
(
__fs
,
fs_lş
,
__n_lş
*(
ty³0
));

521 
	`MPI_Bÿ¡
(
__rs
,
__n_lş
,
Vec
<
ty³0
>::
MPI_T
,
i
,
wÜld
);

522 
	`MPI_Bÿ¡
(
__fs
,
__n_lş
,
Vec
<
ty³0
>::
MPI_T
,
i
,
wÜld
);

523 
__rs
+=
__n_lş
;

524 
__fs
+=
__n_lş
;

526 
MemÜy
::
	`d—Îoc
(
rs_lş
);

527 
MemÜy
::
	`d—Îoc
(
fs_lş
);

529 
size_t
* 
key
=
NULL
;

530 
MemÜy
::
	`®loc
(
key
,
n
);

531 
size_t
 
i
=0;i<
n
;i++è
key
[i]=i;

533 
XM©h
::
	`quicksÜt
(
key
,key+
n
,

534 [&
rs
](
size_t
* 
¿nk_i
,size_t* 
¿nk_j
){ (rs[*rank_i]<rs[*rank_j]);},

535 [&
rs
,&
fs
](
size_t
* 
¿nk_i
,size_t* 
¿nk_j
)

537 
¡d
::
	`sw­
(
rs
[*
¿nk_i
],rs[*
¿nk_j
]);

538 
¡d
::
	`sw­
(
fs
[*
¿nk_i
],fs[*
¿nk_j
]);

541 
MemÜy
::
	`d—Îoc
(
key
);

544 
ty³0
 
tŞ
=1.0e-5;

545 
i0
=0,
i1
=0;

546 
ty³0
 
r0
,
f0
,
n0
;

547 
size_t
 
sz
=0;

549 
ty³0
* 
__Rs
=
NULL
;

550 
MemÜy
::
	`®loc
(
__Rs
,
n
);

551 
ty³0
* 
__Fs
=
NULL
;

552 
MemÜy
::
	`®loc
(
__Fs
,
n
);

553 * 
__Ns
=
NULL
;

554 
MemÜy
::
	`®loc
(
__Ns
,
n
);

556 
i0
<
n
)

558 
r0
=0.0;

559 
f0
=0.0;

560 
n0
=0.0;

561 
i1
<
n
 && 
	`çbs
(
rs
[i1]-rs[
i0
])<
tŞ
)

563 
r0
+=
rs
[
i1
];

564 
f0
+=
fs
[
i1
];

565 
n0
++;

566 
i1
++;

568 
r0
/=
n0
;

569 
f0
/=
n0
;

571 
__Rs
[
sz
]=
r0
;

572 
__Fs
[
sz
]=
f0
;

573 
__Ns
[
sz
]=
¡©ic_ÿ¡
<>(
n0
);

574 
sz
++;

575 
i0
=
i1
;

577 
MemÜy
::
	`d—Îoc
(
rs
);

578 
MemÜy
::
	`d—Îoc
(
fs
);

580 
Rs
=
NULL
;

581 
MemÜy
::
	`®loc
(
Rs
,
sz
);

582 
Fs
=
NULL
;

583 
MemÜy
::
	`®loc
(
Fs
,
sz
);

584 
Ns
=
NULL
;

585 
MemÜy
::
	`®loc
(
Ns
,
sz
);

586 
	`memıy
(
Rs
,
__Rs
,
sz
*(
ty³0
));

587 
	`memıy
(
Fs
,
__Fs
,
sz
*(
ty³0
));

588 
	`memıy
(
Ns
,
__Ns
,
sz
*());

590 
MemÜy
::
	`d—Îoc
(
__Rs
);

591 
MemÜy
::
	`d—Îoc
(
__Fs
);

592 
MemÜy
::
	`d—Îoc
(
__Ns
);

595  
sz
;

597 
	}
}

601 
	gFÜûF›ldEAMF™O
::
	$š™
()

603 
	`´e_š™
();

604 
rho_±r
=
Ãw
 
Vec
<
ty³0
>(
©oms
,1,"rho");

606 
	}
}

610 
	gFÜûF›ldEAMF™O
::
	$fš
()

613 
d–‘e
 
rho_±r
;

614 
	`po¡_fš
();

615 
	}
}

619 
	gFÜûF›ldEAMF™O
::
	$š™_xchng
()

621 
	}
}

625 
FÜûF›ldEAMF™O
::
	$fš_xchng
()

627 
	}
}

631 
FÜûF›ldEAMF™O
::
	$´e_xchng_’”gy
(
GCMC
*)

633 
	}
}

637 
ty³0
 
FÜûF›ldEAMF™O
::
	$xchng_’”gy
(
GCMC
*)

640 
	}
}

644 
	gFÜûF›ldEAMF™O
::
	$po¡_xchng_’”gy
(
GCMC
*)

646 
	}
}

650 
ty³0
 
FÜûF›ldEAMF™O
::
	$E_HH
(
ty³0
 
r
)

652  (38.00339647547726-100.67818306817757*
r
)*
	`exp
(-2.758422844154626*r);

653 
	}
}

657 
ty³0
 
	gFÜûF›ldEAMF™O
::
	$dE_HH
(
ty³0
 
r
)

659  (-205.50762006159945+277.7130000832425*
r
)*
	`exp
(-2.758422844154626*r);

660 
	}
}

664 
ty³0
 
	gFÜûF›ldEAMF™O
::
	$E_HH_
(
ty³0
 
r
)

668  
	`exp
(1.0/(
r
-2.8 )-2.4809870256282154*r)*(48.796680008387405-131.20995880102427*r);

669 
	}
}

673 
ty³0
 
	gFÜûF›ldEAMF™O
::
	$dE_HH_
(
ty³0
 
r
)

675  (
	`exp
(1.0/(
r
-2.8 )-2.4809870256282154*r)*(-2026.6239681656182 +„*(4096.100546537651 +„*(-2075.2430391394673 + 325.5302054185539*r))))/((r-2.8)*(r-2.8));

676 
	}
}

680 
ty³0
 
	gFÜûF›ldEAMF™O
::
	$ÿlc_F
(
–em_ty³
 
i
,
ty³0
 
rho
)

682 if(
i
==0)

684 
rho
/=
A_F_H
[4];

685  
A_F_Fe
[0]*
	`sq¹
(
rho
)+A_F_Fe[1]*rho*rho+A_F_Fe[2]*rho*rho*rho*rho;

688 if(
rho
==0.0)  0.0;

689 
ty³0
 
rhob
=
rho
/
A_F_H
[3];

690  (
A_F_H
[0]*
rhob
+A_F_H[1])*rhob+A_F_H[2]*
	`pow
(rhob,2.0/3.0)*(rhob/(1.0+rhob));

698 
	}
}

702 
ty³0
 
	gFÜûF›ldEAMF™O
::
	$ÿlc_dF
(
–em_ty³
 
i
,
ty³0
 
rho
)

704 if(
i
==0)

706 
rho
/=
A_F_H
[4];

707  (0.5*
A_F_Fe
[0]/
	`sq¹
(
rho
)+2.0*A_F_Fe[1]*rho+4.0*A_F_Fe[2]*rho*rho*rho)/
A_F_H
[4];

710 if(
rho
==0.0)  0.0;

711 
ty³0
 
rhob
=
rho
/
A_F_H
[3];

712  (2.0*
A_F_H
[0]*
rhob
+A_F_H[1]+A_F_H[2]*
	`pow
(rhob,2.0/3.0)*(5.0+2.0*rhob)/(3.0*(1.0+rhob)*(1.0+rhob)))/A_F_H[3];

723 
	}
}

727 
ty³0
 
	gFÜûF›ldEAMF™O
::
	$ÿlc_ddF
(
–em_ty³
 
i
,
ty³0
 
rho
)

729 if(
i
==0)

731 
rho
/=
A_F_H
[4];

732  (-0.25*
A_F_Fe
[0]/
	`sq¹
(
rho
*rho*rho)+2.0*A_F_Fe[1]+12.0*A_F_Fe[2]*rho*rho)/(
A_F_H
[4]*A_F_H[4]);

735 if(
rho
==0.0)  0.0;

736 
ty³0
 
rhob
=
rho
/
A_F_H
[3];

737  (2.0*
A_F_H
[0]-A_F_H[2]*2.0*((
rhob
+5.0)*rhob-5.0)/(9.0*
	`pow
(rhob,1.0/3.0)*(1.0+rhob)*(1.0+rhob)*(1.0+rhob)))/(A_F_H[3]*A_F_H[3]);

746 
	}
}

750 
ty³0
 
	gFÜûF›ldEAMF™O
::
	$ÿlc_rho
(
–em_ty³
 
›Ëm
,
ty³0
 
r
)

753 if(
›Ëm
==0)

755 if(
r
>=
rc_rho_Fe
)  0.0;

756  
A_F_H
[4]*
	`¥lše
(
AR_rho_Fe
,
r
);

758 if(
r
>=
rc_rho_H
)  0.0;

760 
ty³0
 
y
=
	`exp
(-
A_rho_H
[1]*
r
);

761  
A_F_H
[3]*
A_rho_H
[0]*
	`exp
(1.0/(
r
-
rc_rho_H
))*
Algeb¿
::
pow
<6>Ô)*
y
*(1.0+512.0*y);

762 
	}
}

767 
ty³0
 
	gFÜûF›ldEAMF™O
::
	$ÿlc_drho
(
–em_ty³
 
›Ëm
,
ty³0
 
r
)

770 if(
›Ëm
==0)

772 if(
r
>=
rc_rho_Fe
)  0.0;

773  
A_F_H
[4]*
	`d¥lše
(
AR_rho_Fe
,
r
);

776 if(
r
>=
rc_rho_H
)  0.0;

777 
ty³0
 
y
=
	`exp
(-
A_rho_H
[1]*
r
);

778 
ty³0
 
rho
=
A_F_H
[3]*
A_rho_H
[0]*
	`exp
(1.0/(
r
-
rc_rho_H
))*
Algeb¿
::
pow
<6>Ô)*
y
*(1.0+512.0*y);

779  
rho
*(6.0/
r
-1.0/(Ô-
rc_rho_H
)*Ô-rc_rho_H))-
A_rho_H
[1]*(1.0+
y
/(0.001953125+y)));

780 
	}
}

784 
ty³0
 
	gFÜûF›ldEAMF™O
::
	$ÿlc_phi
(
–em_ty³
 
›Ëm
,–em_ty³ 
j–em
,
ty³0
 
r
)

787 if(
›Ëm
==0 && 
j–em
==0)

789 if(
r
>=
rc_phi_FeFe
)  0.0;

790 if(
r
>=
r1_FeFe
è 
	`¥lše
(
AR_phi_FeFe
,r);

791 if(
r
>=
r0_FeFe
è 
	`exp
(
B_phi_FeFe
[0]+r*(B_phi_FeFe[1]+r*(B_phi_FeFe[2]+r*B_phi_FeFe[3])));

792  
	`xi
(
r
);

794 if(
›Ëm
==1 && 
j–em
==1)

797 
ty³0
 
c0
=
	`nh
(
A_phi_HH
[2]*(
r
-A_phi_HH[3]));

798 
ty³0
 
rhoH
=
	`ÿlc_rho
(1,
r
);

801 0.5*(1.0-
c0
)*(
	`E_HH
(
r
)-2.0*
	`ÿlc_F
(1,
rhoH
))+

802 0.5*(1.0+
c0
)*(
A_phi_HH
[0]*
	`exp
(1.0/(
r
-
rc_phi_HH
))+(A_phi_HH[1]/
A_F_H
[3])*
rhoH
);

805 #ifdeà
FeH_SPLINE


806 if(
r
>=
rc_phi_FeH
)  0.0;

807  
	`¥lše
(
A_phi_FeH
,
R_phi_FeH
,
r
);

809 if(
r
>=
rc_phi_FeH
)  0.0;

810 
ty³0
 
y
=
	`exp
(-
A_phi_FeH
[1]*(
r
-A_phi_FeH[2]));

811  
	`exp
(1.0/(
r
-
rc_phi_FeH
))*(
A_phi_FeH
[0]*
y
*(y-2.0))+A_phi_FeH[3]*
	`¥lše
(
AR_rho_Fe
,r);

813 
	}
}

817 
ty³0
 
	gFÜûF›ldEAMF™O
::
	$ÿlc_dphi
(
–em_ty³
 
›Ëm
,–em_ty³ 
j–em
,
ty³0
 
r
)

819 if(
›Ëm
==0 && 
j–em
==0)

821 if(
r
>=
rc_phi_FeFe
)  0.0;

822 if(
r
>=
r1_FeFe
è 
	`d¥lše
(
AR_phi_FeFe
,r);

823 if(
r
>=
r0_FeFe
è (
B_phi_FeFe
[1]+r*(2.0*B_phi_FeFe[2]+r*3.0*B_phi_FeFe[3]))

824 *
	`exp
(
B_phi_FeFe
[0]+
r
*(B_phi_FeFe[1]+r*(B_phi_FeFe[2]+r*B_phi_FeFe[3])));

826  
	`dxi
(
r
);

828 if(
›Ëm
==1 && 
j–em
==1)

831 
ty³0
 
c0
=
	`nh
(
A_phi_HH
[2]*(
r
-A_phi_HH[3]));

832 
ty³0
 
dc0
=
A_phi_HH
[2]*(1.0-
c0
*c0);

833 
ty³0
 
rhoH
=
	`ÿlc_rho
(1,
r
);

834 
ty³0
 
drhoH
=
	`ÿlc_drho
(1,
r
);

835 
ty³0
 
fc
=
	`exp
(1.0/(
r
-
rc_phi_HH
));

836 
ty³0
 
dfc
=-
fc
/((
r
-
rc_phi_HH
)*(r-rc_phi_HH));

840 -0.5*
dc0
*(
	`E_HH
(
r
)-2.0*
	`ÿlc_F
(1,
rhoH
))+

841 0.5*(1.0-
c0
)*(
	`dE_HH
(
r
)-2.0*
drhoH
*
	`ÿlc_dF
(1,
rhoH
))+

842 0.5*
dc0
*(
A_phi_HH
[0]*
fc
+(A_phi_HH[1]/
A_F_H
[3])*
rhoH
)+

843 0.5*(1.0+
c0
)*(
A_phi_HH
[0]*
dfc
+(A_phi_HH[1]/
A_F_H
[3])*
drhoH
);

846 #ifdeà
FeH_SPLINE


847 if(
r
>=
rc_phi_FeH
)  0.0;

848  
	`d¥lše
(
A_phi_FeH
,
R_phi_FeH
,
r
);

850 if(
r
>=
rc_phi_FeH
)  0.0;

851 
ty³0
 
y
=
	`exp
(-
A_phi_FeH
[1]*(
r
-A_phi_FeH[2]));

852 
ty³0
 
c1
=1.0/((
r
-
rc_phi_FeH
)*(r-rc_phi_FeH));

853 
ty³0
 
c0
=
c1
+
A_phi_FeH
[1];

854  
	`exp
(1.0/(
r
-
rc_phi_FeH
))*(
A_phi_FeH
[0]*
y
*(-(A_phi_FeH[1]+
c0
)*y+2.0*c0))+A_phi_FeH[3]*
	`d¥lše
(
AR_rho_Fe
,r);

856 
	}
}

860 
	gFÜûF›ldEAMF™O
::
	$ÿlc_Dphi_FeH
(
ty³0
 
r
,
boŞ
 
cÚd
)

862 
ty³0
 
cÛf
ğ
cÚd
 ? 1.0:0.5;

863 #ifdeà
FeH_SPLINE


864 
	`D¥lše
(
cÛf
,
dA_phi_FeH_lş
,
R_phi_FeH
,
r
);

866 
ty³0
 
y
=
	`exp
(-
A_phi_FeH
[1]*(
r
-A_phi_FeH[2]));

867 
ty³0
 
fc
=
	`exp
(1.0/(
r
-
rc_phi_FeH
));

868 
dA_phi_FeH_lş
[0]+=
cÛf
*
fc
*
y
*(y-2.0);

869 
dA_phi_FeH_lş
[1]+=-
cÛf
*
A_phi_FeH
[0]*
fc
*2.0*
y
*(y-1.0)*(
r
-A_phi_FeH[2]);

870 
dA_phi_FeH_lş
[2]+=
cÛf
*
A_phi_FeH
[0]*
fc
*2.0*
y
*(y-1.0)*A_phi_FeH[1];

871 
dA_phi_FeH_lş
[3]+=
cÛf
*
	`¥lše
(
AR_rho_Fe
,
r
);

873 
	}
}

877 
	gFÜûF›ldEAMF™O
::
	$ÿlc_Dphi_HH
(
ty³0
 
r
,
boŞ
 
cÚd
)

879 
ty³0
 
cÛf
ğ
cÚd
 ? 1.0:0.5;

880 
ty³0
 
c0
=
	`nh
(
A_phi_HH
[2]*(
r
-A_phi_HH[3]));

881 
ty³0
 
rhoH
=
	`ÿlc_rho
(1,
r
);

882 
ty³0
 
fc
=
	`exp
(1.0/(
r
-
rc_phi_HH
));

883 
ty³0
 
c1
=
A_phi_HH
[0]*
fc
+(A_phi_HH[1]/
A_F_H
[3])*
rhoH
-
	`E_HH
(
r
)+2.0*
	`ÿlc_F
(1,rhoH);

884 
dA_phi_HH_lş
[0]+=
cÛf
*0.5*(1.0+
c0
)*
fc
;

885 
dA_phi_HH_lş
[1]+=
cÛf
*0.5*(1.0+
c0
)*
rhoH
/
A_F_H
[3];

886 
dA_F_H_lş
[3]+=-
A_phi_HH
[1]*
cÛf
*0.5*(1.0+
c0
)*
rhoH
/(
A_F_H
[3]*A_F_H[3]);

887 
dA_phi_HH_lş
[2]+=
cÛf
*0.5*(
r
-
A_phi_HH
[3])*(1.0-
c0
*c0)*
c1
;

888 
dA_phi_HH_lş
[3]+=-
cÛf
*0.5*
A_phi_HH
[2]*(1.0-
c0
*c0)*
c1
;

890 
c1
=0.5*(1.0+
c0
)*
A_phi_HH
[1]/
A_F_H
[3];

891 
c0
=c0-1.0;

895 
ty³0
 
rhob
=
rhoH
/
A_F_H
[3];

896 
ty³0
 
rhob_2_3
=
	`pow
(
rhob
,2.0/3.0);

898 
ty³0
 
dFH
=((2.0*
A_F_H
[0]*
rhob
+A_F_H[1]+A_F_H[2]*
rhob_2_3
*(5.0+2.0*rhob)/(3.0*(1.0+rhob)*(1.0+rhob)))/A_F_H[3]);

899 
	`ÿlc_Drho_H
(
cÛf
*(
c0
*
dFH
+
c1
),
r
);

900 
dA_F_H_lş
[0]+=
c0
*
cÛf
*
rhob
*rhob;

901 
dA_F_H_lş
[1]+=
c0
*
cÛf
*
rhob
;

902 
dA_F_H_lş
[2]+=
c0
*
cÛf
*
rhob_2_3
*(
rhob
/(1.0+rhob));

903 
dA_F_H_lş
[3]+=-
c0
*
cÛf
*
rhob
*
dFH
;

916 
	}
}

920 
	gFÜûF›ldEAMF™O
::
	$ÿlc_DF_H
(
ty³0
 
rho
)

922 
ty³0
 
rhob
=
rho
/
A_F_H
[3];

923 
ty³0
 
rhob_2_3
=
	`pow
(
rhob
,2.0/3.0);

924 
dA_F_H_lş
[0]+=
rhob
*rhob;

925 
dA_F_H_lş
[1]+=
rhob
;

926 
dA_F_H_lş
[2]+=
rhob_2_3
*(
rhob
/(1.0+rhob));

927 
dA_F_H_lş
[3]+=-
rhob
*((2.0*
A_F_H
[0]*rhob+A_F_H[1]+A_F_H[2]*
rhob_2_3
*(5.0+2.0*rhob)/(3.0*(1.0+rhob)*(1.0+rhob)))/A_F_H[3]);

939 
	}
}

943 
	gFÜûF›ldEAMF™O
::
	$ÿlc_DF_Fe
(
ty³0
 
rho
)

945 
rho
/=
A_F_H
[4];

946 
dA_F_H_lş
[4]+=-
rho
*(0.5*
A_F_Fe
[0]/
	`sq¹
Ôho)+2.0*A_F_Fe[1]*rho+4.0*A_F_Fe[2]*rho*rho*rho)/
A_F_H
[4];

947 
	}
}

951 
	gFÜûF›ldEAMF™O
::
	$ÿlc_Drho_H
(
ty³0
 
cÛf
,ty³0 
r
)

953 if(
r
>
rc_rho_H
) ;

954 
ty³0
 
y
=
	`exp
(-
A_rho_H
[1]*
r
);

955 
ty³0
 
c0
=
	`exp
(1.0/(
r
-
rc_rho_H
))*
Algeb¿
::
pow
<6>(r);

956 
dA_rho_H_lş
[0]+=
cÛf
*
A_F_H
[3]*
c0
*
y
*(1.0+512.0*y);

957 
dA_F_H_lş
[3]+=
cÛf
*
A_rho_H
[0]*
c0
*
y
*(1.0+512.0*y);

958 
dA_rho_H_lş
[1]+=-
cÛf
*
A_rho_H
[0]*
A_F_H
[3]*
r
*
c0
*
y
*(1.0+1024.0*y);

959 
	}
}

963 
	gFÜûF›ldEAMF™O
::
	$ÿlc_Drho_Fe
(
ty³0
 
cÛf
,ty³0 
r
)

965 if(
r
>
rc_rho_Fe
) ;

966 
dA_F_H_lş
[4]+=
cÛf
*
	`¥lše
(
AR_rho_Fe
,
r
);

967 
	}
}

971 
	gFÜûF›ldEAMF™O
::
	$ml_Ãw
(
PyM‘hodDef
& 
_m‘hods
)

973 
_m‘hods
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

974 
_m‘hods
.
ml_Çme
="ff_eam_fit_o";

975 
_m‘hods
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

976 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

978 
AtomsMD
::
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<AtomsMD::Objeù*>(
£lf
);

980 
FuncAPI
<
ty³0
[
Äho_H
],ty³0[
Åhi_FeH
],ty³0[
Åhi_HH
],ty³0[
nF_H
]> 
	`f
("ff_eam_fit_o",{"A_rho_H","A_phi_FeH","A_phi_HH","A_F_H"});

981 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

984 
d–‘e
 
__£lf
->
ff
;

985 
__£lf
->
ff
=
Ãw
 
	`FÜûF›ldEAMF™O
(__£lf->
©oms
,
f
.
v®
<0>(),f.val<1>(),f.val<2>(),f.val<3>());

986 
Py_RETURN_NONE
;

989 
_m‘hods
.
ml_doc
="";

990 
	}
}

	@ff_eam_fit_o.h

1 #iâdeà
__MAPP__ff_—m_f™_o__


2 
	#__MAPP__ff_—m_f™_o__


	)

3 
	~"ff_md.h
"

4 
	~"xm©h.h
"

5 
	#Äho_H
 2

	)

6 #ifdeà
FeH_SPLINE


7 
	#Åhi_FeH
 18

	)

10 
	#Åhi_FeH
 4

	)

12 
	#Åhi_HH
 4

	)

13 
	#nF_H
 5

	)

14 
	#rho_H_off£t
 0

	)

15 
	#phi_FeH_off£t
 
rho_H_off£t
+
Äho_H


	)

16 
	#phi_HH_off£t
 
phi_FeH_off£t
+
Åhi_FeH


	)

17 
	#F_H_off£t
 
phi_HH_off£t
+
Åhi_HH


	)

18 
	#nHv¬s
 
Äho_H
+
Åhi_FeH
+
Åhi_HH
+
nF_H


	)

25 
Çme¥aû
 
	gMAPP_NS


27 şas 
	cFÜûF›ldEAMF™O
: 
public
 
FÜûF›ldMD


29 
´iv©e
:

30 
Vec
<
ty³0
>* 
rho_±r
;

32 
	g´Ùeùed
:

34 
__fÜû_ÿlc
();

37 
__’”gy_ÿlc
();

38 
´e_xchng_’”gy
(
GCMC
*);

39 
ty³0
 
xchng_’”gy
(
GCMC
*);

40 
po¡_xchng_’”gy
(
GCMC
*);

41 
	gpublic
:

42 
FÜûF›ldEAMF™O
(
şass
 
AtomsMD
*,
ty³0
(&)[
Äho_H
],ty³0(&)[
Åhi_FeH
],ty³0(&)[
Åhi_HH
],ty³0(&)[
nF_H
]);

43 ~
FÜûF›ldEAMF™O
();

44 
š™
();

45 
fš
();

46 
š™_xchng
();

47 
fš_xchng
();

49 
ty³0
 
	grc_rho_H
;

50 
ty³0
 
	grc_rho_Fe
;

51 
ty³0
 
	grc_phi_FeFe
;

52 
ty³0
 
	grc_phi_FeH
;

53 
ty³0
 
	grc_phi_HH
;

56 
ty³0
 
	gv
[
nHv¬s
];

57 
ty³0
* 
	gA_rho_H
;

58 
ty³0
* 
	gA_phi_FeH
;

59 
ty³0
* 
	gA_phi_HH
;

60 
ty³0
* 
	gA_F_H
;

62 
ty³0
 
	gdv
[
nHv¬s
];

63 
ty³0
* 
	gdA_rho_H
;

64 
ty³0
* 
	gdA_phi_FeH
;

65 
ty³0
* 
	gdA_phi_HH
;

66 
ty³0
* 
	gdA_F_H
;

69 
ty³0
 
	gdv_lş
[
nHv¬s
];

70 
ty³0
* 
	gdA_rho_H_lş
;

71 
ty³0
* 
	gdA_phi_FeH_lş
;

72 
ty³0
* 
	gdA_phi_HH_lş
;

73 
ty³0
* 
	gdA_F_H_lş
;

75 
boŞ
 
	gdof
[
nHv¬s
];

78 
ty³0
 
	gA_F_Fe
[3];

79 
ty³0
 
	gAR_rho_Fe
[3][2];

80 
ty³0
 
	gAR_phi_FeFe
[13][2];

81 #ifdeà
FeH_SPLINE


82 
ty³0
 
	gR_phi_FeH
[
Åhi_FeH
];

84 
ty³0
 
	gB_phi_FeFe
[4];

85 
ty³0
 
	gr0_FeFe
,
	gr1_FeFe
;

91 
ty³0
 
E_HH
(type0);

92 
ty³0
 
dE_HH
(type0);

93 
ty³0
 
E_HH_
(type0);

94 
ty³0
 
dE_HH_
(type0);

95 
ty³0
 
ÿlc_F
(
–em_ty³
,type0);

96 
ty³0
 
ÿlc_dF
(
–em_ty³
,type0);

97 
ty³0
 
ÿlc_ddF
(
–em_ty³
,type0);

98 
ty³0
 
ÿlc_rho
(
–em_ty³
,type0);

99 
ty³0
 
ÿlc_drho
(
–em_ty³
,type0);

100 
ty³0
 
ÿlc_phi
(
–em_ty³
,elem_type,type0);

101 
ty³0
 
ÿlc_dphi
(
–em_ty³
,elem_type,type0);

104 
ÿlc_Dphi_FeH
(
ty³0
,
boŞ
);

105 
ÿlc_Dphi_HH
(
ty³0
,
boŞ
);

106 
ÿlc_DF_H
(
ty³0
);

107 
ÿlc_DF_Fe
(
ty³0
);

108 
ÿlc_Drho_H
(
ty³0
,type0);

109 
ÿlc_Drho_Fe
(
ty³0
,type0);

111 
g¿d›Á
();

112 
f_sq_g¿d›Á
();

113 
ty³0
 
m—n_rho_H
();

114 
size_t
 
g‘_rFeH
(
ty³0
*&,type0*&,*&);

123 
	g‹m¶©e
<cÚ¡ 
	gN
>

124 
ty³0
 
¥lše
Ñy³0 (&
AR
)[
N
][2],ty³0 
r
)

126 
	gi
=
N
-1;

127 
ty³0
 
	gªs
=0.0;

128 
	gi
>-1 && 
	gr
<
	gAR
[
i
][1])

130 
	gªs
+=
AR
[
i
][0]*
Algeb¿
::
pow
<3>(AR[i][1]-
r
);

131 --
	gi
;

133  
	gªs
;

136 
	g‹m¶©e
<cÚ¡ 
	gN
>

137 
ty³0
 
d¥lše
Ñy³0 (&
AR
)[
N
][2],ty³0 
r
)

139 
	gi
=
N
-1;

140 
ty³0
 
	gªs
=0.0;

141 
	gi
>-1 && 
	gr
<
	gAR
[
i
][1])

143 
	gªs
-=3.0*
AR
[
i
][0]*
Algeb¿
::
pow
<2>(AR[i][1]-
r
);

144 --
	gi
;

146  
	gªs
;

150 #ifdeà
FeH_SPLINE


151 
	g‹m¶©e
<cÚ¡ 
	gN
>

152 
ty³0
 
¥lše
Ñy³0*& 
A
,ty³0 (&
R
)[
N
],ty³0 
r
)

154 
	gi
=
N
-1;

155 
ty³0
 
	gªs
=0.0;

156 
	gi
>-1 && 
	gr
<
	gR
[
i
])

158 
	gªs
+=
A
[
i
]*
Algeb¿
::
pow
<3>(
R
[i]-
r
);

159 --
	gi
;

161  
	gªs
;

164 
	g‹m¶©e
<cÚ¡ 
	gN
>

165 
ty³0
 
d¥lše
Ñy³0*& 
A
,ty³0 (&
R
)[
N
],ty³0 
r
)

167 
	gi
=
N
-1;

168 
ty³0
 
	gªs
=0.0;

169 
	gi
>-1 && 
	gr
<
	gR
[
i
])

171 
	gªs
-=3.0*
A
[
i
]*
Algeb¿
::
pow
<2>(
R
[i]-
r
);

172 --
	gi
;

174  
	gªs
;

177 
	g‹m¶©e
<cÚ¡ 
	gN
>

178 
D¥lše
(
ty³0
& 
cÛf
,ty³0*& 
D
,ty³0 (&
R
)[
N
],ty³0 
r
)

180 
	gi
=
N
-1;

181 
	gi
>-1 && 
	gr
<
	gR
[
i
])

183 
	gD
[
i
]+=
cÛf
*
Algeb¿
::
pow
<3>(
R
[i]-
r
);

184 --
	gi
;

197 
ty³0
 
xi
Ñy³0 
r
)

200 1769.6687067528123*
exp
(-28.571747468384945*
r
)+

201 4963.443749027828*
exp
(-8.41348676233098*
r
)+

202 2727.5091948962486*
exp
(-3.597361579691342*
r
)+

203 274.2110421849655*
exp
(-1.8000200905082515*
r
)

204 )/
	gr
;

206 
ty³0
 
dxi
Ñy³0 
r
)

209 1769.6687067528123*(28.571747468384945*
	gr
+1.0)*
exp
(-28.571747468384945*
r
)+

210 4963.443749027828*(8.41348676233098*
	gr
+1.0)*
exp
(-8.41348676233098*
r
)+

211 2727.5091948962486*(3.597361579691342*
	gr
+1.0)*
exp
(-3.597361579691342*
r
)+

212 274.2110421849655*(1.8000200905082515*
	gr
+1.0)*
exp
(-1.8000200905082515*
r
)

213 )/(
r
*
	gr
);

219 
ml_Ãw
(
PyM‘hodDef
&);

	@ff_eam_func.cpp

1 
	~"ff_—m_func.h
"

2 
	~"m­p_func.h
"

3 
	~"ÃighbÜ_md.h
"

4 
	~"©oms_md.h
"

5 
	~"–em’ts.h
"

6 
	~"memÜy.h
"

7 
	~"dyÇmic_md.h
"

8 
	~"gcmc.h
"

9 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

17 
	gFÜûF›ldEAMFunc
::
	$FÜûF›ldEAMFunc
(
AtomsMD
* 
__©oms
,

18 
EAMFunc
* 
__—m_func
,

19 
–em_ty³
*&& 
__–em_m­
):

20 
	`FÜûF›ldMD
(
__©oms
),

21 
	`—m_func
(
__—m_func
),

22 
	$–em_m­
(
__–em_m­
)

24 
gcmc_n_cutoff
=2;

25 
gcmc_n_v¬s
=2;

26 
gcmc_g_’abËd
=
Œue
;

28 
__–em_m­
=
NULL
;

29 
size_t
 
i
=0;i<
ÃËms
;i++)

30 
size_t
 
j
=0;j<
i
+1;j++)

32 
cut
[
i
][
j
]=cut[j][i]=
—m_func
->
rc
[
–em_m­
[i]][elem_map[j]];

33 
cut_sq
[
i
][
j
]=cut_sq[j][i]=
cut
[i][j]*cut[i][j];

35 
	}
}

39 
	gFÜûF›ldEAMFunc
::~
	$FÜûF›ldEAMFunc
()

41 
d–‘e
 [] 
–em_m­
;

42 
d–‘e
 
—m_func
;

43 
	}
}

47 
	gFÜûF›ldEAMFunc
::
	$__fÜû_ÿlc
()

49 cÚ¡ 
ty³0
* 
x
=
©oms
->x->
	`begš
();

50 
–em_ty³
* 
evec
=
©oms
->
–em
->
	`begš
();

51 
ty³0
* 
rho
=
rho_±r
->
	`begš
();

52 
–em_ty³
 
›Ëm
,
j–em
;

53 
ty³0
 
rsq
,
r
,
phi
,
åaœ
;

55 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->neighbor_list;

56 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->neighbor_list_size;

58 
ty³0
 
dx_ij
[
__dim__
];

59 cÚ¡ 
Çtms_lş
=
©oms
->natms_lcl;

60 
Ÿtm
=0;Ÿtm<
Çtms_lş
;Ÿtm++è
rho
[iatm]=0.0;

61 
Ÿtm
=0;Ÿtm<
Çtms_lş
;iatm++)

63 
›Ëm
=
–em_m­
[
evec
[
Ÿtm
]];

64 cÚ¡ 
li¡_size
=
ÃighbÜ_li¡_size
[
Ÿtm
];

65 
j
=0,
j©m
;j<
li¡_size
;j++)

67 
j©m
=
ÃighbÜ_li¡
[
Ÿtm
][
j
];

68 
j–em
=
–em_m­
[
evec
[
j©m
]];

69 
rsq
=
Algeb¿
::
RSQ
<
__dim__
>(
x
+
Ÿtm
*__dim__,x+
j©m
*__dim__);

70 if(
rsq
>=
cut_sq
[
›Ëm
][
j–em
]) ;

71 
r
=
	`sq¹
(
rsq
);

72 
phi
=
—m_func
->
	`phi
(
›Ëm
,
j–em
,
r
);

73 
rho
[
Ÿtm
]+=
—m_func
->
	`rho
(
j–em
,
›Ëm
,
r
);

75 if(
j©m
<
Çtms_lş
)

76 
rho
[
j©m
]+=
—m_func
->
	`rho
(
›Ëm
,
j–em
,
r
);

78 
phi
*=0.5;

79 
__vec_lş
[0]+=
phi
;

81 
__vec_lş
[0]+=
—m_func
->
	`F
(
›Ëm
,
rho
[
Ÿtm
]);

84 
	`upd©e
(
rho_±r
);

87 
ty³0
* 
fvec
=
f
->
	`begš
();

88 
Ÿtm
=0;Ÿtm<
Çtms_lş
;iatm++)

90 
›Ëm
=
–em_m­
[
evec
[
Ÿtm
]];

91 cÚ¡ 
li¡_size
=
ÃighbÜ_li¡_size
[
Ÿtm
];

92 
j
=0,
j©m
;j<
li¡_size
;j++)

94 
j©m
=
ÃighbÜ_li¡
[
Ÿtm
][
j
];

95 
j–em
=
–em_m­
[
evec
[
j©m
]];

96 
rsq
=
Algeb¿
::
	`DX_RSQ
(
x
+
Ÿtm
*
__dim__
,x+
j©m
*__dim__,
dx_ij
);

97 if(
rsq
>=
cut_sq
[
›Ëm
][
j–em
]) ;

98 
r
=
	`sq¹
(
rsq
);

99 
åaœ
=
—m_func
->
	`åaœ
(
›Ëm
,
j–em
,
rho
[
Ÿtm
],rho[
j©m
],
r
);

102 
Algeb¿
::
V_add_x_mul_V
<
__dim__
>(
åaœ
,
dx_ij
,
fvec
+
Ÿtm
*__dim__);

103 if(
j©m
<
Çtms_lş
)

104 
Algeb¿
::
V_add_x_mul_V
<
__dim__
>(-
åaœ
,
dx_ij
,
fvec
+
j©m
*__dim__);

106 
åaœ
*=0.5;

108 
Algeb¿
::
DyadicV
<
__dim__
>(-
åaœ
,
dx_ij
,&
__vec_lş
[1]);

113 
	}
}

119 
	gFÜûF›ldEAMFunc
::
	$__’”gy_ÿlc
()

121 cÚ¡ 
ty³0
* 
x
=
©oms
->x->
	`begš
();

122 
–em_ty³
* 
evec
=
©oms
->
–em
->
	`begš
();

123 
ty³0
* 
rho
=
rho_±r
->
	`begš
();

124 
–em_ty³
 
›Ëm
,
j–em
;

125 
ty³0
 
rsq
,
r
,
phi
;

127 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->neighbor_list;

128 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->neighbor_list_size;

131 cÚ¡ 
Çtms_lş
=
©oms
->natms_lcl;

132 
Ÿtm
=0;Ÿtm<
Çtms_lş
;Ÿtm++è
rho
[iatm]=0.0;

133 
Ÿtm
=0;Ÿtm<
Çtms_lş
;iatm++)

135 
›Ëm
=
–em_m­
[
evec
[
Ÿtm
]];

136 cÚ¡ 
li¡_size
=
ÃighbÜ_li¡_size
[
Ÿtm
];

137 
j
=0,
j©m
;j<
li¡_size
;j++)

139 
j©m
=
ÃighbÜ_li¡
[
Ÿtm
][
j
];

140 
j–em
=
–em_m­
[
evec
[
j©m
]];

141 
rsq
=
Algeb¿
::
RSQ
<
__dim__
>(
x
+
Ÿtm
*__dim__,x+
j©m
*__dim__);

142 if(
rsq
>=
cut_sq
[
›Ëm
][
j–em
]) ;

143 
r
=
	`sq¹
(
rsq
);

144 
phi
=
—m_func
->
	`phi
(
›Ëm
,
j–em
,
r
);

145 
rho
[
Ÿtm
]+=
—m_func
->
	`rho
(
j–em
,
›Ëm
,
r
);

147 if(
j©m
<
Çtms_lş
)

148 
rho
[
j©m
]+=
—m_func
->
	`rho
(
›Ëm
,
j–em
,
r
);

150 
phi
*=0.5;

151 
__vec_lş
[0]+=
phi
;

153 
__vec_lş
[0]+=
—m_func
->
	`F
(
›Ëm
,
rho
[
Ÿtm
]);

155 
	}
}

159 
	gFÜûF›ldEAMFunc
::
	$š™
()

161 
	`´e_š™
();

162 
rho_±r
=
Ãw
 
Vec
<
ty³0
>(
©oms
,1,"rho");

164 
	}
}

168 
	gFÜûF›ldEAMFunc
::
	$fš
()

170 
d–‘e
 
rho_±r
;

171 
	`po¡_fš
();

172 
	}
}

176 
	gFÜûF›ldEAMFunc
::
	$š™_xchng
()

178 
F_±r
=
Ãw
 
Vec
<
ty³0
>(
©oms
,1);

179 
rho_xchng_±r
=
Ãw
 
Vec
<
ty³0
>(
©oms
,1);

180 
F_xchng_±r
=
Ãw
 
Vec
<
ty³0
>(
©oms
,1);

182 cÚ¡ 
ty³0
* 
x
=
©oms
->x->
	`begš
();

183 
ty³0
* 
rho
=
rho_±r
->
	`begš
();

184 
ty³0
* 
F
=
F_±r
->
	`begš
();

185 
ty³0
* 
rho_xchng
=
rho_xchng_±r
->
	`begš
();

186 
ty³0
* 
F_xchng
=
F_xchng_±r
->
	`begš
();

187 
–em_ty³
* 
evec
=
©oms
->
–em
->
	`begš
();

188 
ty³0
 
rsq
,
r
;

190 
–em_ty³
 
›Ëm
,
j–em
;

193 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->neighbor_list;

194 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->neighbor_list_size;

195 cÚ¡ 
Çtms_lş
=
©oms
->natms_lcl;

196 
Ÿtm
=0;Ÿtm<
Çtms_lş
;Ÿtm++è
rho
[Ÿtm]=
rho_xchng
[Ÿtm]=
F_xchng
[iatm]=0.0;

198 
Ÿtm
=0;Ÿtm<
Çtms_lş
;iatm++)

200 
›Ëm
=
–em_m­
[
evec
[
Ÿtm
]];

201 cÚ¡ 
li¡_size
=
ÃighbÜ_li¡_size
[
Ÿtm
];

202 
j
=0,
j©m
;j<
li¡_size
;j++)

204 
j©m
=
ÃighbÜ_li¡
[
Ÿtm
][
j
];

205 
j–em
=
–em_m­
[
evec
[
j©m
]];

206 
rsq
=
Algeb¿
::
RSQ
<
__dim__
>(
x
+
Ÿtm
*__dim__,x+
j©m
*__dim__);

207 if(
rsq
>=
cut_sq
[
›Ëm
][
j–em
]) ;

208 
r
=
	`sq¹
(
rsq
);

210 
rho
[
Ÿtm
]+=
—m_func
->
	`rho
(
j–em
,
›Ëm
,
r
);

212 if(
j©m
<
Çtms_lş
)

213 
rho
[
j©m
]+=
—m_func
->
	`rho
(
›Ëm
,
j–em
,
r
);

215 
F
[
Ÿtm
]=
—m_func
->
	`F
(
›Ëm
,
rho
[iatm]);

217 
	}
}

221 
	gFÜûF›ldEAMFunc
::
	$fš_xchng
()

223 
d–‘e
 
F_xchng_±r
;

224 
d–‘e
 
rho_xchng_±r
;

225 
d–‘e
 
F_±r
;

226 
	}
}

230 
	gFÜûF›ldEAMFunc
::
	$´e_xchng_’”gy
(
GCMC
* 
gcmc
)

232 & 
icomm
=
gcmc
->icomm;

233 
ty³0
 
’
;

234 
ty³0
 
rho_Ÿtm_lş
;

236 & 
Ÿtm
=
gcmc
->iatm;

237 
–em_ty³
& 
›Ëm
=
gcmc
->ielem;

239 & 
j©m
=
gcmc
->jatm;

240 
–em_ty³
& 
j–em
=
gcmc
->jelem;

243 
ty³0
&
rsq
=
gcmc
->rsq;

245 
ty³0
 
r
;

246 
ty³0
 
c0
=1.0,
’0
=0.0;

248 
ty³0
* 
rho
=
rho_±r
->
	`begš
();

249 
ty³0
* 
rho_xchng
=
rho_xchng_±r
->
	`begš
();

250 * 
g
=
gcmc
->
g_vec_p
->
	`begš
();

251 cÚ¡ 
Çtms_lş
=
©oms
->natms_lcl;

252 
i
=0;i<
Çtms_lş
;i++)

253 
rho_xchng
[
i
]=
rho
[i];

255 
gcmc
->
	`»£t_icomm
();
icomm
!=-1;gcmc->
	`Ãxt_icomm
())

257 
c0
=1.0;

258 if(
gcmc
->
xchng_mode
==
DEL_MODE
è
c0
=-1.0;

259 if(
gcmc
->
xchng_mode
==
NOEX_MODE
) ;

261 
’
=
rho_Ÿtm_lş
=0.0;

262 
gcmc
->
	`»£t_Ÿtm
();
Ÿtm
!=-1;gcmc->
	`Ãxt_Ÿtm
())

263 
gcmc
->
	`»£t_j©m
();
j©m
!=-1;gcmc->
	`Ãxt_j©m
())

265 
r
=
	`sq¹
(
rsq
);

267 if(
j©m
<
Çtms_lş
)

269 
’
+=
—m_func
->
	`phi
(
–em_m­
[
›Ëm
],–em_m­[
j–em
],
r
);

270 
rho_xchng
[
j©m
]+=
c0
*
—m_func
->
	`rho
(
–em_m­
[
›Ëm
],–em_m­[
j–em
],
r
);

273 
’
+=0.5*
—m_func
->
	`phi
(
–em_m­
[
›Ëm
],–em_m­[
j–em
],
r
);

275 
rho_Ÿtm_lş
+=
—m_func
->
	`rho
(
–em_m­
[
j–em
],–em_m­[
›Ëm
],
r
);

280 
ty³0
* 
F
=
F_±r
->
	`begš
();

281 
ty³0
* 
F_xchng
=
F_xchng_±r
->
	`begš
();

282 
–em_ty³
* 
evec
=
©oms
->
–em
->
	`begš
();

284 
ty³0
 
tmp0
;

285 
’0
=0.0;

286 
i
=0;i<
Çtms_lş
;i++)

287 if(
g
[
i
]==
icomm
)

289 
tmp0
=
rho_xchng
[
i
];

290 
F_xchng
[
i
]=
—m_func
->
	`F
(
–em_m­
[
evec
[i]],
rho_xchng
[i]);

291 
’0
+=
F_xchng
[
i
]-
F
[i];

294 
’
+=
’0
*
c0
;

296 
gcmc
->
lş_v¬s
[0]=
’
;

297 
gcmc
->
lş_v¬s
[1]=
rho_Ÿtm_lş
;

300 
	}
}

304 
ty³0
 
	gFÜûF›ldEAMFunc
::
	$xchng_’”gy
(
GCMC
* 
gcmc
)

306 & 
icomm
=
gcmc
->icomm;

307 
gcmc
->
	`»£t_icomm
();
icomm
!=-1;gcmc->
	`Ãxt_icomm
())

308 
	`MPI_Reduû
(
gcmc
->
lş_v¬s
,gcmc->
v¬s
,2,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,gcmc->
cu¼_roÙ
,*gcmc->
cu¼_comm
);

311 if(
gcmc
->
im_roÙ
)

314 
gcmc
->
	`»£t_icomm
();

315 if(
gcmc
->
xchng_mode
==
NOEX_MODE
)  0.0;

316  
—m_func
->
	`F
(
–em_m­
[
gcmc
->
›Ëm
],gcmc->
v¬s
[1])+gcmc->vars[0];

319 
	}
}

323 
	gFÜûF›ldEAMFunc
::
	$po¡_xchng_’”gy
(
GCMC
* 
gcmc
)

325 * 
g
=
gcmc
->
g_vec_p
->
	`begš
();

326 
ty³0
* 
rho
=
rho_±r
->
	`begš
();

327 
ty³0
* 
F
=
F_±r
->
	`begš
();

329 
ty³0
* 
rho_xchng
=
rho_xchng_±r
->
	`begš
();

330 
ty³0
* 
F_xchng
=
F_xchng_±r
->
	`begš
();

331 cÚ¡ 
Çtms_lş
=
©oms
->natms_lcl;

332 
i
=0;i<
Çtms_lş
;i++)

333 if(
g
[
i
]==0)

335 
rho
[
i
]=
rho_xchng
[i];

336 
F
[
i
]=
F_xchng
[i];

339 if(
gcmc
->
im_roÙ
 && gcmc->
xchng_mode
==
INS_MODE
 && gcmc->
roÙ_succ
)

341 
rho
[
Çtms_lş
-1]=
gcmc
->
v¬s
[1];

342 
F
[
Çtms_lş
-1]=
—m_func
->
	`F
(
–em_m­
[
gcmc
->
›Ëm
],
rho
[natms_lcl-1]);

344 
	}
}

348 
	~<dlfú.h
>

349 
	gFÜûF›ldEAMFunc
::
	$ml_Ãw
(
PyM‘hodDef
& 
_m‘hods
)

351 
_m‘hods
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

352 
_m‘hods
.
ml_Çme
="ff_eam_func";

354 
_m‘hods
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

355 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

358 
FuncAPI
<
¡d
::
¡ršg
> 
	`f
("ff_eam_func",{"so_file"});

359 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

361 * 
so
=
	`dlİ’
(
f
.
v®
<0>().
	`c_¡r
(),
RTLD_LAZY
);

362 
ü—‹_—m_ff_t
* 
ff_—m
=
»š‹½»t_ÿ¡
<ü—‹_—m_ff_t*>Ğ
	`dlsym
(
so
,"create_eam_ff"));

363 
EAMFunc
* 
ff_—m_func
=
	`ff_—m
();

364 
AtomsMD
::
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<AtomsMD::Objeù*>(
£lf
);

365 
–em_ty³
* 
__–em_m­
=
NULL
;

366 
Œy


368 
__–em_m­
=
ff_—m_func
->
	`»m­
(
__£lf
->
©oms
->
–em’ts
.
Çmes
,__£lf->©oms->–em’ts.
__ÃËms
);

370 
	`ÿtch
(
¡d
::
¡ršg
& 
”r_msg
)

372 
d–‘e
 
ff_—m_func
;

373 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,
”r_msg
.
	`c_¡r
());

374  
NULL
;

377 
d–‘e
 
__£lf
->
ff
;

378 
__£lf
->
ff
=
Ãw
 
	`FÜûF›ldEAMFunc
(__£lf->
©oms
,
ff_—m_func
,
¡d
::
	`move
(
__–em_m­
));

379 
Py_RETURN_NONE
;

382 
_m‘hods
.
ml_doc
=(*)"";

383 
	}
}

	@ff_eam_func.h

1 #iâdeà
__MAPP__ff_—m_func__


2 
	#__MAPP__ff_—m_func__


	)

3 
	~"ff_md.h
"

4 
Çme¥aû
 
	gMAPP_NS


6 şas 
	cFÜûF›ldEAMFunc
: 
public
 
FÜûF›ldMD


8 
´iv©e
:

9 
şass
 
EAMFunc
* 
—m_func
;

10 
	gVec
<
	gty³0
>* 
	grho_±r
;

11 
	gVec
<
	gty³0
>* 
	gF_±r
;

12 
	gVec
<
	gty³0
>* 
	grho_xchng_±r
;

13 
	gVec
<
	gty³0
>* 
	gF_xchng_±r
;

14 
–em_ty³
* 
	g–em_m­
;

15 
	g´Ùeùed
:

16 
__fÜû_ÿlc
();

17 
__’”gy_ÿlc
();

18 
´e_xchng_’”gy
(
GCMC
*);

19 
ty³0
 
xchng_’”gy
(
GCMC
*);

20 
po¡_xchng_’”gy
(
GCMC
*);

21 
	gpublic
:

22 
FÜûF›ldEAMFunc
(
şass
 
AtomsMD
*,şas 
EAMFunc
*,
–em_ty³
*&&);

23 ~
FÜûF›ldEAMFunc
();

25 
ml_Ãw
(
PyM‘hodDef
&);

26 
š™
();

27 
fš
();

28 
š™_xchng
();

29 
fš_xchng
();

	@ff_eam_potfit.cpp

1 
	~"ff_—m_pÙf™.h
"

2 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

6 
	gFÜûF›ldEAMPÙF™
<
	gFÜûF›ldEAMPÙF™AckOg©a
::
ÃËms
>* 
FÜûF›ldEAMPÙF™AckOg©a
::
	$g‘_Ãw_ff
(
AtomsMD
* 
©oms
,
PyObjeù
* 
¬gs
,PyObjeù* 
kwds
)

8 
¡d
::
¡ršg
 
__Çmes
[
ÃËms
]={"Fe","H"};

9 
size_t
 
i
=0;i<
©oms
->
–em’ts
.
ÃËms
;i++)

11 
boŞ
 
found
=
çl£
;

12 
size_t
 
j
=0;j<
ÃËms
 && !
found
;j++)

13 if(
	`¡rcmp
(
__Çmes
[
j
].
	`c_¡r
(),
©oms
->
–em’ts
.
Çmes
[
i
].c_¡r())==0è
found
=
Œue
;

14 if(!
found
)

16 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"thi fÜûf›ld dÛ nÙ suµÜˆ–emÁ %s",
©oms
->
–em’ts
.
Çmes
[
i
].
	`c_¡r
());

17  
NULL
;

22 
FuncAPI
<
OB
<
PyLi¡Objeù
,
PyLi¡_Ty³
>,OB<PyListObject,PyList_Type>,OB<PyListObject,PyList_Type>,

23 
OB
<
PyLi¡Objeù
,
PyLi¡_Ty³
>,OB<PyListObject,PyList_Type>,

24 
OB
<
PyLi¡Objeù
,
PyLi¡_Ty³
>,OB<PyListObject,PyList_Type>>

25 
	`f
("ff_eam_fit_o",{"A_phi_FeFe","A_phi_FeH","A_phi_HH","A_rho_Fe","A_rho_H","A_F_Fe","A_F_H"});

26 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

30 
PÙF™PaœFunc
* 
__phi_±r
[
ÃËms
][nelems];

31 
PÙF™PaœFunc
* 
__rho_±r
[
ÃËms
][nelems];

32 
PÙF™EmbFunc
* 
__F_±r
[
ÃËms
];

33 
__phi_±r
[0][0]=
Ãw
 
	`PÙF™PhiS¶
("phi_FeFe");

34 
__phi_±r
[1][0]=
Ãw
 
	`PÙF™PhiS¶
("phi_FeH");

35 
__phi_±r
[0][1]=__phi_ptr[1][0];

36 
__phi_±r
[1][1]=
Ãw
 
	`PÙF™PhiS¶
("phi_HH");

38 
__rho_±r
[0][0]=
Ãw
 
	`PÙF™RhoS¶
("rho_Fe");

39 
__rho_±r
[1][0]=
Ãw
 
	`PÙF™RhoAng
("rho_H");

40 
__rho_±r
[0][1]=__rho_ptr[0][0];

41 
__rho_±r
[1][1]=__rho_ptr[1][0];

43 
__F_±r
[0]=
Ãw
 
	`PÙF™EmbAck
("F_Fe");

44 
__F_±r
[1]=
Ãw
 
	`PÙF™EmbAng
("F_H");

46 
ty³0
* 
d©a
=
NULL
;

47 
size_t
 
tÙ_nv¬s
=0;

48 
£t
=0;

50 if(
£t
==0è£t=
__phi_±r
[0][0]->
	`£t_š™
(
f
.
v®
<0>(),
d©a
,
tÙ_nv¬s
);

51 if(
£t
==0è£t=
__phi_±r
[0][1]->
	`£t_š™
(
f
.
v®
<1>(),
d©a
,
tÙ_nv¬s
);

52 if(
£t
==0è£t=
__phi_±r
[1][1]->
	`£t_š™
(
f
.
v®
<2>(),
d©a
,
tÙ_nv¬s
);

54 if(
£t
==0è£t=
__rho_±r
[0][0]->
	`£t_š™
(
f
.
v®
<3>(),
d©a
,
tÙ_nv¬s
);

55 if(
£t
==0è£t=
__rho_±r
[1][0]->
	`£t_š™
(
f
.
v®
<4>(),
d©a
,
tÙ_nv¬s
);

57 if(
£t
==0è£t=
__F_±r
[0]->
	`£t_š™
(
f
.
v®
<5>(),
d©a
,
tÙ_nv¬s
);

58 if(
£t
==0è£t=
__F_±r
[1]->
	`£t_š™
(
f
.
v®
<6>(),
d©a
,
tÙ_nv¬s
);

60 if(
£t
)

62 
d–‘e
 
__F_±r
[1];

63 
d–‘e
 
__F_±r
[0];

64 
d–‘e
 
__phi_±r
[1][1];

65 
d–‘e
 
__phi_±r
[0][1];

66 
d–‘e
 
__phi_±r
[0][0];

67 
d–‘e
 
__rho_±r
[1][0];

68 
d–‘e
 
__rho_±r
[0][0];

69  
NULL
;

72 
ty³0
* 
__d©a
=
d©a
;

74 
__phi_±r
[0][0]->
v¬s
=
__d©a
;

75 
__d©a
+=
__phi_±r
[0][0]->
nv¬s
;

76 
__phi_±r
[0][1]->
v¬s
=
__d©a
;

77 
__d©a
+=
__phi_±r
[0][1]->
nv¬s
;

78 
__phi_±r
[1][1]->
v¬s
=
__d©a
;

79 
__d©a
+=
__phi_±r
[1][1]->
nv¬s
;

82 
__rho_±r
[0][0]->
v¬s
=
__d©a
;

83 
__d©a
+=
__rho_±r
[0][0]->
nv¬s
;

84 
__rho_±r
[1][0]->
v¬s
=
__d©a
;

85 
__d©a
+=
__rho_±r
[1][0]->
nv¬s
;

88 
__F_±r
[0]->
v¬s
=
__d©a
;

89 
__d©a
+=
__F_±r
[0]->
nv¬s
;

90 
__F_±r
[1]->
v¬s
=
__d©a
;

91 
__d©a
+=
__F_±r
[1]->
nv¬s
;

93  
Ãw
 
FÜûF›ldEAMPÙF™
<
ÃËms
>(
©oms
,
__Çmes
,
d©a
,
tÙ_nv¬s
,
__phi_±r
,
__rho_±r
,
__F_±r
);

94 
	}
}

98 
	gFÜûF›ldEAMPÙF™AckOg©a
::
	$ml_Ãw
(
PyM‘hodDef
& 
_m‘hods
)

100 
_m‘hods
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

101 
_m‘hods
.
ml_Çme
="ff_eam_ao";

102 
_m‘hods
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

103 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

105 
AtomsMD
::
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<AtomsMD::Objeù*>(
£lf
);

106 
FÜûF›ldMD
* 
Ãw_ff
=
	`g‘_Ãw_ff
(
__£lf
->
©oms
,
¬gs
,
kwds
);

107 if(
Ãw_ff
==
NULL
)  NULL;

108 
d–‘e
 
__£lf
->
ff
;

109 
__£lf
->
ff
=
Ãw_ff
;

110 
Py_RETURN_NONE
;

113 
_m‘hods
.
ml_doc
="";

114 
	}
}

	@ff_eam_potfit.h

1 #iâdeà
__MAPP__ff_—m_pÙf™__


2 
	#__MAPP__ff_—m_pÙf™__


	)

3 
	~"ff_md.h
"

4 
	~"xm©h.h
"

5 
	~"pÙf™_funcs.h
"

6 
	~"©oms_md.h
"

7 
	~"ÃighbÜ_md.h
"

8 
	~"dyÇmic_md.h
"

9 
	~"memÜy.h
"

10 
Çme¥aû
 
	gMAPP_NS


14 
	g‹m¶©e
<
size_t
 
	gNELEMS
>

15 şas 
	cFÜûF›ldEAMPÙF™
: 
public
 
FÜûF›ldMD


17 
´iv©e
:

19 
ty³0
 
phi_ÿlc
(
–em_ty³
,elem_type,type0);

20 
ty³0
 
rho_ÿlc
(
–em_ty³
,elem_type,type0);

21 
ty³0
 
F_ÿlc
(
–em_ty³
,type0);

22 
ty³0
 
åaœ_ÿlc
(
–em_ty³
,elem_type,type0,type0,type0);

23 
»Üd”
(
¡d
::
¡ršg
*,
size_t
);

25 
	gVec
<
	gty³0
>* 
	grho_vec_±r
;

26 
	g‹m¶©e
<
şass
 
	gT
,
size_t
 
	gN
>

27 
size_t
 
fšd_uniq
(
T
** 
Üig
,T**& 
uniq
)

29 
T
* 
	g__uniq
[
N
];

30 
memıy
(
__uniq
,
Üig
,
N
*(
T
*));

31 
	gXM©h
::
quicksÜt
(
__uniq
,__uniq+
N
,

32 [](
T
** 
¿nk_i
,T** 
¿nk_j
){ (*rank_i<*rank_j);},

33 [](
T
** 
¿nk_i
,T** 
¿nk_j
){
¡d
::
sw­
(*rank_i,*rank_j);});

34 
size_t
 
	gsz
=1;

35 
T
* 
	g´ev
=*
__uniq
;

36 
size_t
 
	gi
=1;i<
	gN
;i++)

37 if(
	g__uniq
[
i
]!=
´ev
)

39 
´ev
=
__uniq
[
i
];

40 
	gsz
++;

43 
	gMemÜy
::
®loc
(
uniq
,
sz
);

44 *
	guniq
=
´ev
=*
__uniq
;

45 
	gsz
=1;

46 
size_t
 
	gi
=1;i<
	gN
;i++)

47 if(
	g__uniq
[
i
]!=
´ev
)

49 
uniq
[
sz
]=
__uniq
[
i
];

50 
	g´ev
=
__uniq
[
i
];

51 
	gsz
++;

54  
	gsz
;

57 
	g´Ùeùed
:

58 
__fÜû_ÿlc
();

59 
__’”gy_ÿlc
();

60 
´e_xchng_’”gy
(
GCMC
*){};

61 
ty³0
 
xchng_’”gy
(
GCMC
*){ 0.0;};

62 
po¡_xchng_’”gy
(
GCMC
*){};

63 
	gpublic
:

64 
FÜûF›ldEAMPÙF™
(
AtomsMD
*,

65 
¡d
::
¡ršg
(&)[
NELEMS
],

66 
ty³0
*&,
size_t
,

67 
PÙF™PaœFunc
*(&)[
NELEMS
][NELEMS],PÙF™PaœFunc*(&)[NELEMS][NELEMS],
PÙF™EmbFunc
*(&)[NELEMS]);

68 
	gvœtu®
 ~
FÜûF›ldEAMPÙF™
();

69 
£t_cutoff
();

70 
š™
();

71 
fš
();

72 
š™_xchng
(){};

73 
fš_xchng
(){};

74 
’”gy_g¿d›Á
();

75 
fÜû_g¿d›Á
();

76 
ty³0
 
m—n_rho
(
–em_ty³
);

78 
size_t
 
	gnvs
;

79 
ty³0
* 
	gvs
;

80 
ty³0
* 
	gv0s
;

81 
ty³0
* 
	gdvs
;

82 
ty³0
* 
	gdvs_lş
;

83 
boŞ
* 
	gdofs
;

84 
ty³0
* 
	gfvs
;

85 
ty³0
* 
	gf0vs
;

86 
ty³0
* 
	ghvs
;

87 
ty³0
* 
	gdvs_max
;

90 
	g¡d
::
¡ršg
 
Çmes
[
NELEMS
];

91 
PÙF™PaœFunc
* 
	grho_±r
[
NELEMS
][NELEMS];

92 
PÙF™PaœFunc
* 
	gphi_±r
[
NELEMS
][NELEMS];

93 
PÙF™EmbFunc
* 
	gF_±r
[
NELEMS
];

95 
PÙF™PaœFunc
** 
	guniq_rho_±r
;

96 
PÙF™PaœFunc
** 
	guniq_phi_±r
;

97 
PÙF™EmbFunc
** 
	guniq_F_±r
;

98 
size_t
 
	gnuniq_phi_±rs
;

99 
size_t
 
	gnuniq_rho_±rs
;

100 
size_t
 
	gnuniq_F_±rs
;

104 şas 
	cFÜûF›ldEAMPÙF™AckOg©a


106 
	g´iv©e
:

107 
´Ùeùed
:

108 
public
:

109 
cÚ¡ex´
 
size_t
 
ÃËms
=2;

110 
	gFÜûF›ldEAMPÙF™
<
	gÃËms
>* 
g‘_Ãw_ff
(
şass
 
AtomsMD
*,
PyObjeù
*,PyObject*);

111 
ml_Ãw
(
PyM‘hodDef
&);

117 
	g‹m¶©e
<
size_t
 
	gNELEMS
>

118 
	gFÜûF›ldEAMPÙF™
<
	gNELEMS
>::
FÜûF›ldEAMPÙF™
(
AtomsMD
* 
__©oms
,

119 
¡d
::
¡ršg
 (&
__Çmes
)[
NELEMS
],

120 
ty³0
*& 
__vs
,
size_t
 
__nvs
,

121 
PÙF™PaœFunc
*(& 
__phi_±r
)[
NELEMS
][NELEMS],

122 
PÙF™PaœFunc
*(&
__rho_±r
)[
NELEMS
][NELEMS],

123 
PÙF™EmbFunc
*(&
__F_±r
)[
NELEMS
]):

124 
FÜûF›ldMD
(
__©oms
),
vs
(
__vs
),
nvs
(
__nvs
),

125 
uniq_rho_±r
(
NULL
),

126 
uniq_phi_±r
(
NULL
),

127 
	$uniq_F_±r
(
NULL
)

129 
	`memıy
(&
phi_±r
[0][0],&
__phi_±r
[0][0],
NELEMS
*NELEMS*(
PÙF™PaœFunc
*));

130 
	`memıy
(&
rho_±r
[0][0],&
__rho_±r
[0][0],
NELEMS
*NELEMS*(
PÙF™PaœFunc
*));

131 
	`memıy
(
F_±r
,
__F_±r
,
NELEMS
*(
PÙF™EmbFunc
*));

132 
size_t
 
i
=0;i<
NELEMS
;i++è
Çmes
[i]=
__Çmes
[i];

133 
	`»Üd”
(
__©oms
->
–em’ts
.
Çmes
, __©oms->–em’ts.
ÃËms
);

134 
	`£t_cutoff
();

135 
MemÜy
::
	`®loc
(
v0s
,
nvs
);

136 
MemÜy
::
	`®loc
(
dvs
,
nvs
);

137 
MemÜy
::
	`®loc
(
dvs_lş
,
nvs
);

138 
MemÜy
::
	`®loc
(
dofs
,
nvs
);

139 
MemÜy
::
	`®loc
(
fvs
,
nvs
);

140 
MemÜy
::
	`®loc
(
f0vs
,
nvs
);

141 
MemÜy
::
	`®loc
(
hvs
,
nvs
);

142 
MemÜy
::
	`®loc
(
dvs_max
,
nvs
);

144 
	#POTFIT_OFFSET
(
A
) \

145 
off£t
=
A
->
v¬s
-
vs
; \

146 
A
->
dv¬s_lş
=
dvs_lş
+
off£t
; \

147 
A
->
dofs
=dofs+
off£t
; \

148 
A
->
dv¬s_max
=
dvs_max
+
off£t
; \

149 
A
->
hv¬s
=
hvs
+
off£t


	)

151 
±rdiff_t
 
off£t
;

152 
size_t
 
i
=0;i<
NELEMS
;i++)

154 
	`POTFIT_OFFSET
(
F_±r
[
i
]);

156 
size_t
 
j
=0;j<
NELEMS
;j++)

158 
	`POTFIT_OFFSET
(
phi_±r
[
i
][
j
]);

159 
	`POTFIT_OFFSET
(
rho_±r
[
i
][
j
]);

163 
size_t
 
i
=0;i<
nvs
;i++)

165 
dofs
[
i
]=
Œue
;

166 
dvs_max
[
i
]=1.0;

172 
nuniq_rho_±rs
=
nuniq_phi_±rs
=
nuniq_F_±rs
=0;

173 
nuniq_phi_±rs
=
NELEMS
*(NELEMS+1)/2;

174 
nuniq_rho_±rs
=
nuniq_F_±rs
=
NELEMS
;

175 
MemÜy
::
	`®loc
(
uniq_phi_±r
,
nuniq_phi_±rs
);

176 
MemÜy
::
	`®loc
(
uniq_rho_±r
,
nuniq_rho_±rs
);

177 
MemÜy
::
	`®loc
(
uniq_F_±r
,
nuniq_F_±rs
);

179 
nuniq_rho_±rs
=
nuniq_phi_±rs
=
nuniq_F_±rs
=0;

180 
size_t
 
i
=0;i<
NELEMS
;i++)

182 
uniq_rho_±r
[
nuniq_rho_±rs
++]=
rho_±r
[
i
][0];

183 
uniq_F_±r
[
nuniq_F_±rs
++]=
F_±r
[
i
];

185 
size_t
 
j
=0;j<
i
+1;j++)

186 
uniq_phi_±r
[
nuniq_phi_±rs
++]=
phi_±r
[
i
][
j
];

188 
	}
}

192 
	g‹m¶©e
<
size_t
 
	gNELEMS
>

193 
	gFÜûF›ldEAMPÙF™
<
	gNELEMS
>::~
	$FÜûF›ldEAMPÙF™
()

195 
MemÜy
::
	`d—Îoc
(
dvs_max
);

196 
MemÜy
::
	`d—Îoc
(
hvs
);

197 
MemÜy
::
	`d—Îoc
(
f0vs
);

198 
MemÜy
::
	`d—Îoc
(
fvs
);

199 
MemÜy
::
	`d—Îoc
(
dofs
);

200 
MemÜy
::
	`d—Îoc
(
dvs_lş
);

201 
MemÜy
::
	`d—Îoc
(
dvs
);

202 
MemÜy
::
	`d—Îoc
(
v0s
);

203 
MemÜy
::
	`d—Îoc
(
vs
);

204 
size_t
 
i
=0;i<
nuniq_phi_±rs
;i++è
d–‘e
 
uniq_phi_±r
[i];

205 
size_t
 
i
=0;i<
nuniq_rho_±rs
;i++è
d–‘e
 
uniq_rho_±r
[i];

206 
size_t
 
i
=0;i<
nuniq_F_±rs
;i++è
d–‘e
 
uniq_F_±r
[i];

207 *
uniq_phi_±r
=
NULL
;

208 *
uniq_rho_±r
=
NULL
;

209 *
uniq_F_±r
=
NULL
;

210 
MemÜy
::
	`d—Îoc
(
uniq_phi_±r
);

211 
MemÜy
::
	`d—Îoc
(
uniq_rho_±r
);

212 
MemÜy
::
	`d—Îoc
(
uniq_F_±r
);

213 
	}
}

217 
	g‹m¶©e
<
size_t
 
	gNELEMS
>

218 
	gFÜûF›ldEAMPÙF™
<
	gNELEMS
>::
	$»Üd”
(
¡d
::
¡ršg
* 
__Çmes
,
size_t
 
__ÃËms
)

220 if(
__ÃËms
>
NELEMS
è
throw
 1;

222 
size_t
 
Şd_2_Ãw
[
NELEMS
];

223 
size_t
 
i
=0;i<
NELEMS
;i++è
Şd_2_Ãw
[i]=i;

224 
size_t
 
i
=0;i<
__ÃËms
;i++)

226 
boŞ
 
âd
=
çl£
;

227 
size_t
 
j
=
i
;j<
NELEMS
&&!
âd
;j++)

228 if(
	`¡rcmp
(
__Çmes
[
i
].
	`c_¡r
(),
Çmes
[
Şd_2_Ãw
[
j
]].c_str())==0)

230 
¡d
::
	`sw­
(
Şd_2_Ãw
[
i
],Şd_2_Ãw[
j
]);

231 
âd
=
Œue
;

233 if(!
âd
)

234 
throw
 2;

238 
PÙF™PaœFunc
* 
__rho_±r
[
NELEMS
][NELEMS];

239 
PÙF™PaœFunc
* 
__phi_±r
[
NELEMS
][NELEMS];

240 
PÙF™EmbFunc
* 
__F_±r
[
NELEMS
];

241 
¡d
::
¡ršg
 
___Çmes
[
NELEMS
];

242 
size_t
 
i
=0;i<
NELEMS
;i++)

244 
___Çmes
[
i
]=
Çmes
[i];

245 
__F_±r
[
i
]=
F_±r
[i];

246 
size_t
 
j
=0;j<
NELEMS
;j++)

248 
__phi_±r
[
i
][
j
]=
phi_±r
[i][j];

249 
__rho_±r
[
i
][
j
]=
rho_±r
[i][j];

254 
size_t
 
i
=0;i<
NELEMS
;i++)

256 
Çmes
[
i
]=
___Çmes
[
Şd_2_Ãw
[i]];

257 
F_±r
[
i
]=
__F_±r
[
Şd_2_Ãw
[i]];

258 
size_t
 
j
=0;j<
NELEMS
;j++)

260 
phi_±r
[
i
][
j
]=
__phi_±r
[
Şd_2_Ãw
[i]][old_2_new[j]];

261 
rho_±r
[
i
][
j
]=
__rho_±r
[
Şd_2_Ãw
[i]][old_2_new[j]];

265 
	}
}

269 
	g‹m¶©e
<
size_t
 
	gNELEMS
>

270 
	gFÜûF›ldEAMPÙF™
<
	gNELEMS
>::
	$£t_cutoff
()

272 
size_t
 
i
=0;i<
ÃËms
;i++)

273 
size_t
 
j
=0;j<
i
+1;j++)

275 
cut
[
i
][
j
]=cut[j][i]=
	`MAX
(
phi_±r
[i][j]->
rc
,MAX(
rho_±r
[i][j]->rc,rho_ptr[j][i]->rc));

276 
cut_sq
[
i
][
j
]=cut_sq[j][i]=
cut
[i][j]*cut[i][j];

278 
	}
}

282 
	g‹m¶©e
<
size_t
 
	gNELEMS
>

283 
	gFÜûF›ldEAMPÙF™
<
	gNELEMS
>::
	$š™
()

285 
	`´e_š™
();

286 
rho_vec_±r
=
Ãw
 
Vec
<
ty³0
>(
©oms
,1,"rho");

287 
	}
}

291 
	g‹m¶©e
<
size_t
 
	gNELEMS
>

292 
	gFÜûF›ldEAMPÙF™
<
	gNELEMS
>::
	$fš
()

294 
d–‘e
 
rho_vec_±r
;

295 
	`po¡_fš
();

296 
	}
}

300 
	g‹m¶©e
<
size_t
 
	gNELEMS
>

301 
	gFÜûF›ldEAMPÙF™
<
	gNELEMS
>::
	$__fÜû_ÿlc
()

303 
ty³0
* 
xvec
=
©oms
->
x
->
	`begš
();

304 
ty³0
* 
fvec
=
f
->
	`begš
();

305 
ty³0
* 
rho
=
rho_vec_±r
->
	`begš
();

306 
–em_ty³
* 
evec
=
©oms
->
–em
->
	`begš
();

308 
Ÿtm
,
j©m
;

309 
–em_ty³
 
›Ëm
,
j–em
;

310 
ty³0
 
r
,
rsq
;

311 
ty³0
 
åaœ
;

312 
ty³0
 
dx_ij
[
__dim__
];

313 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->neighbor_list;

314 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->neighbor_list_size;

315 cÚ¡ 
Çtms_lş
=
©oms
->natms_lcl;

316 
i
=0;i<
Çtms_lş
;i++)

317 
rho
[
i
]=0.0;

319 
Ÿtm
=0;Ÿtm<
Çtms_lş
;iatm++)

321 
›Ëm
=
evec
[
Ÿtm
];

322 
j
=0;j<
ÃighbÜ_li¡_size
[
Ÿtm
];j++)

324 
j©m
=
ÃighbÜ_li¡
[
Ÿtm
][
j
];

325 
j–em
=
evec
[
j©m
];

326 
rsq
=
Algeb¿
::
RSQ
<
__dim__
>(
xvec
+
Ÿtm
*__dim__,xvec+
j©m
*__dim__);

327 if(
rsq
>=
cut_sq
[
›Ëm
][
j–em
]) ;

328 
r
=
	`sq¹
(
rsq
);

331 
rho
[
Ÿtm
]+=
	`rho_ÿlc
(
j–em
,
›Ëm
,
r
);

332 if(
j©m
<
Çtms_lş
)

334 
rho
[
j©m
]+=
	`rho_ÿlc
(
›Ëm
,
j–em
,
r
);

335 
__vec_lş
[0]+=
	`phi_ÿlc
(
›Ëm
,
j–em
,
r
);

338 
__vec_lş
[0]+=0.5*
	`phi_ÿlc
(
›Ëm
,
j–em
,
r
);

340 
__vec_lş
[0]+=
	`F_ÿlc
(
›Ëm
,
rho
[
Ÿtm
]);

344 
	`upd©e
(
rho_vec_±r
);

348 
Ÿtm
=0;Ÿtm<
Çtms_lş
;iatm++)

350 
›Ëm
=
evec
[
Ÿtm
];

352 
j
=0;j<
ÃighbÜ_li¡_size
[
Ÿtm
];j++)

354 
j©m
=
ÃighbÜ_li¡
[
Ÿtm
][
j
];

355 
j–em
=
evec
[
j©m
];

357 
rsq
=
Algeb¿
::
DX_RSQ
<
__dim__
>(
xvec
+
Ÿtm
*__dim__,xvec+
j©m
*__dim__,
dx_ij
);

358 if(
rsq
>=
cut_sq
[
›Ëm
][
j–em
]) ;

360 
r
=
	`sq¹
(
rsq
);

363 
åaœ
=
	`åaœ_ÿlc
(
›Ëm
,
j–em
,
rho
[
Ÿtm
],rho[
j©m
],
r
);

365 if(
åaœ
==0.0) ;

367 
Algeb¿
::
V_add_x_mul_V
<
__dim__
>(
åaœ
,
dx_ij
,
fvec
+
Ÿtm
*__dim__);

368 if(
j©m
<
Çtms_lş
)

369 
Algeb¿
::
V_add_x_mul_V
<
__dim__
>(-
åaœ
,
dx_ij
,
fvec
+
j©m
*__dim__);

371 
åaœ
*=0.5;

373 
Algeb¿
::
DyadicV
<
__dim__
>(-
åaœ
,
dx_ij
,&
__vec_lş
[1]);

376 
ty³0
 
f_sum_lş
[
__dim__
];

377 
Algeb¿
::
z”o
<
__dim__
>(
f_sum_lş
);

378 
i
=0;i<
Çtms_lş
;i++)

379 
Algeb¿
::
V_add
<
__dim__
>(
fvec
+__dim__*
i
,
f_sum_lş
);

381 
ty³0
 
f_cÜr
[
__dim__
];

382 
	`MPI_AÎ»duû
(
f_sum_lş
,
f_cÜr
,
__dim__
,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

383 
ty³0
 
a
=-1.0/
¡©ic_ÿ¡
<ty³0>(
©oms
->
Çtms
);

384 
Algeb¿
::
Do
<
__dim__
>::
	`func
([&
a
,&
f_cÜr
](
i
){f_corr[i]*=a;});

385 
i
=0;i<
Çtms_lş
;i++)

386 
Algeb¿
::
V_add
<
__dim__
>(
f_cÜr
,
fvec
+__dim__*
i
);

387 
	}
}

391 
	g‹m¶©e
<
size_t
 
	gNELEMS
>

392 
	gFÜûF›ldEAMPÙF™
<
	gNELEMS
>::
	$__’”gy_ÿlc
()

394 
ty³0
* 
xvec
=
©oms
->
x
->
	`begš
();

395 
ty³0
* 
rho
=
rho_vec_±r
->
	`begš
();

396 
–em_ty³
* 
evec
=
©oms
->
–em
->
	`begš
();

398 
Ÿtm
,
j©m
;

399 
–em_ty³
 
›Ëm
,
j–em
;

400 
ty³0
 
r
,
rsq
;

402 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->neighbor_list;

403 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->neighbor_list_size;

404 cÚ¡ 
Çtms_lş
=
©oms
->natms_lcl;

405 
i
=0;i<
Çtms_lş
;i++)

406 
rho
[
i
]=0.0;

408 
Ÿtm
=0;Ÿtm<
Çtms_lş
;iatm++)

410 
›Ëm
=
evec
[
Ÿtm
];

411 
j
=0;j<
ÃighbÜ_li¡_size
[
Ÿtm
];j++)

413 
j©m
=
ÃighbÜ_li¡
[
Ÿtm
][
j
];

414 
j–em
=
evec
[
j©m
];

415 
rsq
=
Algeb¿
::
RSQ
<
__dim__
>(
xvec
+
Ÿtm
*__dim__,xvec+
j©m
*__dim__);

416 if(
rsq
>=
cut_sq
[
›Ëm
][
j–em
]) ;

417 
r
=
	`sq¹
(
rsq
);

420 
rho
[
Ÿtm
]+=
	`rho_ÿlc
(
j–em
,
›Ëm
,
r
);

421 if(
j©m
<
Çtms_lş
)

423 
rho
[
j©m
]+=
	`rho_ÿlc
(
›Ëm
,
j–em
,
r
);

424 
__vec_lş
[0]+=
	`phi_ÿlc
(
›Ëm
,
j–em
,
r
);

427 
__vec_lş
[0]+=0.5*
	`phi_ÿlc
(
›Ëm
,
j–em
,
r
);

430 
__vec_lş
[0]+=
	`F_ÿlc
(
›Ëm
,
rho
[
Ÿtm
]);

432 
	}
}

436 
	g‹m¶©e
<
size_t
 
	gNELEMS
>

437 
	gFÜûF›ldEAMPÙF™
<
	gNELEMS
>::
	$’”gy_g¿d›Á
()

439 
size_t
 
i
=0;i<
nvs
;i++è
dvs_lş
[i]=0.0;

440 
ty³0
* 
xvec
=
©oms
->
x
->
	`begš
();

441 
ty³0
* 
rho
=
rho_vec_±r
->
	`begš
();

442 
–em_ty³
* 
evec
=
©oms
->
–em
->
	`begš
();

444 
Ÿtm
,
j©m
;

445 
–em_ty³
 
›Ëm
,
j–em
;

446 
ty³0
 
r
,
rsq
,
cÛf
;

448 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->neighbor_list;

449 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->neighbor_list_size;

450 cÚ¡ 
Çtms_lş
=
©oms
->natms_lcl;

451 
i
=0;i<
Çtms_lş
;i++)

452 
rho
[
i
]=0.0;

454 
Ÿtm
=0;Ÿtm<
Çtms_lş
;iatm++)

456 
›Ëm
=
evec
[
Ÿtm
];

457 
j
=0;j<
ÃighbÜ_li¡_size
[
Ÿtm
];j++)

459 
j©m
=
ÃighbÜ_li¡
[
Ÿtm
][
j
];

460 
j–em
=
evec
[
j©m
];

461 
rsq
=
Algeb¿
::
RSQ
<
__dim__
>(
xvec
+
Ÿtm
*__dim__,xvec+
j©m
*__dim__);

462 if(
rsq
>=
cut_sq
[
›Ëm
][
j–em
]) ;

463 
r
=
	`sq¹
(
rsq
);

464 
cÛf
=
j©m
<
Çtms_lş
 ? 1.0:0.5;

465 
phi_±r
[
›Ëm
][
j–em
]->
	`DF
(
cÛf
,
r
);

467 
rho
[
Ÿtm
]+=
	`rho_ÿlc
(
j–em
,
›Ëm
,
r
);

468 if(
j©m
<
Çtms_lş
)

470 
rho
[
j©m
]+=
	`rho_ÿlc
(
›Ëm
,
j–em
,
r
);

471 
__vec_lş
[0]+=
	`phi_ÿlc
(
›Ëm
,
j–em
,
r
);

474 
__vec_lş
[0]+=0.5*
	`phi_ÿlc
(
›Ëm
,
j–em
,
r
);

477 
__vec_lş
[0]+=
	`F_ÿlc
(
›Ëm
,
rho
[
Ÿtm
]);

478 
F_±r
[
›Ëm
]->
	`DF
(
rho
[
Ÿtm
]);

481 
ty³0
 
dFj
,
dFi
;

483 
Ÿtm
=0;Ÿtm<
Çtms_lş
;iatm++)

485 
›Ëm
=
evec
[
Ÿtm
];

486 
dFi
=
F_±r
[
›Ëm
]->
	`dF
(
rho
[
Ÿtm
]);

487 
j
=0;j<
ÃighbÜ_li¡_size
[
Ÿtm
];j++)

489 
j©m
=
ÃighbÜ_li¡
[
Ÿtm
][
j
];

490 
j–em
=
evec
[
j©m
];

491 
rsq
=
Algeb¿
::
RSQ
<
__dim__
>(
xvec
+
Ÿtm
*__dim__,xvec+
j©m
*__dim__);

492 if(
rsq
>=
cut_sq
[
›Ëm
][
j–em
]) ;

493 
r
=
	`sq¹
(
rsq
);

495 
rho_±r
[
j–em
][
›Ëm
]->
	`DF
(
dFi
,
r
);

496 if(
j©m
<
Çtms_lş
)

498 
dFj
=
F_±r
[
j–em
]->
	`dF
(
rho
[
j©m
]);

499 
rho_±r
[
›Ëm
][
j–em
]->
	`DF
(
dFj
,
r
);

503 
	`MPI_AÎ»duû
(
dvs_lş
,
dvs
,
¡©ic_ÿ¡
<>(
nvs
),
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

504 
	`MPI_AÎ»duû
(
__vec_lş
,
__vec
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

505 
size_t
 
i
=0;i<
nvs
;i++)

506 if(!
dofs
[
i
]è
dvs
[i]=0.0;

507 
	}
}

511 
	g‹m¶©e
<
size_t
 
	gNELEMS
>

512 
	gFÜûF›ldEAMPÙF™
<
	gNELEMS
>::
	$fÜû_g¿d›Á
()

514 
size_t
 
i
=0;i<
nvs
;i++è
dvs_lş
[i]=0.0;

515 
ty³0
* 
xvec
=
©oms
->
x
->
	`begš
();

516 
ty³0
* 
rho
=
rho_vec_±r
->
	`begš
();

517 
–em_ty³
* 
evec
=
©oms
->
–em
->
	`begš
();

519 
Ÿtm
,
j©m
;

520 
–em_ty³
 
›Ëm
,
j–em
;

521 
ty³0
 
r
,
rsq
,
cÛf
;

523 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->neighbor_list;

524 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->neighbor_list_size;

525 cÚ¡ 
Çtms_lş
=
©oms
->natms_lcl;

526 
i
=0;i<
Çtms_lş
;i++)

527 
rho
[
i
]=0.0;

529 
Ÿtm
=0;Ÿtm<
Çtms_lş
;iatm++)

531 
›Ëm
=
evec
[
Ÿtm
];

532 
j
=0;j<
ÃighbÜ_li¡_size
[
Ÿtm
];j++)

534 
j©m
=
ÃighbÜ_li¡
[
Ÿtm
][
j
];

535 
j–em
=
evec
[
j©m
];

536 
rsq
=
Algeb¿
::
RSQ
<
__dim__
>(
xvec
+
Ÿtm
*__dim__,xvec+
j©m
*__dim__);

537 if(
rsq
>=
cut_sq
[
›Ëm
][
j–em
]) ;

538 
r
=
	`sq¹
(
rsq
);

539 
cÛf
=
j©m
<
Çtms_lş
 ? 1.0:0.5;

540 
phi_±r
[
›Ëm
][
j–em
]->
	`DF
(
cÛf
,
r
);

542 
rho
[
Ÿtm
]+=
	`rho_ÿlc
(
j–em
,
›Ëm
,
r
);

543 if(
j©m
<
Çtms_lş
)

545 
rho
[
j©m
]+=
	`rho_ÿlc
(
›Ëm
,
j–em
,
r
);

546 
__vec_lş
[0]+=
	`phi_ÿlc
(
›Ëm
,
j–em
,
r
);

549 
__vec_lş
[0]+=0.5*
	`phi_ÿlc
(
›Ëm
,
j–em
,
r
);

552 
__vec_lş
[0]+=
	`F_ÿlc
(
›Ëm
,
rho
[
Ÿtm
]);

553 
F_±r
[
›Ëm
]->
	`DF
(
rho
[
Ÿtm
]);

556 
ty³0
 
dFj
,
dFi
;

558 
Ÿtm
=0;Ÿtm<
Çtms_lş
;iatm++)

560 
›Ëm
=
evec
[
Ÿtm
];

561 
dFi
=
F_±r
[
›Ëm
]->
	`dF
(
rho
[
Ÿtm
]);

562 
j
=0;j<
ÃighbÜ_li¡_size
[
Ÿtm
];j++)

564 
j©m
=
ÃighbÜ_li¡
[
Ÿtm
][
j
];

565 
j–em
=
evec
[
j©m
];

566 
rsq
=
Algeb¿
::
RSQ
<
__dim__
>(
xvec
+
Ÿtm
*__dim__,xvec+
j©m
*__dim__);

567 if(
rsq
>=
cut_sq
[
›Ëm
][
j–em
]) ;

568 
r
=
	`sq¹
(
rsq
);

570 
rho_±r
[
j–em
][
›Ëm
]->
	`DF
(
dFi
,
r
);

571 if(
j©m
<
Çtms_lş
)

573 
dFj
=
F_±r
[
j–em
]->
	`dF
(
rho
[
j©m
]);

574 
rho_±r
[
›Ëm
][
j–em
]->
	`DF
(
dFj
,
r
);

578 
	`MPI_AÎ»duû
(
dvs_lş
,
dvs
,
¡©ic_ÿ¡
<>(
nvs
),
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

579 
	`MPI_AÎ»duû
(
__vec_lş
,
__vec
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

580 
size_t
 
i
=0;i<
nvs
;i++)

581 if(!
dofs
[
i
]è
dvs
[i]=0.0;

582 
	}
}

586 
	g‹m¶©e
<
size_t
 
	gNELEMS
>

587 
ty³0
 
	gFÜûF›ldEAMPÙF™
<
	gNELEMS
>::
	$phi_ÿlc
(
–em_ty³
 
›Ëm
,–em_ty³ 
j–em
,
ty³0
 
r
)

589  
phi_±r
[
›Ëm
][
j–em
]->
	`F
(
r
);

590 
	}
}

594 
	g‹m¶©e
<
size_t
 
	gNELEMS
>

595 
ty³0
 
	gFÜûF›ldEAMPÙF™
<
	gNELEMS
>::
	$m—n_rho
(
–em_ty³
 
›Ëm
)

597 
–em_ty³
* 
evec
=
©oms
->
–em
->
	`begš
();

598 
ty³0
* 
rho
=
rho_vec_±r
->
	`begš
();

599 cÚ¡ 
Çtms_lş
=
©oms
->natms_lcl;

600 
ty³0
 
__tmp_lş
[2]={0.0,0.0};

601 
ty³0
 
__tmp
[2]={0.0,0.0};

602 
i
=0;i<
Çtms_lş
;i++)

603 if(
evec
[
i
]==
›Ëm
)

605 
__tmp_lş
[0]+=
rho
[
i
];

606 
__tmp_lş
[1]++;

608 
	`MPI_AÎ»duû
(
__tmp_lş
,
__tmp
,2,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

609 if(
__tmp
[1]==0.0)  0.0;

610  
__tmp
[0]/__tmp[1];

611 
	}
}

615 
	g‹m¶©e
<
size_t
 
	gNELEMS
>

616 
ty³0
 
	gFÜûF›ldEAMPÙF™
<
	gNELEMS
>::
	$rho_ÿlc
(
–em_ty³
 
›Ëm
,–em_ty³ 
j–em
,
ty³0
 
r
)

618  
rho_±r
[
›Ëm
][
j–em
]->
	`F
(
r
);

619 
	}
}

623 
	g‹m¶©e
<
size_t
 
	gNELEMS
>

624 
ty³0
 
	gFÜûF›ldEAMPÙF™
<
	gNELEMS
>::
	$F_ÿlc
(
–em_ty³
 
›Ëm
,
ty³0
 
rho
)

626  
F_±r
[
›Ëm
]->
	`F
(
rho
);

628 
	}
}

632 
	g‹m¶©e
<
size_t
 
	gNELEMS
>

633 
ty³0
 
	gFÜûF›ldEAMPÙF™
<
	gNELEMS
>::
	$åaœ_ÿlc
(
–em_ty³
 
›Ëm
,–em_ty³ 
j–em
,
ty³0
 
rho_i
,ty³0 
rho_j
,ty³0 
r
)

635  -(
phi_±r
[
›Ëm
][
j–em
]->
	`dF
(
r
)+

636 
F_±r
[
›Ëm
]->
	`dF
(
rho_i
)*
rho_±r
[
j–em
][›Ëm]->dF(
r
)+

637 
F_±r
[
j–em
]->
	`dF
(
rho_j
)*
rho_±r
[
›Ëm
][j–em]->dF(
r
))/r;

638 
	}
}

	@ff_fs.cpp

1 
	~"ff_fs.h
"

2 
	~"ÃighbÜ_md.h
"

3 
	~"©oms_md.h
"

4 
	~"–em’ts.h
"

5 
	~"memÜy.h
"

6 
	~"dyÇmic_md.h
"

7 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

20 
	gFÜûF›ldFS
::
	$FÜûF›ldFS
(
AtomsMD
* 
__©oms
,
ty³0
*&& 
__A
,

21 
ty³0
**&& 
__t1
,ty³0**&& 
__t2
,ty³0**&& 
__k1
,ty³0**&& 
__k2
,

22 
ty³0
**&& 
__k3
,ty³0**&& 
r_c_phi
,ty³0**&& 
r_c_rho
):

23 
	`FÜûF›ldMD
(
__©oms
),

24 
	`A
(
__A
),

25 
	`t1
(
__t1
),

26 
	`t2
(
__t2
),

27 
	`k1
(
__k1
),

28 
	`k2
(
__k2
),

29 
	`k3
(
__k3
),

30 
	`cut_sq_phi
(
r_c_phi
),

31 
	$cut_sq_rho
(
r_c_rho
)

33 
__A
=
NULL
;

34 
__t1
=
NULL
;

35 
__t2
=
NULL
;

36 
__k1
=
NULL
;

37 
__k2
=
NULL
;

38 
__k3
=
NULL
;

39 
r_c_phi
=
NULL
;

40 
r_c_rho
=
NULL
;

42 
ty³0
 
tmp
;

43 
size_t
 
i
=0;i<
ÃËms
;i++)

44 
size_t
 
j
=0;j<
i
+1;j++)

46 
cut
[
i
][
j
]=cut[j][i]=
	`MAX
(
cut_sq_phi
[i][j],
cut_sq_rho
[i][j]);

47 
cut_sq
[
i
][
j
]=cut_sq[j][i]=
cut
[i][j]*cut[i][j];

48 
tmp
=
cut_sq_phi
[
i
][
j
];

49 
cut_sq_phi
[
i
][
j
]=cut_sq_phi[j][i]=
tmp
*tmp;

50 
tmp
=
cut_sq_rho
[
i
][
j
];

51 
cut_sq_rho
[
i
][
j
]=cut_sq_rho[j][i]=
tmp
*tmp;

53 
	}
}

57 
	gFÜûF›ldFS
::~
	$FÜûF›ldFS
()

59 
MemÜy
::
	`d—Îoc
(
k3
);

60 
MemÜy
::
	`d—Îoc
(
k2
);

61 
MemÜy
::
	`d—Îoc
(
k1
);

62 
MemÜy
::
	`d—Îoc
(
t2
);

63 
MemÜy
::
	`d—Îoc
(
t1
);

64 
MemÜy
::
	`d—Îoc
(
A
);

65 
MemÜy
::
	`d—Îoc
(
cut_sq_phi
);

66 
MemÜy
::
	`d—Îoc
(
cut_sq_rho
);

67 
	}
}

71 
	gFÜûF›ldFS
::
	$ml_Ãw
(
PyM‘hodDef
& 
_m‘hods
)

73 
_m‘hods
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

74 
_m‘hods
.
ml_Çme
="ff_fs";

76 
_m‘hods
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

77 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

79 
AtomsMD
::
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<AtomsMD::Objeù*>(
£lf
);

82 
FuncAPI
<
ty³0
*,
sq
<ty³0**>,sq<ty³0**>,
symm
<type0**>,symm<type0**>,

83 
symm
<
ty³0
**>,symm<ty³0**>,symm<ty³0**>,
¡d
::
¡ršg
*>

84 
	`f
("ff_fs",{"A","t1","t2","k1","k2","k3","r_c_phi","r_c_rho","elems"});

85 
f
.
nİtiÚ®s
=1;

86 
f
.
logics
<0>()[0]=
	`VLogics
("gt",0.0);

87 
f
.
logics
<6>()[0]=
	`VLogics
("ge",0.0);

88 
f
.
logics
<7>()[0]=
	`VLogics
("ge",0.0);

90 cÚ¡ 
¡d
::
¡ršg
* 
Çmes
=
__£lf
->
©oms
->
–em’ts
.names;

91 cÚ¡ 
size_t
 
ÃËms
=
__£lf
->
©oms
->
–em’ts
.nelems;

92 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

93 if(
f
.
»m­
<8,0,1,2,3,4,5,6,7>("–em’t ´e£Á iÀsy¡em",
Çmes
,
ÃËms
))

94  
NULL
;

97 
d–‘e
 
__£lf
->
ff
;

98 
__£lf
->
ff
=
Ãw
 
	`FÜûF›ldFS
(__£lf->
©oms
,
f
.
mov
<0>(),f.mov<1>(),f.mov<2>(),

99 
f
.
mov
<3>(),f.mov<4>(),f.mov<5>(),f.mov<6>(),f.mov<7>());

100 
Py_RETURN_NONE
;

103 
_m‘hods
.
ml_doc
=(*)
R
"---(

104 
	`ff_fs
(
A
,
t1
,
t2
,
k1
,
k2
,
k3
,
r_c_phi
,
r_c_rho
,
–ems
=
NÚe
)

106 
Fšnis
-
Sšşaœ
 
EAM


108 
Assigns
 
Fšnis
-
Sšşaœ
 
EAM
 
fÜû
 
f›ld
 
to
 
sy¡em
. 
FÜ
 
ex¶ª©iÚ
 
of
 
the
 
·¿m‘”
 
£e
h
NÙes
 
£ùiÚ
.

110 
P¬am‘”s


112 
A
 : [
ÃËms
]

113 :
m©h
:`
A
`

114 
t1
 : [
ÃËms
][nelems]

115 :
m©h
:`
t_1
`

116 
t2
 : [
ÃËms
][nelems]

117 :
m©h
:`
t_2
`

118 
k1
 : 
symm‘ric
 [
ÃËms
][nelems]

119 :
m©h
:`
k_1
`

120 
k2
 : 
symm‘ric
 [
ÃËms
][nelems]

121 :
m©h
:`
k_2
`

122 
k3
 : 
symm‘ric
 [
ÃËms
][nelems]

123 :
m©h
:`
k_3
`

124 
r_c_phi
 : 
symm‘ric
 [
ÃËms
][nelems]

125 :
m©h
:`
r_
{
c
,\
phi
}`

126 
r_c_rho
 : 
symm‘ric
 [
ÃËms
][nelems]

127 :
m©h
:`
r_
{
c
,\
rho
}`

128 
–ems
 : 
¡ršg
[
ÃËms
]

129 
m­pšg
 
–em’ts


131 
R‘uºs


133 
NÚe


135 
NÙes


137 
This
 
is
 
the
 
ª®ytiÿl
 
fÜm
 
of
 
Fšnis
-
Sšşaœ
 
Embedded
 
Atom
 
	`M‘hod
 (
EAM
è
pÙ’tŸl


139 .. 
m©h
::

140 
U
=\
sum_
{
i
}\
	`Ëá
Ğ-
A_
{\
®pha
}\
sq¹
{\sum_{
j
\
Ãq
 i} \
rho_
{\
b‘a
\®pha}(
r_
{
ij
})} + \
äac
{1}{2}\sum_{j\Ãq i} \
phi_
{\b‘a\®pha}Ô_{ij}è\
right
),

142 
wh”e


144 .. 
m©h
::

145 \
rho_
{\
b‘a
\
®pha
}(
r
)=

146 \
Ëá
\{\
begš
{
¬¿y
}{
Î
}

147 
t
^{\
®pha
\
b‘a
}
	`_1
(
r
-r^{\®pha\b‘a}
_
{
c
,\
rho
})^2+t^{\®pha\b‘a}
	`_2
Ô-r^{\®pha\b‘a}_{c,\rho})^3, \
quad
 &„<r^{\alpha\beta}_{c,\rho}\\

148 0 & 
r
>r^{\
®pha
\
b‘a
}
_
{
c
,\
rho
}\

149 \
’d
{
¬¿y
}\
right
.

152 
ªd


154 .. 
m©h
::

155 \
phi_
{\
b‘a
\
®pha
}(
r
)=

156 \
Ëá
\{\
begš
{
¬¿y
}{
Î
}

157 (
r
-r^{\
®pha
\
b‘a
}
_
{
c
,\
phi
})^2(
k
^{\®pha\b‘a}
_1
+k^{\®pha\b‘a}
_2
„+k^{\®pha\b‘a}
_3
„^2), \
quad
 &„<r^{\alpha\beta}_{c,\phi}\\

158 0 & 
r
>r^{\
®pha
\
b‘a
}
_
{
c
,\
phi
}\

159 \
’d
{
¬¿y
}\
right
.

162 
Exam¶es


164 
IrÚ
 
C¬bÚ
 
mixtu»


167 >>> 
äom
 
m­p
 
impÜt
 
md


168 >>> 
sim
=
md
.
	`cfg
("configs/Cementite.cfg")

169 >>> 
sim
.
	`ff_fs
(
A
=[1.8289905,2.9588787],

170 
t1
=[[1.0,10.024001],[10.482408,0.0]],

171 
t2
=[[0.504238,1.638980],[3.782595,-7.329211]],

172 
k1
=[[1.237115],[8.972488,22.061824]],

173 
k2
=[[-0.35921],[-4.086410,-17.468518]],

174 
k3
=[[-0.038560],[1.483233,4.812639]],

175 
r_c_phi
=[[3.40],[2.468801,2.875598]],

176 
r_c_rho
=[[3.569745],[2.545937,2.892070]],

177 
–ems
=['Fe','C'])

184 
FÜûF›ldFS
::
	`__fÜû_ÿlc
()

186 
ty³0
* 
xvec
=
©oms
->
x
->
	`begš
();

187 
ty³0
* 
fvec
=
f
->
	`begš
();

188 
ty³0
* 
rho
=
rho_±r
->
	`begš
();

189 
–em_ty³
* 
evec
=
©oms
->
–em
->
	`begš
();

191 
Ÿtm
,
j©m
;

192 
icomp
,
jcomp
;

193 
–em_ty³
 
›Ëm
,
j–em
;

194 
ty³0
 
dx0
,
dx1
,
dx2
,
rsq
,
’
;

195 
ty³0
 
dr_rho
,
dr_phi
,
r
,
rho_cÛf
,
phi_cÛf
;

197 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->neighbor_list;

198 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->neighbor_list_size;

199 cÚ¡ 
Çtms_lş
=
©oms
->natms_lcl;

200 
i
=0;i<
Çtms_lş
;i++)

201 
rho
[
i
]=0.0;

203 
Ÿtm
=0;Ÿtm<
Çtms_lş
;iatm++)

205 
›Ëm
=
evec
[
Ÿtm
];

206 
icomp
=3*
Ÿtm
;

207 
j
=0;j<
ÃighbÜ_li¡_size
[
Ÿtm
];j++)

209 
j©m
=
ÃighbÜ_li¡
[
Ÿtm
][
j
];

210 
j–em
=
evec
[
j©m
];

212 
jcomp
=3*
j©m
;

213 
dx0
=
xvec
[
icomp
]-xvec[
jcomp
];

214 
dx1
=
xvec
[
icomp
+1]-xvec[
jcomp
+1];

215 
dx2
=
xvec
[
icomp
+2]-xvec[
jcomp
+2];

216 
rsq
=
dx0
*dx0+
dx1
*dx1+
dx2
*dx2;

218 if(
rsq
<
cut_sq_rho
[
›Ëm
][
j–em
])

220 
r
=
	`sq¹
(
rsq
);

221 
dr_rho
=
r
-
	`sq¹
(
cut_sq_rho
[
›Ëm
][
j–em
]);

222 
rho
[
Ÿtm
]+=
dr_rho
*dr_rho*(
t1
[
j–em
][
›Ëm
]

223 +
t2
[
j–em
][
›Ëm
]*
dr_rho
);

225 if(
j©m
<
Çtms_lş
)

226 
rho
[
j©m
]+=
dr_rho
*dr_rho*(
t1
[
›Ëm
][
j–em
]

227 +
t2
[
›Ëm
][
j–em
]*
dr_rho
);

233 
	`upd©e
(
rho_±r
);

235 
Ÿtm
=0;Ÿtm<
Çtms_lş
;iatm++)

237 
›Ëm
=
evec
[
Ÿtm
];

238 
icomp
=3*
Ÿtm
;

240 if(
rho
[
Ÿtm
]>0.0)

241 
__vec_lş
[0]+=-
A
[
›Ëm
]*
	`sq¹
(
rho
[
Ÿtm
]);

243 
j
=0;j<
ÃighbÜ_li¡_size
[
Ÿtm
];j++)

245 
j©m
=
ÃighbÜ_li¡
[
Ÿtm
][
j
];

246 
j–em
=
evec
[
j©m
];

248 
jcomp
=3*
j©m
;

249 
dx0
=
xvec
[
icomp
]-xvec[
jcomp
];

250 
dx1
=
xvec
[
icomp
+1]-xvec[
jcomp
+1];

251 
dx2
=
xvec
[
icomp
+2]-xvec[
jcomp
+2];

252 
rsq
=
dx0
*dx0+
dx1
*dx1+
dx2
*dx2;

254 if(
rsq
<
cut_sq
[
›Ëm
][
j–em
])

256 
r
=
	`sq¹
(
rsq
);

258 if(
rsq
<
cut_sq_rho
[
›Ëm
][
j–em
])

260 
dr_rho
=
r
-
	`sq¹
(
cut_sq_rho
[
›Ëm
][
j–em
]);

262 
rho_cÛf
=0.0;

264 if(
rho
[
Ÿtm
]>0.0)

265 
rho_cÛf
+=
A
[
›Ëm
]*(
dr_rho
*(1.0*
t1
[
j–em
][ielem]

266 +1.5*
t2
[
j–em
][
›Ëm
]*
dr_rho
))/
	`sq¹
(
rho
[
Ÿtm
]);

268 if(
rho
[
j©m
]>0.0)

269 
rho_cÛf
+=
A
[
j–em
]*(
dr_rho
*(1.0*
t1
[
›Ëm
][jelem]

270 +1.5*
t2
[
›Ëm
][
j–em
]*
dr_rho
))/
	`sq¹
(
rho
[
j©m
]);

272 
rho_cÛf
*=1.0/
r
;

274 
fvec
[
icomp
]+=
dx0
*
rho_cÛf
;

275 
fvec
[
icomp
+1]+=
dx1
*
rho_cÛf
;

276 
fvec
[
icomp
+2]+=
dx2
*
rho_cÛf
;

278 if(
j©m
<
Çtms_lş
)

280 
fvec
[
jcomp
]-=
dx0
*
rho_cÛf
;

281 
fvec
[
jcomp
+1]-=
dx1
*
rho_cÛf
;

282 
fvec
[
jcomp
+2]-=
dx2
*
rho_cÛf
;

285 if(
j©m
>=
Çtms_lş
)

286 
rho_cÛf
*=0.5;

288 
__vec_lş
[1]-=
rho_cÛf
*
dx0
*dx0;

289 
__vec_lş
[2]-=
rho_cÛf
*
dx0
*
dx1
;

290 
__vec_lş
[3]-=
rho_cÛf
*
dx0
*
dx2
;

291 
__vec_lş
[4]-=
rho_cÛf
*
dx1
*dx1;

292 
__vec_lş
[5]-=
rho_cÛf
*
dx1
*
dx2
;

293 
__vec_lş
[6]-=
rho_cÛf
*
dx2
*dx2;

296 if(
rsq
<
cut_sq_phi
[
›Ëm
][
j–em
])

298 
dr_phi
=
r
-
	`sq¹
(
cut_sq_phi
[
›Ëm
][
j–em
]);

299 
phi_cÛf
=2.0*
dr_phi
*(
k1
[
›Ëm
][
j–em
]+
k2
[›Ëm][j–em]*
r
+
k3
[›Ëm][j–em]*
rsq
)

300 +
dr_phi
*dr_phi*(
k2
[
›Ëm
][
j–em
]+2.0*
k3
[›Ëm][j–em]*
r
);

301 
phi_cÛf
*=-1.0/
r
;

302 
’
=
dr_phi
*dr_phi*(
k1
[
›Ëm
][
j–em
]+
k2
[›Ëm][j–em]*
r
+
k3
[›Ëm][j–em]*
rsq
);

304 
fvec
[
icomp
]+=
dx0
*
phi_cÛf
;

305 
fvec
[
icomp
+1]+=
dx1
*
phi_cÛf
;

306 
fvec
[
icomp
+2]+=
dx2
*
phi_cÛf
;

308 if(
j©m
<
Çtms_lş
)

310 
fvec
[
jcomp
]-=
dx0
*
phi_cÛf
;

311 
fvec
[
jcomp
+1]-=
dx1
*
phi_cÛf
;

312 
fvec
[
jcomp
+2]-=
dx2
*
phi_cÛf
;

315 if(
j©m
>=
Çtms_lş
)

317 
phi_cÛf
*=0.5;

318 
’
*=0.5;

321 
__vec_lş
[0]+=
’
;

322 
__vec_lş
[1]-=
phi_cÛf
*
dx0
*dx0;

323 
__vec_lş
[2]-=
phi_cÛf
*
dx0
*
dx1
;

324 
__vec_lş
[3]-=
phi_cÛf
*
dx0
*
dx2
;

325 
__vec_lş
[4]-=
phi_cÛf
*
dx1
*dx1;

326 
__vec_lş
[5]-=
phi_cÛf
*
dx1
*
dx2
;

327 
__vec_lş
[6]-=
phi_cÛf
*
dx2
*dx2;

338 
FÜûF›ldFS
::
	`__’”gy_ÿlc
()

340 
ty³0
* 
xvec
=
©oms
->
x
->
	`begš
();

341 
ty³0
* 
rho
=
rho_±r
->
	`begš
();

342 
–em_ty³
* 
evec
=
©oms
->
–em
->
	`begš
();

344 
Ÿtm
,
j©m
;

345 
icomp
,
jcomp
;

346 
–em_ty³
 
›Ëm
,
j–em
;

347 
ty³0
 
dx0
,
dx1
,
dx2
,
rsq
;

348 
ty³0
 
dr_rho
,
dr_phi
,
r
;

350 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->neighbor_list;

351 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->neighbor_list_size;

352 cÚ¡ 
Çtms_lş
=
©oms
->natms_lcl;

353 
i
=0;i<
Çtms_lş
;i++)

354 
rho
[
i
]=0.0;

356 
Ÿtm
=0;Ÿtm<
Çtms_lş
;iatm++)

358 
›Ëm
=
evec
[
Ÿtm
];

359 
icomp
=
__dim__
*
Ÿtm
;

360 
j
=0;j<
ÃighbÜ_li¡_size
[
Ÿtm
];j++)

362 
j©m
=
ÃighbÜ_li¡
[
Ÿtm
][
j
];

363 
j–em
=
evec
[
j©m
];

365 
jcomp
=3*
j©m
;

366 
dx0
=
xvec
[
icomp
]-xvec[
jcomp
];

367 
dx1
=
xvec
[
icomp
+1]-xvec[
jcomp
+1];

368 
dx2
=
xvec
[
icomp
+2]-xvec[
jcomp
+2];

369 
rsq
=
dx0
*dx0+
dx1
*dx1+
dx2
*dx2;

372 if(
rsq
<
cut_sq
[
›Ëm
][
j–em
])

374 
r
=
	`sq¹
(
rsq
);

375 if(
rsq
<
cut_sq_rho
[
›Ëm
][
j–em
])

377 
dr_rho
=
r
-
	`sq¹
(
cut_sq_rho
[
›Ëm
][
j–em
]);

378 
rho
[
Ÿtm
]+=
dr_rho
*dr_rho*(
t1
[
j–em
][
›Ëm
]

379 +
t2
[
j–em
][
›Ëm
]*
dr_rho
);

381 if(
j©m
<
Çtms_lş
)

382 
rho
[
j©m
]+=
dr_rho
*dr_rho*(
t1
[
›Ëm
][
j–em
]

383 +
t2
[
›Ëm
][
j–em
]*
dr_rho
);

386 if(
rsq
<
cut_sq_phi
[
›Ëm
][
j–em
])

388 
dr_phi
=
r
-
	`sq¹
(
cut_sq_phi
[
›Ëm
][
j–em
]);

389 if(
j©m
<
Çtms_lş
)

390 
__vec_lş
[0]+=
dr_phi
*dr_phi*(
k1
[
›Ëm
][
j–em
]+
k2
[›Ëm][j–em]*
r
+
k3
[›Ëm][j–em]*
rsq
);

392 
__vec_lş
[0]+=0.5*
dr_phi
*dr_phi*(
k1
[
›Ëm
][
j–em
]+
k2
[›Ëm][j–em]*
r
+
k3
[›Ëm][j–em]*
rsq
);

397 if(
rho
[
Ÿtm
]>0.0)

398 
__vec_lş
[0]+=-
A
[
›Ëm
]*
	`sq¹
(
rho
[
Ÿtm
]);

404 
FÜûF›ldFS
::
	`š™
()

406 
	`´e_š™
();

407 
rho_±r
=
Ãw
 
Vec
<
ty³0
>(
©oms
,1);

412 
FÜûF›ldFS
::
	`fš
()

414 
d–‘e
 
rho_±r
;

415 
	`po¡_fš
();

420 
FÜûF›ldFS
::
	`š™_xchng
()

426 
FÜûF›ldFS
::
	`fš_xchng
()

432 
FÜûF›ldFS
::
	`´e_xchng_’”gy
(
GCMC
*)

438 
ty³0
 
FÜûF›ldFS
::
	`xchng_’”gy
(
GCMC
*)

445 
FÜûF›ldFS
::
	`po¡_xchng_’”gy
(
GCMC
*)

	@ff_fs.h

1 #iâdeà
__MAPP__ff_fs__


2 
	#__MAPP__ff_fs__


	)

3 
	~"ff_md.h
"

4 
Çme¥aû
 
	gMAPP_NS


6 şas 
	cFÜûF›ldFS
: 
public
 
FÜûF›ldMD


8 
´iv©e
:

9 
ty³0
** 
t1
;

10 
ty³0
** 
	gt2
;

11 
ty³0
** 
	gcut_sq_phi
;

12 
ty³0
** 
	gcut_sq_rho
;

13 
ty³0
** 
	gk1
;

14 
ty³0
** 
	gk2
;

15 
ty³0
** 
	gk3
;

16 
ty³0
* 
	gA
;

18 
	gVec
<
	gty³0
>* 
	grho_±r
;

19 
	g´Ùeùed
:

20 
__fÜû_ÿlc
();

21 
__’”gy_ÿlc
();

22 
´e_xchng_’”gy
(
GCMC
*);

23 
ty³0
 
xchng_’”gy
(
GCMC
*);

24 
po¡_xchng_’”gy
(
GCMC
*);

25 
	gpublic
:

26 
FÜûF›ldFS
(
şass
 
AtomsMD
*,
ty³0
*&&,

27 
ty³0
**&&,type0**&&,type0**&&,type0**&&,

28 
ty³0
**&&,type0**&&,type0**&&);

29 ~
FÜûF›ldFS
();

31 
ml_Ãw
(
PyM‘hodDef
&);

32 
š™
();

33 
fš
();

34 
š™_xchng
();

35 
fš_xchng
();

	@ff_lj.cpp

5 
	~"ff_lj.h
"

6 
	~"ÃighbÜ_md.h
"

7 
	~"©oms_md.h
"

8 
	~"–em’ts.h
"

9 
	~"memÜy.h
"

10 
	~"pgcmc_2.h
"

11 
	~"­i.h
"

12 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

16 
	gFÜûF›ldLJ
::

17 
	$FÜûF›ldLJ
(
AtomsMD
* 
©oms
,
ty³0
**&& 
__•sÚ
,

18 
ty³0
**&& 
__sigma
,ty³0**&& 
__cut
,
boŞ
 
__shiá
):

19 
	`FÜûF›ldMD
(
©oms
),

20 
	`•sÚ
(
__•sÚ
),

21 
	`sigma
(
__sigma
),

22 
	`shiá
(
__shiá
),

23 
	$off£t
(
NULL
)

25 
gcmc_n_cutoff
=1;

26 
gcmc_n_v¬s
=1;

27 
gcmc_g_’abËd
=
çl£
;

29 
__•sÚ
=
NULL
;

30 
__sigma
=
NULL
;

32 
size_t
 
i
=0;i<
ÃËms
;i++)

33 
size_t
 
j
=0;j<
i
+1;j++)

35 
cut
[
i
][
j
]=cut[j][i]=
__cut
[i][j];

36 
cut_sq
[
i
][
j
]=cut_sq[j][i]=
__cut
[i][j]*__cut[i][j];

38 
MemÜy
::
	`d—Îoc
(
__cut
);

40 
MemÜy
::
	`®loc
(
off£t
,
ÃËms
,nelems);

41 
size_t
 
›Ëm
=0;›Ëm<
ÃËms
;ielem++)

42 
size_t
 
j–em
=0;j–em<
ÃËms
;jelem++)

43 
off£t
[
›Ëm
][
j–em
]=0.0;

44 if(
shiá
)

46 
ty³0
 
sig2
,
sig6
,
sig12
;

47 
size_t
 
i
=0;i<
ÃËms
;i++)

48 
size_t
 
j
=0;j<
i
+1;j++)

50 
sig2
=
sigma
[
i
][
j
]*sigma[i][j]/
cut_sq
[i][j];

51 
sig6
=
sig2
*sig2*sig2;

52 
sig12
=
sig6
*sig6;

53 
off£t
[
i
][
j
]=-4.0*
•sÚ
[i][j]*(
sig12
-
sig6
);

54 
off£t
[
j
][
i
]=offset[i][j];

58 
	}
}

62 
	gFÜûF›ldLJ
::~
	$FÜûF›ldLJ
()

64 
MemÜy
::
	`d—Îoc
(
sigma
);

65 
MemÜy
::
	`d—Îoc
(
•sÚ
);

66 
MemÜy
::
	`d—Îoc
(
off£t
);

67 
	}
}

71 
	gFÜûF›ldLJ
::
	$š™
()

73 
	`´e_š™
();

74 
	}
}

78 
	gFÜûF›ldLJ
::
	$fš
()

80 
	`po¡_fš
();

81 
	}
}

85 
	gFÜûF›ldLJ
::
	$š™_xchng
()

88 
	}
}

92 
FÜûF›ldLJ
::
	$fš_xchng
()

95 
	}
}

99 
FÜûF›ldLJ
::
	$´e_xchng_’”gy
(
GCMC
* 
gcmc
)

102 & 
icomm
=
gcmc
->icomm;

103 
ty³0
 
’
;

105 & 
Ÿtm
=
gcmc
->iatm;

106 
–em_ty³
& 
›Ëm
=
gcmc
->ielem;

108 & 
j©m
=
gcmc
->jatm;

109 
–em_ty³
& 
j–em
=
gcmc
->jelem;

111 
ty³0
&
rsq
=
gcmc
->rsq;

113 
ty³0
 
sig2
,
sig6
;

115 cÚ¡ 
Çtms_lş
=
©oms
->natms_lcl;

117 
gcmc
->
	`»£t_icomm
();
icomm
!=-1;gcmc->
	`Ãxt_icomm
())

119 
’
=0.0;

120 
gcmc
->
	`»£t_Ÿtm
();
Ÿtm
!=-1;gcmc->
	`Ãxt_Ÿtm
())

121 
gcmc
->
	`»£t_j©m
();
j©m
!=-1;gcmc->
	`Ãxt_j©m
())

123 
sig2
=
sigma
[
›Ëm
][
j–em
]*sigma[›Ëm][j–em]/
rsq
;

124 
sig6
=
sig2
*sig2*sig2;

126 if(
j©m
<
Çtms_lş
)

127 
’
+=4.0*
•sÚ
[
›Ëm
][
j–em
]*
sig6
*(sig6-1.0)+
off£t
[ielem][jelem];

129 
’
+=2.0*
•sÚ
[
›Ëm
][
j–em
]*
sig6
*(sig6-1.0)+
off£t
[ielem][jelem];

132 
gcmc
->
lş_v¬s
[0]=
’
;

135 
	}
}

139 
ty³0
 
	gFÜûF›ldLJ
::
	$xchng_’”gy
(
GCMC
* 
gcmc
)

141 & 
icomm
=
gcmc
->icomm;

142 
gcmc
->
	`»£t_icomm
();
icomm
!=-1;gcmc->
	`Ãxt_icomm
())

143 
	`MPI_Reduû
(
gcmc
->
lş_v¬s
,gcmc->
v¬s
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,gcmc->
cu¼_roÙ
,*gcmc->
cu¼_comm
);

144 if(
gcmc
->
im_roÙ
)

145  
gcmc
->
v¬s
[0];

148 
	}
}

152 
	gFÜûF›ldLJ
::
	$po¡_xchng_’”gy
(
GCMC
*)

154 
	}
}

158 
	~"xm©h.h
"

159 
FÜûF›ldLJ
::
	$__fÜû_ÿlc
()

161 cÚ¡ 
ty³0
* 
x
=
©oms
->x->
	`begš
();

162 
ty³0
* 
fvec
=
f
->
	`begš
();

163 
–em_ty³
* 
evec
=
©oms
->
–em
->
	`begš
();

165 
–em_ty³
 
›Ëm
,
j–em
;

166 
ty³0
 
rsq
;

170 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->neighbor_list;

171 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->neighbor_list_size;

173 
ty³0
 
x_i
[
__dim__
];

174 
ty³0
 
dx_ij
[
__dim__
];

175 cÚ¡ 
Çtms_lş
=
©oms
->natms_lcl;

176 
Ÿtm
=0;Ÿtm<
Çtms_lş
;iatm++)

178 
›Ëm
=
evec
[
Ÿtm
];

179 
Algeb¿
::
V_eq
<
__dim__
>(
x
+
Ÿtm
*__dim__,
x_i
);

180 
ty³0
 
f_i
[
__dim__
]{
	`DESIG
(__dim__,0.0)};

181 cÚ¡ 
li¡_size
=
ÃighbÜ_li¡_size
[
Ÿtm
];

182 
j
=0,
j©m
;j<
li¡_size
;j++)

184 
j©m
=
ÃighbÜ_li¡
[
Ÿtm
][
j
];

185 
j–em
=
evec
[
j©m
];

186 
rsq
=
Algeb¿
::
	`DX_RSQ
(
x_i
,
x
+
j©m
*
__dim__
,
dx_ij
);

187 if(
rsq
>=
cut_sq
[
›Ëm
][
j–em
]) ;

189 
ty³0
 
sig2
=
sigma
[
›Ëm
][
j–em
]*sigma[›Ëm][j–em]/
rsq
;

190 
ty³0
 
sig6
=
sig2
*sig2*sig2;

192 
ty³0
 
•s
=
•sÚ
[
›Ëm
][
j–em
];

193 
ty³0
 
åaœ
=24.0*
•s
*
sig6
*(2.0*sig6-1.0)/
rsq
;

194 
ty³0
 
’
=4.0*
•s
*
sig6
*(sig6-1.0)+
off£t
[
›Ëm
][
j–em
];

196 
Algeb¿
::
V_add_x_mul_V
<
__dim__
>(
åaœ
,
dx_ij
,
f_i
);

198 if(
j©m
<
Çtms_lş
)

199 
Algeb¿
::
V_add_x_mul_V
<
__dim__
>(-
åaœ
,
dx_ij
,
fvec
+__dim__*
j©m
);

202 
åaœ
*=0.5;

203 
’
*=0.5;

205 
__vec_lş
[0]+=
’
;

206 
Algeb¿
::
DyadicV
<
__dim__
>(-
åaœ
,
dx_ij
,&
__vec_lş
[1]);

209 
Algeb¿
::
V_add
<
__dim__
>(
f_i
,
fvec
+
Ÿtm
*__dim__);

211 
	}
}

217 
	gFÜûF›ldLJ
::
	$__’”gy_ÿlc
()

219 cÚ¡ 
ty³0
* 
x
=
©oms
->x->
	`begš
();

220 
–em_ty³
* 
evec
=
©oms
->
–em
->
	`begš
();

222 
–em_ty³
 
›Ëm
,
j–em
;

224 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->neighbor_list;

225 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->neighbor_list_size;

227 
ty³0
 
xi
[
__dim__
];

228 cÚ¡ 
Çtms_lş
=
©oms
->natms_lcl;

229 
Ÿtm
=0;Ÿtm<
Çtms_lş
;iatm++)

231 
›Ëm
=
evec
[
Ÿtm
];

232 
Algeb¿
::
V_eq
<
__dim__
>(
x
+
Ÿtm
*__dim__,
xi
);

233 cÚ¡ 
li¡_size
=
ÃighbÜ_li¡_size
[
Ÿtm
];

234 
j
=0,
j©m
;j<
li¡_size
;j++)

236 
j©m
=
ÃighbÜ_li¡
[
Ÿtm
][
j
];

237 
j–em
=
evec
[
j©m
];

238 
ty³0
 
rsq
=
Algeb¿
::
RSQ
<
__dim__
>(
xi
,
x
+
j©m
*__dim__);

240 if(
rsq
>=
cut_sq
[
›Ëm
][
j–em
]) ;

241 
ty³0
 
sig2
=
sigma
[
›Ëm
][
j–em
]*sigma[›Ëm][j–em]/
rsq
;

242 
ty³0
 
sig6
=
sig2
*sig2*sig2;

244 if(
j©m
<
Çtms_lş
)

245 
__vec_lş
[0]+=4.0*
•sÚ
[
›Ëm
][
j–em
]*
sig6
*(sig6-1.0)+
off£t
[ielem][jelem];

247 
__vec_lş
[0]+=2.0*
•sÚ
[
›Ëm
][
j–em
]*
sig6
*(sig6-1.0)+0.5*
off£t
[ielem][jelem];

251 
	}
}

255 
	gFÜûF›ldLJ
::
	$ml_Ãw
(
PyM‘hodDef
& 
_m‘hods
)

257 
_m‘hods
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

258 
_m‘hods
.
ml_Çme
="ff_lj";

259 
_m‘hods
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

260 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

262 
AtomsMD
::
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<AtomsMD::Objeù*>(
£lf
);

264 
FuncAPI
<
symm
<
ty³0
**>,symm<ty³0**>,symm<ty³0**>,
boŞ
,
¡d
::
¡ršg
*> 
	`f
("ff_lj",{"eps","sigma","r_c","shift","elems"});

265 
f
.
nİtiÚ®s
=2;

266 
f
.
logics
<0>()[0]=
	`VLogics
("ge",0.0);

267 
f
.
logics
<1>()[0]=
	`VLogics
("gt",0.0);

268 
f
.
logics
<2>()[0]=
	`VLogics
("ge",0.0);

269 
f
.
v®
<3>()=
çl£
;

271 cÚ¡ 
¡d
::
¡ršg
* 
Çmes
=
__£lf
->
©oms
->
–em’ts
.names;

272 cÚ¡ 
size_t
 
ÃËms
=
__£lf
->
©oms
->
–em’ts
.nelems;

273 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

274 if(
f
.
»m­
<4,0,1,2>("–em’t ´e£Á iÀsy¡em",
Çmes
,
ÃËms
))

275  
NULL
;

277 
d–‘e
 
__£lf
->
ff
;

278 
__£lf
->
ff
=
Ãw
 
	`FÜûF›ldLJ
(__£lf->
©oms
,
f
.
mov
<0>(),f.mov<1>(),f.mov<2>(),f.
v®
<3>());

279 
Py_RETURN_NONE
;

282 
_m‘hods
.
ml_doc
=
R
"---(

283 
	`ff_lj
(
•s
,
sigma
,
r_c
,
shiá
=
F®£
,
–ems
=
NÚe
)

285 
L’Çrd
-
JÚes
 
pÙ’tŸl


288 
£e
 
NÙes
 
£ùiÚ
 
b–ow


290 
P¬am‘”s


292 
•s
 : 
symm‘ric
 [
ÃËms
][nelems]

293 :
m©h
:`\
•sÚ
`

294 
sigma
 : 
symm‘ric
 [
ÃËms
][nelems]

295 :
m©h
:`\
sigma
`

296 
r_c
 : 
symm‘ric
 [
ÃËms
][nelems]

297 :
m©h
:`
r_c
`

298 
shiá
 : 
boŞ


299 
shiá
 
the
 

 
£t
 
to
 
True


300 
–ems
 : 
¡ršg
[
ÃËms
]

301 
m­pšg
 
–em’ts


303 
R‘uºs


305 
NÚe


307 
NÙes


309 
This
 
is
 
the
 
çmous
 
L’Çrd
 
JÚes
 
pÙ’tŸl


311 .. 
m©h
::

312 
U
=\
äac
{1}{2}\
sum_
{
i
}\sum_{
j
\
Ãq
 i}

313 \
Ëá
\{\
begš
{
¬¿y
}{
Î
}

314 4\
•sÚ_
{\
®pha
\
b‘a
}\
biggl
[\
	`Ëá
Ğ\
äac
{\
sigma_
{\®pha\b‘a}}{
r_
{
ij
}}\
right
)^{12}-\ËáĞ\äac{\sigma_{\®pha\b‘a}}{r_{ij}}\right)^6\
biggr
] &r_{ij}<
r
^{\®pha\b‘a}
_c
\\

315 0 &
r_
{
ij
}>
r
^{\
®pha
\
b‘a
}
_c


316 \
’d
{
¬¿y
}\
right
.

318 
Exam¶es


320 
Kob
-
And”sÚ
 
pÙ’tŸl


323 >>> 
äom
 
m­p
 
impÜt
 
md


324 >>> 
sim
=
md
.
	`cfg
("configs/KA.cfg")

325 >>> 
sim
.
	`ff_lj
(
sigma
=[[1.0],[0.8,0.88]],

326 
•s
=[[1.0],[1.5,0.5]],

327 
r_c
=[[2.5],[2.0,2.2]],

328 
shiá
=
F®£
,

329 
–ems
=['Ni','P'])

	@ff_lj.h

1 #iâdeà
__MAPP__ff_lj__


2 
	#__MAPP__ff_lj__


	)

3 
	~"ff_md.h
"

4 
	g_objeù
;

5 
_objeù
 
	tPyObjeù
;

6 
Çme¥aû
 
	gMAPP_NS


8 şas 
	cFÜûF›ldLJ
: 
public
 
FÜûF›ldMD


10 
´iv©e
:

11 cÚ¡ 
boŞ
 
shiá
;

12 
ty³0
** 
	gsigma
;

13 
ty³0
** 
	g•sÚ
;

14 
ty³0
** 
	goff£t
;

16 
	g´Ùeùed
:

17 
__fÜû_ÿlc
();

18 
__’”gy_ÿlc
();

19 
´e_xchng_’”gy
(
GCMC
*);

20 
ty³0
 
xchng_’”gy
(
GCMC
*);

21 
po¡_xchng_’”gy
(
GCMC
*);

22 
	gpublic
:

23 
FÜûF›ldLJ
(
şass
 
AtomsMD
*,
ty³0
**&&,ty³0**&&,ty³0**&&,
boŞ
);

24 ~
FÜûF›ldLJ
();

26 
ml_Ãw
(
PyM‘hodDef
&);

28 
š™
();

29 
fš
();

30 
š™_xchng
();

31 
fš_xchng
();

	@ff_md.cpp

1 
	~"ff_md.h
"

2 
	~"tim”.h
"

3 
	~"ÃighbÜ_md.h
"

4 
	~"©oms_md.h
"

5 
	~"xm©h.h
"

6 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

10 
	gFÜûF›ldMD
::
	$FÜûF›ldMD
(
AtomsMD
* 
__©oms
):

11 
	`FÜûF›ld
(
__©oms
),

12 
	$©oms
(
__©oms
)

14 
ÃighbÜ
=
Ãw
 
	`NeighbÜMD
(
__©oms
,
cut_sk_sq
);

15 
f
=
Ãw
 
Vec
<
ty³0
>(
©oms
,
__dim__
,"f");

16 
	}
}

20 
	gFÜûF›ldMD
::~
	$FÜûF›ldMD
()

22 
d–‘e
 
f
;

23 
d–‘e
 
ÃighbÜ
;

24 
	}
}

28 
	gFÜûF›ldMD
::
	$ÿlc_ndof
()

30 
nx_dof
=
©oms
->
Çtms
*
__dim__
;

31 if(!
©oms
->
x_dof
->
	`is_em±y
())

33 cÚ¡ 
n
=
©oms
->
Çtms_lş
*
__dim__
;

34 
nx_dof_lş
=
n
;

35 
boŞ
* 
x_dof
=
©oms
->x_dof->
	`begš
();

36 
i
=0;i<
n
;i++èif(!
x_dof
[i]è
nx_dof_lş
--;

37 
	`MPI_AÎ»duû
(&
nx_dof_lş
,&
nx_dof
,1,
Vec
<>::
MPI_T
,
MPI_SUM
,
wÜld
);

39 
	}
}

43 
	gFÜûF›ldMD
::
	$»£t
()

45 
ty³0
* 
__f
=
f
->
	`begš
();

46 cÚ¡ 
n
=
f
->
vec_sz
*
__dim__
;

47 
i
=0;i<
n
;i++è
__f
[i]=0.0;

48 
i
=0;i<
__nvoigt__
+1;i++è
__vec_lş
[i]=0.0;

49 
	}
}

53 
	gFÜûF›ldMD
::
	$´e_š™
()

55 
dof_em±y
=
©oms
->
x_dof
->
	`is_em±y
();

56 
ty³0
 
tmp
;

57 
max_cut
=0.0;

58 
size_t
 
i
=0;i<
ÃËms
;i++)

59 
size_t
 
j
=0;j<
i
+1;j++)

61 
tmp
=
cut
[
i
][
j
];

62 
max_cut
=
	`MAX
(max_cut,
tmp
);

63 
cut_sq
[
i
][
j
]=cut_sq[j][i]=
tmp
*tmp;

64 
tmp
+=
©oms
->
comm
.
skš
;

65 
cut_sk_sq
[
i
][
j
]=cut_sk_sq[j][i]=
tmp
*tmp;

67 
	}
}

71 
	gFÜûF›ldMD
::
	$po¡_fš
()

73 
	}
}

77 
FÜûF›ldMD
::
	$´e_xchng_’”gy_tim”
(
GCMC
* 
gcmc
)

79 
	`´e_xchng_’”gy
(
gcmc
);

80 
	}
}

84 
ty³0
 
	gFÜûF›ldMD
::
	$xchng_’”gy_tim”
(
GCMC
* 
gcmc
)

86  
	`xchng_’”gy
(
gcmc
);

87 
	}
}

91 
	gFÜûF›ldMD
::
	$po¡_xchng_’”gy_tim”
(
GCMC
* 
gcmc
)

93 
	`po¡_xchng_’”gy
(
gcmc
);

94 
	}
}

98 
	gFÜûF›ldMD
::
	$fÜû_ÿlc
()

100 
	`»£t
();

101 
	`__fÜû_ÿlc
();

102 
	`MPI_AÎ»duû
(
__vec_lş
,
__vec
,
__nvoigt__
+1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

103 
Algeb¿
::
Do
<
__nvoigt__
>::
	`func
([
this
](
i
){
__vec
[i+1]*=-1.0;});

104 
Algeb¿
::
	`DyadicV_2_MSY
(
__vec
+1,
F_H
);

105 
©oms
->
³
=
__vec
[0];

106 
ty³0
 
vŞ_Ãg
=-
©oms
->
vŞ
;

107 
Algeb¿
::
Do
<
__nvoigt__
>::
	`func
([
this
,&
vŞ_Ãg
](
i
){
__vec
[i+1]/=vol_neg;});

108 
Algeb¿
::
	`DyadicV_2_MSY
(
__vec
+1,
©oms
->
S_³
);

110 if(!
dof_em±y
)

112 
ty³0
* 
fvec
=
f
->
	`begš
();

113 
boŞ
* 
dof
=
©oms
->
x_dof
->
	`begš
();

114 cÚ¡ 
n
=
©oms
->
Çtms_lş
*
__dim__
;

115 
i
=0;i<
n
;i++è
fvec
[i]=
dof
[i] ? fvec[i]:0.0;

117 
	}
}

121 
ty³0
 
	gFÜûF›ldMD
::
	$v®ue
()

123 
__vec_lş
[0]=0.0;

124 
	`__’”gy_ÿlc
();

125 
ty³0
 
’
;

126 
	`MPI_AÎ»duû
(&
__vec_lş
[0],&
’
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

127  
’
;

128 
	}
}

132 
ty³0
* 
	gFÜûF›ldMD
::
	$d”iv©ive
()

134 
	`»£t
();

135 
	`__fÜû_ÿlc
();

136 
	`MPI_AÎ»duû
(
__vec_lş
,
__vec
,
__nvoigt__
+1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

137 
Algeb¿
::
Do
<
__nvoigt__
>::
	`func
([
this
](
i
){
__vec
[i+1]*=-1.0;});

138 
Algeb¿
::
	`DyadicV_2_MSY
(
__vec
+1,
F_H
);

139 
©oms
->
³
=
__vec
[0];

140 
ty³0
 
vŞ_Ãg
=-
©oms
->
vŞ
;

141 
Algeb¿
::
Do
<
__nvoigt__
>::
	`func
([
this
,&
vŞ_Ãg
](
i
){
__vec
[i+1]/=vol_neg;});

142 
Algeb¿
::
	`DyadicV_2_MSY
(
__vec
+1,
©oms
->
S_³
);

144 if(!
dof_em±y
)

146 
ty³0
* 
fvec
=
f
->
	`begš
();

147 
boŞ
* 
dof
=
©oms
->
x_dof
->
	`begš
();

148 cÚ¡ 
n
=
©oms
->
Çtms_lş
*
__dim__
;

149 
i
=0;i<
n
;i++è
fvec
[i]=
dof
[i] ? fvec[i]:0.0;

151  
__vec
;

152 
	}
}

	@ff_md.h

1 #iâdeà
__MAPP__ff_md__


2 
	#__MAPP__ff_md__


	)

3 
	~"ff.h
"

4 
Çme¥aû
 
	gMAPP_NS


6 şas 
	cFÜûF›ldMD
 : 
public
 
FÜûF›ld


8 
ä›nd
 
şass
 
DyÇmicMD
;

9 
	g´iv©e
:

10 
»£t
();

11 
	g´Ùeùed
:

12 
şass
 
AtomsMD
* 
©oms
;

16 
vœtu®
 
´e_xchng_’”gy
(
şass
 
GCMC
*)=0;

17 
vœtu®
 
ty³0
 
xchng_’”gy
(
şass
 
GCMC
*)=0;

18 
vœtu®
 
po¡_xchng_’”gy
(
şass
 
GCMC
*)=0;

20 
´e_š™
();

21 
po¡_fš
();

23 
	gpublic
:

24 
gcmc_n_v¬s
;

25 
	ggcmc_n_cutoff
;

26 
boŞ
 
	ggcmc_g_’abËd
;

28 
boŞ
 
	gdof_em±y
;

29 
ty³0
 
	gmax_cut
;

30 
şass
 
NeighbÜMD
* 
	gÃighbÜ
;

31 
	gVec
<
	gty³0
>* 
	gf
;

32 
ty³0
 
	gF_H
[
__dim__
][__dim__];

34 
FÜûF›ldMD
(
şass
 
AtomsMD
*);

35 
	gvœtu®
 ~
FÜûF›ldMD
();

38 
fÜû_ÿlc
();

40 
ty³0
 
v®ue
();

41 
ty³0
* 
d”iv©ive
();

46 
vœtu®
 
š™_xchng
()=0;

47 
vœtu®
 
fš_xchng
()=0;

48 
´e_xchng_’”gy_tim”
(
şass
 
GCMC
*);

49 
ty³0
 
xchng_’”gy_tim”
(
şass
 
GCMC
*);

50 
po¡_xchng_’”gy_tim”
(
şass
 
GCMC
*);

52 
ÿlc_ndof
();

53 
	gnx_dof
;

	@ff_meam.cpp

5 
	~"ff_m—m.h
"

6 
	~"ÃighbÜ_md.h
"

7 
	~"©oms_md.h
"

8 
	~"–em’ts.h
"

9 
	~"memÜy.h
"

10 
	~"pgcmc_2.h
"

11 
	~"­i.h
"

12 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

16 
	gFÜûF›ldMEAM
::

17 
	$FÜûF›ldMEAM
(
AtomsMD
* 
©oms
):

18 
	$FÜûF›ldMD
(
©oms
)

20 
gcmc_n_cutoff
=1;

21 
gcmc_n_v¬s
=1;

22 
gcmc_g_’abËd
=
çl£
;

23 
ÃighbÜ
->
·œ_wi£
=
çl£
;

25 
	}
}

29 
	gFÜûF›ldMEAM
::~
	$FÜûF›ldMEAM
()

31 
	}
}

35 
FÜûF›ldMEAM
::
	$š™
()

37 
	`´e_š™
();

38 
	}
}

42 
	gFÜûF›ldMEAM
::
	$fš
()

44 
	`po¡_fš
();

45 
	}
}

49 
	gFÜûF›ldMEAM
::
	$š™_xchng
()

52 
	}
}

56 
FÜûF›ldMEAM
::
	$fš_xchng
()

59 
	}
}

63 
FÜûF›ldMEAM
::
	$´e_xchng_’”gy
(
GCMC
* 
gcmc
)

66 
	}
}

70 
ty³0
 
FÜûF›ldMEAM
::
	$xchng_’”gy
(
GCMC
* 
gcmc
)

73 
	}
}

77 
	gFÜûF›ldMEAM
::
	$po¡_xchng_’”gy
(
GCMC
*)

79 
	}
}

83 
FÜûF›ldMEAM
::
	$__fÜû_ÿlc
()

91 
	}
}

97 
FÜûF›ldMEAM
::
	$__’”gy_ÿlc
()

99 
	}
}

103 
FÜûF›ldMEAM
::
	$ml_Ãw
(
PyM‘hodDef
& 
_m‘hods
)

106 
	}
}

	@ff_meam.h

1 #iâdeà
__MAPP__ff_m—m__


2 
	#__MAPP__ff_m—m__


	)

3 
	~"ff_md.h
"

4 
	g_objeù
;

5 
_objeù
 
	tPyObjeù
;

6 
Çme¥aû
 
	gMAPP_NS


8 şas 
	cFÜûF›ldMEAM
: 
public
 
FÜûF›ldMD


10 
´iv©e
:

11 
´Ùeùed
:

12 
__fÜû_ÿlc
();

13 
__’”gy_ÿlc
();

14 
´e_xchng_’”gy
(
GCMC
*);

15 
ty³0
 
xchng_’”gy
(
GCMC
*);

16 
po¡_xchng_’”gy
(
GCMC
*);

17 
	gpublic
:

18 
FÜûF›ldMEAM
(
şass
 
AtomsMD
*);

19 ~
FÜûF›ldMEAM
();

21 
ml_Ãw
(
PyM‘hodDef
&);

23 
š™
();

24 
fš
();

25 
š™_xchng
();

26 
fš_xchng
();

37 
	~"xm©h.h
"

38 
Çme¥aû
 
	gMAPP_NS


40 
Çme¥aû
 
	gMEAMM©h


43 
	g‹m¶©e
<cÚ¡ 
	gd
>

44 
šlše
 
d_fij
(

45 cÚ¡ 
ty³0
,constype0,

46 cÚ¡ 
ty³0
,constype0,

47 cÚ¡ 
ty³0
* 
RESTRICT
,constype0* RESTRICT,

48 cÚ¡ 
ty³0
* 
RESTRICT
,type0* RESTRICT,

49 
ty³0
&,type0&){};

53 
	g‹m¶©e
<>

54 
šlše
 
	gd_fij
<1>(

55 cÚ¡ 
ty³0
 
	g´eçc_i
,cÚ¡y³0 
	g´eçc_j
,

56 cÚ¡ 
ty³0
 
	gåaœ_´eçc_i
,cÚ¡y³0 
	gåaœ_´eçc_j
,

57 cÚ¡ 
ty³0
* 
RESTRICT
 
	gA_i
,cÚ¡y³0* RESTRICT 
	gA_j
,

58 cÚ¡ 
ty³0
* 
RESTRICT
 
	gR_ij
,ty³0* RESTRICT 
	gF_ij
,

59 
	gty³0
& 
	g¥aœ
,ty³0& 
	gåaœ
)

61 
	gF_ij
[0]+=
´eçc_i
*
A_i
[0]-
´eçc_j
*
A_j
[0];

62 
	gF_ij
[1]+=
´eçc_i
*
A_i
[1]-
´eçc_j
*
A_j
[1];

63 
	gF_ij
[2]+=
´eçc_i
*
A_i
[2]-
´eçc_j
*
A_j
[2];

65 
ty³0
 
	gm_i
=
´eçc_i
*(
A_i
[0]*
R_ij
[0]+A_i[1]*R_ij[1]+A_i[2]*R_ij[2]);

66 
ty³0
 
	gm_j
=-
´eçc_j
*(
A_j
[0]*
R_ij
[0]+A_j[1]*R_ij[1]+A_j[2]*R_ij[2]);

67 
	gåaœ
+=
åaœ_´eçc_i
*
m_i
+
åaœ_´eçc_j
*
m_j
;

68 
	g¥aœ
+=
m_i
+
m_j
;

73 
	g‹m¶©e
<>

74 
šlše
 
	gd_fij
<2>(

75 cÚ¡ 
ty³0
 
	g´eçc_i
,cÚ¡y³0 
	g´eçc_j
,

76 cÚ¡ 
ty³0
 
	gåaœ_´eçc_i
,cÚ¡y³0 
	gåaœ_´eçc_j
,

77 cÚ¡ 
ty³0
* 
RESTRICT
 
	gA_i
,cÚ¡y³0* RESTRICT 
	gA_j
,

78 cÚ¡ 
ty³0
* 
RESTRICT
 
	gR_ij
,ty³0* RESTRICT 
	gF_ij
,

79 
	gty³0
& 
	g¥aœ
,ty³0& 
	gåaœ
)

81 
ty³0
 
	gm_i
=0.0,
	gm_j
=0.0;

82 
ty³0
 
	gy_ij
,
	gy_ji
;

83 
	gy_ij
=
´eçc_i
*(
A_i
[0]*
R_ij
[0]+A_i[1]*R_ij[1]+A_i[2]*R_ij[2]);

84 
	gy_ji
=-
´eçc_j
*(
A_j
[0]*
R_ij
[0]+A_j[1]*R_ij[1]+A_j[2]*R_ij[2]);

85 
	gF_ij
[0]+=2.0*(
y_ij
-
y_ji
);

86 
	gm_i
+=
y_ij
*
R_ij
[0];

87 
	gm_j
-=
y_ji
*
R_ij
[0];

90 
	gy_ij
=
´eçc_i
*(
A_i
[1]*
R_ij
[0]+A_i[3]*R_ij[1]+A_i[4]*R_ij[2]);

91 
	gy_ji
=-
´eçc_j
*(
A_j
[1]*
R_ij
[0]+A_j[3]*R_ij[1]+A_j[4]*R_ij[2]);

92 
	gF_ij
[1]+=2.0*(
y_ij
-
y_ji
);

93 
	gm_i
+=
y_ij
*
R_ij
[1];

94 
	gm_j
-=
y_ji
*
R_ij
[1];

97 
	gy_ij
=
´eçc_i
*(
A_i
[2]*
R_ij
[0]+A_i[4]*R_ij[1]+A_i[5]*R_ij[2]);

98 
	gy_ji
=-
´eçc_j
*(
A_j
[2]*
R_ij
[0]+A_j[4]*R_ij[1]+A_j[5]*R_ij[2]);

99 
	gF_ij
[2]+=2.0*(
y_ij
-
y_ji
);

100 
	gm_i
+=
y_ij
*
R_ij
[2];

101 
	gm_j
-=
y_ji
*
R_ij
[2];

104 
	gåaœ
+=
åaœ_´eçc_i
*
m_i
+
åaœ_´eçc_j
*
m_j
;

105 
	g¥aœ
+=
m_i
+
m_j
;

108 
	g‹m¶©e
<>

109 
šlše
 
	gd_fij
<3>(

110 cÚ¡ 
ty³0
 
	g´eçc_i
,cÚ¡y³0 
	g´eçc_j
,

111 cÚ¡ 
ty³0
 
	gåaœ_´eçc_i
,cÚ¡y³0 
	gåaœ_´eçc_j
,

112 cÚ¡ 
ty³0
* 
RESTRICT
 
	gA_i
,cÚ¡y³0* RESTRICT 
	gA_j
,

113 cÚ¡ 
ty³0
* 
RESTRICT
 
	gR_ij
,ty³0* RESTRICT 
	gF_ij
,

114 
	gty³0
& 
	g¥aœ
,ty³0& 
	gåaœ
)

116 
ty³0
 
	gm_i
=0.0,
	gm_j
=0.0;

117 
ty³0
 
	gy_ij
,
	gy_ji
;

126 
	gy_ij
=
´eçc_i
*(

127 
A_i
[0]*
R_ij
[0]*R_ij[0]+

128 
A_i
[1]*
R_ij
[0]*R_ij[1]*2.0+

129 
A_i
[2]*
R_ij
[0]*R_ij[2]*2.0+

130 
A_i
[3]*
R_ij
[1]*R_ij[1]+

131 
A_i
[4]*
R_ij
[1]*R_ij[2]*2.0+

132 
A_i
[5]*
R_ij
[2]*R_ij[2]

135 
	gy_ji
=
´eçc_j
*(

136 
A_j
[0]*
R_ij
[0]*R_ij[0]+

137 
A_j
[1]*
R_ij
[0]*R_ij[1]*2.0+

138 
A_j
[2]*
R_ij
[0]*R_ij[2]*2.0+

139 
A_j
[3]*
R_ij
[1]*R_ij[1]+

140 
A_j
[4]*
R_ij
[1]*R_ij[2]*2.0+

141 
A_j
[5]*
R_ij
[2]*R_ij[2]

143 
	gF_ij
[0]+=3.0*(
y_ij
-
y_ji
);

144 
	gm_i
+=
y_ij
*
R_ij
[0];

145 
	gm_j
-=
y_ji
*
R_ij
[0];

158 
	gy_ij
=
´eçc_i
*(

159 
A_i
[1]*
R_ij
[0]*R_ij[0]+

160 
A_i
[3]*
R_ij
[0]*R_ij[1]*2.0+

161 
A_i
[4]*
R_ij
[0]*R_ij[2]*2.0+

162 
A_i
[6]*
R_ij
[1]*R_ij[1]+

163 
A_i
[7]*
R_ij
[1]*R_ij[2]*2.0+

164 
A_i
[8]*
R_ij
[2]*R_ij[2]

166 
	gy_ji
=
´eçc_j
*(

167 
A_j
[1]*
R_ij
[0]*R_ij[0]+

168 
A_j
[3]*
R_ij
[0]*R_ij[1]*2.0+

169 
A_j
[4]*
R_ij
[0]*R_ij[2]*2.0+

170 
A_j
[6]*
R_ij
[1]*R_ij[1]+

171 
A_j
[7]*
R_ij
[1]*R_ij[2]*2.0+

172 
A_j
[8]*
R_ij
[2]*R_ij[2]

174 
	gF_ij
[1]+=3.0*(
y_ij
-
y_ji
);

175 
	gm_i
+=
y_ij
*
R_ij
[1];

176 
	gm_j
-=
y_ji
*
R_ij
[1];

186 
	gy_ij
=
´eçc_i
*(

187 
A_i
[2]*
R_ij
[0]*R_ij[0]+

188 
A_i
[4]*
R_ij
[0]*R_ij[1]*2.0+

189 
A_i
[5]*
R_ij
[0]*R_ij[2]*2.0+

190 
A_i
[6]*
R_ij
[1]*R_ij[1]+

191 
A_i
[8]*
R_ij
[1]*R_ij[2]*2.0+

192 
A_i
[9]*
R_ij
[2]*R_ij[2]

194 
	gy_ji
=
´eçc_j
*(

195 
A_j
[2]*
R_ij
[0]*R_ij[0]+

196 
A_j
[4]*
R_ij
[0]*R_ij[1]*2.0+

197 
A_j
[5]*
R_ij
[0]*R_ij[2]*2.0+

198 
A_j
[7]*
R_ij
[1]*R_ij[1]+

199 
A_j
[8]*
R_ij
[1]*R_ij[2]*2.0+

200 
A_j
[9]*
R_ij
[2]*R_ij[2]

202 
	gF_ij
[2]+=3.0*(
y_ij
-
y_ji
);

203 
	gm_i
+=
y_ij
*
R_ij
[2];

204 
	gm_j
-=
y_ji
*
R_ij
[2];

207 
	gåaœ
+=
åaœ_´eçc_i
*
m_i
+
åaœ_´eçc_j
*
m_j
;

208 
	g¥aœ
+=
m_i
+
m_j
;

211 
	g‹m¶©e
<>

212 
šlše
 
	gd_fij
<0>(

213 cÚ¡ 
ty³0
 
	g´eçc_i
,cÚ¡y³0 
	g´eçc_j
,

214 cÚ¡ 
ty³0
 
	gåaœ_´eçc_i
,cÚ¡y³0 
	gåaœ_´eçc_j
,

215 cÚ¡ 
ty³0
* 
RESTRICT
 
	gA_i
,cÚ¡y³0* RESTRICT 
	gA_j
,

216 cÚ¡ 
ty³0
* 
RESTRICT
 
	gR_ij
,ty³0* RESTRICT 
	gF_ij
,

217 
	gty³0
& 
	g¥aœ
,ty³0& 
	gåaœ
)

219 
ty³0
 
	gm_i
=
´eçc_i
**
A_i
;

220 
ty³0
 
	gm_j
=
´eçc_j
**
A_j
;

221 
	gåaœ
+=
åaœ_´eçc_i
*
m_i
+
åaœ_´eçc_j
*
m_j
;

222 
	g¥aœ
+=
m_i
+
m_j
;

229 ’um{
	gRHO_OFFSET
=0,
	gY1_OFFSET
=4,
	gY2_OFFSET
=7,
	gW2_OFFSET
=13,
	gY3_OFFSET
=14,
	gW3_OFFSET
=24};

231 
šlše
 
fÜû_·¹
(

232 
ty³0
* 
RESTRICT
 
b‘a_ov_r0_i
,ty³0* RESTRICT 
b‘a_ov_r0_j
,

233 
ty³0
* 
RESTRICT
 
t0_i
,ty³0* RESTRICT 
t0_j
,

234 
ty³0
* 
RESTRICT
 
s_i
,ty³0* RESTRICT 
s_j
,

235 
ty³0
 
´eçc_i
,ty³0 
´eçc_j
,

236 
ty³0
 
s_´eçc_i
,ty³0 
s_´eçc_j
,

237 
ty³0
 
rho_´eçc_i
,ty³0 
rho_´eçc_j
,

238 
ty³0
* 
RESTRICT
 
rhß_i
,ty³0* RESTRICT 
rhß_j
,

239 
ty³0
* 
RESTRICT
 
t_i
,ty³0* RESTRICT 
t_j
,

240 
ty³0
* 
RESTRICT
 
rho_i
,ty³0* RESTRICT 
rho_j
,

241 
ty³0
* 
RESTRICT
 
R_ij
,ty³0* RESTRICT 
F_ij
,

242 
ty³0
 
phi_ij
,ty³0 
dphi_ij
,

243 
ty³0
 
r_ij
,ty³0 
S_ij
,ty³0 
dS_ij_ij
)

245 
ty³0
 
	gdF_ij
[3]={
DESIG
(3,0.0)};

246 
ty³0
 
	gåaœ
=0.0;

247 
ty³0
 
	g¥aœ
=0.0;

248 
ty³0
 
	gr_ij_šv
=1.0/
r_ij
;

249 
ty³0
 
	gr_ij_šv_sq
=
r_ij_šv
*r_ij_inv;

250 
ty³0
 
	gr_ij_šv_cb
=
r_ij_šv
*
r_ij_šv_sq
;

252 
	gd_fij
<1>(
	grhß_j
[1]*
´eçc_i
*
	gt_i
[0]*2.0*
	gr_ij_šv
,

253 
	grhß_i
[1]*
´eçc_j
*
	gt_j
[0]*2.0*
	gr_ij_šv
,

255 
	gb‘a_ov_r0_j
[1]+
	gr_ij_šv
,

256 
	gb‘a_ov_r0_i
[1]+
	gr_ij_šv
,

258 
	grho_i
+
	gY1_OFFSET
,

259 
	grho_j
+
	gY1_OFFSET
,

261 
	gR_ij
,
	gdF_ij
,
	g¥aœ
,
	gåaœ
);

263 
	gd_fij
<2>(
	grhß_j
[2]*
´eçc_i
*
	gt_i
[1]*2.0*
	gr_ij_šv_sq
,

264 
	grhß_i
[2]*
´eçc_j
*
	gt_j
[1]*2.0*
	gr_ij_šv_sq
,

266 
	gb‘a_ov_r0_j
[2]+2.0*
	gr_ij_šv
,

267 
	gb‘a_ov_r0_i
[2]+2.0*
	gr_ij_šv
,

269 
	grho_i
+
	gY2_OFFSET
,

270 
	grho_j
+
	gY2_OFFSET
,

272 
	gR_ij
,
	gdF_ij
,
	g¥aœ
,
	gåaœ
);

274 
	gd_fij
<3>(
	grhß_j
[3]*
´eçc_i
*
	gt_i
[2]*2.0*
	gr_ij_šv_cb
,

275 
	grhß_i
[3]*
´eçc_j
*
	gt_j
[2]*2.0*
	gr_ij_šv_cb
,

277 
	gb‘a_ov_r0_j
[3]+3.0*
	gr_ij_šv
,

278 
	gb‘a_ov_r0_i
[3]+3.0*
	gr_ij_šv
,

280 
	grho_i
+
	gY3_OFFSET
,

281 
	grho_j
+
	gY3_OFFSET
,

283 
	gR_ij
,
	gdF_ij
,
	g¥aœ
,
	gåaœ
);

286 
	gd_fij
<0>(-
	grhß_j
[2]*
´eçc_i
*
	gt_i
[1]*2.0/3.0,

287 -
	grhß_i
[2]*
´eçc_j
*
	gt_j
[1]*2.0/3.0,

289 
	gb‘a_ov_r0_j
[2],

290 
	gb‘a_ov_r0_i
[2],

292 
	grho_i
+
	gW2_OFFSET
,

293 
	grho_j
+
	gW2_OFFSET
,

295 
	gR_ij
,
	gdF_ij
,
	g¥aœ
,
	gåaœ
);

296 
	gd_fij
<1>(-
	grhß_j
[3]*
´eçc_i
*
	gt_i
[2]*0.4*
	gr_ij_šv
,

297 -
	grhß_i
[3]*
´eçc_j
*
	gt_j
[2]*0.4*
	gr_ij_šv
,

299 
	gb‘a_ov_r0_j
[3]+
	gr_ij_šv
,

300 
	gb‘a_ov_r0_i
[3]+
	gr_ij_šv
,

302 
	grho_i
+
	gW3_OFFSET
,

303 
	grho_j
+
	gW3_OFFSET
,

305 
	gR_ij
,
	gdF_ij
,
	g¥aœ
,
	gåaœ
);

308 
	gåaœ
*=-
S_ij
;

317 
ty³0
 
	gmm_i
=
rhß_j
[0]*(
rho_´eçc_i
+

318 (
t0_j
[0]-
t_i
[0])*(
´eçc_i
*
rho_i
[1]*rho_i[1]-
s_´eçc_i
*
s_i
[0])+

319 (
t0_j
[1]-
t_i
[1])*(
´eçc_i
*
rho_i
[2]*rho_i[2]-
s_´eçc_i
*
s_i
[1])+

320 (
t0_j
[2]-
t_i
[2])*(
´eçc_i
*
rho_i
[3]*rho_i[3]-
s_´eçc_i
*
s_i
[2]));

322 
ty³0
 
	gmm_j
=
rhß_i
[0]*(
rho_´eçc_j
+

323 (
t0_i
[0]-
t_j
[0])*(
´eçc_j
*
rho_j
[1]*rho_j[1]-
s_´eçc_j
*
s_j
[0])+

324 (
t0_i
[1]-
t_j
[1])*(
´eçc_j
*
rho_j
[2]*rho_j[2]-
s_´eçc_j
*
s_j
[1])+

325 (
t0_i
[2]-
t_j
[2])*(
´eçc_j
*
rho_j
[3]*rho_j[3]-
s_´eçc_j
*
s_j
[2]));

331 
	g¥aœ
+=
mm_i
+
mm_j
;

332 
	gåaœ
-=
S_ij
*(
b‘a_ov_r0_j
[0]*
mm_i
+
b‘a_ov_r0_i
[0]*
mm_j
);

334 
	g¥aœ
+=
phi_ij
;

335 
	gåaœ
+=
dphi_ij
*
S_ij
;

337 
	gåaœ
+=
dS_ij_ij
*
¥aœ
;

339 
	gdF_ij
[0]*=
S_ij
;

340 
	gdF_ij
[0]+=
åaœ
*
r_ij_šv
*
R_ij
[0];

341 
	gdF_ij
[1]*=
S_ij
;

342 
	gdF_ij
[1]+=
åaœ
*
r_ij_šv
*
R_ij
[1];

343 
	gdF_ij
[2]*=
S_ij
;

344 
	gdF_ij
[2]+=
åaœ
*
r_ij_šv
*
R_ij
[2];

	@ff_styles.h

1 
	~"ff_lj.h
"

2 
	~"ff_—m.h
"

4 
	~"ff_fs.h
"

5 
	~"ff_—m_dmd.h
"

7 
	~"ff_—m_func.h
"

8 #ifdeà
SC_DMD


9 
	~"ff_—m_dmd_sc.h
"

10 
	~"ff_—m_dmd_scc.h
"

11 
	~"ff_—m_dmd_şu¡”.h
"

13 #ifdeà
POTFIT


14 
	~"ff_—m_f™.h
"

15 
	~"ff_—m_f™_o.h
"

16 
	~"ff_—m_pÙf™.h
"

	@ff_tersoff.cpp

5 
	~"ff_‹rsoff.h
"

6 
	~"ÃighbÜ_md.h
"

7 
	~"©oms_md.h
"

8 
	~"–em’ts.h
"

9 
	~"memÜy.h
"

10 
	~"pgcmc_2.h
"

11 
	~"­i.h
"

12 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

16 
	gFÜûF›ldT”soff
::

17 
	$FÜûF›ldT”soff
(
AtomsMD
* 
©oms
):

18 
	$FÜûF›ldMD
(
©oms
)

20 
gcmc_n_cutoff
=1;

21 
gcmc_n_v¬s
=1;

22 
gcmc_g_’abËd
=
çl£
;

23 
ÃighbÜ
->
·œ_wi£
=
çl£
;

25 
	}
}

29 
	gFÜûF›ldT”soff
::~
	$FÜûF›ldT”soff
()

31 
	}
}

35 
FÜûF›ldT”soff
::
	$š™
()

37 
	`´e_š™
();

38 
	}
}

42 
	gFÜûF›ldT”soff
::
	$fš
()

44 
	`po¡_fš
();

45 
	}
}

49 
	gFÜûF›ldT”soff
::
	$š™_xchng
()

52 
	}
}

56 
FÜûF›ldT”soff
::
	$fš_xchng
()

59 
	}
}

63 
FÜûF›ldT”soff
::
	$´e_xchng_’”gy
(
GCMC
* 
gcmc
)

66 
	}
}

70 
ty³0
 
FÜûF›ldT”soff
::
	$xchng_’”gy
(
GCMC
* 
gcmc
)

73 
	}
}

77 
	gFÜûF›ldT”soff
::
	$po¡_xchng_’”gy
(
GCMC
*)

79 
	}
}

83 
	~"xm©h.h
"

84 
FÜûF›ldT”soff
::
	$__fÜû_ÿlc
()

86 cÚ¡ 
ty³0
* 
x
=
©oms
->x->
	`begš
();

88 
–em_ty³
* 
evec
=
©oms
->
–em
->
	`begš
();

90 
–em_ty³
 
›Ëm
,
j–em
,
k–em
;

91 
ty³0
 
rsq_ij
;

95 ** 
ÃighbÜ_li¡
=
ÃighbÜ
->neighbor_list;

96 * 
ÃighbÜ_li¡_size
=
ÃighbÜ
->neighbor_list_size;

98 
ty³0
 
x_i
[
__dim__
];

99 
ty³0
 
dx_ij
[
__dim__
];

100 cÚ¡ 
Çtms_lş
=
©oms
->natms_lcl;

101 
Ÿtm
=0;Ÿtm<
Çtms_lş
;iatm++)

104 
›Ëm
=
evec
[
Ÿtm
];

105 
Algeb¿
::
V_eq
<
__dim__
>(
x
+
Ÿtm
*__dim__,
x_i
);

107 cÚ¡ 
li¡_size
=
ÃighbÜ_li¡_size
[
Ÿtm
];

108 
j
=0,
j©m
;j<
li¡_size
;j++)

110 
j©m
=
ÃighbÜ_li¡
[
Ÿtm
][
j
];

111 if(
j©m
<
Ÿtm
) ;

112 
j–em
=
evec
[
j©m
];

113 
rsq_ij
=
Algeb¿
::
	`DX_RSQ
(
x_i
,
x
+
j©m
*
__dim__
,
dx_ij
);

129 
ty³0
 
r_ij
,
r_ik
;

130 
ty³0
 
r_ij_h©
[
__dim__
];

131 
ty³0
 
r_ik_h©
[
__dim__
];

133 
ty³0
** 
Ïmbda_2_i
;

134 
ty³0
* 
Ïmbda_2_ij
;

135 
ty³0
 
cos_th‘a_ijk
;

136 
ty³0
 
z‘a_ij
;

138 
Ÿtm
=0;Ÿtm<
Çtms_lş
;iatm++)

141 
›Ëm
=
evec
[
Ÿtm
];

142 
Ïmbda_2_i
=
Ïmbda_2
[
›Ëm
];

143 
Algeb¿
::
V_eq
<
__dim__
>(
x
+
Ÿtm
*__dim__,
x_i
);

145 cÚ¡ 
li¡_size
=
ÃighbÜ_li¡_size
[
Ÿtm
];

146 
j
=0,
j©m
;j<
li¡_size
;j++)

148 
j©m
=
ÃighbÜ_li¡
[
Ÿtm
][
j
];

149 
j–em
=
evec
[
j©m
];

150 
r_ij
=
Algeb¿
::
	`DX_HAT_R
(
x_i
,
x
+
j©m
*
__dim__
,
r_ij_h©
);

151 
Ïmbda_2_ij
=
Ïmbda_2_i
[
j–em
];

155 
z‘a_ij
=0.0;

156 
k
=0,
k©m
;k<
li¡_size
;k++)

158 if(
k
==
j
) ;

159 
k©m
=
ÃighbÜ_li¡
[
Ÿtm
][
k
];

160 
k–em
=
evec
[
k©m
];

161 
r_ik
=
Algeb¿
::
	`DX_HAT_R
(
x_i
,
x
+
k©m
*
__dim__
,
r_ik_h©
);

163 
cos_th‘a_ijk
=
Algeb¿
::
V_mul_V
<
__dim__
>(
r_ij_h©
,
r_ik_h©
);

178 
	}
}

182 
ty³0
 
	gFÜûF›ldT”soff
::
	$z‘a_ij_k
(

183 cÚ¡ 
ty³0
& 
rc_šÃr
,cÚ¡y³0& 
rc_ou‰”
,

184 cÚ¡ 
ty³0
& 
Ïmbda_2
,cÚ¡y³0& 
m
,

185 cÚ¡ 
ty³0
& 
gamma
,cÚ¡y³0& 
c_sq_šv
,cÚ¡y³0&
d_sq
,cÚ¡y³0& 
cos_th‘a0
,

186 cÚ¡ 
ty³0
& 
r_ij
,cÚ¡y³0& 
r_ik
,cÚ¡y³0& 
cos_th‘a_ijk
,

187 cÚ¡ 
ty³0
*& 
r_ij_h©
,cÚ¡y³0*& 
r_ik_h©
)

190 
ty³0
 
r0
=
Ïmbda_2
*(
r_ij
-
r_ik
);

191 
ty³0
 
r1
=
	`pow
(
r0
,
m
);

193 
r1
=
	`exp
(r1);

195 
ty³0
 
t
=
cos_th‘a_ijk
-
cos_th‘a0
;

196 
t
*=t;

197 
t
+=
d_sq
;

198 
ty³0
 
g
=(
c_sq_šv
+1.0/
t
);

200 
g
*=
gamma
;

202 
ty³0
 
fc
=1.0;

203 
ty³0
 
d_log_fc
=0.0;

205 if(
r_ik
>
rc_šÃr
)

207 
t
=
M_PI
/(
rc_ou‰”
-
rc_šÃr
);

208 
ty³0
 
s
=(
r_ik
-0.5*(
rc_ou‰”
+
rc_šÃr
))*
t
;

209 
fc
=0.5-0.5*
	`sš
(
s
);

210 
d_log_fc
=-0.5*
t
*
	`cos
(
s
)/
fc
;

215  
fc
*
r1
*
g
;

216 
	}
}

222 
	gFÜûF›ldT”soff
::
	$__’”gy_ÿlc
()

224 
	}
}

228 
FÜûF›ldT”soff
::
	$ml_Ãw
(
PyM‘hodDef
& 
_m‘hods
)

231 
	}
}

	@ff_tersoff.h

1 #iâdeà
__MAPP__ff_‹rsoff__


2 
	#__MAPP__ff_‹rsoff__


	)

3 
	~"ff_md.h
"

4 
	g_objeù
;

5 
_objeù
 
	tPyObjeù
;

6 
Çme¥aû
 
	gMAPP_NS


8 şas 
	cFÜûF›ldT”soff
: 
public
 
FÜûF›ldMD


10 
´iv©e
:

12 
ty³0
*** 
Ïmbda_2
;

13 
ty³0
 
z‘a_ij_k
(constype0&,constype0&,

14 cÚ¡ 
ty³0
&,constype0&,constype0&,constype0&,

15 cÚ¡ 
ty³0
&,constype0&,constype0&,constype0&,

16 cÚ¡ 
ty³0
&,constype0*&,constype0*&);

18 
	g´Ùeùed
:

19 
__fÜû_ÿlc
();

20 
__’”gy_ÿlc
();

21 
´e_xchng_’”gy
(
GCMC
*);

22 
ty³0
 
xchng_’”gy
(
GCMC
*);

23 
po¡_xchng_’”gy
(
GCMC
*);

24 
	gpublic
:

25 
FÜûF›ldT”soff
(
şass
 
AtomsMD
*);

26 ~
FÜûF›ldT”soff
();

28 
ml_Ãw
(
PyM‘hodDef
&);

30 
š™
();

31 
fš
();

32 
š™_xchng
();

33 
fš_xchng
();

	@gcmc.cpp

5 
	~"–em’ts.h
"

6 
	~<mpi.h
>

7 
	~"gcmc.h
"

8 
	~"memÜy.h
"

9 
	~"¿ndom.h
"

10 
	~"ÃighbÜ.h
"

11 
	~"ff_md.h
"

12 
	~"MAPP.h
"

13 
	~"©oms_md.h
"

14 
	~"comm.h
"

15 
	~"dyÇmic_md.h
"

16 
	~<io¡»am
>

17 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

18 
	#GCMCDEBUG


	)

22 
	gGCMC
::
	$GCMC
(
AtomsMD
*& 
__©oms
,
FÜûF›ldMD
*&
__ff
,
DyÇmicMD
*& 
__dyÇmic
,
–em_ty³
 
__gas_ty³0
,
ty³0
 
__mu0
,–em_ty³ 
__gas_ty³1
,ty³0 
__mu1
,ty³0 
__T
,
£ed
):

23 
	`©oms
(
__©oms
),

24 
	`ff
(
__ff
),

25 
	`wÜld
(
__©oms
->
comm
.
wÜld
),

26 
	`dyÇmic
(
__dyÇmic
),

27 
	`gas_ty³0
(
__gas_ty³0
),

28 
	`gas_ty³1
(
__gas_ty³1
),

29 
	`mu0
(
__mu0
),

30 
	`mu1
(
__mu1
),

31 
	`T
(
__T
),

32 
	`cut_sq
(
__ff
->
cut_sq
),

33 
	`s_hi
(
__©oms
->
comm
.
s_hi
),

34 
	`s_lo
(
__©oms
->
comm
.
s_lo
),

35 
	`Çtms_lş
(
__©oms
->
Çtms_lş
),

36 
	`Çtms_ph
(
__©oms
->
Çtms_ph
),

37 
	$›Ëm
(
gas_ty³0
)

39 
ngas_lşA¼
 = 
Ãw
 [
nGasTy³
];

40 
muA¼
 = 
Ãw
 
ty³0
 [
nGasTy³
];

41 
muA¼
[0] = 
mu0
;

42 
muA¼
[1] = 
mu1
;

43 
gas_ty³A¼
 = 
Ãw
 
–em_ty³
 [
nGasTy³
];

44 
gas_ty³A¼
[0] = 
gas_ty³0
;

45 
gas_ty³A¼
[1] = 
gas_ty³1
;

46 
gas_massA¼
 = 
Ãw
 
ty³0
 [
nGasTy³
];

47 
ÏmbdaA¼
 = 
Ãw
 
ty³0
 [
nGasTy³
];

48 
sigmaA¼
 = 
Ãw
 
ty³0
 [
nGasTy³
];

49 
z_çcA¼
 = 
Ãw
 
ty³0
 [
nGasTy³
];

50 
ngasA¼
 = 
Ãw
 [
nGasTy³
];

53 
¿ndom
=
Ãw
 
	`Rªdom
(
£ed
);

54 
s_ŒŸls
=
Ãw
 
ty³0
*[
__dim__
];

55 *
s_ŒŸls
=
NULL
;

56 
d–_ids
=
NULL
;

57 
d–_ids_sz
=
d–_ids_ıùy
=0;

58 
v¬s
=
lş_v¬s
=
NULL
;

59 
	}
}

63 
	gGCMC
::~
	$GCMC
()

65 
d–‘e
 [] 
d–_ids
;

66 
d–‘e
 [] 
s_ŒŸls
;

67 
d–‘e
 
¿ndom
;

69 
d–‘e
 [] 
ngas_lşA¼
;

70 
d–‘e
 [] 
muA¼
;

71 
d–‘e
 [] 
gas_ty³A¼
;

72 
d–‘e
 [] 
gas_massA¼
;

73 
d–‘e
 [] 
ÏmbdaA¼
;

74 
d–‘e
 [] 
sigmaA¼
;

75 
d–‘e
 [] 
z_çcA¼
;

76 
d–‘e
 [] 
ngasA¼
;

79 
	}
}

83 
	gGCMC
::
	$add_d–_id
(* 
Ãw_ids
,
no
)

85 if(
d–_ids_sz
+
no
>
d–_ids_ıùy
)

87 * 
d–_ids_
=
Ãw
 [
d–_ids_sz
+
no
];

88 
	`memıy
(
d–_ids_
,
d–_ids
,
d–_ids_sz
*());

89 
d–_ids_ıùy
=
d–_ids_sz
+
no
;

90 
d–‘e
 [] 
d–_ids
;

91 
d–_ids
=
d–_ids_
;

93 
	`memıy
(
d–_ids
+
d–_ids_sz
,
Ãw_ids
,()*
no
);

94 
d–_ids_sz
+=
no
;

95 
	}
}

99 
	gGCMC
::
	$g‘_Ãw_id
()

101 if(
d–_ids_sz
)

103 
d–_ids_sz
--;

104  
d–_ids
[
d–_ids_sz
];

108 
max_id
++;

109  
max_id
;

111 
	}
}

115 
	gGCMC
::
	$š™
()

117 
cut
=
ff
->cut[
›Ëm
][0];

118 
size_t
 
i
=1;i<
©oms
->
–em’ts
.
ÃËms
;i++)

119 
cut
=
	`MAX
(cut,
ff
->cut[
›Ëm
][
i
]);

121 
gas_mass0
=
©oms
->
–em’ts
.
mas£s
[
gas_ty³0
];

122 
gas_mass1
=
©oms
->
–em’ts
.
mas£s
[
gas_ty³1
];

124 
gas_massA¼
[0]=
©oms
->
–em’ts
.
mas£s
[
gas_ty³0
];

125 
gas_massA¼
[1]=
©oms
->
–em’ts
.
mas£s
[
gas_ty³1
];

128 
kbT
=
©oms
->
kB
*
T
;

129 
b‘a
=1.0/
kbT
;

136 
i
 = 0;˜< 
nGasTy³
;i++)

138 
ÏmbdaA¼
[
i
] = 
©oms
->
hP
/
	`sq¹
(2.0*
M_PI
*
kbT
*
gas_massA¼
[i]);

139 
sigmaA¼
[
i
] = 
	`sq¹
(
kbT
/
gas_massA¼
[i]);

140 
z_çcA¼
[
i
] = 1.0;

141 
j
=0;j<
__dim__
;j++è
z_çcA¼
[
i
] /ğ
ÏmbdaA¼
[i];

142 
z_çcA¼
[
i
] *ğ
	`exp
(
b‘a
*
muA¼
[i]);

143 
ngas_lşA¼
[
i
] = 0;

144 
ngasA¼
[
i
] = 0;

145 #ifdeà
GCMCDEBUG


146 
FILE
* 
å_debug
=
NULL
;

147 
å_debug
=
	`fİ’
("gcmc_debug","a");

148 if(
©oms
->
comm_¿nk
==0)

150 
	`årštf
(
å_debug
,"Çtoms\t%d\n",
©oms
->
Çtms
);

151 
	`årštf
(
å_debug
,"i\t%d\n",
i
);

152 
	`årštf
(
å_debug
,"sigma\t%e\n",
sigmaA¼
[
i
]);

153 
	`årštf
(
å_debug
,"gas_mass0\t%e\n",
gas_mass0
);

154 
	`årštf
(
å_debug
,"gas_mass1\t%e\n",
gas_mass1
);

155 
	`årštf
(
å_debug
,"gas_massA¼\t%e\n",
gas_massA¼
[
i
]);

156 
	`årštf
(
å_debug
,"mu\t%e\n",
muA¼
[
i
]);

164 
vŞ
=1.0;

165 
i
=0;i<
__dim__
;i++)
vŞ
*=
©oms
->
H
[i][i];

167 
max_id_
=0;

168 * 
id
=
©oms
->id->
	`begš
();

169 
i
=0;i<
Çtms_lş
;i++)

170 
max_id_
=
	`MAX
(
id
[
i
],max_id_);

171 
	`MPI_AÎ»duû
(&
max_id_
,&
max_id
,1,
MPI_UNSIGNED
,
MPI_MAX
,
wÜld
);

172 
i
=0;i<
d–_ids_sz
;i++)

173 
max_id
=
	`MAX
(max_id,
d–_ids
[
i
]);

176 
–em_ty³
* 
–em
=
©oms
->–em->
	`begš
();

177 
i
=0;i<
Çtms_lş
;i++)

180 
j
=0; j< 
nGasTy³
;j++)

182 if(
–em
[
i
]==
gas_ty³A¼
[
j
]è
ngas_lşA¼
[j]++;

186 
	`MPI_AÎ»duû
(
ngas_lşA¼
,
ngasA¼
,
nGasTy³
,
MPI_INT
,
MPI_SUM
,
wÜld
);

187 #ifdeà
GCMCDEBUG


188 
FILE
* 
å_debug
=
NULL
;

189 if(
©oms
->
comm_¿nk
==0)

191 
å_debug
=
	`fİ’
("gcmc_debug","a");

192 
	`årštf
(
å_debug
,"ngasA¼\t%d\t%d\n",
ngasA¼
[0],ngasArr[1]);

197 
	}
}

201 
	gGCMC
::
	$fš
()

204 
	}
}

208 
GCMC
::
	$box_£tup
()

210 
sz
=0;

211 
max_ÁrŸl_©ms
=1;

212 
i
=0;i<
__dim__
;i++)

214 
ty³0
 
tmp
=0.0;

215 
j
=
i
;j<
__dim__
;j++)

216 
tmp
+=
©oms
->
B
[
j
][
i
]*atoms->B[j][i];

217 
cut_s
[
i
]=
	`sq¹
(
tmp
)*
cut
;

221 
s_lo_ph
[
i
]=
s_lo
[i]-
cut_s
[i];

222 
s_hi_ph
[
i
]=
s_hi
[i]+
cut_s
[i];

223 
nimages_³r_dim
[
i
][0]=
¡©ic_ÿ¡
<>(
	`æoÜ
(
s_hi_ph
[i]));

224 
nimages_³r_dim
[
i
][1]=-
¡©ic_ÿ¡
<>(
	`æoÜ
(
s_lo_ph
[i]));

225 
max_ÁrŸl_©ms
*=1+
nimages_³r_dim
[
i
][0]+nimages_per_dim[i][1];

226 
sz
+=1+
nimages_³r_dim
[
i
][0]+nimages_per_dim[i][1];

230 *
s_ŒŸls
=
Ãw
 
ty³0
[
sz
];

231 
i
=1;i<
__dim__
;i++)

232 
s_ŒŸls
[
i
]=s_ŒŸls[i-1]+1+
nimages_³r_dim
[i-1][0]+nimages_per_dim[i-1][1];

233 
	}
}

237 
	gGCMC
::
	$box_dismªe
()

239 
d–‘e
 [] *
s_ŒŸls
;

240 *
s_ŒŸls
=
NULL
;

241 
	}
}

	@gcmc.h

5 #iâdeà
__MAPP__gcmc__


6 
	#__MAPP__gcmc__


	)

7 
	~"glob®.h
"

8 
	~<mpi.h
>

9 
Çme¥aû
 
	gMAPP_NS


11 ’um{
	gNOEX_MODE
,
	gDEL_MODE
,
	gINS_MODE
};

12 ’um{
	gMINE_FLAG
,
	gINTERACT_FLAG
,
	gNONEINTERACT_FLAG
};

50 
	g‹m¶©e
<
	gty³Çme
> 
şass
 
	gVec
;

51 şas 
	cGCMC


53 
	g´iv©e
:

54 
´Ùeùed
:

58 
igas
,
	ggas_id
;

59 cÚ¡ 
	gnGasTy³
 = 2;

61 
–em_ty³
 
	ggas_ty³0
;

62 
–em_ty³
 
	ggas_ty³1
;

63 
ty³0
 
	gvŞ
;

66 
ty³0
 
	ggas_mass0
,
	ggas_mass1
,
	gb‘a
,
	gkbT
,
	gT
,
	gmu0
,
	gmu1
;

68 * 
	gngas_lşA¼
;

69 
–em_ty³
* 
	ggas_ty³A¼
;

70 
ty³0
* 
	gmuA¼
;

71 
ty³0
* 
	ggas_massA¼
;

72 
ty³0
* 
	gÏmbdaA¼
;

73 
ty³0
* 
	gsigmaA¼
;

74 
ty³0
* 
	gz_çcA¼
;

77 & 
	gÇtms_lş
;

78 & 
	gÇtms_ph
;

79 
ty³0
 
	gcut
;

80 
	gty³0
**& 
	gcut_sq
;

81 
ty³0
 (&
s_lo
)[
__dim__
];

82 
ty³0
 (&
s_hi
)[
__dim__
];

85 
ty³0
 
	gs_buff
[
__dim__
];

86 
ty³0
 
	gv–_buff
[
__dim__
];

87 
ty³0
 
	gcut_s
[
__dim__
];

88 
ty³0
 
	gs_lo_ph
[
__dim__
];

89 
ty³0
 
	gs_hi_ph
[
__dim__
];

91 
	gnimages_³r_dim
[
__dim__
][2];

92 
ty³0
** 
	gs_ŒŸls
;

95 
	gd–_idx
;

97 * 
	gd–_ids
;

98 
	gd–_ids_sz
,
	gd–_ids_ıùy
;

99 
	gmax_id
;

101 
	gVec
<
	gty³0
>* 
	gs_vec_p
;

105 
şass
 
Rªdom
* 
	g¿ndom
;

108 
	g™rŸl_©m
,
	gÁrŸl_©ms
,
	gmax_ÁrŸl_©ms
;

110 
vœtu®
 
šs_succ
()=0;

111 
vœtu®
 
d–_succ
()=0;

112 
vœtu®
 
box_£tup
();

113 
vœtu®
 
box_dismªe
();

114 
add_d–_id
(*,);

115 
g‘_Ãw_id
();

117 
şass
 
	gDyÇmicMD
*& 
	gdyÇmic
;

118 
	gMPI_Comm
& 
	gwÜld
;

123 
şass
 
	gAtomsMD
*& 
	g©oms
;

124 
şass
 
	gFÜûF›ldMD
*& 
	gff
;

126 
ty³0
 
	gmvv_lş
[
__nvoigt__
];

127 #ifdeà
GCMCDEBUG


128 
ty³0
 
	gtÙ_d–_u_lş
;

130 
	gpublic
:

131 
GCMC
(
şass
 
AtomsMD
*&, cÏs 
FÜûF›ldMD
*&,şas 
DyÇmicMD
*&,
–em_ty³
,
ty³0
,elem_type,type0,type0,);

132 
	gvœtu®
 ~
GCMC
();

134 
vœtu®
 
š™
();

135 
vœtu®
 
fš
();

137 
vœtu®
 
xchng
(
boŞ
,)=0;

140 
vœtu®
 
Ãxt_Ÿtm
()=0;

141 
vœtu®
 
Ãxt_j©m
()=0;

142 
vœtu®
 
Ãxt_icomm
()=0;

144 
vœtu®
 
»£t_Ÿtm
()=0;

145 
vœtu®
 
»£t_j©m
()=0;

146 
vœtu®
 
»£t_icomm
()=0;

148 
	gŸtm
;

149 
	gnŸtms
;

150 
	g–em_ty³
& 
	g›Ëm
;

151 
ty³0
* 
	gix
;

152 
ty³0
* 
	gjx
;

153 
	gj©m
;

154 
–em_ty³
 
	gj–em
;

155 
ty³0
 
	grsq
;

156 
	gxchng_mode
;

157 
	gdof_diff
;

159 * 
	gngasA¼
=
nuÎ±r
;

160 
boŞ
 
	gim_roÙ
;

162 
	gVec
<>* 
	gg_vec_p
;

163 
	gicomm
;

164 
ty³0
* 
	glş_v¬s
;

165 
ty³0
* 
	gv¬s
;

166 
MPI_Comm
* 
	gcu¼_comm
;

167 
	gcu¼_roÙ
;

168 
boŞ
 
	groÙ_succ
;

170 
ty³0
 
	gmvv
[
__nvoigt__
];

171 #ifdeà
GCMCDEBUG


172 
ty³0
 
	gtÙ_d–_u
;

	@global.h

3 
	#MIN
(
A
,
B
è(A<B?A:B)

	)

4 
	#MAX
(
A
,
B
è(A>B?A:B)

	)

7 
	#THERMO_DLMTR
 "|"

	)

8 
	#THERMO_LINE
 "-"

	)

12 
	#RESTRICT
 
__»¡riù__


	)

14 
	#GET_WRAPPER_DOC
(
ty³
,
func
) \

15 ((
PyW¿µ”DesüObjeù
*)
	`PyDiù_G‘I‹mSŒšg
(
ty³
.
_diù
, #funø))->
d_ba£
->
doc


	)

18 #iâdeà
__MAPP__ty³_def__


19 
	#__MAPP__ty³_def__


	)

22 
	tty³0
;

23 
	t–em_ty³
;

24 
	tby‹
;

26 
Çme¥aû
 
	gMAPP_NS


28 
	g‹m¶©e
<
	gN
, 
	g–em_ty³
 ... 
	gRe¡
>

29 şas 
	cdof_mask


31 
	gpublic
:

32 
cÚ¡ex´
 cÚ¡ 
–em_ty³
 (&
v®ue
)[...(
Re¡
)+
N
] = 
dof_mask
<N-1,1<<(
	g¡©ic_ÿ¡
<>((
	g–em_ty³
)*8)-
	gN
), 
	gRe¡
...>::value;

35 
	g‹m¶©e
<
	g–em_ty³
... 
	gRe¡
>

36 
şass
 
	gdof_mask
<0, 
	gRe¡
...>

38 
	gpublic
:

39 
cÚ¡ex´
 
–em_ty³
 
v®ue
[...(
Re¡
)] = {Rest... };

42 
	g‹m¶©e
<
	g–em_ty³
... 
	gRe¡
>

43 
cÚ¡ex´
 
–em_ty³
 
	gdof_mask
<0, 
	gRe¡
...>::
v®ue
[];

46 
cÚ¡ex´
 
	g__dim__
=3;

47 
cÚ¡ex´
 
ty³0
 
	g___dim___
=
¡©ic_ÿ¡
<ty³0>(
__dim__
);

48 
cÚ¡ex´
 
	g__nvoigt__
=
__dim__
*(__dim__+1)/2;

49 
cÚ¡ex´
 
–em_ty³
 
	g–em_mask
=1<<(8*ÓËm_ty³)-
__dim__
);

50 
cÚ¡ex´
 
–em_ty³
 
	gdofs_mask
=((1<<
__dim__
)-1)*
–em_mask
;

51 
cÚ¡ex´
 
ty³0
 
	gsq¹_2
=1.4142135623730951454746218587388284504413604736328125;

55 
	#DESIG___dim__
(
v
è
	`DESIG_3
(v)

	)

56 
	#DESIG____dim__
(
n
,
v
è
	`DESIG__3
Ò,v)

	)

58 
	~"maüo_exŒa.h
"

	@gmres.cpp

1 
	~"gm»s.h
"

2 
	~"memÜy.h
"

6 
	gGMRES
::
	$GMRES
(
Atoms
* 
__©oms
,
__m
,
__dim
):

7 
	`wÜld
(
__©oms
->
wÜld
),

8 
	`m
(
__m
),

9 
	`n
(
__dim
*
__©oms
->
Çtms_lş
)

13 
A_h©
=
Ãw
 
ty³0
*[
m
];

14 *
A_h©
=
Ãw
 
ty³0
[
m
*(m+1)/2];

15 
i
=1;i<
m
;i++)

16 
A_h©
[
i
]=A_hat[i-1]+i;

18 
MemÜy
::
	`®loc
(
Ax_h©
,
m
+1);

19 
MemÜy
::
	`®loc
(
cos_sš
,
m
+1);

20 
MemÜy
::
	`®loc
(
x_h©
,
m
+1);

21 
MemÜy
::
	`®loc
(
Q
,(
m
+1)*
n
);

22 
	}
}

26 
	gGMRES
::~
	$GMRES
()

28 
MemÜy
::
	`d—Îoc
(
Q
);

29 
MemÜy
::
	`d—Îoc
(
x_h©
);

30 
MemÜy
::
	`d—Îoc
(
cos_sš
);

31 
MemÜy
::
	`d—Îoc
(
Ax_h©
);

32 
d–‘e
 [] *
A_h©
;

33 
d–‘e
 [] 
A_h©
;

34 
	}
}

38 
ty³0
 
	gGMRES
::
	$ÿlc
(
ty³0
* 
Ax
,ty³0* 
x
)

40 
ty³0
 
nÜm_sq_lş
=0.0,
nÜm
;

41 
i
=0;i<
n
;i++)

42 
nÜm_sq_lş
+=
Ax
[
i
]*Ax[i];

44 
	`MPI_AÎ»duû
(&
nÜm_sq_lş
,&
nÜm
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

45 
nÜm
=
	`sq¹
(norm);

46 
ty³0
 
nÜm_šv
=1.0/
nÜm
;

48 
ty³0
* 
q
=
Q
;

49 
i
=0;i<
n
;i++,
q
+=
m
+1)

50 
x
[
i
]=*
q
=
nÜm_šv
*
Ax
[i];

52 
Ax_h©
[0]=
nÜm
;

53  
nÜm
;

54 
	}
}

58 
ty³0
 
	gGMRES
::
	$ÿlc
(
™”
,
ty³0
* 
RESTRICT
 
Ax
,ty³0* RESTRICT 
x
)

60 
ty³0
* 
h
=
A_h©
[
™”
];

61 
ivec
=
™”
+1;

62 
j
=0;j<
ivec
;j++)

63 
x_h©
[
j
]=0.0;

65 
ty³0
* 
q
=
Q
;

66 
i
=0;i<
n
;i++)

68 
ty³0
 
__ax
=
Ax
[
i
];

69 
j
=0;j<
ivec
;j++)

70 
x_h©
[
j
]+=
__ax
*
q
[j];

71 
q
+=
m
+1;

75 
	`MPI_AÎ»duû
(
x_h©
,
h
,
ivec
,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

76 
ty³0
 
nÜm_sq_lş
=0.0,
nÜm
;

78 
q
=
Q
;

79 
i
=0;i<
n
;i++,
q
+=
m
+1)

81 
q
[
ivec
]=
Ax
[
i
];

82 
j
=0;j<
ivec
;j++)

83 
q
[
ivec
]-=
h
[
j
]*q[j];

84 
nÜm_sq_lş
+=
q
[
ivec
]*q[ivec];

87 
	`MPI_AÎ»duû
(&
nÜm_sq_lş
,&
nÜm
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

88 
nÜm
=
	`sq¹
(norm);

89 
ty³0
 
nÜm_šv
=1.0/
nÜm
;

92 
q
=
Q
+
ivec
;

93 
i
=0;i<
n
;i++,
q
+=
m
+1)

94 
x
[
i
]=*
q
*=
nÜm_šv
;

97 
ty³0
 
tmp
;

98 
i
=0;i<
™”
;i++)

100 
tmp
=
cos_sš
[
i
][0]*
h
[i]-cos_sin[i][1]*h[i+1];

101 
h
[
i
+1]=
cos_sš
[i][1]*h[i]+cos_sin[i][0]*h[i+1];

102 
h
[
i
]=
tmp
;

105 
tmp
=
	`sq¹
(
h
[
™”
]*h[™”]+
nÜm
*norm);

106 
cos_sš
[
™”
][0]=
h
[™”]/
tmp
;

107 
cos_sš
[
™”
][1]=-
nÜm
/
tmp
;

109 
h
[
™”
]=
cos_sš
[™”][0]*h[™”]-cos_sš[™”][1]*
nÜm
;

110 
Ax_h©
[
™”
+1]=
cos_sš
[iter][1]*Ax_hat[iter];

111 
Ax_h©
[
™”
]*=
cos_sš
[iter][0];

115  
	`çbs
(
Ax_h©
[
™”
+1]);

117 
	}
}

121 
ty³0
 
	gGMRES
::
	$sŞve_y
(
nvecs
,
ty³0
* 
x
)

152 
i
=
nvecs
-1;i>-1;i--)

154 
x_h©
[
i
]=
Ax_h©
[i];

155 
j
=
i
+1;j<
nvecs
;j++)

156 
x_h©
[
i
]-=
A_h©
[
j
][i]*x_hat[j];

157 
x_h©
[
i
]/=
A_h©
[i][i];

184 
ty³0
* 
q
=
Q
;

185 
i
=0;i<
n
;i++,
q
+=
m
+1)

187 
x
[
i
]=0.0;

188 
ivec
=0;ivec<
nvecs
;ivec++)

189 
x
[
i
]+=
x_h©
[
ivec
]*
q
[ivec];

192 
ty³0
 
nÜm
=0.0;

193 
ivec
=0;ivec<
nvecs
;ivec++)

194 
nÜm
+=
x_h©
[
ivec
]*x_hat[ivec];

196  
	`sq¹
(
nÜm
);

197 
	}
}

	@gmres.h

1 #iâdeà
__MAPP__gm»s__


2 
	#__MAPP__gm»s__


	)

3 
	~"©oms.h
"

4 
Çme¥aû
 
	gMAPP_NS


6 
	g‹m¶©e
<
şass
 
	gT
,şas 
	gC0
>

7 şas 
	c__GMRES


9 
	g´iv©e
:

10 cÚ¡ 
m
;

11 cÚ¡ 
	gdim
;

12 
	gn
;

13 
	gC0
& 
	gk”Ãl
;

14 
	gVec
<
	gT
>** 
	gvecs
;

15 
T
** 
	gQ
;

16 
T
** 
	gH
;

17 
T
* 
	gb_h©
;

18 
Atoms
* 
	g©oms
;

19 
T
* 
	gcos
;

20 
T
* 
	gsš
;

22 
T
* 
	gy
;

23 
T
* 
	gªs_lş
;

25 
T
 
ÿlc
();

26 
T
 
sŞve_y
(,
ty³0
*);

27 
»¡¬t
();

28 
¡¬t
(
T
*);

29 
	gMPI_Comm
& 
	gwÜld
;

30 
	g´Ùeùed
:

31 
public
:

32 
__GMRES
(
Atoms
*,,,
C0
&);

33 ~
__GMRES
();

34 
»äesh
();

35 
boŞ
 
sŞve
(
T
,
Vec
<T>*,Vec<T>*,T&,T&);

36 
boŞ
 
sŞve
(
Vec
<
T
>*,T,T&,Vec<T>*);

40 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

44 
	g‹m¶©e
<
şass
 
	gT
,şas 
	gC0
>

45 
	g__GMRES
<
	gT
,
	gC0
>::
	$__GMRES
(
Atoms
* 
__©oms
,
__m
,
__dim
,
C0
& 
__k”Ãl
):

46 
	`©oms
(
__©oms
),

47 
	`wÜld
(
__©oms
->
wÜld
),

48 
	`m
(
__m
),

49 
	`dim
(
__dim
),

50 
	$k”Ãl
(
__k”Ãl
)

53 
Q
=
Ãw
 
T
*[
m
+1];

54 
vecs
=
Ãw
 
Vec
<
T
>*[
m
+1];

55 
ivec
=0;ivec<
m
+1;ivec++)

56 
vecs
[
ivec
]=
Ãw
 
Vec
<
T
>(
©oms
,
dim
);

58 
H
=
Ãw
 
T
*[
m
+1];

59 *
H
=
Ãw
 
T
[
m
*(m+1)/2+1];

60 
i
=1;i<
m
+1;i++)

61 
H
[
i
]=H[i-1]+i;

63 
	`»äesh
();

65 
b_h©
=
Ãw
 
T
[
m
+1];

66 
cos
=
Ãw
 
T
[
m
];

67 
sš
=
Ãw
 
T
[
m
];

68 
y
=
Ãw
 
T
[
m
];

69 
ªs_lş
=
Ãw
 
T
[
m
+1];

71 
	}
}

75 
	g‹m¶©e
<
şass
 
	gT
,şas 
	gC0
>

76 
	g__GMRES
<
	gT
,
	gC0
>::~
	$__GMRES
()

78 
ivec
=0;ivec<
m
+1;ivec++)

79 
d–‘e
 
vecs
[
ivec
];

80 
d–‘e
 [] 
vecs
;

81 
d–‘e
 [] 
Q
;

83 
d–‘e
 [] *
H
;

84 
d–‘e
 [] 
H
;

85 
d–‘e
 [] 
b_h©
;

86 
d–‘e
 [] 
cos
;

87 
d–‘e
 [] 
sš
;

88 
d–‘e
 [] 
y
;

89 
	}
}

93 
	g‹m¶©e
<
şass
 
	gT
,şas 
	gC0
>

94 
	g__GMRES
<
	gT
,
	gC0
>::
	$»äesh
()

96 
ivec
=0;ivec<
m
+1;ivec++)

97 
Q
[
ivec
]=
vecs
[ivec]->
	`begš
();

98 
n
=
©oms
->
Çtms_lş
*
dim
;

99 
	}
}

103 
	g‹m¶©e
<
şass
 
	gT
,şas 
	gC0
>

104 
boŞ
 
	g__GMRES
<
	gT
,
	gC0
>::
sŞve
(
Vec
<
T
>* 
b_±r
,T 
tŞ
,T& 
nÜm
,Vec<T>* 
x_±r
)

106 
ty³0
* 
	gx
=
x_±r
->
begš
();

107 
ty³0
* 
	gb
=
b_±r
->
begš
();

108 
	gi
=0;i<
	gn
;i++è
	gx
[
i
]=0.0;

109 
T
 
	gÏ¡_h
=0.0,
	gtmp_0
,
	gb_nÜm
,
	g»s_nÜm
;

110 
¡¬t
(
b
);

111 
	g»s_nÜm
=
b_nÜm
=
b_h©
[0];

112 
	gi
=0;i<
	gm
;i++)

114 
k”Ãl
(
vecs
[
i
],vecs[i+1]);

116 
	gÏ¡_h
=
ÿlc
(
i
);

118 
	gj
=0;j<
	gi
;j++)

120 
	gtmp_0
=
cos
[
j
]*
H
[
i
][j]-
sš
[j]*H[i][j+1];

121 
	gH
[
i
][
j
+1]=
sš
[j]*
H
[i][j]+
cos
[j]*H[i][j+1];

122 
	gH
[
i
][
j
]=
tmp_0
;

125 
	gtmp_0
=
sq¹
(
H
[
i
][i]*H[i][i]+
Ï¡_h
*last_h);

127 
	gcos
[
i
]=
H
[i][i]/
tmp_0
;

128 
	gsš
[
i
]=-
Ï¡_h
/
tmp_0
;

130 
	gH
[
i
][i]=
cos
[i]*
H
[i][i]-
sš
[i]*
Ï¡_h
;

131 
	gb_h©
[
i
+1]=
sš
[i]*
b_h©
[i];

132 
	gb_h©
[
i
]*=
cos
[i];

134 
	g»s_nÜm
=
çbs
(
b_h©
[
i
+1]);

135 if(
	g»s_nÜm
<
	gtŞ
)

137 
	gnÜm
=
sŞve_y
(
i
+1,
x
);

138  
	gŒue
;

142 
	gnÜm
=
sŞve_y
(
m
,
x
);

143  
	gçl£
;

148 
	g‹m¶©e
<
şass
 
	gT
,şas 
	gC0
>

149 
boŞ
 
	g__GMRES
<
	gT
,
	gC0
>::
sŞve
(
T
 
tŞ
,
Vec
<T>* 
b
,Vec<T>* 
x
,T& 
»s_nÜm
,T& 
nÜm
)

151 
	gi
=0;i<
	gn
;i++è
	gx
[
i
]=0.0;

152 
T
 
	gÏ¡_h
=0.0,
	gtmp_0
,
	gb_nÜm
;

153 
	gmax_™”
=1;

154 
¡¬t
(
b
);

156 
	g»s_nÜm
=
b_nÜm
=
b_h©
[0];

157 
	g»s_nÜm
>
	gtŞ
 && 
	gmax_™”
)

159 
	gi
=0;i<
	gm
;i++)

161 
k”Ãl
(
vecs
[
i
],vecs[i+1]);

164 
	gÏ¡_h
=
ÿlc
(
i
);

166 
	gj
=0;j<
	gi
;j++)

168 
	gtmp_0
=
cos
[
j
]*
H
[
i
][j]-
sš
[j]*H[i][j+1];

169 
	gH
[
i
][
j
+1]=
sš
[j]*
H
[i][j]+
cos
[j]*H[i][j+1];

170 
	gH
[
i
][
j
]=
tmp_0
;

173 
	gtmp_0
=
sq¹
(
H
[
i
][i]*H[i][i]+
Ï¡_h
*last_h);

175 
	gcos
[
i
]=
H
[i][i]/
tmp_0
;

176 
	gsš
[
i
]=-
Ï¡_h
/
tmp_0
;

178 
	gH
[
i
][i]=
cos
[i]*
H
[i][i]-
sš
[i]*
Ï¡_h
;

179 
	gb_h©
[
i
+1]=
sš
[i]*
b_h©
[i];

180 
	gb_h©
[
i
]*=
cos
[i];

182 
	g»s_nÜm
=
çbs
(
b_h©
[
i
+1]);

184 if(
	g»s_nÜm
<
	gtŞ
)

186 
	gnÜm
=
sŞve_y
(
i
+1,
x
);

187  
	gŒue
;

193 
	gnÜm
=
sŞve_y
(
m
,
x
);

195 
	gmax_™”
--;

197 if(
	gmax_™”
==0)

198  
çbs
(
b_h©
[
m
]);

199 
»¡¬t
();

203  
	gçl£
;

208 
	g‹m¶©e
<
şass
 
	gT
,şas 
	gC0
>

209 
T
 
	g__GMRES
<
	gT
,
	gC0
>::
	$ÿlc
(
ivec
)

211 
j
=0;j<
ivec
+1;j++)

212 
ªs_lş
[
j
]=0.0;

214 
i
=0;i<
n
;i++)

215 
j
=0;j<
ivec
+1;j++)

216 
ªs_lş
[
j
]+=
Q
[
ivec
+1][
i
]*Q[j][i];

218 
	`MPI_AÎ»duû
(
ªs_lş
,
H
[
ivec
],ivec+1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

220 
T
 
ªs_lş_
=0.0,
ªs
;

221 
i
=0;i<
n
;i++)

223 
j
=0;j<
ivec
+1;j++)

224 
Q
[
ivec
+1][
i
]-=
H
[ivec][
j
]*Q[j][i];

226 
ªs_lş_
+=
Q
[
ivec
+1][
i
]*Q[ivec+1][i];

229 
	`MPI_AÎ»duû
(&
ªs_lş_
,&
ªs
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

230 
ªs
=1.0/
	`sq¹
(ans);

232 
i
=0;i<
n
;i++)

233 
Q
[
ivec
+1][
i
]*=
ªs
;

235  1.0/
ªs
;

236 
	}
}

240 
	g‹m¶©e
<
şass
 
	gT
,şas 
	gC0
>

241 
T
 
	g__GMRES
<
	gT
,
	gC0
>::
	$sŞve_y
(
nvecs
,
ty³0
* 
x
)

272 
i
=
nvecs
-1;i>-1;i--)

274 
y
[
i
]=
b_h©
[i];

275 
j
=
i
+1;j<
nvecs
;j++)

276 
y
[
i
]-=
H
[
j
][i]*y[j];

277 
y
[
i
]/=
H
[i][i];

305 
i
=0;i<
n
;i++)

306 
ivec
=0;ivec<
nvecs
;ivec++)

307 
x
[
i
]+=
y
[
ivec
]*
Q
[ivec][i];

309 
T
 
nÜm
=0.0;

310 
ivec
=0;ivec<
nvecs
;ivec++)

311 
nÜm
+=
y
[
ivec
]*y[ivec];

313  
	`sq¹
(
nÜm
);

314 
	}
}

319 
	g‹m¶©e
<
şass
 
	gT
,şas 
	gC0
>

320 
	g__GMRES
<
	gT
,
	gC0
>::
	$»¡¬t
()

322 
T
 
tmp_0
=
	`çbs
(
b_h©
[
m
]);

325 if(
b_h©
[
m
]>0.0)

326 
b_h©
[
m
]=1.0;

328 
b_h©
[
m
]=-1.0;

330 
i
=
m
-1;i>-1;i--)

332 
b_h©
[
i
]=
sš
[i]*b_hat[i+1];

333 
b_h©
[
i
+1]*=
cos
[i];

336 
i
=0;i<
n
;i++)

338 
Q
[0][
i
]*=
b_h©
[0];

339 
ivec
=1;ivec<
m
+1;ivec++)

340 
Q
[0][
i
]+=
b_h©
[
ivec
]*Q[ivec][i];

343 
b_h©
[0]=
tmp_0
;

344 
i
=1;i<
m
+1;i++)

345 
b_h©
[
i
]=0.0;

346 
	}
}

350 
	g‹m¶©e
<
şass
 
	gT
,şas 
	gC0
>

351 
	g__GMRES
<
	gT
,
	gC0
>::
	$¡¬t
(
T
* 
b
)

353 
T
 
ªs_lş
=0.0,
nÜm
,
šv_nÜm
;

354 
i
=0;i<
n
;i++)

355 
ªs_lş
+=
b
[
i
]*b[i];

357 
	`MPI_AÎ»duû
(&
ªs_lş
,&
nÜm
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

358 
nÜm
=
	`sq¹
(norm);

359 
šv_nÜm
=1.0/
nÜm
;

361 
i
=0;i<
n
;i++)

362 
Q
[0][
i
]=
šv_nÜm
*
b
[i];

364 
b_h©
[0]=
nÜm
;

365 
	}
}

370 
Çme¥aû
 
	gMAPP_NS


372 şas 
	cGMRES


374 
	g´iv©e
:

375 cÚ¡ 
m
;

376 cÚ¡ 
	gn
;

377 
ty³0
* 
	gQ
;

378 
ty³0
** 
	gA_h©
;

379 
ty³0
* 
	gAx_h©
;

380 
ty³0
(* 
cos_sš
)[2];

383 
ty³0
* 
	gx_h©
;

386 
ty³0
 
ÿlc
(type0*,type0*);

387 
ty³0
 
ÿlc
(,type0*,type0*);

389 
ty³0
 
sŞve_y
(,type0*);

392 
	gMPI_Comm
& 
	gwÜld
;

393 
	g´Ùeùed
:

394 
public
:

395 
GMRES
(
Atoms
*,,);

396 ~
GMRES
();

397 
	g‹m¶©e
<
şass
 
	gKERNEL
>

398 
boŞ
 
sŞve
(
KERNEL
&,
Vec
<
ty³0
>*,type0,type0&,Vec<type0>*);

405 
	g‹m¶©e
<
şass
 
	gKERNEL
>

406 
boŞ
 
	gGMRES
::
sŞve
(
KERNEL
& 
A
,
Vec
<
ty³0
>* 
Ax
,ty³0 
tŞ
,ty³0& 
nÜm
,Vec<ty³0>* 
x
)

408 
ty³0
* 
	g__Ax
=
Ax
->
begš
();

409 
ty³0
* 
	g__x
=
x
->
begš
();

410 
ÿlc
(
__Ax
,
__x
);

412 
	gi
=0;i<
	gm
;i++)

414 
A
(
x
,
Ax
);

415 if(
ÿlc
(
i
,
__Ax
,
__x
)<
	gtŞ
)

417 
	gnÜm
=
sŞve_y
(
i
+1,
__x
);

418  
	gŒue
;

422 
	gnÜm
=
sŞve_y
(
m
,
__x
);

423  
	gçl£
;

	@import.cpp

5 
	~"comm.h
"

6 
	~"impÜt.h
"

7 
	~"´št.h
"

8 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

12 
	gImpÜt
::
	$ImpÜt
(
MPI_Comm
& 
__wÜld
):

13 
	$wÜld
(
__wÜld
)

15 
	}
}

19 
ImpÜt
::~
	$ImpÜt
()

22 
	}
}

26 
FeR—d”
::
	$FeR—d”
():

27 
	`wÜld
(
MPI_COMM_NULL
),

28 
	`¿nk
(0),

29 
	`fe
(
NULL
),

30 
	$fšished
(
çl£
)

32 
	}
}

36 
	gFeR—d”
::~
	$FeR—d”
()

38 if(!
¿nk
 && 
fe
è
f¡
.
	`şo£
();

39 
d–‘e
 [] 
fe
;

40 
	}
}

44 
	gFeR—d”
::
	$FeR—d”
(
CommuniÿtiÚ
*& 
comm
,cÚ¡ * 
__fe
):

45 
	`FeR—d”
(
comm
->
wÜld
,
__fe
)

47 
	}
}

51 
	gFeR—d”
::
	$FeR—d”
(
CommuniÿtiÚ
*& 
comm
,cÚ¡ 
¡d
::
¡ršg
 
__fe
):

52 
	`FeR—d”
(
comm
->
wÜld
,
__fe
.
	$c_¡r
())

54 
	}
}

58 
	gFeR—d”
::
	$FeR—d”
(
MPI_Comm
 
__wÜld
,cÚ¡ 
¡d
::
¡ršg
 
__fe
):

59 
	`FeR—d”
(
__wÜld
,
__fe
.
	$c_¡r
())

61 
	}
}

65 
	gFeR—d”
::
	$FeR—d”
(
MPI_Comm
 
__wÜld
,cÚ¡ * 
__fe
):

66 
	`wÜld
(
__wÜld
),

67 
	`¿nk
(
CommuniÿtiÚ
::
	`g‘_¿nk
(
__wÜld
)),

68 
	`fe
(
NULL
),

69 
	`fšished
(
çl£
),

70 
	`lše_no
(0),

71 
	`f¡
(
CommuniÿtiÚ
::
	`g‘_¿nk
(
__wÜld
)==0 ? 
¡d
::
	$if¡»am
(
__fe
,
¡d
::
ios_ba£
::
š
): std::
	$if¡»am
())

73 
boŞ
 
fe_x¡
=
Œue
;

74 if(!
¿nk
)

75 if(
f¡
.
	`ç
()è
fe_x¡
=
çl£
;

78 
	`MPI_Bÿ¡
(&
fe_x¡
,1,
MPI_BYTE
,0,
wÜld
);

80 if(!
fe_x¡
)

81 
throw
 
Pršt
::
	`v´štf
("çedØİ’ %s",
__fe
);

83 if(!
¿nk
)

84 
¡r_lše
.
	`»£rve
(1024);

86 
fe
=
Ãw
 [
	`¡¾’
(
__fe
)+1];

87 
	`memıy
(
fe
,
__fe
,(
	`¡¾’
(__file)+1)*());

88 
	}
}

92 
boŞ
 
	gFeR—d”
::
	$İ”©Ü
()(*& 
lše
,
size_t
& 
lše_ıùy
)

94 if(
fšished
è 
Œue
;

95 
size_t
 
size
=0;

97 if(!
¿nk
)

99 
¡d
::
	`g‘lše
(
f¡
,
¡r_lše
);

100 
fšished
=
f¡
.
	`eof
();

101 if(!
fšished
è
lše_no
++;

102 
size
=
¡r_lše
.
	`size
();

105 
	`MPI_Bÿ¡
(&
fšished
,1,
MPI_BYTE
,0,
wÜld
);

106 if(
fšished
è 
Œue
;

108 
	`MPI_Bÿ¡
(&
size
,(
size_t
),
MPI_BYTE
,0,
wÜld
);

109 if(
size
+1>
lše_ıùy
)

111 
d–‘e
 [] 
lše
;

112 
lše
 =
Ãw
 [
size
+1];

113 
lše_ıùy
=
size
+1;

116 if(!
¿nk
è
	`memıy
(
lše
,
¡r_lše
.
	`c_¡r
(),(
size
+1)*());

117 
	`MPI_Bÿ¡
(
lše
,
¡©ic_ÿ¡
<>(
size
)+1,
MPI_CHAR
,0,
wÜld
);

118  
çl£
;

119 
	}
}

123 
size_t
 
	gFeR—d”
::
	$g‘_lše_no
()

126 
	`MPI_Bÿ¡
(&
lše_no
,(
size_t
),
MPI_BYTE
,0,
wÜld
);

127  
lše_no
;

128 
	}
}

129 
	~<lim™s
>

133 
boŞ
 
	gFeR—d”
::
	$sk
(cÚ¡ 
n
)

135 if(!
¿nk
)

137 
i
=0;i<
n
 && !
f¡
.
	`eof
();i++)

138 
f¡
.
	`ignÜe
(
¡d
::
num”ic_lim™s
<¡d::
¡»amsize
>::
	`max
(),'\n');

139 
fšished
=
f¡
.
	`eof
();

141 
	`MPI_Bÿ¡
(&
fšished
,1,
MPI_BYTE
,0,
wÜld
);

142  
fšished
;

143 
	}
}

156 
size_t
 
	gFeR—d”
::
	$hash_»mov”
(*& 
lše
)

158 * 
Ï¡
;

159 
Ï¡
=
lše
;

160 *
Ï¡
!='#' && *last!='\0' && *last!='\n')

161 
Ï¡
++;

162 *
Ï¡
='\0';

164 * 
os
=
lše
;

165 * 
jpos
=
lše
;

166 * 
kpos
=
lše
;

167 
size_t
 
Çrgs
=0;

168 
os
!=
Ï¡
)

170 
	`is¥aû
(*
os
è&& ipos!=
Ï¡
)

171 
os
++;

172 if(
os
==
Ï¡
)

174 if(
kpos
!=
lše
)

175 
kpos
--;

176 *
kpos
='\0';

180 
jpos
=
os
;

181 
Çrgs
++;

183 !
	`is¥aû
(*
os
è&& ipos!=
Ï¡
)

184 
os
++;

185 
	`memmove
(
kpos
,
jpos
,
os
-jpos);

186 if(
os
==
Ï¡
)

189 
kpos
+=
os
-
jpos
;

190 *
kpos
=' ';

191 
kpos
++;

194  
Çrgs
;

195 
	}
}

208 
size_t
 
	gFeR—d”
::
	$·r£_lše
(* 
os
,**& 
¬gs
,
size_t
& 
¬gs_ıùy
)

210 * 
Ï¡
;

211 
Ï¡
=
os
;

212 *
Ï¡
!='#' && *last!='\0' && *last!='\n')

213 
Ï¡
++;

214 *
Ï¡
='\0';

217 
size_t
 
Çrgs
=0;

218 
os
!=
Ï¡
)

220 
	`is¥aû
(*
os
è&& ipos!=
Ï¡
)

221 
os
++;

222 if(
os
==
Ï¡
)

225 if(
Çrgs
+1>
¬gs_ıùy
)

227 ** 
¬gs_
=
Ãw
 *[
Çrgs
+1];

228 
	`memıy
(
¬gs_
,
¬gs
,
Çrgs
*(*));

229 
d–‘e
 [] 
¬gs
;

230 
¬gs
=
¬gs_
;

231 
¬gs_ıùy
++;

233 
¬gs
[
Çrgs
]=
os
;

234 
Çrgs
++;

236 !
	`is¥aû
(*
os
è&& ipos!=
Ï¡
)

237 
os
++;

238 if(
os
==
Ï¡
)

240 *
os
='\0';

241 
os
++;

244  
Çrgs
;

245 
	}
}

258 
size_t
 
	gFeR—d”
::
	$cÚÿ‹Ç‹
(
size_t
 
Çrgs
,** 
¬gs


259 ,*& 
lše
)

261 
size_t
 
Êgth
=0;

262 
size_t
 
pos
=0;

263 
i
=0;i<
Çrgs
;i++)

264 
Êgth
+=
	`¡¾’
(
¬gs
[
i
]);

266 
Êgth
+=
Çrgs
;

267 
lše
=
Ãw
 [
Êgth
];

268 
i
=0;i<
Çrgs
;i++)

270 
Êgth
=
	`¡¾’
(
¬gs
[
i
]);

271 
j
=0;j<
Êgth
;j++)

273 
lše
[
pos
]=
¬gs
[
i
][
j
];

274 
pos
++;

277 if(
i
!=
Çrgs
-1)

279 
lše
[
pos
]=' ';

280 
pos
++;

284 
lše
[
pos
]='\0';

285 
pos
++;

288  
Êgth
;

289 
	}
}

	@import.h

1 #iâdeà
__MAPP__impÜt__


2 
	#__MAPP__impÜt__


	)

3 
	~<mpi.h
>

4 
Çme¥aû
 
	gMAPP_NS


6 şas 
	cImpÜt


8 
	g´iv©e
:

9 
´Ùeùed
:

10 
MPI_Comm
& 
wÜld
;

11 
	gpublic
:

12 
ImpÜt
(
MPI_Comm
&);

13 
	gvœtu®
 ~
ImpÜt
();

17 
	~<f¡»am
>

18 
Çme¥aû
 
	gMAPP_NS


20 şas 
	cFeR—d”


22 
	g´iv©e
:

23 
¡d
::
if¡»am
 
f¡
;

24 
	g¡d
::
¡ršg
 
¡r_lše
;

25 
MPI_Comm
 
	gwÜld
;

26 cÚ¡ 
	g¿nk
;

27 
size_t
 
	glše_no
;

28 
	g´Ùeùed
:

29 
public
:

30 * 
fe
;

31 
boŞ
 
	gfšished
;

33 
FeR—d”
(
şass
 
CommuniÿtiÚ
*&,const *);

34 
FeR—d”
(
şass
 
CommuniÿtiÚ
*&,cÚ¡ 
¡d
::
¡ršg
);

35 
FeR—d”
(
MPI_Comm
,const *);

36 
FeR—d”
(
MPI_Comm
,cÚ¡ 
¡d
::
¡ršg
);

37 
FeR—d”
();

38 ~
FeR—d”
();

39 
boŞ
 
İ”©Ü
()(*&,
	gsize_t
&);

40 
boŞ
 
sk
(const );

41 
size_t
 
g‘_lše_no
();

43 
size_t
 
·r£_lše
(*,**&,size_t&);

44 
size_t
 
hash_»mov”
(*&);

45 
size_t
 
cÚÿ‹Ç‹
(size_t,**,*&);

	@import_cfg.cpp

5 
	~"–em’ts.h
"

6 
	~<¡dlib.h
>

7 
	~"impÜt_cfg.h
"

8 
	~"xm©h.h
"

9 
	~"memÜy.h
"

10 
	~"©oms_md.h
"

11 
	~"©oms_dmd.h
"

12 
	~"comm.h
"

13 
	~"´št.h
"

14 
	~"­i.h
"

15 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

19 
	gImpÜtCFG
::
	$ImpÜtCFG
(
MPI_Comm
& 
wÜld
):

20 
	$ImpÜt
(
wÜld
)

22 
	}
}

26 
ImpÜtCFG
::~
	$ImpÜtCFG
()

28 
	}
}

32 
ImpÜtCFG
::
	$»ad_h—d”
(
Atoms
* 
©oms
,
FeR—d”
& 
ä—d”
,*& 
lše
,
size_t
& 
lše_ıùy
)

34 
ty³0
 
basic_Ëngth
=1.0;

35 
ty³0
 
H0
[
__dim__
][__dim__];

36 
ty³0
 
‘a
[
__dim__
][__dim__];

37 
ty³0
 
Œns
[
__dim__
][__dim__];

38 
i
=0;i<
__dim__
;i++)

39 
j
=0;j<
__dim__
;j++)

40 
H0
[
i
][
j
]=
‘a
[i][j]=
Œns
[i][j]=0;

42 
i
=0;i<
__dim__
;i++)

43 
Œns
[
i
][i]=
H0
[i][i]=1.0;

45 
size_t
 
Çrgs
=0;

47 
R
=1.0;

48 
’Œy_couÁ
=6;

49 
v–_x¡
=
Œue
;

50 
is_ext
=
çl£
;

52 
boŞ
 
em±y
=
çl£
;

53 
icmp
,
jcmp
,
tm²o
;

54 
boŞ
 
h—d”_cm¶t
=
çl£
;

55 
ty³0
 
tmp
;

58 !
h—d”_cm¶t
 && !
	`ä—d”
(
lše
,
lše_ıùy
))

60 if(
ä—d”
.
fšished
) ;

61 
Çrgs
=
ä—d”
.
	`hash_»mov”
(
lše
);

63 if(
Çrgs
==0)

67 if(
	`ssÿnf
(
lše
," Numb” oà·¹işe ğ%d ",&
tm²o
)==1)

69 if(
tm²o
<0)

70 
throw
 
Pršt
::
	`v´štf
("Numb” oà·¹işe š % fshould bg»©”hª 0",
ä—d”
.
fe
);

71 if(
tm²o
==0)

72 
em±y
=
Œue
;

73 
©oms
->
Çtms
=
tm²o
;

77 if(
	`ssÿnf
(
lše
," A = %là",&
tmp
)==1)

79 if(
tmp
<=0.0)

80 
throw
 
Pršt
::
	`v´štf
("A iÀ% fshould bg»©”hª 0.0",
ä—d”
.
fe
);

81 
basic_Ëngth
=
tmp
;

84 if(
	`¡rcmp
(
lše
,".NO_VELOCITY.")==0)

86 if(!
is_ext
)

88 
v–_x¡
=
çl£
;

89 
is_ext
=
Œue
;

94 if(
	`ssÿnf
(
lše
,"ƒÁry_couÁ = %d ",&
tm²o
)==1)

96 
mšcomp
=
__dim__
+(
v–_x¡
?__dim__:0);

97 if(
tm²o
<
mšcomp
)

98 
throw
 
Pršt
::
	`v´štf
("’Œy_couÁ iÀ% should‡ˆËa¡ bequ®Ø%d",
ä—d”
.
fe
,
mšcomp
);

99 
’Œy_couÁ
=
tm²o
;

100 
is_ext
=
Œue
;

104 if(
	`ssÿnf
(
lše
," R = %là%* ",&
tmp
)==1)

106 
R
=
tmp
;

110 if(
	`ssÿnf
(
lše
,"‡uxŸry [ %d ] = %* [ %* ]",&
icmp
)==1)

112 if(!
is_ext
)

113 
throw
 
Pršt
::
	`v´štf
("auxŸry [ ... ] = ... mu¡ comaá”ƒÁry_couÁ = ... iÀ%s",
ä—d”
.
fe
);

115 
mšcomp
=
__dim__
+(
v–_x¡
?__dim__:0);

116 if(
icmp
+
mšcomp
+1>
’Œy_couÁ
)

117 
throw
 
Pršt
::
	`v´štf
("wrÚg compÚ’ˆš % ffÜ‡uxŸry[%d], %d+%d+1 >ƒÁry_couÁ",
ä—d”
.
fe
,
icmp
,
mšcomp
,icmp);

121 if(
	`ssÿnf
(
lše
," T¿nsfÜm ( %d , %d ) = %là",&
icmp
,&
jcmp
,&
tmp
)==3)

123 if(
icmp
<1 || icmp>
__dim__
 || 
jcmp
<1 || jcmp>__dim__)

124 
throw
 
Pršt
::
	`v´štf
("wrÚg compÚ’ˆš % ffÜ T¿nsfÜm(%d,%d)",
ä—d”
.
fe
,
icmp
,
jcmp
);

125 
Œns
[
icmp
-1][
jcmp
-1]=
tmp
;

128 if(
	`ssÿnf
(
lše
," H0 ( %d , %d ) = %là %*s",&
icmp
,&
jcmp
,&
tmp
)==3)

130 if(
icmp
<1 || icmp>
__dim__
 || 
jcmp
<1 || jcmp>__dim__)

131 
throw
 
Pršt
::
	`v´štf
("wrÚg compÚ’ˆš % ffÜ H0(%d,%d)",
ä—d”
.
fe
,
icmp
,
jcmp
);

132 
H0
[
icmp
-1][
jcmp
-1]=
tmp
;

136 if(
	`ssÿnf
(
lše
,"ƒ ( %d , %d ) = %là",&
icmp
,&
jcmp
,&
tmp
)==3)

138 if(
icmp
<1 || icmp>
__dim__
 || 
jcmp
<1 || jcmp>__dim__)

139 
throw
 
Pršt
::
	`v´štf
("wrÚg compÚ’ˆš % ffÜƒ(%d,%d)",
ä—d”
.
fe
,
icmp
,
jcmp
);

140 
‘a
[
icmp
-1][
jcmp
-1]=
tmp
;

144 if((
Çrgs
==8 && !
is_ext
) || (nargs==1 && is_ext))

146 
h—d”_cm¶t
=
Œue
;

150 
throw
 
Pršt
::
	`v´štf
("šv®id†šš % fe: %s",
ä—d”
.
fe
,
lše
);

154 if(
ä—d”
.
fšished
 && 
em±y
)

155 
h—d”_cm¶t
=
Œue
;

157 if(!
h—d”_cm¶t
)

158 
throw
 
Pršt
::
	`v´štf
("f% ’ded uÃx³ùedly",
ä—d”
.
fe
);

162 
ty³0
 
H_x
[
__dim__
][__dim__];

163 
ty³0
 
H_x_d
[
__dim__
][__dim__];

164 
i
=0;i<
__dim__
;i++)

165 
j
=0;j<
__dim__
;j++)

166 
H_x_d
[
i
][
j
]=0.0;

168 
i
=0;i<
__dim__
;i++)

169 
j
=0;j<
__dim__
;j++)

171 
H_x
[
i
][
j
]=0.0;

172 
k
=0;k<
__dim__
;k++)

173 
H_x
[
i
][
j
]+=
H0
[i][
k
]*
Œns
[k][j];

176 
boŞ
 
chk
=
Œue
;

177 
i
=0;i<
__dim__
 && 
chk
;i++)

178 
j
=0;j<
__dim__
 && 
chk
;j++)

179 if(
‘a
[
i
][
j
]!=0.0)

180 
chk
=
çl£
;

181 if(!
chk
)

183 
i
=0;i<
__dim__
;i++)

184 
j
=0;j<
__dim__
;j++)

185 
‘a
[
i
][
j
]*=2.0;

186 
i
=0;i<
__dim__
;i++)

187 
‘a
[
i
][i]++;

189 
ty³0
 
‘a_sq
[
__dim__
][__dim__];

191 if(
XM©h
::
	`Msq¹
(
‘a
,
‘a_sq
)==0)

192 
throw
 
Pršt
::
	`v´štf
("‘¨š % should bpos™ivdefš™e",
ä—d”
.
fe
);

194 
i
=0;i<
__dim__
;i++)

195 
j
=0;j<
__dim__
;j++)

196 
H0
[
i
][
j
]=
H_x
[i][j];

198 
i
=0;i<
__dim__
;i++)

199 
j
=0;j<
__dim__
;j++)

201 
H_x
[
i
][
j
]=0.0;

202 
k
=0;k<
__dim__
;k++)

203 
H_x
[
i
][
j
]+=
H0
[i][
k
]*
‘a_sq
[k][j];

207 
Algeb¿
::
	`MSQ_2_MLT
(
H_x
,
H0
);

208 
©oms
->
comm
.
	`grid
(
H0
);

209 
i
=0;i<
__dim__
;i++)

210 
j
=0;j<
__dim__
;j++)

211 
©oms
->
H
[
i
][
j
]=
H0
[i][j]*
basic_Ëngth
;

213 
©oms
->
	`upd©e_H
();

214 
	}
}

218 
	gImpÜtCFG
::
	$»ad_body_ext
(
Atoms
* 
©oms
,
FeR—d”
& 
ä—d”
,*& 
lše
,
size_t
& 
lše_ıùy
)

220 
	`ty³0
 (&
s_lo
)[
__dim__
]=
©oms
->
comm
.s_lo;

221 
	`ty³0
 (&
s_hi
)[
__dim__
]=
©oms
->
comm
.s_hi;

222 autØ
b–Úg
=

223 [&
s_lo
,
s_hi
](
	`ty³0
 (&
s
)[
__dim__
])->
boŞ


225 
i
=0;i<
__dim__
;i++)

226 if(
s
[
i
]<
s_lo
[i] || s[i] >=
s_hi
[i])

227  
çl£
;

228  
Œue
;

231 
by‹
* 
buff
=
Ãw
 by‹[()+(
–em_ty³
)+(
ty³0
)*
’Œy_couÁ
];

232 
vec_li¡
[0]=
©oms
->
id
;

233 
vec_li¡
[1]=
Ãw
 
Vec
<
–em_ty³
>(
©oms
,1);

234 
vec_li¡
[2]=
©oms
->
x
;

235 
vec_li¡
[3]=
NULL
;

236 
nvecs
=3;

237 if(
’Œy_couÁ
-
__dim__
)

238 
vec_li¡
[
nvecs
++]=
Ãw
 
Vec
<
ty³0
>(
©oms
,
’Œy_couÁ
-
__dim__
);

240 ** 
¬gs
=
NULL
;

241 
size_t
 
¬gs_ıùy
=0;

242 
size_t
 
Çrgs
;

244 
ty³0
 
s
[
__dim__
];

245 
by‹
* 
__buff
;

246 
–em_ty³
 
›Ëm
=0;

247 
ty³0
 
mass
=0.0;

248 
cu¼_id
=0;

250 
boŞ
 
mass_æag
=
çl£
;

251 
boŞ
 
–em_š™
=
çl£
;

254 !
ä—d”
.
fšished
)

256 
Çrgs
=
ä—d”
.
	`·r£_lše
(
lše
,
¬gs
,
¬gs_ıùy
);

257 if(
Çrgs
==0)

259 
	`ä—d”
(
lše
,
lše_ıùy
);

262 if(
Çrgs
!=1 &&‚¬gs!=
’Œy_couÁ
)

264 
d–‘e
 [] 
buff
;

265 
d–‘e
 [] 
¬gs
;

266 
throw
 
Pršt
::
	`v´štf
("šv®id†šš % fe: %s",
ä—d”
.
fe
,
lše
);

269 if(
mass_æag
 && 
Çrgs
!=1)

271 
d–‘e
 [] 
buff
;

272 
d–‘e
 [] 
¬gs
;

273 
throw
 
Pršt
::
	`v´štf
("ex³ùed chemiÿÈsymbŞ oà–em’ˆaá” mas š %s",
ä—d”
.
fe
);

277 if(
Çrgs
==1)

279 if(!
mass_æag
)

281 
mass
=
	`©of
(
¬gs
[0]);

282 if(
mass
<=0.0)

284 
d–‘e
 [] 
buff
;

285 
d–‘e
 [] 
¬gs
;

286 
throw
 
Pršt
::
	`v´štf
("mas oà% % f(%lfèshould bg»©”hª 0.0",
¬gs
[0],
ä—d”
.
fe
,
lše
,
mass
);

288 
mass_æag
=
Œue
;

292 
Œy


294 
›Ëm
=
©oms
->
–em’ts
.
	`add_ty³
(
mass
,
¬gs
[0]);

296 
	`ÿtch
(* 
”r_msg
)

298 
d–‘e
 [] 
buff
;

299 
d–‘e
 [] 
¬gs
;

300 
throw
 
”r_msg
;

302 
mass_æag
=
çl£
;

303 
–em_š™
=
Œue
;

306 
	`ä—d”
(
lše
,
lše_ıùy
);

310 if(!
–em_š™
)

312 
d–‘e
 [] 
buff
;

313 
d–‘e
 [] 
¬gs
;

314 
throw
 
Pršt
::
	`v´štf
("lš% š f% come befÜªyƒËm’ˆwa defšed",
lše
,
ä—d”
.
fe
);

317 
i
=0;i<
__dim__
;i++)

319 
s
[
i
]=
	`©of
(
¬gs
[i]);

321 
s
[
i
]>=1.0)

322 
s
[
i
]--;

323 
s
[
i
]<0.0)

324 
s
[
i
]++;

327 if(!
	`b–Úg
(
s
))

329 
cu¼_id
++;

330 
	`ä—d”
(
lše
,
lše_ıùy
);

335 
__buff
=
buff
;

336 
	`memıy
(
__buff
,&
cu¼_id
,());

337 
__buff
+=();

338 
	`memıy
(
__buff
,&
›Ëm
,(
–em_ty³
));

339 
__buff
+=(
–em_ty³
);

341 
	`memıy
(
__buff
,
s
,(
ty³0
)*
__dim__
);

342 
__buff
+=(
ty³0
)*
__dim__
;

344 
i
=
__dim__
; i<
’Œy_couÁ
;i++)

346 
ty³0
 
v
=
	`©of
(
¬gs
[
i
]);

347 
	`memıy
(
__buff
,&
v
,(
ty³0
));

348 
__buff
+=(
ty³0
);

351 
©oms
->
	`š£¹
(
buff
,
vec_li¡
,
nvecs
,1);

353 
cu¼_id
++;

354 
	`ä—d”
(
lše
,
lše_ıùy
);

357 
d–‘e
 [] 
buff
;

358 
d–‘e
 [] 
¬gs
;

360 
Çtms
;

361 
	`MPI_AÎ»duû
(&(
©oms
->
Çtms_lş
),&
Çtms
,1,
MPI_INT
,
MPI_SUM
,
wÜld
);

362 if(
Çtms
!=
©oms
->natms)

363 
throw
 
Pršt
::
	`v´štf
("ex³ùed %d‚©ms_lş iÀ% buˆ»ad %d",
©oms
->
Çtms
,
ä—d”
.
fe
,natms);

364 
	}
}

368 
	gImpÜtCFG
::
	$»ad_body_¡d
(
Atoms
* 
©oms
,
FeR—d”
& 
ä—d”
,*& 
lše
,
size_t
& 
lše_ıùy
)

370 
	`ty³0
 (&
s_lo
)[
__dim__
]=
©oms
->
comm
.s_lo;

371 
	`ty³0
 (&
s_hi
)[
__dim__
]=
©oms
->
comm
.s_hi;

372 autØ
b–Úg
=

373 [&
s_lo
,
s_hi
](
	`ty³0
 (&
s
)[
__dim__
])->
boŞ


375 
i
=0;i<
__dim__
;i++)

376 if(
s
[
i
]<
s_lo
[i] || s[i] >=
s_hi
[i])

377  
çl£
;

378  
Œue
;

381 
by‹
* 
buff
=
Ãw
 by‹[()+(
–em_ty³
)+(
ty³0
)*
’Œy_couÁ
];

382 
vec_li¡
[0]=
©oms
->
id
;

383 
vec_li¡
[1]=
Ãw
 
Vec
<
–em_ty³
>(
©oms
,1);

384 
vec_li¡
[2]=
©oms
->
x
;

385 
vec_li¡
[3]=
NULL
;

386 
nvecs
=3;

387 if(
’Œy_couÁ
-
__dim__
)

388 
vec_li¡
[
nvecs
++]=
Ãw
 
Vec
<
ty³0
>(
©oms
,
’Œy_couÁ
-
__dim__
);

390 ** 
¬gs
=
NULL
;

391 
size_t
 
¬gs_ıùy
=0;

392 
size_t
 
Çrgs
;

394 
ty³0
 
s
[
__dim__
];

395 
by‹
* 
__buff
;

396 
–em_ty³
 
›Ëm
=0;

397 
ty³0
 
mass
=0.0;

398 
cu¼_id
=0;

401 !
ä—d”
.
fšished
)

403 
Çrgs
=
ä—d”
.
	`·r£_lše
(
lše
,
¬gs
,
¬gs_ıùy
);

404 if(
Çrgs
==0)

406 
	`ä—d”
(
lše
,
lše_ıùy
);

410 if(
Çrgs
!=8)

412 
d–‘e
 [] 
buff
;

413 
d–‘e
 [] 
¬gs
;

414 
throw
 
Pršt
::
	`v´štf
("šv®id†šš % fe: %s",
ä—d”
.
fe
,
lše
);

417 
mass
=
	`©of
(
¬gs
[0]);

418 if(
mass
<=0.0)

420 
d–‘e
 [] 
buff
;

421 
d–‘e
 [] 
¬gs
;

422 
throw
 
Pršt
::
	`v´štf
("mas oà% % f(%lfèshould bg»©”hª 0.0",
¬gs
[0],
ä—d”
.
fe
,
lše
,
mass
);

425 
Œy


427 
›Ëm
=
©oms
->
–em’ts
.
	`add_ty³
(
mass
,
¬gs
[1]);

429 
	`ÿtch
(* 
”r_msg
)

431 
d–‘e
 [] 
buff
;

432 
d–‘e
 [] 
¬gs
;

433 
throw
 
”r_msg
;

437 
i
=0;i<
__dim__
;i++)

439 
s
[
i
]=
	`©of
(
¬gs
[i+2]);

441 
s
[
i
]>=1.0)

442 
s
[
i
]--;

443 
s
[
i
]<0.0)

444 
s
[
i
]++;

447 if(!
	`b–Úg
(
s
))

449 
cu¼_id
++;

450 
	`ä—d”
(
lše
,
lše_ıùy
);

454 
__buff
=
buff
;

455 
	`memıy
(
__buff
,&
cu¼_id
,());

456 
__buff
+=();

457 
	`memıy
(
__buff
,&
›Ëm
,(
–em_ty³
));

458 
__buff
+=(
–em_ty³
);

460 
	`memıy
(
__buff
,
s
,(
ty³0
)*
__dim__
);

461 
__buff
+=(
ty³0
)*
__dim__
;

463 
i
=2+
__dim__
; i<8;i++)

465 
ty³0
 
v
=
	`©of
(
¬gs
[
i
]);

466 
	`memıy
(
__buff
,&
v
,(
ty³0
));

467 
__buff
+=(
ty³0
);

470 
©oms
->
	`š£¹
(
buff
,
vec_li¡
,
nvecs
,1);

472 
cu¼_id
++;

473 
	`ä—d”
(
lše
,
lše_ıùy
);

476 
d–‘e
 [] 
buff
;

477 
d–‘e
 [] 
¬gs
;

479 
Çtms
;

480 
	`MPI_AÎ»duû
(&(
©oms
->
Çtms_lş
),&
Çtms
,1,
MPI_INT
,
MPI_SUM
,
wÜld
);

481 if(
Çtms
!=
©oms
->natms)

482 
throw
 
Pršt
::
	`v´štf
("ex³ùed %d‚©ms_lş iÀ% buˆ»ad %d",
©oms
->
Çtms
,
ä—d”
.
fe
,natms);

483 
	}
}

487 
	gImpÜtCFGMD
::
	$ImpÜtCFGMD
(
MPI_Comm
& 
wÜld
):

488 
	$ImpÜtCFG
(
wÜld
)

490 
	}
}

494 
ImpÜtCFGMD
::~
	$ImpÜtCFGMD
()

496 
	}
}

500 
AtomsMD
* 
ImpÜtCFGMD
::
	$İ”©Ü
()(cÚ¡ * 
fe
)

502 
FeR—d”
* 
pä—d”
;

503 
Œy


505 
pä—d”
=
Ãw
 
	`FeR—d”
(
wÜld
,
fe
);

507 
	`ÿtch
 (* 
”r_msg
)

509 
throw
 
”r_msg
;

512 
Atoms
* 
©oms
=
Ãw
 
	`Atoms
(
wÜld
);

513 * 
lše
=
NULL
;

514 
size_t
 
lše_ıùy
=
MAXCHAR
;

515 if(
lše_ıùy
è
lše
=
Ãw
 [line_cpcty];

517 
Œy


519 
	`»ad_h—d”
(
©oms
,*
pä—d”
,
lše
,
lše_ıùy
);

521 
	`ÿtch
(* 
”r_msg
)

523 
d–‘e
 [] 
lše
;

524 
d–‘e
 
pä—d”
;

525 
d–‘e
 
©oms
;

526 
throw
 
”r_msg
;

529 if(
pä—d”
->
fšished
)

531 
d–‘e
 
pä—d”
;

532 
d–‘e
 [] 
lše
;

533 
AtomsMD
* 
©oms_md
=
Ãw
 
	`AtomsMD
(
wÜld
);

534 *
©oms_md
=*
©oms
;

535 
d–‘e
 
©oms
;

536  
©oms_md
;

539 
Œy


541 if(
is_ext
)

542 
	`»ad_body_ext
(
©oms
,*
pä—d”
,
lše
,
lše_ıùy
);

544 
	`»ad_body_¡d
(
©oms
,*
pä—d”
,
lše
,
lše_ıùy
);

547 
	`ÿtch
(* 
”r_msg
)

549 
d–‘e
 [] 
lše
;

550 
d–‘e
 
pä—d”
;

551 
d–‘e
 
©oms
;

552 
throw
 
”r_msg
;

555 
d–‘e
 
pä—d”
;

556 
d–‘e
 [] 
lše
;

559 
AtomsMD
* 
©oms_md
=
Ãw
 
	`AtomsMD
(
wÜld
);

560 *
©oms_md
=*
©oms
;

561 
	`memıy
(
©oms_md
->
–em
->
	`begš
(),
vec_li¡
[1]->begš(),
©oms
->
Çtms_lş
*(
–em_ty³
));

562 
d–‘e
 
vec_li¡
[1];

563 
vec_li¡
[1]=
NULL
;

564 if(
v–_x¡
)

566 
©oms_md
->
x_d
->
	`fl
();

567 
	`memıy
(
©oms_md
->
x_d
->
	`begš
(),
vec_li¡
[3]->begš(),
©oms
->
Çtms_lş
*
__dim__
*(
ty³0
));

568 
ty³0
* 
__x_d
=
©oms_md
->
x_d
->
	`begš
();

569 
ty³0
* 
___x_d
=
»š‹½»t_ÿ¡
<ty³0*>(
vec_li¡
[3]->
	`begš
());

570 
vec_dim
=
vec_li¡
[3]->
dim
;

571 
i
=0;i<
©oms
->
Çtms_lş
;i++)

573 
	`memıy
(
__x_d
,
___x_d
,
__dim__
*(
ty³0
));

574 
__x_d
+=
__dim__
;

575 
___x_d
+=
vec_dim
;

580 
ty³0
 
M
[
__dim__
][__dim__];

581 
i
=0;i<
__dim__
;i++)

582 
j
=0;j<
__dim__
;j++)

583 
M
[
i
][
j
]=
R
*
©oms
->
H
[i][j];

585 
ty³0
* 
x_d
=
©oms_md
->x_d->
	`begš
();

586 
Çtms_lş
=
©oms
->natms_lcl;

587 
i
=0;i<
Çtms_lş
;i++,
x_d
+=
__dim__
)

588 
Algeb¿
::
	`V_mul_MLT
(
x_d
,
M
,x_d);

591 
d–‘e
 
vec_li¡
[3];

592 
vec_li¡
[3]=
NULL
;

594 
d–‘e
 
©oms
;

595 
©oms_md
->
	`s2x_lş
();

597  
©oms_md
;

598 
	}
}

602 
	gImpÜtCFGMD
::
	$ml_impÜt
(
PyM‘hodDef
& 
_m‘hods
)

604 
_m‘hods
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
 | 
METH_CLASS
;

605 
_m‘hods
.
ml_Çme
="import_cfg";

606 
_m‘hods
.
ml_doc
=
R
"---(

607 
	`impÜt
(
cfg_fe
)

609 
ImpÜts
 
cfg
 
fe
 
to
 :
py
:
şass
:`
m­p
.
md
.
©oms
`.

611 
This
 
is
 
a
 
funùiÚ
 
th©
 i 
u£d
 
to
 
impÜt
‡ 
desœed
 
sy¡em
 
´e£Áed
 
š
 `
	`cfg
 (
Atomeye
è<
h‰p
:

613 
P¬am‘”s


615 
cfg_fe
 : 
¡ršg


616 
·th
 
to
 
cfg
 
fe


618 
R‘uºs


620 
m­p
.
dmd
.
©oms


621 
objeù
 
th©
 
hŞds
 
the
 
cÚfigu¿tiÚ
 
of
h
sy¡em


624 
NÙes


626 
bÙh
 
cfg
 
	`fÜm©s
 (`
¡ªd¬d
 <
h‰p
:

630 
_m‘hods
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

631 [](
PyObjeù
* 
ty³
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

633 
FuncAPI
<
¡d
::
¡ršg
,
OP
<
MAPP_MPI
>> 
	`f
("cfg",{"cfg_file","mpi"});

634 
f
.
nİtiÚ®s
=1;

635 if(
	`f
(
¬gs
,
kwds
)==-1è 
NULL
;

637 
MPI_Comm
 
wÜld
=
MPI_COMM_WORLD
;

638 if(
f
.
v®
<1>().
ob
)

639 
wÜld
=
»š‹½»t_ÿ¡
<
MAPP_MPI
::
Objeù
*>(
f
.
v®
<1>().
ob
)->world;

641 
ImpÜtCFGMD
 
	`»ad
(
wÜld
);

642 
AtomsMD
* 
©oms
=
NULL
;

643 
Œy


645 
©oms
=
	`»ad
(
f
.
v®
<0>().
	`c_¡r
());

647 
	`ÿtch
 (* 
”r_msg
)

649 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,
”r_msg
);

650 
d–‘e
 [] 
”r_msg
;

651  
NULL
;

653 
PyObjeù
* 
İ
=
AtomsMD
::
Ty³Objeù
.
	`_®loc
(&AtomsMD::TypeObject,0);

654 
»š‹½»t_ÿ¡
<
AtomsMD
::
Objeù
*>(
İ
)->
©oms
=atoms;

655  
İ
;

657 
	}
}

661 
	gImpÜtCFGDMD
::
	$ImpÜtCFGDMD
(
MPI_Comm
& 
wÜld
):

662 
	$ImpÜtCFG
(
wÜld
)

664 
	}
}

668 
ImpÜtCFGDMD
::~
	$ImpÜtCFGDMD
()

670 
	}
}

674 
AtomsDMD
* 
ImpÜtCFGDMD
::
	$İ”©Ü
()(
N
,cÚ¡ * 
fe
)

676 
FeR—d”
* 
pä—d”
;

677 
Œy


679 
pä—d”
=
Ãw
 
	`FeR—d”
(
wÜld
,
fe
);

681 
	`ÿtch
 (* 
”r_msg
)

683 
throw
 
”r_msg
;

686 
Atoms
* 
©oms
=
Ãw
 
	`Atoms
(
wÜld
);

687 * 
lše
=
NULL
;

688 
size_t
 
lše_ıùy
=
MAXCHAR
;

689 if(
lše_ıùy
è
lše
=
Ãw
 [line_cpcty];

691 
Œy


693 
	`»ad_h—d”
(
©oms
,*
pä—d”
,
lše
,
lše_ıùy
);

695 
	`ÿtch
(* 
”r_msg
)

697 
d–‘e
 [] 
lše
;

698 
d–‘e
 
pä—d”
;

699 
d–‘e
 
©oms
;

700 
throw
 
”r_msg
;

703 if(
pä—d”
->
fšished
)

705 
d–‘e
 
pä—d”
;

706 
d–‘e
 [] 
lše
;

707 
AtomsDMD
* 
©oms_dmd
=
Ãw
 
	`AtomsDMD
(
wÜld
,0,
N
);

708 *
©oms_dmd
=*
©oms
;

709 
d–‘e
 
©oms
;

710  
©oms_dmd
;

714 if(!
is_ext
)

716 
d–‘e
 [] 
lše
;

717 
d–‘e
 
pä—d”
;

718 
d–‘e
 
©oms
;

719 
throw
 
Pršt
::
	`v´štf
("cannot„ead cfg standard file for dmd mode");

722 
Œy


724 
	`»ad_body_ext
(
©oms
,*
pä—d”
,
lše
,
lše_ıùy
);

726 
	`ÿtch
(* 
”r_msg
)

728 
d–‘e
 [] 
lše
;

729 
d–‘e
 
pä—d”
;

730 
d–‘e
 
©oms
;

731 
throw
 
”r_msg
;

734 
d–‘e
 
pä—d”
;

735 
d–‘e
 [] 
lše
;

738 
d–‘e
 
vec_li¡
[1];

739 
vec_li¡
[1]=
NULL
;

740 
ÃËms
=
¡©ic_ÿ¡
<>(
©oms
->
–em’ts
.nelems);

741 if(!
vec_li¡
[3] || vec_li¡[3]->
dim
<2*
ÃËms
)

743 
d–‘e
 
©oms
;

744 
throw
 
Pršt
::
	`v´štf
("values for c‡nd‡lpha of‡llƒlements should be…rovided forƒvery‡tom");

747 cÚ¡ 
vec_dim
=
vec_li¡
[3]->
dim
;

752 
ty³0
* 
®pha
=
dyÇmic_ÿ¡
<
Vec
<ty³0>*>(
vec_li¡
[3])->
	`begš
();

753 
ty³0
* 
c
=
®pha
+
ÃËms
;

756 
lş_”r
=0;

757 
max_ncmp_lş
=0,
__max_ncmp
=0;

758 
jcmp
;

759 
–em_ty³
 
__ÃËms
=
¡©ic_ÿ¡
<–em_ty³>(
ÃËms
);

760 
ty³0
 
__c_sum
;

761 
i
=0;i<
©oms
->
Çtms_lş
 && 
lş_”r
==0;i++,
®pha
+=
vec_dim
,
c
+=vec_dim)

763 
__max_ncmp
=0;

764 
jcmp
=0;

765 
__c_sum
=0.0;

766 
–em_ty³
 
j
=0;j<
__ÃËms
 && 
lş_”r
==0;j++)

768 if(
c
[
j
]>1.0 || (c[j]<0.0 && c[j]!=-1.0))

770 
lş_”r
=1;

774 if(
c
[
j
]!=-1.0 && 
®pha
[j]<0.0)

776 
lş_”r
=2;

780 if(
c
[
j
]==-1.0 && 
®pha
[j]<0.0)

781 
®pha
[
j
]=0.0;

782 if(
c
[
j
]!=-1.0)

784 
__c_sum
+=
c
[
j
];

785 
__max_ncmp
++;

789 
max_ncmp_lş
=
	`MAX
(max_ncmp_lş,
__max_ncmp
);

790 if(
__c_sum
>1.0è
lş_”r
=3;

793 
lş_”r0
=
lş_”r
==1?1:0;

794 
lş_”r1
=
lş_”r
==2?1:0;

795 
lş_”r2
=
lş_”r
==3?1:0;

796 
”r0
,
”r1
,
”r2
;

797 
	`MPI_AÎ»duû
(&
lş_”r0
,&
”r0
,1,
MPI_INT
,
MPI_MAX
,
wÜld
);

798 if(
”r0
)

800 
d–‘e
 
©oms
;

801 
throw
 
Pršt
::
	`v´štf
("all values of c should be greater orƒqualo 0.0‡nd†esshan orƒqualo 1.0, orƒqualo -1.0");

804 
	`MPI_AÎ»duû
(&
lş_”r1
,&
”r1
,1,
MPI_INT
,
MPI_MAX
,
wÜld
);

806 if(
”r1
)

808 
d–‘e
 
©oms
;

809 
throw
 
Pršt
::
	`v´štf
("all values of‡lpha correspondingo…resentƒlements (i.e. c!=-1.0) should be greaterhan 0.0");

812 
	`MPI_AÎ»duû
(&
lş_”r2
,&
”r2
,1,
MPI_INT
,
MPI_MAX
,
wÜld
);

813 if(
”r2
)

815 
d–‘e
 
©oms
;

816 
throw
 
Pršt
::
	`v´štf
("sum of…resentƒlements of one site should‚otƒxceed 1.0");

819 
c_dim
;

820 
	`MPI_AÎ»duû
(&
max_ncmp_lş
,&
c_dim
,1,
MPI_INT
,
MPI_MAX
,
wÜld
);

822 
AtomsDMD
* 
©oms_dmd
=
Ãw
 
	`AtomsDMD
(
wÜld
,
c_dim
,
N
);

823 *
©oms_dmd
=*
©oms
;

825 
®pha
=
dyÇmic_ÿ¡
<
Vec
<
ty³0
>*>(
vec_li¡
[3])->
	`begš
();

826 
c
=
®pha
+
ÃËms
;

827 
ty³0
* 
__®pha
=
©oms_dmd
->
®pha
->
	`begš
();

828 
ty³0
* 
__c
=
©oms_dmd
->
c
->
	`begš
();

829 
–em_ty³
* 
__–em
=
©oms_dmd
->
–em
->
	`begš
();

831 
ty³0
 
max_®pha_lş
=0.0;

832 
i
=0;i<
©oms
->
Çtms_lş
;i++,
®pha
+=
vec_dim
,
c
+=vec_dim,
__®pha
+=
c_dim
,
__c
+=c_dim,
__–em
+=c_dim)

834 
__max_ncmp
=0;

835 
jcmp
=0;

836 
–em_ty³
 
j
=0;j<
__ÃËms
;j++)

838 if(
c
[
j
]!=-1.0)

840 
__–em
[
__max_ncmp
]=
j
;

841 
__c
[
__max_ncmp
]=
c
[
j
];

842 
__®pha
[
__max_ncmp
]=
®pha
[
j
];

843 
max_®pha_lş
=
	`MAX
(
®pha
[
j
],max_alpha_lcl);

844 
__max_ncmp
++;

848 
j
=
__max_ncmp
;j<
c_dim
;j++)

850 
__–em
[
j
]=0;

851 
__c
[
j
]=-1.0;

852 
__®pha
[
j
]=0.0;

855 
	`MPI_AÎ»duû
(&
max_®pha_lş
,&
©oms_dmd
->
max_®pha
,1,
MPI_DOUBLE
,
MPI_MAX
,
wÜld
);

857 
d–‘e
 
vec_li¡
[3];

858 
d–‘e
 
©oms
;

860 
©oms_dmd
->
	`s2x_lş
();

861  
©oms_dmd
;

862 
	}
}

866 
	gImpÜtCFGDMD
::
	$ml_impÜt
(
PyM‘hodDef
& 
_m‘hods
)

868 
_m‘hods
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
 | 
METH_CLASS
;

869 
_m‘hods
.
ml_Çme
="import_cfg";

870 
_m‘hods
.
ml_doc
=
R
"---(

871 
	`impÜt
(
N
,
cfg_fe
)

873 
ImpÜts
 
cfg
 
fe
 
to
 :
py
:
şass
:`
m­p
.
dmd
.
©oms
`.

875 
This
 
is
 
a
 
funùiÚ
 
th©
 i 
u£d
 
to
 
impÜt
‡ 
desœed
 
sy¡em
 
´e£Áed
 
š
 `
	`cfg
 (
Atomeye
è<
h‰p
:

877 
P¬am‘”s


879 
N
 : 

880 
numb”
 
of
 
gaussŸn
 
quad¿u»
 
abscis§s


881 
cfg_fe
 : 
¡ršg


882 
·th
 
to
 
cfg
 
fe


884 
R‘uºs


886 
m­p
.
dmd
.
©oms


887 
objeù
 
th©
 
hŞds
 
the
 
cÚfigu¿tiÚ
 
of
h
sy¡em


889 
NÙes


892 
The
 
cfg
 
fÜm©
 
a
 
DMD
 
simuÏtiÚ
 
is
 
difã»Á
 
äom
‡ 
»guÏr
 cfg 
fe
 
¡ruùu»
. 
This
 i 
beÿu£
 
š
 
add™iÚ
 
to
 
givšg
 
the
 
pos™iÚ
 
of
 
ev”y
 
©om
 
Úe
 
Ãeds
Ø
¥ecify
h
³¹š’t
 
	`cŞÜs
 (:
m©h
:`
c
`è
ªd
 :m©h:`\
®pha
` 
v®ues
. 
Suµo£
 
th©
 
our
 simuÏtiÚ i 
cÚsi¡
 oà:m©h:`
n
` 
ty³s
 oà
©oms
. 
Th”efÜe
, 
—ch
 
s™e
/©om 
we
 
Ãed
Ø¥ecify :m©h:`3 + 2n` 
	`v®ues
 (:m©h:`3` pos™iÚ, :m©h:`n` :m©h:`\®pha`‡nd :m©h:`n` :m©h:`c`). 
FÜ
h
§me
 
»asÚ
 
Úly
 `
ex‹nded
 cfg <
h‰p
:

894 .. 
m©h
::

895 \
und”b¿û
{
s_x
\
quad
 
s_y
 \quad 
s_z
}
_
{\
‹xt
{
äaùiÚ®
 
coÜdš©es
}} \quad \
®pha_0
 \quad \
®pha_1
 \quad \
cdÙs
 \quad \
®pha_
{
n
-1} \quad 
c_0
 \quad 
c_1
 \quad \cdÙ \quad 
c_
{n-1}

897 
This
 
wl
 
ke
 
ÿ»
 
of
 
³r
 
©om
 
´İ”t›s
. 
It
 
»mašs
 
to
 
d‘”mše
 
the
 
–em’t
Ø
which
 
—ch
 oà:
m©h
:`
c
` 
ªd
 :m©h:`\
®pha
` 
compÚ’ts
 
»ãr
o. Thi 
is
h
§me
 
as
h
–em’ts
'…recedence order inhe file: :math:`\alpha_0`‡nd :math:`c_0`„efero firstƒlement‡ppearing inhe file, :math:`\alpha_1`‡nd :math:`c_1`o second‡nd so on. Also‚otehat if you…rovidehe…roperties of‡nƒlement morehan oneime onlyhe first‡ppreance would count.

899 
Som‘imes
 
u£r
 
š‹nds
 
to
 
»¡riù
 
a
 
·¹icuÏr
 
s™e
Ø
Úe
 
Ü
 
muÉË
 
–em’ts
, 
this
 
is
 
u£ful
 
¡udyšg
 
š‹r¡™Ÿl
 
diffusiÚ
. 
In
 
th©
 u£¸
mu¡
 
´ovide
 
the
 
v®ue
 :
m©h
:`-1.0` :m©h:`
c
` 
cÜ»¥Údšg
Ø
exşuded
 
s™es
.

901 
Exam¶es


904 
IrÚ
 
Hydrog’
 
mixtu»
, 
the
 
possib™y
 
of
 
exchªge
 
b‘w“n
 IrÚ 
s™es
 
ªd
 Hydrog’ s™e 
has
 
b“n
 
–emš©ed
. 
i
.
e
. IrÚ 
ÿÂÙ
 
move
 
to
 
hydrog’
 s™e ªd 
viû
 
v”§
::

906 
Numb”
 
of
 
·¹işes
 = 24

907 
A
 = 1.0 
	`Ang¡rom
 (
basic
 
Ëngth
-
sÿË
)

908 
	`H0
(1,1èğ2.472772 
A


909 
	`H0
(1,2èğ0.000000 
A


910 
	`H0
(1,3èğ0.000000 
A


911 
	`H0
(2,1èğ0.000000 
A


912 
	`H0
(2,2èğ4.038020 
A


913 
	`H0
(2,3èğ0.000000 
A


914 
	`H0
(3,1èğ0.000000 
A


915 
	`H0
(3,2èğ0.000000 
A


916 
	`H0
(3,3èğ6.994057 
A


917 .
NO_VELOCITY
.

918 
’Œy_couÁ
 = 7

919 
auxŸry
[0] = 
®pha_0
 [
»duûd
 
un™
]

920 
auxŸry
[1] = 
®pha_1
 [
»duûd
 
un™
]

921 
auxŸry
[2] = 
c_0
 [
»duûd
 
un™
]

922 
auxŸry
[3] = 
c_1
 [
»duûd
 
un™
]

924 
Fe


932 
H


952 
_m‘hods
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

953 [](
PyObjeù
* 
ty³
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

955 
FuncAPI
<,
¡d
::
¡ršg
,
OP
<
MAPP_MPI
>> 
	`f
("cfg",{"N","cfg_file","mpi"});

956 
f
.
nİtiÚ®s
=1;

957 
f
.
logics
<0>()[0]=
	`VLogics
("gt",1);

958 if(
	`f
(
¬gs
,
kwds
)==-1è 
NULL
;

960 
MPI_Comm
 
wÜld
=
MPI_COMM_WORLD
;

961 if(
f
.
v®
<2>().
ob
)

962 
wÜld
=
»š‹½»t_ÿ¡
<
MAPP_MPI
::
Objeù
*>(
f
.
v®
<2>().
ob
)->world;

964 
ImpÜtCFGDMD
 
	`»ad
(
wÜld
);

965 
AtomsDMD
* 
©oms
=
NULL
;

966 
Œy


968 
©oms
=
	`»ad
(
f
.
v®
<0>(),f.v®<1>().
	`c_¡r
());

970 
	`ÿtch
 (* 
”r_msg
)

972 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,
”r_msg
);

973 
d–‘e
 [] 
”r_msg
;

974  
NULL
;

976 
PyObjeù
* 
İ
=
AtomsDMD
::
Ty³Objeù
.
	`_®loc
(&AtomsDMD::TypeObject,0);

977 
»š‹½»t_ÿ¡
<
AtomsDMD
::
Objeù
*>(
İ
)->
©oms
=atoms;

978  
İ
;

980 
	}
}

	@import_cfg.h

1 #iâdeà
__MAPP__impÜt_cfg__


2 
	#__MAPP__impÜt_cfg__


	)

3 
	~"impÜt.h
"

4 
	~"glob®.h
"

5 
	~<¡dio.h
>

7 
PyM‘hodDef
 
	tPyM‘hodDef
;

8 
Çme¥aû
 
	gMAPP_NS


10 şas 
	cImpÜtCFG
 : 
public
 
ImpÜt


12 
´iv©e
:

13 
´Ùeùed
:

16 
ty³0
 
R
;

17 
	g’Œy_couÁ
;

18 
boŞ
 
	gis_ext
;

19 
boŞ
 
	gv–_x¡
;

21 
şass
 
vec
* 
	gvec_li¡
[4];

22 
	gnvecs
;

24 
»ad_h—d”
(
şass
 
Atoms
*,
FeR—d”
&,*&,
size_t
&);

25 
»ad_body_ext
(
şass
 
Atoms
*,
FeR—d”
&,*&,
size_t
&);

26 
»ad_body_¡d
(
şass
 
Atoms
*,
FeR—d”
&,*&,
size_t
&);

27 
	gpublic
:

28 
ImpÜtCFG
(
MPI_Comm
&);

29 ~
ImpÜtCFG
();

33 
Çme¥aû
 
	gMAPP_NS


35 şas 
	cImpÜtCFGMD
 : 
public
 
ImpÜtCFG


37 
´iv©e
:

38 
´Ùeùed
:

39 
public
:

40 
ImpÜtCFGMD
(
MPI_Comm
&);

41 ~
ImpÜtCFGMD
();

42 
şass
 
AtomsMD
* 
İ”©Ü
()(const *);

43 
ml_impÜt
(
PyM‘hodDef
&);

47 
Çme¥aû
 
	gMAPP_NS


49 şas 
	cImpÜtCFGDMD
 : 
public
 
ImpÜtCFG


51 
´iv©e
:

52 
´Ùeùed
:

53 
public
:

54 
ImpÜtCFGDMD
(
MPI_Comm
&);

55 ~
ImpÜtCFGDMD
();

56 
şass
 
AtomsDMD
* 
İ”©Ü
()(,const *);

57 
ml_impÜt
(
PyM‘hodDef
&);

	@import_eam.cpp

1 
	~"impÜt_—m.h
"

2 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

6 
ty³0
 
	gImpÜtEAM
::
	$š‹½Ş©e
(
ty³0
* 
¬r
,
size_t
 
n
,ty³0 
p
,size_ˆ
k
)

8 
ty³0
 
cÛf0
,
cÛf1
,
cÛf2
,
cÛf3
,
tmp
;

9 
cÛf0
=
¬r
[
k
];

11 if(
k
==0)

13 
cÛf1
=
¬r
[1]-arr[0];

14 
tmp
=0.5*(
¬r
[2]-arr[0]);

15 
cÛf2
=(-
¬r
[0]+2.0*arr[1]-arr[2])/2.0;

16 
cÛf3
=(
¬r
[0]-2.0*arr[1]+arr[2])/2.0;

17  ((
cÛf3
*
p
+
cÛf2
)*p+
cÛf1
)*p+
cÛf0
;

19 if(
k
==1)

21 
cÛf1
=0.5*(
¬r
[2]-arr[0]);

22 
tmp
=((
¬r
[0]-arr[4])+8.0*(arr[3]-arr[1]))/12.0;

23 
cÛf2
=(11.0*
¬r
[0]-28.0*arr[1]+24.0*arr[2]-8.0*arr[3]+arr[4])/12.0;

24 
cÛf3
=(-5.0*
¬r
[0]+16.0*arr[1]-18.0*arr[2]+8.0*arr[3]-arr[4])/12.0;

25  ((
cÛf3
*
p
+
cÛf2
)*p+
cÛf1
)*p+
cÛf0
;

27 if(
k
==
n
-2)

29 
cÛf1
=0.5*(
¬r
[
n
-1]-arr[n-3]);

30 
tmp
=
¬r
[
n
-1]-arr[n-2];

31 
cÛf2
=
¬r
[
n
-3]-3.0*arr[n-2]+2.0*arr[n-1];

32 
cÛf3
=0.5*(-
¬r
[
n
-3]+3.0*arr[n-2]-2.0*arr[n-1]);

33  ((
cÛf3
*
p
+
cÛf2
)*p+
cÛf1
)*p+
cÛf0
;

35 if(
k
==
n
-1)

37 
cÛf1
=
¬r
[
n
-1]-arr[n-2];

38  
cÛf0
+
cÛf1
*
p
;

42 
cÛf1
=((
¬r
[
k
-2]-arr[k+2])+

43 8.0*(
¬r
[
k
+1]-arr[k-1]))/12.0;

44 
tmp
=((
¬r
[
k
-1]-arr[k+3])+

45 8.0*(
¬r
[
k
+2]-arr[k]))/12.0;

47 
cÛf2
=(-2.0*
¬r
[
k
-2]+15.0*arr[k-1]-28.0*arr[k]+21.0*arr[k+1]-6.0*arr[k+2])/12.0;

48 
cÛf3
=(
¬r
[
k
-2]-7.0*arr[k-1]+16.0*arr[k]-17.0*arr[k+1]+7.0*arr[k+2])/12.0;

49  ((
cÛf3
*
p
+
cÛf2
)*p+
cÛf1
)*p+
cÛf0
;

51 
	}
}

55 
	gImpÜtEAM
::
š‹½Ş©e
(
size_t
 
n
,
ty³0
 
d–
,ty³0(*
¥lše
)[4])

57 
	g¥lše
[0][1]=
¥lše
[1][0]-spline[0][0];

58 
	g¥lše
[1][1]=0.5*(
¥lše
[2][0]-spline[0][0]);

59 
	g¥lše
[
n
-2][1]=0.5*(
¥lše
[n-1][0]-spline[n-3][0]);

60 
	g¥lše
[
n
-1][1]=
¥lše
[n-1][0]-spline[n-2][0];

62 
size_t
 
	gi
=2;i<
	gn
-2;i++)

63 
	g¥lše
[
i
][1]=((
¥lše
[i-2][0]-spline[i+2][0])+

64 8.0*(
¥lše
[
i
+1][0]-spline[i-1][0]))/12.0;

66 
size_t
 
	gi
=0;i<
	gn
-1;i++)

68 
	g¥lše
[
i
][2]=3.0*(
¥lše
[i+1][0]-spline[i][0])-

69 2.0*
¥lše
[
i
][1]-spline[i+1][1];

70 
	g¥lše
[
i
][3]=
¥lše
[i][1]+spline[i+1][1]-

71 2.0*(
¥lše
[
i
+1][0]-spline[i][0]);

74 
	g¥lše
[
n
-1][2]=0.0;

75 
	g¥lše
[
n
-1][3]=0.0;

80 
	gImpÜtEAM
::
š‹½Ş©e
(
size_t
 
n
,
ty³0
 
d–
,ty³0(*
¥lše
)[5])

82 
	g¥lše
[0][1]=
¥lše
[1][0]-spline[0][0];

83 
	g¥lše
[1][1]=0.5*(
¥lše
[2][0]-spline[0][0]);

84 
	g¥lše
[
n
-2][1]=0.5*(
¥lše
[n-1][0]-spline[n-3][0]);

85 
	g¥lše
[
n
-1][1]=
¥lše
[n-1][0]-spline[n-2][0];

87 
size_t
 
	gi
=2;i<
	gn
-2;i++)

88 
	g¥lše
[
i
][1]=((
¥lše
[i-2][0]-spline[i+2][0])+

89 8.0*(
¥lše
[
i
+1][0]-spline[i-1][0]))/12.0;

91 
size_t
 
	gi
=0;i<
	gn
-1;i++)

93 
	g¥lše
[
i
][2]=3.0*(
¥lše
[i+1][0]-spline[i][0])-

94 2.0*
¥lše
[
i
][1]-spline[i+1][1];

95 
	g¥lše
[
i
][3]=
¥lše
[i][1]+spline[i+1][1]-

96 2.0*(
¥lše
[
i
+1][0]-spline[i][0]);

99 
	g¥lše
[
n
-1][2]=0.0;

100 
	g¥lše
[
n
-1][3]=0.0;

102 
size_t
 
	gi
=0;i<
	gn
-1;i++)

104 
	g¥lše
[
i
][4]=(
¥lše
[i+1][2]-spline[i][2])/6.0-0.5*spline[i][3];

106 
	g¥lše
[
n
-1][4]=0.0;

112 
	gImpÜtEAM
::
__š‹½Ş©e
(
size_t
 
n
,
ty³0
 
d–
,ty³0(*
¥lše
)[7])

114 
	g¥lše
[0][1]=
¥lše
[1][0]-spline[0][0];

115 
	g¥lše
[1][1]=0.5*(
¥lše
[2][0]-spline[0][0]);

116 
	g¥lše
[
n
-2][1]=0.5*(
¥lše
[n-1][0]-spline[n-3][0]);

117 
	g¥lše
[
n
-1][1]=
¥lše
[n-1][0]-spline[n-2][0];

119 
	gi
=2;i<
	gn
-2;i++)

120 
	g¥lše
[
i
][1]=((
¥lše
[i-2][0]-spline[i+2][0])+

121 8.0*(
¥lše
[
i
+1][0]-spline[i-1][0]))/12.0;

123 
size_t
 
	gi
=0;i<
	gn
-1;i++)

125 
	g¥lše
[
i
][2]=3.0*(
¥lše
[i+1][0]-spline[i][0])-

126 2.0*
¥lše
[
i
][1]-spline[i+1][1];

127 
	g¥lše
[
i
][3]=
¥lše
[i][1]+spline[i+1][1]-

128 2.0*(
¥lše
[
i
+1][0]-spline[i][0]);

131 
	g¥lše
[
n
-1][2]=0.0;

132 
	g¥lše
[
n
-1][3]=0.0;

133 
size_t
 
	gi
=0;i<
	gn
;i++)

135 
	g¥lše
[
i
][4]=
¥lše
[i][1]/
d–
;

136 
	g¥lše
[
i
][5]=2.0*
¥lše
[i][2]/
d–
;

137 
	g¥lše
[
i
][6]=3.0*
¥lše
[i][3]/
d–
;

143 
	gImpÜtEAM
::
	$»ad_doubË
(
ty³0
* 
buff
,
size_t
 
n
,
FeR—d”
& 
ä
,*& 
lše
,size_t& 
lše_ıùy
,**& 
¬gs
,size_t& 
¬gs_ıùy
)

145 
size_t
 
i
=0;

146 
size_t
 
Çrgs
;

148 
i
<
n
)

150 if(
	`ä
(
lše
,
lše_ıùy
))

151 
throw
 
Pršt
::
	`v´štf
("% f’ded imm©u»ly",
ä
.
fe
);

152 
Çrgs
=
ä
.
	`·r£_lše
(
lše
,
¬gs
,
¬gs_ıùy
);

153 if(
Çrgs
+
i
>
n
)

154 
throw
 
Pršt
::
	`v´štf
("% fha exŒ¨¬gum’ts",
ä
.
fe
);

156 
j
=0;j<
Çrgs
;j++)

157 
buff
[
i
++]=
	`©of
(
¬gs
[
j
]);

159 
	}
}

163 
	gImpÜtEAM
::
	$sk
(
size_t
 
n
,
FeR—d”
& 
ä
,*& 
lše
,size_t& 
lše_ıùy
)

165 
size_t
 
i
=0;

166 
size_t
 
Çrgs
;

168 
i
<
n
)

170 
	`ä
(
lše
,
lše_ıùy
);

171 if(
ä
.
fšished
è
throw
 
Pršt
::
	`v´štf
("% f’ded imm©u»ly",ä.
fe
);

172 
Çrgs
=
ä
.
	`hash_»mov”
(
lše
);

173 if(
Çrgs
+
i
>
n
)

174 
throw
 
Pršt
::
	`v´štf
("% fha exŒ¨¬gum’ts",
ä
.
fe
);

175 
i
+=
Çrgs
;

177 
	}
}

	@import_eam.h

1 #iâdeà
__MAPP__impÜt_—m__


2 
	#__MAPP__impÜt_—m__


	)

3 
	~"glob®.h
"

4 
	~"impÜt.h
"

5 
Çme¥aû
 
	gMAPP_NS


7 şas 
	cImpÜtEAM


9 
	g´iv©e
:

10 
»ad_doubË
(
ty³0
*,
size_t
,
FeR—d”
&,*&,size_t&,**&,size_t&);

11 
sk
(
size_t
,
FeR—d”
&,*&,size_t&);

12 
	g‹m¶©e
<
size_t
 
	gN0
>

13 
£t_cu‰off
(
size_t
,
ty³0
,size_t,ty³0(***)[
N0
],type0(***)[N0],type0**);

15 
	gpublic
:

19 
‹m¶©e
<
size_t
 
N0
,size_ˆ
	gN1
>

20 
funcæ
(
size_t
,
¡d
::
¡ršg
*,

21 
ty³0
&,ty³0&,
size_t
&,size_t&,

22 
ty³0
(***&)[
N0
],ty³0(***&)[N0],ty³0(**&)[
N1
],

23 
ty³0
**&,
MPI_Comm
=
MPI_COMM_WORLD
);

25 
	g‹m¶©e
<
size_t
 
	gN0
,size_ˆ
	gN1
>

26 
£tæ
(
size_t
,
¡d
::
¡ršg
*,std::string,

27 
ty³0
&,ty³0&,
size_t
&,size_t&,

28 
ty³0
(***&)[
N0
],ty³0(***&)[N0],ty³0(**&)[
N1
],

29 
ty³0
**&,
MPI_Comm
=
MPI_COMM_WORLD
);

31 
	g‹m¶©e
<
size_t
 
	gN0
,size_ˆ
	gN1
>

32 
fs
(
size_t
,
¡d
::
¡ršg
*,std::string,

33 
ty³0
&,ty³0&,
size_t
&,size_t&,

34 
ty³0
(***&)[
N0
],ty³0(***&)[N0],ty³0(**&)[
N1
],

35 
ty³0
**&,
MPI_Comm
=
MPI_COMM_WORLD
);

37 
ty³0
 
š‹½Ş©e
Ñy³0*,
size_t
,type0,size_t);

38 
š‹½Ş©e
(
size_t
,
ty³0
,type0(*)[4]);

39 
š‹½Ş©e
(
size_t
,
ty³0
,type0(*)[5]);

40 
__š‹½Ş©e
(
size_t
,
ty³0
,type0(*)[7]);

43 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

44 
	~"´št.h
"

48 
	g‹m¶©e
<
size_t
 
	gN0
>

49 
	gImpÜtEAM
::
£t_cu‰off
(
size_t
 
ÃËms
,
ty³0
 
dr
,size_ˆ
Ä
,ty³0(*** 
r_phi
)[
N0
],ty³0(*** 
rho
)[N0],ty³0** 
r_c
)

52 
size_t
 
	gi
=0;i<
	gÃËms
;i++)

53 
size_t
 
	gj
=0;j<
	gi
+1;j++)

55 
size_t
 
	g__Ä
=
Ä
-1;

56 (
	gr_phi
[
i
][
j
][
__Ä
][0]==0.0 && 
rho
[i][j][__nr][0]==0.0 &&„ho[j][i][__nr][0]==0.0) && __nr>=1)

57 
__Ä
--;

58 
	gr_c
[
i
][
j
]=
r_c
[j][i]=
¡©ic_ÿ¡
<
ty³0
>(
__Ä
)*
dr
;

64 
	g‹m¶©e
<
size_t
 
	gN0
,size_ˆ
	gN1
>

65 
	gImpÜtEAM
::
funcæ
(
size_t
 
nfes
,
¡d
::
¡ršg
* 
fes
,

66 
ty³0
& 
dr
,ty³0& 
drho
,
size_t
& 
Ä
,size_t& 
Äho
,

67 
ty³0
(***& 
r_phi
)[
N0
],ty³0(***& 
rho
)[N0],ty³0(**& 
F
)[
N1
],

68 
ty³0
**& 
r_c
,
MPI_Comm
 
wÜld
)

70 
FeR—d”
* 
	gäs
=
Ãw
 FeR—d”[
nfes
];

71 
size_t
 
	gi
=0;i<
	gnfes
;i++)

73 
	gŒy


75 
Ãw
 (
äs
+
i
è
FeR—d”
(
wÜld
,
fes
[i]);

77 
ÿtch
(* 
”r_msg
)

79 
	gd–‘e
 [] 
	gäs
;

80 
throw
 
	g”r_msg
;

84 
size_t
 
	gÃËms
=
nfes
;

85 
size_t
 
	gtÙ_Äs
=0,
	gtÙ_Ähos
=0;

86 
size_t
 
	gmax_Ä
=0,
	gmax_Äho
=0;

87 
size_t
 
	glše_ıùy
=0,
	g¬gs_ıùy
=0;

89 
size_t
* 
	gÄs
=
Ãw
 size_t[
ÃËms
];

90 
size_t
* 
	gÄhos
=
Ãw
 size_t[
ÃËms
];

91 
ty³0
* 
	gdrs
=
Ãw
y³0[
ÃËms
];

92 
ty³0
* 
	gdrhos
=
Ãw
y³0[
ÃËms
];

93 * 
	glše
=
NULL
;

94 
ty³0
* 
	gbuff
=
NULL
;

95 
ty³0
** 
	g__F
=
NULL
;

96 
ty³0
** 
	g__rho
=
NULL
;

97 
ty³0
** 
	g__Z
=
NULL
;

98 ** 
	g¬gs
=
NULL
;

100 autØ
	gd—Îoc
=[&
Äs
,&
Ähos
,&
drs
,&
drhos
,&
lše
,&
äs
,&
__F
,&
__rho
,&
__Z
,&
buff
,&
¬gs
]()->

102 
	gd–‘e
 [] 
	gäs
;

104 
	gd–‘e
 [] 
	gÄs
;

105 
	gd–‘e
 [] 
	gÄhos
;

106 
	gd–‘e
 [] 
	gdrs
;

107 
	gd–‘e
 [] 
	gdrhos
;

109 
	gd–‘e
 [] 
	glše
;

111 
	gd–‘e
 [] 
	gbuff
;

112 if(
	g__F
è
	gd–‘e
 [] *__F;

113 
	gd–‘e
 [] 
	g__F
;

114 if(
	g__rho
è
	gd–‘e
 [] *__rho;

115 
	gd–‘e
 [] 
	g__rho
;

116 if(
	g__Z
è
	gd–‘e
 [] *__Z;

117 
	gd–‘e
 [] 
	g__Z
;

118 
	gd–‘e
 [] 
	g¬gs
;

123 
size_t
 
	gi
=0;i<
	gÃËms
;i++)

126 if(
	gäs
[
i
].
sk
(2))

128 
d—Îoc
();

129 
throw
 
	gPršt
::
v´štf
("% f’ded imm©u»ly",
fes
[
i
].
c_¡r
());

133 if(
	gäs
[
i
](
	glše
,
	glše_ıùy
))

135 
d—Îoc
();

136 
throw
 
	gPršt
::
v´štf
("% f’ded imm©u»ly",
fes
[
i
].
c_¡r
());

140 
ty³0
 
	g__r_c
;

141 if(
ssÿnf
(
lše
," %zu %là%zu %là%lf",
Ähos
+
i
,
drhos
+i,
Äs
+i,
drs
+i,&
__r_c
)!=5)

143 
d—Îoc
();

144 
throw
 
	gPršt
::
v´štf
("šv®id†šš % fe: %s",
äs
[
i
].
fe
,
lše
);

148 if(
	gÄhos
[
i
]<5)

150 
d—Îoc
();

151 
throw
 
	gPršt
::
v´štf
("ÄhØš % fshould bÏrg”hª 5",
äs
[
i
].
fe
);

153 if(
	gÄs
[
i
]<5)

155 
d—Îoc
();

156 
throw
 
	gPršt
::
v´štf
("Ä iÀ% fshould bÏrg”hª 5",
äs
[
i
].
fe
);

158 if(
	gdrhos
[
i
]<=0.0)

160 
d—Îoc
();

161 
throw
 
	gPršt
::
v´štf
("drhØš % fshould bÏrg”hª 0.0",
äs
[
i
].
fe
);

163 if(
	gdrs
[
i
]<=0.0)

165 
d—Îoc
();

166 
throw
 
	gPršt
::
v´štf
("d¸š % fshould bÏrg”hª 0.0",
äs
[
i
].
fe
);

169 
	gtÙ_Äs
+=
Äs
[
i
];

170 
	gtÙ_Ähos
+=
Ähos
[
i
];

171 
	gmax_Ä
=
MAX
(
max_Ä
,
Äs
[
i
]);

172 
	gmax_Äho
=
MAX
(
max_Äho
,
Ähos
[
i
]);

176 
	gbuff
=
Ãw
 
ty³0
[2*
max_Ä
+
max_Äho
];

177 
	g__F
=
Ãw
 
ty³0
*[
ÃËms
];

178 *
	g__F
=
Ãw
 
ty³0
[
tÙ_Ähos
];

179 
	g__rho
=
Ãw
 
ty³0
*[
ÃËms
];

180 *
	g__rho
=
Ãw
 
ty³0
[
tÙ_Äs
];

181 
	g__Z
=
Ãw
 
ty³0
*[
ÃËms
];

182 *
	g__Z
=
Ãw
 
ty³0
[
tÙ_Äs
];

184 
size_t
 
	gi
=1;i<
	gÃËms
;i++)

186 
	g__F
[
i
]=
__F
[i-1]+
Ähos
[i-1];

187 
	g__rho
[
i
]=
__rho
[i-1]+
Äs
[i-1];

188 
	g__Z
[
i
]=
__Z
[i-1]+
Äs
[i-1];

194 
	gŒy


196 
size_t
 
	gi
=0;i<
	gÃËms
;i++)

198 
»ad_doubË
(
buff
,
Ähos
[
i
]+2*
Äs
[i],
äs
[i],
lše
,
lše_ıùy
,
¬gs
,
¬gs_ıùy
);

199 
memıy
(
__F
[
i
],
buff
,
Ähos
[i]*(
ty³0
));

200 
memıy
(
__Z
[
i
],
buff
+
Ähos
[i],
Äs
[i]*(
ty³0
));

201 
memıy
(
__rho
[
i
],
buff
+
Ähos
[i]+
Äs
[i],Äs[i]*(
ty³0
));

204 
ÿtch
 (* 
”r_msg
)

206 
d—Îoc
();

207 
throw
 
	g”r_msg
;

210 
ty³0
 
	gmaxr
=0.0;

211 
ty³0
 
	gmaxrho
=0.0;

212 
ty³0
 
	gmaxdr
=0.0;

213 
ty³0
 
	gmaxdrho
=0.0;

215 
size_t
 
	gi
=0;i<
	gÃËms
;i++)

217 
	gmaxr
=
MAX
(
maxr
,
¡©ic_ÿ¡
<
ty³0
>(
Äs
[
i
]-1)*
drs
[i]);

218 
	gmaxrho
=
MAX
(
maxrho
,
¡©ic_ÿ¡
<
ty³0
>(
Ähos
[
i
]-1)*
drhos
[i]);

219 
	gmaxdr
=
MAX
(
maxdr
,
drs
[
i
]);

220 
	gmaxdrho
=
MAX
(
maxdrho
,
drhos
[
i
]);

224 
	gÄ
=
¡©ic_ÿ¡
<
size_t
>(
maxr
/
maxdr
+0.5);

225 
	gÄho
=
¡©ic_ÿ¡
<
size_t
>(
maxrho
/
maxdrho
+0.5);

226 
	gdr
=
maxdr
;

227 
	gdrho
=
maxdrho
;

230 
ty³0
 (*
¬r0
)[
N0
];

231 
usšg
 
	gPARR0
=
ty³0
 (*)[
N0
];

232 
usšg
 
	gPPARR0
=
ty³0
 (**)[
N0
];

235 
	grho
=
Ãw
 
PPARR0
[
ÃËms
];

236 *
	grho
=
Ãw
 
PARR0
[
ÃËms
*nelems];

237 
size_t
 
	gi
=1;i<
	gÃËms
;i++è
	grho
[
i
]=
rho
[i-1]+
ÃËms
;

238 
	g¬r0
=
Ãw
 
ty³0
[
Ä
*
ÃËms
][
N0
];

239 
size_t
 
	gi
=0;i<
	gÃËms
;i++)

241 
size_t
 
	gj
=0;j<
	gÃËms
;j++)

242 
	grho
[
i
][
j
]=
¬r0
;

243 
	g¬r0
+=
Ä
;

246 
	gr_phi
=
Ãw
 
PPARR0
[
ÃËms
];

247 *
	gr_phi
=
Ãw
 
PARR0
[
ÃËms
*nelems];

248 
size_t
 
	gi
=1;i<
	gÃËms
;i++è
	gr_phi
[
i
]=
r_phi
[i-1]+
ÃËms
;

249 
	g¬r0
=
Ãw
 
ty³0
[
Ä
*
ÃËms
*Ò–ems+1)/2][
N0
];

250 
size_t
 
	gi
=0;i<
	gÃËms
;i++)

251 
size_t
 
	gj
=0;j<
	gi
+1;j++)

253 
	gr_phi
[
i
][
j
]=
¬r0
;

254 
	gr_phi
[
j
][
i
]=
¬r0
;

255 
	g¬r0
+=
Ä
;

259 
ty³0
 (*
¬r1
)[
N1
];

260 
usšg
 
	gPARR1
=
ty³0
 (*)[
N1
];

261 
	gF
=
Ãw
 
PARR1
[
ÃËms
];

262 
	g¬r1
=
Ãw
 
ty³0
[
Äho
*
ÃËms
][
N1
];

263 
size_t
 
	gi
=0;i<
	gÃËms
;i++)

265 
	gF
[
i
]=
¬r1
;

266 
	g¬r1
+=
Äho
;

269 
	gr_c
=
Ãw
 
ty³0
*[
ÃËms
];

270 *
	gr_c
=
Ãw
 
ty³0
[
ÃËms
*nelems];

271 
size_t
 
	gi
=1;i<
	gÃËms
;i++è
	gr_c
[
i
]=
r_c
[i-1]+
ÃËms
;

273 
ty³0
 
	gr
,
	grh
,
	gp
,
	gtmp0
,
	gtmp1
;

274 
size_t
 
	gl
;

275 
size_t
 
	gi
=0;i<
	gÃËms
;i++)

276 
size_t
 
	gj
=0;j<
	gi
+1;j++)

277 
size_t
 
	gk
=0;k<
	gÄ
;k++)

279 
	gr
=
¡©ic_ÿ¡
<
ty³0
>(
k
)*
dr
;

281 
	gp
=
r
/
drs
[
i
];

282 
	gl
=
¡©ic_ÿ¡
<
size_t
>(
p
);

283 
	gl
=
MIN
(
l
,
Äs
[
i
]-2);

284 
	gp
-=
l
;

285 
	gp
=
MIN
(
p
,1.0);

286 
	gtmp0
=
š‹½Ş©e
(
__Z
[
i
],
Äs
[i],
p
,
k
);

289 
	gp
=
r
/
drs
[
j
];

290 
	gl
=
¡©ic_ÿ¡
<
size_t
>(
p
);

291 
	gl
=
MIN
(
l
,
Äs
[
j
]-2);

292 
	gp
-=
l
;

293 
	gp
=
MIN
(
p
,1.0);

294 
	gtmp1
=
š‹½Ş©e
(
__Z
[
j
],
Äs
[j],
p
,
k
);

296 
	gr_phi
[
i
][
j
][
k
][0]=27.2*0.529*
tmp0
*
tmp1
;

299 
size_t
 
	gi
=0;i<
	gÃËms
;i++)

300 
size_t
 
	gj
=0;j<
	gÄ
;j++)

302 
	gr
=
¡©ic_ÿ¡
<
ty³0
>(
j
)*
dr
;

304 
	gp
=
r
/
drs
[
i
];

305 
	gl
=
¡©ic_ÿ¡
<
size_t
>(
p
);

306 
	gl
=
MIN
(
l
,
Äs
[
i
]-2);

307 
	gp
-=
l
;

308 
	gp
=
MIN
(
p
,1.0);

310 
	grho
[
i
][0][
j
][0]=
š‹½Ş©e
(
__rho
[i],
Äs
[i],
p
,
l
);

313 
size_t
 
	gi
=0;i<
	gÃËms
;i++)

314 
size_t
 
	gj
=0;j<
	gÄho
;j++)

316 
	grh
=
¡©ic_ÿ¡
<
ty³0
>(
j
)*
drho
;

318 
	gp
=
rh
/
drhos
[
i
];

319 
	gl
=
¡©ic_ÿ¡
<> (
p
);

320 
	gl
=
MIN
(
l
,
Ähos
[
i
]-2);

321 
	gp
-=
l
;

322 
	gp
=
MIN
(
p
,1.0);

324 
	gF
[
i
][
j
][0]=
š‹½Ş©e
(
__F
[i],
Ähos
[i],
p
,
l
);

328 
d—Îoc
();

331 
size_t
 
	gi
=0;i<
	gÃËms
;i++)

333 
š‹½Ş©e
(
Äho
,
drho
,
F
[
i
]);

334 
š‹½Ş©e
(
Ä
,
dr
,
rho
[
i
][0]);

336 
size_t
 
	gi
=0;i<
	gÃËms
;i++)

337 
size_t
 
	gj
=0;j<
	gi
+1;j++)

338 
š‹½Ş©e
(
Ä
,
dr
,
r_phi
[
i
][
j
]);

339 
£t_cu‰off
(
ÃËms
,
dr
,
Ä
,
r_phi
,
rho
,
r_c
);

344 
	g‹m¶©e
<
size_t
 
	gN0
,size_ˆ
	gN1
>

345 
	gImpÜtEAM
::
£tæ
(
size_t
 
ÃËms
,
¡d
::
¡ršg
* 
–ems
,¡d::¡ršg 
fe
,

346 
ty³0
& 
dr
,ty³0& 
drho
,
size_t
& 
Ä
,size_t& 
Äho
,

347 
ty³0
(***& 
r_phi
)[
N0
],ty³0(***& 
rho
)[N0],ty³0(**& 
F
)[
N1
],

348 
ty³0
**& 
r_c
,
MPI_Comm
 
wÜld
)

350 
FeR—d”
 
	gä
;

351 
	gŒy


353 
Ãw
 (&
ä
)
FeR—d”
(
wÜld
,
fe
);

355 
ÿtch
(* 
”r_msg
)

357 
throw
 
	g”r_msg
;

361 if(
	gä
.
sk
(3))

362 
throw
 
	gPršt
::
v´štf
("% f’ded imm©u»ly",
ä
.
fe
);

365 
size_t
 
	glše_ıùy
=0,
	g¬gs_ıùy
=0,
	gÇrgs
=0;

367 
ty³0
* 
	gbuff
=
NULL
;

368 * 
	glše
=
NULL
;

369 ** 
	g¬gs
=
NULL
;

370 * 
	g–em_»f
=
NULL
;

371 
boŞ
* 
	gfound
=
NULL
;

373 
	gF
=
NULL
;

374 
	grho
=
NULL
;

375 
	gr_phi
=
NULL
;

376 
	gr_c
=
NULL
;

378 autØ
	gd—Îoc
=[&
–em_»f
,&
lše
,&
buff
,&
¬gs
,&
found
,&
F
,&
rho
,&
r_phi
,&
r_c
]()->

380 if(
	gr_phi
)

382 if(*
	gr_phi
è
	gd–‘e
 [] **r_phi;

383 
	gd–‘e
 [] *
	gr_phi
;

385 
	gd–‘e
 [] 
	gr_phi
;

387 if(
	grho
)

389 if(*
	grho
è
	gd–‘e
 [] **rho;

390 
	gd–‘e
 [] *
	grho
;

392 
	gd–‘e
 [] 
	grho
;

394 if(
	gF
è
	gd–‘e
 [] *F;

395 
	gd–‘e
 [] 
	gF
;

397 if(
	gr_c
è
	gd–‘e
 [] *r_c;

398 
	gd–‘e
 [] 
	gr_c
;

400 
	gd–‘e
 [] 
	glše
;

401 
	gd–‘e
 [] 
	g–em_»f
;

402 
	gd–‘e
 [] 
	gbuff
;

403 
	gd–‘e
 [] 
	g¬gs
;

404 
	gd–‘e
 [] 
	gfound
;

408 if(
ä
(
lše
,
lše_ıùy
)è
throw
 
	gPršt
::
v´štf
("% f’ded imm©u»ly",ä.
fe
);

409 
	gÇrgs
=
ä
.
·r£_lše
(
lše
,
¬gs
,
¬gs_ıùy
);

410 if(
	gÇrgs
<2)

412 
d—Îoc
();

413 
throw
 
	gPršt
::
v´štf
("šv®id†šš % fe: %s",
ä
.
fe
,
lše
);

416 
size_t
 
	gÃËm_»fs
=
Çrgs
-1;

417 
	g–em_»f
=
Ãw
 [
ÃËm_»fs
];

418 
	gfound
=
Ãw
 
boŞ
[
ÃËms
];

419 
	gi
=0;i<
	gÃËms
;i++è
	gfound
[
i
]=
çl£
;

420 
	gi
=0;i<
	gÃËm_»fs
;i++)

422 
	g›Ëm
=-1;

423 
	gj
=0;j<
	gÃËms
&& 
	g›Ëm
==-1 ;j++)

424 if(!
¡rcmp
(
¬gs
[1+
i
],
–ems
[
j
].
c_¡r
()))

426 
	gfound
[
j
]=
Œue
;

427 
	g›Ëm
=
j
;

429 
	g–em_»f
[
i
]=
›Ëm
;

432 
	gi
=0;i<
	gÃËms
;i++)

434 if(!
	gfound
[
i
])

436 
d—Îoc
();

437 
throw
 
	gPršt
::
v´štf
("%s file does‚ot contain…arameters forƒlement %s",

438 
ä
.
fe
,
–ems
[
i
].
c_¡r
());

443 
ty³0
 
	g__r_c
;

444 if(
ä
(
lše
,
lše_ıùy
)è
throw
 
	gPršt
::
v´štf
("% f’ded imm©u»ly",ä.
fe
);

445 if(
ssÿnf
(
lše
," %zu %là%zu %là%lf",&
Äho
,&
drho
,&
Ä
,&
dr
,&
__r_c
)!=5)

447 
d—Îoc
();

448 
throw
 
	gPršt
::
v´štf
("šv®id†šš % fe: %s",
ä
.
fe
,
lše
);

451 if(
	gÄho
<5)

453 
d—Îoc
();

454 
throw
 
	gPršt
::
v´štf
("ÄhØš % fshould bÏrg”hª 5",
ä
.
fe
);

456 if(
	gÄ
<5)

458 
d—Îoc
();

459 
throw
 
	gPršt
::
v´štf
("Ä iÀ% fshould bÏrg”hª 5",
ä
.
fe
);

461 if(
	gdrho
<=0.0)

463 
d—Îoc
();

464 
throw
 
	gPršt
::
v´štf
("drhØš % fshould bÏrg”hª 0.0",
ä
.
fe
);

466 if(
	gdr
<=0.0)

468 
d—Îoc
();

469 
throw
 
	gPršt
::
v´štf
("d¸š % fshould bÏrg”hª 0.0",
ä
.
fe
);

473 
ty³0
 (*
¬r0
)[
N0
];

474 
usšg
 
	gPARR0
=
ty³0
 (*)[
N0
];

475 
usšg
 
	gPPARR0
=
ty³0
 (**)[
N0
];

478 
	grho
=
Ãw
 
PPARR0
[
ÃËms
];

479 *
	grho
=
Ãw
 
PARR0
[
ÃËms
*nelems];

480 
size_t
 
	gi
=1;i<
	gÃËms
;i++è
	grho
[
i
]=
rho
[i-1]+
ÃËms
;

481 
	g¬r0
=
Ãw
 
ty³0
[
Ä
*
ÃËms
][
N0
];

482 
size_t
 
	gi
=0;i<
	gÃËms
;i++)

484 
size_t
 
	gj
=0;j<
	gÃËms
;j++)

485 
	grho
[
i
][
j
]=
¬r0
;

486 
	g¬r0
+=
Ä
;

489 
	gr_phi
=
Ãw
 
PPARR0
[
ÃËms
];

490 *
	gr_phi
=
Ãw
 
PARR0
[
ÃËms
*nelems];

491 
size_t
 
	gi
=1;i<
	gÃËms
;i++è
	gr_phi
[
i
]=
r_phi
[i-1]+
ÃËms
;

492 
	g¬r0
=
Ãw
 
ty³0
[
Ä
*
ÃËms
*Ò–ems+1)/2][
N0
];

493 
size_t
 
	gi
=0;i<
	gÃËms
;i++)

494 
size_t
 
	gj
=0;j<
	gi
+1;j++)

496 
	gr_phi
[
i
][
j
]=
¬r0
;

497 
	gr_phi
[
j
][
i
]=
¬r0
;

498 
	g¬r0
+=
Ä
;

502 
ty³0
 (*
¬r1
)[
N1
];

503 
usšg
 
	gPARR1
=
ty³0
 (*)[
N1
];

504 
	gF
=
Ãw
 
PARR1
[
ÃËms
];

505 
	g¬r1
=
Ãw
 
ty³0
[
Äho
*
ÃËms
][
N1
];

506 
size_t
 
	gi
=0;i<
	gÃËms
;i++)

508 
	gF
[
i
]=
¬r1
;

509 
	g¬r1
+=
Äho
;

512 
	gr_c
=
Ãw
 
ty³0
*[
ÃËms
];

513 *
	gr_c
=
Ãw
 
ty³0
[
ÃËms
*nelems];

514 
size_t
 
	gi
=1;i<
	gÃËms
;i++è
	gr_c
[
i
]=
r_c
[i-1]+
ÃËms
;

515 
	gbuff
=
Ãw
 
ty³0
[
MAX
(
Ä
+
Äho
,
ÃËm_»fs
*(nelem_refs+1)/2*nr)];

516 
size_t
 
	gi
=0;i<
	gÃËm_»fs
;i++)

518 if(
	gä
.
sk
(1)è
throw
 
	gPršt
::
v´štf
("% f’ded imm©u»ly",
ä
.
fe
);

519 
	g›Ëm
=
–em_»f
[
i
];

520 if(
	g›Ëm
==-1)

522 
Œy


524 
sk
(
Äho
+
Ä
,
ä
,
lše
,
lše_ıùy
);

526 
ÿtch
 (* 
”r_msg
)

528 
d—Îoc
();

529 
throw
 
	g”r_msg
;

534 
	gŒy


536 
»ad_doubË
(
buff
,
Äho
+
Ä
,
ä
,
lše
,
lše_ıùy
,
¬gs
,
¬gs_ıùy
);

538 
ÿtch
 (* 
”r_msg
)

540 
d—Îoc
();

541 
throw
 
	g”r_msg
;

546 
size_t
 
	gj
=0;j<
	gÄho
;j++)

547 
	gF
[
›Ëm
][
j
][0]=
buff
[j];

548 
size_t
 
	gj
=0;j<
	gÄ
;j++)

549 
	grho
[
›Ëm
][0][
j
][0]=
buff
[j+
Äho
];

553 
	gŒy


555 
»ad_doubË
(
buff
,
ÃËm_»fs
*Ò–em_»fs+1)/2*
Ä
,
ä
,
lše
,
lše_ıùy
,
¬gs
,
¬gs_ıùy
);

557 
ÿtch
 (* 
”r_msg
)

559 
d—Îoc
();

560 
throw
 
	g”r_msg
;

563 
size_t
 
	gos
=0;

564 
size_t
 
	gi
=0;i<
	gÃËm_»fs
;i++)

565 
size_t
 
	gj
=0;j<
	gi
+1;j++)

567 
	g›Ëm
=
–em_»f
[
i
];

568 
	gj–em
=
–em_»f
[
j
];

570 if(
	g›Ëm
==-1 || 
j–em
==-1)

572 
os
+=
Ä
;

576 
size_t
 
	gk
=0;k<
	gÄ
;k++)

577 
	gr_phi
[
›Ëm
][
j–em
][
k
][0]=
buff
[
os
++];

580 
	gd–‘e
 [] 
	glše
;

581 
	gd–‘e
 [] 
	g–em_»f
;

582 
	gd–‘e
 [] 
	gbuff
;

583 
	gd–‘e
 [] 
	g¬gs
;

584 
	gd–‘e
 [] 
	gfound
;

586 
size_t
 
	gi
=0;i<
	gÃËms
;i++)

588 
š‹½Ş©e
(
Äho
,
drho
,
F
[
i
]);

589 
š‹½Ş©e
(
Ä
,
dr
,
rho
[
i
][0]);

591 
size_t
 
	gi
=0;i<
	gÃËms
;i++)

592 
size_t
 
	gj
=0;j<
	gi
+1;j++)

593 
š‹½Ş©e
(
Ä
,
dr
,
r_phi
[
i
][
j
]);

594 
£t_cu‰off
(
ÃËms
,
dr
,
Ä
,
r_phi
,
rho
,
r_c
);

600 
	g‹m¶©e
<
size_t
 
	gN0
,size_ˆ
	gN1
>

601 
	gImpÜtEAM
::
fs
(
size_t
 
ÃËms
,
¡d
::
¡ršg
* 
–ems
,¡d::¡ršg 
fe
,

602 
ty³0
& 
dr
,ty³0& 
drho
,
size_t
& 
Ä
,size_t& 
Äho
,

603 
ty³0
(***& 
r_phi
)[
N0
],ty³0(***& 
rho
)[N0],ty³0(**& 
F
)[
N1
],

604 
ty³0
**& 
r_c
,
MPI_Comm
 
wÜld
)

606 
FeR—d”
 
	gä
;

607 
	gŒy


609 
Ãw
 (&
ä
)
FeR—d”
(
wÜld
,
fe
);

611 
ÿtch
(* 
”r_msg
)

613 
throw
 
	g”r_msg
;

617 if(
	gä
.
sk
(3))

618 
throw
 
	gPršt
::
v´štf
("% f’ded imm©u»ly",
ä
.
fe
);

621 
size_t
 
	glše_ıùy
=0,
	g¬gs_ıùy
=0,
	gÇrgs
=0;

623 
ty³0
* 
	gbuff
=
NULL
;

624 * 
	glše
=
NULL
;

625 ** 
	g¬gs
=
NULL
;

626 * 
	g–em_»f
=
NULL
;

627 
boŞ
* 
	gfound
=
NULL
;

629 
	gF
=
NULL
;

630 
	grho
=
NULL
;

631 
	gr_phi
=
NULL
;

632 
	gr_c
=
NULL
;

634 autØ
	gd—Îoc
=[&
–em_»f
,&
lše
,&
buff
,&
¬gs
,&
found
,&
F
,&
rho
,&
r_phi
,&
r_c
]()->

636 if(
	gr_phi
)

638 if(*
	gr_phi
è
	gd–‘e
 [] **r_phi;

639 
	gd–‘e
 [] *
	gr_phi
;

641 
	gd–‘e
 [] 
	gr_phi
;

643 if(
	grho
)

645 if(*
	grho
è
	gd–‘e
 [] **rho;

646 
	gd–‘e
 [] *
	grho
;

648 
	gd–‘e
 [] 
	grho
;

650 if(
	gF
è
	gd–‘e
 [] *F;

651 
	gd–‘e
 [] 
	gF
;

653 if(
	gr_c
è
	gd–‘e
 [] *r_c;

654 
	gd–‘e
 [] 
	gr_c
;

656 
	gd–‘e
 [] 
	glše
;

657 
	gd–‘e
 [] 
	g–em_»f
;

658 
	gd–‘e
 [] 
	gbuff
;

659 
	gd–‘e
 [] 
	g¬gs
;

660 
	gd–‘e
 [] 
	gfound
;

664 if(
ä
(
lše
,
lše_ıùy
)è
throw
 
	gPršt
::
v´štf
("% f’ded imm©u»ly",ä.
fe
);

665 
	gÇrgs
=
ä
.
·r£_lše
(
lše
,
¬gs
,
¬gs_ıùy
);

666 if(
	gÇrgs
<2)

668 
d—Îoc
();

669 
throw
 
	gPršt
::
v´štf
("šv®id†šš % fe: %s",
ä
.
fe
,
lše
);

672 
size_t
 
	gÃËm_»fs
=
Çrgs
-1;

673 
	g–em_»f
=
Ãw
 [
ÃËm_»fs
];

674 
	gfound
=
Ãw
 
boŞ
[
ÃËms
];

675 
	gi
=0;i<
	gÃËms
;i++è
	gfound
[
i
]=
çl£
;

676 
	gi
=0;i<
	gÃËm_»fs
;i++)

678 
	g›Ëm
=-1;

679 
	gj
=0;j<
	gÃËms
&& 
	g›Ëm
==-1 ;j++)

680 if(!
¡rcmp
(
¬gs
[1+
i
],
–ems
[
j
].
c_¡r
()))

682 
	gfound
[
j
]=
Œue
;

683 
	g›Ëm
=
j
;

685 
	g–em_»f
[
i
]=
›Ëm
;

688 
	gi
=0;i<
	gÃËms
;i++)

690 if(!
	gfound
[
i
])

692 
d—Îoc
();

693 
throw
 
	gPršt
::
v´štf
("%s file does‚ot contain…arameters forƒlement %s",

694 
ä
.
fe
,
–ems
[
i
].
c_¡r
());

699 
ty³0
 
	g__r_c
;

701 if(
ä
(
lše
,
lše_ıùy
)è
throw
 
	gPršt
::
v´štf
("% f’ded imm©u»ly",ä.
fe
);

702 if(
ssÿnf
(
lše
," %zu %là%zu %là%lf",&
Äho
,&
drho
,&
Ä
,&
dr
,&
__r_c
)!=5)

704 
d—Îoc
();

705 
throw
 
	gPršt
::
v´štf
("šv®id†šš % fe: %s",
ä
.
fe
,
lše
);

708 if(
	gÄho
<5)

710 
d—Îoc
();

711 
throw
 
	gPršt
::
v´štf
("ÄhØš % fshould bÏrg”hª 5",
ä
.
fe
);

713 if(
	gÄ
<5)

715 
d—Îoc
();

716 
throw
 
	gPršt
::
v´štf
("Ä iÀ% fshould bÏrg”hª 5",
ä
.
fe
);

718 if(
	gdrho
<=0.0)

720 
d—Îoc
();

721 
throw
 
	gPršt
::
v´štf
("drhØš % fshould bÏrg”hª 0.0",
ä
.
fe
);

723 if(
	gdr
<=0.0)

725 
d—Îoc
();

726 
throw
 
	gPršt
::
v´štf
("d¸š % fshould bÏrg”hª 0.0",
ä
.
fe
);

730 
ty³0
 (*
¬r0
)[
N0
];

731 
usšg
 
	gPARR0
=
ty³0
 (*)[
N0
];

732 
usšg
 
	gPPARR0
=
ty³0
 (**)[
N0
];

735 
	grho
=
Ãw
 
PPARR0
[
ÃËms
];

736 *
	grho
=
Ãw
 
PARR0
[
ÃËms
*nelems];

737 
size_t
 
	gi
=1;i<
	gÃËms
;i++è
	grho
[
i
]=
rho
[i-1]+
ÃËms
;

738 
	g¬r0
=
Ãw
 
ty³0
[
Ä
*
ÃËms
*ÃËms][
N0
];

739 
size_t
 
	gi
=0;i<
	gÃËms
;i++)

741 
size_t
 
	gj
=0;j<
	gÃËms
;j++)

743 
	grho
[
i
][
j
]=
¬r0
;

744 
	g¬r0
+=
Ä
;

748 
	gr_phi
=
Ãw
 
PPARR0
[
ÃËms
];

749 *
	gr_phi
=
Ãw
 
PARR0
[
ÃËms
*nelems];

750 
size_t
 
	gi
=1;i<
	gÃËms
;i++è
	gr_phi
[
i
]=
r_phi
[i-1]+
ÃËms
;

751 
	g¬r0
=
Ãw
 
ty³0
[
Ä
*
ÃËms
*Ò–ems+1)/2][
N0
];

752 
size_t
 
	gi
=0;i<
	gÃËms
;i++)

753 
size_t
 
	gj
=0;j<
	gi
+1;j++)

755 
	gr_phi
[
i
][
j
]=
¬r0
;

756 
	gr_phi
[
j
][
i
]=
¬r0
;

757 
	g¬r0
+=
Ä
;

761 
ty³0
 (*
¬r1
)[
N1
];

762 
usšg
 
	gPARR1
=
ty³0
 (*)[
N1
];

763 
	gF
=
Ãw
 
PARR1
[
ÃËms
];

764 
	g¬r1
=
Ãw
 
ty³0
[
Äho
*
ÃËms
][
N1
];

765 
size_t
 
	gi
=0;i<
	gÃËms
;i++)

767 
	gF
[
i
]=
¬r1
;

768 
	g¬r1
+=
Äho
;

771 
	gr_c
=
Ãw
 
ty³0
*[
ÃËms
];

772 *
	gr_c
=
Ãw
 
ty³0
[
ÃËms
*nelems];

773 
size_t
 
	gi
=1;i<
	gÃËms
;i++è
	gr_c
[
i
]=
r_c
[i-1]+
ÃËms
;

775 
	gbuff
=
Ãw
 
ty³0
[
MAX
(
Äho
+
Ä
*
ÃËm_»fs
,nelem_refs*(nelem_refs+1)/2*nr)];

776 
size_t
 
	gi
=0;i<
	gÃËm_»fs
;i++)

778 if(
	gä
.
sk
(1)è
throw
 
	gPršt
::
v´štf
("% f’ded imm©u»ly",
ä
.
fe
);

779 
	g›Ëm
=
–em_»f
[
i
];

780 if(
	g›Ëm
==-1)

782 
Œy


784 
sk
(
Äho
+
Ä
*
ÃËm_»fs
,
ä
,
lše
,
lše_ıùy
);

786 
ÿtch
 (* 
”r_msg
)

788 
d—Îoc
();

789 
throw
 
	g”r_msg
;

794 
	gŒy


796 
»ad_doubË
(
buff
,
Äho
+
Ä
*
ÃËm_»fs
,
ä
,
lše
,
lše_ıùy
,
¬gs
,
¬gs_ıùy
);

798 
ÿtch
 (* 
”r_msg
)

800 
d—Îoc
();

801 
throw
 
	g”r_msg
;

806 
size_t
 
	gj
=0;j<
	gÄho
;j++)

807 
	gF
[
›Ëm
][
j
][0]=
buff
[j];

808 
size_t
 
	gos
=
Äho
;

810 
size_t
 
	gj
=0;j<
	gÃËm_»fs
;j++)

812 
	gj–em
=
–em_»f
[
j
];

813 if(
	gj–em
==-1)

815 
os
+=
Ä
;

819 
size_t
 
	gk
=0;k<
	gÄ
;k++)

820 
	grho
[
›Ëm
][
j–em
][
k
][0]=
buff
[
os
++];

827 
	gŒy


829 
»ad_doubË
(
buff
,
ÃËm_»fs
*Ò–em_»fs+1)/2*
Ä
,
ä
,
lše
,
lše_ıùy
,
¬gs
,
¬gs_ıùy
);

831 
ÿtch
 (* 
”r_msg
)

833 
d—Îoc
();

834 
throw
 
	g”r_msg
;

837 
size_t
 
	gos
=0;

838 
size_t
 
	gi
=0;i<
	gÃËm_»fs
;i++)

839 
size_t
 
	gj
=0;j<
	gi
+1;j++)

841 
	g›Ëm
=
–em_»f
[
i
];

842 
	gj–em
=
–em_»f
[
j
];

844 if(
	g›Ëm
==-1 || 
j–em
==-1)

846 
os
+=
Ä
;

850 
size_t
 
	gk
=0;k<
	gÄ
;k++)

851 
	gr_phi
[
›Ëm
][
j–em
][
k
][0]=
buff
[
os
++];

854 
	gd–‘e
 [] 
	glše
;

855 
	gd–‘e
 [] 
	g–em_»f
;

856 
	gd–‘e
 [] 
	gbuff
;

857 
	gd–‘e
 [] 
	g¬gs
;

858 
	gd–‘e
 [] 
	gfound
;

860 
size_t
 
	gi
=0;i<
	gÃËms
;i++)

861 
š‹½Ş©e
(
Äho
,
drho
,
F
[
i
]);

863 
size_t
 
	gi
=0;i<
	gÃËms
;i++)

864 
size_t
 
	gj
=0;j<
	gÃËms
;j++)

865 
š‹½Ş©e
(
Ä
,
dr
,
rho
[
i
][
j
]);

867 
size_t
 
	gi
=0;i<
	gÃËms
;i++)

868 
size_t
 
	gj
=0;j<
	gi
+1;j++)

869 
š‹½Ş©e
(
Ä
,
dr
,
r_phi
[
i
][
j
]);

870 
£t_cu‰off
(
ÃËms
,
dr
,
Ä
,
r_phi
,
rho
,
r_c
);

	@import_styles.h

1 
	~"impÜt_cfg.h
"

	@logics.cpp

1 
	~"logics.h
"

3 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

4 cÚ¡ 
	g¡d
::
¡ršg
 
Logics
::
Log
::
v”b_aux
 =
¡d
::string("should");

5 cÚ¡ 
	g¡d
::
¡ršg
 
Logics
::
Log
::
Ãg©e
=
¡d
::string("not");

6 cÚ¡ 
	g¡d
::
¡ršg
 
Logics
::
Log
::
v”b
=
¡d
::string("be");

7 cÚ¡ 
	g¡d
::
¡ršg
 
Logics
::
Log
::
s_v”b
=
¡d
::string("is");

8 cÚ¡ 
	g¡d
::
¡ršg
 
Logics
::
Log
::
p_v”b
=
¡d
::string("are");

9 cÚ¡ 
	g¡d
::
¡ršg
 
Logics
::
Log
::
s_n_v”b
=
¡d
::string("are‚ot");

10 cÚ¡ 
	g¡d
::
¡ršg
 
Logics
::
Log
::
p_n_v”b
=
¡d
::string("should‚ot be");

19 
	gLogics
::
	$Logics
():

20 
	`İ
(
NULL
),

21 
	$Ãxt
(
NULL
)

23 
	}
}

27 
	gLogics
::~
	$Logics
()

29 
d–‘e
 
İ
;

30 
d–‘e
 
Ãxt
;

31 
	}
}

35 
	gLogics
::
	$Logics
(
Logics
& 
Ùh”
)

37 if(
Ùh”
.
İ
!=
NULL
)

38 
this
->
İ
=
Ùh”
.İ->
	`şÚe
();

40 
this
->
İ
=
NULL
;

42 if(
Ùh”
.
Ãxt
!=
NULL
)

44 
this
->
Ãxt
=
Ãw
 
	`Logics
(*(
Ùh”
.next));

46 
	}
}

50 
	gLogics
::
	$Logics
(
Logics
&& 
Ùh”
)

52 
this
->
İ
=
Ùh”
.op;

53 
Ùh”
.
İ
=
NULL
;

55 
this
->
Ãxt
=
Ùh”
.next;

56 
Ùh”
.
Ãxt
=
NULL
;

57 
	}
}

61 
	gLogics
& Logics::
İ”©Ü
=(
Logics
& 
Ùh”
)

63 
d–‘e
 
this
->
İ
;

64 if(
	gÙh”
.
	gİ
!=
NULL
)

65 
this
->
İ
=
Ùh”
.İ->
şÚe
();

67 
	gthis
->
	gİ
=
NULL
;

69 if(
	gÙh”
.
	gÃxt
!=
NULL
)

71 
d–‘e
 
this
->
Ãxt
;

72 
	gthis
->
	gÃxt
=
Ãw
 
Logics
(*(
Ùh”
.
Ãxt
));

75  *
	gthis
;

80 
	gLogics
& Logics::
İ”©Ü
=(
Logics
&& 
Ùh”
)

83 
d–‘e
 
this
->
İ
;

84 
	gthis
->
	gİ
=
Ùh”
.
İ
;

85 
	gÙh”
.
	gİ
=
NULL
;

88 
d–‘e
 
	gthis
->
	gÃxt
;

89 
	gthis
->
	gÃxt
=
Ùh”
.
Ãxt
;

90 
	gÙh”
.
	gÃxt
=
NULL
;

92  *
	gthis
;

97 
	gLogics
&& Logics::
İ”©Ü
+(
Logics
&& 
Ùh”
)

99 if(
this
->
İ
==
NULL
)

101 
d–‘e
 
this
->
İ
;

102 
	gthis
->
	gİ
=
Ùh”
.
İ
;

103 
	gÙh”
.
	gİ
=
NULL
;

104  
	g¡d
::
move
(*
this
);

106 
Log
* 
	gİ_
=
Ãw
 
LogOR
(
this
->
İ
,
Ùh”
.op);

107 
	gİ
=
İ_
;

108 
	gÙh”
.
	gİ
=
NULL
;

109  
	g¡d
::
move
(*
this
);

114 
	gLogics
&& Logics::
İ”©Ü
*(
Logics
&& 
Ùh”
)

116 if(
this
->
İ
==
NULL
)

118 
d–‘e
 
this
->
İ
;

119 
	gİ
=
Ùh”
.
İ
;

120 
	gÙh”
.
	gİ
=
NULL
;

121  
	g¡d
::
move
(*
this
);

124 
Log
* 
	gİ_
=
Ãw
 
LogAND
(
this
->
İ
,
Ùh”
.op);

125 
	gİ
=
İ_
;

126 
	gÙh”
.
	gİ
=
NULL
;

127  
	g¡d
::
move
(*
this
);

132 
	gLogics
&& Logics::
İ”©Ü
/(
Logics
&& 
Ùh”
)

135 if(
this
->
İ
==
NULL
)

137 
d–‘e
 
this
->
İ
;

138 
	gthis
->
	gİ
=
Ùh”
.
İ
;

139 
	gÙh”
.
	gİ
=
NULL
;

140  
	g¡d
::
move
(*
this
);

144 
Log
* 
	gİ_
=
Ãw
 
LogIF
(
this
->
İ
,
Ùh”
.op);

145 
	gİ
=
İ_
;

146 
	gÙh”
.
	gİ
=
NULL
;

147  
	g¡d
::
move
(*
this
);

152 
	gLogics
&& Logics::
İ”©Ü
-(
Logics
&& 
Ùh”
)

154 if(
this
->
İ
==
NULL
)

156 
d–‘e
 
this
->
İ
;

157 
	gİ
=
Ùh”
.
İ
;

158 
	gÙh”
.
	gİ
=
NULL
;

159  
	g¡d
::
move
(*
this
);

162 
Log
* 
	gİ_
=
Ãw
 
LogIFF
(
this
->
İ
,
Ùh”
.op);

163 
	gİ
=
İ_
;

164 
	gÙh”
.
	gİ
=
NULL
;

165  
	g¡d
::
move
(*
this
);

170 
	gLogics
& Logics::
İ”©Ü
+=(
Logics
&& 
Ùh”
)

172 if(
this
->
İ
==
NULL
)

174 
d–‘e
 
this
->
İ
;

175 
	gİ
=
Ùh”
.
İ
;

176 
	gÙh”
.
	gİ
=
NULL
;

177  *
	gthis
;

180 
Log
* 
	gİ_
=
Ãw
 
LogOR
(
this
->
İ
,
Ùh”
.op);

181 
	gİ
=
İ_
;

182 
	gÙh”
.
	gİ
=
NULL
;

183  *
	gthis
;

188 
	gLogics
& Logics::
İ”©Ü
*=(
Logics
&& 
Ùh”
)

190 if(
this
->
İ
==
NULL
)

192 
İ
=
Ùh”
.op;

193 
	gÙh”
.
	gİ
=
NULL
;

194  *
	gthis
;

197 
Log
* 
	gİ_
=
Ãw
 
LogAND
(
this
->
İ
,
Ùh”
.op);

198 
	gİ
=
İ_
;

199 
	gÙh”
.
	gİ
=
NULL
;

200  *
	gthis
;

205 
	gLogics
& Logics::
İ”©Ü
-=(
Logics
&& 
Ùh”
)

207 if(
this
->
İ
==
NULL
)

209 
d–‘e
 
this
->
İ
;

210 
	gİ
=
Ùh”
.
İ
;

211 
	gÙh”
.
	gİ
=
NULL
;

212  *
	gthis
;

215 
Log
* 
	gİ_
=
Ãw
 
LogIFF
(
this
->
İ
,
Ùh”
.op);

216 
	gİ
=
İ_
;

217 
	gÙh”
.
	gİ
=
NULL
;

218  *
	gthis
;

223 
	gLogics
& Logics::
İ”©Ü
/=(
Logics
&& 
Ùh”
)

225 if(
this
->
İ
==
NULL
)

227 
İ
=
Ùh”
.op;

228 
	gÙh”
.
	gİ
=
NULL
;

229  *
	gthis
;

232 
Log
* 
	gİ_
=
Ãw
 
LogIF
(
this
->
İ
,
Ùh”
.op);

233 
	gİ
=
İ_
;

234 
	gÙh”
.
	gİ
=
NULL
;

235  *
	gthis
;

240 
	gLogics
::
	$v¬_log
(
V¬
* 
v
,
Logics
* 
logs
)

243 
¡d
::
¡ršg
 
”r_msg
=
logs
->
	`İ”©Ü
()(
v
);

244 if(!
”r_msg
.
	`em±y
()è
throw
ƒrr_msg;

246 if(
v
->
¿nk
)

248 
size_t
 
i
=0;i<
v
->
size
;i++)

250 
Œy


252 
	`v¬_log
(&(
v
->
İ”©Ü
[](
i
)),
logs
-1);

254 
	`ÿtch
(
¡d
::
¡ršg
& 
”r_msg
)

256 
throw
 
”r_msg
;

260 
	}
}

264 
boŞ
 
	gLogics
::
	$v¬_log_nÙhrow
(
V¬
* 
v
,
Logics
* 
logs
)

267 if(
logs
->
İ
 && !logs->İ->
	`İ”©Ü
()(
v
))

268  
çl£
;

270 if(
v
->
¿nk
)

271 
size_t
 
i
=0;i<
v
->
size
;i++)

272 if(!
	`v¬_log_nÙhrow
(&(
v
->
İ”©Ü
[](
i
)),
logs
-1))

273  
çl£
;

274  
Œue
;

275 
	}
}

279 
	g¡d
::
¡ršg
 
Logics
::
	$´št
(* 
v
)

281 
v_æag
=
AUX_VERB
;

282 if(
İ
==
NULL
)

283  
NULL
;

285 
¡d
::
¡ršg
 
”r_msg
;

286 
¡d
::
¡ršg
 
d–
;

287 
¡d
::
¡ršg
 
l
;

288 
¡d
::
¡ršg
 
r
;

289 
¡d
::
¡ršg
 
İ”
;

290 
¡d
::
¡ršg
 
_v”b_
;

291 
boŞ
 
p_æag
;

292 
boŞ
 
__is__
;

294 
İ
->
	`´št
(
”r_msg
,
l
,
İ”
,
r
,
__is__
,
d–
,
v_æag
,
p_æag
,
v
);

295 
İ
->
	`fšish_¢Šc
(
”r_msg
,
l
,
İ”
,
r
,
__is__
,
d–
,
v_æag
,
p_æag
);

296 
”r_msg
+=".";

298 if(
Ãxt
)

300 
¡d
::
¡ršg
 
Ãxt_msg
=
Ãxt
->
	`´št
(
v
);

301 if(!
Ãxt_msg
.
	`em±y
())

302 
”r_msg
+=" "+
Ãxt_msg
;

305  
”r_msg
;

306 
	}
}

310 
	g¡d
::
¡ršg
 
Logics
::
	$İ”©Ü
()(* 
v
)

313 if(
İ
==
NULL
)

314  
¡d
::
	`¡ršg
();

316 if(!
İ
->
	`İ”©Ü
()(
v
))

318  
	`´št
(
v
);

321 if(
Ãxt
!=
NULL
)

322  
Ãxt
->
	`İ”©Ü
()(
v
);

324  
¡d
::
	`¡ršg
();

325 
	}
}

329 
	g¡d
::
¡ršg
 
Logics
::
	$İ”©Ü
()()

331  
	`İ”©Ü
()(
NULL
);

332 
	}
}

336 
	gLogics
& Logics::
	$lšk
()

339 if(
Ãxt
==
NULL
)

341 
Ãxt
=
Ãw
 
	`Logics
();

344  *
Ãxt
;

345 
	}
}

354 
	gLogics
::
Log
::
	$Log
(
¡d
::
¡ršg
&& 
İ_Çme_
,cÚ¡ 
boŞ
 
_is
):

355 
	`_is_
(
_is
),

356 
	$İ_Çme
(
İ_Çme_
)

359 
	}
}

363 
	gLogics
::
Log
::~
	$Log
()

365 
	}
}

369 
Logics
::
Log
::
	$eq
(cÚ¡ * 
¡0
,cÚ¡ * 
¡1
)

371 if(
¡0
==
NULL
 && 
¡1
==NULL)

373 if(
¡0
==
NULL
)

375 if(
¡1
==
NULL
)

377 if(
	`¡rcmp
(
¡0
,
¡1
))

381 
	}
}

385 
	gLogics
::
Log
::
	$fšish_¢Šc
(
¡d
::
¡ršg
& 
”r_msg
,¡d::¡ršg& 
L
,¡d::¡ršg& 
İ
,¡d::¡ršg& 
R
,
boŞ
& 
__is__
,¡d::¡ršg& 
d–
,
v_æag
,boŞ& 
p_æag
)

387 if(
L
.
	`em±y
())

389 
”r_msg
+=
L
+" ";

391 if(
v_æag
==
VERB
)

393 if(
__is__
 && 
p_æag
)

394 
”r_msg
+=
p_v”b
+" ";

395 if(
__is__
 && !
p_æag
)

396 
”r_msg
+=
s_v”b
+" ";

398 if(!
__is__
 && 
p_æag
)

399 
”r_msg
+=
p_n_v”b
+" ";

401 
”r_msg
+=
s_n_v”b
+" ";

405 if(
__is__
)

406 
”r_msg
+=
v”b_aux
+" "+
v”b
+" ";

408 
”r_msg
+=
v”b_aux
+" "+
Ãg©e
+" "+
v”b
+" ";

410 
”r_msg
+=
İ
;

412 if(!
R
.
	`em±y
())

413 
”r_msg
+=" "+
R
;

416 
L
.
	`ş—r
();

417 
İ
.
	`ş—r
();

418 
R
.
	`ş—r
();

419 
p_æag
=
çl£
;

420 
	}
}

424 
	gLogics
::
Log
::
	$¡¬t_¢Šc
(
¡d
::
¡ršg
& 
L
,¡d::¡ršg& 
İ
,¡d::¡ršg& 
R
,
v_æag
,cÚ¡ std::¡ršg& 
l_Çme
,cÚ¡ std::¡ršg& 
r_Çme
)

426 
L
=
l_Çme
;

427 
İ
=
İ_Çme
;

428 
R
=
r_Çme
;

429 
	}
}

470 
	gLogics
::
Log
::
	$´oûss_¢Šc
(
¡d
::
¡ršg
& 
”r_msg
,¡d::¡ršg& 
L
,¡d::¡ršg& 
İ
,¡d::¡ršg& 
R
,
boŞ
& 
__is__
,¡d::¡ršg& 
d–
,
v_æag
,boŞ& 
p_æag
,cÚ¡ std::¡ršg& 
l_Çme
,cÚ¡ std::¡ršg& 
r_Çme
)

472 if(
L
.
	`em±y
())

474 
	`¡¬t_¢Šc
(
L
,
İ
,
R
,
v_æag
,
l_Çme
,
r_Çme
);

475 
__is__
=
_is_
;

476 
p_æag
=
çl£
;

480 
ÿ£_no
=4*(
L
==
l_Çme
)+2*(
__is__
==
_is_
 && 
İ
==
İ_Çme
)+(
R
==
r_Çme
);

482 if(
ÿ£_no
<3 || case_no==7)

484 
	`fšish_¢Šc
(
”r_msg
,
L
,
İ
,
R
,
__is__
,
d–
,
v_æag
,
p_æag
);

485 
”r_msg
+=", "+
d–
+" ";

486 
	`´št
(
”r_msg
,
L
,
İ
,
R
,
__is__
,
d–
,
v_æag
,
p_æag
);

493 if(
ÿ£_no
==3)

495 
p_æag
=
Œue
;

496 
L
+=" "+
d–
+" "+
l_Çme
;

502 if(
ÿ£_no
==4)

504 if(
_is_
!=
__is__
)

506 if(!
__is__
)

508 if(
R
.
	`em±y
())

509 
İ
=
İ_Çme
+" "+
d–
+" "+
Ãg©e
+" "+op;

511 
İ
=
İ_Çme
+" "+
r_Çme
+" "+
d–
+" "+
Ãg©e
+" "+op;

512 
__is__
=
Œue
;

516 if(
R
.
	`em±y
())

517 
İ
+=" "+
d–
+" "+
Ãg©e
+" "+
İ_Çme
;

519 
İ
+=" "+
R
+" "+
d–
+" "+
Ãg©e
+" "+
İ_Çme
;

520 
R
=
r_Çme
;

525 if(
R
.
	`em±y
())

526 
İ
+=" "+
d–
+" "+
İ_Çme
;

528 
İ
+=" "+
R
+" "+
d–
+" "+
İ_Çme
;

529 
R
=
r_Çme
;

536 if(
ÿ£_no
==5)

539 if(
_is_
!=
__is__
)

541 if(!
__is__
)

543 
İ
=
İ_Çme
+" "+
d–
+" "+
Ãg©e
+" "+op;

544 
__is__
=
Œue
;

547 
İ
+=" "+
d–
+" "+
Ãg©e
+" "+
İ_Çme
;

550 
İ
+=" "+
d–
+" "+
İ_Çme
;

555 if(
ÿ£_no
==6)

557 if(!
r_Çme
.
	`em±y
())

558 
R
+=" "+
d–
+" "+
r_Çme
;

560 
	}
}

569 
	gLogics
::
LogBš¬yOp
::
	$LogBš¬yOp
(
Log
* 
l
,Log* 
r
,cÚ¡ * 
İ_Çme
,cÚ¡ 
boŞ
 
_is_
):

570 
	`Log
(
İ_Çme
,
_is_
),
	`Ëá
(
l
),
	$right
(
r
)

572 
	}
}

576 
	gLogics
::
LogBš¬yOp
::~
	$LogBš¬yOp
()

578 
d–‘e
 
Ëá
;

579 
d–‘e
 
right
;

580 
	}
}

584 
	gLogics
::
LogBš¬yOp
::
	$´št
(
¡d
::
¡ršg
& 
”r_msg
,¡d::¡ršg& 
L
,¡d::¡ršg& 
İ
,¡d::¡ršg& 
R
,
boŞ
& 
__is__
,¡d::¡ršg& 
d–
,
v_æag
,boŞ& 
p_æag
)

586 
Ëá
->
	`´št
(
”r_msg
,
L
,
İ
,
R
,
__is__
,
d–
,
v_æag
,
p_æag
);

587 
d–
=
İ_Çme
;

588 
right
->
	`´št
(
”r_msg
,
L
,
İ
,
R
,
__is__
,
d–
,
v_æag
,
p_æag
);

589 
	}
}

593 
	gLogics
::
LogBš¬yOp
::
	$´št
(
¡d
::
¡ršg
& 
”r_msg
,¡d::¡ršg& 
L
,¡d::¡ršg& 
İ
,¡d::¡ršg& 
R
,
boŞ
& 
__is__
,¡d::¡ršg& 
d–
,
v_æag
,boŞ& 
p_æag
,* 
v
)

595 
Ëá
->
	`´št
(
”r_msg
,
L
,
İ
,
R
,
__is__
,
d–
,
v_æag
,
p_æag
,
v
);

596 
d–
=
İ_Çme
;

597 
right
->
	`´št
(
”r_msg
,
L
,
İ
,
R
,
__is__
,
d–
,
v_æag
,
p_æag
,
v
);

598 
	}
}

607 
	gLogics
::
LogAND
::
	$LogAND
(
Log
* 
l
,Log* 
r
):
	`LogBš¬yOp
Ö,r,"ªd",
Œue
)

608 {
	}
}

612 
boŞ
 
	gLogics
::
LogAND
::
	$İ”©Ü
()()

613 { ((*
Ëá
)(è&& (*
right
)());
	}
}

617 
boŞ
 
	gLogics
::
LogAND
::
	$İ”©Ü
()(* 
v
)

618 { ((*
Ëá
)(
v
è&& (*
right
)(v));
	}
}

622 
	gLogics
::
Log
* 
Logics
::
LogAND
::
	$şÚe
()

624 
Log
* 
l
=
Ëá
->
	`şÚe
();

625 
Log
* 
r
=
right
->
	`şÚe
();

626  
Ãw
 
	`LogAND
(
l
,
r
);

627 
	}
}

636 
	gLogics
::
LogOR
::
	$LogOR
(
Log
* 
l
,Log* 
r
):
	`LogBš¬yOp
Ö,r,"Ü",
Œue
)

637 {
	}
}

641 
boŞ
 
	gLogics
::
LogOR
::
	$İ”©Ü
()()

642 { ((*
Ëá
)(è|| (*
right
)());
	}
}

646 
boŞ
 
	gLogics
::
LogOR
::
	$İ”©Ü
()(* 
v
)

647 { ((*
Ëá
)(
v
è|| (*
right
)(v));
	}
}

651 
	gLogics
::
Log
* 
Logics
::
LogOR
::
	$şÚe
()

653 
Log
* 
l
=
Ëá
->
	`şÚe
();

654 
Log
* 
r
=
right
->
	`şÚe
();

655  
Ãw
 
	`LogOR
(
l
,
r
);

656 
	}
}

665 
	gLogics
::
LogCÚd
::
	$LogCÚd
(
Log
* 
l
,Log* 
r
,cÚ¡ * 
İ_Çme
,cÚ¡ 
boŞ
 
_is_
):

666 
	`Log
(
İ_Çme
,
_is_
),
	`Ëá
(
l
),
	$right
(
r
)

668 
	}
}

672 
	gLogics
::
LogCÚd
::~
	$LogCÚd
()

674 
d–‘e
 
Ëá
;

675 
d–‘e
 
right
;

676 
	}
}

685 
	gLogics
::
LogIF
::
	$LogIF
(
Log
* 
l
,Log* 
r
):
	`LogCÚd
Ö,r,"if",
Œue
)

686 {
	}
}

690 
boŞ
 
	gLogics
::
LogIF
::
	$İ”©Ü
()()

692 if(!(*
Ëá
)())

693  
Œue
;

694 if((*
right
)())

695  
Œue
;

697  
çl£
;

698 
	}
}

702 
boŞ
 
	gLogics
::
LogIF
::
	$İ”©Ü
()(* 
v
)

705 if(!(*
Ëá
)(
v
))

706  
Œue
;

708 if((*
right
)(
v
))

709  
Œue
;

710  
çl£
;

711 
	}
}

715 
	gLogics
::
Log
* 
Logics
::
LogIF
::
	$şÚe
()

717 
Log
* 
l
=
Ëá
->
	`şÚe
();

718 
Log
* 
r
=
right
->
	`şÚe
();

719  
Ãw
 
	`LogIF
(
l
,
r
);

720 
	}
}

724 
	gLogics
::
LogIF
::
	$´št
(
¡d
::
¡ršg
& 
”r_msg
,¡d::¡ršg& 
L
,¡d::¡ršg& 
İ
,¡d::¡ršg& 
R
,
boŞ
& 
__is__
,¡d::¡ršg& 
d–
,
v_æag
,boŞ& 
p_æag
)

726 
	`fšish_¢Šc
(
”r_msg
,
L
,
İ
,
R
,
__is__
,
d–
,
v_æag
,
p_æag
);

727 if(!
”r_msg
.
	`em±y
())

728 
”r_msg
+=". ";

730 
v_æag
=
AUX_VERB
;

731 
right
->
	`´št
(
”r_msg
,
L
,
İ
,
R
,
__is__
,
d–
,
v_æag
,
p_æag
);

732 
	`fšish_¢Šc
(
”r_msg
,
L
,
İ
,
R
,
__is__
,
d–
,
v_æag
,
p_æag
);

734 
”r_msg
+=", when ";

736 
v_æag
=
VERB
;

737 
Ëá
->
	`´št
(
”r_msg
,
L
,
İ
,
R
,
__is__
,
d–
,
v_æag
,
p_æag
);

738 
	}
}

742 
	gLogics
::
LogIF
::
	$´št
(
¡d
::
¡ršg
& 
”r_msg
,¡d::¡ršg& 
L
,¡d::¡ršg& 
İ
,¡d::¡ršg& 
R
,
boŞ
& 
__is__
,¡d::¡ršg& 
d–
,
v_æag
,boŞ& 
p_æag
,* 
v
)

744 
	`fšish_¢Šc
(
”r_msg
,
L
,
İ
,
R
,
__is__
,
d–
,
v_æag
,
p_æag
);

745 if(!
”r_msg
.
	`em±y
())

746 
”r_msg
+=". ";

748 
	`fšish_¢Šc
(
”r_msg
,
L
,
İ
,
R
,
__is__
,
d–
,
v_æag
,
p_æag
);

749 if(!
”r_msg
.
	`em±y
())

750 
”r_msg
+=". ";

752 
v_æag
=
AUX_VERB
;

753 
right
->
	`´št
(
”r_msg
,
L
,
İ
,
R
,
__is__
,
d–
,
v_æag
,
p_æag
,
v
);

754 
	`fšish_¢Šc
(
”r_msg
,
L
,
İ
,
R
,
__is__
,
d–
,
v_æag
,
p_æag
);

756 
”r_msg
+=", when ";

758 
v_æag
=
VERB
;

759 
Ëá
->
	`´št
(
”r_msg
,
L
,
İ
,
R
,
__is__
,
d–
,
v_æag
,
p_æag
,
v
);

760 
	}
}

769 
	gLogics
::
LogIFF
::
	$LogIFF
(
Log
* 
l
,Log* 
r
):
	`LogCÚd
Ö,r,"iff",
Œue
)

770 {
	}
}

774 
boŞ
 
	gLogics
::
LogIFF
::
	$İ”©Ü
()()

776 if((*
Ëá
)())

778 if((*
right
)())

779  
Œue
;

782 if(!(*
right
)())

783  
Œue
;

785  
çl£
;

786 
	}
}

790 
boŞ
 
	gLogics
::
LogIFF
::
	$İ”©Ü
()(* 
v
)

792 if((*
Ëá
)(
v
))

794 if((*
right
)(
v
))

795  
Œue
;

798 if(!(*
right
)(
v
))

799  
Œue
;

801  
çl£
;

802 
	}
}

806 
	gLogics
::
Log
* 
Logics
::
LogIFF
::
	$şÚe
()

808 
Log
* 
l
=
Ëá
->
	`şÚe
();

809 
Log
* 
r
=
right
->
	`şÚe
();

810  
Ãw
 
	`LogIFF
(
l
,
r
);

811 
	}
}

815 
	gLogics
::
LogIFF
::
	$´št
(
¡d
::
¡ršg
& 
”r_msg
,¡d::¡ršg& 
L
,¡d::¡ršg& 
İ
,¡d::¡ršg& 
R
,
boŞ
& 
__is__
,¡d::¡ršg& 
d–
,
v_æag
,boŞ& 
p_æag
)

817 
	`fšish_¢Šc
(
”r_msg
,
L
,
İ
,
R
,
__is__
,
d–
,
v_æag
,
p_æag
);

818 if(!
”r_msg
.
	`em±y
())

819 
”r_msg
+=". ";

821 
v_æag
=
AUX_VERB
;

822 
right
->
	`´št
(
”r_msg
,
L
,
İ
,
R
,
__is__
,
d–
,
v_æag
,
p_æag
);

823 
	`fšish_¢Šc
(
”r_msg
,
L
,
İ
,
R
,
__is__
,
d–
,
v_æag
,
p_æag
);

824 
”r_msg
+=", if‡nd only if ";

826 
v_æag
=
VERB
;

827 
Ëá
->
	`´št
(
”r_msg
,
L
,
İ
,
R
,
__is__
,
d–
,
v_æag
,
p_æag
);

828 
	}
}

832 
	gLogics
::
LogIFF
::
	$´št
(
¡d
::
¡ršg
& 
”r_msg
,¡d::¡ršg& 
L
,¡d::¡ršg& 
İ
,¡d::¡ršg& 
R
,
boŞ
& 
__is__
,¡d::¡ršg& 
d–
,
v_æag
,boŞ& 
p_æag
,* 
v
)

834 
	`fšish_¢Šc
(
”r_msg
,
L
,
İ
,
R
,
__is__
,
d–
,
v_æag
,
p_æag
);

835 if(!
”r_msg
.
	`em±y
())

836 
”r_msg
+=". ";

838 
v_æag
=
AUX_VERB
;

839 
right
->
	`´št
(
”r_msg
,
L
,
İ
,
R
,
__is__
,
d–
,
v_æag
,
p_æag
,
v
);

840 
	`fšish_¢Šc
(
”r_msg
,
L
,
İ
,
R
,
__is__
,
d–
,
v_æag
,
p_æag
);

841 
”r_msg
+=", if‡nd only if ";

843 
v_æag
=
VERB
;

844 
Ëá
->
	`´št
(
”r_msg
,
L
,
İ
,
R
,
__is__
,
d–
,
v_æag
,
p_æag
,
v
);

845 
	}
}

	@logics.h

1 #iâdeà
__MAPP__logics__


2 
	#__MAPP__logics__


	)

3 
	~"v¬_İ.h
"

4 ’um {
	mVERB
,
	mAUX_VERB
};

14 
Çme¥aû
 
	gMAPP_NS


16 şas 
	cLogics


18 
	g´iv©e
:

19 
´Ùeùed
:

20 
şass
 
Log
;

22 
	g‹m¶©e
<
şass
 
	gV¬CÏss
> cÏs 
	gLogUÇry
;

23 
	g‹m¶©e
<
şass
 
	gV¬CÏss
> cÏs 
	gLogIS
;

25 
	g‹m¶©e
<
şass
 
	gV¬CÏss
> cÏs 
	gLogBš¬y
;

26 
	g‹m¶©e
<
şass
 
	gV¬CÏss
> cÏs 
	gLogGT
;

27 
	g‹m¶©e
<
şass
 
	gV¬CÏss
> cÏs 
	gLogGE
;

28 
	g‹m¶©e
<
şass
 
	gV¬CÏss
> cÏs 
	gLogEQ
;

29 
	g‹m¶©e
<
şass
 
	gV¬CÏss
> cÏs 
	gLogLE
;

30 
	g‹m¶©e
<
şass
 
	gV¬CÏss
> cÏs 
	gLogLT
;

31 
şass
 
	gLogBš¬yOp
;

32 
şass
 
	gLogAND
;

33 
şass
 
	gLogOR
;

34 
şass
 
	gLogCÚd
;

35 
şass
 
	gLogIF
;

36 
şass
 
	gLogIFF
;

38 
	g‹m¶©e
<
şass
 
	gV¬CÏss
>

39 
ü—t_İ
(
V¬CÏss
*,
boŞ
,VarClass*,bool,const *);

40 
	g‹m¶©e
<
şass
 
	gV¬CÏss
>

41 
ü—t_İ
(
V¬CÏss
*,
boŞ
,const *);

43 
	gpublic
:

44 
Logics
();

45 
	g‹m¶©e
<
şass
 
	gT0
,şas 
	gT1
>

46 
Logics
(
T0
&,cÚ¡ *,
T1
&);

47 
	g‹m¶©e
<
şass
 
	gT0
,şas 
	gT1
>

48 
Logics
(
T0
&,cÚ¡ *,
T1
&&);

49 
	g‹m¶©e
<
şass
 
	gT0
>

50 
Logics
(
T0
&,const *);

51 
Logics
(Logics&);

52 
Logics
(Logics&&);

53 ~
Logics
();

58 
	gLogics
& 
	gİ”©Ü
 = (
Logics
&);

59 
	gLogics
& 
	gİ”©Ü
 = (
Logics
&&);

60 
	gLogics
&& 
	gİ”©Ü
 + (Logics&&);

61 
	gLogics
&& 
	gİ”©Ü
 * (Logics&&);

62 
	gLogics
&& 
	gİ”©Ü
 - (Logics&&);

63 
	gLogics
&& 
	gİ”©Ü
 / (Logics&&);

64 
	gLogics
& 
	gİ”©Ü
 +ğ(
Logics
&&);

65 
	gLogics
& 
	gİ”©Ü
 *ğ(
Logics
&&);

66 
	gLogics
& 
	gİ”©Ü
 -ğ(
Logics
&&);

67 
	gLogics
& 
	gİ”©Ü
 /ğ(
Logics
&&);

69 
Log
* 
	gİ
;

70 
Logics
* 
	gÃxt
;

72 
	gLogics
& 
lšk
();

75 
	g¡d
::
¡ršg
 
´št
(*);

76 
	g¡d
::
¡ršg
 
İ”©Ü
()(*);

77 
	g¡d
::
¡ršg
 
İ”©Ü
()();

78 
v¬_log
(
V¬
*,
Logics
*);

79 
boŞ
 
v¬_log_nÙhrow
(
V¬
*,
Logics
*);

82 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

86 
	g‹m¶©e
<
şass
 
	gT0
,şas 
	gT1
>

87 
	gLogics
::
	$Logics
(
T0
& 
v¬_l
,cÚ¡ * 
s
,
T1
& 
v¬_r
)

89 
boŞ
 
l_®loc
=
çl£
,
r_®loc
=false;

90 
V¬
* 
l
=V¬::
	`fšd_v¬
(
v¬_l
);

91 
V¬
* 
r
=V¬::
	`fšd_v¬
(
v¬_r
);

93 if(!
l
)

95 
l
=
Ãw
 
v¬
<
T0
>(
¡d
::
	`move
(
v¬_l
));

96 
l_®loc
=
Œue
;

98 if(!
r
)

100 
r
=
Ãw
 
v¬
<
T1
>(
¡d
::
	`move
(
v¬_r
));

101 
r_®loc
=
Œue
;

103 
	`ü—t_İ
(
l
,
l_®loc
,
r
,
r_®loc
,
s
);

104 
	}
}

108 
	g‹m¶©e
<
şass
 
	gT0
,şas 
	gT1
>

109 
	gLogics
::
	$Logics
(
T0
& 
v¬_l
,cÚ¡ * 
s
,
T1
&& 
v¬_r
)

111 
boŞ
 
l_®loc
=
çl£
,
r_®loc
=false;

112 
V¬
* 
l
=V¬::
	`fšd_v¬
(
v¬_l
);

113 
V¬
* 
r
=V¬::
	`fšd_v¬
(
v¬_r
);

115 if(!
l
)

117 
l
=
Ãw
 
v¬
<
T0
>(
¡d
::
	`move
(
v¬_l
));

118 
l_®loc
=
Œue
;

120 if(!
r
)

122 
r
=
Ãw
 
v¬
<
T1
>(
¡d
::
	`move
(
v¬_r
));

123 
r_®loc
=
Œue
;

125 
	`ü—t_İ
(
l
,
l_®loc
,
r
,
r_®loc
,
s
);

126 
	}
}

130 
	g‹m¶©e
<
şass
 
	gT0
>

131 
	gLogics
::
	$Logics
(
T0
& 
v¬_l
,cÚ¡ * 
s
)

133 
boŞ
 
l_®loc
=
çl£
;

134 
V¬
* 
l
=V¬::
	`fšd_v¬
(
v¬_l
);

141 
	`ü—t_İ
(
l
,
l_®loc
,
s
);

142 
	}
}

146 
	g‹m¶©e
<
şass
 
	gV¬CÏss
>

147 
	gLogics
::
	$ü—t_İ
(
V¬CÏss
* 
l
,
boŞ
 
l_®loc
,cÚ¡ * 
İ_Çme
)

149 if(!
	`¡rcmp
(
İ_Çme
,"set"))

150 
İ
=
Ãw
 
LogIS
<
V¬CÏss
>(
l
,
l_®loc
,
Œue
);

151 if(!
	`¡rcmp
(
İ_Çme
,"nset") || !strcmp(op_name,"!set"))

152 
İ
=
Ãw
 
LogIS
<
V¬CÏss
>(
l
,
l_®loc
,
çl£
);

154 
Ãxt
=
NULL
;

155 
	}
}

159 
	g‹m¶©e
<
şass
 
	gV¬CÏss
>

160 
	gLogics
::
	$ü—t_İ
(
V¬CÏss
* 
l
,
boŞ
 
l_®loc
,V¬CÏss* 
r
,boŞ 
r_®loc
,cÚ¡ * 
İ_Çme
)

162 if(!
	`¡rcmp
(
İ_Çme
,"gt"))

163 
İ
=
Ãw
 
LogGT
<
V¬CÏss
>(
l
,
l_®loc
,
r
,
r_®loc
,
Œue
);

164 if(!
	`¡rcmp
(
İ_Çme
,"ngt") || !strcmp(op_name,"!gt"))

165 
İ
=
Ãw
 
LogGT
<
V¬CÏss
>(
l
,
l_®loc
,
r
,
r_®loc
,
çl£
);

166 if(!
	`¡rcmp
(
İ_Çme
,"ge"))

167 
İ
=
Ãw
 
LogGE
<
V¬CÏss
>(
l
,
l_®loc
,
r
,
r_®loc
,
Œue
);

168 if(!
	`¡rcmp
(
İ_Çme
,"nge") || !strcmp(op_name,"!ge"))

169 
İ
=
Ãw
 
LogGE
<
V¬CÏss
>(
l
,
l_®loc
,
r
,
r_®loc
,
çl£
);

170 if(!
	`¡rcmp
(
İ_Çme
,"eq"))

171 
İ
=
Ãw
 
LogEQ
<
V¬CÏss
>(
l
,
l_®loc
,
r
,
r_®loc
,
Œue
);

172 if(!
	`¡rcmp
(
İ_Çme
,"neq") || !strcmp(op_name,"!eq"))

173 
İ
=
Ãw
 
LogEQ
<
V¬CÏss
>(
l
,
l_®loc
,
r
,
r_®loc
,
çl£
);

174 if(!
	`¡rcmp
(
İ_Çme
,"lt"))

175 
İ
=
Ãw
 
LogLT
<
V¬CÏss
>(
l
,
l_®loc
,
r
,
r_®loc
,
Œue
);

176 if(!
	`¡rcmp
(
İ_Çme
,"nlt") || !strcmp(op_name,"!lt"))

177 
İ
=
Ãw
 
LogLT
<
V¬CÏss
>(
l
,
l_®loc
,
r
,
r_®loc
,
çl£
);

178 if(!
	`¡rcmp
(
İ_Çme
,"le"))

179 
İ
=
Ãw
 
LogLE
<
V¬CÏss
>(
l
,
l_®loc
,
r
,
r_®loc
,
Œue
);

180 if(!
	`¡rcmp
(
İ_Çme
,"nle") || !strcmp(op_name,"!le"))

181 
İ
=
Ãw
 
LogLE
<
V¬CÏss
>(
l
,
l_®loc
,
r
,
r_®loc
,
çl£
);

182 
Ãxt
=
NULL
;

183 
	}
}

192 
Çme¥aû
 
	gMAPP_NS


194 şas 
	cVLogics
: 
public
 
Logics


196 
´iv©e
:

197 
´Ùeùed
:

198 
public
:

199 
‹m¶©e
<
ty³Çme
 
T
>

200 
VLogics
(cÚ¡ *,
T
&&);

201 
	g‹m¶©e
<
ty³Çme
 
	gT
>

202 
VLogics
(cÚ¡ *,
T
&);

203 
VLogics
(cÚ¡ * 
s
);

209 
	g‹m¶©e
<
şass
 
	gT
>

210 
	gVLogics
::
	$VLogics
(cÚ¡ * 
s
,
T
& 
v¬_r
):

211 
	$Logics
()

213 
boŞ
 
r_®loc
=
çl£
;

214 
V¬
* 
r
=V¬::
	`fšd_v¬
(
v¬_r
);

215 if(!
r
)

217 
r
=
Ãw
 
v¬
<
T
>(
¡d
::
	`move
(
v¬_r
));

218 
r_®loc
=
Œue
;

220 
V¬
* 
l
=
NULL
;

221 
	`ü—t_İ
(
l
,
çl£
,
r
,
r_®loc
,
s
);

222 
	}
}

226 
	g‹m¶©e
<
şass
 
	gT
>

227 
	gVLogics
::
	$VLogics
(cÚ¡ * 
s
,
T
&& 
v¬_r
):

228 
	$Logics
()

230 
boŞ
 
r_®loc
=
çl£
;

231 
V¬
* 
r
=V¬::
	`fšd_v¬
(
v¬_r
);

232 if(!
r
)

234 
r
=
Ãw
 
v¬
<
T
>(
¡d
::
	`move
(
v¬_r
));

235 
r_®loc
=
Œue
;

237 
V¬
* 
l
=
NULL
;

238 
	`ü—t_İ
(
l
,
çl£
,
r
,
r_®loc
,
s
);

239 
	}
}

243 
šlše
 
	gVLogics
::
	$VLogics
(cÚ¡ * 
s
):

244 
	$Logics
()

246 
V¬
* 
l
=
NULL
;

247 
	`ü—t_İ
(
l
,
çl£
,
s
);

248 
	}
}

257 
Çme¥aû
 
	gMAPP_NS


259 şas 
	cLogics
::
Log


261 
´iv©e
:

262 
´Ùeùed
:

263 
public
:

264 cÚ¡ 
¡d
::
¡ršg
 
v”b_aux
;

265 cÚ¡ 
	g¡d
::
¡ršg
 
Ãg©e
;

266 cÚ¡ 
	g¡d
::
¡ršg
 
v”b
;

267 cÚ¡ 
	g¡d
::
¡ršg
 
s_v”b
;

268 cÚ¡ 
	g¡d
::
¡ršg
 
p_v”b
;

269 cÚ¡ 
	g¡d
::
¡ršg
 
s_n_v”b
;

270 cÚ¡ 
	g¡d
::
¡ršg
 
p_n_v”b
;

271 
	g¡d
::
¡ršg
 
İ_Çme
;

272 cÚ¡ 
boŞ
 
	g_is_
;

273 
Log
(
¡d
::
¡ršg
&&,cÚ¡ 
boŞ
);

274 
	gvœtu®
 ~
Log
();

275 
fšish_¢Šc
(
¡d
::
¡ršg
&,¡d::¡ršg&,¡d::¡ršg&,¡d::¡ršg&,
boŞ
&,std::string&,,bool&);

276 
¡¬t_¢Šc
(
¡d
::
¡ršg
&,std::string&,std::string&,,const std::string&,const std::string&);

277 
´oûss_¢Šc
(
¡d
::
¡ršg
&,¡d::¡ršg&,¡d::¡ršg&,¡d::¡ršg&,
boŞ
&,std::string&,,bool&,const std::string&,const std::string&);

278 
vœtu®
 
boŞ
 
İ”©Ü
() ()=0;

279 
vœtu®
 
boŞ
 
İ”©Ü
() (*)=0;

280 
vœtu®
 
´št
(
¡d
::
¡ršg
&,¡d::¡ršg&,¡d::¡ršg&,¡d::¡ršg&,
boŞ
&,std::string&,,bool&)=0;

281 
vœtu®
 
´št
(
¡d
::
¡ršg
&,¡d::¡ršg&,¡d::¡ršg&,¡d::¡ršg&,
boŞ
&,std::string&,,bool&,*)=0;

282 
eq
(const *,const *);

283 
vœtu®
 
Log
* 
şÚe
()=0;

294 
Çme¥aû
 
	gMAPP_NS


296 
	g‹m¶©e
<
şass
 
	gV¬CÏss
>

297 şas 
	cLogics
::
LogUÇry
:
public
 
Log


299 
public
:

300 
V¬CÏss
* 
Ëá
;

301 cÚ¡ 
boŞ
 
	gËá_®loc
;

302 
LogUÇry
(
V¬CÏss
*,cÚ¡ 
boŞ
,
¡d
::
¡ršg
&&,const bool);

303 
	gvœtu®
 ~
LogUÇry
();

304 
´št
(
¡d
::
¡ršg
&,¡d::¡ršg&,¡d::¡ršg&,¡d::¡ršg&,
boŞ
&,std::string&,,bool&);

305 
´št
(
¡d
::
¡ršg
&,¡d::¡ršg&,¡d::¡ršg&,¡d::¡ršg&,
boŞ
&,std::string&,,bool&,*);

306 
vœtu®
 
Log
* 
şÚe
()=0;

307 
vœtu®
 
boŞ
 
İ”©Ü
() ()=0;

308 
vœtu®
 
boŞ
 
İ”©Ü
() (*);

314 
	g‹m¶©e
<
şass
 
	gV¬CÏss
>

315 
	gLogics
::
LogUÇry
<
V¬CÏss
>::
	$LogUÇry
(
V¬CÏss
* 
l
,cÚ¡ 
boŞ
 
l_®loc
,
¡d
::
¡ršg
&& 
İ_Çme
,cÚ¡ boŞ 
_is_
):

316 
	`Log
(
¡d
::
	`move
(
İ_Çme
),
_is_
),

317 
	`Ëá
(
l
),
	$Ëá_®loc
(
l_®loc
)

318 {
	}
}

322 
	g‹m¶©e
<
şass
 
	gV¬CÏss
>

323 
	gLogics
::
LogUÇry
<
V¬CÏss
>::~
	$LogUÇry
()

325 if(
Ëá_®loc
è
d–‘e
 
Ëá
;

326 
	}
}

330 
	g‹m¶©e
<
şass
 
	gV¬CÏss
>

331 
	gLogics
::
LogUÇry
<
V¬CÏss
>::
	$´št
(
¡d
::
¡ršg
& 
”r_msg
,¡d::¡ršg& 
L
,¡d::¡ršg& 
İ
,¡d::¡ršg& 
R
,
boŞ
& 
__is__
,¡d::¡ršg& 
d–
,
v_æag
,boŞ& 
p_æag
)

333 
	`´oûss_¢Šc
(
”r_msg
,
L
,
İ
,
R
,
__is__
,
d–
,
v_æag
,
p_æag
,
Ëá
->
Çme
,
¡d
::
	`¡ršg
());

334 
	}
}

338 
	g‹m¶©e
<
şass
 
	gV¬CÏss
>

339 
	gLogics
::
LogUÇry
<
V¬CÏss
>::
	$´št
(
¡d
::
¡ršg
& 
”r_msg
,¡d::¡ršg& 
L
,¡d::¡ršg& 
İ
,¡d::¡ršg& 
R
,
boŞ
& 
__is__
,¡d::¡ršg& 
d–
,
v_æag
,boŞ& 
p_æag
,* 
v
)

341 
i
=0;

342 if(
Ëá
==
NULL
)

345 
Ëá
=
¡©ic_ÿ¡
<
V¬CÏss
*>(
v
);

346 
i
++;

348 
	`´oûss_¢Šc
(
”r_msg
,
L
,
İ
,
R
,
__is__
,
d–
,
v_æag
,
p_æag
,
Ëá
->
Çme
,
¡d
::
	`¡ršg
());

350 if(
i
è
Ëá
=
NULL
;

351 
	}
}

355 
	g‹m¶©e
<
şass
 
	gV¬CÏss
>

356 
boŞ
 
	gLogics
::
LogUÇry
<
V¬CÏss
>::
	$İ”©Ü
()(* 
v
)

358 
i
=0;

359 if(
Ëá
==
NULL
)

361 
Ëá
=
¡©ic_ÿ¡
<
V¬CÏss
*>(
v
);

362 
i
++;

365 
boŞ
 
ªs
 =
this
->
	`İ”©Ü
()();

368 if(
i
)

369 
Ëá
=
NULL
;

370  
ªs
;

371 
	}
}

380 
Çme¥aû
 
	gMAPP_NS


383 
	g‹m¶©e
<
şass
 
	gV¬CÏss
>

384 
şass
 
	gLogics
::
LogIS
:
public
 
LogUÇry
<
V¬CÏss
>

386 
public
:

387 
LogIS
(
V¬CÏss
*,cÚ¡ 
boŞ
,const bool);

388 
boŞ
 
İ”©Ü
() ();

389 
Log
* 
şÚe
();

395 
	g‹m¶©e
<
şass
 
	gV¬CÏss
>

396 
	gLogics
::
LogIS
<
V¬CÏss
>::
	$LogIS
(
V¬CÏss
* 
l
,cÚ¡ 
boŞ
 
l_®loc
,cÚ¡ boŞ 
_is_
):
LogUÇry
<V¬CÏss>Ö,l_®loc,
¡d
::
	`¡ršg
("set"),_is_)

397 {
	}
}

401 
	g‹m¶©e
<
şass
 
	gV¬CÏss
>

402 
boŞ
 
	gLogics
::
LogIS
<
V¬CÏss
>::
	$İ”©Ü
() ()

404 if(
Log
::
_is_
)

405  (
LogUÇry
<
V¬CÏss
>::
Ëá
->
	`is_£t
());

407  !(
LogUÇry
<
V¬CÏss
>::
Ëá
->
	`is_£t
());

408 
	}
}

412 
	g‹m¶©e
<
şass
 
	gV¬CÏss
>

413 
	gLogics
::
Log
* 
Logics
::
LogIS
<
V¬CÏss
>::
	$şÚe
()

415 
LogIS
<
V¬CÏss
>* 
log
=
Ãw
 
	`LogIS
(
LogUÇry
<V¬CÏss>::
Ëá
,LogUÇry<V¬CÏss>::
Ëá_®loc
,
Log
::
_is_
);

416 if(
LogUÇry
<
V¬CÏss
>::
Ëá_®loc
)

417 
log
->
LogUÇry
<
V¬CÏss
>::
Ëá
=LogUÇry<V¬CÏss>::Ëá->
	`şÚe
();

418  
log
;

419 
	}
}

428 
Çme¥aû
 
	gMAPP_NS


430 
	g‹m¶©e
<
şass
 
	gV¬CÏss
>

431 şas 
	cLogics
::
LogBš¬y
:
public
 
Log


433 
public
:

434 
V¬CÏss
* 
Ëá
;

435 
boŞ
 
	gËá_®loc
;

436 
V¬CÏss
* 
	gright
;

437 
boŞ
 
	gright_®loc
;

438 
LogBš¬y
(
V¬CÏss
*,cÚ¡ 
boŞ
,VarClass*,const bool,const *,const bool);

439 ~
LogBš¬y
();

440 
´št
(
¡d
::
¡ršg
&,¡d::¡ršg&,¡d::¡ršg&,¡d::¡ršg&,
boŞ
&,std::string&,,bool&);

441 
´št
(
¡d
::
¡ršg
&,¡d::¡ršg&,¡d::¡ršg&,¡d::¡ršg&,
boŞ
&,std::string&,,bool&,*);

442 
vœtu®
 
Log
* 
şÚe
()=0;

443 
vœtu®
 
boŞ
 
İ”©Ü
() ()=0;

444 
vœtu®
 
boŞ
 
İ”©Ü
() (*);

450 
	g‹m¶©e
<
şass
 
	gV¬CÏss
>

451 
	gLogics
::
LogBš¬y
<
V¬CÏss
>::
	$LogBš¬y
(
V¬CÏss
* 
l
,cÚ¡ 
boŞ
 
l_®loc
,V¬CÏss* 
r
,cÚ¡ boŞ 
r_®loc
,cÚ¡ * 
İ_Çme
,cÚ¡ boŞ 
_is_
):

452 
	`Log
(
İ_Çme
,
_is_
),
	`Ëá
(
l
),
	`right
(
r
),
	`Ëá_®loc
(
l_®loc
),
	$right_®loc
(
r_®loc
)

453 {
	}
}

457 
	g‹m¶©e
<
şass
 
	gV¬CÏss
>

458 
	gLogics
::
LogBš¬y
<
V¬CÏss
>::~
	$LogBš¬y
()

460 if(
Ëá_®loc
è
d–‘e
 
Ëá
;

461 if(
right_®loc
è
d–‘e
 
right
;

462 
	}
}

466 
	g‹m¶©e
<
şass
 
	gV¬CÏss
>

467 
	gLogics
::
LogBš¬y
<
V¬CÏss
>::
	$´št
(
¡d
::
¡ršg
& 
”r_msg
,¡d::¡ršg& 
L
,¡d::¡ršg& 
İ
,¡d::¡ršg& 
R
,
boŞ
& 
__is__
,¡d::¡ršg& 
d–
,
v_æag
,boŞ& 
p_æag
)

469 
	`´oûss_¢Šc
(
”r_msg
,
L
,
İ
,
R
,
__is__
,
d–
,
v_æag
,
p_æag
,
Ëá
->
Çme
,
right
->name);

470 
	}
}

474 
	g‹m¶©e
<
şass
 
	gV¬CÏss
>

475 
	gLogics
::
LogBš¬y
<
V¬CÏss
>::
	$´št
(
¡d
::
¡ršg
& 
”r_msg
,¡d::¡ršg& 
L
,¡d::¡ršg& 
İ
,¡d::¡ršg& 
R
,
boŞ
& 
__is__
,¡d::¡ršg& 
d–
,
v_æag
,boŞ& 
p_æag
,* 
v
)

477 
i
=0;

478 if(
Ëá
==
NULL
)

480 
Ëá
=
¡©ic_ÿ¡
<
V¬CÏss
*>(
v
);

481 
i
++;

483 if(
right
==
NULL
)

485 
right
=
¡©ic_ÿ¡
<
V¬CÏss
*>(
v
);

486 
i
+=2;

488 
	`´oûss_¢Šc
(
”r_msg
,
L
,
İ
,
R
,
__is__
,
d–
,
v_æag
,
p_æag
,
Ëá
->
Çme
,
right
->name);

490 if(
i
>1)

492 
right
=
NULL
;

493 
i
-=2;

496 if(
i
)

497 
Ëá
=
NULL
;

498 
	}
}

502 
	g‹m¶©e
<
şass
 
	gV¬CÏss
>

503 
boŞ
 
	gLogics
::
LogBš¬y
<
V¬CÏss
>::
	$İ”©Ü
()(* 
v
)

505 
i
=0;

506 if(
Ëá
==
NULL
)

508 
Ëá
=
¡©ic_ÿ¡
<
V¬CÏss
*>(
v
);

509 
i
++;

511 if(
right
==
NULL
)

513 
right
=
¡©ic_ÿ¡
<
V¬CÏss
*>(
v
);

514 
i
+=2;

516 
boŞ
 
ªs
 =
this
->
	`İ”©Ü
()();

518 if(
i
>1)

520 
right
=
NULL
;

521 
i
-=2;

524 if(
i
)

525 
Ëá
=
NULL
;

526  
ªs
;

527 
	}
}

536 
Çme¥aû
 
	gMAPP_NS


538 
	g‹m¶©e
<
şass
 
	gV¬CÏss
>

539 
şass
 
	gLogics
::
LogGT
:
public
 
LogBš¬y
<
V¬CÏss
>

541 
public
:

542 
LogGT
(
V¬CÏss
*,cÚ¡ 
boŞ
,VarClass*,const bool,const bool);

543 
boŞ
 
İ”©Ü
() ();

544 
Log
* 
şÚe
();

550 
	g‹m¶©e
<
şass
 
	gV¬CÏss
>

551 
	gLogics
::
LogGT
<
V¬CÏss
>::
	$LogGT
(
V¬CÏss
* 
l
,cÚ¡ 
boŞ
 
l_®loc
,V¬CÏss* 
r
,cÚ¡ boŞ 
r_®loc
,cÚ¡ boŞ 
_is_
):
LogBš¬y
<VarClass>(l,l_alloc,r,r_alloc,"greaterhan",_is_)

552 {
	}
}

556 
	g‹m¶©e
<
şass
 
	gV¬CÏss
>

557 
boŞ
 
	gLogics
::
LogGT
<
V¬CÏss
>::
	$İ”©Ü
() ()

559 if(
Log
::
_is_
)

560  (*
LogBš¬y
<
V¬CÏss
>::
Ëá
 > *LogBš¬y<V¬CÏss>::
right
);

562  !(*
LogBš¬y
<
V¬CÏss
>::
Ëá
 > *LogBš¬y<V¬CÏss>::
right
);

563 
	}
}

567 
	g‹m¶©e
<
şass
 
	gV¬CÏss
>

568 
	gLogics
::
Log
* 
Logics
::
LogGT
<
V¬CÏss
>::
	$şÚe
()

570 
LogGT
<
V¬CÏss
>* 
log
=
Ãw
 
	`LogGT
(
LogBš¬y
<V¬CÏss>::
Ëá
,LogBš¬y<V¬CÏss>::
Ëá_®loc
,LogBš¬y<V¬CÏss>::
right
,LogBš¬y<V¬CÏss>::
right_®loc
,
Log
::
_is_
);

571 if(
LogBš¬y
<
V¬CÏss
>::
Ëá_®loc
)

572 
log
->
LogBš¬y
<
V¬CÏss
>::
Ëá
=LogBš¬y<V¬CÏss>::Ëá->
	`şÚe
();

573 if(
LogBš¬y
<
V¬CÏss
>::
right_®loc
)

574 
log
->
LogBš¬y
<
V¬CÏss
>::
right
=LogBš¬y<V¬CÏss>::right->
	`şÚe
();

575  
log
;

576 
	}
}

585 
Çme¥aû
 
	gMAPP_NS


587 
	g‹m¶©e
<
şass
 
	gV¬CÏss
>

588 
şass
 
	gLogics
::
LogGE
:
public
 
LogBš¬y
<
V¬CÏss
>

590 
public
:

591 
LogGE
(
V¬CÏss
*,cÚ¡ 
boŞ
,VarClass*,const bool,const bool);

592 
boŞ
 
İ”©Ü
() ();

593 
Log
* 
şÚe
();

599 
	g‹m¶©e
<
şass
 
	gV¬CÏss
>

600 
	gLogics
::
LogGE
<
V¬CÏss
>::
	$LogGE
(
V¬CÏss
* 
l
,cÚ¡ 
boŞ
 
l_®loc
,V¬CÏss* 
r
,cÚ¡ boŞ 
r_®loc
,cÚ¡ boŞ 
_is_
):
LogBš¬y
<VarClass>(l,l_alloc,r,r_alloc,"greaterhan orƒqualo",_is_)

601 {
	}
}

605 
	g‹m¶©e
<
şass
 
	gV¬CÏss
>

606 
boŞ
 
	gLogics
::
LogGE
<
V¬CÏss
>::
	$İ”©Ü
() ()

608 if(
Log
::
_is_
)

609  (*
LogBš¬y
<
V¬CÏss
>::
Ëá
 >ğ*LogBš¬y<V¬CÏss>::
right
);

611  !(*
LogBš¬y
<
V¬CÏss
>::
Ëá
 >ğ*LogBš¬y<V¬CÏss>::
right
);

612 
	}
}

616 
	g‹m¶©e
<
şass
 
	gV¬CÏss
>

617 
	gLogics
::
Log
* 
Logics
::
LogGE
<
V¬CÏss
>::
	$şÚe
()

619 
Logics
::
LogGE
<
V¬CÏss
>* 
log
=
Ãw
 
	`LogGE
(
LogBš¬y
<V¬CÏss>::
Ëá
,LogBš¬y<V¬CÏss>::
Ëá_®loc
,LogBš¬y<V¬CÏss>::
right
,LogBš¬y<V¬CÏss>::
right_®loc
,
Log
::
_is_
);

620 if(
LogBš¬y
<
V¬CÏss
>::
Ëá_®loc
)

621 
log
->
LogBš¬y
<
V¬CÏss
>::
Ëá
=LogBš¬y<V¬CÏss>::Ëá->
	`şÚe
();

622 if(
LogBš¬y
<
V¬CÏss
>::
right_®loc
)

623 
log
->
LogBš¬y
<
V¬CÏss
>::
right
=LogBš¬y<V¬CÏss>::right->
	`şÚe
();

624  
log
;

625 
	}
}

634 
Çme¥aû
 
	gMAPP_NS


636 
	g‹m¶©e
<
şass
 
	gV¬CÏss
>

637 
şass
 
	gLogics
::
LogEQ
:
public
 
LogBš¬y
<
V¬CÏss
>

639 
public
:

640 
LogEQ
(
V¬CÏss
*,cÚ¡ 
boŞ
,VarClass*,const bool,const bool);

641 
boŞ
 
İ”©Ü
() ();

642 
Log
* 
şÚe
();

648 
	g‹m¶©e
<
şass
 
	gV¬CÏss
>

649 
	gLogics
::
LogEQ
<
V¬CÏss
>::
	$LogEQ
(
V¬CÏss
* 
l
,cÚ¡ 
boŞ
 
l_®loc
,V¬CÏss* 
r
,cÚ¡ boŞ 
r_®loc
,cÚ¡ boŞ 
_is_
):
LogBš¬y
<VarClass>(l,l_alloc,r,r_alloc,"equalo",_is_)

650 {
	}
}

654 
	g‹m¶©e
<
şass
 
	gV¬CÏss
>

655 
boŞ
 
	gLogics
::
LogEQ
<
V¬CÏss
>::
	$İ”©Ü
() ()

657 if(
Log
::
_is_
)

658  (*
LogBš¬y
<
V¬CÏss
>::
Ëá
 =ğ*LogBš¬y<V¬CÏss>::
right
);

660  !(*
LogBš¬y
<
V¬CÏss
>::
Ëá
 =ğ*LogBš¬y<V¬CÏss>::
right
);

661 
	}
}

665 
	g‹m¶©e
<
şass
 
	gV¬CÏss
>

666 
	gLogics
::
Log
* 
Logics
::
LogEQ
<
V¬CÏss
>::
	$şÚe
()

668 
LogEQ
<
V¬CÏss
>* 
log
=
Ãw
 
	`LogEQ
(
LogBš¬y
<V¬CÏss>::
Ëá
,LogBš¬y<V¬CÏss>::
Ëá_®loc
,LogBš¬y<V¬CÏss>::
right
,LogBš¬y<V¬CÏss>::
right_®loc
,
Log
::
_is_
);

669 if(
LogBš¬y
<
V¬CÏss
>::
Ëá_®loc
)

670 
log
->
LogBš¬y
<
V¬CÏss
>::
Ëá
=LogBš¬y<V¬CÏss>::Ëá->
	`şÚe
();

671 if(
LogBš¬y
<
V¬CÏss
>::
right_®loc
)

672 
log
->
LogBš¬y
<
V¬CÏss
>::
right
=LogBš¬y<V¬CÏss>::right->
	`şÚe
();

674  
log
;

675 
	}
}

684 
Çme¥aû
 
	gMAPP_NS


686 
	g‹m¶©e
<
şass
 
	gV¬CÏss
>

687 
şass
 
	gLogics
::
LogLE
:
public
 
LogBš¬y
<
V¬CÏss
>

689 
public
:

690 
LogLE
(
V¬CÏss
*,cÚ¡ 
boŞ
,VarClass*,const bool,const bool);

691 
boŞ
 
İ”©Ü
() ();

692 
Log
* 
şÚe
();

698 
	g‹m¶©e
<
şass
 
	gV¬CÏss
>

699 
	gLogics
::
LogLE
<
V¬CÏss
>::
	$LogLE
(
V¬CÏss
* 
l
,cÚ¡ 
boŞ
 
l_®loc
,V¬CÏss* 
r
,cÚ¡ boŞ 
r_®loc
,cÚ¡ boŞ 
_is_
):
LogBš¬y
<VarClass>(l,l_alloc,r,r_alloc,"lesshan orƒqualo",_is_)

700 {
	}
}

704 
	g‹m¶©e
<
şass
 
	gV¬CÏss
>

705 
boŞ
 
	gLogics
::
LogLE
<
V¬CÏss
>::
	$İ”©Ü
() ()

707 if(
Log
::
_is_
)

708  (*
LogBš¬y
<
V¬CÏss
>::
Ëá
 <ğ*LogBš¬y<V¬CÏss>::
right
);

710  !(*
LogBš¬y
<
V¬CÏss
>::
Ëá
 <ğ*LogBš¬y<V¬CÏss>::
right
);

711 
	}
}

715 
	g‹m¶©e
<
şass
 
	gV¬CÏss
>

716 
	gLogics
::
Log
* 
Logics
::
LogLE
<
V¬CÏss
>::
	$şÚe
()

718 
LogLE
<
V¬CÏss
>* 
log
=
Ãw
 
	`LogLE
(
LogBš¬y
<V¬CÏss>::
Ëá
,LogBš¬y<V¬CÏss>::
Ëá_®loc
,LogBš¬y<V¬CÏss>::
right
,LogBš¬y<V¬CÏss>::
right_®loc
,
Log
::
_is_
);

719 if(
LogBš¬y
<
V¬CÏss
>::
Ëá_®loc
)

720 
log
->
LogBš¬y
<
V¬CÏss
>::
Ëá
=LogBš¬y<V¬CÏss>::Ëá->
	`şÚe
();

721 if(
LogBš¬y
<
V¬CÏss
>::
right_®loc
)

722 
log
->
LogBš¬y
<
V¬CÏss
>::
right
=LogBš¬y<V¬CÏss>::right->
	`şÚe
();

723  
log
;

724 
	}
}

733 
Çme¥aû
 
	gMAPP_NS


735 
	g‹m¶©e
<
şass
 
	gV¬CÏss
>

736 
şass
 
	gLogics
::
LogLT
:
public
 
LogBš¬y
<
V¬CÏss
>

738 
public
:

739 
LogLT
(
V¬CÏss
*,cÚ¡ 
boŞ
,VarClass*,const bool,const bool);

740 
boŞ
 
İ”©Ü
() ();

741 
Log
* 
şÚe
();

747 
	g‹m¶©e
<
şass
 
	gV¬CÏss
>

748 
	gLogics
::
LogLT
<
V¬CÏss
>::
	$LogLT
(
V¬CÏss
* 
l
,cÚ¡ 
boŞ
 
l_®loc
,V¬CÏss* 
r
,cÚ¡ boŞ 
r_®loc
,cÚ¡ boŞ 
_is_
):
LogBš¬y
<VarClass>(l,l_alloc,r,r_alloc,"lesshan",_is_)

749 {
	}
}

753 
	g‹m¶©e
<
şass
 
	gV¬CÏss
>

754 
boŞ
 
	gLogics
::
LogLT
<
V¬CÏss
>::
	$İ”©Ü
() ()

756 if(
Log
::
_is_
)

757  (*
LogBš¬y
<
V¬CÏss
>::
Ëá
 < *LogBš¬y<V¬CÏss>::
right
);

759  !(*
LogBš¬y
<
V¬CÏss
>::
Ëá
 < *LogBš¬y<V¬CÏss>::
right
);

760 
	}
}

764 
	g‹m¶©e
<
şass
 
	gV¬CÏss
>

765 
	gLogics
::
Log
* 
Logics
::
LogLT
<
V¬CÏss
>::
	$şÚe
()

767 
LogLT
<
V¬CÏss
>* 
log
=
Ãw
 
	`LogLT
(
LogBš¬y
<V¬CÏss>::
Ëá
,LogBš¬y<V¬CÏss>::
Ëá_®loc
,LogBš¬y<V¬CÏss>::
right
,LogBš¬y<V¬CÏss>::
right_®loc
,
Log
::
_is_
);

768 if(
LogBš¬y
<
V¬CÏss
>::
Ëá_®loc
)

769 
log
->
LogBš¬y
<
V¬CÏss
>::
Ëá
=LogBš¬y<V¬CÏss>::Ëá->
	`şÚe
();

770 if(
LogBš¬y
<
V¬CÏss
>::
right_®loc
)

771 
log
->
LogBš¬y
<
V¬CÏss
>::
right
=LogBš¬y<V¬CÏss>::right->
	`şÚe
();

772  
log
;

773 
	}
}

782 
Çme¥aû
 
	gMAPP_NS


784 şas 
	cLogics
::
LogBš¬yOp
:
public
 
Log


786 
public
:

787 
Log
* 
Ëá
;

788 
Log
* 
	gright
;

789 
LogBš¬yOp
(
Log
*,Log*,cÚ¡ *,cÚ¡ 
boŞ
);

790 ~
LogBš¬yOp
();

792 
´št
(
¡d
::
¡ršg
&,¡d::¡ršg&,¡d::¡ršg&,¡d::¡ršg&,
boŞ
&,std::string&,,bool&);

793 
´št
(
¡d
::
¡ršg
&,¡d::¡ršg&,¡d::¡ršg&,¡d::¡ršg&,
boŞ
&,std::string&,,bool&,*);

794 
vœtu®
 
Log
* 
şÚe
()=0;

795 
vœtu®
 
boŞ
 
İ”©Ü
() ()=0;

796 
vœtu®
 
boŞ
 
İ”©Ü
() (*)=0;

807 
Çme¥aû
 
	gMAPP_NS


809 şas 
	cLogics
::
LogAND
:
public
 
LogBš¬yOp


811 
public
:

812 
LogAND
(
Log
*,Log*);

813 
boŞ
 
İ”©Ü
() ();

814 
boŞ
 
İ”©Ü
() (*);

815 
Log
* 
şÚe
();

826 
Çme¥aû
 
	gMAPP_NS


828 şas 
	cLogics
::
LogOR
:
public
 
LogBš¬yOp


830 
public
:

831 
LogOR
(
Log
*,Log*);

832 
boŞ
 
İ”©Ü
() ();

833 
boŞ
 
İ”©Ü
() (*);

834 
Log
* 
şÚe
();

845 
Çme¥aû
 
	gMAPP_NS


847 şas 
	cLogics
::
LogCÚd
:
public
 
Log


849 
public
:

850 
Log
* 
Ëá
;

851 
Log
* 
	gright
;

852 
LogCÚd
(
Log
*,Log*,cÚ¡ *,cÚ¡ 
boŞ
);

853 ~
LogCÚd
();

855 
vœtu®
 
´št
(
¡d
::
¡ršg
&,¡d::¡ršg&,¡d::¡ršg&,¡d::¡ršg&,
boŞ
&,std::string&,,bool&)=0;

856 
vœtu®
 
´št
(
¡d
::
¡ršg
&,¡d::¡ršg&,¡d::¡ršg&,¡d::¡ršg&,
boŞ
&,std::string&,,bool&,*)=0;

857 
vœtu®
 
Log
* 
şÚe
()=0;

858 
vœtu®
 
boŞ
 
İ”©Ü
() ()=0;

859 
vœtu®
 
boŞ
 
İ”©Ü
() (*)=0;

870 
Çme¥aû
 
	gMAPP_NS


872 şas 
	cLogics
::
LogIF
:
public
 
LogCÚd


874 
public
:

875 
LogIF
(
Log
*,Log*);

876 
boŞ
 
İ”©Ü
() ();

877 
boŞ
 
İ”©Ü
() (*);

878 
´št
(
¡d
::
¡ršg
&,¡d::¡ršg&,¡d::¡ršg&,¡d::¡ršg&,
boŞ
&,std::string&,,bool&);

879 
´št
(
¡d
::
¡ršg
&,¡d::¡ršg&,¡d::¡ršg&,¡d::¡ršg&,
boŞ
&,std::string&,,bool&,*);

880 
Log
* 
şÚe
();

891 
Çme¥aû
 
	gMAPP_NS


893 şas 
	cLogics
::
LogIFF
:
public
 
LogCÚd


895 
public
:

896 
LogIFF
(
Log
*,Log*);

897 
boŞ
 
İ”©Ü
() ();

898 
boŞ
 
İ”©Ü
() (*);

899 
´št
(
¡d
::
¡ršg
&,¡d::¡ršg&,¡d::¡ršg&,¡d::¡ršg&,
boŞ
&,std::string&,,bool&);

900 
´št
(
¡d
::
¡ršg
&,¡d::¡ršg&,¡d::¡ršg&,¡d::¡ršg&,
boŞ
&,std::string&,,bool&,*);

901 
Log
* 
şÚe
();

	@ls.cpp

1 
	~"mš_cg.h
"

2 
	~"mš_cg_dmd.h
"

3 
	~"ls.h
"

7 
	gLšeS—rch
::
	$LšeS—rch
():

8 
	`gŞd’
(0.5+0.5*
	`sq¹
(5.0)),

9 
	`•sÚ_3_4
(
	`pow
(
¡d
::
num”ic_lim™s
<
ty³0
>::
	`•sÚ
(),0.75)),

10 
	`sq¹_•sÚ
(
	`sq¹
(
¡d
::
num”ic_lim™s
<
ty³0
>::
	`•sÚ
())),

11 
	`´ev_v®
(-1.0)

13 
	}
}

21 
PyObjeù
* 
	gLšeS—rch
::
	$__Ãw__
(
PyTy³Objeù
* 
ty³
,
PyObjeù
* 
¬gs
,PyObjeù* 
kwds
)

23 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
ty³
->
	`_®loc
(type,0));

24 
PyObjeù
* 
£lf
=
»š‹½»t_ÿ¡
<PyObjeù*>(
__£lf
);

25  
£lf
;

26 
	}
}

30 
	gLšeS—rch
::
	$__š™__
(
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)

32 
FuncAPI
<> 
	`f
("__init__");

34 if(
	`f
(
¬gs
,
kwds
)==-1)  -1;

36 
	}
}

40 
PyObjeù
* 
	gLšeS—rch
::
	$__®loc__
(
PyTy³Objeù
* 
ty³
,
Py_ssize_t
)

42 
Objeù
* 
__£lf
=
Ãw
 Object;

43 
	`Py_TYPE
(
__£lf
)=
ty³
;

44 
	`Py_REFCNT
(
__£lf
)=1;

45  
»š‹½»t_ÿ¡
<
PyObjeù
*>(
__£lf
);

46 
	}
}

50 
	gLšeS—rch
::
	$__d—Îoc__
(
PyObjeù
* 
£lf
)

52 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

53 
d–‘e
 
__£lf
;

54 
	}
}

56 
PyTy³Objeù
 
	gLšeS—rch
::
Ty³Objeù
={
PyObjeù_HEAD_INIT
(
NULL
)};

58 
	gLšeS—rch
::
	$£tup_
()

60 
Ty³Objeù
.
_Çme
="mapp.ls";

61 
Ty³Objeù
.
_doc
="line search";

63 
Ty³Objeù
.
_æags
=
Py_TPFLAGS_DEFAULT
;

64 
Ty³Objeù
.
_basicsize
=(
Objeù
);

66 
Ty³Objeù
.
_Ãw
=
__Ãw__
;

67 
Ty³Objeù
.
_š™
=
__š™__
;

68 
Ty³Objeù
.
_®loc
=
__®loc__
;

69 
Ty³Objeù
.
_d—Îoc
=
__d—Îoc__
;

70 
	`£tup__m‘hods
();

71 
Ty³Objeù
.
_m‘hods
=
m‘hods
;

72 
	`£tup__g‘£t
();

73 
Ty³Objeù
.
_g‘£t
=
g‘£t
;

75 
ichk
=
	`PyTy³_R—dy
(&
Ty³Objeù
);

76 if(
ichk
<0)  ichk;

77 
	`Py_INCREF
(&
Ty³Objeù
);

78  
ichk
;

79 
	}
}

81 
PyG‘S‘Def
 
	gLšeS—rch
::
g‘£t
[]=
Em±yPyG‘S‘Def
(1);

83 
	gLšeS—rch
::
	$£tup__g‘£t
()

85 
	}
}

87 
PyM‘hodDef
 
LšeS—rch
::
m‘hods
[]=
Em±yPyM‘hodDef
(1);

89 
	gLšeS—rch
::
	$£tup__m‘hods
()

91 
	}
}

95 
LšeS—rchGŞd’SeùiÚ
::
	$LšeS—rchGŞd’SeùiÚ
():

96 
	$LšeS—rch
()

98 
tŞ
=
	`sq¹
(2.0*
¡d
::
num”ic_lim™s
<
ty³0
>::
	`•sÚ
());

99 
max_™”
=5;

100 
b¿ck
=
Œue
;

101 
	}
}

109 
PyObjeù
* 
	gLšeS—rchGŞd’SeùiÚ
::
	$__Ãw__
(
PyTy³Objeù
* 
ty³
,
PyObjeù
* 
¬gs
,PyObjeù* 
kwds
)

111 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
ty³
->
	`_®loc
(type,0));

112 
PyObjeù
* 
£lf
=
»š‹½»t_ÿ¡
<PyObjeù*>(
__£lf
);

113  
£lf
;

114 
	}
}

118 
	gLšeS—rchGŞd’SeùiÚ
::
	$__š™__
(
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)

120 
FuncAPI
<> 
	`f
("__init__");

122 if(
	`f
(
¬gs
,
kwds
)==-1)  -1;

124 
	}
}

128 
PyObjeù
* 
	gLšeS—rchGŞd’SeùiÚ
::
	$__®loc__
(
PyTy³Objeù
* 
ty³
,
Py_ssize_t
)

130 
Objeù
* 
__£lf
=
Ãw
 Object;

131 
	`Py_TYPE
(
__£lf
)=
ty³
;

132 
	`Py_REFCNT
(
__£lf
)=1;

133  
»š‹½»t_ÿ¡
<
PyObjeù
*>(
__£lf
);

134 
	}
}

138 
	gLšeS—rchGŞd’SeùiÚ
::
	$__d—Îoc__
(
PyObjeù
* 
£lf
)

140 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

141 
d–‘e
 
__£lf
;

142 
	}
}

144 
PyTy³Objeù
 
	gLšeS—rchGŞd’SeùiÚ
::
Ty³Objeù
={
PyObjeù_HEAD_INIT
(
NULL
)};

146 
	gLšeS—rchGŞd’SeùiÚ
::
	$£tup_
()

148 
Ty³Objeù
.
_Çme
="mapp.ls_golden";

149 
Ty³Objeù
.
_doc
=(*)"Golden section†ine search";

151 
Ty³Objeù
.
_æags
=
Py_TPFLAGS_DEFAULT
;

152 
Ty³Objeù
.
_basicsize
=(
Objeù
);

154 
Ty³Objeù
.
_Ãw
=
__Ãw__
;

155 
Ty³Objeù
.
_š™
=
__š™__
;

156 
Ty³Objeù
.
_®loc
=
__®loc__
;

157 
Ty³Objeù
.
_d—Îoc
=
__d—Îoc__
;

158 
	`£tup__m‘hods
();

159 
Ty³Objeù
.
_m‘hods
=
m‘hods
;

160 
	`£tup__g‘£t
();

161 
Ty³Objeù
.
_g‘£t
=
g‘£t
;

163 
Ty³Objeù
.
_ba£
=&
LšeS—rch
::TypeObject;

165 
ichk
=
	`PyTy³_R—dy
(&
Ty³Objeù
);

166 if(
ichk
<0)  ichk;

167 
	`Py_INCREF
(&
Ty³Objeù
);

168  
ichk
;

169 
	}
}

171 
PyG‘S‘Def
 
	gLšeS—rchGŞd’SeùiÚ
::
g‘£t
[]=
Em±yPyG‘S‘Def
(4);

173 
	gLšeS—rchGŞd’SeùiÚ
::
	$£tup__g‘£t
()

175 
	`g‘£t_b¿ck‘
(
g‘£t
[0]);

176 
	`g‘£t_max_™”
(
g‘£t
[1]);

177 
	`g‘£t_tŞ
(
g‘£t
[2]);

178 
	}
}

180 
PyM‘hodDef
 
	gLšeS—rchGŞd’SeùiÚ
::
m‘hods
[]=
Em±yPyM‘hodDef
(1);

182 
	gLšeS—rchGŞd’SeùiÚ
::
	$£tup__m‘hods
()

184 
	}
}

188 
LšeS—rchGŞd’SeùiÚ
::
	$g‘£t_b¿ck‘
(
PyG‘S‘Def
& 
g‘£t
)

190 
g‘£t
.
Çme
=(*)"bracket";

191 
g‘£t
.
doc
=(*)
R
"---(

192 (
boŞ
è
b¿ck‘šg
 
routše
 

194 
£t
 
to
 
True
 
³rfÜm
 
b¿ck‘šg
 
´iÜ
Ø
lše
 
£¬ch


196 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

198  
v¬
<
boŞ
>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
ls
.
b¿ck
);

200 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

202 
V¬API
<
boŞ
> 
	`b¿ck‘
("bracket");

203 
ichk
=
b¿ck‘
.
	`£t
(
İ
);

204 if(
ichk
==-1)  -1;

205 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
ls
.
b¿ck
=
b¿ck‘
.
v®
;

208 
	}
}

212 
	gLšeS—rchGŞd’SeùiÚ
::
	$g‘£t_max_™”
(
PyG‘S‘Def
& 
g‘£t
)

214 
g‘£t
.
Çme
=(*)"max_iter";

215 
g‘£t
.
doc
=(*)
R
"---(

216 (è
maximum
 
™”©iÚs


218 
maximum
 
numb”
 
of
 
™”©iÚs
 
—ch
 
lše
 
£¬ch
 
©‹m±


220 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

222  
v¬
<>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
ls
.
max_™”
);

224 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

226 
V¬API
<> 
	`max_™”
("max_iter");

227 
max_™”
.
logics
[0]=
	`VLogics
("gt",0);

228 
ichk
=
max_™”
.
	`£t
(
İ
);

229 if(
ichk
==-1)  -1;

230 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
ls
.
max_™”
=max_™”.
v®
;

233 
	}
}

237 
	gLšeS—rchGŞd’SeùiÚ
::
	$g‘£t_tŞ
(
PyG‘S‘Def
& 
g‘£t
)

239 
g‘£t
.
Çme
=(*)"tol";

240 
g‘£t
.
doc
=(*)
R
"---(

241 (è
tŞ”ªû


243 
tŞ”ªû
 
to
 
¡İ
 
lše
 
£¿ch


245 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

247  
v¬
<
ty³0
>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
ls
.
tŞ
);

249 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

251 
V¬API
<
ty³0
> 
	`tŞ
("tol");

252 
tŞ
.
logics
[0]=
	`VLogics
("gt",0.0);

253 
ichk
=
tŞ
.
	`£t
(
İ
);

254 if(
ichk
==-1)  -1;

255 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
ls
.
tŞ
ñŞ.
v®
;

258 
	}
}

262 
	gLšeS—rchB»Á
::
	$LšeS—rchB»Á
():
	$LšeS—rch
()

264 
max_™”
=5;

265 
tŞ
=
	`sq¹
(2.0*
¡d
::
num”ic_lim™s
<
ty³0
>::
	`•sÚ
());

266 
z•s
=
¡d
::
num”ic_lim™s
<
ty³0
>::
	`•sÚ
()*1.0e-3;

267 
b¿ck
=
Œue
;

268 
	}
}

276 
PyObjeù
* 
	gLšeS—rchB»Á
::
	$__Ãw__
(
PyTy³Objeù
* 
ty³
,
PyObjeù
* 
¬gs
,PyObjeù* 
kwds
)

278 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
ty³
->
	`_®loc
(type,0));

279 
PyObjeù
* 
£lf
=
»š‹½»t_ÿ¡
<PyObjeù*>(
__£lf
);

280  
£lf
;

281 
	}
}

285 
	gLšeS—rchB»Á
::
	$__š™__
(
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)

287 
FuncAPI
<> 
	`f
("__init__");

289 if(
	`f
(
¬gs
,
kwds
)==-1)  -1;

291 
	}
}

295 
PyObjeù
* 
	gLšeS—rchB»Á
::
	$__®loc__
(
PyTy³Objeù
* 
ty³
,
Py_ssize_t
)

297 
Objeù
* 
__£lf
=
Ãw
 Object;

298 
	`Py_TYPE
(
__£lf
)=
ty³
;

299 
	`Py_REFCNT
(
__£lf
)=1;

300  
»š‹½»t_ÿ¡
<
PyObjeù
*>(
__£lf
);

301 
	}
}

305 
	gLšeS—rchB»Á
::
	$__d—Îoc__
(
PyObjeù
* 
£lf
)

307 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

308 
d–‘e
 
__£lf
;

309 
	}
}

311 
PyTy³Objeù
 
	gLšeS—rchB»Á
::
Ty³Objeù
={
PyObjeù_HEAD_INIT
(
NULL
)};

313 
	gLšeS—rchB»Á
::
	$£tup_
()

315 
Ty³Objeù
.
_Çme
="mapp.ls_brent";

316 
Ty³Objeù
.
_doc
=(*)"Brent†ine search";

318 
Ty³Objeù
.
_æags
=
Py_TPFLAGS_DEFAULT
;

319 
Ty³Objeù
.
_basicsize
=(
Objeù
);

321 
Ty³Objeù
.
_Ãw
=
__Ãw__
;

322 
Ty³Objeù
.
_š™
=
__š™__
;

323 
Ty³Objeù
.
_®loc
=
__®loc__
;

324 
Ty³Objeù
.
_d—Îoc
=
__d—Îoc__
;

325 
	`£tup__m‘hods
();

326 
Ty³Objeù
.
_m‘hods
=
m‘hods
;

327 
	`£tup__g‘£t
();

328 
Ty³Objeù
.
_g‘£t
=
g‘£t
;

330 
Ty³Objeù
.
_ba£
=&
LšeS—rch
::TypeObject;

332 
ichk
=
	`PyTy³_R—dy
(&
Ty³Objeù
);

333 if(
ichk
<0)  ichk;

334 
	`Py_INCREF
(&
Ty³Objeù
);

335  
ichk
;

336 
	}
}

338 
PyG‘S‘Def
 
	gLšeS—rchB»Á
::
g‘£t
[]=
Em±yPyG‘S‘Def
(5);

340 
	gLšeS—rchB»Á
::
	$£tup__g‘£t
()

342 
	`g‘£t_b¿ck‘
(
g‘£t
[0]);

343 
	`g‘£t_max_™”
(
g‘£t
[1]);

344 
	`g‘£t_tŞ
(
g‘£t
[2]);

345 
	`g‘£t_z•s
(
g‘£t
[3]);

346 
	}
}

348 
PyM‘hodDef
 
	gLšeS—rchB»Á
::
m‘hods
[]=
Em±yPyM‘hodDef
(1);

350 
	gLšeS—rchB»Á
::
	$£tup__m‘hods
()

352 
	}
}

356 
LšeS—rchB»Á
::
	$g‘£t_b¿ck‘
(
PyG‘S‘Def
& 
g‘£t
)

358 
g‘£t
.
Çme
=(*)"bracket";

359 
g‘£t
.
doc
=(*)
R
"---(

360 (
boŞ
è
b¿ck‘šg
 
routše
 

362 
£t
 
to
 
True
 
³rfÜm
 
b¿ck‘šg
 
´iÜ
Ø
lše
 
£¬ch


364 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

366  
v¬
<
boŞ
>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
ls
.
b¿ck
);

368 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

370 
V¬API
<
boŞ
> 
	`b¿ck‘
("bracket");

371 
ichk
=
b¿ck‘
.
	`£t
(
İ
);

372 if(
ichk
==-1)  -1;

373 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
ls
.
b¿ck
=
b¿ck‘
.
v®
;

376 
	}
}

380 
	gLšeS—rchB»Á
::
	$g‘£t_max_™”
(
PyG‘S‘Def
& 
g‘£t
)

382 
g‘£t
.
Çme
=(*)"max_iter";

383 
g‘£t
.
doc
=(*)
R
"---(

384 (è
maximum
 
™”©iÚs


386 
maximum
 
numb”
 
of
 
™”©iÚs
 
—ch
 
lše
 
£¬ch
 
©‹m±


388 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

390  
v¬
<>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
ls
.
max_™”
);

392 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

394 
V¬API
<> 
	`max_™”
("max_iter");

395 
max_™”
.
logics
[0]=
	`VLogics
("gt",0);

396 
ichk
=
max_™”
.
	`£t
(
İ
);

397 if(
ichk
==-1)  -1;

398 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
ls
.
max_™”
=max_™”.
v®
;

401 
	}
}

405 
	gLšeS—rchB»Á
::
	$g‘£t_tŞ
(
PyG‘S‘Def
& 
g‘£t
)

407 
g‘£t
.
Çme
=(*)"tol";

408 
g‘£t
.
doc
=(*)
R
"---(

409 (è
tŞ”ªû


411 
tŞ”ªû
 
to
 
¡İ
 
lše
 
£¿ch


413 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

415  
v¬
<
ty³0
>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
ls
.
tŞ
);

417 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

419 
V¬API
<
ty³0
> 
	`tŞ
("tol");

420 
tŞ
.
logics
[0]=
	`VLogics
("gt",0.0);

421 
ichk
=
tŞ
.
	`£t
(
İ
);

422 if(
ichk
==-1)  -1;

423 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
ls
.
tŞ
ñŞ.
v®
;

426 
	}
}

430 
	gLšeS—rchB»Á
::
	$g‘£t_z•s
(
PyG‘S‘Def
& 
g‘£t
)

432 
g‘£t
.
Çme
=(*)"zeps";

433 
g‘£t
.
doc
=(*)
R
"---(

434 (è
sm®l
 
numb”


436 
sm®l
 
numb”
 
to
 
´Ùeù
 
agaš¡
 
Œyšg
Ø
ach›ve
 
äaùiÚ®
 
accu¿cy
 
a
 
mšimum
 
th©
 
h­³ns
Ø
be
 
exaùly
 0.0

439 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

441  
v¬
<
ty³0
>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
ls
.
z•s
);

443 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

445 
V¬API
<
ty³0
> 
	`z•s
("zeps");

446 
z•s
.
logics
[0]=
	`VLogics
("gt",0.0);

447 
ichk
=
z•s
.
	`£t
(
İ
);

448 if(
ichk
==-1)  -1;

449 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
ls
.
z•s
=z•s.
v®
;

452 
	}
}

456 
	gLšeS—rchBackT¿ck
::
	$LšeS—rchBackT¿ck
():
	$LšeS—rch
()

458 
mš_®pha
=0.0;

459 
c
=0.4;

460 
rho
=0.5;

461 
	}
}

471 
PyObjeù
* 
	gLšeS—rchBackT¿ck
::
	$__Ãw__
(
PyTy³Objeù
* 
ty³
,
PyObjeù
* 
¬gs
,PyObjeù* 
kwds
)

473 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
ty³
->
	`_®loc
(type,0));

474 
PyObjeù
* 
£lf
=
»š‹½»t_ÿ¡
<PyObjeù*>(
__£lf
);

475  
£lf
;

476 
	}
}

480 
	gLšeS—rchBackT¿ck
::
	$__š™__
(
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)

482 
FuncAPI
<> 
	`f
("__init__");

484 if(
	`f
(
¬gs
,
kwds
)==-1)  -1;

486 
	}
}

490 
PyObjeù
* 
	gLšeS—rchBackT¿ck
::
	$__®loc__
(
PyTy³Objeù
* 
ty³
,
Py_ssize_t
)

492 
Objeù
* 
__£lf
=
Ãw
 Object;

493 
	`Py_TYPE
(
__£lf
)=
ty³
;

494 
	`Py_REFCNT
(
__£lf
)=1;

495  
»š‹½»t_ÿ¡
<
PyObjeù
*>(
__£lf
);

496 
	}
}

500 
	gLšeS—rchBackT¿ck
::
	$__d—Îoc__
(
PyObjeù
* 
£lf
)

502 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

503 
d–‘e
 
__£lf
;

504 
	}
}

506 
PyTy³Objeù
 
	gLšeS—rchBackT¿ck
::
Ty³Objeù
={
PyObjeù_HEAD_INIT
(
NULL
)};

508 
	gLšeS—rchBackT¿ck
::
	$£tup_
()

510 
Ty³Objeù
.
_Çme
="mapp.ls_bt";

511 
Ty³Objeù
.
_doc
=(*)"Backrack†ine search";

513 
Ty³Objeù
.
_æags
=
Py_TPFLAGS_DEFAULT
;

514 
Ty³Objeù
.
_basicsize
=(
Objeù
);

516 
Ty³Objeù
.
_Ãw
=
__Ãw__
;

517 
Ty³Objeù
.
_š™
=
__š™__
;

518 
Ty³Objeù
.
_®loc
=
__®loc__
;

519 
Ty³Objeù
.
_d—Îoc
=
__d—Îoc__
;

520 
	`£tup__m‘hods
();

521 
Ty³Objeù
.
_m‘hods
=
m‘hods
;

522 
	`£tup__g‘£t
();

523 
Ty³Objeù
.
_g‘£t
=
g‘£t
;

525 
Ty³Objeù
.
_ba£
=&
LšeS—rch
::TypeObject;

527 
ichk
=
	`PyTy³_R—dy
(&
Ty³Objeù
);

528 if(
ichk
<0)  ichk;

529 
	`Py_INCREF
(&
Ty³Objeù
);

530  
ichk
;

531 
	}
}

533 
PyG‘S‘Def
 
	gLšeS—rchBackT¿ck
::
g‘£t
[]=
Em±yPyG‘S‘Def
(4);

535 
	gLšeS—rchBackT¿ck
::
	$£tup__g‘£t
()

537 
	`g‘£t_c
(
g‘£t
[0]);

538 
	`g‘£t_rho
(
g‘£t
[1]);

539 
	`g‘£t_mš_®pha
(
g‘£t
[2]);

540 
	}
}

542 
PyM‘hodDef
 
	gLšeS—rchBackT¿ck
::
m‘hods
[]=
Em±yPyM‘hodDef
(1);

544 
	gLšeS—rchBackT¿ck
::
	$£tup__m‘hods
()

546 
	}
}

550 
LšeS—rchBackT¿ck
::
	$g‘£t_c
(
PyG‘S‘Def
& 
g‘£t
)

552 
g‘£t
.
Çme
=(*)"c";

553 
g‘£t
.
doc
=(*)
R
"---(

554 (è
·¿m‘”
 
to
 
d‘”mše
 
suffiûÁ
 
deü—£


556 
Cr™”iÚ
 
to
 
d‘”mše
 
suffic›Á
 
deü—£
, 
this
 
©Œibu‹
 
should
 
be
 
b‘w“n
 0.0 
ªd
 1.0.

558 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

560  
v¬
<
ty³0
>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
ls
.
c
);

562 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

564 
V¬API
<
ty³0
> 
	`c
("c");

565 
c
.
logics
[0]=
	`VLogics
("gt",0.0)*VLogics("lt",1.0);

566 
ichk
=
c
.
	`£t
(
İ
);

567 if(
ichk
==-1)  -1;

568 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
ls
.
c
=c.
v®
;

571 
	}
}

575 
	gLšeS—rchBackT¿ck
::
	$g‘£t_rho
(
PyG‘S‘Def
& 
g‘£t
)

577 
g‘£t
.
Çme
=(*)"rho";

578 
g‘£t
.
doc
=(*)
R
"---(

579 (è
¡•
 
»duùiÚ


581 
S‹p
 
»duùiÚ
 
aá”
 
ª
 
unsucûssful
 
ŒŸl
, 
this
 
©Œibu‹
 
should
 
be
 
b‘w“n
 0.0 
ªd
 1.0.

583 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

585  
v¬
<
ty³0
>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
ls
.
rho
);

587 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

589 
V¬API
<
ty³0
> 
	`rho
("rho");

590 
rho
.
logics
[0]=
	`VLogics
("gt",0.0)*VLogics("lt",1.0);

591 
ichk
=
rho
.
	`£t
(
İ
);

592 if(
ichk
==-1)  -1;

593 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
ls
.
rho
ôho.
v®
;

596 
	}
}

600 
	gLšeS—rchBackT¿ck
::
	$g‘£t_mš_®pha
(
PyG‘S‘Def
& 
g‘£t
)

602 
g‘£t
.
Çme
=(*)"min_alpha";

603 
g‘£t
.
doc
=(*)
R
"---(

604 (è
mšimum
 
®pha


606 
This
 
©Œibu‹
 
should
 
be
 
g»©”
 
thª
 0.0.

608 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

610  
v¬
<
ty³0
>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
ls
.
mš_®pha
);

612 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

614 
V¬API
<
ty³0
> 
	`mš_®pha
("min_alpha");

615 
mš_®pha
.
logics
[0]=
	`VLogics
("ge",0.0);

616 
ichk
=
mš_®pha
.
	`£t
(
İ
);

617 if(
ichk
==-1)  -1;

618 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
ls
.
mš_®pha
=mš_®pha.
v®
;

621 
	}
}

	@ls.h

1 #iâdeà
__MAPP__ls__


2 
	#__MAPP__ls__


	)

3 
	~<PythÚ.h
>

4 
	~"glob®.h
"

5 
	~<lim™s
>

6 
	~<¡dio.h
>

7 
Çme¥aû
 
	gMAPP_NS


11 
	gLS_S
,

12 
	gLS_F_DOWNHILL
,

13 
	gLS_F_GRAD0
,

14 
	gLS_MIN_ALPHA
,

16 
	gMIN_S_TOLERANCE
,

17 
	gMIN_F_MAX_ITER
,

19 
	gB_S
,

20 
	gB_F_MAX_ALPHA
,

21 
	gB_F_DOWNHILL


24 
	~<cm©h
>

25 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

29 
Çme¥aû
 
	gMAPP_NS


31 şas 
	cLšeS—rch


33 
	g´iv©e
:

34 
´Ùeùed
:

37 cÚ¡ 
ty³0
 
•sÚ_3_4
;

38 cÚ¡ 
ty³0
 
	gsq¹_•sÚ
;

39 cÚ¡ 
ty³0
 
	ggŞd’
;

40 
ty³0
 
	g´ev_v®
;

41 
	gpublic
:

42 
‹m¶©e
<
şass
 
Func
>

43 
b¿ck‘
(
Func
*,
ty³0
,type0,type0&,type0&,type0&,type0&,type0&,type0&);

45 
LšeS—rch
();

46 
	gvœtu®
 ~
LšeS—rch
(){};

49 
	gObjeù
;

51 
PyTy³Objeù
 
	gTy³Objeù
;

52 
PyObjeù
* 
__Ãw__
(
PyTy³Objeù
*,PyObject*, PyObject*);

53 
__š™__
(
PyObjeù
*, PyObject*,PyObject*);

54 
PyObjeù
* 
__®loc__
(
PyTy³Objeù
*,
Py_ssize_t
);

55 
__d—Îoc__
(
PyObjeù
*);

57 
PyM‘hodDef
 
	gm‘hods
[];

58 
£tup__m‘hods
();

60 
PyG‘S‘Def
 
	gg‘£t
[];

61 
£tup__g‘£t
();

63 
£tup_
();

66 
	gLšeS—rch
::
Objeù


68 
PyObjeù_HEAD


69 
LšeS—rch
 
ls
;

75 
Çme¥aû
 
	gMAPP_NS


77 şas 
	cLšeS—rchGŞd’SeùiÚ
:
public
 
LšeS—rch


79 
´iv©e
:

80 
´Ùeùed
:

81 
public
:

82 
ty³0
 
tŞ
;

83 
	gmax_™”
;

84 
boŞ
 
	gb¿ck
;

86 
LšeS—rchGŞd’SeùiÚ
();

87 ~
LšeS—rchGŞd’SeùiÚ
(){};

88 
	g‹m¶©e
<
şass
 
	gFunc
>

89 
mš
(
Func
*,
ty³0
&,type0&,);

91 
	gObjeù
;

93 
PyTy³Objeù
 
	gTy³Objeù
;

94 
PyObjeù
* 
__Ãw__
(
PyTy³Objeù
*,PyObject*, PyObject*);

95 
__š™__
(
PyObjeù
*, PyObject*,PyObject*);

96 
PyObjeù
* 
__®loc__
(
PyTy³Objeù
*,
Py_ssize_t
);

97 
__d—Îoc__
(
PyObjeù
*);

99 
PyM‘hodDef
 
	gm‘hods
[];

100 
£tup__m‘hods
();

102 
PyG‘S‘Def
 
	gg‘£t
[];

103 
£tup__g‘£t
();

104 
g‘£t_b¿ck‘
(
PyG‘S‘Def
&);

105 
g‘£t_max_™”
(
PyG‘S‘Def
&);

106 
g‘£t_tŞ
(
PyG‘S‘Def
&);

107 
£tup_
();

110 
	gLšeS—rchGŞd’SeùiÚ
::
Objeù


112 
PyObjeù_HEAD


113 
LšeS—rchGŞd’SeùiÚ
 
ls
;

119 
Çme¥aû
 
	gMAPP_NS


121 şas 
	cLšeS—rchB»Á
:
public
 
LšeS—rch


123 
´iv©e
:

124 
´Ùeùed
:

125 
public
:

126 
ty³0
 
tŞ
,
	gz•s
;

127 
	gmax_™”
;

128 
boŞ
 
	gb¿ck
;

130 
LšeS—rchB»Á
();

131 ~
LšeS—rchB»Á
(){};

132 
	g‹m¶©e
<
şass
 
	gFunc
>

133 
mš
(
Func
*,
ty³0
&,type0&,);

135 
	gObjeù
;

137 
PyTy³Objeù
 
	gTy³Objeù
;

138 
PyObjeù
* 
__Ãw__
(
PyTy³Objeù
*,PyObject*, PyObject*);

139 
__š™__
(
PyObjeù
*, PyObject*,PyObject*);

140 
PyObjeù
* 
__®loc__
(
PyTy³Objeù
*,
Py_ssize_t
);

141 
__d—Îoc__
(
PyObjeù
*);

143 
PyM‘hodDef
 
	gm‘hods
[];

144 
£tup__m‘hods
();

146 
PyG‘S‘Def
 
	gg‘£t
[];

147 
£tup__g‘£t
();

148 
g‘£t_b¿ck‘
(
PyG‘S‘Def
&);

149 
g‘£t_max_™”
(
PyG‘S‘Def
&);

150 
g‘£t_tŞ
(
PyG‘S‘Def
&);

151 
g‘£t_z•s
(
PyG‘S‘Def
&);

152 
£tup_
();

155 
	gLšeS—rchB»Á
::
Objeù


157 
PyObjeù_HEAD


158 
LšeS—rchB»Á
 
ls
;

164 
Çme¥aû
 
	gMAPP_NS


166 şas 
	cLšeS—rchBackT¿ck
:
public
 
LšeS—rch


168 
´iv©e
:

169 
´Ùeùed
:

170 
public
:

171 
ty³0
 
c
,
	grho
,
	gmš_®pha
;

173 
LšeS—rchBackT¿ck
();

174 ~
LšeS—rchBackT¿ck
(){};

175 
	g‹m¶©e
<
şass
 
	gFunc
>

176 
mš
(
Func
*,
ty³0
&,type0&,);

178 
	gObjeù
;

179 
	gObjeù1
;

181 
PyTy³Objeù
 
	gTy³Objeù
;

182 
PyObjeù
* 
__Ãw__
(
PyTy³Objeù
*,PyObject*, PyObject*);

183 
__š™__
(
PyObjeù
*, PyObject*,PyObject*);

184 
PyObjeù
* 
__®loc__
(
PyTy³Objeù
*,
Py_ssize_t
);

185 
__d—Îoc__
(
PyObjeù
*);

187 
PyM‘hodDef
 
	gm‘hods
[];

188 
£tup__m‘hods
();

190 
PyG‘S‘Def
 
	gg‘£t
[];

191 
£tup__g‘£t
();

192 
g‘£t_rho
(
PyG‘S‘Def
&);

193 
g‘£t_c
(
PyG‘S‘Def
&);

194 
g‘£t_mš_®pha
(
PyG‘S‘Def
&);

195 
£tup_
();

198 
	gLšeS—rchBackT¿ck
::
Objeù


200 
PyObjeù_HEAD


201 
LšeS—rchBackT¿ck
 
ls
;

204 
	gLšeS—rchBackT¿ck
::
Objeù1


206 
PyObjeù_HEAD


207 
LšeS—rchBackT¿ck
* 
ls1
;

213 
	g‹m¶©e
<
şass
 
	gFunc
>

214 
	gLšeS—rch
::
	$b¿ck‘
(
Func
* 
func
,
ty³0
 
dç
,ty³0 
max_a
,ty³0& 
a
,

215 
ty³0
& 
b
,ty³0& 
c
,ty³0& 
ç
,ty³0& 
fb
,ty³0& 
fc
)

217 
ty³0
 
u
,
fu
,
r
,
q
,
ulim
;

219 
q
=1.0e-14/(
max_a
*
	`çbs
(
dç
));

220 if(0.01<
q
 && q<1.0)

221 
b
=
q
*
max_a
;

222 if(
q
>=1.0)

223 
b
=
max_a
;

225 
b
=0.01*
max_a
;

226 
fb
=
func
->
	`F
(
b
);

228 if(
fb
>=
ç
)

230 
c
=
b
;

231 
fc
=
fb
;

232 
™”
=20;

233 
ty³0
 
r
=(
ç
-
fc
)/(
c
*
dç
);

234 
b
=
c
*0.5/(1.0+
r
);

235 
fb
>=
ç
 && 
™”
 && 
b
>
¡d
::
num”ic_lim™s
<
ty³0
>::
	`•sÚ
())

237 
fb
=
func
->
	`F
(
b
);

238 if(
fb
<
ç
)

240 
c
=
b
;

241 
fc
=
fb
;

242 
™”
--;

243 
r
=(
ç
-
fc
)/(
c
*
dç
);

244 
b
=
c
*0.5/(1.0+
r
);

247 if(
fb
>=
ç
)

250 
b
=
sq¹_•sÚ
<
max_a
 ? sqrt_epsilon:max_a;

251 
fb
=
func
->
	`F
(
b
);

252 if(
fb
>=
ç
)

253  
B_F_DOWNHILL
;

256  
B_S
;

259 
fc
=
fb
;

260 
fb
>=
fc
)

263 
c
=
b
+
gŞd’
*(b-
a
);

264 if(
c
>=
max_a
)

266 
c
=
max_a
;

267 
fc
=
func
->
	`F
(
c
);

268  
B_S
;

271 
fc
=
func
->
	`F
(
c
);

272 if(
fc
>
fb
)

275 
ulim
=
	`MIN
(
b
+(
gŞd’
+2.0)*(b-
a
),
max_a
);

276 
ulim
=
max_a
;

278 
r
=(
b
-
a
)*(
fb
-
fc
);

279 
q
=(
b
-
c
)*(
fb
-
ç
);

281 
u
=
b
-((b-
c
)*
q
-(b-
a
)*
r
)/(2.0*(q-r));

282 if(
b
<
u
 && u<
c
)

284 
fu
=
func
->
	`F
(
u
);

285 if(
fu
<
fc
)

287 
a
=
b
;

288 
b
=
u
;

289 
ç
=
fb
;

290 
fb
=
fu
;

291  
B_S
;

293 if(
fu
>
fb
)

295 
c
=
u
;

296 
fc
=
fu
;

297  
B_S
;

300 
a
=
b
;

301 
b
=
c
;

303 
ç
=
fb
;

304 
fb
=
fc
;

306 if(
u
>
c
)

309 
u
=
	`MIN
(u,
ulim
);

310 
fu
=
func
->
	`F
(
u
);

311 
a
=
b
;

312 
b
=
c
;

313 
c
=
u
;

315 
ç
=
fb
;

316 
fb
=
fc
;

317 
fc
=
fu
;

319 if(
fu
>
fc
)

321  
B_S
;

326 
a
=
b
;

327 
b
=
c
;

329 
ç
=
fb
;

330 
fb
=
fc
;

334  
B_S
;

335 
	}
}

339 
	g‹m¶©e
<
şass
 
	gFunc
>

340 
	gLšeS—rchGŞd’SeùiÚ
::
	$mš
(
Func
* 
func
,
ty³0
& 
Ägy


341 ,
ty³0
& 
®pha
,
š™_æag
)

343 
ÿlc
=0;

344 
ty³0
 
a
,
b
,
c
;

345 
ty³0
 
ç
,
fb
,
fc
,
h_nÜm
;

346 
ty³0
 
max_a
;

347 
ty³0
 
x0
,
x1
,
x2
,
x3
,
f1
,
f2
;

348 
ty³0
 
dç
;

349 
cÚ¡ex´
 
ty³0
 
gŞd
=0.61803399;

350 
cÚ¡ex´
 
ty³0
 
cgŞd
=0.38196601;

352 
func
->
	`ls_´•
(
dç
,
h_nÜm
,
max_a
);

355 if(
max_a
==0.0 && 
dç
==0.0)

356  
LS_F_GRAD0
;

358 if(
dç
>=0.0)

359  
LS_F_DOWNHILL
;

361 if(
max_a
==0.0è 
LS_MIN_ALPHA
;

363 
a
=0.0;

364 
ç
=
Ägy
;

367 if(
b¿ck
)

369 
chk_b¿ck‘
=
	`b¿ck‘
(
func
,
dç
,
max_a
,
a
,
b
,
c
,
ç
,
fb
,
fc
);

370 if(
chk_b¿ck‘
!=
B_S
)

372 
func
->
	`F_»£t
();

373  
chk_b¿ck‘
;

375 
x0
=
a
;

376 
x3
=
c
;

379 if(
c
-
b
>b-
a
)

381 
x1
=
b
;

382 
x2
=
b
+
cgŞd
*(
c
-b);

384 
f1
=
fb
;

385 
f2
=
func
->
	`F
(
x2
);

386 
ÿlc
=2;

390 
x1
=
b
+
cgŞd
*(
a
-b);

391 
x2
=
b
;

393 
f1
=
func
->
	`F
(
x1
);

394 
f2
=
fb
;

395 
ÿlc
=1;

399 
™”
=
max_™”
;

400 
x3
-
x0
>
tŞ
*(
x1
+
x2
è&& x3-x0>
¡d
::
num”ic_lim™s
<
ty³0
>::
	`•sÚ
(è&& 
™”
)

402 if(
f2
<
f1
)

404 
x0
=
x1
;

405 
x1
=
x2
;

406 
x2
=
gŞd
*x2+
cgŞd
*
x3
;

408 
f1
=
f2
;

409 
f2
=
func
->
	`F
(
x2
);

410 
ÿlc
=2;

414 
x3
=
x2
;

415 
x2
=
x1
;

416 
x1
=
gŞd
*x1+
cgŞd
*
x0
;

417 
f2
=
f1
;

418 
f1
=
func
->
	`F
(
x1
);

419 
ÿlc
=1;

421 
™”
--;

426 
ty³0
 
d–
,
f0
,
f3
;

427 
f1
=
f2
=0.0;

428 
x0
=
x1
=
x2
=0.0;

429 
f0
=
ç
;

430 
x3
=
max_a
;

431 
f3
=
func
->
	`F
(
x3
);

433 
™”
=
max_™”
;

435 
boŞ
 
£t_Ëá
=
çl£
;

436 
boŞ
 
£t_right
=
çl£
;

437 
x3
-
x0
>
tŞ
*(
x1
+
x2
è&& x3-x0>
¡d
::
num”ic_lim™s
<
ty³0
>::
	`•sÚ
(è&& 
™”
)

439 
d–
=
cgŞd
*(
x3
-
x0
);

440 if(!
£t_Ëá
)

442 
x1
=
x0
+
d–
;

443 
f1
=
func
->
	`F
(
x1
);

444 
ÿlc
=1;

445 
£t_Ëá
=1;

448 if(!
£t_right
)

450 
x2
=
x3
-
d–
;

451 
f2
=
func
->
	`F
(
x2
);

452 
ÿlc
=2;

453 
£t_right
=1;

457 if((
f0
<
f2
 && f0<
f3
è|| (
f1
<f2 && f1<f3))

459 
£t_Ëá
=0;

460 
x3
=
x2
;

461 
x2
=
x1
;

462 
f3
=
f2
;

463 
f2
=
f1
;

467 
£t_right
=0;

468 
x0
=
x1
;

469 
x1
=
x2
;

470 
f0
=
f1
;

471 
f1
=
f2
;

474 
™”
--;

477 if(!
£t_Ëá
)

479 if(
f0
<
f1
)

481 if(
x0
==0.0)

483 
func
->
	`F_»£t
();

484 
®pha
=0.0;

485  
LS_MIN_ALPHA
;

488 
x1
=
x0
;

489 
f1
=
func
->
	`F
(
x1
);

490 
ÿlc
=1;

493 if(!
£t_right
)

495 if(
f3
<
f2
)

498 
x2
=
x3
;

499 
f2
=
func
->
	`F
(
x2
);

500 
ÿlc
=2;

505 if(
f1
<
f2
)

507 if(
ÿlc
==2)

508 
f1
=
func
->
	`F
(
x1
);

509 
Ägy
=
f1
;

510 
®pha
=
x1
;

514 if(
ÿlc
==1)

515 
f2
=
func
->
	`F
(
x2
);

516 
Ägy
=
f2
;

517 
®pha
=
x2
;

520 
´ev_v®
=-
dç
*
®pha
;

521  
LS_S
;

522 
	}
}

526 
	g‹m¶©e
<
şass
 
	gFunc
>

527 
	gLšeS—rchB»Á
::
	$mš
(
Func
* 
func
,
ty³0
& 
Ägy


528 ,
ty³0
& 
®pha
,
š™_æag
)

530 
ty³0
 
a
,
b
;

531 
ty³0
 
ç
;

532 
ty³0
 
max_a
,
h_nÜm
;

533 
ty³0
 
cgŞd
,
gŞd
;

534 
ty³0
 
dç
;

536 
ty³0
 
d
=0.0,
‘emp
,
fu
,
fv
,
fw
,
fx
;

537 
ty³0
 
r
,
q
,
p
,
tŞ1
,
tŞ2
,
u
,
v
,
w
,
x
,
xm
;

538 
ty³0
 
e
=0.0;

539 
u
=
fu
=0.0;

541 
gŞd
=0.61803399;

542 
cgŞd
=0.38196601;

544 
func
->
	`ls_´•
(
dç
,
h_nÜm
,
max_a
);

545 if(
max_a
==0.0 && 
dç
==0.0)

546  
LS_F_GRAD0
;

548 if(
dç
>=0.0)

549  
LS_F_DOWNHILL
;

551 if(
max_a
==0.0è 
LS_MIN_ALPHA
;

553 
a
=0.0;

554 
ç
=
Ägy
;

557 
ty³0
 
fb
;

559 if(
b¿ck
)

561 
chk_b¿ck‘
=
	`b¿ck‘
(
func
,
dç
,
max_a
,
a
,
x
,
b
,
ç
,
fx
,
fb
);

563 if(
chk_b¿ck‘
!=
B_S
)

565 
func
->
	`F_»£t
();

566  
chk_b¿ck‘
;

571 
a
=0.0;

572 
b
=
max_a
;

573 
x
=
cgŞd
*(
b
-
a
);

574 
fx
=
func
->
	`F
(
x
);

577 
w
=
v
=
x
;

578 
fw
=
fv
=
fx
;

580 
™”
=0;™”<
max_™”
;iter++)

582 
xm
=0.5*(
a
+
b
);

583 
tŞ1
=
tŞ
*
	`çbs
(
x
)+
z•s
;

584 
tŞ2
=2.0*
tŞ1
;

586 if(
	`çbs
(
x
-
xm
)<=(
tŞ2
-0.5*(
b
-
a
)))

588 if(
u
!=
x
)

589 
func
->
	`F
(
x
);

590 
Ägy
=
fx
;

591 
®pha
=
x
;

592 
´ev_v®
=
®pha
;

593  
LS_S
;

596 if(
	`çbs
(
e
)>
tŞ1
)

598 
r
=(
x
-
w
)*(
fx
-
fv
);

599 
q
=(
x
-
v
)*(
fx
-
fw
);

600 
p
=(
x
-
v
)*
q
-(x-
w
)*
r
;

601 
q
=2.0*(q-
r
);

602 if(
q
>0.0è
p
=-p;

603 
q
=
	`çbs
(q);

604 
‘emp
=
e
;

605 
e
=
d
;

606 if(
	`çbs
(
p
)>=çbs(0.5*
q
*
‘emp
)

607 || 
p
<=
q
*(
a
-
x
)

608 || 
p
>=
q
*(
b
-
x
))

610 if(
x
>=
xm
)

611 
e
=(
a
-
x
);

613 
e
=
b
-
x
;

614 
d
=
cgŞd
*
e
;

618 
d
=
p
/
q
;

619 
u
=
x
+
d
;

620 if(
u
-
a
<
tŞ2
 || 
b
-u<tol2)

622 if(
xm
-
x
>=0.0)

623 
d
=
	`çbs
(
tŞ1
);

625 
d
=-
	`çbs
(
tŞ1
);

631 if(
x
>=
xm
)

632 
e
=(
a
-
x
);

634 
e
=
b
-
x
;

636 
d
=
cgŞd
*
e
;

639 if(
	`çbs
(
d
)>=
tŞ1
)

641 
u
=
x
+
d
;

645 if(
d
>=0.0)

647 
u
=
x
+
	`çbs
(
tŞ1
);

651 
u
=
x
-
	`çbs
(
tŞ1
);

655 
fu
=
func
->
	`F
(
u
);

657 if(
fu
<=
fx
)

659 if(
u
>=
x
)

660 
a
=
x
;

662 
b
=
x
;

664 
v
=
w
;

665 
w
=
x
;

666 
x
=
u
;

668 
fv
=
fw
;

669 
fw
=
fx
;

670 
fx
=
fu
;

674 if(
u
<
x
)

675 
a
=
u
;

677 
b
=
u
;

679 if(
fu
<=
fw


680 || 
w
==
x
)

682 
v
=
w
;

683 
w
=
u
;

684 
fv
=
fw
;

685 
fw
=
fu
;

687 if(
fu
<=
fv


688 || 
v
==
x


689 || 
v
==
w
)

691 
v
=
u
;

692 
fv
=
fu
;

698 if(
ç
<
fx
)

700 
func
->
	`F_»£t
();

701 
®pha
=0.0;

702  
LS_MIN_ALPHA
;

705 if(
u
!=
x
)

706 
func
->
	`F
(
x
);

708 
Ägy
=
fx
;

709 
®pha
=
x
;

711 
´ev_v®
=
®pha
;

712  
LS_S
;

713 
	}
}

717 
	g‹m¶©e
<
şass
 
	gFunc
>

718 
	gLšeS—rchBackT¿ck
::
	$mš
(
Func
* 
func
,
ty³0
& 
Ägy


719 ,
ty³0
& 
®pha
,
š™_æag
)

721 
ty³0
 
max_a
,
h_nÜm
;

722 
ty³0
 
dç
,
š™_’”gy
;

723 
ty³0
 
cu¼’t_’”gy
,
id—l_’”gy
;

725 
š™_’”gy
=
Ägy
;

727 
func
->
	`ls_´•
(
dç
,
h_nÜm
,
max_a
);

729 if(
max_a
==0.0 && 
dç
==0.0)

730  
LS_F_GRAD0
;

732 if(
dç
>=0.0)

733  
LS_F_DOWNHILL
;

735 if(
max_a
==0.0è 
LS_MIN_ALPHA
;

737 if(
š™_æag
==0)

739 
max_a
=
	`MIN
(max_a,1.0);

741 if(
š™_æag
==1)

743 if(
´ev_v®
>0.0 && 
dç
<0.0)

744 
max_a
=
	`MIN
(max_a,-
´ev_v®
/
dç
);

745 
´ev_v®
=-
dç
;

747 if(
š™_æag
==2)

749 if(
´ev_v®
>0.0 && 
dç
<0.0)

750 
max_a
=
	`MIN
(max_a,MIN(1.0,2.02*(
´ev_v®
+
Ägy
)/
dç
));

751 
´ev_v®
=-
Ägy
;

754 if(
max_a
<=
mš_®pha
)

755  
LS_MIN_ALPHA
;

758 
®pha
=
max_a
;

761 
id—l_’”gy
=
Ägy
+
®pha
*
c
*
dç
;

762 
cu¼’t_’”gy
=
func
->
	`F
(
®pha
);

763 if(
cu¼’t_’”gy
<=
id—l_’”gy
)

765 if(
š™_æag
==1)

766 
´ev_v®
*=
®pha
;

767 
Ägy
=
cu¼’t_’”gy
;

768  
LS_S
;

770 
®pha
*=
rho
;

772 if(
®pha
<=
mš_®pha
)

774 
Ägy
=
š™_’”gy
;

775 
func
->
	`F_»£t
();

776  
LS_MIN_ALPHA
;

779 
	}
}

	@macro_extra.h

44 
	#DESIG_1
(
v
è
	)
v

45 
	#DESIG__1
(
n
,
v
è{
DESIG_
##
	`n
(v)}

	)

46 
	#Em±yPyG‘S‘Def_1
 {
NULL
,NULL,NULL,NULL,NULL}

	)

47 
	#Em±yPyM‘hodDef_1
 {
NULL
,NULL,0,NULL}

	)

48 
	#Em±yPyMemb”Def_1
 {
NULL
,0,0,0,NULL}

	)

49 
	#DESIG_2
(
v
è
	`DESIG_1
(v),
	)
v

50 
	#DESIG__2
(
n
,
v
è
	`DESIG__1
Ò,v),{
DESIG_
##
	`n
(v)}

	)

51 
	#Em±yPyG‘S‘Def_2
 
Em±yPyG‘S‘Def_1
,{
NULL
,NULL,NULL,NULL,NULL}

	)

52 
	#Em±yPyM‘hodDef_2
 
Em±yPyM‘hodDef_1
,{
NULL
,NULL,0,NULL}

	)

53 
	#Em±yPyMemb”Def_2
 
Em±yPyMemb”Def_1
,{
NULL
,0,0,0,NULL}

	)

54 
	#DESIG_3
(
v
è
	`DESIG_2
(v),
	)
v

55 
	#DESIG__3
(
n
,
v
è
	`DESIG__2
Ò,v),{
DESIG_
##
	`n
(v)}

	)

56 
	#Em±yPyG‘S‘Def_3
 
Em±yPyG‘S‘Def_2
,{
NULL
,NULL,NULL,NULL,NULL}

	)

57 
	#Em±yPyM‘hodDef_3
 
Em±yPyM‘hodDef_2
,{
NULL
,NULL,0,NULL}

	)

58 
	#Em±yPyMemb”Def_3
 
Em±yPyMemb”Def_2
,{
NULL
,0,0,0,NULL}

	)

59 
	#DESIG_4
(
v
è
	`DESIG_3
(v),
	)
v

60 
	#DESIG__4
(
n
,
v
è
	`DESIG__3
Ò,v),{
DESIG_
##
	`n
(v)}

	)

61 
	#Em±yPyG‘S‘Def_4
 
Em±yPyG‘S‘Def_3
,{
NULL
,NULL,NULL,NULL,NULL}

	)

62 
	#Em±yPyM‘hodDef_4
 
Em±yPyM‘hodDef_3
,{
NULL
,NULL,0,NULL}

	)

63 
	#Em±yPyMemb”Def_4
 
Em±yPyMemb”Def_3
,{
NULL
,0,0,0,NULL}

	)

64 
	#DESIG_5
(
v
è
	`DESIG_4
(v),
	)
v

65 
	#DESIG__5
(
n
,
v
è
	`DESIG__4
Ò,v),{
DESIG_
##
	`n
(v)}

	)

66 
	#Em±yPyG‘S‘Def_5
 
Em±yPyG‘S‘Def_4
,{
NULL
,NULL,NULL,NULL,NULL}

	)

67 
	#Em±yPyM‘hodDef_5
 
Em±yPyM‘hodDef_4
,{
NULL
,NULL,0,NULL}

	)

68 
	#Em±yPyMemb”Def_5
 
Em±yPyMemb”Def_4
,{
NULL
,0,0,0,NULL}

	)

69 
	#DESIG_6
(
v
è
	`DESIG_5
(v),
	)
v

70 
	#DESIG__6
(
n
,
v
è
	`DESIG__5
Ò,v),{
DESIG_
##
	`n
(v)}

	)

71 
	#Em±yPyG‘S‘Def_6
 
Em±yPyG‘S‘Def_5
,{
NULL
,NULL,NULL,NULL,NULL}

	)

72 
	#Em±yPyM‘hodDef_6
 
Em±yPyM‘hodDef_5
,{
NULL
,NULL,0,NULL}

	)

73 
	#Em±yPyMemb”Def_6
 
Em±yPyMemb”Def_5
,{
NULL
,0,0,0,NULL}

	)

74 
	#DESIG_7
(
v
è
	`DESIG_6
(v),
	)
v

75 
	#DESIG__7
(
n
,
v
è
	`DESIG__6
Ò,v),{
DESIG_
##
	`n
(v)}

	)

76 
	#Em±yPyG‘S‘Def_7
 
Em±yPyG‘S‘Def_6
,{
NULL
,NULL,NULL,NULL,NULL}

	)

77 
	#Em±yPyM‘hodDef_7
 
Em±yPyM‘hodDef_6
,{
NULL
,NULL,0,NULL}

	)

78 
	#Em±yPyMemb”Def_7
 
Em±yPyMemb”Def_6
,{
NULL
,0,0,0,NULL}

	)

79 
	#DESIG_8
(
v
è
	`DESIG_7
(v),
	)
v

80 
	#DESIG__8
(
n
,
v
è
	`DESIG__7
Ò,v),{
DESIG_
##
	`n
(v)}

	)

81 
	#Em±yPyG‘S‘Def_8
 
Em±yPyG‘S‘Def_7
,{
NULL
,NULL,NULL,NULL,NULL}

	)

82 
	#Em±yPyM‘hodDef_8
 
Em±yPyM‘hodDef_7
,{
NULL
,NULL,0,NULL}

	)

83 
	#Em±yPyMemb”Def_8
 
Em±yPyMemb”Def_7
,{
NULL
,0,0,0,NULL}

	)

84 
	#DESIG_9
(
v
è
	`DESIG_8
(v),
	)
v

85 
	#DESIG__9
(
n
,
v
è
	`DESIG__8
Ò,v),{
DESIG_
##
	`n
(v)}

	)

86 
	#Em±yPyG‘S‘Def_9
 
Em±yPyG‘S‘Def_8
,{
NULL
,NULL,NULL,NULL,NULL}

	)

87 
	#Em±yPyM‘hodDef_9
 
Em±yPyM‘hodDef_8
,{
NULL
,NULL,0,NULL}

	)

88 
	#Em±yPyMemb”Def_9
 
Em±yPyMemb”Def_8
,{
NULL
,0,0,0,NULL}

	)

89 
	#DESIG_10
(
v
è
	`DESIG_9
(v),
	)
v

90 
	#DESIG__10
(
n
,
v
è
	`DESIG__9
Ò,v),{
DESIG_
##
	`n
(v)}

	)

91 
	#Em±yPyG‘S‘Def_10
 
Em±yPyG‘S‘Def_9
,{
NULL
,NULL,NULL,NULL,NULL}

	)

92 
	#Em±yPyM‘hodDef_10
 
Em±yPyM‘hodDef_9
,{
NULL
,NULL,0,NULL}

	)

93 
	#Em±yPyMemb”Def_10
 
Em±yPyMemb”Def_9
,{
NULL
,0,0,0,NULL}

	)

94 
	#DESIG_11
(
v
è
	`DESIG_10
(v),
	)
v

95 
	#DESIG__11
(
n
,
v
è
	`DESIG__10
Ò,v),{
DESIG_
##
	`n
(v)}

	)

96 
	#Em±yPyG‘S‘Def_11
 
Em±yPyG‘S‘Def_10
,{
NULL
,NULL,NULL,NULL,NULL}

	)

97 
	#Em±yPyM‘hodDef_11
 
Em±yPyM‘hodDef_10
,{
NULL
,NULL,0,NULL}

	)

98 
	#Em±yPyMemb”Def_11
 
Em±yPyMemb”Def_10
,{
NULL
,0,0,0,NULL}

	)

99 
	#DESIG_12
(
v
è
	`DESIG_11
(v),
	)
v

100 
	#DESIG__12
(
n
,
v
è
	`DESIG__11
Ò,v),{
DESIG_
##
	`n
(v)}

	)

101 
	#Em±yPyG‘S‘Def_12
 
Em±yPyG‘S‘Def_11
,{
NULL
,NULL,NULL,NULL,NULL}

	)

102 
	#Em±yPyM‘hodDef_12
 
Em±yPyM‘hodDef_11
,{
NULL
,NULL,0,NULL}

	)

103 
	#Em±yPyMemb”Def_12
 
Em±yPyMemb”Def_11
,{
NULL
,0,0,0,NULL}

	)

104 
	#DESIG_13
(
v
è
	`DESIG_12
(v),
	)
v

105 
	#DESIG__13
(
n
,
v
è
	`DESIG__12
Ò,v),{
DESIG_
##
	`n
(v)}

	)

106 
	#Em±yPyG‘S‘Def_13
 
Em±yPyG‘S‘Def_12
,{
NULL
,NULL,NULL,NULL,NULL}

	)

107 
	#Em±yPyM‘hodDef_13
 
Em±yPyM‘hodDef_12
,{
NULL
,NULL,0,NULL}

	)

108 
	#Em±yPyMemb”Def_13
 
Em±yPyMemb”Def_12
,{
NULL
,0,0,0,NULL}

	)

109 
	#DESIG_14
(
v
è
	`DESIG_13
(v),
	)
v

110 
	#DESIG__14
(
n
,
v
è
	`DESIG__13
Ò,v),{
DESIG_
##
	`n
(v)}

	)

111 
	#Em±yPyG‘S‘Def_14
 
Em±yPyG‘S‘Def_13
,{
NULL
,NULL,NULL,NULL,NULL}

	)

112 
	#Em±yPyM‘hodDef_14
 
Em±yPyM‘hodDef_13
,{
NULL
,NULL,0,NULL}

	)

113 
	#Em±yPyMemb”Def_14
 
Em±yPyMemb”Def_13
,{
NULL
,0,0,0,NULL}

	)

114 
	#DESIG_15
(
v
è
	`DESIG_14
(v),
	)
v

115 
	#DESIG__15
(
n
,
v
è
	`DESIG__14
Ò,v),{
DESIG_
##
	`n
(v)}

	)

116 
	#Em±yPyG‘S‘Def_15
 
Em±yPyG‘S‘Def_14
,{
NULL
,NULL,NULL,NULL,NULL}

	)

117 
	#Em±yPyM‘hodDef_15
 
Em±yPyM‘hodDef_14
,{
NULL
,NULL,0,NULL}

	)

118 
	#Em±yPyMemb”Def_15
 
Em±yPyMemb”Def_14
,{
NULL
,0,0,0,NULL}

	)

119 
	#DESIG_16
(
v
è
	`DESIG_15
(v),
	)
v

120 
	#DESIG__16
(
n
,
v
è
	`DESIG__15
Ò,v),{
DESIG_
##
	`n
(v)}

	)

121 
	#Em±yPyG‘S‘Def_16
 
Em±yPyG‘S‘Def_15
,{
NULL
,NULL,NULL,NULL,NULL}

	)

122 
	#Em±yPyM‘hodDef_16
 
Em±yPyM‘hodDef_15
,{
NULL
,NULL,0,NULL}

	)

123 
	#Em±yPyMemb”Def_16
 
Em±yPyMemb”Def_15
,{
NULL
,0,0,0,NULL}

	)

124 
	#DESIG_17
(
v
è
	`DESIG_16
(v),
	)
v

125 
	#DESIG__17
(
n
,
v
è
	`DESIG__16
Ò,v),{
DESIG_
##
	`n
(v)}

	)

126 
	#Em±yPyG‘S‘Def_17
 
Em±yPyG‘S‘Def_16
,{
NULL
,NULL,NULL,NULL,NULL}

	)

127 
	#Em±yPyM‘hodDef_17
 
Em±yPyM‘hodDef_16
,{
NULL
,NULL,0,NULL}

	)

128 
	#Em±yPyMemb”Def_17
 
Em±yPyMemb”Def_16
,{
NULL
,0,0,0,NULL}

	)

129 
	#DESIG_18
(
v
è
	`DESIG_17
(v),
	)
v

130 
	#DESIG__18
(
n
,
v
è
	`DESIG__17
Ò,v),{
DESIG_
##
	`n
(v)}

	)

131 
	#Em±yPyG‘S‘Def_18
 
Em±yPyG‘S‘Def_17
,{
NULL
,NULL,NULL,NULL,NULL}

	)

132 
	#Em±yPyM‘hodDef_18
 
Em±yPyM‘hodDef_17
,{
NULL
,NULL,0,NULL}

	)

133 
	#Em±yPyMemb”Def_18
 
Em±yPyMemb”Def_17
,{
NULL
,0,0,0,NULL}

	)

134 
	#DESIG_19
(
v
è
	`DESIG_18
(v),
	)
v

135 
	#DESIG__19
(
n
,
v
è
	`DESIG__18
Ò,v),{
DESIG_
##
	`n
(v)}

	)

136 
	#Em±yPyG‘S‘Def_19
 
Em±yPyG‘S‘Def_18
,{
NULL
,NULL,NULL,NULL,NULL}

	)

137 
	#Em±yPyM‘hodDef_19
 
Em±yPyM‘hodDef_18
,{
NULL
,NULL,0,NULL}

	)

138 
	#Em±yPyMemb”Def_19
 
Em±yPyMemb”Def_18
,{
NULL
,0,0,0,NULL}

	)

139 
	#DESIG_20
(
v
è
	`DESIG_19
(v),
	)
v

140 
	#DESIG__20
(
n
,
v
è
	`DESIG__19
Ò,v),{
DESIG_
##
	`n
(v)}

	)

141 
	#Em±yPyG‘S‘Def_20
 
Em±yPyG‘S‘Def_19
,{
NULL
,NULL,NULL,NULL,NULL}

	)

142 
	#Em±yPyM‘hodDef_20
 
Em±yPyM‘hodDef_19
,{
NULL
,NULL,0,NULL}

	)

143 
	#Em±yPyMemb”Def_20
 
Em±yPyMemb”Def_19
,{
NULL
,0,0,0,NULL}

	)

144 
	#DESIG_21
(
v
è
	`DESIG_20
(v),
	)
v

145 
	#DESIG__21
(
n
,
v
è
	`DESIG__20
Ò,v),{
DESIG_
##
	`n
(v)}

	)

146 
	#Em±yPyG‘S‘Def_21
 
Em±yPyG‘S‘Def_20
,{
NULL
,NULL,NULL,NULL,NULL}

	)

147 
	#Em±yPyM‘hodDef_21
 
Em±yPyM‘hodDef_20
,{
NULL
,NULL,0,NULL}

	)

148 
	#Em±yPyMemb”Def_21
 
Em±yPyMemb”Def_20
,{
NULL
,0,0,0,NULL}

	)

149 
	#DESIG_22
(
v
è
	`DESIG_21
(v),
	)
v

150 
	#DESIG__22
(
n
,
v
è
	`DESIG__21
Ò,v),{
DESIG_
##
	`n
(v)}

	)

151 
	#Em±yPyG‘S‘Def_22
 
Em±yPyG‘S‘Def_21
,{
NULL
,NULL,NULL,NULL,NULL}

	)

152 
	#Em±yPyM‘hodDef_22
 
Em±yPyM‘hodDef_21
,{
NULL
,NULL,0,NULL}

	)

153 
	#Em±yPyMemb”Def_22
 
Em±yPyMemb”Def_21
,{
NULL
,0,0,0,NULL}

	)

154 
	#DESIG_23
(
v
è
	`DESIG_22
(v),
	)
v

155 
	#DESIG__23
(
n
,
v
è
	`DESIG__22
Ò,v),{
DESIG_
##
	`n
(v)}

	)

156 
	#Em±yPyG‘S‘Def_23
 
Em±yPyG‘S‘Def_22
,{
NULL
,NULL,NULL,NULL,NULL}

	)

157 
	#Em±yPyM‘hodDef_23
 
Em±yPyM‘hodDef_22
,{
NULL
,NULL,0,NULL}

	)

158 
	#Em±yPyMemb”Def_23
 
Em±yPyMemb”Def_22
,{
NULL
,0,0,0,NULL}

	)

159 
	#DESIG_24
(
v
è
	`DESIG_23
(v),
	)
v

160 
	#DESIG__24
(
n
,
v
è
	`DESIG__23
Ò,v),{
DESIG_
##
	`n
(v)}

	)

161 
	#Em±yPyG‘S‘Def_24
 
Em±yPyG‘S‘Def_23
,{
NULL
,NULL,NULL,NULL,NULL}

	)

162 
	#Em±yPyM‘hodDef_24
 
Em±yPyM‘hodDef_23
,{
NULL
,NULL,0,NULL}

	)

163 
	#Em±yPyMemb”Def_24
 
Em±yPyMemb”Def_23
,{
NULL
,0,0,0,NULL}

	)

164 
	#DESIG_25
(
v
è
	`DESIG_24
(v),
	)
v

165 
	#DESIG__25
(
n
,
v
è
	`DESIG__24
Ò,v),{
DESIG_
##
	`n
(v)}

	)

166 
	#Em±yPyG‘S‘Def_25
 
Em±yPyG‘S‘Def_24
,{
NULL
,NULL,NULL,NULL,NULL}

	)

167 
	#Em±yPyM‘hodDef_25
 
Em±yPyM‘hodDef_24
,{
NULL
,NULL,0,NULL}

	)

168 
	#Em±yPyMemb”Def_25
 
Em±yPyMemb”Def_24
,{
NULL
,0,0,0,NULL}

	)

169 
	#DESIG_26
(
v
è
	`DESIG_25
(v),
	)
v

170 
	#DESIG__26
(
n
,
v
è
	`DESIG__25
Ò,v),{
DESIG_
##
	`n
(v)}

	)

171 
	#Em±yPyG‘S‘Def_26
 
Em±yPyG‘S‘Def_25
,{
NULL
,NULL,NULL,NULL,NULL}

	)

172 
	#Em±yPyM‘hodDef_26
 
Em±yPyM‘hodDef_25
,{
NULL
,NULL,0,NULL}

	)

173 
	#Em±yPyMemb”Def_26
 
Em±yPyMemb”Def_25
,{
NULL
,0,0,0,NULL}

	)

174 
	#DESIG_27
(
v
è
	`DESIG_26
(v),
	)
v

175 
	#DESIG__27
(
n
,
v
è
	`DESIG__26
Ò,v),{
DESIG_
##
	`n
(v)}

	)

176 
	#Em±yPyG‘S‘Def_27
 
Em±yPyG‘S‘Def_26
,{
NULL
,NULL,NULL,NULL,NULL}

	)

177 
	#Em±yPyM‘hodDef_27
 
Em±yPyM‘hodDef_26
,{
NULL
,NULL,0,NULL}

	)

178 
	#Em±yPyMemb”Def_27
 
Em±yPyMemb”Def_26
,{
NULL
,0,0,0,NULL}

	)

179 
	#DESIG_28
(
v
è
	`DESIG_27
(v),
	)
v

180 
	#DESIG__28
(
n
,
v
è
	`DESIG__27
Ò,v),{
DESIG_
##
	`n
(v)}

	)

181 
	#Em±yPyG‘S‘Def_28
 
Em±yPyG‘S‘Def_27
,{
NULL
,NULL,NULL,NULL,NULL}

	)

182 
	#Em±yPyM‘hodDef_28
 
Em±yPyM‘hodDef_27
,{
NULL
,NULL,0,NULL}

	)

183 
	#Em±yPyMemb”Def_28
 
Em±yPyMemb”Def_27
,{
NULL
,0,0,0,NULL}

	)

184 
	#DESIG_29
(
v
è
	`DESIG_28
(v),
	)
v

185 
	#DESIG__29
(
n
,
v
è
	`DESIG__28
Ò,v),{
DESIG_
##
	`n
(v)}

	)

186 
	#Em±yPyG‘S‘Def_29
 
Em±yPyG‘S‘Def_28
,{
NULL
,NULL,NULL,NULL,NULL}

	)

187 
	#Em±yPyM‘hodDef_29
 
Em±yPyM‘hodDef_28
,{
NULL
,NULL,0,NULL}

	)

188 
	#Em±yPyMemb”Def_29
 
Em±yPyMemb”Def_28
,{
NULL
,0,0,0,NULL}

	)

189 
	#DESIG_30
(
v
è
	`DESIG_29
(v),
	)
v

190 
	#DESIG__30
(
n
,
v
è
	`DESIG__29
Ò,v),{
DESIG_
##
	`n
(v)}

	)

191 
	#Em±yPyG‘S‘Def_30
 
Em±yPyG‘S‘Def_29
,{
NULL
,NULL,NULL,NULL,NULL}

	)

192 
	#Em±yPyM‘hodDef_30
 
Em±yPyM‘hodDef_29
,{
NULL
,NULL,0,NULL}

	)

193 
	#Em±yPyMemb”Def_30
 
Em±yPyMemb”Def_29
,{
NULL
,0,0,0,NULL}

	)

194 
	#DESIG_31
(
v
è
	`DESIG_30
(v),
	)
v

195 
	#DESIG__31
(
n
,
v
è
	`DESIG__30
Ò,v),{
DESIG_
##
	`n
(v)}

	)

196 
	#Em±yPyG‘S‘Def_31
 
Em±yPyG‘S‘Def_30
,{
NULL
,NULL,NULL,NULL,NULL}

	)

197 
	#Em±yPyM‘hodDef_31
 
Em±yPyM‘hodDef_30
,{
NULL
,NULL,0,NULL}

	)

198 
	#Em±yPyMemb”Def_31
 
Em±yPyMemb”Def_30
,{
NULL
,0,0,0,NULL}

	)

199 
	#DESIG_32
(
v
è
	`DESIG_31
(v),
	)
v

200 
	#DESIG__32
(
n
,
v
è
	`DESIG__31
Ò,v),{
DESIG_
##
	`n
(v)}

	)

201 
	#Em±yPyG‘S‘Def_32
 
Em±yPyG‘S‘Def_31
,{
NULL
,NULL,NULL,NULL,NULL}

	)

202 
	#Em±yPyM‘hodDef_32
 
Em±yPyM‘hodDef_31
,{
NULL
,NULL,0,NULL}

	)

203 
	#Em±yPyMemb”Def_32
 
Em±yPyMemb”Def_31
,{
NULL
,0,0,0,NULL}

	)

204 
	#DESIG_33
(
v
è
	`DESIG_32
(v),
	)
v

205 
	#DESIG__33
(
n
,
v
è
	`DESIG__32
Ò,v),{
DESIG_
##
	`n
(v)}

	)

206 
	#Em±yPyG‘S‘Def_33
 
Em±yPyG‘S‘Def_32
,{
NULL
,NULL,NULL,NULL,NULL}

	)

207 
	#Em±yPyM‘hodDef_33
 
Em±yPyM‘hodDef_32
,{
NULL
,NULL,0,NULL}

	)

208 
	#Em±yPyMemb”Def_33
 
Em±yPyMemb”Def_32
,{
NULL
,0,0,0,NULL}

	)

209 
	#DESIG_34
(
v
è
	`DESIG_33
(v),
	)
v

210 
	#DESIG__34
(
n
,
v
è
	`DESIG__33
Ò,v),{
DESIG_
##
	`n
(v)}

	)

211 
	#Em±yPyG‘S‘Def_34
 
Em±yPyG‘S‘Def_33
,{
NULL
,NULL,NULL,NULL,NULL}

	)

212 
	#Em±yPyM‘hodDef_34
 
Em±yPyM‘hodDef_33
,{
NULL
,NULL,0,NULL}

	)

213 
	#Em±yPyMemb”Def_34
 
Em±yPyMemb”Def_33
,{
NULL
,0,0,0,NULL}

	)

214 
	#DESIG_35
(
v
è
	`DESIG_34
(v),
	)
v

215 
	#DESIG__35
(
n
,
v
è
	`DESIG__34
Ò,v),{
DESIG_
##
	`n
(v)}

	)

216 
	#Em±yPyG‘S‘Def_35
 
Em±yPyG‘S‘Def_34
,{
NULL
,NULL,NULL,NULL,NULL}

	)

217 
	#Em±yPyM‘hodDef_35
 
Em±yPyM‘hodDef_34
,{
NULL
,NULL,0,NULL}

	)

218 
	#Em±yPyMemb”Def_35
 
Em±yPyMemb”Def_34
,{
NULL
,0,0,0,NULL}

	)

219 
	#DESIG_36
(
v
è
	`DESIG_35
(v),
	)
v

220 
	#DESIG__36
(
n
,
v
è
	`DESIG__35
Ò,v),{
DESIG_
##
	`n
(v)}

	)

221 
	#Em±yPyG‘S‘Def_36
 
Em±yPyG‘S‘Def_35
,{
NULL
,NULL,NULL,NULL,NULL}

	)

222 
	#Em±yPyM‘hodDef_36
 
Em±yPyM‘hodDef_35
,{
NULL
,NULL,0,NULL}

	)

223 
	#Em±yPyMemb”Def_36
 
Em±yPyMemb”Def_35
,{
NULL
,0,0,0,NULL}

	)

224 
	#DESIG_37
(
v
è
	`DESIG_36
(v),
	)
v

225 
	#DESIG__37
(
n
,
v
è
	`DESIG__36
Ò,v),{
DESIG_
##
	`n
(v)}

	)

226 
	#Em±yPyG‘S‘Def_37
 
Em±yPyG‘S‘Def_36
,{
NULL
,NULL,NULL,NULL,NULL}

	)

227 
	#Em±yPyM‘hodDef_37
 
Em±yPyM‘hodDef_36
,{
NULL
,NULL,0,NULL}

	)

228 
	#Em±yPyMemb”Def_37
 
Em±yPyMemb”Def_36
,{
NULL
,0,0,0,NULL}

	)

229 
	#DESIG_38
(
v
è
	`DESIG_37
(v),
	)
v

230 
	#DESIG__38
(
n
,
v
è
	`DESIG__37
Ò,v),{
DESIG_
##
	`n
(v)}

	)

231 
	#Em±yPyG‘S‘Def_38
 
Em±yPyG‘S‘Def_37
,{
NULL
,NULL,NULL,NULL,NULL}

	)

232 
	#Em±yPyM‘hodDef_38
 
Em±yPyM‘hodDef_37
,{
NULL
,NULL,0,NULL}

	)

233 
	#Em±yPyMemb”Def_38
 
Em±yPyMemb”Def_37
,{
NULL
,0,0,0,NULL}

	)

234 
	#DESIG_39
(
v
è
	`DESIG_38
(v),
	)
v

235 
	#DESIG__39
(
n
,
v
è
	`DESIG__38
Ò,v),{
DESIG_
##
	`n
(v)}

	)

236 
	#Em±yPyG‘S‘Def_39
 
Em±yPyG‘S‘Def_38
,{
NULL
,NULL,NULL,NULL,NULL}

	)

237 
	#Em±yPyM‘hodDef_39
 
Em±yPyM‘hodDef_38
,{
NULL
,NULL,0,NULL}

	)

238 
	#Em±yPyMemb”Def_39
 
Em±yPyMemb”Def_38
,{
NULL
,0,0,0,NULL}

	)

239 
	#DESIG_40
(
v
è
	`DESIG_39
(v),
	)
v

240 
	#DESIG__40
(
n
,
v
è
	`DESIG__39
Ò,v),{
DESIG_
##
	`n
(v)}

	)

241 
	#Em±yPyG‘S‘Def_40
 
Em±yPyG‘S‘Def_39
,{
NULL
,NULL,NULL,NULL,NULL}

	)

242 
	#Em±yPyM‘hodDef_40
 
Em±yPyM‘hodDef_39
,{
NULL
,NULL,0,NULL}

	)

243 
	#Em±yPyMemb”Def_40
 
Em±yPyMemb”Def_39
,{
NULL
,0,0,0,NULL}

	)

244 
	#DESIG_41
(
v
è
	`DESIG_40
(v),
	)
v

245 
	#DESIG__41
(
n
,
v
è
	`DESIG__40
Ò,v),{
DESIG_
##
	`n
(v)}

	)

246 
	#Em±yPyG‘S‘Def_41
 
Em±yPyG‘S‘Def_40
,{
NULL
,NULL,NULL,NULL,NULL}

	)

247 
	#Em±yPyM‘hodDef_41
 
Em±yPyM‘hodDef_40
,{
NULL
,NULL,0,NULL}

	)

248 
	#Em±yPyMemb”Def_41
 
Em±yPyMemb”Def_40
,{
NULL
,0,0,0,NULL}

	)

249 
	#DESIG_42
(
v
è
	`DESIG_41
(v),
	)
v

250 
	#DESIG__42
(
n
,
v
è
	`DESIG__41
Ò,v),{
DESIG_
##
	`n
(v)}

	)

251 
	#Em±yPyG‘S‘Def_42
 
Em±yPyG‘S‘Def_41
,{
NULL
,NULL,NULL,NULL,NULL}

	)

252 
	#Em±yPyM‘hodDef_42
 
Em±yPyM‘hodDef_41
,{
NULL
,NULL,0,NULL}

	)

253 
	#Em±yPyMemb”Def_42
 
Em±yPyMemb”Def_41
,{
NULL
,0,0,0,NULL}

	)

254 
	#DESIG_43
(
v
è
	`DESIG_42
(v),
	)
v

255 
	#DESIG__43
(
n
,
v
è
	`DESIG__42
Ò,v),{
DESIG_
##
	`n
(v)}

	)

256 
	#Em±yPyG‘S‘Def_43
 
Em±yPyG‘S‘Def_42
,{
NULL
,NULL,NULL,NULL,NULL}

	)

257 
	#Em±yPyM‘hodDef_43
 
Em±yPyM‘hodDef_42
,{
NULL
,NULL,0,NULL}

	)

258 
	#Em±yPyMemb”Def_43
 
Em±yPyMemb”Def_42
,{
NULL
,0,0,0,NULL}

	)

259 
	#DESIG_44
(
v
è
	`DESIG_43
(v),
	)
v

260 
	#DESIG__44
(
n
,
v
è
	`DESIG__43
Ò,v),{
DESIG_
##
	`n
(v)}

	)

261 
	#Em±yPyG‘S‘Def_44
 
Em±yPyG‘S‘Def_43
,{
NULL
,NULL,NULL,NULL,NULL}

	)

262 
	#Em±yPyM‘hodDef_44
 
Em±yPyM‘hodDef_43
,{
NULL
,NULL,0,NULL}

	)

263 
	#Em±yPyMemb”Def_44
 
Em±yPyMemb”Def_43
,{
NULL
,0,0,0,NULL}

	)

264 
	#DESIG_45
(
v
è
	`DESIG_44
(v),
	)
v

265 
	#DESIG__45
(
n
,
v
è
	`DESIG__44
Ò,v),{
DESIG_
##
	`n
(v)}

	)

266 
	#Em±yPyG‘S‘Def_45
 
Em±yPyG‘S‘Def_44
,{
NULL
,NULL,NULL,NULL,NULL}

	)

267 
	#Em±yPyM‘hodDef_45
 
Em±yPyM‘hodDef_44
,{
NULL
,NULL,0,NULL}

	)

268 
	#Em±yPyMemb”Def_45
 
Em±yPyMemb”Def_44
,{
NULL
,0,0,0,NULL}

	)

269 
	#DESIG_46
(
v
è
	`DESIG_45
(v),
	)
v

270 
	#DESIG__46
(
n
,
v
è
	`DESIG__45
Ò,v),{
DESIG_
##
	`n
(v)}

	)

271 
	#Em±yPyG‘S‘Def_46
 
Em±yPyG‘S‘Def_45
,{
NULL
,NULL,NULL,NULL,NULL}

	)

272 
	#Em±yPyM‘hodDef_46
 
Em±yPyM‘hodDef_45
,{
NULL
,NULL,0,NULL}

	)

273 
	#Em±yPyMemb”Def_46
 
Em±yPyMemb”Def_45
,{
NULL
,0,0,0,NULL}

	)

274 
	#DESIG_47
(
v
è
	`DESIG_46
(v),
	)
v

275 
	#DESIG__47
(
n
,
v
è
	`DESIG__46
Ò,v),{
DESIG_
##
	`n
(v)}

	)

276 
	#Em±yPyG‘S‘Def_47
 
Em±yPyG‘S‘Def_46
,{
NULL
,NULL,NULL,NULL,NULL}

	)

277 
	#Em±yPyM‘hodDef_47
 
Em±yPyM‘hodDef_46
,{
NULL
,NULL,0,NULL}

	)

278 
	#Em±yPyMemb”Def_47
 
Em±yPyMemb”Def_46
,{
NULL
,0,0,0,NULL}

	)

279 
	#DESIG_48
(
v
è
	`DESIG_47
(v),
	)
v

280 
	#DESIG__48
(
n
,
v
è
	`DESIG__47
Ò,v),{
DESIG_
##
	`n
(v)}

	)

281 
	#Em±yPyG‘S‘Def_48
 
Em±yPyG‘S‘Def_47
,{
NULL
,NULL,NULL,NULL,NULL}

	)

282 
	#Em±yPyM‘hodDef_48
 
Em±yPyM‘hodDef_47
,{
NULL
,NULL,0,NULL}

	)

283 
	#Em±yPyMemb”Def_48
 
Em±yPyMemb”Def_47
,{
NULL
,0,0,0,NULL}

	)

284 
	#DESIG_49
(
v
è
	`DESIG_48
(v),
	)
v

285 
	#DESIG__49
(
n
,
v
è
	`DESIG__48
Ò,v),{
DESIG_
##
	`n
(v)}

	)

286 
	#Em±yPyG‘S‘Def_49
 
Em±yPyG‘S‘Def_48
,{
NULL
,NULL,NULL,NULL,NULL}

	)

287 
	#Em±yPyM‘hodDef_49
 
Em±yPyM‘hodDef_48
,{
NULL
,NULL,0,NULL}

	)

288 
	#Em±yPyMemb”Def_49
 
Em±yPyMemb”Def_48
,{
NULL
,0,0,0,NULL}

	)

289 
	#DESIG_50
(
v
è
	`DESIG_49
(v),
	)
v

290 
	#DESIG__50
(
n
,
v
è
	`DESIG__49
Ò,v),{
DESIG_
##
	`n
(v)}

	)

291 
	#Em±yPyG‘S‘Def_50
 
Em±yPyG‘S‘Def_49
,{
NULL
,NULL,NULL,NULL,NULL}

	)

292 
	#Em±yPyM‘hodDef_50
 
Em±yPyM‘hodDef_49
,{
NULL
,NULL,0,NULL}

	)

293 
	#Em±yPyMemb”Def_50
 
Em±yPyMemb”Def_49
,{
NULL
,0,0,0,NULL}

	)

294 
	#DESIG_51
(
v
è
	`DESIG_50
(v),
	)
v

295 
	#DESIG__51
(
n
,
v
è
	`DESIG__50
Ò,v),{
DESIG_
##
	`n
(v)}

	)

296 
	#Em±yPyG‘S‘Def_51
 
Em±yPyG‘S‘Def_50
,{
NULL
,NULL,NULL,NULL,NULL}

	)

297 
	#Em±yPyM‘hodDef_51
 
Em±yPyM‘hodDef_50
,{
NULL
,NULL,0,NULL}

	)

298 
	#Em±yPyMemb”Def_51
 
Em±yPyMemb”Def_50
,{
NULL
,0,0,0,NULL}

	)

299 
	#DESIG_52
(
v
è
	`DESIG_51
(v),
	)
v

300 
	#DESIG__52
(
n
,
v
è
	`DESIG__51
Ò,v),{
DESIG_
##
	`n
(v)}

	)

301 
	#Em±yPyG‘S‘Def_52
 
Em±yPyG‘S‘Def_51
,{
NULL
,NULL,NULL,NULL,NULL}

	)

302 
	#Em±yPyM‘hodDef_52
 
Em±yPyM‘hodDef_51
,{
NULL
,NULL,0,NULL}

	)

303 
	#Em±yPyMemb”Def_52
 
Em±yPyMemb”Def_51
,{
NULL
,0,0,0,NULL}

	)

304 
	#DESIG_53
(
v
è
	`DESIG_52
(v),
	)
v

305 
	#DESIG__53
(
n
,
v
è
	`DESIG__52
Ò,v),{
DESIG_
##
	`n
(v)}

	)

306 
	#Em±yPyG‘S‘Def_53
 
Em±yPyG‘S‘Def_52
,{
NULL
,NULL,NULL,NULL,NULL}

	)

307 
	#Em±yPyM‘hodDef_53
 
Em±yPyM‘hodDef_52
,{
NULL
,NULL,0,NULL}

	)

308 
	#Em±yPyMemb”Def_53
 
Em±yPyMemb”Def_52
,{
NULL
,0,0,0,NULL}

	)

309 
	#DESIG_54
(
v
è
	`DESIG_53
(v),
	)
v

310 
	#DESIG__54
(
n
,
v
è
	`DESIG__53
Ò,v),{
DESIG_
##
	`n
(v)}

	)

311 
	#Em±yPyG‘S‘Def_54
 
Em±yPyG‘S‘Def_53
,{
NULL
,NULL,NULL,NULL,NULL}

	)

312 
	#Em±yPyM‘hodDef_54
 
Em±yPyM‘hodDef_53
,{
NULL
,NULL,0,NULL}

	)

313 
	#Em±yPyMemb”Def_54
 
Em±yPyMemb”Def_53
,{
NULL
,0,0,0,NULL}

	)

314 
	#DESIG_55
(
v
è
	`DESIG_54
(v),
	)
v

315 
	#DESIG__55
(
n
,
v
è
	`DESIG__54
Ò,v),{
DESIG_
##
	`n
(v)}

	)

316 
	#Em±yPyG‘S‘Def_55
 
Em±yPyG‘S‘Def_54
,{
NULL
,NULL,NULL,NULL,NULL}

	)

317 
	#Em±yPyM‘hodDef_55
 
Em±yPyM‘hodDef_54
,{
NULL
,NULL,0,NULL}

	)

318 
	#Em±yPyMemb”Def_55
 
Em±yPyMemb”Def_54
,{
NULL
,0,0,0,NULL}

	)

319 
	#DESIG_56
(
v
è
	`DESIG_55
(v),
	)
v

320 
	#DESIG__56
(
n
,
v
è
	`DESIG__55
Ò,v),{
DESIG_
##
	`n
(v)}

	)

321 
	#Em±yPyG‘S‘Def_56
 
Em±yPyG‘S‘Def_55
,{
NULL
,NULL,NULL,NULL,NULL}

	)

322 
	#Em±yPyM‘hodDef_56
 
Em±yPyM‘hodDef_55
,{
NULL
,NULL,0,NULL}

	)

323 
	#Em±yPyMemb”Def_56
 
Em±yPyMemb”Def_55
,{
NULL
,0,0,0,NULL}

	)

324 
	#DESIG_57
(
v
è
	`DESIG_56
(v),
	)
v

325 
	#DESIG__57
(
n
,
v
è
	`DESIG__56
Ò,v),{
DESIG_
##
	`n
(v)}

	)

326 
	#Em±yPyG‘S‘Def_57
 
Em±yPyG‘S‘Def_56
,{
NULL
,NULL,NULL,NULL,NULL}

	)

327 
	#Em±yPyM‘hodDef_57
 
Em±yPyM‘hodDef_56
,{
NULL
,NULL,0,NULL}

	)

328 
	#Em±yPyMemb”Def_57
 
Em±yPyMemb”Def_56
,{
NULL
,0,0,0,NULL}

	)

329 
	#DESIG_58
(
v
è
	`DESIG_57
(v),
	)
v

330 
	#DESIG__58
(
n
,
v
è
	`DESIG__57
Ò,v),{
DESIG_
##
	`n
(v)}

	)

331 
	#Em±yPyG‘S‘Def_58
 
Em±yPyG‘S‘Def_57
,{
NULL
,NULL,NULL,NULL,NULL}

	)

332 
	#Em±yPyM‘hodDef_58
 
Em±yPyM‘hodDef_57
,{
NULL
,NULL,0,NULL}

	)

333 
	#Em±yPyMemb”Def_58
 
Em±yPyMemb”Def_57
,{
NULL
,0,0,0,NULL}

	)

334 
	#DESIG_59
(
v
è
	`DESIG_58
(v),
	)
v

335 
	#DESIG__59
(
n
,
v
è
	`DESIG__58
Ò,v),{
DESIG_
##
	`n
(v)}

	)

336 
	#Em±yPyG‘S‘Def_59
 
Em±yPyG‘S‘Def_58
,{
NULL
,NULL,NULL,NULL,NULL}

	)

337 
	#Em±yPyM‘hodDef_59
 
Em±yPyM‘hodDef_58
,{
NULL
,NULL,0,NULL}

	)

338 
	#Em±yPyMemb”Def_59
 
Em±yPyMemb”Def_58
,{
NULL
,0,0,0,NULL}

	)

339 
	#DESIG_60
(
v
è
	`DESIG_59
(v),
	)
v

340 
	#DESIG__60
(
n
,
v
è
	`DESIG__59
Ò,v),{
DESIG_
##
	`n
(v)}

	)

341 
	#Em±yPyG‘S‘Def_60
 
Em±yPyG‘S‘Def_59
,{
NULL
,NULL,NULL,NULL,NULL}

	)

342 
	#Em±yPyM‘hodDef_60
 
Em±yPyM‘hodDef_59
,{
NULL
,NULL,0,NULL}

	)

343 
	#Em±yPyMemb”Def_60
 
Em±yPyMemb”Def_59
,{
NULL
,0,0,0,NULL}

	)

344 
	#DESIG_61
(
v
è
	`DESIG_60
(v),
	)
v

345 
	#DESIG__61
(
n
,
v
è
	`DESIG__60
Ò,v),{
DESIG_
##
	`n
(v)}

	)

346 
	#Em±yPyG‘S‘Def_61
 
Em±yPyG‘S‘Def_60
,{
NULL
,NULL,NULL,NULL,NULL}

	)

347 
	#Em±yPyM‘hodDef_61
 
Em±yPyM‘hodDef_60
,{
NULL
,NULL,0,NULL}

	)

348 
	#Em±yPyMemb”Def_61
 
Em±yPyMemb”Def_60
,{
NULL
,0,0,0,NULL}

	)

349 
	#DESIG_62
(
v
è
	`DESIG_61
(v),
	)
v

350 
	#DESIG__62
(
n
,
v
è
	`DESIG__61
Ò,v),{
DESIG_
##
	`n
(v)}

	)

351 
	#Em±yPyG‘S‘Def_62
 
Em±yPyG‘S‘Def_61
,{
NULL
,NULL,NULL,NULL,NULL}

	)

352 
	#Em±yPyM‘hodDef_62
 
Em±yPyM‘hodDef_61
,{
NULL
,NULL,0,NULL}

	)

353 
	#Em±yPyMemb”Def_62
 
Em±yPyMemb”Def_61
,{
NULL
,0,0,0,NULL}

	)

354 
	#DESIG_63
(
v
è
	`DESIG_62
(v),
	)
v

355 
	#DESIG__63
(
n
,
v
è
	`DESIG__62
Ò,v),{
DESIG_
##
	`n
(v)}

	)

356 
	#Em±yPyG‘S‘Def_63
 
Em±yPyG‘S‘Def_62
,{
NULL
,NULL,NULL,NULL,NULL}

	)

357 
	#Em±yPyM‘hodDef_63
 
Em±yPyM‘hodDef_62
,{
NULL
,NULL,0,NULL}

	)

358 
	#Em±yPyMemb”Def_63
 
Em±yPyMemb”Def_62
,{
NULL
,0,0,0,NULL}

	)

359 
	#DESIG_64
(
v
è
	`DESIG_63
(v),
	)
v

360 
	#DESIG__64
(
n
,
v
è
	`DESIG__63
Ò,v),{
DESIG_
##
	`n
(v)}

	)

361 
	#Em±yPyG‘S‘Def_64
 
Em±yPyG‘S‘Def_63
,{
NULL
,NULL,NULL,NULL,NULL}

	)

362 
	#Em±yPyM‘hodDef_64
 
Em±yPyM‘hodDef_63
,{
NULL
,NULL,0,NULL}

	)

363 
	#Em±yPyMemb”Def_64
 
Em±yPyMemb”Def_63
,{
NULL
,0,0,0,NULL}

	)

364 
	#DESIG_65
(
v
è
	`DESIG_64
(v),
	)
v

365 
	#DESIG__65
(
n
,
v
è
	`DESIG__64
Ò,v),{
DESIG_
##
	`n
(v)}

	)

366 
	#Em±yPyG‘S‘Def_65
 
Em±yPyG‘S‘Def_64
,{
NULL
,NULL,NULL,NULL,NULL}

	)

367 
	#Em±yPyM‘hodDef_65
 
Em±yPyM‘hodDef_64
,{
NULL
,NULL,0,NULL}

	)

368 
	#Em±yPyMemb”Def_65
 
Em±yPyMemb”Def_64
,{
NULL
,0,0,0,NULL}

	)

369 
	#DESIG_66
(
v
è
	`DESIG_65
(v),
	)
v

370 
	#DESIG__66
(
n
,
v
è
	`DESIG__65
Ò,v),{
DESIG_
##
	`n
(v)}

	)

371 
	#Em±yPyG‘S‘Def_66
 
Em±yPyG‘S‘Def_65
,{
NULL
,NULL,NULL,NULL,NULL}

	)

372 
	#Em±yPyM‘hodDef_66
 
Em±yPyM‘hodDef_65
,{
NULL
,NULL,0,NULL}

	)

373 
	#Em±yPyMemb”Def_66
 
Em±yPyMemb”Def_65
,{
NULL
,0,0,0,NULL}

	)

374 
	#DESIG_67
(
v
è
	`DESIG_66
(v),
	)
v

375 
	#DESIG__67
(
n
,
v
è
	`DESIG__66
Ò,v),{
DESIG_
##
	`n
(v)}

	)

376 
	#Em±yPyG‘S‘Def_67
 
Em±yPyG‘S‘Def_66
,{
NULL
,NULL,NULL,NULL,NULL}

	)

377 
	#Em±yPyM‘hodDef_67
 
Em±yPyM‘hodDef_66
,{
NULL
,NULL,0,NULL}

	)

378 
	#Em±yPyMemb”Def_67
 
Em±yPyMemb”Def_66
,{
NULL
,0,0,0,NULL}

	)

379 
	#DESIG_68
(
v
è
	`DESIG_67
(v),
	)
v

380 
	#DESIG__68
(
n
,
v
è
	`DESIG__67
Ò,v),{
DESIG_
##
	`n
(v)}

	)

381 
	#Em±yPyG‘S‘Def_68
 
Em±yPyG‘S‘Def_67
,{
NULL
,NULL,NULL,NULL,NULL}

	)

382 
	#Em±yPyM‘hodDef_68
 
Em±yPyM‘hodDef_67
,{
NULL
,NULL,0,NULL}

	)

383 
	#Em±yPyMemb”Def_68
 
Em±yPyMemb”Def_67
,{
NULL
,0,0,0,NULL}

	)

384 
	#DESIG_69
(
v
è
	`DESIG_68
(v),
	)
v

385 
	#DESIG__69
(
n
,
v
è
	`DESIG__68
Ò,v),{
DESIG_
##
	`n
(v)}

	)

386 
	#Em±yPyG‘S‘Def_69
 
Em±yPyG‘S‘Def_68
,{
NULL
,NULL,NULL,NULL,NULL}

	)

387 
	#Em±yPyM‘hodDef_69
 
Em±yPyM‘hodDef_68
,{
NULL
,NULL,0,NULL}

	)

388 
	#Em±yPyMemb”Def_69
 
Em±yPyMemb”Def_68
,{
NULL
,0,0,0,NULL}

	)

389 
	#DESIG_70
(
v
è
	`DESIG_69
(v),
	)
v

390 
	#DESIG__70
(
n
,
v
è
	`DESIG__69
Ò,v),{
DESIG_
##
	`n
(v)}

	)

391 
	#Em±yPyG‘S‘Def_70
 
Em±yPyG‘S‘Def_69
,{
NULL
,NULL,NULL,NULL,NULL}

	)

392 
	#Em±yPyM‘hodDef_70
 
Em±yPyM‘hodDef_69
,{
NULL
,NULL,0,NULL}

	)

393 
	#Em±yPyMemb”Def_70
 
Em±yPyMemb”Def_69
,{
NULL
,0,0,0,NULL}

	)

394 
	#DESIG_71
(
v
è
	`DESIG_70
(v),
	)
v

395 
	#DESIG__71
(
n
,
v
è
	`DESIG__70
Ò,v),{
DESIG_
##
	`n
(v)}

	)

396 
	#Em±yPyG‘S‘Def_71
 
Em±yPyG‘S‘Def_70
,{
NULL
,NULL,NULL,NULL,NULL}

	)

397 
	#Em±yPyM‘hodDef_71
 
Em±yPyM‘hodDef_70
,{
NULL
,NULL,0,NULL}

	)

398 
	#Em±yPyMemb”Def_71
 
Em±yPyMemb”Def_70
,{
NULL
,0,0,0,NULL}

	)

399 
	#DESIG_72
(
v
è
	`DESIG_71
(v),
	)
v

400 
	#DESIG__72
(
n
,
v
è
	`DESIG__71
Ò,v),{
DESIG_
##
	`n
(v)}

	)

401 
	#Em±yPyG‘S‘Def_72
 
Em±yPyG‘S‘Def_71
,{
NULL
,NULL,NULL,NULL,NULL}

	)

402 
	#Em±yPyM‘hodDef_72
 
Em±yPyM‘hodDef_71
,{
NULL
,NULL,0,NULL}

	)

403 
	#Em±yPyMemb”Def_72
 
Em±yPyMemb”Def_71
,{
NULL
,0,0,0,NULL}

	)

404 
	#DESIG_73
(
v
è
	`DESIG_72
(v),
	)
v

405 
	#DESIG__73
(
n
,
v
è
	`DESIG__72
Ò,v),{
DESIG_
##
	`n
(v)}

	)

406 
	#Em±yPyG‘S‘Def_73
 
Em±yPyG‘S‘Def_72
,{
NULL
,NULL,NULL,NULL,NULL}

	)

407 
	#Em±yPyM‘hodDef_73
 
Em±yPyM‘hodDef_72
,{
NULL
,NULL,0,NULL}

	)

408 
	#Em±yPyMemb”Def_73
 
Em±yPyMemb”Def_72
,{
NULL
,0,0,0,NULL}

	)

409 
	#DESIG_74
(
v
è
	`DESIG_73
(v),
	)
v

410 
	#DESIG__74
(
n
,
v
è
	`DESIG__73
Ò,v),{
DESIG_
##
	`n
(v)}

	)

411 
	#Em±yPyG‘S‘Def_74
 
Em±yPyG‘S‘Def_73
,{
NULL
,NULL,NULL,NULL,NULL}

	)

412 
	#Em±yPyM‘hodDef_74
 
Em±yPyM‘hodDef_73
,{
NULL
,NULL,0,NULL}

	)

413 
	#Em±yPyMemb”Def_74
 
Em±yPyMemb”Def_73
,{
NULL
,0,0,0,NULL}

	)

414 
	#DESIG_75
(
v
è
	`DESIG_74
(v),
	)
v

415 
	#DESIG__75
(
n
,
v
è
	`DESIG__74
Ò,v),{
DESIG_
##
	`n
(v)}

	)

416 
	#Em±yPyG‘S‘Def_75
 
Em±yPyG‘S‘Def_74
,{
NULL
,NULL,NULL,NULL,NULL}

	)

417 
	#Em±yPyM‘hodDef_75
 
Em±yPyM‘hodDef_74
,{
NULL
,NULL,0,NULL}

	)

418 
	#Em±yPyMemb”Def_75
 
Em±yPyMemb”Def_74
,{
NULL
,0,0,0,NULL}

	)

419 
	#DESIG_76
(
v
è
	`DESIG_75
(v),
	)
v

420 
	#DESIG__76
(
n
,
v
è
	`DESIG__75
Ò,v),{
DESIG_
##
	`n
(v)}

	)

421 
	#Em±yPyG‘S‘Def_76
 
Em±yPyG‘S‘Def_75
,{
NULL
,NULL,NULL,NULL,NULL}

	)

422 
	#Em±yPyM‘hodDef_76
 
Em±yPyM‘hodDef_75
,{
NULL
,NULL,0,NULL}

	)

423 
	#Em±yPyMemb”Def_76
 
Em±yPyMemb”Def_75
,{
NULL
,0,0,0,NULL}

	)

424 
	#DESIG_77
(
v
è
	`DESIG_76
(v),
	)
v

425 
	#DESIG__77
(
n
,
v
è
	`DESIG__76
Ò,v),{
DESIG_
##
	`n
(v)}

	)

426 
	#Em±yPyG‘S‘Def_77
 
Em±yPyG‘S‘Def_76
,{
NULL
,NULL,NULL,NULL,NULL}

	)

427 
	#Em±yPyM‘hodDef_77
 
Em±yPyM‘hodDef_76
,{
NULL
,NULL,0,NULL}

	)

428 
	#Em±yPyMemb”Def_77
 
Em±yPyMemb”Def_76
,{
NULL
,0,0,0,NULL}

	)

429 
	#DESIG_78
(
v
è
	`DESIG_77
(v),
	)
v

430 
	#DESIG__78
(
n
,
v
è
	`DESIG__77
Ò,v),{
DESIG_
##
	`n
(v)}

	)

431 
	#Em±yPyG‘S‘Def_78
 
Em±yPyG‘S‘Def_77
,{
NULL
,NULL,NULL,NULL,NULL}

	)

432 
	#Em±yPyM‘hodDef_78
 
Em±yPyM‘hodDef_77
,{
NULL
,NULL,0,NULL}

	)

433 
	#Em±yPyMemb”Def_78
 
Em±yPyMemb”Def_77
,{
NULL
,0,0,0,NULL}

	)

434 
	#DESIG_79
(
v
è
	`DESIG_78
(v),
	)
v

435 
	#DESIG__79
(
n
,
v
è
	`DESIG__78
Ò,v),{
DESIG_
##
	`n
(v)}

	)

436 
	#Em±yPyG‘S‘Def_79
 
Em±yPyG‘S‘Def_78
,{
NULL
,NULL,NULL,NULL,NULL}

	)

437 
	#Em±yPyM‘hodDef_79
 
Em±yPyM‘hodDef_78
,{
NULL
,NULL,0,NULL}

	)

438 
	#Em±yPyMemb”Def_79
 
Em±yPyMemb”Def_78
,{
NULL
,0,0,0,NULL}

	)

439 
	#DESIG_80
(
v
è
	`DESIG_79
(v),
	)
v

440 
	#DESIG__80
(
n
,
v
è
	`DESIG__79
Ò,v),{
DESIG_
##
	`n
(v)}

	)

441 
	#Em±yPyG‘S‘Def_80
 
Em±yPyG‘S‘Def_79
,{
NULL
,NULL,NULL,NULL,NULL}

	)

442 
	#Em±yPyM‘hodDef_80
 
Em±yPyM‘hodDef_79
,{
NULL
,NULL,0,NULL}

	)

443 
	#Em±yPyMemb”Def_80
 
Em±yPyMemb”Def_79
,{
NULL
,0,0,0,NULL}

	)

444 
	#DESIG_81
(
v
è
	`DESIG_80
(v),
	)
v

445 
	#DESIG__81
(
n
,
v
è
	`DESIG__80
Ò,v),{
DESIG_
##
	`n
(v)}

	)

446 
	#Em±yPyG‘S‘Def_81
 
Em±yPyG‘S‘Def_80
,{
NULL
,NULL,NULL,NULL,NULL}

	)

447 
	#Em±yPyM‘hodDef_81
 
Em±yPyM‘hodDef_80
,{
NULL
,NULL,0,NULL}

	)

448 
	#Em±yPyMemb”Def_81
 
Em±yPyMemb”Def_80
,{
NULL
,0,0,0,NULL}

	)

449 
	#DESIG_82
(
v
è
	`DESIG_81
(v),
	)
v

450 
	#DESIG__82
(
n
,
v
è
	`DESIG__81
Ò,v),{
DESIG_
##
	`n
(v)}

	)

451 
	#Em±yPyG‘S‘Def_82
 
Em±yPyG‘S‘Def_81
,{
NULL
,NULL,NULL,NULL,NULL}

	)

452 
	#Em±yPyM‘hodDef_82
 
Em±yPyM‘hodDef_81
,{
NULL
,NULL,0,NULL}

	)

453 
	#Em±yPyMemb”Def_82
 
Em±yPyMemb”Def_81
,{
NULL
,0,0,0,NULL}

	)

454 
	#DESIG_83
(
v
è
	`DESIG_82
(v),
	)
v

455 
	#DESIG__83
(
n
,
v
è
	`DESIG__82
Ò,v),{
DESIG_
##
	`n
(v)}

	)

456 
	#Em±yPyG‘S‘Def_83
 
Em±yPyG‘S‘Def_82
,{
NULL
,NULL,NULL,NULL,NULL}

	)

457 
	#Em±yPyM‘hodDef_83
 
Em±yPyM‘hodDef_82
,{
NULL
,NULL,0,NULL}

	)

458 
	#Em±yPyMemb”Def_83
 
Em±yPyMemb”Def_82
,{
NULL
,0,0,0,NULL}

	)

459 
	#DESIG_84
(
v
è
	`DESIG_83
(v),
	)
v

460 
	#DESIG__84
(
n
,
v
è
	`DESIG__83
Ò,v),{
DESIG_
##
	`n
(v)}

	)

461 
	#Em±yPyG‘S‘Def_84
 
Em±yPyG‘S‘Def_83
,{
NULL
,NULL,NULL,NULL,NULL}

	)

462 
	#Em±yPyM‘hodDef_84
 
Em±yPyM‘hodDef_83
,{
NULL
,NULL,0,NULL}

	)

463 
	#Em±yPyMemb”Def_84
 
Em±yPyMemb”Def_83
,{
NULL
,0,0,0,NULL}

	)

464 
	#DESIG_85
(
v
è
	`DESIG_84
(v),
	)
v

465 
	#DESIG__85
(
n
,
v
è
	`DESIG__84
Ò,v),{
DESIG_
##
	`n
(v)}

	)

466 
	#Em±yPyG‘S‘Def_85
 
Em±yPyG‘S‘Def_84
,{
NULL
,NULL,NULL,NULL,NULL}

	)

467 
	#Em±yPyM‘hodDef_85
 
Em±yPyM‘hodDef_84
,{
NULL
,NULL,0,NULL}

	)

468 
	#Em±yPyMemb”Def_85
 
Em±yPyMemb”Def_84
,{
NULL
,0,0,0,NULL}

	)

469 
	#DESIG_86
(
v
è
	`DESIG_85
(v),
	)
v

470 
	#DESIG__86
(
n
,
v
è
	`DESIG__85
Ò,v),{
DESIG_
##
	`n
(v)}

	)

471 
	#Em±yPyG‘S‘Def_86
 
Em±yPyG‘S‘Def_85
,{
NULL
,NULL,NULL,NULL,NULL}

	)

472 
	#Em±yPyM‘hodDef_86
 
Em±yPyM‘hodDef_85
,{
NULL
,NULL,0,NULL}

	)

473 
	#Em±yPyMemb”Def_86
 
Em±yPyMemb”Def_85
,{
NULL
,0,0,0,NULL}

	)

474 
	#DESIG_87
(
v
è
	`DESIG_86
(v),
	)
v

475 
	#DESIG__87
(
n
,
v
è
	`DESIG__86
Ò,v),{
DESIG_
##
	`n
(v)}

	)

476 
	#Em±yPyG‘S‘Def_87
 
Em±yPyG‘S‘Def_86
,{
NULL
,NULL,NULL,NULL,NULL}

	)

477 
	#Em±yPyM‘hodDef_87
 
Em±yPyM‘hodDef_86
,{
NULL
,NULL,0,NULL}

	)

478 
	#Em±yPyMemb”Def_87
 
Em±yPyMemb”Def_86
,{
NULL
,0,0,0,NULL}

	)

479 
	#DESIG_88
(
v
è
	`DESIG_87
(v),
	)
v

480 
	#DESIG__88
(
n
,
v
è
	`DESIG__87
Ò,v),{
DESIG_
##
	`n
(v)}

	)

481 
	#Em±yPyG‘S‘Def_88
 
Em±yPyG‘S‘Def_87
,{
NULL
,NULL,NULL,NULL,NULL}

	)

482 
	#Em±yPyM‘hodDef_88
 
Em±yPyM‘hodDef_87
,{
NULL
,NULL,0,NULL}

	)

483 
	#Em±yPyMemb”Def_88
 
Em±yPyMemb”Def_87
,{
NULL
,0,0,0,NULL}

	)

484 
	#DESIG_89
(
v
è
	`DESIG_88
(v),
	)
v

485 
	#DESIG__89
(
n
,
v
è
	`DESIG__88
Ò,v),{
DESIG_
##
	`n
(v)}

	)

486 
	#Em±yPyG‘S‘Def_89
 
Em±yPyG‘S‘Def_88
,{
NULL
,NULL,NULL,NULL,NULL}

	)

487 
	#Em±yPyM‘hodDef_89
 
Em±yPyM‘hodDef_88
,{
NULL
,NULL,0,NULL}

	)

488 
	#Em±yPyMemb”Def_89
 
Em±yPyMemb”Def_88
,{
NULL
,0,0,0,NULL}

	)

489 
	#DESIG_90
(
v
è
	`DESIG_89
(v),
	)
v

490 
	#DESIG__90
(
n
,
v
è
	`DESIG__89
Ò,v),{
DESIG_
##
	`n
(v)}

	)

491 
	#Em±yPyG‘S‘Def_90
 
Em±yPyG‘S‘Def_89
,{
NULL
,NULL,NULL,NULL,NULL}

	)

492 
	#Em±yPyM‘hodDef_90
 
Em±yPyM‘hodDef_89
,{
NULL
,NULL,0,NULL}

	)

493 
	#Em±yPyMemb”Def_90
 
Em±yPyMemb”Def_89
,{
NULL
,0,0,0,NULL}

	)

494 
	#DESIG_91
(
v
è
	`DESIG_90
(v),
	)
v

495 
	#DESIG__91
(
n
,
v
è
	`DESIG__90
Ò,v),{
DESIG_
##
	`n
(v)}

	)

496 
	#Em±yPyG‘S‘Def_91
 
Em±yPyG‘S‘Def_90
,{
NULL
,NULL,NULL,NULL,NULL}

	)

497 
	#Em±yPyM‘hodDef_91
 
Em±yPyM‘hodDef_90
,{
NULL
,NULL,0,NULL}

	)

498 
	#Em±yPyMemb”Def_91
 
Em±yPyMemb”Def_90
,{
NULL
,0,0,0,NULL}

	)

499 
	#DESIG_92
(
v
è
	`DESIG_91
(v),
	)
v

500 
	#DESIG__92
(
n
,
v
è
	`DESIG__91
Ò,v),{
DESIG_
##
	`n
(v)}

	)

501 
	#Em±yPyG‘S‘Def_92
 
Em±yPyG‘S‘Def_91
,{
NULL
,NULL,NULL,NULL,NULL}

	)

502 
	#Em±yPyM‘hodDef_92
 
Em±yPyM‘hodDef_91
,{
NULL
,NULL,0,NULL}

	)

503 
	#Em±yPyMemb”Def_92
 
Em±yPyMemb”Def_91
,{
NULL
,0,0,0,NULL}

	)

504 
	#DESIG_93
(
v
è
	`DESIG_92
(v),
	)
v

505 
	#DESIG__93
(
n
,
v
è
	`DESIG__92
Ò,v),{
DESIG_
##
	`n
(v)}

	)

506 
	#Em±yPyG‘S‘Def_93
 
Em±yPyG‘S‘Def_92
,{
NULL
,NULL,NULL,NULL,NULL}

	)

507 
	#Em±yPyM‘hodDef_93
 
Em±yPyM‘hodDef_92
,{
NULL
,NULL,0,NULL}

	)

508 
	#Em±yPyMemb”Def_93
 
Em±yPyMemb”Def_92
,{
NULL
,0,0,0,NULL}

	)

509 
	#DESIG_94
(
v
è
	`DESIG_93
(v),
	)
v

510 
	#DESIG__94
(
n
,
v
è
	`DESIG__93
Ò,v),{
DESIG_
##
	`n
(v)}

	)

511 
	#Em±yPyG‘S‘Def_94
 
Em±yPyG‘S‘Def_93
,{
NULL
,NULL,NULL,NULL,NULL}

	)

512 
	#Em±yPyM‘hodDef_94
 
Em±yPyM‘hodDef_93
,{
NULL
,NULL,0,NULL}

	)

513 
	#Em±yPyMemb”Def_94
 
Em±yPyMemb”Def_93
,{
NULL
,0,0,0,NULL}

	)

514 
	#DESIG_95
(
v
è
	`DESIG_94
(v),
	)
v

515 
	#DESIG__95
(
n
,
v
è
	`DESIG__94
Ò,v),{
DESIG_
##
	`n
(v)}

	)

516 
	#Em±yPyG‘S‘Def_95
 
Em±yPyG‘S‘Def_94
,{
NULL
,NULL,NULL,NULL,NULL}

	)

517 
	#Em±yPyM‘hodDef_95
 
Em±yPyM‘hodDef_94
,{
NULL
,NULL,0,NULL}

	)

518 
	#Em±yPyMemb”Def_95
 
Em±yPyMemb”Def_94
,{
NULL
,0,0,0,NULL}

	)

519 
	#DESIG_96
(
v
è
	`DESIG_95
(v),
	)
v

520 
	#DESIG__96
(
n
,
v
è
	`DESIG__95
Ò,v),{
DESIG_
##
	`n
(v)}

	)

521 
	#Em±yPyG‘S‘Def_96
 
Em±yPyG‘S‘Def_95
,{
NULL
,NULL,NULL,NULL,NULL}

	)

522 
	#Em±yPyM‘hodDef_96
 
Em±yPyM‘hodDef_95
,{
NULL
,NULL,0,NULL}

	)

523 
	#Em±yPyMemb”Def_96
 
Em±yPyMemb”Def_95
,{
NULL
,0,0,0,NULL}

	)

524 
	#DESIG_97
(
v
è
	`DESIG_96
(v),
	)
v

525 
	#DESIG__97
(
n
,
v
è
	`DESIG__96
Ò,v),{
DESIG_
##
	`n
(v)}

	)

526 
	#Em±yPyG‘S‘Def_97
 
Em±yPyG‘S‘Def_96
,{
NULL
,NULL,NULL,NULL,NULL}

	)

527 
	#Em±yPyM‘hodDef_97
 
Em±yPyM‘hodDef_96
,{
NULL
,NULL,0,NULL}

	)

528 
	#Em±yPyMemb”Def_97
 
Em±yPyMemb”Def_96
,{
NULL
,0,0,0,NULL}

	)

529 
	#DESIG_98
(
v
è
	`DESIG_97
(v),
	)
v

530 
	#DESIG__98
(
n
,
v
è
	`DESIG__97
Ò,v),{
DESIG_
##
	`n
(v)}

	)

531 
	#Em±yPyG‘S‘Def_98
 
Em±yPyG‘S‘Def_97
,{
NULL
,NULL,NULL,NULL,NULL}

	)

532 
	#Em±yPyM‘hodDef_98
 
Em±yPyM‘hodDef_97
,{
NULL
,NULL,0,NULL}

	)

533 
	#Em±yPyMemb”Def_98
 
Em±yPyMemb”Def_97
,{
NULL
,0,0,0,NULL}

	)

534 
	#DESIG_99
(
v
è
	`DESIG_98
(v),
	)
v

535 
	#DESIG__99
(
n
,
v
è
	`DESIG__98
Ò,v),{
DESIG_
##
	`n
(v)}

	)

536 
	#Em±yPyG‘S‘Def_99
 
Em±yPyG‘S‘Def_98
,{
NULL
,NULL,NULL,NULL,NULL}

	)

537 
	#Em±yPyM‘hodDef_99
 
Em±yPyM‘hodDef_98
,{
NULL
,NULL,0,NULL}

	)

538 
	#Em±yPyMemb”Def_99
 
Em±yPyMemb”Def_98
,{
NULL
,0,0,0,NULL}

	)

539 
	#DESIG_100
(
v
è
	`DESIG_99
(v),
	)
v

540 
	#DESIG__100
(
n
,
v
è
	`DESIG__99
Ò,v),{
DESIG_
##
	`n
(v)}

	)

541 
	#Em±yPyG‘S‘Def_100
 
Em±yPyG‘S‘Def_99
,{
NULL
,NULL,NULL,NULL,NULL}

	)

542 
	#Em±yPyM‘hodDef_100
 
Em±yPyM‘hodDef_99
,{
NULL
,NULL,0,NULL}

	)

543 
	#Em±yPyMemb”Def_100
 
Em±yPyMemb”Def_99
,{
NULL
,0,0,0,NULL}

	)

544 
	#DESIG_101
(
v
è
	`DESIG_100
(v),
	)
v

545 
	#DESIG__101
(
n
,
v
è
	`DESIG__100
Ò,v),{
DESIG_
##
	`n
(v)}

	)

546 
	#Em±yPyG‘S‘Def_101
 
Em±yPyG‘S‘Def_100
,{
NULL
,NULL,NULL,NULL,NULL}

	)

547 
	#Em±yPyM‘hodDef_101
 
Em±yPyM‘hodDef_100
,{
NULL
,NULL,0,NULL}

	)

548 
	#Em±yPyMemb”Def_101
 
Em±yPyMemb”Def_100
,{
NULL
,0,0,0,NULL}

	)

549 
	#DESIG_102
(
v
è
	`DESIG_101
(v),
	)
v

550 
	#DESIG__102
(
n
,
v
è
	`DESIG__101
Ò,v),{
DESIG_
##
	`n
(v)}

	)

551 
	#Em±yPyG‘S‘Def_102
 
Em±yPyG‘S‘Def_101
,{
NULL
,NULL,NULL,NULL,NULL}

	)

552 
	#Em±yPyM‘hodDef_102
 
Em±yPyM‘hodDef_101
,{
NULL
,NULL,0,NULL}

	)

553 
	#Em±yPyMemb”Def_102
 
Em±yPyMemb”Def_101
,{
NULL
,0,0,0,NULL}

	)

554 
	#DESIG_103
(
v
è
	`DESIG_102
(v),
	)
v

555 
	#DESIG__103
(
n
,
v
è
	`DESIG__102
Ò,v),{
DESIG_
##
	`n
(v)}

	)

556 
	#Em±yPyG‘S‘Def_103
 
Em±yPyG‘S‘Def_102
,{
NULL
,NULL,NULL,NULL,NULL}

	)

557 
	#Em±yPyM‘hodDef_103
 
Em±yPyM‘hodDef_102
,{
NULL
,NULL,0,NULL}

	)

558 
	#Em±yPyMemb”Def_103
 
Em±yPyMemb”Def_102
,{
NULL
,0,0,0,NULL}

	)

559 
	#DESIG_104
(
v
è
	`DESIG_103
(v),
	)
v

560 
	#DESIG__104
(
n
,
v
è
	`DESIG__103
Ò,v),{
DESIG_
##
	`n
(v)}

	)

561 
	#Em±yPyG‘S‘Def_104
 
Em±yPyG‘S‘Def_103
,{
NULL
,NULL,NULL,NULL,NULL}

	)

562 
	#Em±yPyM‘hodDef_104
 
Em±yPyM‘hodDef_103
,{
NULL
,NULL,0,NULL}

	)

563 
	#Em±yPyMemb”Def_104
 
Em±yPyMemb”Def_103
,{
NULL
,0,0,0,NULL}

	)

564 
	#DESIG_105
(
v
è
	`DESIG_104
(v),
	)
v

565 
	#DESIG__105
(
n
,
v
è
	`DESIG__104
Ò,v),{
DESIG_
##
	`n
(v)}

	)

566 
	#Em±yPyG‘S‘Def_105
 
Em±yPyG‘S‘Def_104
,{
NULL
,NULL,NULL,NULL,NULL}

	)

567 
	#Em±yPyM‘hodDef_105
 
Em±yPyM‘hodDef_104
,{
NULL
,NULL,0,NULL}

	)

568 
	#Em±yPyMemb”Def_105
 
Em±yPyMemb”Def_104
,{
NULL
,0,0,0,NULL}

	)

569 
	#DESIG_106
(
v
è
	`DESIG_105
(v),
	)
v

570 
	#DESIG__106
(
n
,
v
è
	`DESIG__105
Ò,v),{
DESIG_
##
	`n
(v)}

	)

571 
	#Em±yPyG‘S‘Def_106
 
Em±yPyG‘S‘Def_105
,{
NULL
,NULL,NULL,NULL,NULL}

	)

572 
	#Em±yPyM‘hodDef_106
 
Em±yPyM‘hodDef_105
,{
NULL
,NULL,0,NULL}

	)

573 
	#Em±yPyMemb”Def_106
 
Em±yPyMemb”Def_105
,{
NULL
,0,0,0,NULL}

	)

574 
	#DESIG_107
(
v
è
	`DESIG_106
(v),
	)
v

575 
	#DESIG__107
(
n
,
v
è
	`DESIG__106
Ò,v),{
DESIG_
##
	`n
(v)}

	)

576 
	#Em±yPyG‘S‘Def_107
 
Em±yPyG‘S‘Def_106
,{
NULL
,NULL,NULL,NULL,NULL}

	)

577 
	#Em±yPyM‘hodDef_107
 
Em±yPyM‘hodDef_106
,{
NULL
,NULL,0,NULL}

	)

578 
	#Em±yPyMemb”Def_107
 
Em±yPyMemb”Def_106
,{
NULL
,0,0,0,NULL}

	)

579 
	#DESIG_108
(
v
è
	`DESIG_107
(v),
	)
v

580 
	#DESIG__108
(
n
,
v
è
	`DESIG__107
Ò,v),{
DESIG_
##
	`n
(v)}

	)

581 
	#Em±yPyG‘S‘Def_108
 
Em±yPyG‘S‘Def_107
,{
NULL
,NULL,NULL,NULL,NULL}

	)

582 
	#Em±yPyM‘hodDef_108
 
Em±yPyM‘hodDef_107
,{
NULL
,NULL,0,NULL}

	)

583 
	#Em±yPyMemb”Def_108
 
Em±yPyMemb”Def_107
,{
NULL
,0,0,0,NULL}

	)

584 
	#DESIG_109
(
v
è
	`DESIG_108
(v),
	)
v

585 
	#DESIG__109
(
n
,
v
è
	`DESIG__108
Ò,v),{
DESIG_
##
	`n
(v)}

	)

586 
	#Em±yPyG‘S‘Def_109
 
Em±yPyG‘S‘Def_108
,{
NULL
,NULL,NULL,NULL,NULL}

	)

587 
	#Em±yPyM‘hodDef_109
 
Em±yPyM‘hodDef_108
,{
NULL
,NULL,0,NULL}

	)

588 
	#Em±yPyMemb”Def_109
 
Em±yPyMemb”Def_108
,{
NULL
,0,0,0,NULL}

	)

589 
	#DESIG_110
(
v
è
	`DESIG_109
(v),
	)
v

590 
	#DESIG__110
(
n
,
v
è
	`DESIG__109
Ò,v),{
DESIG_
##
	`n
(v)}

	)

591 
	#Em±yPyG‘S‘Def_110
 
Em±yPyG‘S‘Def_109
,{
NULL
,NULL,NULL,NULL,NULL}

	)

592 
	#Em±yPyM‘hodDef_110
 
Em±yPyM‘hodDef_109
,{
NULL
,NULL,0,NULL}

	)

593 
	#Em±yPyMemb”Def_110
 
Em±yPyMemb”Def_109
,{
NULL
,0,0,0,NULL}

	)

594 
	#DESIG_111
(
v
è
	`DESIG_110
(v),
	)
v

595 
	#DESIG__111
(
n
,
v
è
	`DESIG__110
Ò,v),{
DESIG_
##
	`n
(v)}

	)

596 
	#Em±yPyG‘S‘Def_111
 
Em±yPyG‘S‘Def_110
,{
NULL
,NULL,NULL,NULL,NULL}

	)

597 
	#Em±yPyM‘hodDef_111
 
Em±yPyM‘hodDef_110
,{
NULL
,NULL,0,NULL}

	)

598 
	#Em±yPyMemb”Def_111
 
Em±yPyMemb”Def_110
,{
NULL
,0,0,0,NULL}

	)

599 
	#DESIG_112
(
v
è
	`DESIG_111
(v),
	)
v

600 
	#DESIG__112
(
n
,
v
è
	`DESIG__111
Ò,v),{
DESIG_
##
	`n
(v)}

	)

601 
	#Em±yPyG‘S‘Def_112
 
Em±yPyG‘S‘Def_111
,{
NULL
,NULL,NULL,NULL,NULL}

	)

602 
	#Em±yPyM‘hodDef_112
 
Em±yPyM‘hodDef_111
,{
NULL
,NULL,0,NULL}

	)

603 
	#Em±yPyMemb”Def_112
 
Em±yPyMemb”Def_111
,{
NULL
,0,0,0,NULL}

	)

604 
	#DESIG_113
(
v
è
	`DESIG_112
(v),
	)
v

605 
	#DESIG__113
(
n
,
v
è
	`DESIG__112
Ò,v),{
DESIG_
##
	`n
(v)}

	)

606 
	#Em±yPyG‘S‘Def_113
 
Em±yPyG‘S‘Def_112
,{
NULL
,NULL,NULL,NULL,NULL}

	)

607 
	#Em±yPyM‘hodDef_113
 
Em±yPyM‘hodDef_112
,{
NULL
,NULL,0,NULL}

	)

608 
	#Em±yPyMemb”Def_113
 
Em±yPyMemb”Def_112
,{
NULL
,0,0,0,NULL}

	)

609 
	#DESIG_114
(
v
è
	`DESIG_113
(v),
	)
v

610 
	#DESIG__114
(
n
,
v
è
	`DESIG__113
Ò,v),{
DESIG_
##
	`n
(v)}

	)

611 
	#Em±yPyG‘S‘Def_114
 
Em±yPyG‘S‘Def_113
,{
NULL
,NULL,NULL,NULL,NULL}

	)

612 
	#Em±yPyM‘hodDef_114
 
Em±yPyM‘hodDef_113
,{
NULL
,NULL,0,NULL}

	)

613 
	#Em±yPyMemb”Def_114
 
Em±yPyMemb”Def_113
,{
NULL
,0,0,0,NULL}

	)

614 
	#DESIG_115
(
v
è
	`DESIG_114
(v),
	)
v

615 
	#DESIG__115
(
n
,
v
è
	`DESIG__114
Ò,v),{
DESIG_
##
	`n
(v)}

	)

616 
	#Em±yPyG‘S‘Def_115
 
Em±yPyG‘S‘Def_114
,{
NULL
,NULL,NULL,NULL,NULL}

	)

617 
	#Em±yPyM‘hodDef_115
 
Em±yPyM‘hodDef_114
,{
NULL
,NULL,0,NULL}

	)

618 
	#Em±yPyMemb”Def_115
 
Em±yPyMemb”Def_114
,{
NULL
,0,0,0,NULL}

	)

619 
	#DESIG_116
(
v
è
	`DESIG_115
(v),
	)
v

620 
	#DESIG__116
(
n
,
v
è
	`DESIG__115
Ò,v),{
DESIG_
##
	`n
(v)}

	)

621 
	#Em±yPyG‘S‘Def_116
 
Em±yPyG‘S‘Def_115
,{
NULL
,NULL,NULL,NULL,NULL}

	)

622 
	#Em±yPyM‘hodDef_116
 
Em±yPyM‘hodDef_115
,{
NULL
,NULL,0,NULL}

	)

623 
	#Em±yPyMemb”Def_116
 
Em±yPyMemb”Def_115
,{
NULL
,0,0,0,NULL}

	)

624 
	#DESIG_117
(
v
è
	`DESIG_116
(v),
	)
v

625 
	#DESIG__117
(
n
,
v
è
	`DESIG__116
Ò,v),{
DESIG_
##
	`n
(v)}

	)

626 
	#Em±yPyG‘S‘Def_117
 
Em±yPyG‘S‘Def_116
,{
NULL
,NULL,NULL,NULL,NULL}

	)

627 
	#Em±yPyM‘hodDef_117
 
Em±yPyM‘hodDef_116
,{
NULL
,NULL,0,NULL}

	)

628 
	#Em±yPyMemb”Def_117
 
Em±yPyMemb”Def_116
,{
NULL
,0,0,0,NULL}

	)

629 
	#DESIG_118
(
v
è
	`DESIG_117
(v),
	)
v

630 
	#DESIG__118
(
n
,
v
è
	`DESIG__117
Ò,v),{
DESIG_
##
	`n
(v)}

	)

631 
	#Em±yPyG‘S‘Def_118
 
Em±yPyG‘S‘Def_117
,{
NULL
,NULL,NULL,NULL,NULL}

	)

632 
	#Em±yPyM‘hodDef_118
 
Em±yPyM‘hodDef_117
,{
NULL
,NULL,0,NULL}

	)

633 
	#Em±yPyMemb”Def_118
 
Em±yPyMemb”Def_117
,{
NULL
,0,0,0,NULL}

	)

634 
	#DESIG_119
(
v
è
	`DESIG_118
(v),
	)
v

635 
	#DESIG__119
(
n
,
v
è
	`DESIG__118
Ò,v),{
DESIG_
##
	`n
(v)}

	)

636 
	#Em±yPyG‘S‘Def_119
 
Em±yPyG‘S‘Def_118
,{
NULL
,NULL,NULL,NULL,NULL}

	)

637 
	#Em±yPyM‘hodDef_119
 
Em±yPyM‘hodDef_118
,{
NULL
,NULL,0,NULL}

	)

638 
	#Em±yPyMemb”Def_119
 
Em±yPyMemb”Def_118
,{
NULL
,0,0,0,NULL}

	)

639 
	#DESIG_120
(
v
è
	`DESIG_119
(v),
	)
v

640 
	#DESIG__120
(
n
,
v
è
	`DESIG__119
Ò,v),{
DESIG_
##
	`n
(v)}

	)

641 
	#Em±yPyG‘S‘Def_120
 
Em±yPyG‘S‘Def_119
,{
NULL
,NULL,NULL,NULL,NULL}

	)

642 
	#Em±yPyM‘hodDef_120
 
Em±yPyM‘hodDef_119
,{
NULL
,NULL,0,NULL}

	)

643 
	#Em±yPyMemb”Def_120
 
Em±yPyMemb”Def_119
,{
NULL
,0,0,0,NULL}

	)

644 
	#DESIG_121
(
v
è
	`DESIG_120
(v),
	)
v

645 
	#DESIG__121
(
n
,
v
è
	`DESIG__120
Ò,v),{
DESIG_
##
	`n
(v)}

	)

646 
	#Em±yPyG‘S‘Def_121
 
Em±yPyG‘S‘Def_120
,{
NULL
,NULL,NULL,NULL,NULL}

	)

647 
	#Em±yPyM‘hodDef_121
 
Em±yPyM‘hodDef_120
,{
NULL
,NULL,0,NULL}

	)

648 
	#Em±yPyMemb”Def_121
 
Em±yPyMemb”Def_120
,{
NULL
,0,0,0,NULL}

	)

649 
	#DESIG_122
(
v
è
	`DESIG_121
(v),
	)
v

650 
	#DESIG__122
(
n
,
v
è
	`DESIG__121
Ò,v),{
DESIG_
##
	`n
(v)}

	)

651 
	#Em±yPyG‘S‘Def_122
 
Em±yPyG‘S‘Def_121
,{
NULL
,NULL,NULL,NULL,NULL}

	)

652 
	#Em±yPyM‘hodDef_122
 
Em±yPyM‘hodDef_121
,{
NULL
,NULL,0,NULL}

	)

653 
	#Em±yPyMemb”Def_122
 
Em±yPyMemb”Def_121
,{
NULL
,0,0,0,NULL}

	)

654 
	#DESIG_123
(
v
è
	`DESIG_122
(v),
	)
v

655 
	#DESIG__123
(
n
,
v
è
	`DESIG__122
Ò,v),{
DESIG_
##
	`n
(v)}

	)

656 
	#Em±yPyG‘S‘Def_123
 
Em±yPyG‘S‘Def_122
,{
NULL
,NULL,NULL,NULL,NULL}

	)

657 
	#Em±yPyM‘hodDef_123
 
Em±yPyM‘hodDef_122
,{
NULL
,NULL,0,NULL}

	)

658 
	#Em±yPyMemb”Def_123
 
Em±yPyMemb”Def_122
,{
NULL
,0,0,0,NULL}

	)

659 
	#DESIG_124
(
v
è
	`DESIG_123
(v),
	)
v

660 
	#DESIG__124
(
n
,
v
è
	`DESIG__123
Ò,v),{
DESIG_
##
	`n
(v)}

	)

661 
	#Em±yPyG‘S‘Def_124
 
Em±yPyG‘S‘Def_123
,{
NULL
,NULL,NULL,NULL,NULL}

	)

662 
	#Em±yPyM‘hodDef_124
 
Em±yPyM‘hodDef_123
,{
NULL
,NULL,0,NULL}

	)

663 
	#Em±yPyMemb”Def_124
 
Em±yPyMemb”Def_123
,{
NULL
,0,0,0,NULL}

	)

664 
	#DESIG_125
(
v
è
	`DESIG_124
(v),
	)
v

665 
	#DESIG__125
(
n
,
v
è
	`DESIG__124
Ò,v),{
DESIG_
##
	`n
(v)}

	)

666 
	#Em±yPyG‘S‘Def_125
 
Em±yPyG‘S‘Def_124
,{
NULL
,NULL,NULL,NULL,NULL}

	)

667 
	#Em±yPyM‘hodDef_125
 
Em±yPyM‘hodDef_124
,{
NULL
,NULL,0,NULL}

	)

668 
	#Em±yPyMemb”Def_125
 
Em±yPyMemb”Def_124
,{
NULL
,0,0,0,NULL}

	)

669 
	#DESIG_126
(
v
è
	`DESIG_125
(v),
	)
v

670 
	#DESIG__126
(
n
,
v
è
	`DESIG__125
Ò,v),{
DESIG_
##
	`n
(v)}

	)

671 
	#Em±yPyG‘S‘Def_126
 
Em±yPyG‘S‘Def_125
,{
NULL
,NULL,NULL,NULL,NULL}

	)

672 
	#Em±yPyM‘hodDef_126
 
Em±yPyM‘hodDef_125
,{
NULL
,NULL,0,NULL}

	)

673 
	#Em±yPyMemb”Def_126
 
Em±yPyMemb”Def_125
,{
NULL
,0,0,0,NULL}

	)

674 
	#DESIG_127
(
v
è
	`DESIG_126
(v),
	)
v

675 
	#DESIG__127
(
n
,
v
è
	`DESIG__126
Ò,v),{
DESIG_
##
	`n
(v)}

	)

676 
	#Em±yPyG‘S‘Def_127
 
Em±yPyG‘S‘Def_126
,{
NULL
,NULL,NULL,NULL,NULL}

	)

677 
	#Em±yPyM‘hodDef_127
 
Em±yPyM‘hodDef_126
,{
NULL
,NULL,0,NULL}

	)

678 
	#Em±yPyMemb”Def_127
 
Em±yPyMemb”Def_126
,{
NULL
,0,0,0,NULL}

	)

679 
	#DESIG_128
(
v
è
	`DESIG_127
(v),
	)
v

680 
	#DESIG__128
(
n
,
v
è
	`DESIG__127
Ò,v),{
DESIG_
##
	`n
(v)}

	)

681 
	#Em±yPyG‘S‘Def_128
 
Em±yPyG‘S‘Def_127
,{
NULL
,NULL,NULL,NULL,NULL}

	)

682 
	#Em±yPyM‘hodDef_128
 
Em±yPyM‘hodDef_127
,{
NULL
,NULL,0,NULL}

	)

683 
	#Em±yPyMemb”Def_128
 
Em±yPyMemb”Def_127
,{
NULL
,0,0,0,NULL}

	)

684 
	#DESIG_129
(
v
è
	`DESIG_128
(v),
	)
v

685 
	#DESIG__129
(
n
,
v
è
	`DESIG__128
Ò,v),{
DESIG_
##
	`n
(v)}

	)

686 
	#Em±yPyG‘S‘Def_129
 
Em±yPyG‘S‘Def_128
,{
NULL
,NULL,NULL,NULL,NULL}

	)

687 
	#Em±yPyM‘hodDef_129
 
Em±yPyM‘hodDef_128
,{
NULL
,NULL,0,NULL}

	)

688 
	#Em±yPyMemb”Def_129
 
Em±yPyMemb”Def_128
,{
NULL
,0,0,0,NULL}

	)

689 
	#DESIG_130
(
v
è
	`DESIG_129
(v),
	)
v

690 
	#DESIG__130
(
n
,
v
è
	`DESIG__129
Ò,v),{
DESIG_
##
	`n
(v)}

	)

691 
	#Em±yPyG‘S‘Def_130
 
Em±yPyG‘S‘Def_129
,{
NULL
,NULL,NULL,NULL,NULL}

	)

692 
	#Em±yPyM‘hodDef_130
 
Em±yPyM‘hodDef_129
,{
NULL
,NULL,0,NULL}

	)

693 
	#Em±yPyMemb”Def_130
 
Em±yPyMemb”Def_129
,{
NULL
,0,0,0,NULL}

	)

694 
	#DESIG_131
(
v
è
	`DESIG_130
(v),
	)
v

695 
	#DESIG__131
(
n
,
v
è
	`DESIG__130
Ò,v),{
DESIG_
##
	`n
(v)}

	)

696 
	#Em±yPyG‘S‘Def_131
 
Em±yPyG‘S‘Def_130
,{
NULL
,NULL,NULL,NULL,NULL}

	)

697 
	#Em±yPyM‘hodDef_131
 
Em±yPyM‘hodDef_130
,{
NULL
,NULL,0,NULL}

	)

698 
	#Em±yPyMemb”Def_131
 
Em±yPyMemb”Def_130
,{
NULL
,0,0,0,NULL}

	)

699 
	#DESIG_132
(
v
è
	`DESIG_131
(v),
	)
v

700 
	#DESIG__132
(
n
,
v
è
	`DESIG__131
Ò,v),{
DESIG_
##
	`n
(v)}

	)

701 
	#Em±yPyG‘S‘Def_132
 
Em±yPyG‘S‘Def_131
,{
NULL
,NULL,NULL,NULL,NULL}

	)

702 
	#Em±yPyM‘hodDef_132
 
Em±yPyM‘hodDef_131
,{
NULL
,NULL,0,NULL}

	)

703 
	#Em±yPyMemb”Def_132
 
Em±yPyMemb”Def_131
,{
NULL
,0,0,0,NULL}

	)

704 
	#DESIG_133
(
v
è
	`DESIG_132
(v),
	)
v

705 
	#DESIG__133
(
n
,
v
è
	`DESIG__132
Ò,v),{
DESIG_
##
	`n
(v)}

	)

706 
	#Em±yPyG‘S‘Def_133
 
Em±yPyG‘S‘Def_132
,{
NULL
,NULL,NULL,NULL,NULL}

	)

707 
	#Em±yPyM‘hodDef_133
 
Em±yPyM‘hodDef_132
,{
NULL
,NULL,0,NULL}

	)

708 
	#Em±yPyMemb”Def_133
 
Em±yPyMemb”Def_132
,{
NULL
,0,0,0,NULL}

	)

709 
	#DESIG_134
(
v
è
	`DESIG_133
(v),
	)
v

710 
	#DESIG__134
(
n
,
v
è
	`DESIG__133
Ò,v),{
DESIG_
##
	`n
(v)}

	)

711 
	#Em±yPyG‘S‘Def_134
 
Em±yPyG‘S‘Def_133
,{
NULL
,NULL,NULL,NULL,NULL}

	)

712 
	#Em±yPyM‘hodDef_134
 
Em±yPyM‘hodDef_133
,{
NULL
,NULL,0,NULL}

	)

713 
	#Em±yPyMemb”Def_134
 
Em±yPyMemb”Def_133
,{
NULL
,0,0,0,NULL}

	)

714 
	#DESIG_135
(
v
è
	`DESIG_134
(v),
	)
v

715 
	#DESIG__135
(
n
,
v
è
	`DESIG__134
Ò,v),{
DESIG_
##
	`n
(v)}

	)

716 
	#Em±yPyG‘S‘Def_135
 
Em±yPyG‘S‘Def_134
,{
NULL
,NULL,NULL,NULL,NULL}

	)

717 
	#Em±yPyM‘hodDef_135
 
Em±yPyM‘hodDef_134
,{
NULL
,NULL,0,NULL}

	)

718 
	#Em±yPyMemb”Def_135
 
Em±yPyMemb”Def_134
,{
NULL
,0,0,0,NULL}

	)

719 
	#DESIG_136
(
v
è
	`DESIG_135
(v),
	)
v

720 
	#DESIG__136
(
n
,
v
è
	`DESIG__135
Ò,v),{
DESIG_
##
	`n
(v)}

	)

721 
	#Em±yPyG‘S‘Def_136
 
Em±yPyG‘S‘Def_135
,{
NULL
,NULL,NULL,NULL,NULL}

	)

722 
	#Em±yPyM‘hodDef_136
 
Em±yPyM‘hodDef_135
,{
NULL
,NULL,0,NULL}

	)

723 
	#Em±yPyMemb”Def_136
 
Em±yPyMemb”Def_135
,{
NULL
,0,0,0,NULL}

	)

724 
	#DESIG_137
(
v
è
	`DESIG_136
(v),
	)
v

725 
	#DESIG__137
(
n
,
v
è
	`DESIG__136
Ò,v),{
DESIG_
##
	`n
(v)}

	)

726 
	#Em±yPyG‘S‘Def_137
 
Em±yPyG‘S‘Def_136
,{
NULL
,NULL,NULL,NULL,NULL}

	)

727 
	#Em±yPyM‘hodDef_137
 
Em±yPyM‘hodDef_136
,{
NULL
,NULL,0,NULL}

	)

728 
	#Em±yPyMemb”Def_137
 
Em±yPyMemb”Def_136
,{
NULL
,0,0,0,NULL}

	)

729 
	#DESIG_138
(
v
è
	`DESIG_137
(v),
	)
v

730 
	#DESIG__138
(
n
,
v
è
	`DESIG__137
Ò,v),{
DESIG_
##
	`n
(v)}

	)

731 
	#Em±yPyG‘S‘Def_138
 
Em±yPyG‘S‘Def_137
,{
NULL
,NULL,NULL,NULL,NULL}

	)

732 
	#Em±yPyM‘hodDef_138
 
Em±yPyM‘hodDef_137
,{
NULL
,NULL,0,NULL}

	)

733 
	#Em±yPyMemb”Def_138
 
Em±yPyMemb”Def_137
,{
NULL
,0,0,0,NULL}

	)

734 
	#DESIG_139
(
v
è
	`DESIG_138
(v),
	)
v

735 
	#DESIG__139
(
n
,
v
è
	`DESIG__138
Ò,v),{
DESIG_
##
	`n
(v)}

	)

736 
	#Em±yPyG‘S‘Def_139
 
Em±yPyG‘S‘Def_138
,{
NULL
,NULL,NULL,NULL,NULL}

	)

737 
	#Em±yPyM‘hodDef_139
 
Em±yPyM‘hodDef_138
,{
NULL
,NULL,0,NULL}

	)

738 
	#Em±yPyMemb”Def_139
 
Em±yPyMemb”Def_138
,{
NULL
,0,0,0,NULL}

	)

739 
	#DESIG_140
(
v
è
	`DESIG_139
(v),
	)
v

740 
	#DESIG__140
(
n
,
v
è
	`DESIG__139
Ò,v),{
DESIG_
##
	`n
(v)}

	)

741 
	#Em±yPyG‘S‘Def_140
 
Em±yPyG‘S‘Def_139
,{
NULL
,NULL,NULL,NULL,NULL}

	)

742 
	#Em±yPyM‘hodDef_140
 
Em±yPyM‘hodDef_139
,{
NULL
,NULL,0,NULL}

	)

743 
	#Em±yPyMemb”Def_140
 
Em±yPyMemb”Def_139
,{
NULL
,0,0,0,NULL}

	)

744 
	#DESIG_141
(
v
è
	`DESIG_140
(v),
	)
v

745 
	#DESIG__141
(
n
,
v
è
	`DESIG__140
Ò,v),{
DESIG_
##
	`n
(v)}

	)

746 
	#Em±yPyG‘S‘Def_141
 
Em±yPyG‘S‘Def_140
,{
NULL
,NULL,NULL,NULL,NULL}

	)

747 
	#Em±yPyM‘hodDef_141
 
Em±yPyM‘hodDef_140
,{
NULL
,NULL,0,NULL}

	)

748 
	#Em±yPyMemb”Def_141
 
Em±yPyMemb”Def_140
,{
NULL
,0,0,0,NULL}

	)

749 
	#DESIG_142
(
v
è
	`DESIG_141
(v),
	)
v

750 
	#DESIG__142
(
n
,
v
è
	`DESIG__141
Ò,v),{
DESIG_
##
	`n
(v)}

	)

751 
	#Em±yPyG‘S‘Def_142
 
Em±yPyG‘S‘Def_141
,{
NULL
,NULL,NULL,NULL,NULL}

	)

752 
	#Em±yPyM‘hodDef_142
 
Em±yPyM‘hodDef_141
,{
NULL
,NULL,0,NULL}

	)

753 
	#Em±yPyMemb”Def_142
 
Em±yPyMemb”Def_141
,{
NULL
,0,0,0,NULL}

	)

754 
	#DESIG_143
(
v
è
	`DESIG_142
(v),
	)
v

755 
	#DESIG__143
(
n
,
v
è
	`DESIG__142
Ò,v),{
DESIG_
##
	`n
(v)}

	)

756 
	#Em±yPyG‘S‘Def_143
 
Em±yPyG‘S‘Def_142
,{
NULL
,NULL,NULL,NULL,NULL}

	)

757 
	#Em±yPyM‘hodDef_143
 
Em±yPyM‘hodDef_142
,{
NULL
,NULL,0,NULL}

	)

758 
	#Em±yPyMemb”Def_143
 
Em±yPyMemb”Def_142
,{
NULL
,0,0,0,NULL}

	)

759 
	#DESIG_144
(
v
è
	`DESIG_143
(v),
	)
v

760 
	#DESIG__144
(
n
,
v
è
	`DESIG__143
Ò,v),{
DESIG_
##
	`n
(v)}

	)

761 
	#Em±yPyG‘S‘Def_144
 
Em±yPyG‘S‘Def_143
,{
NULL
,NULL,NULL,NULL,NULL}

	)

762 
	#Em±yPyM‘hodDef_144
 
Em±yPyM‘hodDef_143
,{
NULL
,NULL,0,NULL}

	)

763 
	#Em±yPyMemb”Def_144
 
Em±yPyMemb”Def_143
,{
NULL
,0,0,0,NULL}

	)

764 
	#DESIG_145
(
v
è
	`DESIG_144
(v),
	)
v

765 
	#DESIG__145
(
n
,
v
è
	`DESIG__144
Ò,v),{
DESIG_
##
	`n
(v)}

	)

766 
	#Em±yPyG‘S‘Def_145
 
Em±yPyG‘S‘Def_144
,{
NULL
,NULL,NULL,NULL,NULL}

	)

767 
	#Em±yPyM‘hodDef_145
 
Em±yPyM‘hodDef_144
,{
NULL
,NULL,0,NULL}

	)

768 
	#Em±yPyMemb”Def_145
 
Em±yPyMemb”Def_144
,{
NULL
,0,0,0,NULL}

	)

769 
	#DESIG_146
(
v
è
	`DESIG_145
(v),
	)
v

770 
	#DESIG__146
(
n
,
v
è
	`DESIG__145
Ò,v),{
DESIG_
##
	`n
(v)}

	)

771 
	#Em±yPyG‘S‘Def_146
 
Em±yPyG‘S‘Def_145
,{
NULL
,NULL,NULL,NULL,NULL}

	)

772 
	#Em±yPyM‘hodDef_146
 
Em±yPyM‘hodDef_145
,{
NULL
,NULL,0,NULL}

	)

773 
	#Em±yPyMemb”Def_146
 
Em±yPyMemb”Def_145
,{
NULL
,0,0,0,NULL}

	)

774 
	#DESIG_147
(
v
è
	`DESIG_146
(v),
	)
v

775 
	#DESIG__147
(
n
,
v
è
	`DESIG__146
Ò,v),{
DESIG_
##
	`n
(v)}

	)

776 
	#Em±yPyG‘S‘Def_147
 
Em±yPyG‘S‘Def_146
,{
NULL
,NULL,NULL,NULL,NULL}

	)

777 
	#Em±yPyM‘hodDef_147
 
Em±yPyM‘hodDef_146
,{
NULL
,NULL,0,NULL}

	)

778 
	#Em±yPyMemb”Def_147
 
Em±yPyMemb”Def_146
,{
NULL
,0,0,0,NULL}

	)

779 
	#DESIG_148
(
v
è
	`DESIG_147
(v),
	)
v

780 
	#DESIG__148
(
n
,
v
è
	`DESIG__147
Ò,v),{
DESIG_
##
	`n
(v)}

	)

781 
	#Em±yPyG‘S‘Def_148
 
Em±yPyG‘S‘Def_147
,{
NULL
,NULL,NULL,NULL,NULL}

	)

782 
	#Em±yPyM‘hodDef_148
 
Em±yPyM‘hodDef_147
,{
NULL
,NULL,0,NULL}

	)

783 
	#Em±yPyMemb”Def_148
 
Em±yPyMemb”Def_147
,{
NULL
,0,0,0,NULL}

	)

784 
	#DESIG_149
(
v
è
	`DESIG_148
(v),
	)
v

785 
	#DESIG__149
(
n
,
v
è
	`DESIG__148
Ò,v),{
DESIG_
##
	`n
(v)}

	)

786 
	#Em±yPyG‘S‘Def_149
 
Em±yPyG‘S‘Def_148
,{
NULL
,NULL,NULL,NULL,NULL}

	)

787 
	#Em±yPyM‘hodDef_149
 
Em±yPyM‘hodDef_148
,{
NULL
,NULL,0,NULL}

	)

788 
	#Em±yPyMemb”Def_149
 
Em±yPyMemb”Def_148
,{
NULL
,0,0,0,NULL}

	)

789 
	#DESIG_150
(
v
è
	`DESIG_149
(v),
	)
v

790 
	#DESIG__150
(
n
,
v
è
	`DESIG__149
Ò,v),{
DESIG_
##
	`n
(v)}

	)

791 
	#Em±yPyG‘S‘Def_150
 
Em±yPyG‘S‘Def_149
,{
NULL
,NULL,NULL,NULL,NULL}

	)

792 
	#Em±yPyM‘hodDef_150
 
Em±yPyM‘hodDef_149
,{
NULL
,NULL,0,NULL}

	)

793 
	#Em±yPyMemb”Def_150
 
Em±yPyMemb”Def_149
,{
NULL
,0,0,0,NULL}

	)

794 
	#DESIG_151
(
v
è
	`DESIG_150
(v),
	)
v

795 
	#DESIG__151
(
n
,
v
è
	`DESIG__150
Ò,v),{
DESIG_
##
	`n
(v)}

	)

796 
	#Em±yPyG‘S‘Def_151
 
Em±yPyG‘S‘Def_150
,{
NULL
,NULL,NULL,NULL,NULL}

	)

797 
	#Em±yPyM‘hodDef_151
 
Em±yPyM‘hodDef_150
,{
NULL
,NULL,0,NULL}

	)

798 
	#Em±yPyMemb”Def_151
 
Em±yPyMemb”Def_150
,{
NULL
,0,0,0,NULL}

	)

799 
	#DESIG_152
(
v
è
	`DESIG_151
(v),
	)
v

800 
	#DESIG__152
(
n
,
v
è
	`DESIG__151
Ò,v),{
DESIG_
##
	`n
(v)}

	)

801 
	#Em±yPyG‘S‘Def_152
 
Em±yPyG‘S‘Def_151
,{
NULL
,NULL,NULL,NULL,NULL}

	)

802 
	#Em±yPyM‘hodDef_152
 
Em±yPyM‘hodDef_151
,{
NULL
,NULL,0,NULL}

	)

803 
	#Em±yPyMemb”Def_152
 
Em±yPyMemb”Def_151
,{
NULL
,0,0,0,NULL}

	)

804 
	#DESIG_153
(
v
è
	`DESIG_152
(v),
	)
v

805 
	#DESIG__153
(
n
,
v
è
	`DESIG__152
Ò,v),{
DESIG_
##
	`n
(v)}

	)

806 
	#Em±yPyG‘S‘Def_153
 
Em±yPyG‘S‘Def_152
,{
NULL
,NULL,NULL,NULL,NULL}

	)

807 
	#Em±yPyM‘hodDef_153
 
Em±yPyM‘hodDef_152
,{
NULL
,NULL,0,NULL}

	)

808 
	#Em±yPyMemb”Def_153
 
Em±yPyMemb”Def_152
,{
NULL
,0,0,0,NULL}

	)

809 
	#DESIG_154
(
v
è
	`DESIG_153
(v),
	)
v

810 
	#DESIG__154
(
n
,
v
è
	`DESIG__153
Ò,v),{
DESIG_
##
	`n
(v)}

	)

811 
	#Em±yPyG‘S‘Def_154
 
Em±yPyG‘S‘Def_153
,{
NULL
,NULL,NULL,NULL,NULL}

	)

812 
	#Em±yPyM‘hodDef_154
 
Em±yPyM‘hodDef_153
,{
NULL
,NULL,0,NULL}

	)

813 
	#Em±yPyMemb”Def_154
 
Em±yPyMemb”Def_153
,{
NULL
,0,0,0,NULL}

	)

814 
	#DESIG_155
(
v
è
	`DESIG_154
(v),
	)
v

815 
	#DESIG__155
(
n
,
v
è
	`DESIG__154
Ò,v),{
DESIG_
##
	`n
(v)}

	)

816 
	#Em±yPyG‘S‘Def_155
 
Em±yPyG‘S‘Def_154
,{
NULL
,NULL,NULL,NULL,NULL}

	)

817 
	#Em±yPyM‘hodDef_155
 
Em±yPyM‘hodDef_154
,{
NULL
,NULL,0,NULL}

	)

818 
	#Em±yPyMemb”Def_155
 
Em±yPyMemb”Def_154
,{
NULL
,0,0,0,NULL}

	)

819 
	#DESIG_156
(
v
è
	`DESIG_155
(v),
	)
v

820 
	#DESIG__156
(
n
,
v
è
	`DESIG__155
Ò,v),{
DESIG_
##
	`n
(v)}

	)

821 
	#Em±yPyG‘S‘Def_156
 
Em±yPyG‘S‘Def_155
,{
NULL
,NULL,NULL,NULL,NULL}

	)

822 
	#Em±yPyM‘hodDef_156
 
Em±yPyM‘hodDef_155
,{
NULL
,NULL,0,NULL}

	)

823 
	#Em±yPyMemb”Def_156
 
Em±yPyMemb”Def_155
,{
NULL
,0,0,0,NULL}

	)

824 
	#DESIG_157
(
v
è
	`DESIG_156
(v),
	)
v

825 
	#DESIG__157
(
n
,
v
è
	`DESIG__156
Ò,v),{
DESIG_
##
	`n
(v)}

	)

826 
	#Em±yPyG‘S‘Def_157
 
Em±yPyG‘S‘Def_156
,{
NULL
,NULL,NULL,NULL,NULL}

	)

827 
	#Em±yPyM‘hodDef_157
 
Em±yPyM‘hodDef_156
,{
NULL
,NULL,0,NULL}

	)

828 
	#Em±yPyMemb”Def_157
 
Em±yPyMemb”Def_156
,{
NULL
,0,0,0,NULL}

	)

829 
	#DESIG_158
(
v
è
	`DESIG_157
(v),
	)
v

830 
	#DESIG__158
(
n
,
v
è
	`DESIG__157
Ò,v),{
DESIG_
##
	`n
(v)}

	)

831 
	#Em±yPyG‘S‘Def_158
 
Em±yPyG‘S‘Def_157
,{
NULL
,NULL,NULL,NULL,NULL}

	)

832 
	#Em±yPyM‘hodDef_158
 
Em±yPyM‘hodDef_157
,{
NULL
,NULL,0,NULL}

	)

833 
	#Em±yPyMemb”Def_158
 
Em±yPyMemb”Def_157
,{
NULL
,0,0,0,NULL}

	)

834 
	#DESIG_159
(
v
è
	`DESIG_158
(v),
	)
v

835 
	#DESIG__159
(
n
,
v
è
	`DESIG__158
Ò,v),{
DESIG_
##
	`n
(v)}

	)

836 
	#Em±yPyG‘S‘Def_159
 
Em±yPyG‘S‘Def_158
,{
NULL
,NULL,NULL,NULL,NULL}

	)

837 
	#Em±yPyM‘hodDef_159
 
Em±yPyM‘hodDef_158
,{
NULL
,NULL,0,NULL}

	)

838 
	#Em±yPyMemb”Def_159
 
Em±yPyMemb”Def_158
,{
NULL
,0,0,0,NULL}

	)

839 
	#DESIG_160
(
v
è
	`DESIG_159
(v),
	)
v

840 
	#DESIG__160
(
n
,
v
è
	`DESIG__159
Ò,v),{
DESIG_
##
	`n
(v)}

	)

841 
	#Em±yPyG‘S‘Def_160
 
Em±yPyG‘S‘Def_159
,{
NULL
,NULL,NULL,NULL,NULL}

	)

842 
	#Em±yPyM‘hodDef_160
 
Em±yPyM‘hodDef_159
,{
NULL
,NULL,0,NULL}

	)

843 
	#Em±yPyMemb”Def_160
 
Em±yPyMemb”Def_159
,{
NULL
,0,0,0,NULL}

	)

844 
	#DESIG_161
(
v
è
	`DESIG_160
(v),
	)
v

845 
	#DESIG__161
(
n
,
v
è
	`DESIG__160
Ò,v),{
DESIG_
##
	`n
(v)}

	)

846 
	#Em±yPyG‘S‘Def_161
 
Em±yPyG‘S‘Def_160
,{
NULL
,NULL,NULL,NULL,NULL}

	)

847 
	#Em±yPyM‘hodDef_161
 
Em±yPyM‘hodDef_160
,{
NULL
,NULL,0,NULL}

	)

848 
	#Em±yPyMemb”Def_161
 
Em±yPyMemb”Def_160
,{
NULL
,0,0,0,NULL}

	)

849 
	#DESIG_162
(
v
è
	`DESIG_161
(v),
	)
v

850 
	#DESIG__162
(
n
,
v
è
	`DESIG__161
Ò,v),{
DESIG_
##
	`n
(v)}

	)

851 
	#Em±yPyG‘S‘Def_162
 
Em±yPyG‘S‘Def_161
,{
NULL
,NULL,NULL,NULL,NULL}

	)

852 
	#Em±yPyM‘hodDef_162
 
Em±yPyM‘hodDef_161
,{
NULL
,NULL,0,NULL}

	)

853 
	#Em±yPyMemb”Def_162
 
Em±yPyMemb”Def_161
,{
NULL
,0,0,0,NULL}

	)

854 
	#DESIG_163
(
v
è
	`DESIG_162
(v),
	)
v

855 
	#DESIG__163
(
n
,
v
è
	`DESIG__162
Ò,v),{
DESIG_
##
	`n
(v)}

	)

856 
	#Em±yPyG‘S‘Def_163
 
Em±yPyG‘S‘Def_162
,{
NULL
,NULL,NULL,NULL,NULL}

	)

857 
	#Em±yPyM‘hodDef_163
 
Em±yPyM‘hodDef_162
,{
NULL
,NULL,0,NULL}

	)

858 
	#Em±yPyMemb”Def_163
 
Em±yPyMemb”Def_162
,{
NULL
,0,0,0,NULL}

	)

859 
	#DESIG_164
(
v
è
	`DESIG_163
(v),
	)
v

860 
	#DESIG__164
(
n
,
v
è
	`DESIG__163
Ò,v),{
DESIG_
##
	`n
(v)}

	)

861 
	#Em±yPyG‘S‘Def_164
 
Em±yPyG‘S‘Def_163
,{
NULL
,NULL,NULL,NULL,NULL}

	)

862 
	#Em±yPyM‘hodDef_164
 
Em±yPyM‘hodDef_163
,{
NULL
,NULL,0,NULL}

	)

863 
	#Em±yPyMemb”Def_164
 
Em±yPyMemb”Def_163
,{
NULL
,0,0,0,NULL}

	)

864 
	#DESIG_165
(
v
è
	`DESIG_164
(v),
	)
v

865 
	#DESIG__165
(
n
,
v
è
	`DESIG__164
Ò,v),{
DESIG_
##
	`n
(v)}

	)

866 
	#Em±yPyG‘S‘Def_165
 
Em±yPyG‘S‘Def_164
,{
NULL
,NULL,NULL,NULL,NULL}

	)

867 
	#Em±yPyM‘hodDef_165
 
Em±yPyM‘hodDef_164
,{
NULL
,NULL,0,NULL}

	)

868 
	#Em±yPyMemb”Def_165
 
Em±yPyMemb”Def_164
,{
NULL
,0,0,0,NULL}

	)

869 
	#DESIG_166
(
v
è
	`DESIG_165
(v),
	)
v

870 
	#DESIG__166
(
n
,
v
è
	`DESIG__165
Ò,v),{
DESIG_
##
	`n
(v)}

	)

871 
	#Em±yPyG‘S‘Def_166
 
Em±yPyG‘S‘Def_165
,{
NULL
,NULL,NULL,NULL,NULL}

	)

872 
	#Em±yPyM‘hodDef_166
 
Em±yPyM‘hodDef_165
,{
NULL
,NULL,0,NULL}

	)

873 
	#Em±yPyMemb”Def_166
 
Em±yPyMemb”Def_165
,{
NULL
,0,0,0,NULL}

	)

874 
	#DESIG_167
(
v
è
	`DESIG_166
(v),
	)
v

875 
	#DESIG__167
(
n
,
v
è
	`DESIG__166
Ò,v),{
DESIG_
##
	`n
(v)}

	)

876 
	#Em±yPyG‘S‘Def_167
 
Em±yPyG‘S‘Def_166
,{
NULL
,NULL,NULL,NULL,NULL}

	)

877 
	#Em±yPyM‘hodDef_167
 
Em±yPyM‘hodDef_166
,{
NULL
,NULL,0,NULL}

	)

878 
	#Em±yPyMemb”Def_167
 
Em±yPyMemb”Def_166
,{
NULL
,0,0,0,NULL}

	)

879 
	#DESIG_168
(
v
è
	`DESIG_167
(v),
	)
v

880 
	#DESIG__168
(
n
,
v
è
	`DESIG__167
Ò,v),{
DESIG_
##
	`n
(v)}

	)

881 
	#Em±yPyG‘S‘Def_168
 
Em±yPyG‘S‘Def_167
,{
NULL
,NULL,NULL,NULL,NULL}

	)

882 
	#Em±yPyM‘hodDef_168
 
Em±yPyM‘hodDef_167
,{
NULL
,NULL,0,NULL}

	)

883 
	#Em±yPyMemb”Def_168
 
Em±yPyMemb”Def_167
,{
NULL
,0,0,0,NULL}

	)

884 
	#DESIG_169
(
v
è
	`DESIG_168
(v),
	)
v

885 
	#DESIG__169
(
n
,
v
è
	`DESIG__168
Ò,v),{
DESIG_
##
	`n
(v)}

	)

886 
	#Em±yPyG‘S‘Def_169
 
Em±yPyG‘S‘Def_168
,{
NULL
,NULL,NULL,NULL,NULL}

	)

887 
	#Em±yPyM‘hodDef_169
 
Em±yPyM‘hodDef_168
,{
NULL
,NULL,0,NULL}

	)

888 
	#Em±yPyMemb”Def_169
 
Em±yPyMemb”Def_168
,{
NULL
,0,0,0,NULL}

	)

889 
	#DESIG_170
(
v
è
	`DESIG_169
(v),
	)
v

890 
	#DESIG__170
(
n
,
v
è
	`DESIG__169
Ò,v),{
DESIG_
##
	`n
(v)}

	)

891 
	#Em±yPyG‘S‘Def_170
 
Em±yPyG‘S‘Def_169
,{
NULL
,NULL,NULL,NULL,NULL}

	)

892 
	#Em±yPyM‘hodDef_170
 
Em±yPyM‘hodDef_169
,{
NULL
,NULL,0,NULL}

	)

893 
	#Em±yPyMemb”Def_170
 
Em±yPyMemb”Def_169
,{
NULL
,0,0,0,NULL}

	)

894 
	#DESIG_171
(
v
è
	`DESIG_170
(v),
	)
v

895 
	#DESIG__171
(
n
,
v
è
	`DESIG__170
Ò,v),{
DESIG_
##
	`n
(v)}

	)

896 
	#Em±yPyG‘S‘Def_171
 
Em±yPyG‘S‘Def_170
,{
NULL
,NULL,NULL,NULL,NULL}

	)

897 
	#Em±yPyM‘hodDef_171
 
Em±yPyM‘hodDef_170
,{
NULL
,NULL,0,NULL}

	)

898 
	#Em±yPyMemb”Def_171
 
Em±yPyMemb”Def_170
,{
NULL
,0,0,0,NULL}

	)

899 
	#DESIG_172
(
v
è
	`DESIG_171
(v),
	)
v

900 
	#DESIG__172
(
n
,
v
è
	`DESIG__171
Ò,v),{
DESIG_
##
	`n
(v)}

	)

901 
	#Em±yPyG‘S‘Def_172
 
Em±yPyG‘S‘Def_171
,{
NULL
,NULL,NULL,NULL,NULL}

	)

902 
	#Em±yPyM‘hodDef_172
 
Em±yPyM‘hodDef_171
,{
NULL
,NULL,0,NULL}

	)

903 
	#Em±yPyMemb”Def_172
 
Em±yPyMemb”Def_171
,{
NULL
,0,0,0,NULL}

	)

904 
	#DESIG_173
(
v
è
	`DESIG_172
(v),
	)
v

905 
	#DESIG__173
(
n
,
v
è
	`DESIG__172
Ò,v),{
DESIG_
##
	`n
(v)}

	)

906 
	#Em±yPyG‘S‘Def_173
 
Em±yPyG‘S‘Def_172
,{
NULL
,NULL,NULL,NULL,NULL}

	)

907 
	#Em±yPyM‘hodDef_173
 
Em±yPyM‘hodDef_172
,{
NULL
,NULL,0,NULL}

	)

908 
	#Em±yPyMemb”Def_173
 
Em±yPyMemb”Def_172
,{
NULL
,0,0,0,NULL}

	)

909 
	#DESIG_174
(
v
è
	`DESIG_173
(v),
	)
v

910 
	#DESIG__174
(
n
,
v
è
	`DESIG__173
Ò,v),{
DESIG_
##
	`n
(v)}

	)

911 
	#Em±yPyG‘S‘Def_174
 
Em±yPyG‘S‘Def_173
,{
NULL
,NULL,NULL,NULL,NULL}

	)

912 
	#Em±yPyM‘hodDef_174
 
Em±yPyM‘hodDef_173
,{
NULL
,NULL,0,NULL}

	)

913 
	#Em±yPyMemb”Def_174
 
Em±yPyMemb”Def_173
,{
NULL
,0,0,0,NULL}

	)

914 
	#DESIG_175
(
v
è
	`DESIG_174
(v),
	)
v

915 
	#DESIG__175
(
n
,
v
è
	`DESIG__174
Ò,v),{
DESIG_
##
	`n
(v)}

	)

916 
	#Em±yPyG‘S‘Def_175
 
Em±yPyG‘S‘Def_174
,{
NULL
,NULL,NULL,NULL,NULL}

	)

917 
	#Em±yPyM‘hodDef_175
 
Em±yPyM‘hodDef_174
,{
NULL
,NULL,0,NULL}

	)

918 
	#Em±yPyMemb”Def_175
 
Em±yPyMemb”Def_174
,{
NULL
,0,0,0,NULL}

	)

919 
	#DESIG_176
(
v
è
	`DESIG_175
(v),
	)
v

920 
	#DESIG__176
(
n
,
v
è
	`DESIG__175
Ò,v),{
DESIG_
##
	`n
(v)}

	)

921 
	#Em±yPyG‘S‘Def_176
 
Em±yPyG‘S‘Def_175
,{
NULL
,NULL,NULL,NULL,NULL}

	)

922 
	#Em±yPyM‘hodDef_176
 
Em±yPyM‘hodDef_175
,{
NULL
,NULL,0,NULL}

	)

923 
	#Em±yPyMemb”Def_176
 
Em±yPyMemb”Def_175
,{
NULL
,0,0,0,NULL}

	)

924 
	#DESIG_177
(
v
è
	`DESIG_176
(v),
	)
v

925 
	#DESIG__177
(
n
,
v
è
	`DESIG__176
Ò,v),{
DESIG_
##
	`n
(v)}

	)

926 
	#Em±yPyG‘S‘Def_177
 
Em±yPyG‘S‘Def_176
,{
NULL
,NULL,NULL,NULL,NULL}

	)

927 
	#Em±yPyM‘hodDef_177
 
Em±yPyM‘hodDef_176
,{
NULL
,NULL,0,NULL}

	)

928 
	#Em±yPyMemb”Def_177
 
Em±yPyMemb”Def_176
,{
NULL
,0,0,0,NULL}

	)

929 
	#DESIG_178
(
v
è
	`DESIG_177
(v),
	)
v

930 
	#DESIG__178
(
n
,
v
è
	`DESIG__177
Ò,v),{
DESIG_
##
	`n
(v)}

	)

931 
	#Em±yPyG‘S‘Def_178
 
Em±yPyG‘S‘Def_177
,{
NULL
,NULL,NULL,NULL,NULL}

	)

932 
	#Em±yPyM‘hodDef_178
 
Em±yPyM‘hodDef_177
,{
NULL
,NULL,0,NULL}

	)

933 
	#Em±yPyMemb”Def_178
 
Em±yPyMemb”Def_177
,{
NULL
,0,0,0,NULL}

	)

934 
	#DESIG_179
(
v
è
	`DESIG_178
(v),
	)
v

935 
	#DESIG__179
(
n
,
v
è
	`DESIG__178
Ò,v),{
DESIG_
##
	`n
(v)}

	)

936 
	#Em±yPyG‘S‘Def_179
 
Em±yPyG‘S‘Def_178
,{
NULL
,NULL,NULL,NULL,NULL}

	)

937 
	#Em±yPyM‘hodDef_179
 
Em±yPyM‘hodDef_178
,{
NULL
,NULL,0,NULL}

	)

938 
	#Em±yPyMemb”Def_179
 
Em±yPyMemb”Def_178
,{
NULL
,0,0,0,NULL}

	)

939 
	#DESIG_180
(
v
è
	`DESIG_179
(v),
	)
v

940 
	#DESIG__180
(
n
,
v
è
	`DESIG__179
Ò,v),{
DESIG_
##
	`n
(v)}

	)

941 
	#Em±yPyG‘S‘Def_180
 
Em±yPyG‘S‘Def_179
,{
NULL
,NULL,NULL,NULL,NULL}

	)

942 
	#Em±yPyM‘hodDef_180
 
Em±yPyM‘hodDef_179
,{
NULL
,NULL,0,NULL}

	)

943 
	#Em±yPyMemb”Def_180
 
Em±yPyMemb”Def_179
,{
NULL
,0,0,0,NULL}

	)

944 
	#DESIG_181
(
v
è
	`DESIG_180
(v),
	)
v

945 
	#DESIG__181
(
n
,
v
è
	`DESIG__180
Ò,v),{
DESIG_
##
	`n
(v)}

	)

946 
	#Em±yPyG‘S‘Def_181
 
Em±yPyG‘S‘Def_180
,{
NULL
,NULL,NULL,NULL,NULL}

	)

947 
	#Em±yPyM‘hodDef_181
 
Em±yPyM‘hodDef_180
,{
NULL
,NULL,0,NULL}

	)

948 
	#Em±yPyMemb”Def_181
 
Em±yPyMemb”Def_180
,{
NULL
,0,0,0,NULL}

	)

949 
	#DESIG_182
(
v
è
	`DESIG_181
(v),
	)
v

950 
	#DESIG__182
(
n
,
v
è
	`DESIG__181
Ò,v),{
DESIG_
##
	`n
(v)}

	)

951 
	#Em±yPyG‘S‘Def_182
 
Em±yPyG‘S‘Def_181
,{
NULL
,NULL,NULL,NULL,NULL}

	)

952 
	#Em±yPyM‘hodDef_182
 
Em±yPyM‘hodDef_181
,{
NULL
,NULL,0,NULL}

	)

953 
	#Em±yPyMemb”Def_182
 
Em±yPyMemb”Def_181
,{
NULL
,0,0,0,NULL}

	)

954 
	#DESIG_183
(
v
è
	`DESIG_182
(v),
	)
v

955 
	#DESIG__183
(
n
,
v
è
	`DESIG__182
Ò,v),{
DESIG_
##
	`n
(v)}

	)

956 
	#Em±yPyG‘S‘Def_183
 
Em±yPyG‘S‘Def_182
,{
NULL
,NULL,NULL,NULL,NULL}

	)

957 
	#Em±yPyM‘hodDef_183
 
Em±yPyM‘hodDef_182
,{
NULL
,NULL,0,NULL}

	)

958 
	#Em±yPyMemb”Def_183
 
Em±yPyMemb”Def_182
,{
NULL
,0,0,0,NULL}

	)

959 
	#DESIG_184
(
v
è
	`DESIG_183
(v),
	)
v

960 
	#DESIG__184
(
n
,
v
è
	`DESIG__183
Ò,v),{
DESIG_
##
	`n
(v)}

	)

961 
	#Em±yPyG‘S‘Def_184
 
Em±yPyG‘S‘Def_183
,{
NULL
,NULL,NULL,NULL,NULL}

	)

962 
	#Em±yPyM‘hodDef_184
 
Em±yPyM‘hodDef_183
,{
NULL
,NULL,0,NULL}

	)

963 
	#Em±yPyMemb”Def_184
 
Em±yPyMemb”Def_183
,{
NULL
,0,0,0,NULL}

	)

964 
	#DESIG_185
(
v
è
	`DESIG_184
(v),
	)
v

965 
	#DESIG__185
(
n
,
v
è
	`DESIG__184
Ò,v),{
DESIG_
##
	`n
(v)}

	)

966 
	#Em±yPyG‘S‘Def_185
 
Em±yPyG‘S‘Def_184
,{
NULL
,NULL,NULL,NULL,NULL}

	)

967 
	#Em±yPyM‘hodDef_185
 
Em±yPyM‘hodDef_184
,{
NULL
,NULL,0,NULL}

	)

968 
	#Em±yPyMemb”Def_185
 
Em±yPyMemb”Def_184
,{
NULL
,0,0,0,NULL}

	)

969 
	#DESIG_186
(
v
è
	`DESIG_185
(v),
	)
v

970 
	#DESIG__186
(
n
,
v
è
	`DESIG__185
Ò,v),{
DESIG_
##
	`n
(v)}

	)

971 
	#Em±yPyG‘S‘Def_186
 
Em±yPyG‘S‘Def_185
,{
NULL
,NULL,NULL,NULL,NULL}

	)

972 
	#Em±yPyM‘hodDef_186
 
Em±yPyM‘hodDef_185
,{
NULL
,NULL,0,NULL}

	)

973 
	#Em±yPyMemb”Def_186
 
Em±yPyMemb”Def_185
,{
NULL
,0,0,0,NULL}

	)

974 
	#DESIG_187
(
v
è
	`DESIG_186
(v),
	)
v

975 
	#DESIG__187
(
n
,
v
è
	`DESIG__186
Ò,v),{
DESIG_
##
	`n
(v)}

	)

976 
	#Em±yPyG‘S‘Def_187
 
Em±yPyG‘S‘Def_186
,{
NULL
,NULL,NULL,NULL,NULL}

	)

977 
	#Em±yPyM‘hodDef_187
 
Em±yPyM‘hodDef_186
,{
NULL
,NULL,0,NULL}

	)

978 
	#Em±yPyMemb”Def_187
 
Em±yPyMemb”Def_186
,{
NULL
,0,0,0,NULL}

	)

979 
	#DESIG_188
(
v
è
	`DESIG_187
(v),
	)
v

980 
	#DESIG__188
(
n
,
v
è
	`DESIG__187
Ò,v),{
DESIG_
##
	`n
(v)}

	)

981 
	#Em±yPyG‘S‘Def_188
 
Em±yPyG‘S‘Def_187
,{
NULL
,NULL,NULL,NULL,NULL}

	)

982 
	#Em±yPyM‘hodDef_188
 
Em±yPyM‘hodDef_187
,{
NULL
,NULL,0,NULL}

	)

983 
	#Em±yPyMemb”Def_188
 
Em±yPyMemb”Def_187
,{
NULL
,0,0,0,NULL}

	)

984 
	#DESIG_189
(
v
è
	`DESIG_188
(v),
	)
v

985 
	#DESIG__189
(
n
,
v
è
	`DESIG__188
Ò,v),{
DESIG_
##
	`n
(v)}

	)

986 
	#Em±yPyG‘S‘Def_189
 
Em±yPyG‘S‘Def_188
,{
NULL
,NULL,NULL,NULL,NULL}

	)

987 
	#Em±yPyM‘hodDef_189
 
Em±yPyM‘hodDef_188
,{
NULL
,NULL,0,NULL}

	)

988 
	#Em±yPyMemb”Def_189
 
Em±yPyMemb”Def_188
,{
NULL
,0,0,0,NULL}

	)

989 
	#DESIG_190
(
v
è
	`DESIG_189
(v),
	)
v

990 
	#DESIG__190
(
n
,
v
è
	`DESIG__189
Ò,v),{
DESIG_
##
	`n
(v)}

	)

991 
	#Em±yPyG‘S‘Def_190
 
Em±yPyG‘S‘Def_189
,{
NULL
,NULL,NULL,NULL,NULL}

	)

992 
	#Em±yPyM‘hodDef_190
 
Em±yPyM‘hodDef_189
,{
NULL
,NULL,0,NULL}

	)

993 
	#Em±yPyMemb”Def_190
 
Em±yPyMemb”Def_189
,{
NULL
,0,0,0,NULL}

	)

994 
	#DESIG_191
(
v
è
	`DESIG_190
(v),
	)
v

995 
	#DESIG__191
(
n
,
v
è
	`DESIG__190
Ò,v),{
DESIG_
##
	`n
(v)}

	)

996 
	#Em±yPyG‘S‘Def_191
 
Em±yPyG‘S‘Def_190
,{
NULL
,NULL,NULL,NULL,NULL}

	)

997 
	#Em±yPyM‘hodDef_191
 
Em±yPyM‘hodDef_190
,{
NULL
,NULL,0,NULL}

	)

998 
	#Em±yPyMemb”Def_191
 
Em±yPyMemb”Def_190
,{
NULL
,0,0,0,NULL}

	)

999 
	#DESIG_192
(
v
è
	`DESIG_191
(v),
	)
v

1000 
	#DESIG__192
(
n
,
v
è
	`DESIG__191
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1001 
	#Em±yPyG‘S‘Def_192
 
Em±yPyG‘S‘Def_191
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1002 
	#Em±yPyM‘hodDef_192
 
Em±yPyM‘hodDef_191
,{
NULL
,NULL,0,NULL}

	)

1003 
	#Em±yPyMemb”Def_192
 
Em±yPyMemb”Def_191
,{
NULL
,0,0,0,NULL}

	)

1004 
	#DESIG_193
(
v
è
	`DESIG_192
(v),
	)
v

1005 
	#DESIG__193
(
n
,
v
è
	`DESIG__192
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1006 
	#Em±yPyG‘S‘Def_193
 
Em±yPyG‘S‘Def_192
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1007 
	#Em±yPyM‘hodDef_193
 
Em±yPyM‘hodDef_192
,{
NULL
,NULL,0,NULL}

	)

1008 
	#Em±yPyMemb”Def_193
 
Em±yPyMemb”Def_192
,{
NULL
,0,0,0,NULL}

	)

1009 
	#DESIG_194
(
v
è
	`DESIG_193
(v),
	)
v

1010 
	#DESIG__194
(
n
,
v
è
	`DESIG__193
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1011 
	#Em±yPyG‘S‘Def_194
 
Em±yPyG‘S‘Def_193
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1012 
	#Em±yPyM‘hodDef_194
 
Em±yPyM‘hodDef_193
,{
NULL
,NULL,0,NULL}

	)

1013 
	#Em±yPyMemb”Def_194
 
Em±yPyMemb”Def_193
,{
NULL
,0,0,0,NULL}

	)

1014 
	#DESIG_195
(
v
è
	`DESIG_194
(v),
	)
v

1015 
	#DESIG__195
(
n
,
v
è
	`DESIG__194
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1016 
	#Em±yPyG‘S‘Def_195
 
Em±yPyG‘S‘Def_194
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1017 
	#Em±yPyM‘hodDef_195
 
Em±yPyM‘hodDef_194
,{
NULL
,NULL,0,NULL}

	)

1018 
	#Em±yPyMemb”Def_195
 
Em±yPyMemb”Def_194
,{
NULL
,0,0,0,NULL}

	)

1019 
	#DESIG_196
(
v
è
	`DESIG_195
(v),
	)
v

1020 
	#DESIG__196
(
n
,
v
è
	`DESIG__195
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1021 
	#Em±yPyG‘S‘Def_196
 
Em±yPyG‘S‘Def_195
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1022 
	#Em±yPyM‘hodDef_196
 
Em±yPyM‘hodDef_195
,{
NULL
,NULL,0,NULL}

	)

1023 
	#Em±yPyMemb”Def_196
 
Em±yPyMemb”Def_195
,{
NULL
,0,0,0,NULL}

	)

1024 
	#DESIG_197
(
v
è
	`DESIG_196
(v),
	)
v

1025 
	#DESIG__197
(
n
,
v
è
	`DESIG__196
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1026 
	#Em±yPyG‘S‘Def_197
 
Em±yPyG‘S‘Def_196
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1027 
	#Em±yPyM‘hodDef_197
 
Em±yPyM‘hodDef_196
,{
NULL
,NULL,0,NULL}

	)

1028 
	#Em±yPyMemb”Def_197
 
Em±yPyMemb”Def_196
,{
NULL
,0,0,0,NULL}

	)

1029 
	#DESIG_198
(
v
è
	`DESIG_197
(v),
	)
v

1030 
	#DESIG__198
(
n
,
v
è
	`DESIG__197
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1031 
	#Em±yPyG‘S‘Def_198
 
Em±yPyG‘S‘Def_197
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1032 
	#Em±yPyM‘hodDef_198
 
Em±yPyM‘hodDef_197
,{
NULL
,NULL,0,NULL}

	)

1033 
	#Em±yPyMemb”Def_198
 
Em±yPyMemb”Def_197
,{
NULL
,0,0,0,NULL}

	)

1034 
	#DESIG_199
(
v
è
	`DESIG_198
(v),
	)
v

1035 
	#DESIG__199
(
n
,
v
è
	`DESIG__198
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1036 
	#Em±yPyG‘S‘Def_199
 
Em±yPyG‘S‘Def_198
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1037 
	#Em±yPyM‘hodDef_199
 
Em±yPyM‘hodDef_198
,{
NULL
,NULL,0,NULL}

	)

1038 
	#Em±yPyMemb”Def_199
 
Em±yPyMemb”Def_198
,{
NULL
,0,0,0,NULL}

	)

1039 
	#DESIG_200
(
v
è
	`DESIG_199
(v),
	)
v

1040 
	#DESIG__200
(
n
,
v
è
	`DESIG__199
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1041 
	#Em±yPyG‘S‘Def_200
 
Em±yPyG‘S‘Def_199
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1042 
	#Em±yPyM‘hodDef_200
 
Em±yPyM‘hodDef_199
,{
NULL
,NULL,0,NULL}

	)

1043 
	#Em±yPyMemb”Def_200
 
Em±yPyMemb”Def_199
,{
NULL
,0,0,0,NULL}

	)

1044 
	#DESIG_201
(
v
è
	`DESIG_200
(v),
	)
v

1045 
	#DESIG__201
(
n
,
v
è
	`DESIG__200
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1046 
	#Em±yPyG‘S‘Def_201
 
Em±yPyG‘S‘Def_200
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1047 
	#Em±yPyM‘hodDef_201
 
Em±yPyM‘hodDef_200
,{
NULL
,NULL,0,NULL}

	)

1048 
	#Em±yPyMemb”Def_201
 
Em±yPyMemb”Def_200
,{
NULL
,0,0,0,NULL}

	)

1049 
	#DESIG_202
(
v
è
	`DESIG_201
(v),
	)
v

1050 
	#DESIG__202
(
n
,
v
è
	`DESIG__201
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1051 
	#Em±yPyG‘S‘Def_202
 
Em±yPyG‘S‘Def_201
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1052 
	#Em±yPyM‘hodDef_202
 
Em±yPyM‘hodDef_201
,{
NULL
,NULL,0,NULL}

	)

1053 
	#Em±yPyMemb”Def_202
 
Em±yPyMemb”Def_201
,{
NULL
,0,0,0,NULL}

	)

1054 
	#DESIG_203
(
v
è
	`DESIG_202
(v),
	)
v

1055 
	#DESIG__203
(
n
,
v
è
	`DESIG__202
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1056 
	#Em±yPyG‘S‘Def_203
 
Em±yPyG‘S‘Def_202
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1057 
	#Em±yPyM‘hodDef_203
 
Em±yPyM‘hodDef_202
,{
NULL
,NULL,0,NULL}

	)

1058 
	#Em±yPyMemb”Def_203
 
Em±yPyMemb”Def_202
,{
NULL
,0,0,0,NULL}

	)

1059 
	#DESIG_204
(
v
è
	`DESIG_203
(v),
	)
v

1060 
	#DESIG__204
(
n
,
v
è
	`DESIG__203
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1061 
	#Em±yPyG‘S‘Def_204
 
Em±yPyG‘S‘Def_203
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1062 
	#Em±yPyM‘hodDef_204
 
Em±yPyM‘hodDef_203
,{
NULL
,NULL,0,NULL}

	)

1063 
	#Em±yPyMemb”Def_204
 
Em±yPyMemb”Def_203
,{
NULL
,0,0,0,NULL}

	)

1064 
	#DESIG_205
(
v
è
	`DESIG_204
(v),
	)
v

1065 
	#DESIG__205
(
n
,
v
è
	`DESIG__204
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1066 
	#Em±yPyG‘S‘Def_205
 
Em±yPyG‘S‘Def_204
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1067 
	#Em±yPyM‘hodDef_205
 
Em±yPyM‘hodDef_204
,{
NULL
,NULL,0,NULL}

	)

1068 
	#Em±yPyMemb”Def_205
 
Em±yPyMemb”Def_204
,{
NULL
,0,0,0,NULL}

	)

1069 
	#DESIG_206
(
v
è
	`DESIG_205
(v),
	)
v

1070 
	#DESIG__206
(
n
,
v
è
	`DESIG__205
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1071 
	#Em±yPyG‘S‘Def_206
 
Em±yPyG‘S‘Def_205
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1072 
	#Em±yPyM‘hodDef_206
 
Em±yPyM‘hodDef_205
,{
NULL
,NULL,0,NULL}

	)

1073 
	#Em±yPyMemb”Def_206
 
Em±yPyMemb”Def_205
,{
NULL
,0,0,0,NULL}

	)

1074 
	#DESIG_207
(
v
è
	`DESIG_206
(v),
	)
v

1075 
	#DESIG__207
(
n
,
v
è
	`DESIG__206
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1076 
	#Em±yPyG‘S‘Def_207
 
Em±yPyG‘S‘Def_206
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1077 
	#Em±yPyM‘hodDef_207
 
Em±yPyM‘hodDef_206
,{
NULL
,NULL,0,NULL}

	)

1078 
	#Em±yPyMemb”Def_207
 
Em±yPyMemb”Def_206
,{
NULL
,0,0,0,NULL}

	)

1079 
	#DESIG_208
(
v
è
	`DESIG_207
(v),
	)
v

1080 
	#DESIG__208
(
n
,
v
è
	`DESIG__207
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1081 
	#Em±yPyG‘S‘Def_208
 
Em±yPyG‘S‘Def_207
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1082 
	#Em±yPyM‘hodDef_208
 
Em±yPyM‘hodDef_207
,{
NULL
,NULL,0,NULL}

	)

1083 
	#Em±yPyMemb”Def_208
 
Em±yPyMemb”Def_207
,{
NULL
,0,0,0,NULL}

	)

1084 
	#DESIG_209
(
v
è
	`DESIG_208
(v),
	)
v

1085 
	#DESIG__209
(
n
,
v
è
	`DESIG__208
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1086 
	#Em±yPyG‘S‘Def_209
 
Em±yPyG‘S‘Def_208
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1087 
	#Em±yPyM‘hodDef_209
 
Em±yPyM‘hodDef_208
,{
NULL
,NULL,0,NULL}

	)

1088 
	#Em±yPyMemb”Def_209
 
Em±yPyMemb”Def_208
,{
NULL
,0,0,0,NULL}

	)

1089 
	#DESIG_210
(
v
è
	`DESIG_209
(v),
	)
v

1090 
	#DESIG__210
(
n
,
v
è
	`DESIG__209
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1091 
	#Em±yPyG‘S‘Def_210
 
Em±yPyG‘S‘Def_209
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1092 
	#Em±yPyM‘hodDef_210
 
Em±yPyM‘hodDef_209
,{
NULL
,NULL,0,NULL}

	)

1093 
	#Em±yPyMemb”Def_210
 
Em±yPyMemb”Def_209
,{
NULL
,0,0,0,NULL}

	)

1094 
	#DESIG_211
(
v
è
	`DESIG_210
(v),
	)
v

1095 
	#DESIG__211
(
n
,
v
è
	`DESIG__210
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1096 
	#Em±yPyG‘S‘Def_211
 
Em±yPyG‘S‘Def_210
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1097 
	#Em±yPyM‘hodDef_211
 
Em±yPyM‘hodDef_210
,{
NULL
,NULL,0,NULL}

	)

1098 
	#Em±yPyMemb”Def_211
 
Em±yPyMemb”Def_210
,{
NULL
,0,0,0,NULL}

	)

1099 
	#DESIG_212
(
v
è
	`DESIG_211
(v),
	)
v

1100 
	#DESIG__212
(
n
,
v
è
	`DESIG__211
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1101 
	#Em±yPyG‘S‘Def_212
 
Em±yPyG‘S‘Def_211
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1102 
	#Em±yPyM‘hodDef_212
 
Em±yPyM‘hodDef_211
,{
NULL
,NULL,0,NULL}

	)

1103 
	#Em±yPyMemb”Def_212
 
Em±yPyMemb”Def_211
,{
NULL
,0,0,0,NULL}

	)

1104 
	#DESIG_213
(
v
è
	`DESIG_212
(v),
	)
v

1105 
	#DESIG__213
(
n
,
v
è
	`DESIG__212
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1106 
	#Em±yPyG‘S‘Def_213
 
Em±yPyG‘S‘Def_212
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1107 
	#Em±yPyM‘hodDef_213
 
Em±yPyM‘hodDef_212
,{
NULL
,NULL,0,NULL}

	)

1108 
	#Em±yPyMemb”Def_213
 
Em±yPyMemb”Def_212
,{
NULL
,0,0,0,NULL}

	)

1109 
	#DESIG_214
(
v
è
	`DESIG_213
(v),
	)
v

1110 
	#DESIG__214
(
n
,
v
è
	`DESIG__213
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1111 
	#Em±yPyG‘S‘Def_214
 
Em±yPyG‘S‘Def_213
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1112 
	#Em±yPyM‘hodDef_214
 
Em±yPyM‘hodDef_213
,{
NULL
,NULL,0,NULL}

	)

1113 
	#Em±yPyMemb”Def_214
 
Em±yPyMemb”Def_213
,{
NULL
,0,0,0,NULL}

	)

1114 
	#DESIG_215
(
v
è
	`DESIG_214
(v),
	)
v

1115 
	#DESIG__215
(
n
,
v
è
	`DESIG__214
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1116 
	#Em±yPyG‘S‘Def_215
 
Em±yPyG‘S‘Def_214
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1117 
	#Em±yPyM‘hodDef_215
 
Em±yPyM‘hodDef_214
,{
NULL
,NULL,0,NULL}

	)

1118 
	#Em±yPyMemb”Def_215
 
Em±yPyMemb”Def_214
,{
NULL
,0,0,0,NULL}

	)

1119 
	#DESIG_216
(
v
è
	`DESIG_215
(v),
	)
v

1120 
	#DESIG__216
(
n
,
v
è
	`DESIG__215
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1121 
	#Em±yPyG‘S‘Def_216
 
Em±yPyG‘S‘Def_215
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1122 
	#Em±yPyM‘hodDef_216
 
Em±yPyM‘hodDef_215
,{
NULL
,NULL,0,NULL}

	)

1123 
	#Em±yPyMemb”Def_216
 
Em±yPyMemb”Def_215
,{
NULL
,0,0,0,NULL}

	)

1124 
	#DESIG_217
(
v
è
	`DESIG_216
(v),
	)
v

1125 
	#DESIG__217
(
n
,
v
è
	`DESIG__216
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1126 
	#Em±yPyG‘S‘Def_217
 
Em±yPyG‘S‘Def_216
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1127 
	#Em±yPyM‘hodDef_217
 
Em±yPyM‘hodDef_216
,{
NULL
,NULL,0,NULL}

	)

1128 
	#Em±yPyMemb”Def_217
 
Em±yPyMemb”Def_216
,{
NULL
,0,0,0,NULL}

	)

1129 
	#DESIG_218
(
v
è
	`DESIG_217
(v),
	)
v

1130 
	#DESIG__218
(
n
,
v
è
	`DESIG__217
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1131 
	#Em±yPyG‘S‘Def_218
 
Em±yPyG‘S‘Def_217
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1132 
	#Em±yPyM‘hodDef_218
 
Em±yPyM‘hodDef_217
,{
NULL
,NULL,0,NULL}

	)

1133 
	#Em±yPyMemb”Def_218
 
Em±yPyMemb”Def_217
,{
NULL
,0,0,0,NULL}

	)

1134 
	#DESIG_219
(
v
è
	`DESIG_218
(v),
	)
v

1135 
	#DESIG__219
(
n
,
v
è
	`DESIG__218
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1136 
	#Em±yPyG‘S‘Def_219
 
Em±yPyG‘S‘Def_218
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1137 
	#Em±yPyM‘hodDef_219
 
Em±yPyM‘hodDef_218
,{
NULL
,NULL,0,NULL}

	)

1138 
	#Em±yPyMemb”Def_219
 
Em±yPyMemb”Def_218
,{
NULL
,0,0,0,NULL}

	)

1139 
	#DESIG_220
(
v
è
	`DESIG_219
(v),
	)
v

1140 
	#DESIG__220
(
n
,
v
è
	`DESIG__219
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1141 
	#Em±yPyG‘S‘Def_220
 
Em±yPyG‘S‘Def_219
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1142 
	#Em±yPyM‘hodDef_220
 
Em±yPyM‘hodDef_219
,{
NULL
,NULL,0,NULL}

	)

1143 
	#Em±yPyMemb”Def_220
 
Em±yPyMemb”Def_219
,{
NULL
,0,0,0,NULL}

	)

1144 
	#DESIG_221
(
v
è
	`DESIG_220
(v),
	)
v

1145 
	#DESIG__221
(
n
,
v
è
	`DESIG__220
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1146 
	#Em±yPyG‘S‘Def_221
 
Em±yPyG‘S‘Def_220
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1147 
	#Em±yPyM‘hodDef_221
 
Em±yPyM‘hodDef_220
,{
NULL
,NULL,0,NULL}

	)

1148 
	#Em±yPyMemb”Def_221
 
Em±yPyMemb”Def_220
,{
NULL
,0,0,0,NULL}

	)

1149 
	#DESIG_222
(
v
è
	`DESIG_221
(v),
	)
v

1150 
	#DESIG__222
(
n
,
v
è
	`DESIG__221
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1151 
	#Em±yPyG‘S‘Def_222
 
Em±yPyG‘S‘Def_221
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1152 
	#Em±yPyM‘hodDef_222
 
Em±yPyM‘hodDef_221
,{
NULL
,NULL,0,NULL}

	)

1153 
	#Em±yPyMemb”Def_222
 
Em±yPyMemb”Def_221
,{
NULL
,0,0,0,NULL}

	)

1154 
	#DESIG_223
(
v
è
	`DESIG_222
(v),
	)
v

1155 
	#DESIG__223
(
n
,
v
è
	`DESIG__222
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1156 
	#Em±yPyG‘S‘Def_223
 
Em±yPyG‘S‘Def_222
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1157 
	#Em±yPyM‘hodDef_223
 
Em±yPyM‘hodDef_222
,{
NULL
,NULL,0,NULL}

	)

1158 
	#Em±yPyMemb”Def_223
 
Em±yPyMemb”Def_222
,{
NULL
,0,0,0,NULL}

	)

1159 
	#DESIG_224
(
v
è
	`DESIG_223
(v),
	)
v

1160 
	#DESIG__224
(
n
,
v
è
	`DESIG__223
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1161 
	#Em±yPyG‘S‘Def_224
 
Em±yPyG‘S‘Def_223
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1162 
	#Em±yPyM‘hodDef_224
 
Em±yPyM‘hodDef_223
,{
NULL
,NULL,0,NULL}

	)

1163 
	#Em±yPyMemb”Def_224
 
Em±yPyMemb”Def_223
,{
NULL
,0,0,0,NULL}

	)

1164 
	#DESIG_225
(
v
è
	`DESIG_224
(v),
	)
v

1165 
	#DESIG__225
(
n
,
v
è
	`DESIG__224
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1166 
	#Em±yPyG‘S‘Def_225
 
Em±yPyG‘S‘Def_224
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1167 
	#Em±yPyM‘hodDef_225
 
Em±yPyM‘hodDef_224
,{
NULL
,NULL,0,NULL}

	)

1168 
	#Em±yPyMemb”Def_225
 
Em±yPyMemb”Def_224
,{
NULL
,0,0,0,NULL}

	)

1169 
	#DESIG_226
(
v
è
	`DESIG_225
(v),
	)
v

1170 
	#DESIG__226
(
n
,
v
è
	`DESIG__225
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1171 
	#Em±yPyG‘S‘Def_226
 
Em±yPyG‘S‘Def_225
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1172 
	#Em±yPyM‘hodDef_226
 
Em±yPyM‘hodDef_225
,{
NULL
,NULL,0,NULL}

	)

1173 
	#Em±yPyMemb”Def_226
 
Em±yPyMemb”Def_225
,{
NULL
,0,0,0,NULL}

	)

1174 
	#DESIG_227
(
v
è
	`DESIG_226
(v),
	)
v

1175 
	#DESIG__227
(
n
,
v
è
	`DESIG__226
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1176 
	#Em±yPyG‘S‘Def_227
 
Em±yPyG‘S‘Def_226
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1177 
	#Em±yPyM‘hodDef_227
 
Em±yPyM‘hodDef_226
,{
NULL
,NULL,0,NULL}

	)

1178 
	#Em±yPyMemb”Def_227
 
Em±yPyMemb”Def_226
,{
NULL
,0,0,0,NULL}

	)

1179 
	#DESIG_228
(
v
è
	`DESIG_227
(v),
	)
v

1180 
	#DESIG__228
(
n
,
v
è
	`DESIG__227
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1181 
	#Em±yPyG‘S‘Def_228
 
Em±yPyG‘S‘Def_227
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1182 
	#Em±yPyM‘hodDef_228
 
Em±yPyM‘hodDef_227
,{
NULL
,NULL,0,NULL}

	)

1183 
	#Em±yPyMemb”Def_228
 
Em±yPyMemb”Def_227
,{
NULL
,0,0,0,NULL}

	)

1184 
	#DESIG_229
(
v
è
	`DESIG_228
(v),
	)
v

1185 
	#DESIG__229
(
n
,
v
è
	`DESIG__228
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1186 
	#Em±yPyG‘S‘Def_229
 
Em±yPyG‘S‘Def_228
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1187 
	#Em±yPyM‘hodDef_229
 
Em±yPyM‘hodDef_228
,{
NULL
,NULL,0,NULL}

	)

1188 
	#Em±yPyMemb”Def_229
 
Em±yPyMemb”Def_228
,{
NULL
,0,0,0,NULL}

	)

1189 
	#DESIG_230
(
v
è
	`DESIG_229
(v),
	)
v

1190 
	#DESIG__230
(
n
,
v
è
	`DESIG__229
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1191 
	#Em±yPyG‘S‘Def_230
 
Em±yPyG‘S‘Def_229
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1192 
	#Em±yPyM‘hodDef_230
 
Em±yPyM‘hodDef_229
,{
NULL
,NULL,0,NULL}

	)

1193 
	#Em±yPyMemb”Def_230
 
Em±yPyMemb”Def_229
,{
NULL
,0,0,0,NULL}

	)

1194 
	#DESIG_231
(
v
è
	`DESIG_230
(v),
	)
v

1195 
	#DESIG__231
(
n
,
v
è
	`DESIG__230
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1196 
	#Em±yPyG‘S‘Def_231
 
Em±yPyG‘S‘Def_230
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1197 
	#Em±yPyM‘hodDef_231
 
Em±yPyM‘hodDef_230
,{
NULL
,NULL,0,NULL}

	)

1198 
	#Em±yPyMemb”Def_231
 
Em±yPyMemb”Def_230
,{
NULL
,0,0,0,NULL}

	)

1199 
	#DESIG_232
(
v
è
	`DESIG_231
(v),
	)
v

1200 
	#DESIG__232
(
n
,
v
è
	`DESIG__231
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1201 
	#Em±yPyG‘S‘Def_232
 
Em±yPyG‘S‘Def_231
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1202 
	#Em±yPyM‘hodDef_232
 
Em±yPyM‘hodDef_231
,{
NULL
,NULL,0,NULL}

	)

1203 
	#Em±yPyMemb”Def_232
 
Em±yPyMemb”Def_231
,{
NULL
,0,0,0,NULL}

	)

1204 
	#DESIG_233
(
v
è
	`DESIG_232
(v),
	)
v

1205 
	#DESIG__233
(
n
,
v
è
	`DESIG__232
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1206 
	#Em±yPyG‘S‘Def_233
 
Em±yPyG‘S‘Def_232
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1207 
	#Em±yPyM‘hodDef_233
 
Em±yPyM‘hodDef_232
,{
NULL
,NULL,0,NULL}

	)

1208 
	#Em±yPyMemb”Def_233
 
Em±yPyMemb”Def_232
,{
NULL
,0,0,0,NULL}

	)

1209 
	#DESIG_234
(
v
è
	`DESIG_233
(v),
	)
v

1210 
	#DESIG__234
(
n
,
v
è
	`DESIG__233
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1211 
	#Em±yPyG‘S‘Def_234
 
Em±yPyG‘S‘Def_233
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1212 
	#Em±yPyM‘hodDef_234
 
Em±yPyM‘hodDef_233
,{
NULL
,NULL,0,NULL}

	)

1213 
	#Em±yPyMemb”Def_234
 
Em±yPyMemb”Def_233
,{
NULL
,0,0,0,NULL}

	)

1214 
	#DESIG_235
(
v
è
	`DESIG_234
(v),
	)
v

1215 
	#DESIG__235
(
n
,
v
è
	`DESIG__234
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1216 
	#Em±yPyG‘S‘Def_235
 
Em±yPyG‘S‘Def_234
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1217 
	#Em±yPyM‘hodDef_235
 
Em±yPyM‘hodDef_234
,{
NULL
,NULL,0,NULL}

	)

1218 
	#Em±yPyMemb”Def_235
 
Em±yPyMemb”Def_234
,{
NULL
,0,0,0,NULL}

	)

1219 
	#DESIG_236
(
v
è
	`DESIG_235
(v),
	)
v

1220 
	#DESIG__236
(
n
,
v
è
	`DESIG__235
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1221 
	#Em±yPyG‘S‘Def_236
 
Em±yPyG‘S‘Def_235
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1222 
	#Em±yPyM‘hodDef_236
 
Em±yPyM‘hodDef_235
,{
NULL
,NULL,0,NULL}

	)

1223 
	#Em±yPyMemb”Def_236
 
Em±yPyMemb”Def_235
,{
NULL
,0,0,0,NULL}

	)

1224 
	#DESIG_237
(
v
è
	`DESIG_236
(v),
	)
v

1225 
	#DESIG__237
(
n
,
v
è
	`DESIG__236
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1226 
	#Em±yPyG‘S‘Def_237
 
Em±yPyG‘S‘Def_236
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1227 
	#Em±yPyM‘hodDef_237
 
Em±yPyM‘hodDef_236
,{
NULL
,NULL,0,NULL}

	)

1228 
	#Em±yPyMemb”Def_237
 
Em±yPyMemb”Def_236
,{
NULL
,0,0,0,NULL}

	)

1229 
	#DESIG_238
(
v
è
	`DESIG_237
(v),
	)
v

1230 
	#DESIG__238
(
n
,
v
è
	`DESIG__237
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1231 
	#Em±yPyG‘S‘Def_238
 
Em±yPyG‘S‘Def_237
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1232 
	#Em±yPyM‘hodDef_238
 
Em±yPyM‘hodDef_237
,{
NULL
,NULL,0,NULL}

	)

1233 
	#Em±yPyMemb”Def_238
 
Em±yPyMemb”Def_237
,{
NULL
,0,0,0,NULL}

	)

1234 
	#DESIG_239
(
v
è
	`DESIG_238
(v),
	)
v

1235 
	#DESIG__239
(
n
,
v
è
	`DESIG__238
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1236 
	#Em±yPyG‘S‘Def_239
 
Em±yPyG‘S‘Def_238
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1237 
	#Em±yPyM‘hodDef_239
 
Em±yPyM‘hodDef_238
,{
NULL
,NULL,0,NULL}

	)

1238 
	#Em±yPyMemb”Def_239
 
Em±yPyMemb”Def_238
,{
NULL
,0,0,0,NULL}

	)

1239 
	#DESIG_240
(
v
è
	`DESIG_239
(v),
	)
v

1240 
	#DESIG__240
(
n
,
v
è
	`DESIG__239
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1241 
	#Em±yPyG‘S‘Def_240
 
Em±yPyG‘S‘Def_239
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1242 
	#Em±yPyM‘hodDef_240
 
Em±yPyM‘hodDef_239
,{
NULL
,NULL,0,NULL}

	)

1243 
	#Em±yPyMemb”Def_240
 
Em±yPyMemb”Def_239
,{
NULL
,0,0,0,NULL}

	)

1244 
	#DESIG_241
(
v
è
	`DESIG_240
(v),
	)
v

1245 
	#DESIG__241
(
n
,
v
è
	`DESIG__240
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1246 
	#Em±yPyG‘S‘Def_241
 
Em±yPyG‘S‘Def_240
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1247 
	#Em±yPyM‘hodDef_241
 
Em±yPyM‘hodDef_240
,{
NULL
,NULL,0,NULL}

	)

1248 
	#Em±yPyMemb”Def_241
 
Em±yPyMemb”Def_240
,{
NULL
,0,0,0,NULL}

	)

1249 
	#DESIG_242
(
v
è
	`DESIG_241
(v),
	)
v

1250 
	#DESIG__242
(
n
,
v
è
	`DESIG__241
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1251 
	#Em±yPyG‘S‘Def_242
 
Em±yPyG‘S‘Def_241
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1252 
	#Em±yPyM‘hodDef_242
 
Em±yPyM‘hodDef_241
,{
NULL
,NULL,0,NULL}

	)

1253 
	#Em±yPyMemb”Def_242
 
Em±yPyMemb”Def_241
,{
NULL
,0,0,0,NULL}

	)

1254 
	#DESIG_243
(
v
è
	`DESIG_242
(v),
	)
v

1255 
	#DESIG__243
(
n
,
v
è
	`DESIG__242
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1256 
	#Em±yPyG‘S‘Def_243
 
Em±yPyG‘S‘Def_242
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1257 
	#Em±yPyM‘hodDef_243
 
Em±yPyM‘hodDef_242
,{
NULL
,NULL,0,NULL}

	)

1258 
	#Em±yPyMemb”Def_243
 
Em±yPyMemb”Def_242
,{
NULL
,0,0,0,NULL}

	)

1259 
	#DESIG_244
(
v
è
	`DESIG_243
(v),
	)
v

1260 
	#DESIG__244
(
n
,
v
è
	`DESIG__243
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1261 
	#Em±yPyG‘S‘Def_244
 
Em±yPyG‘S‘Def_243
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1262 
	#Em±yPyM‘hodDef_244
 
Em±yPyM‘hodDef_243
,{
NULL
,NULL,0,NULL}

	)

1263 
	#Em±yPyMemb”Def_244
 
Em±yPyMemb”Def_243
,{
NULL
,0,0,0,NULL}

	)

1264 
	#DESIG_245
(
v
è
	`DESIG_244
(v),
	)
v

1265 
	#DESIG__245
(
n
,
v
è
	`DESIG__244
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1266 
	#Em±yPyG‘S‘Def_245
 
Em±yPyG‘S‘Def_244
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1267 
	#Em±yPyM‘hodDef_245
 
Em±yPyM‘hodDef_244
,{
NULL
,NULL,0,NULL}

	)

1268 
	#Em±yPyMemb”Def_245
 
Em±yPyMemb”Def_244
,{
NULL
,0,0,0,NULL}

	)

1269 
	#DESIG_246
(
v
è
	`DESIG_245
(v),
	)
v

1270 
	#DESIG__246
(
n
,
v
è
	`DESIG__245
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1271 
	#Em±yPyG‘S‘Def_246
 
Em±yPyG‘S‘Def_245
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1272 
	#Em±yPyM‘hodDef_246
 
Em±yPyM‘hodDef_245
,{
NULL
,NULL,0,NULL}

	)

1273 
	#Em±yPyMemb”Def_246
 
Em±yPyMemb”Def_245
,{
NULL
,0,0,0,NULL}

	)

1274 
	#DESIG_247
(
v
è
	`DESIG_246
(v),
	)
v

1275 
	#DESIG__247
(
n
,
v
è
	`DESIG__246
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1276 
	#Em±yPyG‘S‘Def_247
 
Em±yPyG‘S‘Def_246
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1277 
	#Em±yPyM‘hodDef_247
 
Em±yPyM‘hodDef_246
,{
NULL
,NULL,0,NULL}

	)

1278 
	#Em±yPyMemb”Def_247
 
Em±yPyMemb”Def_246
,{
NULL
,0,0,0,NULL}

	)

1279 
	#DESIG_248
(
v
è
	`DESIG_247
(v),
	)
v

1280 
	#DESIG__248
(
n
,
v
è
	`DESIG__247
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1281 
	#Em±yPyG‘S‘Def_248
 
Em±yPyG‘S‘Def_247
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1282 
	#Em±yPyM‘hodDef_248
 
Em±yPyM‘hodDef_247
,{
NULL
,NULL,0,NULL}

	)

1283 
	#Em±yPyMemb”Def_248
 
Em±yPyMemb”Def_247
,{
NULL
,0,0,0,NULL}

	)

1284 
	#DESIG_249
(
v
è
	`DESIG_248
(v),
	)
v

1285 
	#DESIG__249
(
n
,
v
è
	`DESIG__248
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1286 
	#Em±yPyG‘S‘Def_249
 
Em±yPyG‘S‘Def_248
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1287 
	#Em±yPyM‘hodDef_249
 
Em±yPyM‘hodDef_248
,{
NULL
,NULL,0,NULL}

	)

1288 
	#Em±yPyMemb”Def_249
 
Em±yPyMemb”Def_248
,{
NULL
,0,0,0,NULL}

	)

1289 
	#DESIG_250
(
v
è
	`DESIG_249
(v),
	)
v

1290 
	#DESIG__250
(
n
,
v
è
	`DESIG__249
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1291 
	#Em±yPyG‘S‘Def_250
 
Em±yPyG‘S‘Def_249
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1292 
	#Em±yPyM‘hodDef_250
 
Em±yPyM‘hodDef_249
,{
NULL
,NULL,0,NULL}

	)

1293 
	#Em±yPyMemb”Def_250
 
Em±yPyMemb”Def_249
,{
NULL
,0,0,0,NULL}

	)

1294 
	#DESIG_251
(
v
è
	`DESIG_250
(v),
	)
v

1295 
	#DESIG__251
(
n
,
v
è
	`DESIG__250
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1296 
	#Em±yPyG‘S‘Def_251
 
Em±yPyG‘S‘Def_250
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1297 
	#Em±yPyM‘hodDef_251
 
Em±yPyM‘hodDef_250
,{
NULL
,NULL,0,NULL}

	)

1298 
	#Em±yPyMemb”Def_251
 
Em±yPyMemb”Def_250
,{
NULL
,0,0,0,NULL}

	)

1299 
	#DESIG_252
(
v
è
	`DESIG_251
(v),
	)
v

1300 
	#DESIG__252
(
n
,
v
è
	`DESIG__251
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1301 
	#Em±yPyG‘S‘Def_252
 
Em±yPyG‘S‘Def_251
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1302 
	#Em±yPyM‘hodDef_252
 
Em±yPyM‘hodDef_251
,{
NULL
,NULL,0,NULL}

	)

1303 
	#Em±yPyMemb”Def_252
 
Em±yPyMemb”Def_251
,{
NULL
,0,0,0,NULL}

	)

1304 
	#DESIG_253
(
v
è
	`DESIG_252
(v),
	)
v

1305 
	#DESIG__253
(
n
,
v
è
	`DESIG__252
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1306 
	#Em±yPyG‘S‘Def_253
 
Em±yPyG‘S‘Def_252
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1307 
	#Em±yPyM‘hodDef_253
 
Em±yPyM‘hodDef_252
,{
NULL
,NULL,0,NULL}

	)

1308 
	#Em±yPyMemb”Def_253
 
Em±yPyMemb”Def_252
,{
NULL
,0,0,0,NULL}

	)

1309 
	#DESIG_254
(
v
è
	`DESIG_253
(v),
	)
v

1310 
	#DESIG__254
(
n
,
v
è
	`DESIG__253
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1311 
	#Em±yPyG‘S‘Def_254
 
Em±yPyG‘S‘Def_253
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1312 
	#Em±yPyM‘hodDef_254
 
Em±yPyM‘hodDef_253
,{
NULL
,NULL,0,NULL}

	)

1313 
	#Em±yPyMemb”Def_254
 
Em±yPyMemb”Def_253
,{
NULL
,0,0,0,NULL}

	)

1314 
	#DESIG_255
(
v
è
	`DESIG_254
(v),
	)
v

1315 
	#DESIG__255
(
n
,
v
è
	`DESIG__254
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1316 
	#Em±yPyG‘S‘Def_255
 
Em±yPyG‘S‘Def_254
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1317 
	#Em±yPyM‘hodDef_255
 
Em±yPyM‘hodDef_254
,{
NULL
,NULL,0,NULL}

	)

1318 
	#Em±yPyMemb”Def_255
 
Em±yPyMemb”Def_254
,{
NULL
,0,0,0,NULL}

	)

1319 
	#DESIG_256
(
v
è
	`DESIG_255
(v),
	)
v

1320 
	#DESIG__256
(
n
,
v
è
	`DESIG__255
Ò,v),{
DESIG_
##
	`n
(v)}

	)

1321 
	#Em±yPyG‘S‘Def_256
 
Em±yPyG‘S‘Def_255
,{
NULL
,NULL,NULL,NULL,NULL}

	)

1322 
	#Em±yPyM‘hodDef_256
 
Em±yPyM‘hodDef_255
,{
NULL
,NULL,0,NULL}

	)

1323 
	#Em±yPyMemb”Def_256
 
Em±yPyMemb”Def_255
,{
NULL
,0,0,0,NULL}

	)

1324 
	#DESIG
(
m
,
v
è
DESIG_
##
	`m
(v)

	)

1325 
	#DESIG2
(
m
,
n
,
v
è
DESIG__
##
	`m
Ò,v)

	)

1326 
	#Em±yPyG‘S‘Def
(
m
è{
Em±yPyG‘S‘Def_
##m}

	)

1327 
	#Em±yPyM‘hodDef
(
m
è{
Em±yPyM‘hodDef_
##m}

	)

1328 
	#Em±yPyMemb”Def
(
m
è{
Em±yPyMemb”Def_
##m}

	)

1332 
	#Em±yModuË
 {
PyModuËDef_HEAD_INIT
,
NULL
,NULL,-1,NULL,NULL,NULL,NULL}

	)

1370 
	#POTFIT_THRMO_0
 2,"ERR",
”r


	)

1371 
	#POTFIT_THRMO_1
 
POTFIT_THRMO_0
,
Çmes
[0],
”rs
[0]

	)

1372 
	#POTFIT_THRMO_2
 
POTFIT_THRMO_1
,
Çmes
[1],
”rs
[1]

	)

1373 
	#POTFIT_THRMO_3
 
POTFIT_THRMO_2
,
Çmes
[2],
”rs
[2]

	)

1374 
	#POTFIT_THRMO_4
 
POTFIT_THRMO_3
,
Çmes
[3],
”rs
[3]

	)

1375 
	#POTFIT_THRMO_5
 
POTFIT_THRMO_4
,
Çmes
[4],
”rs
[4]

	)

1376 
	#POTFIT_THRMO_6
 
POTFIT_THRMO_5
,
Çmes
[5],
”rs
[5]

	)

1377 
	#POTFIT_THRMO_7
 
POTFIT_THRMO_6
,
Çmes
[6],
”rs
[6]

	)

1378 
	#POTFIT_THRMO_8
 
POTFIT_THRMO_7
,
Çmes
[7],
”rs
[7]

	)

1379 
	#POTFIT_THRMO_9
 
POTFIT_THRMO_8
,
Çmes
[8],
”rs
[8]

	)

1380 
	#POTFIT_THRMO_10
 
POTFIT_THRMO_9
,
Çmes
[9],
”rs
[9]

	)

1381 
	#POTFIT_THRMO_11
 
POTFIT_THRMO_10
,
Çmes
[10],
”rs
[10]

	)

1382 
	#POTFIT_THRMO_12
 
POTFIT_THRMO_11
,
Çmes
[11],
”rs
[11]

	)

1383 
	#POTFIT_THRMO_13
 
POTFIT_THRMO_12
,
Çmes
[12],
”rs
[12]

	)

1384 
	#POTFIT_THRMO_14
 
POTFIT_THRMO_13
,
Çmes
[13],
”rs
[13]

	)

1385 
	#POTFIT_THRMO_15
 
POTFIT_THRMO_14
,
Çmes
[14],
”rs
[14]

	)

1386 
	#POTFIT_THRMO_16
 
POTFIT_THRMO_15
,
Çmes
[15],
”rs
[15]

	)

1387 
	#POTFIT_THRMO_17
 
POTFIT_THRMO_16
,
Çmes
[16],
”rs
[16]

	)

1388 
	#POTFIT_THRMO_18
 
POTFIT_THRMO_17
,
Çmes
[17],
”rs
[17]

	)

1389 
	#POTFIT_THRMO_19
 
POTFIT_THRMO_18
,
Çmes
[18],
”rs
[18]

	)

1390 
	#POTFIT_THRMO_20
 
POTFIT_THRMO_19
,
Çmes
[19],
”rs
[19]

	)

1391 
	#POTFIT_THRMO_21
 
POTFIT_THRMO_20
,
Çmes
[20],
”rs
[20]

	)

1392 
	#POTFIT_THRMO_22
 
POTFIT_THRMO_21
,
Çmes
[21],
”rs
[21]

	)

1393 
	#POTFIT_THRMO_23
 
POTFIT_THRMO_22
,
Çmes
[22],
”rs
[22]

	)

1394 
	#POTFIT_THRMO_24
 
POTFIT_THRMO_23
,
Çmes
[23],
”rs
[23]

	)

1395 
	#POTFIT_THRMO_25
 
POTFIT_THRMO_24
,
Çmes
[24],
”rs
[24]

	)

1396 
	#POTFIT_THRMO_26
 
POTFIT_THRMO_25
,
Çmes
[25],
”rs
[25]

	)

1397 
	#POTFIT_THRMO_27
 
POTFIT_THRMO_26
,
Çmes
[26],
”rs
[26]

	)

1398 
	#POTFIT_THRMO_28
 
POTFIT_THRMO_27
,
Çmes
[27],
”rs
[27]

	)

1399 
	#POTFIT_THRMO_29
 
POTFIT_THRMO_28
,
Çmes
[28],
”rs
[28]

	)

1400 
	#POTFIT_THRMO_30
 
POTFIT_THRMO_29
,
Çmes
[29],
”rs
[29]

	)

1401 
	#POTFIT_THRMO_31
 
POTFIT_THRMO_30
,
Çmes
[30],
”rs
[30]

	)

1402 
	#POTFIT_THRMO_32
 
POTFIT_THRMO_31
,
Çmes
[31],
”rs
[31]

	)

1403 
	#POTFIT_THRMO_33
 
POTFIT_THRMO_32
,
Çmes
[32],
”rs
[32]

	)

1404 
	#POTFIT_THRMO_34
 
POTFIT_THRMO_33
,
Çmes
[33],
”rs
[33]

	)

1405 
	#POTFIT_THRMO_35
 
POTFIT_THRMO_34
,
Çmes
[34],
”rs
[34]

	)

1406 
	#POTFIT_THRMO_36
 
POTFIT_THRMO_35
,
Çmes
[35],
”rs
[35]

	)

1407 
	#POTFIT_THRMO_37
 
POTFIT_THRMO_36
,
Çmes
[36],
”rs
[36]

	)

1408 
	#POTFIT_THRMO_38
 
POTFIT_THRMO_37
,
Çmes
[37],
”rs
[37]

	)

1409 
	#POTFIT_THRMO_39
 
POTFIT_THRMO_38
,
Çmes
[38],
”rs
[38]

	)

1410 
	#POTFIT_THRMO_40
 
POTFIT_THRMO_39
,
Çmes
[39],
”rs
[39]

	)

1411 
	#POTFIT_THRMO_41
 
POTFIT_THRMO_40
,
Çmes
[40],
”rs
[40]

	)

1412 
	#POTFIT_THRMO_42
 
POTFIT_THRMO_41
,
Çmes
[41],
”rs
[41]

	)

1413 
	#POTFIT_THRMO_43
 
POTFIT_THRMO_42
,
Çmes
[42],
”rs
[42]

	)

1414 
	#POTFIT_THRMO_44
 
POTFIT_THRMO_43
,
Çmes
[43],
”rs
[43]

	)

1415 
	#POTFIT_THRMO_45
 
POTFIT_THRMO_44
,
Çmes
[44],
”rs
[44]

	)

1416 
	#POTFIT_THRMO_46
 
POTFIT_THRMO_45
,
Çmes
[45],
”rs
[45]

	)

1417 
	#POTFIT_THRMO_47
 
POTFIT_THRMO_46
,
Çmes
[46],
”rs
[46]

	)

1418 
	#POTFIT_THRMO_48
 
POTFIT_THRMO_47
,
Çmes
[47],
”rs
[47]

	)

1419 
	#POTFIT_THRMO_49
 
POTFIT_THRMO_48
,
Çmes
[48],
”rs
[48]

	)

1420 
	#POTFIT_THRMO_50
 
POTFIT_THRMO_49
,
Çmes
[49],
”rs
[49]

	)

1421 
	#POTFIT_THRMO_51
 
POTFIT_THRMO_50
,
Çmes
[50],
”rs
[50]

	)

1422 
	#POTFIT_THRMO_52
 
POTFIT_THRMO_51
,
Çmes
[51],
”rs
[51]

	)

1423 
	#POTFIT_THRMO_53
 
POTFIT_THRMO_52
,
Çmes
[52],
”rs
[52]

	)

1424 
	#POTFIT_THRMO_54
 
POTFIT_THRMO_53
,
Çmes
[53],
”rs
[53]

	)

1425 
	#POTFIT_THRMO_55
 
POTFIT_THRMO_54
,
Çmes
[54],
”rs
[54]

	)

1426 
	#POTFIT_THRMO_56
 
POTFIT_THRMO_55
,
Çmes
[55],
”rs
[55]

	)

1427 
	#POTFIT_THRMO_57
 
POTFIT_THRMO_56
,
Çmes
[56],
”rs
[56]

	)

1428 
	#POTFIT_THRMO_58
 
POTFIT_THRMO_57
,
Çmes
[57],
”rs
[57]

	)

1429 
	#POTFIT_THRMO_59
 
POTFIT_THRMO_58
,
Çmes
[58],
”rs
[58]

	)

1430 
	#POTFIT_THRMO_60
 
POTFIT_THRMO_59
,
Çmes
[59],
”rs
[59]

	)

1431 
	#POTFIT_THRMO_61
 
POTFIT_THRMO_60
,
Çmes
[60],
”rs
[60]

	)

1432 
	#POTFIT_THRMO_62
 
POTFIT_THRMO_61
,
Çmes
[61],
”rs
[61]

	)

1433 
	#POTFIT_THRMO_63
 
POTFIT_THRMO_62
,
Çmes
[62],
”rs
[62]

	)

1434 
	#POTFIT_THRMO_64
 
POTFIT_THRMO_63
,
Çmes
[63],
”rs
[63]

	)

1435 
	#POTFIT_THRMO_65
 
POTFIT_THRMO_64
,
Çmes
[64],
”rs
[64]

	)

1436 
	#POTFIT_THRMO_66
 
POTFIT_THRMO_65
,
Çmes
[65],
”rs
[65]

	)

1437 
	#POTFIT_THRMO_67
 
POTFIT_THRMO_66
,
Çmes
[66],
”rs
[66]

	)

1438 
	#POTFIT_THRMO_68
 
POTFIT_THRMO_67
,
Çmes
[67],
”rs
[67]

	)

1439 
	#POTFIT_THRMO_69
 
POTFIT_THRMO_68
,
Çmes
[68],
”rs
[68]

	)

1440 
	#POTFIT_THRMO_70
 
POTFIT_THRMO_69
,
Çmes
[69],
”rs
[69]

	)

1441 
	#POTFIT_THRMO_71
 
POTFIT_THRMO_70
,
Çmes
[70],
”rs
[70]

	)

1442 
	#POTFIT_THRMO_72
 
POTFIT_THRMO_71
,
Çmes
[71],
”rs
[71]

	)

1443 
	#POTFIT_THRMO_73
 
POTFIT_THRMO_72
,
Çmes
[72],
”rs
[72]

	)

1444 
	#POTFIT_THRMO_74
 
POTFIT_THRMO_73
,
Çmes
[73],
”rs
[73]

	)

1445 
	#POTFIT_THRMO_75
 
POTFIT_THRMO_74
,
Çmes
[74],
”rs
[74]

	)

1446 
	#POTFIT_THRMO_76
 
POTFIT_THRMO_75
,
Çmes
[75],
”rs
[75]

	)

1447 
	#POTFIT_THRMO_77
 
POTFIT_THRMO_76
,
Çmes
[76],
”rs
[76]

	)

1448 
	#POTFIT_THRMO_78
 
POTFIT_THRMO_77
,
Çmes
[77],
”rs
[77]

	)

1449 
	#POTFIT_THRMO_79
 
POTFIT_THRMO_78
,
Çmes
[78],
”rs
[78]

	)

1450 
	#POTFIT_THRMO_80
 
POTFIT_THRMO_79
,
Çmes
[79],
”rs
[79]

	)

1451 
	#POTFIT_THRMO_81
 
POTFIT_THRMO_80
,
Çmes
[80],
”rs
[80]

	)

1452 
	#POTFIT_THRMO_82
 
POTFIT_THRMO_81
,
Çmes
[81],
”rs
[81]

	)

1453 
	#POTFIT_THRMO_83
 
POTFIT_THRMO_82
,
Çmes
[82],
”rs
[82]

	)

1454 
	#POTFIT_THRMO_84
 
POTFIT_THRMO_83
,
Çmes
[83],
”rs
[83]

	)

1455 
	#POTFIT_THRMO_85
 
POTFIT_THRMO_84
,
Çmes
[84],
”rs
[84]

	)

1456 
	#POTFIT_THRMO_86
 
POTFIT_THRMO_85
,
Çmes
[85],
”rs
[85]

	)

1457 
	#POTFIT_THRMO_87
 
POTFIT_THRMO_86
,
Çmes
[86],
”rs
[86]

	)

1458 
	#POTFIT_THRMO_88
 
POTFIT_THRMO_87
,
Çmes
[87],
”rs
[87]

	)

1459 
	#POTFIT_THRMO_89
 
POTFIT_THRMO_88
,
Çmes
[88],
”rs
[88]

	)

1460 
	#POTFIT_THRMO_90
 
POTFIT_THRMO_89
,
Çmes
[89],
”rs
[89]

	)

1461 
	#POTFIT_THRMO_91
 
POTFIT_THRMO_90
,
Çmes
[90],
”rs
[90]

	)

1462 
	#POTFIT_THRMO_92
 
POTFIT_THRMO_91
,
Çmes
[91],
”rs
[91]

	)

1463 
	#POTFIT_THRMO_93
 
POTFIT_THRMO_92
,
Çmes
[92],
”rs
[92]

	)

1464 
	#POTFIT_THRMO_94
 
POTFIT_THRMO_93
,
Çmes
[93],
”rs
[93]

	)

1465 
	#POTFIT_THRMO_95
 
POTFIT_THRMO_94
,
Çmes
[94],
”rs
[94]

	)

1466 
	#POTFIT_THRMO_96
 
POTFIT_THRMO_95
,
Çmes
[95],
”rs
[95]

	)

1467 
	#POTFIT_THRMO_97
 
POTFIT_THRMO_96
,
Çmes
[96],
”rs
[96]

	)

1468 
	#POTFIT_THRMO_98
 
POTFIT_THRMO_97
,
Çmes
[97],
”rs
[97]

	)

1469 
	#POTFIT_THRMO_99
 
POTFIT_THRMO_98
,
Çmes
[98],
”rs
[98]

	)

1470 
	#POTFIT_THRMO_100
 
POTFIT_THRMO_99
,
Çmes
[99],
”rs
[99]

	)

1471 
	#POTFIT_THRMO_101
 
POTFIT_THRMO_100
,
Çmes
[100],
”rs
[100]

	)

1472 
	#POTFIT_THRMO_102
 
POTFIT_THRMO_101
,
Çmes
[101],
”rs
[101]

	)

1473 
	#POTFIT_THRMO_103
 
POTFIT_THRMO_102
,
Çmes
[102],
”rs
[102]

	)

1474 
	#POTFIT_THRMO_104
 
POTFIT_THRMO_103
,
Çmes
[103],
”rs
[103]

	)

1475 
	#POTFIT_THRMO_105
 
POTFIT_THRMO_104
,
Çmes
[104],
”rs
[104]

	)

1476 
	#POTFIT_THRMO_106
 
POTFIT_THRMO_105
,
Çmes
[105],
”rs
[105]

	)

1477 
	#POTFIT_THRMO_107
 
POTFIT_THRMO_106
,
Çmes
[106],
”rs
[106]

	)

1478 
	#POTFIT_THRMO_108
 
POTFIT_THRMO_107
,
Çmes
[107],
”rs
[107]

	)

1479 
	#POTFIT_THRMO_109
 
POTFIT_THRMO_108
,
Çmes
[108],
”rs
[108]

	)

1480 
	#POTFIT_THRMO_110
 
POTFIT_THRMO_109
,
Çmes
[109],
”rs
[109]

	)

1481 
	#POTFIT_THRMO_111
 
POTFIT_THRMO_110
,
Çmes
[110],
”rs
[110]

	)

1482 
	#POTFIT_THRMO_112
 
POTFIT_THRMO_111
,
Çmes
[111],
”rs
[111]

	)

1483 
	#POTFIT_THRMO_113
 
POTFIT_THRMO_112
,
Çmes
[112],
”rs
[112]

	)

1484 
	#POTFIT_THRMO_114
 
POTFIT_THRMO_113
,
Çmes
[113],
”rs
[113]

	)

1485 
	#POTFIT_THRMO_115
 
POTFIT_THRMO_114
,
Çmes
[114],
”rs
[114]

	)

1486 
	#POTFIT_THRMO_116
 
POTFIT_THRMO_115
,
Çmes
[115],
”rs
[115]

	)

1487 
	#POTFIT_THRMO_117
 
POTFIT_THRMO_116
,
Çmes
[116],
”rs
[116]

	)

1488 
	#POTFIT_THRMO_118
 
POTFIT_THRMO_117
,
Çmes
[117],
”rs
[117]

	)

1489 
	#POTFIT_THRMO_119
 
POTFIT_THRMO_118
,
Çmes
[118],
”rs
[118]

	)

1490 
	#POTFIT_THRMO_120
 
POTFIT_THRMO_119
,
Çmes
[119],
”rs
[119]

	)

1491 
	#POTFIT_THRMO_121
 
POTFIT_THRMO_120
,
Çmes
[120],
”rs
[120]

	)

1492 
	#POTFIT_THRMO_122
 
POTFIT_THRMO_121
,
Çmes
[121],
”rs
[121]

	)

1493 
	#POTFIT_THRMO_123
 
POTFIT_THRMO_122
,
Çmes
[122],
”rs
[122]

	)

1494 
	#POTFIT_THRMO_124
 
POTFIT_THRMO_123
,
Çmes
[123],
”rs
[123]

	)

1495 
	#POTFIT_THRMO_125
 
POTFIT_THRMO_124
,
Çmes
[124],
”rs
[124]

	)

1496 
	#POTFIT_THRMO_126
 
POTFIT_THRMO_125
,
Çmes
[125],
”rs
[125]

	)

1497 
	#POTFIT_THRMO_127
 
POTFIT_THRMO_126
,
Çmes
[126],
”rs
[126]

	)

1498 
	#POTFIT_THRMO_128
 
POTFIT_THRMO_127
,
Çmes
[127],
”rs
[127]

	)

1499 
	#POTFIT_THRMO_129
 
POTFIT_THRMO_128
,
Çmes
[128],
”rs
[128]

	)

1500 
	#POTFIT_THRMO_130
 
POTFIT_THRMO_129
,
Çmes
[129],
”rs
[129]

	)

1501 
	#POTFIT_THRMO_131
 
POTFIT_THRMO_130
,
Çmes
[130],
”rs
[130]

	)

1502 
	#POTFIT_THRMO_132
 
POTFIT_THRMO_131
,
Çmes
[131],
”rs
[131]

	)

1503 
	#POTFIT_THRMO_133
 
POTFIT_THRMO_132
,
Çmes
[132],
”rs
[132]

	)

1504 
	#POTFIT_THRMO_134
 
POTFIT_THRMO_133
,
Çmes
[133],
”rs
[133]

	)

1505 
	#POTFIT_THRMO_135
 
POTFIT_THRMO_134
,
Çmes
[134],
”rs
[134]

	)

1506 
	#POTFIT_THRMO_136
 
POTFIT_THRMO_135
,
Çmes
[135],
”rs
[135]

	)

1507 
	#POTFIT_THRMO_137
 
POTFIT_THRMO_136
,
Çmes
[136],
”rs
[136]

	)

1508 
	#POTFIT_THRMO_138
 
POTFIT_THRMO_137
,
Çmes
[137],
”rs
[137]

	)

1509 
	#POTFIT_THRMO_139
 
POTFIT_THRMO_138
,
Çmes
[138],
”rs
[138]

	)

1510 
	#POTFIT_THRMO_140
 
POTFIT_THRMO_139
,
Çmes
[139],
”rs
[139]

	)

1511 
	#POTFIT_THRMO_141
 
POTFIT_THRMO_140
,
Çmes
[140],
”rs
[140]

	)

1512 
	#POTFIT_THRMO_142
 
POTFIT_THRMO_141
,
Çmes
[141],
”rs
[141]

	)

1513 
	#POTFIT_THRMO_143
 
POTFIT_THRMO_142
,
Çmes
[142],
”rs
[142]

	)

1514 
	#POTFIT_THRMO_144
 
POTFIT_THRMO_143
,
Çmes
[143],
”rs
[143]

	)

1515 
	#POTFIT_THRMO_145
 
POTFIT_THRMO_144
,
Çmes
[144],
”rs
[144]

	)

1516 
	#POTFIT_THRMO_146
 
POTFIT_THRMO_145
,
Çmes
[145],
”rs
[145]

	)

1517 
	#POTFIT_THRMO_147
 
POTFIT_THRMO_146
,
Çmes
[146],
”rs
[146]

	)

1518 
	#POTFIT_THRMO_148
 
POTFIT_THRMO_147
,
Çmes
[147],
”rs
[147]

	)

1519 
	#POTFIT_THRMO_149
 
POTFIT_THRMO_148
,
Çmes
[148],
”rs
[148]

	)

1520 
	#POTFIT_THRMO_150
 
POTFIT_THRMO_149
,
Çmes
[149],
”rs
[149]

	)

1521 
	#POTFIT_THRMO_151
 
POTFIT_THRMO_150
,
Çmes
[150],
”rs
[150]

	)

1522 
	#POTFIT_THRMO_152
 
POTFIT_THRMO_151
,
Çmes
[151],
”rs
[151]

	)

1523 
	#POTFIT_THRMO_153
 
POTFIT_THRMO_152
,
Çmes
[152],
”rs
[152]

	)

1524 
	#POTFIT_THRMO_154
 
POTFIT_THRMO_153
,
Çmes
[153],
”rs
[153]

	)

1525 
	#POTFIT_THRMO_155
 
POTFIT_THRMO_154
,
Çmes
[154],
”rs
[154]

	)

1526 
	#POTFIT_THRMO_156
 
POTFIT_THRMO_155
,
Çmes
[155],
”rs
[155]

	)

1527 
	#POTFIT_THRMO_157
 
POTFIT_THRMO_156
,
Çmes
[156],
”rs
[156]

	)

1528 
	#POTFIT_THRMO_158
 
POTFIT_THRMO_157
,
Çmes
[157],
”rs
[157]

	)

1529 
	#POTFIT_THRMO_159
 
POTFIT_THRMO_158
,
Çmes
[158],
”rs
[158]

	)

1530 
	#POTFIT_THRMO_160
 
POTFIT_THRMO_159
,
Çmes
[159],
”rs
[159]

	)

1531 
	#POTFIT_THRMO_161
 
POTFIT_THRMO_160
,
Çmes
[160],
”rs
[160]

	)

1532 
	#POTFIT_THRMO_162
 
POTFIT_THRMO_161
,
Çmes
[161],
”rs
[161]

	)

1533 
	#POTFIT_THRMO_163
 
POTFIT_THRMO_162
,
Çmes
[162],
”rs
[162]

	)

1534 
	#POTFIT_THRMO_164
 
POTFIT_THRMO_163
,
Çmes
[163],
”rs
[163]

	)

1535 
	#POTFIT_THRMO_165
 
POTFIT_THRMO_164
,
Çmes
[164],
”rs
[164]

	)

1536 
	#POTFIT_THRMO_166
 
POTFIT_THRMO_165
,
Çmes
[165],
”rs
[165]

	)

1537 
	#POTFIT_THRMO_167
 
POTFIT_THRMO_166
,
Çmes
[166],
”rs
[166]

	)

1538 
	#POTFIT_THRMO_168
 
POTFIT_THRMO_167
,
Çmes
[167],
”rs
[167]

	)

1539 
	#POTFIT_THRMO_169
 
POTFIT_THRMO_168
,
Çmes
[168],
”rs
[168]

	)

1540 
	#POTFIT_THRMO_170
 
POTFIT_THRMO_169
,
Çmes
[169],
”rs
[169]

	)

1541 
	#POTFIT_THRMO_171
 
POTFIT_THRMO_170
,
Çmes
[170],
”rs
[170]

	)

1542 
	#POTFIT_THRMO_172
 
POTFIT_THRMO_171
,
Çmes
[171],
”rs
[171]

	)

1543 
	#POTFIT_THRMO_173
 
POTFIT_THRMO_172
,
Çmes
[172],
”rs
[172]

	)

1544 
	#POTFIT_THRMO_174
 
POTFIT_THRMO_173
,
Çmes
[173],
”rs
[173]

	)

1545 
	#POTFIT_THRMO_175
 
POTFIT_THRMO_174
,
Çmes
[174],
”rs
[174]

	)

1546 
	#POTFIT_THRMO_176
 
POTFIT_THRMO_175
,
Çmes
[175],
”rs
[175]

	)

1547 
	#POTFIT_THRMO_177
 
POTFIT_THRMO_176
,
Çmes
[176],
”rs
[176]

	)

1548 
	#POTFIT_THRMO_178
 
POTFIT_THRMO_177
,
Çmes
[177],
”rs
[177]

	)

1549 
	#POTFIT_THRMO_179
 
POTFIT_THRMO_178
,
Çmes
[178],
”rs
[178]

	)

1550 
	#POTFIT_THRMO_180
 
POTFIT_THRMO_179
,
Çmes
[179],
”rs
[179]

	)

1551 
	#POTFIT_THRMO_181
 
POTFIT_THRMO_180
,
Çmes
[180],
”rs
[180]

	)

1552 
	#POTFIT_THRMO_182
 
POTFIT_THRMO_181
,
Çmes
[181],
”rs
[181]

	)

1553 
	#POTFIT_THRMO_183
 
POTFIT_THRMO_182
,
Çmes
[182],
”rs
[182]

	)

1554 
	#POTFIT_THRMO_184
 
POTFIT_THRMO_183
,
Çmes
[183],
”rs
[183]

	)

1555 
	#POTFIT_THRMO_185
 
POTFIT_THRMO_184
,
Çmes
[184],
”rs
[184]

	)

1556 
	#POTFIT_THRMO_186
 
POTFIT_THRMO_185
,
Çmes
[185],
”rs
[185]

	)

1557 
	#POTFIT_THRMO_187
 
POTFIT_THRMO_186
,
Çmes
[186],
”rs
[186]

	)

1558 
	#POTFIT_THRMO_188
 
POTFIT_THRMO_187
,
Çmes
[187],
”rs
[187]

	)

1559 
	#POTFIT_THRMO_189
 
POTFIT_THRMO_188
,
Çmes
[188],
”rs
[188]

	)

1560 
	#POTFIT_THRMO_190
 
POTFIT_THRMO_189
,
Çmes
[189],
”rs
[189]

	)

1561 
	#POTFIT_THRMO_191
 
POTFIT_THRMO_190
,
Çmes
[190],
”rs
[190]

	)

1562 
	#POTFIT_THRMO_192
 
POTFIT_THRMO_191
,
Çmes
[191],
”rs
[191]

	)

1563 
	#POTFIT_THRMO_193
 
POTFIT_THRMO_192
,
Çmes
[192],
”rs
[192]

	)

1564 
	#POTFIT_THRMO_194
 
POTFIT_THRMO_193
,
Çmes
[193],
”rs
[193]

	)

1565 
	#POTFIT_THRMO_195
 
POTFIT_THRMO_194
,
Çmes
[194],
”rs
[194]

	)

1566 
	#POTFIT_THRMO_196
 
POTFIT_THRMO_195
,
Çmes
[195],
”rs
[195]

	)

1567 
	#POTFIT_THRMO_197
 
POTFIT_THRMO_196
,
Çmes
[196],
”rs
[196]

	)

1568 
	#POTFIT_THRMO_198
 
POTFIT_THRMO_197
,
Çmes
[197],
”rs
[197]

	)

1569 
	#POTFIT_THRMO_199
 
POTFIT_THRMO_198
,
Çmes
[198],
”rs
[198]

	)

1570 
	#POTFIT_THRMO_200
 
POTFIT_THRMO_199
,
Çmes
[199],
”rs
[199]

	)

1571 
	#POTFIT_THRMO_201
 
POTFIT_THRMO_200
,
Çmes
[200],
”rs
[200]

	)

1572 
	#POTFIT_THRMO_202
 
POTFIT_THRMO_201
,
Çmes
[201],
”rs
[201]

	)

1573 
	#POTFIT_THRMO_203
 
POTFIT_THRMO_202
,
Çmes
[202],
”rs
[202]

	)

1574 
	#POTFIT_THRMO_204
 
POTFIT_THRMO_203
,
Çmes
[203],
”rs
[203]

	)

1575 
	#POTFIT_THRMO_205
 
POTFIT_THRMO_204
,
Çmes
[204],
”rs
[204]

	)

1576 
	#POTFIT_THRMO_206
 
POTFIT_THRMO_205
,
Çmes
[205],
”rs
[205]

	)

1577 
	#POTFIT_THRMO_207
 
POTFIT_THRMO_206
,
Çmes
[206],
”rs
[206]

	)

1578 
	#POTFIT_THRMO_208
 
POTFIT_THRMO_207
,
Çmes
[207],
”rs
[207]

	)

1579 
	#POTFIT_THRMO_209
 
POTFIT_THRMO_208
,
Çmes
[208],
”rs
[208]

	)

1580 
	#POTFIT_THRMO_210
 
POTFIT_THRMO_209
,
Çmes
[209],
”rs
[209]

	)

1581 
	#POTFIT_THRMO_211
 
POTFIT_THRMO_210
,
Çmes
[210],
”rs
[210]

	)

1582 
	#POTFIT_THRMO_212
 
POTFIT_THRMO_211
,
Çmes
[211],
”rs
[211]

	)

1583 
	#POTFIT_THRMO_213
 
POTFIT_THRMO_212
,
Çmes
[212],
”rs
[212]

	)

1584 
	#POTFIT_THRMO_214
 
POTFIT_THRMO_213
,
Çmes
[213],
”rs
[213]

	)

1585 
	#POTFIT_THRMO_215
 
POTFIT_THRMO_214
,
Çmes
[214],
”rs
[214]

	)

1586 
	#POTFIT_THRMO_216
 
POTFIT_THRMO_215
,
Çmes
[215],
”rs
[215]

	)

1587 
	#POTFIT_THRMO_217
 
POTFIT_THRMO_216
,
Çmes
[216],
”rs
[216]

	)

1588 
	#POTFIT_THRMO_218
 
POTFIT_THRMO_217
,
Çmes
[217],
”rs
[217]

	)

1589 
	#POTFIT_THRMO_219
 
POTFIT_THRMO_218
,
Çmes
[218],
”rs
[218]

	)

1590 
	#POTFIT_THRMO_220
 
POTFIT_THRMO_219
,
Çmes
[219],
”rs
[219]

	)

1591 
	#POTFIT_THRMO_221
 
POTFIT_THRMO_220
,
Çmes
[220],
”rs
[220]

	)

1592 
	#POTFIT_THRMO_222
 
POTFIT_THRMO_221
,
Çmes
[221],
”rs
[221]

	)

1593 
	#POTFIT_THRMO_223
 
POTFIT_THRMO_222
,
Çmes
[222],
”rs
[222]

	)

1594 
	#POTFIT_THRMO_224
 
POTFIT_THRMO_223
,
Çmes
[223],
”rs
[223]

	)

1595 
	#POTFIT_THRMO_225
 
POTFIT_THRMO_224
,
Çmes
[224],
”rs
[224]

	)

1596 
	#POTFIT_THRMO_226
 
POTFIT_THRMO_225
,
Çmes
[225],
”rs
[225]

	)

1597 
	#POTFIT_THRMO_227
 
POTFIT_THRMO_226
,
Çmes
[226],
”rs
[226]

	)

1598 
	#POTFIT_THRMO_228
 
POTFIT_THRMO_227
,
Çmes
[227],
”rs
[227]

	)

1599 
	#POTFIT_THRMO_229
 
POTFIT_THRMO_228
,
Çmes
[228],
”rs
[228]

	)

1600 
	#POTFIT_THRMO_230
 
POTFIT_THRMO_229
,
Çmes
[229],
”rs
[229]

	)

1601 
	#POTFIT_THRMO_231
 
POTFIT_THRMO_230
,
Çmes
[230],
”rs
[230]

	)

1602 
	#POTFIT_THRMO_232
 
POTFIT_THRMO_231
,
Çmes
[231],
”rs
[231]

	)

1603 
	#POTFIT_THRMO_233
 
POTFIT_THRMO_232
,
Çmes
[232],
”rs
[232]

	)

1604 
	#POTFIT_THRMO_234
 
POTFIT_THRMO_233
,
Çmes
[233],
”rs
[233]

	)

1605 
	#POTFIT_THRMO_235
 
POTFIT_THRMO_234
,
Çmes
[234],
”rs
[234]

	)

1606 
	#POTFIT_THRMO_236
 
POTFIT_THRMO_235
,
Çmes
[235],
”rs
[235]

	)

1607 
	#POTFIT_THRMO_237
 
POTFIT_THRMO_236
,
Çmes
[236],
”rs
[236]

	)

1608 
	#POTFIT_THRMO_238
 
POTFIT_THRMO_237
,
Çmes
[237],
”rs
[237]

	)

1609 
	#POTFIT_THRMO_239
 
POTFIT_THRMO_238
,
Çmes
[238],
”rs
[238]

	)

1610 
	#POTFIT_THRMO_240
 
POTFIT_THRMO_239
,
Çmes
[239],
”rs
[239]

	)

1611 
	#POTFIT_THRMO_241
 
POTFIT_THRMO_240
,
Çmes
[240],
”rs
[240]

	)

1612 
	#POTFIT_THRMO_242
 
POTFIT_THRMO_241
,
Çmes
[241],
”rs
[241]

	)

1613 
	#POTFIT_THRMO_243
 
POTFIT_THRMO_242
,
Çmes
[242],
”rs
[242]

	)

1614 
	#POTFIT_THRMO_244
 
POTFIT_THRMO_243
,
Çmes
[243],
”rs
[243]

	)

1615 
	#POTFIT_THRMO_245
 
POTFIT_THRMO_244
,
Çmes
[244],
”rs
[244]

	)

1616 
	#POTFIT_THRMO_246
 
POTFIT_THRMO_245
,
Çmes
[245],
”rs
[245]

	)

1617 
	#POTFIT_THRMO_247
 
POTFIT_THRMO_246
,
Çmes
[246],
”rs
[246]

	)

1618 
	#POTFIT_THRMO_248
 
POTFIT_THRMO_247
,
Çmes
[247],
”rs
[247]

	)

1619 
	#POTFIT_THRMO_249
 
POTFIT_THRMO_248
,
Çmes
[248],
”rs
[248]

	)

1620 
	#POTFIT_THRMO_250
 
POTFIT_THRMO_249
,
Çmes
[249],
”rs
[249]

	)

1621 
	#POTFIT_THRMO_251
 
POTFIT_THRMO_250
,
Çmes
[250],
”rs
[250]

	)

1622 
	#POTFIT_THRMO_252
 
POTFIT_THRMO_251
,
Çmes
[251],
”rs
[251]

	)

1623 
	#POTFIT_THRMO_253
 
POTFIT_THRMO_252
,
Çmes
[252],
”rs
[252]

	)

1624 
	#POTFIT_THRMO_254
 
POTFIT_THRMO_253
,
Çmes
[253],
”rs
[253]

	)

1625 
	#POTFIT_THRMO_255
 
POTFIT_THRMO_254
,
Çmes
[254],
”rs
[254]

	)

1626 
	#POTFIT_THRMO_256
 
POTFIT_THRMO_255
,
Çmes
[255],
”rs
[255]

	)

1627 
	#RET_POTFIT_THRMO_0
 if(
ncÚfigs
==0è 
	`Th”moDyÇmics
(
POTFIT_THRMO_0
); 
RET_POTFIT_THRMO_1


	)

1628 
	#RET_POTFIT_THRMO_1
 if(
ncÚfigs
==1è 
	`Th”moDyÇmics
(
POTFIT_THRMO_1
); 
RET_POTFIT_THRMO_2


	)

1629 
	#RET_POTFIT_THRMO_2
 if(
ncÚfigs
==2è 
	`Th”moDyÇmics
(
POTFIT_THRMO_2
); 
RET_POTFIT_THRMO_3


	)

1630 
	#RET_POTFIT_THRMO_3
 if(
ncÚfigs
==3è 
	`Th”moDyÇmics
(
POTFIT_THRMO_3
); 
RET_POTFIT_THRMO_4


	)

1631 
	#RET_POTFIT_THRMO_4
 if(
ncÚfigs
==4è 
	`Th”moDyÇmics
(
POTFIT_THRMO_4
); 
RET_POTFIT_THRMO_5


	)

1632 
	#RET_POTFIT_THRMO_5
 if(
ncÚfigs
==5è 
	`Th”moDyÇmics
(
POTFIT_THRMO_5
); 
RET_POTFIT_THRMO_6


	)

1633 
	#RET_POTFIT_THRMO_6
 if(
ncÚfigs
==6è 
	`Th”moDyÇmics
(
POTFIT_THRMO_6
); 
RET_POTFIT_THRMO_7


	)

1634 
	#RET_POTFIT_THRMO_7
 if(
ncÚfigs
==7è 
	`Th”moDyÇmics
(
POTFIT_THRMO_7
); 
RET_POTFIT_THRMO_8


	)

1635 
	#RET_POTFIT_THRMO_8
 if(
ncÚfigs
==8è 
	`Th”moDyÇmics
(
POTFIT_THRMO_8
); 
RET_POTFIT_THRMO_9


	)

1636 
	#RET_POTFIT_THRMO_9
 if(
ncÚfigs
==9è 
	`Th”moDyÇmics
(
POTFIT_THRMO_9
); 
RET_POTFIT_THRMO_10


	)

1637 
	#RET_POTFIT_THRMO_10
 if(
ncÚfigs
==10è 
	`Th”moDyÇmics
(
POTFIT_THRMO_10
); 
RET_POTFIT_THRMO_11


	)

1638 
	#RET_POTFIT_THRMO_11
 if(
ncÚfigs
==11è 
	`Th”moDyÇmics
(
POTFIT_THRMO_11
); 
RET_POTFIT_THRMO_12


	)

1639 
	#RET_POTFIT_THRMO_12
 if(
ncÚfigs
==12è 
	`Th”moDyÇmics
(
POTFIT_THRMO_12
); 
RET_POTFIT_THRMO_13


	)

1640 
	#RET_POTFIT_THRMO_13
 if(
ncÚfigs
==13è 
	`Th”moDyÇmics
(
POTFIT_THRMO_13
); 
RET_POTFIT_THRMO_14


	)

1641 
	#RET_POTFIT_THRMO_14
 if(
ncÚfigs
==14è 
	`Th”moDyÇmics
(
POTFIT_THRMO_14
); 
RET_POTFIT_THRMO_15


	)

1642 
	#RET_POTFIT_THRMO_15
 if(
ncÚfigs
==15è 
	`Th”moDyÇmics
(
POTFIT_THRMO_15
); 
RET_POTFIT_THRMO_16


	)

1643 
	#RET_POTFIT_THRMO_16
 if(
ncÚfigs
==16è 
	`Th”moDyÇmics
(
POTFIT_THRMO_16
); 
RET_POTFIT_THRMO_17


	)

1644 
	#RET_POTFIT_THRMO_17
 if(
ncÚfigs
==17è 
	`Th”moDyÇmics
(
POTFIT_THRMO_17
); 
RET_POTFIT_THRMO_18


	)

1645 
	#RET_POTFIT_THRMO_18
 if(
ncÚfigs
==18è 
	`Th”moDyÇmics
(
POTFIT_THRMO_18
); 
RET_POTFIT_THRMO_19


	)

1646 
	#RET_POTFIT_THRMO_19
 if(
ncÚfigs
==19è 
	`Th”moDyÇmics
(
POTFIT_THRMO_19
); 
RET_POTFIT_THRMO_20


	)

1647 
	#RET_POTFIT_THRMO_20
 if(
ncÚfigs
==20è 
	`Th”moDyÇmics
(
POTFIT_THRMO_20
); 
RET_POTFIT_THRMO_21


	)

1648 
	#RET_POTFIT_THRMO_21
 if(
ncÚfigs
==21è 
	`Th”moDyÇmics
(
POTFIT_THRMO_21
); 
RET_POTFIT_THRMO_22


	)

1649 
	#RET_POTFIT_THRMO_22
 if(
ncÚfigs
==22è 
	`Th”moDyÇmics
(
POTFIT_THRMO_22
); 
RET_POTFIT_THRMO_23


	)

1650 
	#RET_POTFIT_THRMO_23
 if(
ncÚfigs
==23è 
	`Th”moDyÇmics
(
POTFIT_THRMO_23
); 
RET_POTFIT_THRMO_24


	)

1651 
	#RET_POTFIT_THRMO_24
 if(
ncÚfigs
==24è 
	`Th”moDyÇmics
(
POTFIT_THRMO_24
); 
RET_POTFIT_THRMO_25


	)

1652 
	#RET_POTFIT_THRMO_25
 if(
ncÚfigs
==25è 
	`Th”moDyÇmics
(
POTFIT_THRMO_25
); 
RET_POTFIT_THRMO_26


	)

1653 
	#RET_POTFIT_THRMO_26
 if(
ncÚfigs
==26è 
	`Th”moDyÇmics
(
POTFIT_THRMO_26
); 
RET_POTFIT_THRMO_27


	)

1654 
	#RET_POTFIT_THRMO_27
 if(
ncÚfigs
==27è 
	`Th”moDyÇmics
(
POTFIT_THRMO_27
); 
RET_POTFIT_THRMO_28


	)

1655 
	#RET_POTFIT_THRMO_28
 if(
ncÚfigs
==28è 
	`Th”moDyÇmics
(
POTFIT_THRMO_28
); 
RET_POTFIT_THRMO_29


	)

1656 
	#RET_POTFIT_THRMO_29
 if(
ncÚfigs
==29è 
	`Th”moDyÇmics
(
POTFIT_THRMO_29
); 
RET_POTFIT_THRMO_30


	)

1657 
	#RET_POTFIT_THRMO_30
 if(
ncÚfigs
==30è 
	`Th”moDyÇmics
(
POTFIT_THRMO_30
); 
RET_POTFIT_THRMO_31


	)

1658 
	#RET_POTFIT_THRMO_31
 if(
ncÚfigs
==31è 
	`Th”moDyÇmics
(
POTFIT_THRMO_31
); 
RET_POTFIT_THRMO_32


	)

1659 
	#RET_POTFIT_THRMO_32
 if(
ncÚfigs
==32è 
	`Th”moDyÇmics
(
POTFIT_THRMO_32
); 
RET_POTFIT_THRMO_33


	)

1660 
	#RET_POTFIT_THRMO_33
 if(
ncÚfigs
==33è 
	`Th”moDyÇmics
(
POTFIT_THRMO_33
); 
RET_POTFIT_THRMO_34


	)

1661 
	#RET_POTFIT_THRMO_34
 if(
ncÚfigs
==34è 
	`Th”moDyÇmics
(
POTFIT_THRMO_34
); 
RET_POTFIT_THRMO_35


	)

1662 
	#RET_POTFIT_THRMO_35
 if(
ncÚfigs
==35è 
	`Th”moDyÇmics
(
POTFIT_THRMO_35
); 
RET_POTFIT_THRMO_36


	)

1663 
	#RET_POTFIT_THRMO_36
 if(
ncÚfigs
==36è 
	`Th”moDyÇmics
(
POTFIT_THRMO_36
); 
RET_POTFIT_THRMO_37


	)

1664 
	#RET_POTFIT_THRMO_37
 if(
ncÚfigs
==37è 
	`Th”moDyÇmics
(
POTFIT_THRMO_37
); 
RET_POTFIT_THRMO_38


	)

1665 
	#RET_POTFIT_THRMO_38
 if(
ncÚfigs
==38è 
	`Th”moDyÇmics
(
POTFIT_THRMO_38
); 
RET_POTFIT_THRMO_39


	)

1666 
	#RET_POTFIT_THRMO_39
 if(
ncÚfigs
==39è 
	`Th”moDyÇmics
(
POTFIT_THRMO_39
); 
RET_POTFIT_THRMO_40


	)

1667 
	#RET_POTFIT_THRMO_40
 if(
ncÚfigs
==40è 
	`Th”moDyÇmics
(
POTFIT_THRMO_40
); 
RET_POTFIT_THRMO_41


	)

1668 
	#RET_POTFIT_THRMO_41
 if(
ncÚfigs
==41è 
	`Th”moDyÇmics
(
POTFIT_THRMO_41
); 
RET_POTFIT_THRMO_42


	)

1669 
	#RET_POTFIT_THRMO_42
 if(
ncÚfigs
==42è 
	`Th”moDyÇmics
(
POTFIT_THRMO_42
); 
RET_POTFIT_THRMO_43


	)

1670 
	#RET_POTFIT_THRMO_43
 if(
ncÚfigs
==43è 
	`Th”moDyÇmics
(
POTFIT_THRMO_43
); 
RET_POTFIT_THRMO_44


	)

1671 
	#RET_POTFIT_THRMO_44
 if(
ncÚfigs
==44è 
	`Th”moDyÇmics
(
POTFIT_THRMO_44
); 
RET_POTFIT_THRMO_45


	)

1672 
	#RET_POTFIT_THRMO_45
 if(
ncÚfigs
==45è 
	`Th”moDyÇmics
(
POTFIT_THRMO_45
); 
RET_POTFIT_THRMO_46


	)

1673 
	#RET_POTFIT_THRMO_46
 if(
ncÚfigs
==46è 
	`Th”moDyÇmics
(
POTFIT_THRMO_46
); 
RET_POTFIT_THRMO_47


	)

1674 
	#RET_POTFIT_THRMO_47
 if(
ncÚfigs
==47è 
	`Th”moDyÇmics
(
POTFIT_THRMO_47
); 
RET_POTFIT_THRMO_48


	)

1675 
	#RET_POTFIT_THRMO_48
 if(
ncÚfigs
==48è 
	`Th”moDyÇmics
(
POTFIT_THRMO_48
); 
RET_POTFIT_THRMO_49


	)

1676 
	#RET_POTFIT_THRMO_49
 if(
ncÚfigs
==49è 
	`Th”moDyÇmics
(
POTFIT_THRMO_49
); 
RET_POTFIT_THRMO_50


	)

1677 
	#RET_POTFIT_THRMO_50
 if(
ncÚfigs
==50è 
	`Th”moDyÇmics
(
POTFIT_THRMO_50
); 
RET_POTFIT_THRMO_51


	)

1678 
	#RET_POTFIT_THRMO_51
 if(
ncÚfigs
==51è 
	`Th”moDyÇmics
(
POTFIT_THRMO_51
); 
RET_POTFIT_THRMO_52


	)

1679 
	#RET_POTFIT_THRMO_52
 if(
ncÚfigs
==52è 
	`Th”moDyÇmics
(
POTFIT_THRMO_52
); 
RET_POTFIT_THRMO_53


	)

1680 
	#RET_POTFIT_THRMO_53
 if(
ncÚfigs
==53è 
	`Th”moDyÇmics
(
POTFIT_THRMO_53
); 
RET_POTFIT_THRMO_54


	)

1681 
	#RET_POTFIT_THRMO_54
 if(
ncÚfigs
==54è 
	`Th”moDyÇmics
(
POTFIT_THRMO_54
); 
RET_POTFIT_THRMO_55


	)

1682 
	#RET_POTFIT_THRMO_55
 if(
ncÚfigs
==55è 
	`Th”moDyÇmics
(
POTFIT_THRMO_55
); 
RET_POTFIT_THRMO_56


	)

1683 
	#RET_POTFIT_THRMO_56
 if(
ncÚfigs
==56è 
	`Th”moDyÇmics
(
POTFIT_THRMO_56
); 
RET_POTFIT_THRMO_57


	)

1684 
	#RET_POTFIT_THRMO_57
 if(
ncÚfigs
==57è 
	`Th”moDyÇmics
(
POTFIT_THRMO_57
); 
RET_POTFIT_THRMO_58


	)

1685 
	#RET_POTFIT_THRMO_58
 if(
ncÚfigs
==58è 
	`Th”moDyÇmics
(
POTFIT_THRMO_58
); 
RET_POTFIT_THRMO_59


	)

1686 
	#RET_POTFIT_THRMO_59
 if(
ncÚfigs
==59è 
	`Th”moDyÇmics
(
POTFIT_THRMO_59
); 
RET_POTFIT_THRMO_60


	)

1687 
	#RET_POTFIT_THRMO_60
 if(
ncÚfigs
==60è 
	`Th”moDyÇmics
(
POTFIT_THRMO_60
); 
RET_POTFIT_THRMO_61


	)

1688 
	#RET_POTFIT_THRMO_61
 if(
ncÚfigs
==61è 
	`Th”moDyÇmics
(
POTFIT_THRMO_61
); 
RET_POTFIT_THRMO_62


	)

1689 
	#RET_POTFIT_THRMO_62
 if(
ncÚfigs
==62è 
	`Th”moDyÇmics
(
POTFIT_THRMO_62
); 
RET_POTFIT_THRMO_63


	)

1690 
	#RET_POTFIT_THRMO_63
 if(
ncÚfigs
==63è 
	`Th”moDyÇmics
(
POTFIT_THRMO_63
); 
RET_POTFIT_THRMO_64


	)

1691 
	#RET_POTFIT_THRMO_64
 if(
ncÚfigs
==64è 
	`Th”moDyÇmics
(
POTFIT_THRMO_64
); 
RET_POTFIT_THRMO_65


	)

1692 
	#RET_POTFIT_THRMO_65
 if(
ncÚfigs
==65è 
	`Th”moDyÇmics
(
POTFIT_THRMO_65
); 
RET_POTFIT_THRMO_66


	)

1693 
	#RET_POTFIT_THRMO_66
 if(
ncÚfigs
==66è 
	`Th”moDyÇmics
(
POTFIT_THRMO_66
); 
RET_POTFIT_THRMO_67


	)

1694 
	#RET_POTFIT_THRMO_67
 if(
ncÚfigs
==67è 
	`Th”moDyÇmics
(
POTFIT_THRMO_67
); 
RET_POTFIT_THRMO_68


	)

1695 
	#RET_POTFIT_THRMO_68
 if(
ncÚfigs
==68è 
	`Th”moDyÇmics
(
POTFIT_THRMO_68
); 
RET_POTFIT_THRMO_69


	)

1696 
	#RET_POTFIT_THRMO_69
 if(
ncÚfigs
==69è 
	`Th”moDyÇmics
(
POTFIT_THRMO_69
); 
RET_POTFIT_THRMO_70


	)

1697 
	#RET_POTFIT_THRMO_70
 if(
ncÚfigs
==70è 
	`Th”moDyÇmics
(
POTFIT_THRMO_70
); 
RET_POTFIT_THRMO_71


	)

1698 
	#RET_POTFIT_THRMO_71
 if(
ncÚfigs
==71è 
	`Th”moDyÇmics
(
POTFIT_THRMO_71
); 
RET_POTFIT_THRMO_72


	)

1699 
	#RET_POTFIT_THRMO_72
 if(
ncÚfigs
==72è 
	`Th”moDyÇmics
(
POTFIT_THRMO_72
); 
RET_POTFIT_THRMO_73


	)

1700 
	#RET_POTFIT_THRMO_73
 if(
ncÚfigs
==73è 
	`Th”moDyÇmics
(
POTFIT_THRMO_73
); 
RET_POTFIT_THRMO_74


	)

1701 
	#RET_POTFIT_THRMO_74
 if(
ncÚfigs
==74è 
	`Th”moDyÇmics
(
POTFIT_THRMO_74
); 
RET_POTFIT_THRMO_75


	)

1702 
	#RET_POTFIT_THRMO_75
 if(
ncÚfigs
==75è 
	`Th”moDyÇmics
(
POTFIT_THRMO_75
); 
RET_POTFIT_THRMO_76


	)

1703 
	#RET_POTFIT_THRMO_76
 if(
ncÚfigs
==76è 
	`Th”moDyÇmics
(
POTFIT_THRMO_76
); 
RET_POTFIT_THRMO_77


	)

1704 
	#RET_POTFIT_THRMO_77
 if(
ncÚfigs
==77è 
	`Th”moDyÇmics
(
POTFIT_THRMO_77
); 
RET_POTFIT_THRMO_78


	)

1705 
	#RET_POTFIT_THRMO_78
 if(
ncÚfigs
==78è 
	`Th”moDyÇmics
(
POTFIT_THRMO_78
); 
RET_POTFIT_THRMO_79


	)

1706 
	#RET_POTFIT_THRMO_79
 if(
ncÚfigs
==79è 
	`Th”moDyÇmics
(
POTFIT_THRMO_79
); 
RET_POTFIT_THRMO_80


	)

1707 
	#RET_POTFIT_THRMO_80
 if(
ncÚfigs
==80è 
	`Th”moDyÇmics
(
POTFIT_THRMO_80
); 
RET_POTFIT_THRMO_81


	)

1708 
	#RET_POTFIT_THRMO_81
 if(
ncÚfigs
==81è 
	`Th”moDyÇmics
(
POTFIT_THRMO_81
); 
RET_POTFIT_THRMO_82


	)

1709 
	#RET_POTFIT_THRMO_82
 if(
ncÚfigs
==82è 
	`Th”moDyÇmics
(
POTFIT_THRMO_82
); 
RET_POTFIT_THRMO_83


	)

1710 
	#RET_POTFIT_THRMO_83
 if(
ncÚfigs
==83è 
	`Th”moDyÇmics
(
POTFIT_THRMO_83
); 
RET_POTFIT_THRMO_84


	)

1711 
	#RET_POTFIT_THRMO_84
 if(
ncÚfigs
==84è 
	`Th”moDyÇmics
(
POTFIT_THRMO_84
); 
RET_POTFIT_THRMO_85


	)

1712 
	#RET_POTFIT_THRMO_85
 if(
ncÚfigs
==85è 
	`Th”moDyÇmics
(
POTFIT_THRMO_85
); 
RET_POTFIT_THRMO_86


	)

1713 
	#RET_POTFIT_THRMO_86
 if(
ncÚfigs
==86è 
	`Th”moDyÇmics
(
POTFIT_THRMO_86
); 
RET_POTFIT_THRMO_87


	)

1714 
	#RET_POTFIT_THRMO_87
 if(
ncÚfigs
==87è 
	`Th”moDyÇmics
(
POTFIT_THRMO_87
); 
RET_POTFIT_THRMO_88


	)

1715 
	#RET_POTFIT_THRMO_88
 if(
ncÚfigs
==88è 
	`Th”moDyÇmics
(
POTFIT_THRMO_88
); 
RET_POTFIT_THRMO_89


	)

1716 
	#RET_POTFIT_THRMO_89
 if(
ncÚfigs
==89è 
	`Th”moDyÇmics
(
POTFIT_THRMO_89
); 
RET_POTFIT_THRMO_90


	)

1717 
	#RET_POTFIT_THRMO_90
 if(
ncÚfigs
==90è 
	`Th”moDyÇmics
(
POTFIT_THRMO_90
); 
RET_POTFIT_THRMO_91


	)

1718 
	#RET_POTFIT_THRMO_91
 if(
ncÚfigs
==91è 
	`Th”moDyÇmics
(
POTFIT_THRMO_91
); 
RET_POTFIT_THRMO_92


	)

1719 
	#RET_POTFIT_THRMO_92
 if(
ncÚfigs
==92è 
	`Th”moDyÇmics
(
POTFIT_THRMO_92
); 
RET_POTFIT_THRMO_93


	)

1720 
	#RET_POTFIT_THRMO_93
 if(
ncÚfigs
==93è 
	`Th”moDyÇmics
(
POTFIT_THRMO_93
); 
RET_POTFIT_THRMO_94


	)

1721 
	#RET_POTFIT_THRMO_94
 if(
ncÚfigs
==94è 
	`Th”moDyÇmics
(
POTFIT_THRMO_94
); 
RET_POTFIT_THRMO_95


	)

1722 
	#RET_POTFIT_THRMO_95
 if(
ncÚfigs
==95è 
	`Th”moDyÇmics
(
POTFIT_THRMO_95
); 
RET_POTFIT_THRMO_96


	)

1723 
	#RET_POTFIT_THRMO_96
 if(
ncÚfigs
==96è 
	`Th”moDyÇmics
(
POTFIT_THRMO_96
); 
RET_POTFIT_THRMO_97


	)

1724 
	#RET_POTFIT_THRMO_97
 if(
ncÚfigs
==97è 
	`Th”moDyÇmics
(
POTFIT_THRMO_97
); 
RET_POTFIT_THRMO_98


	)

1725 
	#RET_POTFIT_THRMO_98
 if(
ncÚfigs
==98è 
	`Th”moDyÇmics
(
POTFIT_THRMO_98
); 
RET_POTFIT_THRMO_99


	)

1726 
	#RET_POTFIT_THRMO_99
 if(
ncÚfigs
==99è 
	`Th”moDyÇmics
(
POTFIT_THRMO_99
); 
RET_POTFIT_THRMO_100


	)

1727 
	#RET_POTFIT_THRMO_100
 if(
ncÚfigs
==100è 
	`Th”moDyÇmics
(
POTFIT_THRMO_100
); 
RET_POTFIT_THRMO_101


	)

1728 
	#RET_POTFIT_THRMO_101
 if(
ncÚfigs
==101è 
	`Th”moDyÇmics
(
POTFIT_THRMO_101
); 
RET_POTFIT_THRMO_102


	)

1729 
	#RET_POTFIT_THRMO_102
 if(
ncÚfigs
==102è 
	`Th”moDyÇmics
(
POTFIT_THRMO_102
); 
RET_POTFIT_THRMO_103


	)

1730 
	#RET_POTFIT_THRMO_103
 if(
ncÚfigs
==103è 
	`Th”moDyÇmics
(
POTFIT_THRMO_103
); 
RET_POTFIT_THRMO_104


	)

1731 
	#RET_POTFIT_THRMO_104
 if(
ncÚfigs
==104è 
	`Th”moDyÇmics
(
POTFIT_THRMO_104
); 
RET_POTFIT_THRMO_105


	)

1732 
	#RET_POTFIT_THRMO_105
 if(
ncÚfigs
==105è 
	`Th”moDyÇmics
(
POTFIT_THRMO_105
); 
RET_POTFIT_THRMO_106


	)

1733 
	#RET_POTFIT_THRMO_106
 if(
ncÚfigs
==106è 
	`Th”moDyÇmics
(
POTFIT_THRMO_106
); 
RET_POTFIT_THRMO_107


	)

1734 
	#RET_POTFIT_THRMO_107
 if(
ncÚfigs
==107è 
	`Th”moDyÇmics
(
POTFIT_THRMO_107
); 
RET_POTFIT_THRMO_108


	)

1735 
	#RET_POTFIT_THRMO_108
 if(
ncÚfigs
==108è 
	`Th”moDyÇmics
(
POTFIT_THRMO_108
); 
RET_POTFIT_THRMO_109


	)

1736 
	#RET_POTFIT_THRMO_109
 if(
ncÚfigs
==109è 
	`Th”moDyÇmics
(
POTFIT_THRMO_109
); 
RET_POTFIT_THRMO_110


	)

1737 
	#RET_POTFIT_THRMO_110
 if(
ncÚfigs
==110è 
	`Th”moDyÇmics
(
POTFIT_THRMO_110
); 
RET_POTFIT_THRMO_111


	)

1738 
	#RET_POTFIT_THRMO_111
 if(
ncÚfigs
==111è 
	`Th”moDyÇmics
(
POTFIT_THRMO_111
); 
RET_POTFIT_THRMO_112


	)

1739 
	#RET_POTFIT_THRMO_112
 if(
ncÚfigs
==112è 
	`Th”moDyÇmics
(
POTFIT_THRMO_112
); 
RET_POTFIT_THRMO_113


	)

1740 
	#RET_POTFIT_THRMO_113
 if(
ncÚfigs
==113è 
	`Th”moDyÇmics
(
POTFIT_THRMO_113
); 
RET_POTFIT_THRMO_114


	)

1741 
	#RET_POTFIT_THRMO_114
 if(
ncÚfigs
==114è 
	`Th”moDyÇmics
(
POTFIT_THRMO_114
); 
RET_POTFIT_THRMO_115


	)

1742 
	#RET_POTFIT_THRMO_115
 if(
ncÚfigs
==115è 
	`Th”moDyÇmics
(
POTFIT_THRMO_115
); 
RET_POTFIT_THRMO_116


	)

1743 
	#RET_POTFIT_THRMO_116
 if(
ncÚfigs
==116è 
	`Th”moDyÇmics
(
POTFIT_THRMO_116
); 
RET_POTFIT_THRMO_117


	)

1744 
	#RET_POTFIT_THRMO_117
 if(
ncÚfigs
==117è 
	`Th”moDyÇmics
(
POTFIT_THRMO_117
); 
RET_POTFIT_THRMO_118


	)

1745 
	#RET_POTFIT_THRMO_118
 if(
ncÚfigs
==118è 
	`Th”moDyÇmics
(
POTFIT_THRMO_118
); 
RET_POTFIT_THRMO_119


	)

1746 
	#RET_POTFIT_THRMO_119
 if(
ncÚfigs
==119è 
	`Th”moDyÇmics
(
POTFIT_THRMO_119
); 
RET_POTFIT_THRMO_120


	)

1747 
	#RET_POTFIT_THRMO_120
 if(
ncÚfigs
==120è 
	`Th”moDyÇmics
(
POTFIT_THRMO_120
); 
RET_POTFIT_THRMO_121


	)

1748 
	#RET_POTFIT_THRMO_121
 if(
ncÚfigs
==121è 
	`Th”moDyÇmics
(
POTFIT_THRMO_121
); 
RET_POTFIT_THRMO_122


	)

1749 
	#RET_POTFIT_THRMO_122
 if(
ncÚfigs
==122è 
	`Th”moDyÇmics
(
POTFIT_THRMO_122
); 
RET_POTFIT_THRMO_123


	)

1750 
	#RET_POTFIT_THRMO_123
 if(
ncÚfigs
==123è 
	`Th”moDyÇmics
(
POTFIT_THRMO_123
); 
RET_POTFIT_THRMO_124


	)

1751 
	#RET_POTFIT_THRMO_124
 if(
ncÚfigs
==124è 
	`Th”moDyÇmics
(
POTFIT_THRMO_124
); 
RET_POTFIT_THRMO_125


	)

1752 
	#RET_POTFIT_THRMO_125
 if(
ncÚfigs
==125è 
	`Th”moDyÇmics
(
POTFIT_THRMO_125
); 
RET_POTFIT_THRMO_126


	)

1753 
	#RET_POTFIT_THRMO_126
 if(
ncÚfigs
==126è 
	`Th”moDyÇmics
(
POTFIT_THRMO_126
); 
RET_POTFIT_THRMO_127


	)

1754 
	#RET_POTFIT_THRMO_127
 if(
ncÚfigs
==127è 
	`Th”moDyÇmics
(
POTFIT_THRMO_127
); 
RET_POTFIT_THRMO_128


	)

1755 
	#RET_POTFIT_THRMO_128
 if(
ncÚfigs
==128è 
	`Th”moDyÇmics
(
POTFIT_THRMO_128
); 
RET_POTFIT_THRMO_129


	)

1756 
	#RET_POTFIT_THRMO_129
 if(
ncÚfigs
==129è 
	`Th”moDyÇmics
(
POTFIT_THRMO_129
); 
RET_POTFIT_THRMO_130


	)

1757 
	#RET_POTFIT_THRMO_130
 if(
ncÚfigs
==130è 
	`Th”moDyÇmics
(
POTFIT_THRMO_130
); 
RET_POTFIT_THRMO_131


	)

1758 
	#RET_POTFIT_THRMO_131
 if(
ncÚfigs
==131è 
	`Th”moDyÇmics
(
POTFIT_THRMO_131
); 
RET_POTFIT_THRMO_132


	)

1759 
	#RET_POTFIT_THRMO_132
 if(
ncÚfigs
==132è 
	`Th”moDyÇmics
(
POTFIT_THRMO_132
); 
RET_POTFIT_THRMO_133


	)

1760 
	#RET_POTFIT_THRMO_133
 if(
ncÚfigs
==133è 
	`Th”moDyÇmics
(
POTFIT_THRMO_133
); 
RET_POTFIT_THRMO_134


	)

1761 
	#RET_POTFIT_THRMO_134
 if(
ncÚfigs
==134è 
	`Th”moDyÇmics
(
POTFIT_THRMO_134
); 
RET_POTFIT_THRMO_135


	)

1762 
	#RET_POTFIT_THRMO_135
 if(
ncÚfigs
==135è 
	`Th”moDyÇmics
(
POTFIT_THRMO_135
); 
RET_POTFIT_THRMO_136


	)

1763 
	#RET_POTFIT_THRMO_136
 if(
ncÚfigs
==136è 
	`Th”moDyÇmics
(
POTFIT_THRMO_136
); 
RET_POTFIT_THRMO_137


	)

1764 
	#RET_POTFIT_THRMO_137
 if(
ncÚfigs
==137è 
	`Th”moDyÇmics
(
POTFIT_THRMO_137
); 
RET_POTFIT_THRMO_138


	)

1765 
	#RET_POTFIT_THRMO_138
 if(
ncÚfigs
==138è 
	`Th”moDyÇmics
(
POTFIT_THRMO_138
); 
RET_POTFIT_THRMO_139


	)

1766 
	#RET_POTFIT_THRMO_139
 if(
ncÚfigs
==139è 
	`Th”moDyÇmics
(
POTFIT_THRMO_139
); 
RET_POTFIT_THRMO_140


	)

1767 
	#RET_POTFIT_THRMO_140
 if(
ncÚfigs
==140è 
	`Th”moDyÇmics
(
POTFIT_THRMO_140
); 
RET_POTFIT_THRMO_141


	)

1768 
	#RET_POTFIT_THRMO_141
 if(
ncÚfigs
==141è 
	`Th”moDyÇmics
(
POTFIT_THRMO_141
); 
RET_POTFIT_THRMO_142


	)

1769 
	#RET_POTFIT_THRMO_142
 if(
ncÚfigs
==142è 
	`Th”moDyÇmics
(
POTFIT_THRMO_142
); 
RET_POTFIT_THRMO_143


	)

1770 
	#RET_POTFIT_THRMO_143
 if(
ncÚfigs
==143è 
	`Th”moDyÇmics
(
POTFIT_THRMO_143
); 
RET_POTFIT_THRMO_144


	)

1771 
	#RET_POTFIT_THRMO_144
 if(
ncÚfigs
==144è 
	`Th”moDyÇmics
(
POTFIT_THRMO_144
); 
RET_POTFIT_THRMO_145


	)

1772 
	#RET_POTFIT_THRMO_145
 if(
ncÚfigs
==145è 
	`Th”moDyÇmics
(
POTFIT_THRMO_145
); 
RET_POTFIT_THRMO_146


	)

1773 
	#RET_POTFIT_THRMO_146
 if(
ncÚfigs
==146è 
	`Th”moDyÇmics
(
POTFIT_THRMO_146
); 
RET_POTFIT_THRMO_147


	)

1774 
	#RET_POTFIT_THRMO_147
 if(
ncÚfigs
==147è 
	`Th”moDyÇmics
(
POTFIT_THRMO_147
); 
RET_POTFIT_THRMO_148


	)

1775 
	#RET_POTFIT_THRMO_148
 if(
ncÚfigs
==148è 
	`Th”moDyÇmics
(
POTFIT_THRMO_148
); 
RET_POTFIT_THRMO_149


	)

1776 
	#RET_POTFIT_THRMO_149
 if(
ncÚfigs
==149è 
	`Th”moDyÇmics
(
POTFIT_THRMO_149
); 
RET_POTFIT_THRMO_150


	)

1777 
	#RET_POTFIT_THRMO_150
 if(
ncÚfigs
==150è 
	`Th”moDyÇmics
(
POTFIT_THRMO_150
); 
RET_POTFIT_THRMO_151


	)

1778 
	#RET_POTFIT_THRMO_151
 if(
ncÚfigs
==151è 
	`Th”moDyÇmics
(
POTFIT_THRMO_151
); 
RET_POTFIT_THRMO_152


	)

1779 
	#RET_POTFIT_THRMO_152
 if(
ncÚfigs
==152è 
	`Th”moDyÇmics
(
POTFIT_THRMO_152
); 
RET_POTFIT_THRMO_153


	)

1780 
	#RET_POTFIT_THRMO_153
 if(
ncÚfigs
==153è 
	`Th”moDyÇmics
(
POTFIT_THRMO_153
); 
RET_POTFIT_THRMO_154


	)

1781 
	#RET_POTFIT_THRMO_154
 if(
ncÚfigs
==154è 
	`Th”moDyÇmics
(
POTFIT_THRMO_154
); 
RET_POTFIT_THRMO_155


	)

1782 
	#RET_POTFIT_THRMO_155
 if(
ncÚfigs
==155è 
	`Th”moDyÇmics
(
POTFIT_THRMO_155
); 
RET_POTFIT_THRMO_156


	)

1783 
	#RET_POTFIT_THRMO_156
 if(
ncÚfigs
==156è 
	`Th”moDyÇmics
(
POTFIT_THRMO_156
); 
RET_POTFIT_THRMO_157


	)

1784 
	#RET_POTFIT_THRMO_157
 if(
ncÚfigs
==157è 
	`Th”moDyÇmics
(
POTFIT_THRMO_157
); 
RET_POTFIT_THRMO_158


	)

1785 
	#RET_POTFIT_THRMO_158
 if(
ncÚfigs
==158è 
	`Th”moDyÇmics
(
POTFIT_THRMO_158
); 
RET_POTFIT_THRMO_159


	)

1786 
	#RET_POTFIT_THRMO_159
 if(
ncÚfigs
==159è 
	`Th”moDyÇmics
(
POTFIT_THRMO_159
); 
RET_POTFIT_THRMO_160


	)

1787 
	#RET_POTFIT_THRMO_160
 if(
ncÚfigs
==160è 
	`Th”moDyÇmics
(
POTFIT_THRMO_160
); 
RET_POTFIT_THRMO_161


	)

1788 
	#RET_POTFIT_THRMO_161
 if(
ncÚfigs
==161è 
	`Th”moDyÇmics
(
POTFIT_THRMO_161
); 
RET_POTFIT_THRMO_162


	)

1789 
	#RET_POTFIT_THRMO_162
 if(
ncÚfigs
==162è 
	`Th”moDyÇmics
(
POTFIT_THRMO_162
); 
RET_POTFIT_THRMO_163


	)

1790 
	#RET_POTFIT_THRMO_163
 if(
ncÚfigs
==163è 
	`Th”moDyÇmics
(
POTFIT_THRMO_163
); 
RET_POTFIT_THRMO_164


	)

1791 
	#RET_POTFIT_THRMO_164
 if(
ncÚfigs
==164è 
	`Th”moDyÇmics
(
POTFIT_THRMO_164
); 
RET_POTFIT_THRMO_165


	)

1792 
	#RET_POTFIT_THRMO_165
 if(
ncÚfigs
==165è 
	`Th”moDyÇmics
(
POTFIT_THRMO_165
); 
RET_POTFIT_THRMO_166


	)

1793 
	#RET_POTFIT_THRMO_166
 if(
ncÚfigs
==166è 
	`Th”moDyÇmics
(
POTFIT_THRMO_166
); 
RET_POTFIT_THRMO_167


	)

1794 
	#RET_POTFIT_THRMO_167
 if(
ncÚfigs
==167è 
	`Th”moDyÇmics
(
POTFIT_THRMO_167
); 
RET_POTFIT_THRMO_168


	)

1795 
	#RET_POTFIT_THRMO_168
 if(
ncÚfigs
==168è 
	`Th”moDyÇmics
(
POTFIT_THRMO_168
); 
RET_POTFIT_THRMO_169


	)

1796 
	#RET_POTFIT_THRMO_169
 if(
ncÚfigs
==169è 
	`Th”moDyÇmics
(
POTFIT_THRMO_169
); 
RET_POTFIT_THRMO_170


	)

1797 
	#RET_POTFIT_THRMO_170
 if(
ncÚfigs
==170è 
	`Th”moDyÇmics
(
POTFIT_THRMO_170
); 
RET_POTFIT_THRMO_171


	)

1798 
	#RET_POTFIT_THRMO_171
 if(
ncÚfigs
==171è 
	`Th”moDyÇmics
(
POTFIT_THRMO_171
); 
RET_POTFIT_THRMO_172


	)

1799 
	#RET_POTFIT_THRMO_172
 if(
ncÚfigs
==172è 
	`Th”moDyÇmics
(
POTFIT_THRMO_172
); 
RET_POTFIT_THRMO_173


	)

1800 
	#RET_POTFIT_THRMO_173
 if(
ncÚfigs
==173è 
	`Th”moDyÇmics
(
POTFIT_THRMO_173
); 
RET_POTFIT_THRMO_174


	)

1801 
	#RET_POTFIT_THRMO_174
 if(
ncÚfigs
==174è 
	`Th”moDyÇmics
(
POTFIT_THRMO_174
); 
RET_POTFIT_THRMO_175


	)

1802 
	#RET_POTFIT_THRMO_175
 if(
ncÚfigs
==175è 
	`Th”moDyÇmics
(
POTFIT_THRMO_175
); 
RET_POTFIT_THRMO_176


	)

1803 
	#RET_POTFIT_THRMO_176
 if(
ncÚfigs
==176è 
	`Th”moDyÇmics
(
POTFIT_THRMO_176
); 
RET_POTFIT_THRMO_177


	)

1804 
	#RET_POTFIT_THRMO_177
 if(
ncÚfigs
==177è 
	`Th”moDyÇmics
(
POTFIT_THRMO_177
); 
RET_POTFIT_THRMO_178


	)

1805 
	#RET_POTFIT_THRMO_178
 if(
ncÚfigs
==178è 
	`Th”moDyÇmics
(
POTFIT_THRMO_178
); 
RET_POTFIT_THRMO_179


	)

1806 
	#RET_POTFIT_THRMO_179
 if(
ncÚfigs
==179è 
	`Th”moDyÇmics
(
POTFIT_THRMO_179
); 
RET_POTFIT_THRMO_180


	)

1807 
	#RET_POTFIT_THRMO_180
 if(
ncÚfigs
==180è 
	`Th”moDyÇmics
(
POTFIT_THRMO_180
); 
RET_POTFIT_THRMO_181


	)

1808 
	#RET_POTFIT_THRMO_181
 if(
ncÚfigs
==181è 
	`Th”moDyÇmics
(
POTFIT_THRMO_181
); 
RET_POTFIT_THRMO_182


	)

1809 
	#RET_POTFIT_THRMO_182
 if(
ncÚfigs
==182è 
	`Th”moDyÇmics
(
POTFIT_THRMO_182
); 
RET_POTFIT_THRMO_183


	)

1810 
	#RET_POTFIT_THRMO_183
 if(
ncÚfigs
==183è 
	`Th”moDyÇmics
(
POTFIT_THRMO_183
); 
RET_POTFIT_THRMO_184


	)

1811 
	#RET_POTFIT_THRMO_184
 if(
ncÚfigs
==184è 
	`Th”moDyÇmics
(
POTFIT_THRMO_184
); 
RET_POTFIT_THRMO_185


	)

1812 
	#RET_POTFIT_THRMO_185
 if(
ncÚfigs
==185è 
	`Th”moDyÇmics
(
POTFIT_THRMO_185
); 
RET_POTFIT_THRMO_186


	)

1813 
	#RET_POTFIT_THRMO_186
 if(
ncÚfigs
==186è 
	`Th”moDyÇmics
(
POTFIT_THRMO_186
); 
RET_POTFIT_THRMO_187


	)

1814 
	#RET_POTFIT_THRMO_187
 if(
ncÚfigs
==187è 
	`Th”moDyÇmics
(
POTFIT_THRMO_187
); 
RET_POTFIT_THRMO_188


	)

1815 
	#RET_POTFIT_THRMO_188
 if(
ncÚfigs
==188è 
	`Th”moDyÇmics
(
POTFIT_THRMO_188
); 
RET_POTFIT_THRMO_189


	)

1816 
	#RET_POTFIT_THRMO_189
 if(
ncÚfigs
==189è 
	`Th”moDyÇmics
(
POTFIT_THRMO_189
); 
RET_POTFIT_THRMO_190


	)

1817 
	#RET_POTFIT_THRMO_190
 if(
ncÚfigs
==190è 
	`Th”moDyÇmics
(
POTFIT_THRMO_190
); 
RET_POTFIT_THRMO_191


	)

1818 
	#RET_POTFIT_THRMO_191
 if(
ncÚfigs
==191è 
	`Th”moDyÇmics
(
POTFIT_THRMO_191
); 
RET_POTFIT_THRMO_192


	)

1819 
	#RET_POTFIT_THRMO_192
 if(
ncÚfigs
==192è 
	`Th”moDyÇmics
(
POTFIT_THRMO_192
); 
RET_POTFIT_THRMO_193


	)

1820 
	#RET_POTFIT_THRMO_193
 if(
ncÚfigs
==193è 
	`Th”moDyÇmics
(
POTFIT_THRMO_193
); 
RET_POTFIT_THRMO_194


	)

1821 
	#RET_POTFIT_THRMO_194
 if(
ncÚfigs
==194è 
	`Th”moDyÇmics
(
POTFIT_THRMO_194
); 
RET_POTFIT_THRMO_195


	)

1822 
	#RET_POTFIT_THRMO_195
 if(
ncÚfigs
==195è 
	`Th”moDyÇmics
(
POTFIT_THRMO_195
); 
RET_POTFIT_THRMO_196


	)

1823 
	#RET_POTFIT_THRMO_196
 if(
ncÚfigs
==196è 
	`Th”moDyÇmics
(
POTFIT_THRMO_196
); 
RET_POTFIT_THRMO_197


	)

1824 
	#RET_POTFIT_THRMO_197
 if(
ncÚfigs
==197è 
	`Th”moDyÇmics
(
POTFIT_THRMO_197
); 
RET_POTFIT_THRMO_198


	)

1825 
	#RET_POTFIT_THRMO_198
 if(
ncÚfigs
==198è 
	`Th”moDyÇmics
(
POTFIT_THRMO_198
); 
RET_POTFIT_THRMO_199


	)

1826 
	#RET_POTFIT_THRMO_199
 if(
ncÚfigs
==199è 
	`Th”moDyÇmics
(
POTFIT_THRMO_199
); 
RET_POTFIT_THRMO_200


	)

1827 
	#RET_POTFIT_THRMO_200
 if(
ncÚfigs
==200è 
	`Th”moDyÇmics
(
POTFIT_THRMO_200
); 
RET_POTFIT_THRMO_201


	)

1828 
	#RET_POTFIT_THRMO_201
 if(
ncÚfigs
==201è 
	`Th”moDyÇmics
(
POTFIT_THRMO_201
); 
RET_POTFIT_THRMO_202


	)

1829 
	#RET_POTFIT_THRMO_202
 if(
ncÚfigs
==202è 
	`Th”moDyÇmics
(
POTFIT_THRMO_202
); 
RET_POTFIT_THRMO_203


	)

1830 
	#RET_POTFIT_THRMO_203
 if(
ncÚfigs
==203è 
	`Th”moDyÇmics
(
POTFIT_THRMO_203
); 
RET_POTFIT_THRMO_204


	)

1831 
	#RET_POTFIT_THRMO_204
 if(
ncÚfigs
==204è 
	`Th”moDyÇmics
(
POTFIT_THRMO_204
); 
RET_POTFIT_THRMO_205


	)

1832 
	#RET_POTFIT_THRMO_205
 if(
ncÚfigs
==205è 
	`Th”moDyÇmics
(
POTFIT_THRMO_205
); 
RET_POTFIT_THRMO_206


	)

1833 
	#RET_POTFIT_THRMO_206
 if(
ncÚfigs
==206è 
	`Th”moDyÇmics
(
POTFIT_THRMO_206
); 
RET_POTFIT_THRMO_207


	)

1834 
	#RET_POTFIT_THRMO_207
 if(
ncÚfigs
==207è 
	`Th”moDyÇmics
(
POTFIT_THRMO_207
); 
RET_POTFIT_THRMO_208


	)

1835 
	#RET_POTFIT_THRMO_208
 if(
ncÚfigs
==208è 
	`Th”moDyÇmics
(
POTFIT_THRMO_208
); 
RET_POTFIT_THRMO_209


	)

1836 
	#RET_POTFIT_THRMO_209
 if(
ncÚfigs
==209è 
	`Th”moDyÇmics
(
POTFIT_THRMO_209
); 
RET_POTFIT_THRMO_210


	)

1837 
	#RET_POTFIT_THRMO_210
 if(
ncÚfigs
==210è 
	`Th”moDyÇmics
(
POTFIT_THRMO_210
); 
RET_POTFIT_THRMO_211


	)

1838 
	#RET_POTFIT_THRMO_211
 if(
ncÚfigs
==211è 
	`Th”moDyÇmics
(
POTFIT_THRMO_211
); 
RET_POTFIT_THRMO_212


	)

1839 
	#RET_POTFIT_THRMO_212
 if(
ncÚfigs
==212è 
	`Th”moDyÇmics
(
POTFIT_THRMO_212
); 
RET_POTFIT_THRMO_213


	)

1840 
	#RET_POTFIT_THRMO_213
 if(
ncÚfigs
==213è 
	`Th”moDyÇmics
(
POTFIT_THRMO_213
); 
RET_POTFIT_THRMO_214


	)

1841 
	#RET_POTFIT_THRMO_214
 if(
ncÚfigs
==214è 
	`Th”moDyÇmics
(
POTFIT_THRMO_214
); 
RET_POTFIT_THRMO_215


	)

1842 
	#RET_POTFIT_THRMO_215
 if(
ncÚfigs
==215è 
	`Th”moDyÇmics
(
POTFIT_THRMO_215
); 
RET_POTFIT_THRMO_216


	)

1843 
	#RET_POTFIT_THRMO_216
 if(
ncÚfigs
==216è 
	`Th”moDyÇmics
(
POTFIT_THRMO_216
); 
RET_POTFIT_THRMO_217


	)

1844 
	#RET_POTFIT_THRMO_217
 if(
ncÚfigs
==217è 
	`Th”moDyÇmics
(
POTFIT_THRMO_217
); 
RET_POTFIT_THRMO_218


	)

1845 
	#RET_POTFIT_THRMO_218
 if(
ncÚfigs
==218è 
	`Th”moDyÇmics
(
POTFIT_THRMO_218
); 
RET_POTFIT_THRMO_219


	)

1846 
	#RET_POTFIT_THRMO_219
 if(
ncÚfigs
==219è 
	`Th”moDyÇmics
(
POTFIT_THRMO_219
); 
RET_POTFIT_THRMO_220


	)

1847 
	#RET_POTFIT_THRMO_220
 if(
ncÚfigs
==220è 
	`Th”moDyÇmics
(
POTFIT_THRMO_220
); 
RET_POTFIT_THRMO_221


	)

1848 
	#RET_POTFIT_THRMO_221
 if(
ncÚfigs
==221è 
	`Th”moDyÇmics
(
POTFIT_THRMO_221
); 
RET_POTFIT_THRMO_222


	)

1849 
	#RET_POTFIT_THRMO_222
 if(
ncÚfigs
==222è 
	`Th”moDyÇmics
(
POTFIT_THRMO_222
); 
RET_POTFIT_THRMO_223


	)

1850 
	#RET_POTFIT_THRMO_223
 if(
ncÚfigs
==223è 
	`Th”moDyÇmics
(
POTFIT_THRMO_223
); 
RET_POTFIT_THRMO_224


	)

1851 
	#RET_POTFIT_THRMO_224
 if(
ncÚfigs
==224è 
	`Th”moDyÇmics
(
POTFIT_THRMO_224
); 
RET_POTFIT_THRMO_225


	)

1852 
	#RET_POTFIT_THRMO_225
 if(
ncÚfigs
==225è 
	`Th”moDyÇmics
(
POTFIT_THRMO_225
); 
RET_POTFIT_THRMO_226


	)

1853 
	#RET_POTFIT_THRMO_226
 if(
ncÚfigs
==226è 
	`Th”moDyÇmics
(
POTFIT_THRMO_226
); 
RET_POTFIT_THRMO_227


	)

1854 
	#RET_POTFIT_THRMO_227
 if(
ncÚfigs
==227è 
	`Th”moDyÇmics
(
POTFIT_THRMO_227
); 
RET_POTFIT_THRMO_228


	)

1855 
	#RET_POTFIT_THRMO_228
 if(
ncÚfigs
==228è 
	`Th”moDyÇmics
(
POTFIT_THRMO_228
); 
RET_POTFIT_THRMO_229


	)

1856 
	#RET_POTFIT_THRMO_229
 if(
ncÚfigs
==229è 
	`Th”moDyÇmics
(
POTFIT_THRMO_229
); 
RET_POTFIT_THRMO_230


	)

1857 
	#RET_POTFIT_THRMO_230
 if(
ncÚfigs
==230è 
	`Th”moDyÇmics
(
POTFIT_THRMO_230
); 
RET_POTFIT_THRMO_231


	)

1858 
	#RET_POTFIT_THRMO_231
 if(
ncÚfigs
==231è 
	`Th”moDyÇmics
(
POTFIT_THRMO_231
); 
RET_POTFIT_THRMO_232


	)

1859 
	#RET_POTFIT_THRMO_232
 if(
ncÚfigs
==232è 
	`Th”moDyÇmics
(
POTFIT_THRMO_232
); 
RET_POTFIT_THRMO_233


	)

1860 
	#RET_POTFIT_THRMO_233
 if(
ncÚfigs
==233è 
	`Th”moDyÇmics
(
POTFIT_THRMO_233
); 
RET_POTFIT_THRMO_234


	)

1861 
	#RET_POTFIT_THRMO_234
 if(
ncÚfigs
==234è 
	`Th”moDyÇmics
(
POTFIT_THRMO_234
); 
RET_POTFIT_THRMO_235


	)

1862 
	#RET_POTFIT_THRMO_235
 if(
ncÚfigs
==235è 
	`Th”moDyÇmics
(
POTFIT_THRMO_235
); 
RET_POTFIT_THRMO_236


	)

1863 
	#RET_POTFIT_THRMO_236
 if(
ncÚfigs
==236è 
	`Th”moDyÇmics
(
POTFIT_THRMO_236
); 
RET_POTFIT_THRMO_237


	)

1864 
	#RET_POTFIT_THRMO_237
 if(
ncÚfigs
==237è 
	`Th”moDyÇmics
(
POTFIT_THRMO_237
); 
RET_POTFIT_THRMO_238


	)

1865 
	#RET_POTFIT_THRMO_238
 if(
ncÚfigs
==238è 
	`Th”moDyÇmics
(
POTFIT_THRMO_238
); 
RET_POTFIT_THRMO_239


	)

1866 
	#RET_POTFIT_THRMO_239
 if(
ncÚfigs
==239è 
	`Th”moDyÇmics
(
POTFIT_THRMO_239
); 
RET_POTFIT_THRMO_240


	)

1867 
	#RET_POTFIT_THRMO_240
 if(
ncÚfigs
==240è 
	`Th”moDyÇmics
(
POTFIT_THRMO_240
); 
RET_POTFIT_THRMO_241


	)

1868 
	#RET_POTFIT_THRMO_241
 if(
ncÚfigs
==241è 
	`Th”moDyÇmics
(
POTFIT_THRMO_241
); 
RET_POTFIT_THRMO_242


	)

1869 
	#RET_POTFIT_THRMO_242
 if(
ncÚfigs
==242è 
	`Th”moDyÇmics
(
POTFIT_THRMO_242
); 
RET_POTFIT_THRMO_243


	)

1870 
	#RET_POTFIT_THRMO_243
 if(
ncÚfigs
==243è 
	`Th”moDyÇmics
(
POTFIT_THRMO_243
); 
RET_POTFIT_THRMO_244


	)

1871 
	#RET_POTFIT_THRMO_244
 if(
ncÚfigs
==244è 
	`Th”moDyÇmics
(
POTFIT_THRMO_244
); 
RET_POTFIT_THRMO_245


	)

1872 
	#RET_POTFIT_THRMO_245
 if(
ncÚfigs
==245è 
	`Th”moDyÇmics
(
POTFIT_THRMO_245
); 
RET_POTFIT_THRMO_246


	)

1873 
	#RET_POTFIT_THRMO_246
 if(
ncÚfigs
==246è 
	`Th”moDyÇmics
(
POTFIT_THRMO_246
); 
RET_POTFIT_THRMO_247


	)

1874 
	#RET_POTFIT_THRMO_247
 if(
ncÚfigs
==247è 
	`Th”moDyÇmics
(
POTFIT_THRMO_247
); 
RET_POTFIT_THRMO_248


	)

1875 
	#RET_POTFIT_THRMO_248
 if(
ncÚfigs
==248è 
	`Th”moDyÇmics
(
POTFIT_THRMO_248
); 
RET_POTFIT_THRMO_249


	)

1876 
	#RET_POTFIT_THRMO_249
 if(
ncÚfigs
==249è 
	`Th”moDyÇmics
(
POTFIT_THRMO_249
); 
RET_POTFIT_THRMO_250


	)

1877 
	#RET_POTFIT_THRMO_250
 if(
ncÚfigs
==250è 
	`Th”moDyÇmics
(
POTFIT_THRMO_250
); 
RET_POTFIT_THRMO_251


	)

1878 
	#RET_POTFIT_THRMO_251
 if(
ncÚfigs
==251è 
	`Th”moDyÇmics
(
POTFIT_THRMO_251
); 
RET_POTFIT_THRMO_252


	)

1879 
	#RET_POTFIT_THRMO_252
 if(
ncÚfigs
==252è 
	`Th”moDyÇmics
(
POTFIT_THRMO_252
); 
RET_POTFIT_THRMO_253


	)

1880 
	#RET_POTFIT_THRMO_253
 if(
ncÚfigs
==253è 
	`Th”moDyÇmics
(
POTFIT_THRMO_253
); 
RET_POTFIT_THRMO_254


	)

1881 
	#RET_POTFIT_THRMO_254
 if(
ncÚfigs
==254è 
	`Th”moDyÇmics
(
POTFIT_THRMO_254
); 
RET_POTFIT_THRMO_255


	)

1882 
	#RET_POTFIT_THRMO_255
 if(
ncÚfigs
==255è 
	`Th”moDyÇmics
(
POTFIT_THRMO_255
); 
RET_POTFIT_THRMO_256


	)

1883 
	#RET_POTFIT_THRMO_256
  
	`Th”moDyÇmics
(
POTFIT_THRMO_256
);

	)

1884 
	#RET_POTFIT_THRMO
 
RET_POTFIT_THRMO_0


	)

	@macros.h

1 
	#MAXCHAR
 1024

	)

4 
	#MIN
(
A
,
B
è(A<B?A:B)

	)

5 
	#MAX
(
A
,
B
è(A>B?A:B)

	)

8 
	#COMP
(
™yp
,
jtyp
) ((ityp\

9 <
jtyp
)?(jtyp+1)*jtyp/2+
™yp
:(
i
\

10 
typ
+1)*
™yp
/2+
jtyp
)

	)

13 
	#GROW
(
A
,
Şdsize
,
Ãwsize
\

14 è
MemÜy
::
	`grow
(
A
,
Şdsize
,
Ãwsi
\

15 
ze
,#A,
__LINE__
,
__FILE__
,
__FUNC
\

16 
TION__
)

	)

18 
	#CREATE1D
(
A
,
d0
è
MemÜy
:\

19 :
	`ü—‹
(
A
,
d0
,#A,
__LINE__
,
__FIL
\

20 
E__
,
__FUNCTION__
)

	)

22 
	#CREATE2D
(
A
,
d0
,
d1
è
Memo
\

23 
ry
::
	`ü—‹_2d
(
A
,
d0
,
d1
,#A,
__LINE__
\

24 ,
__FILE__
,
__FUNCTION__
)

	)

26 
	#DEL_2D
(
A
è
MemÜy
::
	`d–_2d
(A)

	)

29 
	#V3ZERO
(
V
) (V[0]=0,V[1]\

30 =0,
V
[2]=0)

	)

32 
	#M3ZERO
(
A
) (A[0][0]=0,\

33 
A
[0][1]=0,A[0][2]=0,A[1][0]=0\

34 ,
A
[1][1]=0,A[1][2]=0,A[2][0]=\

35 0,
A
[2][1]=0,A[2][2]=0)

	)

37 
	#M3DET
(
A
) A[0][0]*A[1]\

38 [1]*
A
[2][2]+A[1][0]*A[2][1]*A\

39 [0][2]+
A
[2][0]*A[0][1]*A[1][2\

40 ]-
A
[0][2]*A[1][1]*A[2][0]-A[1\

41 ][2]*
A
[2][1]*A[0][0]-A[2][2]*A\

42 [0][1]*
A
[1][0]

	)

44 
	#M3EQV
(
A
,
B
) (B[0][0]=\

45 
A
[0][0],
B
[0][1]=A[0][1],B[0]\

46 [2]=
A
[0][2],
B
[1][0]=A[1][0],\

47 
B
[1][1]=
A
[1][1],B[1][2]=A[1]\

48 [2],
B
[2][0]=
A
[2][0],B[2][1]=\

49 
A
[2][1],
B
[2][2]=A[2][2])

	)

51 
	#M3INV_LT
(
A
,
B
)\

52 (
B
[0][0]=1.0/
A
[0][0],B[0][1]\

53 =0,
B
[0][2]=0,B[1][0]=-
A
[1][0\

54 ]/(
A
[0][0]*A[1][1]),
B
[1][1]=\

55 1.0/
A
[1][1],
B
[1][2]=0,B[2][0\

56 ]=(
A
[1][0]==0 || A[2][1]==0)\

57 ? (
A
[2][0]==0 ? 0 : (-A[1][1\

58 ]*
A
[2][0])/(A[0][0]*A[1][1]*\

59 
A
[2][2])) : (A[2][0]==0 ? (A\

60 [1][0]*
A
[2][1])/(A[0][0]*A[1\

61 ][1]*
A
[2][2]) :(A[1][0]*A[2]\

62 [1]-
A
[1][1]*A[2][0])/(A[0][0\

63 ]*
A
[1][1]*A[2][2])),
B
[2][1]=\

64 -
A
[2][1]/(A[1][1]*A[2][2]),
B
\

65 [2][2]=1.0/
A
[2][2])

	)

67 
	#M3MUL_LT
(
A
,
B
,\

68 
C
è(C[0][0]=
A
[0][0]*
B
[0][0],\

69 
C
[0][1]=0,C[0][2]=0,C[1][0]=\

70 
A
[1][0]*
B
[0][0]+A[1][1]*B[1]\

71 [0],
C
[1][1]=
A
[1][1]*
B
[1][1],\

72 
C
[1][2]=0,C[2][0]=
A
[2][0]*
B
[\

73 0][0]+
A
[2][1]*
B
[1][0]+A[2][2\

74 ]*
B
[2][0],
C
[2][1]=
A
[2][1]*B[\

75 1][1]+
A
[2][2]*
B
[2][1],
C
[2][2\

76 ]=
A
[2][2]*
B
[2][2])

	)

78 
	#M3MUL_LT_2_voigt
(
A
,
B
\

79 ,
c
è(c[0]=
A
[0][0]*
B
[0][0],c[\

80 1]=
A
[1][1]*
B
[1][1],
c
[2]=A[2]\

81 [2]*
B
[2][2],
c
[3]=
A
[2][1]*B[1\

82 ][1]+
A
[2][2]*
B
[2][1],
c
[4]=A[\

83 2][0]*
B
[0][0]+
A
[2][1]*B[1][0\

84 ]+
A
[2][2]*
B
[2][0],
c
[5]=A[1][\

85 0]*
B
[0][0]+
A
[1][1]*B[1][0])

	)

88 
	#M3V_LT
(
A
,
a
,
b
)\

89 (
b
[2]=
A
[2][0]*
a
[0]+A[2][1]*a\

90 [1]+
A
[2][2]*
a
[2],
b
[1]=A[1][0\

91 ]*
a
[0]+
A
[1][1]*a[1],
b
[0]=A[0\

92 ][0]*
a
[0])

	)

94 
	#V3M_LT
(
a
,
A
,
b
)\

95 (
b
[0]=
A
[0][0]*
a
[0]+A[1][0]*a\

96 [1]+
A
[2][0]*
a
[2],
b
[1]=A[1][1\

97 ]*
a
[1]+
A
[2][1]*a[2],
b
[2]=A[2\

98 ][2]*
a
[2])

	)

100 
	#M3V_UT
(
A
,
a
,
b
)\

101 (
b
[0]=
A
[0][0]*
a
[0]+A[0][1]*a\

102 [1]+
A
[0][2]*
a
[2],
b
[1]=A[1][1\

103 ]*
a
[1]+
A
[1][2]*a[2],
b
[2]=A[2\

104 ][2]*
a
[2])

	)

	@main.cpp

1 
	~"­i.h
"

2 
	~<¡dio.h
>

3 
	~<io¡»am
>

4 
	~<mpi.h
>

5 
	~"MAPP.h
"

10 #ifdeà
IS_PY3K


11 
	$maš
(
Çrgs
,* 
¬gs
[])

13 
	`MPI_In™
(&
Çrgs
, &
¬gs
);

14 
wch¬_t
** 
__¬gs
=
NULL
;

15 if(
Çrgs
è
__¬gs
=
Ãw
 
wch¬_t
*[nargs];

16 
i
=0;i<
Çrgs
;i++è
__¬gs
[i]=
	`Py_DecodeLoÿË
(
¬gs
[i], 
NULL
);

17 
	`PyImpÜt_Aµ’dIn™b
("m­p",
MAPP_NS
::
MAPP
::
š™_moduË
);

18 
	`Py_Maš
(
Çrgs
,
__¬gs
);

19 
d–‘e
 [] 
__¬gs
;

20 
mpi_fš®ized
;

21 
	`MPI_Fš®ized
(&
mpi_fš®ized
);

22 if(!
mpi_fš®ized
è
	`MPI_Fš®ize
();

23  
EXIT_SUCCESS
;

24 
	}
}

26 
Çme¥aû
 
	gMAPP_NS


27 { 
PyMODINIT_FUNC
 
š™m­p
();}

28 
	$maš
(
Çrgs
,* 
¬gs
[])

30 
	`MPI_In™
(&
Çrgs
, &
¬gs
);

31 
	`PyImpÜt_Aµ’dIn™b
("m­p",
MAPP_NS
::
š™m­p
);

32 
	`Py_Maš
(
Çrgs
,
¬gs
);

33 
mpi_fš®ized
;

34 
	`MPI_Fš®ized
(&
mpi_fš®ized
);

35 if(!
mpi_fš®ized
è
	`MPI_Fš®ize
();  
EXIT_SUCCESS
;

36 
	}
}

	@mapp_func.h

1 
	~"glob®.h
"

2 
	~<¡ddef.h
>

3 
	~<¡ršg.h
>

4 
	~<¡ršg
>

5 #iâdeà
__MAPP__m­p_func__


6 
	#__MAPP__m­p_func__


	)

7 
Çme¥aû
 
	gMAPP_NS


9 şas 
	cEAMFunc


11 
	g´iv©e
:

12 
´Ùeùed
:

13 
public
:

14 
–em_ty³
 
ÃËms
;

15 
	g¡d
::
¡ršg
* 
Çmes
;

16 
ty³0
** 
	grc
;

18 
®loc_±rs
()

20 
	gÇmes
=
Ãw
 
¡d
::
¡ršg
[
ÃËms
];

21 
	grc
=
Ãw
 
ty³0
*[
ÃËms
];

22 *
	grc
=
Ãw
 
ty³0
[
ÃËms
*nelems];

24 
	gi
=1;i<
	gÃËms
;i++)

25 
	grc
[
i
]=
rc
[i-1]+
ÃËms
;

27 
d—Îoc_±rs
()

29 
	gd–‘e
 [] *
	grc
;

30 
	gd–‘e
 [] 
	grc
;

31 
	gd–‘e
 [] 
	gÇmes
;

33 
–em_ty³
* 
»m­
(cÚ¡ 
¡d
::
¡ršg
* 
__Çmes
,–em_ty³ 
__ÃËms
)

35 if(
	g__ÃËms
==0è 
NULL
;

36 
–em_ty³
* 
	gm­
=
Ãw
ƒËm_ty³[
__ÃËms
];

37 
–em_ty³
 
	gi
=0;i<
	g__ÃËms
;i++)

39 
boŞ
 
	gfound
=
çl£
;

40 
–em_ty³
 
	gj
=0;j<
	gÃËms
&&!
	gfound
;j++)

41 if(
¡rcmp
(
__Çmes
[
i
].
c_¡r
(),
Çmes
[
j
].c_str())==0)

43 
found
=
Œue
;

44 
	gm­
[
i
]=
j
;

46 if(!
	gfound
)

47 
throw
 
	g¡d
::
¡ršg
("·¿m‘” fÜƒËm’ˆ")+
__Çmes
[
i
]+
¡d
::string("was‚ot found inhe forcefield");

50  
	gm­
;

53 
EAMFunc
(
–em_ty³
 
__ÃËms
):
ÃËms
(__ÃËms){
®loc_±rs
();};

54 
	gvœtu®
 ~
EAMFunc
(){
d—Îoc_±rs
();};

55 
vœtu®
 
ty³0
 
F
(cÚ¡ 
–em_ty³
&,constype0&)=0;

56 
vœtu®
 
ty³0
 
rho
(cÚ¡ 
–em_ty³
&,constƒlem_type&,constype0&)=0;

57 
vœtu®
 
ty³0
 
phi
(cÚ¡ 
–em_ty³
&,constƒlem_type&,constype0&)=0;

58 
vœtu®
 
ty³0
 
åaœ
(cÚ¡ 
–em_ty³
&,constƒlem_type&,constype0&,constype0&,constype0&)=0;

61 
	gMAPP_NS
::
	tEAMFunc
* 
	tü—‹_—m_ff_t
();

62 
ty³0
 
	tåaœ_t
(cÚ¡ 
	t–em_ty³
,cÚ¡ƒËm_ty³,cÚ¡ 
	tty³0
,constype0,constype0);

63 
ty³0
 
	tphi_t
(cÚ¡ 
	t–em_ty³
,cÚ¡ƒËm_ty³,cÚ¡ 
	tty³0
);

64 
ty³0
 
	trho_t
(cÚ¡ 
	t–em_ty³
,cÚ¡ƒËm_ty³,cÚ¡ 
	tty³0
);

65 
ty³0
 
	tF_t
(cÚ¡ 
	t–em_ty³
,cÚ¡ 
	tty³0
);

69 
Çme¥aû
 
	gMAPP_NS


71 şas 
	cADPFunc


73 
	g´iv©e
:

74 
´Ùeùed
:

75 
public
:

76 
–em_ty³
 
ÃËms
;

77 
	g¡d
::
¡ršg
* 
Çmes
;

78 
ty³0
** 
	grc
;

80 
®loc_±rs
()

82 
	gÇmes
=
Ãw
 
¡d
::
¡ršg
[
ÃËms
];

83 
	grc
=
Ãw
 
ty³0
*[
ÃËms
];

84 *
	grc
=
Ãw
 
ty³0
[
ÃËms
*nelems];

86 
	gi
=1;i<
	gÃËms
;i++)

87 
	grc
[
i
]=
rc
[i-1]+
ÃËms
;

89 
d—Îoc_±rs
()

91 
	gd–‘e
 [] *
	grc
;

92 
	gd–‘e
 [] 
	grc
;

93 
	gd–‘e
 [] 
	gÇmes
;

95 
–em_ty³
* 
»m­
(cÚ¡ 
¡d
::
¡ršg
* 
__Çmes
,–em_ty³ 
__ÃËms
)

97 if(
	g__ÃËms
==0è 
NULL
;

98 
–em_ty³
* 
	gm­
=
Ãw
ƒËm_ty³[
__ÃËms
];

99 
–em_ty³
 
	gi
=0;i<
	g__ÃËms
;i++)

101 
boŞ
 
	gfound
=
çl£
;

102 
–em_ty³
 
	gj
=0;j<
	gÃËms
&&!
	gfound
;j++)

103 if(
¡rcmp
(
__Çmes
[
i
].
c_¡r
(),
Çmes
[
j
].c_str())==0)

105 
found
=
Œue
;

106 
	gm­
[
i
]=
j
;

108 if(!
	gfound
)

109 
throw
 
	g¡d
::
¡ršg
("·¿m‘” fÜƒËm’ˆ")+
__Çmes
[
i
]+
¡d
::string("was‚ot found inhe forcefield");

112  
	gm­
;

115 
ADPFunc
(
–em_ty³
 
__ÃËms
):
ÃËms
(__ÃËms){
®loc_±rs
();};

116 
	gvœtu®
 ~
ADPFunc
(){
d—Îoc_±rs
();};

117 
vœtu®
 
ty³0
 
F
(cÚ¡ 
–em_ty³
&,constype0&)=0;

118 
vœtu®
 
ty³0
 
rho
(cÚ¡ 
–em_ty³
&,constƒlem_type&,constype0&)=0;

119 
vœtu®
 
ty³0
 
phi
(cÚ¡ 
–em_ty³
&,constƒlem_type&,constype0&)=0;

120 
vœtu®
 
ty³0
 
åaœ
(cÚ¡ 
–em_ty³
&,constƒlem_type&,constype0&,constype0&,constype0&)=0;

	@md_muvt_2.cpp

1 
	~"md_muvt_2.h
"

2 
	~"th”mo_dyÇmics.h
"

3 
	~"dyÇmic_md.h
"

4 
	~"–em’ts.h
"

5 
	~"ff_md.h
"

6 
	~"pgcmc_2.h
"

7 
	~"xm©h.h
"

9 
	#GCMCDEBUG


10 

	)

12 
	gMDMuVT_2
::
	$MDMuVT_2
(
ty³0
 
__mu0
,ty³0 
__T
,ty³0 
__dt
,
¡d
::
¡ršg
 
__gas_–em_Çme0
,
__£ed
,¡d::¡ršg 
__gas_–em_Çme1
,ty³0 
__mu1
,ty³0 
__¿tio
):

13 
	`MDNVT
(
__T
,
__dt
),

14 
	`£ed
(
__£ed
),

15 
	`mu0
(
__mu0
),

16 
	`mu1
(
__mu1
),

17 
	`Ãv”y
(1000),

18 
	`Ç‰em±s
(1000),

19 
	`gas_–em_Çme0
(
__gas_–em_Çme0
),

20 
	`gas_–em_Çme1
(
__gas_–em_Çme1
),

21 
	$¿tio
(
__¿tio
)

23 
	}
}

27 
	gMDMuVT_2
::~
	$MDMuVT_2
()

29 
	}
}

33 
MDMuVT_2
::
	$upd©e_x_d__x
(
ty³0
 
çc_x_d
)

35 
ty³0
* 
x
=
©oms
->x->
	`begš
();

36 
ty³0
* 
f
=
ff
->f->
	`begš
();

37 
ty³0
* 
x_d
=
©oms
->x_d->
	`begš
();

38 
–em_ty³
* 
–em
=
©oms
->–em->
	`begš
();

39 
ty³0
* 
m
=
©oms
->
–em’ts
.
mas£s
;

40 
ty³0
 
m_i
;

41 
ty³0
 
dx_lş
[
__dim__
]={
	`DESIG
(__dim__,0.0)};

42 cÚ¡ 
Çtms_lş
=
©oms
->natms_lcl;

43 
i
=0;i<
Çtms_lş
;++i)

45 
m_i
=
m
[*
–em
];

46 
Algeb¿
::
Do
<
__dim__
>::
	`func
([&
x_d
,&
dx_lş
,&
x
,&
f
,&
m_i
,&
çc_x_d
,
this
](cÚ¡ 
j
)

48 
x_d
[
j
]=x_d[j]*
çc_x_d
+
f
[j]*
dt2
/
m_i
;

49 
dx_lş
[
j
]+=
x_d
[j]*
dt
;

50 
x
[
j
]+=
x_d
[j]*
dt
;

53 
f
+=
__dim__
;

54 
x_d
+=
__dim__
;

55 
x
+=
__dim__
;

56 ++
–em
;

59 
ty³0
 
dx
[
__dim__
]={
	`DESIG
(__dim__,0.0)};

60 
	`MPI_AÎ»duû
(
dx_lş
,
dx
,
__dim__
,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
©oms
->
wÜld
);

61 
ty³0
 
Çtms
=
¡©ic_ÿ¡
<ty³0>(
©oms
->natms);

62 
Algeb¿
::
Do
<
__dim__
>::
	`func
([&
dx
,
Çtms
](cÚ¡ 
i
){dx[i]/=natms;});

63 
x
=
©oms
->x->
	`begš
();

64 
i
=0;i<
Çtms_lş
;++i,
x
+=
__dim__
)

65 
Algeb¿
::
Do
<
__dim__
>::
	`func
([&
dx
,&
x
](cÚ¡ 
j
){x[j]-=dx[j];});

66 
	}
}

70 
	gMDMuVT_2
::
	$upd©e_x_d
()

73 
ty³0
* 
f
=
ff
->f->
	`begš
();

74 
ty³0
* 
x_d
=
©oms
->x_d->
	`begš
();

75 
–em_ty³
* 
–em
=
©oms
->–em->
	`begš
();

76 
ty³0
* 
m
=
©oms
->
–em’ts
.
mas£s
;

77 
ty³0
 
m_i
;

78 
Algeb¿
::
z”o
<
__nvoigt__
>(
__vec_lş
);

79 cÚ¡ 
Çtms_lş
=
©oms
->natms_lcl;

80 
i
=0;i<
Çtms_lş
;++i)

82 
m_i
=
m
[*
–em
];

83 
Algeb¿
::
Do
<
__dim__
>::
	`func
([&
x_d
,&
f
,&
m_i
,
this
](cÚ¡ 
j
){x_d[j]+=f[j]*
dt2
/m_i;});

84 
Algeb¿
::
DyadicV
<
__dim__
>(
m_i
,
x_d
,
__vec_lş
);

85 
f
+=
__dim__
;

86 
x_d
+=
__dim__
;

87 ++
–em
;

90 
	`MPI_AÎ»duû
(
__vec_lş
,
mvv
,
__nvoigt__
,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
©oms
->
wÜld
);

91 
T_·¹
=
Algeb¿
::
Tr_DyadicV
<
__dim__
>(
mvv
)/(
ndof_·¹
*
kB
);

92 
	}
}

96 
	gMDMuVT_2
::
	$upd©e_x_d__x_w_dof
(
ty³0
 
çc_x_d
)

98 
ty³0
* 
x
=
©oms
->x->
	`begš
();

99 
ty³0
* 
f
=
ff
->f->
	`begš
();

100 
ty³0
* 
x_d
=
©oms
->x_d->
	`begš
();

101 
–em_ty³
* 
–em
=
©oms
->–em->
	`begš
();

102 
boŞ
* 
dof
=
©oms
->
x_dof
->
	`begš
();

103 
ty³0
* 
m
=
©oms
->
–em’ts
.
mas£s
;

104 
ty³0
 
m_i
;

105 
ty³0
 
dx_lş
[
__dim__
]={
	`DESIG
(__dim__,0.0)};

106 cÚ¡ 
Çtms_lş
=
©oms
->natms_lcl;

107 
i
=0;i<
Çtms_lş
;++i)

109 
m_i
=
m
[*
–em
];

110 
Algeb¿
::
Do
<
__dim__
>::
	`func
([&
x_d
,&
dx_lş
,&
x
,&
f
,&
m_i
,&
çc_x_d
,&
dof
,
this
](cÚ¡ 
j
)

112 if(
dof
[
j
]è
x_d
[j]=x_d[j]*
çc_x_d
+
f
[j]*
dt2
/
m_i
;

113 
dx_lş
[
j
]+=
x_d
[j]*
dt
;

114 
x
[
j
]+=
x_d
[j]*
dt
;

117 
f
+=
__dim__
;

118 
x_d
+=
__dim__
;

119 
x
+=
__dim__
;

120 
dof
+=
__dim__
;

121 ++
–em
;

124 
ty³0
 
dx
[
__dim__
]={
	`DESIG
(__dim__,0.0)};

125 
	`MPI_AÎ»duû
(
dx_lş
,
dx
,
__dim__
,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
©oms
->
wÜld
);

126 
ty³0
 
Çtms
=
¡©ic_ÿ¡
<ty³0>(
©oms
->natms);

127 
Algeb¿
::
Do
<
__dim__
>::
	`func
([&
dx
,
Çtms
](cÚ¡ 
i
){dx[i]/=natms;});

128 
x
=
©oms
->x->
	`begš
();

129 
i
=0;i<
Çtms_lş
;++i,
x
+=
__dim__
)

130 
Algeb¿
::
Do
<
__dim__
>::
	`func
([&
dx
,&
x
](cÚ¡ 
j
){x[j]-=dx[j];});

131 
	}
}

135 
	gMDMuVT_2
::
	$upd©e_x_d_w_dof
()

138 
ty³0
* 
f
=
ff
->f->
	`begš
();

139 
ty³0
* 
x_d
=
©oms
->x_d->
	`begš
();

140 
–em_ty³
* 
–em
=
©oms
->–em->
	`begš
();

141 
boŞ
* 
dof
=
©oms
->
x_dof
->
	`begš
();

142 
ty³0
* 
m
=
©oms
->
–em’ts
.
mas£s
;

143 
ty³0
 
m_i
;

144 
Algeb¿
::
z”o
<
__nvoigt__
>(
__vec_lş
);

145 cÚ¡ 
Çtms_lş
=
©oms
->natms_lcl;

146 
i
=0;i<
Çtms_lş
;++i)

148 
m_i
=
m
[*
–em
];

149 
Algeb¿
::
Do
<
__dim__
>::
	`func
([&
dof
,&
x_d
,&
f
,&
m_i
,
this
](cÚ¡ 
j
){if(dof[j])x_d[j]+=f[j]*
dt2
/m_i;});

150 
Algeb¿
::
DyadicV
<
__dim__
>(
m_i
,
x_d
,
__vec_lş
);

152 
dof
+=
__dim__
;

153 
f
+=
__dim__
;

154 
x_d
+=
__dim__
;

155 ++
–em
;

158 
	`MPI_AÎ»duû
(
__vec_lş
,
mvv
,
__nvoigt__
,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
©oms
->
wÜld
);

159 
T_·¹
=
Algeb¿
::
Tr_DyadicV
<
__dim__
>(
mvv
)/(
ndof_·¹
*
kB
);

160 
	}
}

164 
	gMDMuVT_2
::
	$´e_run_chk
(
AtomsMD
* 
©oms
,
FÜûF›ldMD
* 
ff
)

167 if(!
©oms
)

168 
throw
 
¡d
::
	`¡ršg
("cannot start md without initial conditions");

171 if(!
ff
)

172 
throw
 
¡d
::
	`¡ršg
("cannot start md without governingƒquations (force field)");

174 if(
¡d
::
	`i¢ª
(
©oms
->
kB
))

175 
throw
 
¡d
::
	`¡ršg
("boltzmann constant should be set…rioro MD");

177 if(
¡d
::
	`i¢ª
(
©oms
->
hP
))

178 
throw
 
¡d
::
	`¡ršg
("planck constant should be set…rioro GCMC");

180 
–em_ty³
 
›Ëm
;

181 
Œy


183 
›Ëm
=
©oms
->
–em’ts
.
	`fšd
(
gas_–em_Çme0
.
	`c_¡r
());

185 
	`ÿtch
()

187 
throw
 "©om "+
gas_–em_Çme0
+" is‚ot‡ssignedo configuration";

189 
Œy


191 
›Ëm
=
©oms
->
–em’ts
.
	`fšd
(
gas_–em_Çme1
.
	`c_¡r
());

193 
	`ÿtch
()

195 
throw
 "©om "+
gas_–em_Çme1
+" is‚ot‡ssignedo configuration";

199 if(!
©oms
->
x_dof
->
	`is_em±y
())

201 
boŞ
* 
dof
=
©oms
->
x_dof
->
	`begš
();

202 
–em_ty³
* 
–em
=
©oms
->–em->
	`begš
();

203 
”r_lş
=0;

204 
i
=0;i<
©oms
->
Çtms_lş
;i++,
dof
+=
__dim__
)

206 if(
–em
[
i
]==
›Ëm
)

207 
Algeb¿
::
Do
<
__dim__
>::
	`func
([&
dof
,&
”r_lş
](
i
){ if(!dof[i])ƒrr_lcl=1;});

210 
”r
=0;

211 
	`MPI_AÎ»duû
(&
”r_lş
,&
”r
,1,
MPI_INT
,
MPI_MAX
,
©oms
->
wÜld
);

212 if(
”r
)

213 
throw
 
¡d
::
	`¡ršg
("ÿÂÙ fix‡ny deg»e oàä“dom oàªy oàthga ©om (")+
gas_–em_Çme0
+std::string(")");

215 
	}
}

219 
	gMDMuVT_2
::
	$´e_š™
()

221 
MDNVT
::
	`´e_š™
();

222 
	}
}

226 
	gMDMuVT_2
::
	$š™
()

228 
	`´e_š™
();

230 
dyÇmic
=
Ãw
 
	`DyÇmicMD
(
©oms
,
ff
,
çl£
,{},{©oms->
x_d
,©oms->
x_dof
},{});

231 
dyÇmic
->
	`š™
();

233 if(
x´t
)

235 
Œy


237 
x´t
->
©oms
=atoms;

238 
x´t
->
	`š™
();

240 
	`ÿtch
(
¡d
::
¡ršg
& 
”r_msg
)

242 
	`fš
();

243 
throw
 
”r_msg
;

246 
	}
}

250 
	gMDMuVT_2
::
	$fš
()

252 if(
x´t
)

254 
x´t
->
	`fš
();

255 
x´t
->
©oms
=
NULL
;

258 
dyÇmic
->
	`fš
();

259 
d–‘e
 
dyÇmic
;

260 
dyÇmic
=
NULL
;

261 
	}
}

265 
	gMDMuVT_2
::
	$run
(
n¡•s
)

268 
¡•
=
©oms
->step;

270 
PGCMC_2
 
	`gcmc
(
©oms
,
ff
,
dyÇmic
,1,©oms->
–em’ts
.
	`fšd
(
gas_–em_Çme0
.
	`c_¡r
()),
mu0
,
T
,
£ed
,©oms->–em’ts.fšd(
gas_–em_Çme1
.c_¡r()),
mu1
,
¿tio
);

271 
gcmc
.
	`š™
();

272 
ty³0
 
gas_äac0
=
¡©ic_ÿ¡
<ty³0>(
gcmc
.
ngasA¼
[0])/¡©ic_ÿ¡<ty³0>(
©oms
->
Çtms
);

273 
ty³0
 
gas_äac1
=
¡©ic_ÿ¡
<ty³0>(
gcmc
.
ngasA¼
[1])/¡©ic_ÿ¡<ty³0>(
©oms
->
Çtms
);

274 #ifdeà
GCMCDEBUG


275 
ty³0
 
d–_u
=0.0;

276 
FILE
* 
å_debug
=
NULL
;

277 if(
©oms
->
comm_¿nk
==0)

279 
å_debug
=
	`fİ’
("gcmc_debug","a");

280 
	`årštf
(
å_debug
,"¿tio\t%e\n",
¿tio
);

285 
ff
->
	`fÜû_ÿlc
();

287 
Ãv”y_x´t
=
x´t
==
NULL
 ? 0:x´t->
Ãv”y
;

288 if(
Ãv”y_x´t
è
x´t
->
	`wr™e
(
¡•
);

290 
Th”moDyÇmics
 
	`th”mo
(6,"T",
T_·¹
,"PE",
©oms
->
³
,

291 "S[0][0]",
S_·¹
[0][0],

292 "S[1][1]",
S_·¹
[1][1],

293 "S[2][2]",
S_·¹
[2][2],

294 "S[1][2]",
S_·¹
[2][1],

295 "S[2][0]",
S_·¹
[2][0],

296 "S[0][1]",
S_·¹
[1][0],

297 "GAS_FRAC0",
gas_äac0
,

298 "GAS_FRAC1",
gas_äac1
);

300 if(
Á®ly
è
th”mo
.
	`š™
();

301 
Algeb¿
::
DoLT
<
__dim__
>::
	`func
([
this
](cÚ¡ 
i
,cÚ¡ 
j
)

303 
S_·¹
[
i
][
j
]=
©oms
->
S_³
[i][j]-
mvv
[i+j*
__dim__
-j*(j+1)/2]/©oms->
vŞ
;

307 if(
Á®ly
è
th”mo
.
	`´št
(
¡•
);

309 
ty³0
 
çc
,
çc_x_d
=1.0;

310 
i¡•
=0;i¡•<
n¡•s
;istep++)

313 
çc_x_d
*=
çc
=
	`th”mo_·¹
(
T_·¹
/
T
,
ndof_·¹
);

314 
çc
*=fac;

315 
Algeb¿
::
Do
<
__nvoigt__
>::
	`func
([
this
,&
çc
](
i
){
mvv
[i]*=fac;});

316 
T_·¹
*=
çc
;

318 
	`upd©e_x_d__x
(
çc_x_d
);

320 if((
i¡•
+1)%
Ãv”y
)

321 #ifdeà
OLD_UPDATE


322 
dyÇmic
->
	`upd©e
(
©oms
->
x
);

324 
dyÇmic
->
upd©e
<
Œue
>();

328 #ifdeà
GCMCDEBUG


329 #ifdeà
OLD_UPDATE


330 
dyÇmic
->
	`upd©e
(
©oms
->
x
);

332 
dyÇmic
->
upd©e
<
Œue
>();

335 
ff
->
	`fÜû_ÿlc
();

336 
d–_u
=
©oms
->
³
;

338 
gcmc
.
	`xchng
(
çl£
,
Ç‰em±s
);

339 
gas_äac0
=
¡©ic_ÿ¡
<
ty³0
>(
gcmc
.
ngasA¼
[0])/¡©ic_ÿ¡<ty³0>(
©oms
->
Çtms
);

340 
ndof_·¹
+=
¡©ic_ÿ¡
<
ty³0
>(
gcmc
.
dof_diff
);

341 
Algeb¿
::
Do
<
__nvoigt__
>::
	`func
([
this
,&
gcmc
](cÚ¡ 
i
){
mvv
[i]+=gcmc.mvv[i];});

342 
T_·¹
=
Algeb¿
::
Tr_DyadicV
<
__dim__
>(
mvv
)/(
ndof_·¹
*
kB
);

345 
ff
->
	`fÜû_ÿlc
();

347 #ifdeà
GCMCDEBUG


348 if((
i¡•
+1)%
Ãv”y
==0)

350 
d–_u
-=
©oms
->
³
;

358 
	`upd©e_x_d
();

361 
çc_x_d
=
çc
=
	`th”mo_·¹
(
T_·¹
/
T
,
ndof_·¹
);

362 
çc
*=fac;

363 
Algeb¿
::
Do
<
__nvoigt__
>::
	`func
([
this
,&
çc
](
i
){
mvv
[i]*=fac;});

364 
T_·¹
*=
çc
;

367 
Algeb¿
::
DoLT
<
__dim__
>::
	`func
([
this
](cÚ¡ 
i
,cÚ¡ 
j
)

369 
S_·¹
[
i
][
j
]=
©oms
->
S_³
[i][j]-
mvv
[i+j*
__dim__
-j*(j+1)/2]/©oms->
vŞ
;

372 if(
Á®ly
 && (
i¡•
+1)%Á®ly==0è
th”mo
.
	`´št
(
¡•
+istep+1);

373 if(
Ãv”y_x´t
 && (
i¡•
+1)%Ãv”y_x´t==0è
x´t
->
	`wr™e
(
¡•
+istep+1);

376 if(
Á®ly
 && 
n¡•s
%Á®lyè
th”mo
.
	`´št
(
¡•
+nsteps);

377 if(
Ãv”y_x´t
 && 
n¡•s
%Ãv”y_x´tè
x´t
->
	`wr™e
(
¡•
+nsteps);

379 
	`upd©e_x_d_fš®
(
çc_x_d
);

380 if(
Á®ly
è
th”mo
.
	`fš
();

382 
gcmc
.
	`fš
();

384 
©oms
->
¡•
+=
n¡•s
;

386 #ifdeà
GCMCDEBUG


387 if(
©oms
->
comm_¿nk
==0è
	`fşo£
(
å_debug
);

389 
	}
}

393 
PyObjeù
* 
	gMDMuVT_2
::
	$__Ãw__
(
PyTy³Objeù
* 
ty³
,
PyObjeù
* 
¬gs
,PyObjeù* 
kwds
)

395 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
ty³
->
	`_®loc
(type,0));

396 
PyObjeù
* 
£lf
=
»š‹½»t_ÿ¡
<PyObjeù*>(
__£lf
);

397  
£lf
;

398 
	}
}

402 
	gMDMuVT_2
::
	$__š™__
(
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)

404 
FuncAPI
<
ty³0
,ty³0,ty³0,
¡d
::
¡ršg
,,¡d::¡ršg,ty³0,ty³0> 
	`f
("__init__",{"mu0","T","dt","gas_element0","seed","gas_element1","mu1","ratio"});

406 
f
.
logics
<1>()[0]=
	`VLogics
("gt",0.0);

407 
f
.
logics
<2>()[0]=
	`VLogics
("gt",0.0);

408 
f
.
logics
<4>()[0]=
	`VLogics
("gt",0);

409 
f
.
logics
<7>()[0]=
	`VLogics
("gt",0.0);

410 if(
	`f
(
¬gs
,
kwds
)==-1)  -1;

412 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

413 
__£lf
->
md
=
Ãw
 
	`MDMuVT_2
(
f
.
v®
<0>(),f.val<1>(),f.val<2>(),f.val<3>(),f.val<4>(),f.val<5>(),f.val<6>(),f.val<7>());

414 
__£lf
->
x´t
=
NULL
;

417 
	}
}

421 
PyObjeù
* 
	gMDMuVT_2
::
	$__®loc__
(
PyTy³Objeù
* 
ty³
,
Py_ssize_t
)

423 
Objeù
* 
__£lf
=
Ãw
 Object;

424 
	`Py_TYPE
(
__£lf
)=
ty³
;

425 
	`Py_REFCNT
(
__£lf
)=1;

426 
__£lf
->
md
=
NULL
;

427 
__£lf
->
x´t
=
NULL
;

428  
»š‹½»t_ÿ¡
<
PyObjeù
*>(
__£lf
);

429 
	}
}

433 
	gMDMuVT_2
::
	$__d—Îoc__
(
PyObjeù
* 
£lf
)

435 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

436 
d–‘e
 
__£lf
->
md
;

437 
__£lf
->
md
=
NULL
;

438 if(
__£lf
->
x´t
è
	`Py_DECREF
(__self->xprt);

439 
__£lf
->
x´t
=
NULL
;

440 
d–‘e
 
__£lf
;

441 
	}
}

443 
PyTy³Objeù
 
	gMDMuVT_2
::
Ty³Objeù
 ={
PyObjeù_HEAD_INIT
(
NULL
)};

445 
	gMDMuVT_2
::
	$£tup_
()

447 
Ty³Objeù
.
_Çme
="mapp.md.muvt_2";

448 
Ty³Objeù
.
_doc
=
R
"---(

449 
	`__š™__
(
mu0
,
T
,
dt
,
gas_–em’t0
,
£ed
,
gas_–em’t1
,
mu1
,
¿tio
)

451 :
m©h
:`\
mu
 
VT
` 
’£mbË


453 
MŞecuÏr
 
dyÇmics
 
of
 
g¿nd
 
ÿnÚiÿl
 
’£mbË


455 
P¬am‘”s


457 
mu0
 : 

458 
Chemiÿl
 
pÙ’tŸl
 
of
 1
¡
 
–em’t


459 
T
 : 

460 
Tem³¿tu»
 
of
 
the
 
’£mbË


461 
dt
 : 

462 
Time
 
¡•
 
simuÏtiÚ


463 
gas_–em’t0
 : 
¡ršg


464 
Gas
 
–em’t
 
of
 1
¡
ƒlement

465 
£ed
 : 

466 
Rªdom
 
£ed
 
G¿nd
 
CªÚiÿl
 
MÚ‹
 
C¬lo


467 
gas_–em’t1
 : 
¡ršg


468 
Gas
 
–em’t
 
of
 2
¡
ƒlement

469 
mu1
 : 

470 
Chemiÿl
 
pÙ’tŸl
 
of
 2
¡
 
–em’t


471 
¿tio
 : 

472 
R©io
 
b‘w“n
 
two
 
d•os™iÚ
 
–em’ts


474 
NÙes


476 * 
Th”mo¡©
 
D‘as


477 
No£
-
Hoov”
 
chaš


482 
Ty³Objeù
.
_æags
=
Py_TPFLAGS_DEFAULT
;

483 
Ty³Objeù
.
_basicsize
=(
Objeù
);

485 
Ty³Objeù
.
_Ãw
=
__Ãw__
;

486 
Ty³Objeù
.
_š™
=
__š™__
;

487 
Ty³Objeù
.
_®loc
=
__®loc__
;

488 
Ty³Objeù
.
_d—Îoc
=
__d—Îoc__
;

489 
	`£tup__g‘£t
();

490 
Ty³Objeù
.
_g‘£t
=
g‘£t
;

492 
Ty³Objeù
.
_ba£
=&
MDNVT
::TypeObject;

494 
ichk
=
	`PyTy³_R—dy
(&
Ty³Objeù
);

495 if(
ichk
<0)  ichk;

496 
	`Py_INCREF
(&
Ty³Objeù
);

497 
	`GET_WRAPPER_DOC
(
Ty³Objeù
,
__š™__
)=
NULL
;

498  
ichk
;

499 
	}
}

501 
PyG‘S‘Def
 
	gMDMuVT_2
::
g‘£t
[]=
Em±yPyG‘S‘Def
(8);

503 
	gMDMuVT_2
::
	$£tup__g‘£t
()

505 
	`g‘£t_Ãv”y
(
g‘£t
[0]);

506 
	`g‘£t_Ç‰em±s
(
g‘£t
[1]);

507 
	`g‘£t_£ed
(
g‘£t
[2]);

508 
	`g‘£t_gas_–em’t0
(
g‘£t
[3]);

509 
	`g‘£t_gas_–em’t1
(
g‘£t
[4]);

510 
	}
}

514 
	gMDMuVT_2
::
	$g‘£t_Ãv”y
(
PyG‘S‘Def
& 
g‘£t
)

516 
g‘£t
.
Çme
=(*)"nevery";

517 
g‘£t
.
doc
=(*)
R
"---(

518 (è
gcmc
 
³riod


520 
P”fÜm
 
GCMC
 
ev”y
 
Ãv”y
 
¡•s
.

522 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

524  
v¬
<>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->
Ãv”y
);

526 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

528 
V¬API
<> 
	`Ãv”y
("nevery");

529 
Ãv”y
.
logics
[0]=
	`VLogics
("gt",0);

530 
ichk
=
Ãv”y
.
	`£t
(
İ
);

531 if(
ichk
==-1)  -1;

533 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->
Ãv”y
òev”y.
v®
;

536 
	}
}

540 
	gMDMuVT_2
::
	$g‘£t_Ç‰em±s
(
PyG‘S‘Def
& 
g‘£t
)

542 
g‘£t
.
Çme
=(*)"nattempts";

543 
g‘£t
.
doc
=(*)
R
"---(

544 (è
numb”
 
of
 
gcmc
 
ŒŸls


546 
Numb”
 
of
 
d–‘iÚ
/
š£¹iÚ
 
©‹m±s
 
³r
 
GCMC
.

548 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

550  
v¬
<>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->
Ç‰em±s
);

552 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

554 
V¬API
<> 
	`Ç‰em±s
("nattempts");

555 
Ç‰em±s
.
logics
[0]=
	`VLogics
("gt",0);

556 
ichk
=
Ç‰em±s
.
	`£t
(
İ
);

557 if(
ichk
==-1)  -1;

559 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->
Ç‰em±s
ò©‹m±s.
v®
;

562 
	}
}

566 
	gMDMuVT_2
::
	$g‘£t_£ed
(
PyG‘S‘Def
& 
g‘£t
)

568 
g‘£t
.
Çme
=(*)"seed";

569 
g‘£t
.
doc
=(*)
R
"---(

570 (è
¿ndom
 
£ed


572 
Rªdom
 
£ed
 
G¿nd
 
CªÚiÿl
 
MÚ‹
 
C¬lo


574 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

576  
v¬
<>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->
£ed
);

578 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

580 
V¬API
<> 
	`£ed
("seed");

581 
£ed
.
logics
[0]=
	`VLogics
("gt",0);

582 
ichk
=
£ed
.
	`£t
(
İ
);

583 if(
ichk
==-1)  -1;

585 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->
£ed
=£ed.
v®
;

588 
	}
}

592 
	gMDMuVT_2
::
	$g‘£t_gas_–em’t0
(
PyG‘S‘Def
& 
g‘£t
)

594 
g‘£t
.
Çme
=(*)"gas_element0";

595 
g‘£t
.
doc
=(*)
R
"---(

596 (è
gas
 
–em’t
 0

598 
Gas
 
–em’t
 
gcmc


600 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

602  
v¬
<
¡d
::
¡ršg
>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->
gas_–em_Çme0
);

604 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

606 
V¬API
<
¡d
::
¡ršg
> 
	`gas_–em’t0
("gas_element0");

607 
ichk
=
gas_–em’t0
.
	`£t
(
İ
);

608 if(
ichk
==-1)  -1;

609 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->
gas_–em_Çme0
=
gas_–em’t0
.
v®
;

612 
	}
}

616 
	gMDMuVT_2
::
	$g‘£t_gas_–em’t1
(
PyG‘S‘Def
& 
g‘£t
)

618 
g‘£t
.
Çme
=(*)"gas_element1";

619 
g‘£t
.
doc
=(*)
R
"---(

620 (è
gas
 
–em’t
 1

622 
Gas
 
–em’t
 
gcmc


624 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

626  
v¬
<
¡d
::
¡ršg
>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->
gas_–em_Çme1
);

628 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

630 
V¬API
<
¡d
::
¡ršg
> 
	`gas_–em’t1
("gas_element1");

631 
ichk
=
gas_–em’t1
.
	`£t
(
İ
);

632 if(
ichk
==-1)  -1;

633 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->
gas_–em_Çme1
=
gas_–em’t1
.
v®
;

636 
	}
}

	@md_muvt_2.h

1 #iâdeà
__MAPP__md_muvt_2__


2 
	#__MAPP__md_muvt_2__


	)

3 
	~"md_nvt.h
"

4 
Çme¥aû
 
	gMAPP_NS


6 şas 
	cMDMuVT_2
:
public
 
MDNVT


8 
´iv©e
:

9 
£ed
;

10 
ty³0
 
	gmu0
;

11 
ty³0
 
	gmu1
;

12 
	g¡d
::
¡ršg
 
gas_–em_Çme0
;

13 
	g¡d
::
¡ršg
 
gas_–em_Çme1
;

14 
ty³0
 
	g¿tio
;

15 
	gÃv”y
;

16 
	gÇ‰em±s
;

18 
	g´Ùeùed
:

19 
upd©e_x_d__x
(
ty³0
);

20 
upd©e_x_d__x_w_dof
(
ty³0
);

21 
upd©e_x_d
();

22 
upd©e_x_d_w_dof
();

23 
´e_run_chk
(
AtomsMD
*,
FÜûF›ldMD
*);

24 
´e_š™
();

25 
	gpublic
:

26 
MDMuVT_2
(
ty³0
,ty³0,ty³0,
¡d
::
¡ršg
,,std::string,type0,type0);

27 ~
MDMuVT_2
();

28 
š™
();

29 
run
();

30 
fš
();

34 
PyObjeù_HEAD


35 
MDMuVT_2
* 
	gmd
;

36 
	gExpÜtMD
::
Objeù
* 
x´t
;

37 }
	tObjeù
;

39 
PyTy³Objeù
 
	gTy³Objeù
;

40 
PyObjeù
* 
__Ãw__
(
PyTy³Objeù
*,PyObject*, PyObject*);

41 
__š™__
(
PyObjeù
*, PyObject*,PyObject*);

42 
PyObjeù
* 
__®loc__
(
PyTy³Objeù
*,
Py_ssize_t
);

43 
__d—Îoc__
(
PyObjeù
*);

46 
PyM‘hodDef
 
	gm‘hods
[];

47 
£tup__m‘hods
();

48 
ml_run
(
PyM‘hodDef
&);

51 
PyG‘S‘Def
 
	gg‘£t
[];

52 
£tup__g‘£t
();

53 
g‘£t_Ãv”y
(
PyG‘S‘Def
&);

54 
g‘£t_Ç‰em±s
(
PyG‘S‘Def
&);

55 
g‘£t_£ed
(
PyG‘S‘Def
&);

56 
g‘£t_gas_–em’t0
(
PyG‘S‘Def
&);

57 
g‘£t_gas_–em’t1
(
PyG‘S‘Def
&);

60 
£tup_
();

	@md_nst.cpp

1 
	~"md_n¡.h
"

2 
	~"xm©h.h
"

3 
	~"©oms_md.h
"

4 
	~"–em’ts.h
"

5 
	~"ff_¡yËs.h
"

6 
	~"th”mo_dyÇmics.h
"

7 
	~"dyÇmic_md.h
"

9 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

14 
	gMDNST
::
MDNST
(
ty³0
(&
__S
)[
__dim__
][__dim__],ty³0 
__T
,ty³0 
__dt
):

15 
MDNVT
(
__T
,
__dt
),

16 
th”mo_b¬o
(
__dt
/2.0,1000.0*__dt,3,1),

17 
Äe£t
(0),

18 
	gMLT0
{
DESIG2
(
__dim__
,__dim__,0.0)},

19 
	gMLT1
{
DESIG2
(
__dim__
,__dim__,0.0)},

20 
	gMLT2
{
DESIG2
(
__dim__
,__dim__,0.0)},

21 
	gS
{
DESIG2
(
__dim__
,__dim__,0.0)},

22 
	gS_dev
{
DESIG2
(
__dim__
,__dim__,0.0)},

23 
	gB_»f
{
DESIG2
(
__dim__
,__dim__,0.0)},

24 
	gu
{
DESIG2
(
__dim__
,__dim__,0.0)},

25 
	gV_H
{
DESIG2
(
__dim__
,__dim__,0.0)},

26 
	gS_dof
{
DESIG2
(
__dim__
,__dim__,
çl£
)}

29 
	gAlgeb¿
::
DoLT
<
__dim__
>::
func
([
this
,&
__S
,&
__dt
]

30 (
i
,
j
)

32 if(
¡d
::
i¢ª
(
__S
[
i
][
j
]))

34 
S_dof
[
i
][
j
]=S_dof[j][i]=
çl£
;

35 
S
[
i
][
j
]=S[j][i]=
NAN
;

39 
S_dof
[
i
][
j
]=S_dof[j][i]=
Œue
;

40 
S
[
i
][
j
]=S[j][i]=
__S
[i][j];

43 
u
[
i
][
j
]ñau[j][i]=1000.0*
__dt
;

50 
	gMDNST
::~
	$MDNST
()

52 
	}
}

56 
MDNST
::
	$chªge_dt
(
ty³0
 
__dt
)

58 if(
__dt
==
dt
) ;

59 
dt
=
__dt
;

60 
dt2
=
__dt
/2;

62 
L
=
th”mo_·¹
.L;

63 
n™”s
=
th”mo_·¹
.niters;

64 
ty³0
 
t_»Ïx
=
th”mo_·¹
.t_relax;

66 
th”mo_·¹
.~
	`Th”mo¡©NHC
();

67 
	`Ãw
 (&
th”mo_·¹
è
	`Th”mo¡©NHC
(
__dt
/2.0,
t_»Ïx
,
L
,
n™”s
);

70 
L
=
th”mo_b¬o
.L;

71 
n™”s
=
th”mo_b¬o
.niters;

72 
t_»Ïx
=
th”mo_b¬o
.t_relax;

74 
th”mo_b¬o
.~
	`Th”mo¡©NHC
();

75 
	`Ãw
 (&
th”mo_b¬o
è
	`Th”mo¡©NHC
(
__dt
/2.0,
t_»Ïx
,
L
,
n™”s
);

76 
	}
}

80 
	gMDNST
::
	$upd©e_x_d__x__x_d
(
ty³0
 
xi
)

83 
MDM©h
::
	`ÿlc
(
Algeb¿
::
	`Tr
(
V_H
)/
ndof_·¹
,
dt
,
dt2
,V_H,
MLT0
,
MLT1
,
MLT2
);

84 
ty³0
* 
RESTRICT
 
f
=
ff
->f->
	`begš
();

85 
ty³0
* 
RESTRICT
 
x
=
©oms
->x->
	`begš
();

86 
ty³0
* 
RESTRICT
 
x_d
=
©oms
->x_d->
	`begš
();

87 
–em_ty³
* 
RESTRICT
 
–em
=
©oms
->–em->
	`begš
();

88 
ty³0
* 
m
=
©oms
->
–em’ts
.
mas£s
;

89 
ty³0
 
m_i
,
m_šv
;

90 cÚ¡ 
Çtms0
=
©oms
->
Çtms_lş
;

91 
ty³0
 
dx_lş
[
__dim__
]={
	`DESIG
(__dim__,0.0)};

92 
i
=0;i<
Çtms0
;++i)

94 
m_šv
=1.0/
m
[*
–em
];

95 
MDM©h
::
____NONAME0
<
__dim__
,__dim__>::
	`func
(
xi
,
x_d
,&
MLT0
[0][0],
m_šv
,
f
,&
MLT1
[0][0]);

96 
MDM©h
::
____NONAME1
<
__dim__
,__dim__>::
	`func
(
x
,&
V_H
[0][0],
x_d
,
v0
);

97 
MDM©h
::
____NONAME2
<
__dim__
,__dim__>::
	`func
(
v0
,&
MLT2
[0][0]);

99 
Algeb¿
::
V_add
<
__dim__
>(
v0
,
x
);

100 
Algeb¿
::
V_add
<
__dim__
>(
v0
,
dx_lş
);

102 
f
+=
__dim__
;

103 
x_d
+=
__dim__
;

104 
x
+=
__dim__
;

105 ++
–em
;

108 
ty³0
 
dx
[
__dim__
]={
	`DESIG
(__dim__,0.0)};

109 
	`MPI_AÎ»duû
(
dx_lş
,
dx
,
__dim__
,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
©oms
->
wÜld
);

110 
ty³0
 
Çtms
=
¡©ic_ÿ¡
<ty³0>(
©oms
->natms);

111 
Algeb¿
::
Do
<
__dim__
>::
	`func
([&
dx
,
Çtms
](cÚ¡ 
i
){dx[i]/=natms;});

112 
x
=
©oms
->x->
	`begš
();

113 
i
=0;i<
Çtms0
;++i,
x
+=
__dim__
)

114 
Algeb¿
::
Do
<
__dim__
>::
	`func
([&
dx
,&
x
](cÚ¡ 
j
){x[j]-=dx[j];});

117 
Algeb¿
::
	`MLT_mul_MLT
(
MLT2
,
V_H
,MLT2);

118 
Algeb¿
::
Do
<
__dim__
>::
	`func
([
this
](
i
){
MLT2
[i][i]++;});

119 
Algeb¿
::
	`MLT_mul_MLT
(
©oms
->
H
,
MLT2
,atoms->H);

120 
©oms
->
	`upd©e_H
();

122 #ifdeà
OLD_UPDATE


123 
dyÇmic
->
	`upd©e
(
©oms
->
x
);

125 
dyÇmic
->
upd©e
<
Œue
>();

127 
ff
->
	`fÜû_ÿlc
();

130 
f
=
ff
->f->
	`begš
();

131 
x_d
=
©oms
->x_d->
	`begš
();

132 
–em
=
©oms
->–em->
	`begš
();

133 
Algeb¿
::
z”o
<
__nvoigt__
>(
__vec_lş
);

134 cÚ¡ 
Çtms1
=
©oms
->
Çtms_lş
;

135 
i
=0;i<
Çtms1
;++i)

137 
m_i
=
m
[*
–em
];

138 
m_šv
=1.0/
m_i
;

140 
MDM©h
::
____NONAME0
<
__dim__
,__dim__>::
	`func
(
x_d
,&
MLT0
[0][0],
m_šv
,
f
,&
MLT1
[0][0]);

141 
Algeb¿
::
DyadicV
<
__dim__
>(
m_i
,
x_d
,
__vec_lş
);

143 
f
+=
__dim__
;

144 
x_d
+=
__dim__
;

145 ++
–em
;

147 
	`MPI_AÎ»duû
(
__vec_lş
,
mvv
,
__nvoigt__
,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
©oms
->
wÜld
);

148 
T_·¹
=
Algeb¿
::
Tr_DyadicV
<
__dim__
>(
mvv
)/(
ndof_·¹
*
kB
);

149 
	}
}

153 
	gMDNST
::
	$upd©e_x_d__x__x_d_w_dof
(
ty³0
 
xi
)

156 
MDM©h
::
	`ÿlc
(
Algeb¿
::
	`Tr
(
V_H
)/
ndof_·¹
,
dt
,
dt2
,V_H,
MLT0
,
MLT1
,
MLT2
);

157 
ty³0
* 
RESTRICT
 
f
=
ff
->f->
	`begš
();

158 
ty³0
* 
RESTRICT
 
x
=
©oms
->x->
	`begš
();

159 
ty³0
* 
RESTRICT
 
x_d
=
©oms
->x_d->
	`begš
();

160 
–em_ty³
* 
RESTRICT
 
–em
=
©oms
->–em->
	`begš
();

161 
boŞ
* 
RESTRICT
 
dof
=
©oms
->
x_dof
->
	`begš
();

163 
ty³0
* 
m
=
©oms
->
–em’ts
.
mas£s
;

164 
ty³0
 
m_i
,
m_šv
;

165 cÚ¡ 
Çtms0
=
©oms
->
Çtms_lş
;

166 
ty³0
 
dx_lş
[
__dim__
]={
	`DESIG
(__dim__,0.0)};

167 
ty³0
 
__x_d
[
__dim__
]={
	`DESIG
(__dim__,0.0)};

168 
i
=0;i<
Çtms0
;++i)

170 
m_šv
=1.0/
m
[*
–em
];

171 
Algeb¿
::
V_eq
<
__dim__
>(
x_d
,
__x_d
);

172 
MDM©h
::
____NONAME0
<
__dim__
,__dim__>::
	`func
(
xi
,
x_d
,&
MLT0
[0][0],
m_šv
,
f
,&
MLT1
[0][0]);

173 
Algeb¿
::
Do
<
__dim__
>::
	`func
([&
__x_d
,&
x_d
,&
dof
](cÚ¡ 
j
){if(!dof[j]) x_d[j]=__x_d[j];});

174 
MDM©h
::
____NONAME1
<
__dim__
,__dim__>::
	`func
(
x
,&
V_H
[0][0],
x_d
,
v0
);

175 
MDM©h
::
____NONAME2
<
__dim__
,__dim__>::
	`func
(
v0
,&
MLT2
[0][0]);

177 
Algeb¿
::
V_add
<
__dim__
>(
v0
,
x
);

178 
Algeb¿
::
V_add
<
__dim__
>(
v0
,
dx_lş
);

180 
f
+=
__dim__
;

181 
x_d
+=
__dim__
;

182 
x
+=
__dim__
;

183 
dof
+=
__dim__
;

184 ++
–em
;

187 
ty³0
 
dx
[
__dim__
]={
	`DESIG
(__dim__,0.0)};

188 
	`MPI_AÎ»duû
(
dx_lş
,
dx
,
__dim__
,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
©oms
->
wÜld
);

189 
ty³0
 
Çtms
=
¡©ic_ÿ¡
<ty³0>(
©oms
->natms);

190 
Algeb¿
::
Do
<
__dim__
>::
	`func
([&
dx
,
Çtms
](cÚ¡ 
i
){dx[i]/=natms;});

191 
x
=
©oms
->x->
	`begš
();

192 
i
=0;i<
Çtms0
;++i,
x
+=
__dim__
)

193 
Algeb¿
::
Do
<
__dim__
>::
	`func
([&
dx
,&
x
](cÚ¡ 
j
){x[j]-=dx[j];});

196 
Algeb¿
::
	`MLT_mul_MLT
(
MLT2
,
V_H
,MLT2);

197 
Algeb¿
::
Do
<
__dim__
>::
	`func
([
this
](
i
){
MLT2
[i][i]++;});

198 
Algeb¿
::
	`MLT_mul_MLT
(
©oms
->
H
,
MLT2
,atoms->H);

199 
©oms
->
	`upd©e_H
();

201 #ifdeà
OLD_UPDATE


202 
dyÇmic
->
	`upd©e
(
©oms
->
x
);

204 
dyÇmic
->
upd©e
<
Œue
>();

206 
ff
->
	`fÜû_ÿlc
();

209 
f
=
ff
->f->
	`begš
();

210 
x_d
=
©oms
->x_d->
	`begš
();

211 
–em
=
©oms
->–em->
	`begš
();

212 
dof
=
©oms
->
x_dof
->
	`begš
();

213 
Algeb¿
::
z”o
<
__nvoigt__
>(
__vec_lş
);

214 cÚ¡ 
Çtms1
=
©oms
->
Çtms_lş
;

215 
i
=0;i<
Çtms1
;++i)

217 
m_i
=
m
[*
–em
];

218 
m_šv
=1.0/
m_i
;

220 
Algeb¿
::
V_eq
<
__dim__
>(
x_d
,
__x_d
);

221 
MDM©h
::
____NONAME0
<
__dim__
,__dim__>::
	`func
(
x_d
,&
MLT0
[0][0],
m_šv
,
f
,&
MLT1
[0][0]);

222 
Algeb¿
::
Do
<
__dim__
>::
	`func
([&
__x_d
,&
x_d
,&
dof
](cÚ¡ 
j
){if(!dof[j]) x_d[j]=__x_d[j];});

223 
Algeb¿
::
DyadicV
<
__dim__
>(
m_i
,
x_d
,
__vec_lş
);

225 
f
+=
__dim__
;

226 
x_d
+=
__dim__
;

227 
dof
+=
__dim__
;

228 ++
–em
;

230 
	`MPI_AÎ»duû
(
__vec_lş
,
mvv
,
__nvoigt__
,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
©oms
->
wÜld
);

231 
T_·¹
=
Algeb¿
::
Tr_DyadicV
<
__dim__
>(
mvv
)/(
ndof_·¹
*
kB
);

232 
	}
}

236 
	gMDNST
::
	$´e_run_chk
(
AtomsMD
* 
©oms
,
FÜûF›ldMD
* 
ff
)

239 if(!
©oms
)

240 
throw
 
¡d
::
	`¡ršg
("cannot start md without initial conditions");

243 if(!
ff
)

244 
throw
 
¡d
::
	`¡ršg
("cannot start md without governingƒquations (force field)");

246 if(
¡d
::
	`i¢ª
(
©oms
->
kB
))

247 
throw
 
¡d
::
	`¡ršg
("boltzmann constant should be set…rioro MD");

251 if(!
©oms
->
x_dof
->
	`is_em±y
())

253 
boŞ
* 
dof
=
©oms
->
x_dof
->
	`begš
();

254 
__dof_lş
[
__dim__
]{
	`DESIG
(__dim__,0)};

255 
i
=0;i<
©oms
->
Çtms_lş
;i++,
dof
+=
__dim__
)

256 
Algeb¿
::
Do
<
__dim__
>::
	`func
([&
dof
,&
__dof_lş
](
i
){ if(!dof[i]) __dof_lcl[i]=1;});

258 
__dof
[
__dim__
]{
	`DESIG
(__dim__,0)};

259 
	`MPI_AÎ»duû
(
__dof_lş
,
__dof
,
__dim__
,
MPI_INT
,
MPI_MAX
,
©oms
->
wÜld
);

260 
¡d
::
¡ršg
 
”r_msg
=¡d::
	`¡ršg
();

261 
i
=0;i<
__dim__
;i++)

262 
j
=
i
;j<
__dim__
;j++)

263 if(
S_dof
[
i
][
j
] && 
__dof
[i])

265 if(!
”r_msg
.
	`em±y
())ƒrr_msg+="\n";

266 
”r_msg
+="ÿÂÙ impo£ sŒes compÚ’ˆ["+
Pršt
::
	`to_¡ršg
(
i
)+"]["+Pršt::to_¡ršg(
j
)

267 +"] whªy oàth©om dØnÙ havdeg»ä“dom iÀ"+
Pršt
::
	`to_¡ršg
(
i
)

271 if(!
”r_msg
.
	`em±y
()è
throw
ƒrr_msg;

273 
	}
}

277 
	gMDNST
::
	$´e_š™
()

279 
MDNVT
::
	`´e_š™
();

280 
ndof_b¬o
=0;

281 
T_b¬o
=0.0;

282 
Algeb¿
::
DoLT
<
__dim__
>::
	`func
([
this
](
i
,
j
)

284 if(
S_dof
[
i
][
j
])

286 
V_H_´eçc
[
i
][
j
]=1.0/(
u
[i][j]*u[i][j]*
ndof_·¹
*
kB
*
T
);

287 
ndof_b¬o
++;

288 
T_b¬o
+=
V_H
[
i
][
j
]*V_H[i][j]*
u
[i][j]*tau[i][j];

293 
S
[
i
][
j
]=0.0;

294 
V_H
[
i
][
j
]=0.0;

296 
S_dev
[
i
][
j
]=
S
[i][j];

300 
T_b¬o
*=
T
*
ndof_·¹
*
kB
/
ndof_b¬o
;

301 
s_hyd
=
Algeb¿
::
	`Tr
(
S
)/
¡©ic_ÿ¡
<
ty³0
>(
__dim__
);

302 
Algeb¿
::
Do
<
__dim__
>::
	`func
([
this
](
i
)

304 
S_dev
[
i
][i]=
S
[i][i]-
s_hyd
;

306 
	}
}

310 
	gMDNST
::
	$upd©e_V_H
()

312 
Algeb¿
::
	`MLT_mul_MLT
(
B_»f
,
©oms
->
H
,
MLT0
);

313 
Algeb¿
::
	`MUT_mul_MSY_mul_MLT
(
S_dev
,
MLT0
,
MLT1
,
MLT2
);

316 
Algeb¿
::
Do
<
__dim__
>::
	`func
([
this
](
i
)

318 if(
S_dof
[
i
][i]è
V_H
[i][i]+=(
kB
*
T_·¹
+
©oms
->
vŞ
*
s_hyd
)*
V_H_´eçc
[i][i]*
dt2
;

321 
T_b¬o
=0.0;

323 
Algeb¿
::
DoLT
<
__dim__
>::
	`func
([
this
](cÚ¡ 
i
,cÚ¡ 
j
)

325 if(
S_dof
[
i
][
j
])

327 
V_H
[
i
][
j
]+=(
vŞ_»f
*
MLT2
[i][j]

328 -
©oms
->
vŞ
*©oms->
S_³
[
i
][
j
]

329 +
mvv
[
i
+
j
*
__dim__
-j*(j+1)/2])*
V_H_´eçc
[i][j]*
dt2
;

331 
T_b¬o
+=
V_H
[
i
][
j
]*V_H[i][j]*
u
[i][j]*tau[i][j];

336 
T_b¬o
*=
ndof_·¹
*
T
/
ndof_b¬o
;

338 
	}
}

342 
	gMDNST
::
	$š™
()

344 
	`´e_š™
();

345 
dyÇmic
=
Ãw
 
	`DyÇmicMD
(
©oms
,
ff
,
Œue
,{},{©oms->
x_d
,©oms->
x_dof
},{});

346 
dyÇmic
->
	`š™
();

348 if(
x´t
)

350 
Œy


352 
x´t
->
©oms
=atoms;

353 
x´t
->
	`š™
();

355 
	`ÿtch
(
¡d
::
¡ršg
& 
”r_msg
)

357 
	`fš
();

358 
throw
 
”r_msg
;

361 
	}
}

365 
	gMDNST
::
	$fš
()

367 if(
x´t
)

369 
x´t
->
	`fš
();

370 
x´t
->
©oms
=
NULL
;

373 
dyÇmic
->
	`fš
();

374 
d–‘e
 
dyÇmic
;

375 
dyÇmic
=
NULL
;

376 
	}
}

380 
	gMDNST
::
	$run
(
n¡•s
)

382 
¡•
=
©oms
->step;

384 
ff
->
	`fÜû_ÿlc
();

387 
Ãv”y_x´t
=
x´t
==
NULL
 ? 0:x´t->
Ãv”y
;

388 if(
Ãv”y_x´t
è
x´t
->
	`wr™e
(
¡•
);

390 
Th”moDyÇmics
 
	`th”mo
(6,"T",
T_·¹
,"PE",
©oms
->
³
,

391 "S[0][0]",
S_·¹
[0][0],

392 "S[1][1]",
S_·¹
[1][1],

393 "S[2][2]",
S_·¹
[2][2],

394 "S[1][2]",
S_·¹
[2][1],

395 "S[2][0]",
S_·¹
[2][0],

396 "S[0][1]",
S_·¹
[1][0]);

398 if(
Á®ly
è
th”mo
.
	`š™
();

399 
Algeb¿
::
DoLT
<
__dim__
>::
	`func
([
this
](cÚ¡ 
i
,cÚ¡ 
j
)

401 
S_·¹
[
i
][
j
]=
©oms
->
S_³
[i][j]-
mvv
[i+j*
__dim__
-j*(j+1)/2]/©oms->
vŞ
;

405 if(
Á®ly
è
th”mo
.
	`´št
(
¡•
);

408 
ty³0
 
çc
,
çc_x_d
=1.0;

411 
Algeb¿
::
DoLT
<
__dim__
>::
	`func
([
this
](
i
,
j
){
B_»f
[i][j]=
©oms
->
B
[i][j];});

412 
vŞ_»f
=
©oms
->
vŞ
;

414 
i¡•
=0;i¡•<
n¡•s
;istep++)

417 
çc
=
	`th”mo_b¬o
(
T_b¬o
/
T
,
ndof_b¬o
);

418 
Algeb¿
::
DoLT
<
__dim__
>::
	`func
([
this
,&
çc
](
i
,
j
){
V_H
[i][j]*=fac;});

419 
T_b¬o
*=
çc
*fac;

423 
çc_x_d
*=
çc
=
	`th”mo_·¹
(
T_·¹
/
T
,
ndof_·¹
);

424 
çc
*=fac;

425 
Algeb¿
::
Do
<
__nvoigt__
>::
	`func
([
this
,&
çc
](
i
){
mvv
[i]*=fac;});

426 
T_·¹
*=
çc
;

428 
	`upd©e_V_H
();

430 
	`upd©e_x_d__x__x_d
(
çc_x_d
);

432 
	`upd©e_V_H
();

435 
çc_x_d
=
çc
=
	`th”mo_·¹
(
T_·¹
/
T
,
ndof_·¹
);

436 
çc
*=fac;

437 
Algeb¿
::
Do
<
__nvoigt__
>::
	`func
([
this
,&
çc
](
i
){
mvv
[i]*=fac;});

438 
T_·¹
*=
çc
;

441 
çc
=
	`th”mo_b¬o
(
T_b¬o
/
T
,
ndof_b¬o
);

442 
Algeb¿
::
DoLT
<
__dim__
>::
	`func
([
this
,&
çc
](
i
,
j
){
V_H
[i][j]*=fac;});

443 
T_b¬o
*=
çc
*fac;

445 
Algeb¿
::
DoLT
<
__dim__
>::
	`func
([
this
](cÚ¡ 
i
,cÚ¡ 
j
)

447 
S_·¹
[
i
][
j
]=
©oms
->
S_³
[i][j]-
mvv
[i+j*
__dim__
-j*(j+1)/2]/©oms->
vŞ
;

452 if(
Äe£t
 && (
i¡•
+1)%nreset==0)

454 
Algeb¿
::
DoLT
<
__dim__
>::
	`func
([
this
](
i
,
j
){
B_»f
[i][j]=
©oms
->
B
[i][j];});

455 
vŞ_»f
=
©oms
->
vŞ
;

458 if(
Á®ly
 && (
i¡•
+1)%Á®ly==0è
th”mo
.
	`´št
(
¡•
+istep+1);

459 if(
Ãv”y_x´t
 && (
i¡•
+1)%Ãv”y_x´t==0è
x´t
->
	`wr™e
(
¡•
+istep+1);

462 if(
Á®ly
 && 
n¡•s
%Á®lyè
th”mo
.
	`´št
(
¡•
+nsteps);

463 if(
Ãv”y_x´t
 && 
n¡•s
%Ãv”y_x´tè
x´t
->
	`wr™e
(
¡•
+nsteps);

465 
	`upd©e_x_d_fš®
(
çc_x_d
);

467 if(
Á®ly
è
th”mo
.
	`fš
();

469 
©oms
->
¡•
+=
n¡•s
;

470 
	}
}

494 
PyObjeù
* 
	gMDNST
::
	$__Ãw__
(
PyTy³Objeù
* 
ty³
,
PyObjeù
* 
¬gs
,PyObjeù* 
kwds
)

496 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
ty³
->
	`_®loc
(type,0));

497 
PyObjeù
* 
£lf
=
»š‹½»t_ÿ¡
<PyObjeù*>(
__£lf
);

498  
£lf
;

499 
	}
}

503 
	gMDNST
::
	$__š™__
(
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)

505 
FuncAPI
<
symm
<
ty³0
[
__dim__
][__dim__]>,ty³0,ty³0> 
	`f
("__init__",{"S","T","dt"});

507 
f
.
logics
<1>()[0]=
	`VLogics
("gt",0.0);

508 
f
.
logics
<2>()[0]=
	`VLogics
("gt",0.0);

510 if(
	`f
(
¬gs
,
kwds
)==-1)  -1;

511 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

512 
__£lf
->
md
=
Ãw
 
	`MDNST
(
f
.
v®
<0>(),f.val<1>(),f.val<2>());

513 
__£lf
->
x´t
=
NULL
;

516 
	}
}

520 
PyObjeù
* 
	gMDNST
::
	$__®loc__
(
PyTy³Objeù
* 
ty³
,
Py_ssize_t
)

522 
Objeù
* 
__£lf
=
Ãw
 Object;

523 
	`Py_TYPE
(
__£lf
)=
ty³
;

524 
	`Py_REFCNT
(
__£lf
)=1;

525 
__£lf
->
md
=
NULL
;

526 
__£lf
->
x´t
=
NULL
;

527  
»š‹½»t_ÿ¡
<
PyObjeù
*>(
__£lf
);

528 
	}
}

532 
	gMDNST
::
	$__d—Îoc__
(
PyObjeù
* 
£lf
)

534 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

535 
d–‘e
 
__£lf
->
md
;

536 
__£lf
->
md
=
NULL
;

537 if(
__£lf
->
x´t
è
	`Py_DECREF
(__self->xprt);

538 
__£lf
->
x´t
=
NULL
;

539 
d–‘e
 
__£lf
;

540 
	}
}

542 
PyTy³Objeù
 
	gMDNST
::
Ty³Objeù
 ={
PyObjeù_HEAD_INIT
(
NULL
)};

544 
	gMDNST
::
	$£tup_
()

546 
Ty³Objeù
.
_Çme
="mapp.md.nst";

547 
Ty³Objeù
.
_doc
=
R
"---(

548 
	`__š™__
(
S
,
T
,
dt
)

550 :
m©h
:`
N
\
m©hbf
{
S
}
T
` 
’£mbË


552 
MŞecuÏr
 
dyÇmics
 
of
 
isÙh”m®
-
iso¡»ss
 
’£mbË


554 
P¬am‘”s


556 
S
 : 
symm
<[
dim
][dim]>

557 
Ex‹º®
 
¡»ss
 
impo£d
 
Ú
 
sy¡em
, 
h”e
 
dim
 
is
 
the
 
dim’siÚ
 
of
 
simuÏtiÚ


558 
T
 : 

559 
Tem³¿tu»
 
of
 
the
 
’£mbË


560 
dt
 : 

561 
Time
 
¡•
 
simuÏtiÚ


563 
NÙes


565 * 
Th”mo¡©
 
D‘as


566 
No£
-
Hoov”
 
chaš


571 
Ty³Objeù
.
_æags
=
Py_TPFLAGS_DEFAULT
;

572 
Ty³Objeù
.
_basicsize
=(
Objeù
);

574 
Ty³Objeù
.
_Ãw
=
__Ãw__
;

575 
Ty³Objeù
.
_š™
=
__š™__
;

576 
Ty³Objeù
.
_®loc
=
__®loc__
;

577 
Ty³Objeù
.
_d—Îoc
=
__d—Îoc__
;

578 
	`£tup__g‘£t
();

579 
Ty³Objeù
.
_g‘£t
=
g‘£t
;

581 
Ty³Objeù
.
_ba£
=&
MDNVT
::TypeObject;

583 
ichk
=
	`PyTy³_R—dy
(&
Ty³Objeù
);

584 if(
ichk
<0)  ichk;

585 
	`Py_INCREF
(&
Ty³Objeù
);

586 
	`GET_WRAPPER_DOC
(
Ty³Objeù
,
__š™__
)=
NULL
;

587  
ichk
;

588 
	}
}

590 
PyG‘S‘Def
 
	gMDNST
::
g‘£t
[]=
Em±yPyG‘S‘Def
(7);

592 
	gMDNST
::
	$£tup__g‘£t
()

594 
	`g‘£t_S
(
g‘£t
[0]);

595 
	`g‘£t_n™”s_s
(
g‘£t
[1]);

596 
	`g‘£t_L_s
(
g‘£t
[2]);

597 
	`g‘£t_t_»Ïx_s
(
g‘£t
[3]);

598 
	`g‘£t_u
(
g‘£t
[4]);

599 
	`g‘£t_Äe£t
(
g‘£t
[5]);

600 
	}
}

604 
	gMDNST
::
	$g‘£t_L_s
(
PyG‘S‘Def
& 
g‘£t
)

606 
g‘£t
.
Çme
=(*)"L_s";

607 
g‘£t
.
doc
=(*)
R
"---(

608 (è
Ëngth
 
of
 
¡»ss
 
NHC


610 
Numb”
 
of
 
lšks
 
š
 
NHC
 oà
¡»ss
 
th”mo¡©
, 
£e
 :
»f
:`
nhc
-ref`

612 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

614 
L
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->
th”mo_b¬o
.L;

615  
v¬
<>::
	`bud
(
L
);

617 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

619 
V¬API
<> 
	`L_s
("L_s");

620 
L_s
.
logics
[0]=
	`VLogics
("gt",0);

621 
ichk
=
L_s
.
	`£t
(
İ
);

622 if(
ichk
==-1)  -1;

623 if(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->
th”mo_b¬o
.
L
==
L_s
.
v®
)

626 
Th”mo¡©NHC
& 
th”mo_b¬o
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->thermo_baro;

627 
n™”s
=
th”mo_b¬o
.niters;

628 
ty³0
 
t_»Ïx
=
th”mo_b¬o
.t_relax;

629 
ty³0
 
__dt
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->
dt2
;

630 
th”mo_b¬o
.~
	`Th”mo¡©NHC
();

631 
	`Ãw
 (&
th”mo_b¬o
è
	`Th”mo¡©NHC
(
__dt
,
t_»Ïx
,
L_s
.
v®
,
n™”s
);

634 
	}
}

638 
	gMDNST
::
	$g‘£t_n™”s_s
(
PyG‘S‘Def
& 
g‘£t
)

640 
g‘£t
.
Çme
=(*)"niters_s";

641 
g‘£t
.
doc
=(*)
R
"---(

642 (è
numb”
 
of
 
™”©iÚs
 
š
 
NHC
 
¡»ss


644 
Numb”
 
of
 
™”©iÚs
 
š
 
¡»ss
 
th”mo¡©
 
³r
 
—ch
 
¡•
 oà
evŞutiÚ
, 
£e
 :
»f
:`
nhc
-ref`

646 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

648 
n™”s
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->
th”mo_b¬o
.niters;

649  
v¬
<>::
	`bud
(
n™”s
);

651 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

653 
V¬API
<> 
	`n™”s_s
("niters_s");

654 
n™”s_s
.
logics
[0]=
	`VLogics
("gt",0);

655 
ichk
=
n™”s_s
.
	`£t
(
İ
);

656 if(
ichk
==-1)  -1;

657 if(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->
th”mo_b¬o
.
n™”s
==
n™”s_s
.
v®
)

660 
Th”mo¡©NHC
& 
th”mo_b¬o
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->thermo_baro;

661 
L
=
th”mo_b¬o
.L;

662 
ty³0
 
t_»Ïx
=
th”mo_b¬o
.t_relax;

663 
ty³0
 
__dt
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->
dt2
;

664 
th”mo_b¬o
.~
	`Th”mo¡©NHC
();

665 
	`Ãw
 (&
th”mo_b¬o
è
	`Th”mo¡©NHC
(
__dt
,
t_»Ïx
,
L
,
n™”s_s
.
v®
);

668 
	}
}

672 
	gMDNST
::
	$g‘£t_t_»Ïx_s
(
PyG‘S‘Def
& 
g‘£t
)

674 
g‘£t
.
Çme
=(*)"t_relax_s";

675 
g‘£t
.
doc
=(*)
R
"---(

676 (è
NHC
 
»Ïx©iÚ
 
·¿m‘”
 
¡»ss


678 
NHC
 
»Ïx©iÚ
 
	`·¿m‘”
 (
un™
 
of
 
time
è
¡»ss
 
th”mo¡©
. 
Roughly
 
equiv®’t
 
to
„–ax©iÚimoà¡»s 
w™h
 
th”m®
 
b©h
, 
£e
 :
»f
:`
nhc
-ref`

680 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

682 
ty³0
 
t_»Ïx
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->
th”mo_b¬o
.t_relax;

683  
v¬
<
ty³0
>::
	`bud
(
t_»Ïx
);

685 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

687 
V¬API
<
ty³0
> 
	`t_»Ïx_s
("t_relax_s");

688 
t_»Ïx_s
.
logics
[0]=
	`VLogics
("gt",0.0);

689 
ichk
=
t_»Ïx_s
.
	`£t
(
İ
);

690 if(
ichk
==-1)  -1;

691 if(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->
th”mo_b¬o
.
t_»Ïx
==
t_»Ïx_s
.
v®
)

694 
Th”mo¡©NHC
& 
th”mo_b¬o
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->thermo_baro;

695 
L
=
th”mo_b¬o
.L;

696 
n™”s
=
th”mo_b¬o
.niters;

697 
ty³0
 
__dt
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->
dt2
;

698 
th”mo_b¬o
.~
	`Th”mo¡©NHC
();

699 
	`Ãw
 (&
th”mo_b¬o
è
	`Th”mo¡©NHC
(
__dt
,
t_»Ïx_s
.
v®
,
L
,
n™”s
);

702 
	}
}

706 
	gMDNST
::
	$g‘£t_S
(
PyG‘S‘Def
& 
g‘£t
)

708 
g‘£t
.
Çme
=(*)"S";

709 
g‘£t
.
doc
=(*)
R
"---(

710 (
symm
<[
dim
][dim]>è
ex‹º®
 
¡»ss
 
‹nsÜ


712 
Ex‹º®
 
¡»ss
 
impo£d
 
Ú
 
sy¡em
, 
h”e
 
dim
 
is
 
the
 
dim’siÚ
 
of
 
simuÏtiÚ


714 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

716  
v¬
<
symm
<
ty³0
[
__dim__
][__dim__]>>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->
S
);

718 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

720 
V¬API
<
symm
<
ty³0
[
__dim__
][__dim__]>> 
	`S
("S");

721 
ichk
=
S
.
	`£t
(
İ
);

722 if(
ichk
==-1)  -1;

724 
	`boŞ
 (&
__S_dof
)[
__dim__
][__dim__]=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->
S_dof
;

725 
	`ty³0
 (&
__S
)[
__dim__
][__dim__]=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->
S
;

726 
	`ty³0
 (&
__u
)[
__dim__
][__dim__]=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->
u
;

727 
ty³0
 
__dt
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->
dt
;

728 
Algeb¿
::
DoLT
<
__dim__
>::
	`func
([&
__S_dof
,&
__S
,&
S
,&
__u
,&
__dt
](
i
,
j
)

731 if(
¡d
::
	`i¢ª
(
S
.
v®
[
i
][
j
]))

733 
__S
[
i
][
j
]=__S[j][i]=
NAN
;

734 
__S_dof
[
i
][
j
]=__S_dof[j][i]=
çl£
;

738 
__S
[
i
][
j
]=__S[j][i]=
S
.
v®
[i][j];

739 
__S_dof
[
i
][
j
]=__S_dof[j][i]=
Œue
;

740 if(
¡d
::
	`i¢ª
(
__u
[
i
][
j
]))

741 
__u
[
i
][
j
]=__u[j][i]=1000.0*
__dt
;

747 
	}
}

751 
	gMDNST
::
	$g‘£t_u
(
PyG‘S‘Def
& 
g‘£t
)

753 
g‘£t
.
Çme
=(*)"tau";

754 
g‘£t
.
doc
=(*)
R
"---(

755 (
symm
<[
dim
][dim]>è
»Ïx©iÚ
 
·¿m‘”
 
¡»ss


757 
R–ax©iÚ
 
	`·¿m‘”
 (
un™
 
of
 
time
è
¡»ss
. 
Roughly
 
equiv®’t
 
to
 
»Ïx©iÚ
imoà
š‹º®
 sŒes 
w™h
 
ex‹º®
 sŒess, 
£e
 :
»f
:`
n¡
-ref`

759 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

761  
v¬
<
symm
<
ty³0
[
__dim__
][__dim__]>>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->
u
);

763 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

765 
V¬API
<
symm
<
ty³0
[
__dim__
][__dim__]>> 
	`u
("tau");

766 
u
.
logics
[0]=
	`VLogics
("gt",0.0);

767 
ichk
=
u
.
	`£t
(
İ
);

768 if(
ichk
==-1)  -1;

770 
	`ty³0
 (&
__u
)[
__dim__
][__dim__]=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->
u
;

771 
Algeb¿
::
DoLT
<
__dim__
>::
	`func
([&
__u
,&
u
](
i
,
j
)

773 
__u
[
i
][
j
]=__u[j][i]=
u
.
v®
[i][j];

778 
	}
}

782 
	gMDNST
::
	$g‘£t_Äe£t
(
PyG‘S‘Def
& 
g‘£t
)

784 
g‘£t
.
Çme
=(*)"nreset";

785 
g‘£t
.
doc
=(*)
R
"---(

786 (è
cÚfigu¿tiÚ
 
»£t
 
³riod


788 
Numb”
 
of
 
¡•s
 
to
 
»£t
 
š™Ÿl
 
cÚfigu¿tiÚ
. 
If
 
£t
Ø0 
the
 
v”y
 
š™®
 cÚfigu¿tiÚ 
would
 
be
 
»ã»nû


790 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

792 
n™”s
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->
Äe£t
;

793  
v¬
<>::
	`bud
(
n™”s
);

795 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

797 
V¬API
<> 
	`Äe£t
("nreset");

798 
Äe£t
.
logics
[0]=
	`VLogics
("ge",0);

799 
ichk
=
Äe£t
.
	`£t
(
İ
);

800 if(
ichk
==-1)  -1;

801 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->
Äe£t
ò»£t.
v®
;

804 
	}
}

838 
ty³0
 
	gMDM©h
::
	$f
(
ty³0
 
x
)

840 if(
	`çbs
(
x
)<0.015625)

841  1.0+
x
/2.0+x*x/6.0+x*x*x/24.0;

842  (
	`exp
(
x
)-1.0)/x;

843 
	}
}

847 
ty³0
 
	gMDM©h
::
	$df
(
ty³0
 
x
)

849 if(
	`çbs
(
x
)<0.015625)

850  0.5+
x
/3.0+x*x/8.0+x*x*x/30.0;

851 
ty³0
 
exp_x
=
	`exp
(
x
);

852  (
exp_x
-Óxp_x-1.0)/
x
)/x;

853 
	}
}

857 
ty³0
 
	gMDM©h
::
	$ddf
(
ty³0
 
x
)

859 if(
	`çbs
(
x
)<0.015625)

860  1.0/3.0+
x
/4.0+x*x/10.0+x*x*x/36.0;

861 
ty³0
 
exp_x
=
	`exp
(
x
);

862  (
exp_x
-2.0*(Óxp_x-Óxp_x-1.0)/
x
)/x))/x;

863 
	}
}

867 
ty³0
 
	gMDM©h
::
	$dddf
(
ty³0
 
x
)

869 if(
	`çbs
(
x
)<0.015625)

870  1.0/4.0+
x
/5.0+x*x/12.0+x*x*x/42.0;

871 
ty³0
 
exp_x
=
	`exp
(
x
);

872  (
exp_x
-3.0*Óxp_x-2.0*(Óxp_x-Óxp_x-1.0)/
x
)/x))/x)/x;

873 
	}
}

877 
	gMDM©h
::
ÿlc
(cÚ¡ 
ty³0
 
a
,cÚ¡y³0& 
dt
,cÚ¡y³0& 
dt2
,ty³0(&
A
)[3][3],ty³0(&
EXP_A
)[3][3],ty³0(&
F_A0
)[3][3],ty³0(&
F_A1
)[3][3])

880 autØ
	gdiv_dif_exp
=[](
ty³0
& 
x
,
	gty³0
& 
	gy
,ty³0& 
	gfx
,ty³0& 
	gfy
)->type0

882 if(
çbs
(
x
-
y
)<
	gsq¹_•s
)

883  
exp
(0.5*(
x
+
y
));

884  (
	gfx
-
	gfy
)/(
	gx
-
	gy
);

886 autØ
	gdiv_dif_f
=[](
ty³0
& 
x
,
	gty³0
& 
	gy
,ty³0& 
	gfx
,ty³0& 
	gfy
)->type0

888 if(
çbs
(
x
-
y
)<
sq¹
(
¡d
::
num”ic_lim™s
<
ty³0
>::
•sÚ
()*
f
(0.5*(x+y))/
ddf
(0.5*(x+y))))

889  
df
(0.5*(
x
+
y
));

890  (
	gfx
-
	gfy
)/(
	gx
-
	gy
);

894 
ty³0
 
	gx
=-
dt2
*(
A
[0][0]+
a
),
	gy
=-dt2*(A[1][1]+a),
	gz
=-dt2*(A[2][2]+a);

895 
ty³0
 
	g__x
=
dt
*
A
[0][0],
	g__y
=dt*A[1][1],
	g__z
=dt*A[2][2];

896 
	gF_A0
[0][0]=
f
(
x
);

897 
	gF_A0
[1][1]=
f
(
y
);

898 
	gF_A0
[2][2]=
f
(
z
);

899 
	gF_A0
[2][1]=
F_A0
[1][0]=F_A0[2][0]=0.0;

901 
	gF_A1
[0][0]=
f
(
__x
);

902 
	gF_A1
[1][1]=
f
(
__y
);

903 
	gF_A1
[2][2]=
f
(
__z
);

904 
	gF_A1
[2][1]=
F_A1
[1][0]=F_A1[2][0]=0.0;

906 
	gEXP_A
[0][0]=
exp
(
x
);

907 
	gEXP_A
[1][1]=
exp
(
y
);

908 
	gEXP_A
[2][2]=
exp
(
z
);

909 
	gEXP_A
[2][1]=
EXP_A
[1][0]=EXP_A[2][0]=0.0;

913 
ty³0
 
	gf_yz
=0.0,
	gf_zx
=0.0,
	gf_xy
=0.0,
	g__f_yz
=0.0,
	g__f_zx
=0.0,
	g__f_xy
=0.0,
	gg_yz
=0.0,
	gg_zx
=0.0,
	gg_xy
=0.0;

914 if(
	gA
[2][1]!=0.0)

916 
f_yz
=
div_dif_f
(
y
,
z
,
F_A0
[1][1],F_A0[2][2]);

917 
	g__f_yz
=
div_dif_f
(
__y
,
__z
,
F_A1
[1][1],F_A1[2][2]);

918 
	gg_yz
=
div_dif_exp
(
y
,
z
,
EXP_A
[1][1],EXP_A[2][2]);

920 if(
	gA
[2][0]!=0.0)

922 
f_zx
=
div_dif_f
(
z
,
x
,
F_A0
[2][2],F_A0[0][0]);

923 
	g__f_zx
=
div_dif_f
(
__z
,
__x
,
F_A1
[2][2],F_A1[0][0]);

924 
	gg_zx
=
div_dif_exp
(
z
,
x
,
EXP_A
[2][2],EXP_A[0][0]);

926 if(
	gA
[1][0]!=0.0)

928 
f_xy
=
div_dif_f
(
x
,
y
,
F_A0
[0][0],F_A0[1][1]);

929 
	g__f_xy
=
div_dif_f
(
__x
,
__y
,
F_A1
[0][0],F_A1[1][1]);

930 
	gg_xy
=
div_dif_exp
(
x
,
y
,
EXP_A
[0][0],EXP_A[1][1]);

934 
	gF_A0
[0][0]*=
dt2
;

935 
	gF_A0
[1][1]*=
dt2
;

936 
	gF_A0
[2][2]*=
dt2
;

937 
	gF_A0
[2][1]=-
A
[2][1]*
dt2
*dt2*
f_yz
;

938 
	gF_A0
[2][0]=-
A
[2][0]*
dt2
*dt2*
f_zx
;

939 
	gF_A0
[1][0]=-
A
[1][0]*
dt2
*dt2*
f_xy
;

942 
	gF_A1
[0][0]*=
dt
;

943 
	gF_A1
[1][1]*=
dt
;

944 
	gF_A1
[2][2]*=
dt
;

945 
	gF_A1
[2][1]=
A
[2][1]*
dt
*dt*
__f_yz
;

946 
	gF_A1
[2][0]=
A
[2][0]*
dt
*dt*
__f_zx
;

947 
	gF_A1
[1][0]=
A
[1][0]*
dt
*dt*
__f_xy
;

949 
	gEXP_A
[2][1]=-
A
[2][1]*
dt2
*
g_yz
;

950 
	gEXP_A
[2][0]=-
A
[2][0]*
dt2
*
g_zx
;

951 
	gEXP_A
[1][0]=-
A
[1][0]*
dt2
*
g_xy
;

954 if(
	gA
[1][0]==0.0 || 
A
[2][1]==0.0)

956 autØ
	gdiv_dif_f3
=[](
ty³0
 
x
,ty³0 
	gy
,ty³0 
	gz
,
	gty³0
& 
	gf_yz
,ty³0& 
	gf_zx
,ty³0& 
	gf_xy
)->type0

958 
ty³0
 
	g__ddf
=
ddf
((
x
+
y
+
z
)/3.0);

959 
ty³0
 
	glim
=
sq¹
(
¡d
::
num”ic_lim™s
<ty³0>::
•sÚ
()*
f
((
x
+
y
+
z
)/3.0)/
__ddf
);

961 if(
çbs
(
x
-
z
)>
	glim
)

962  (
	gf_xy
-
	gf_yz
)/(
	gx
-
	gz
);

964 if(
çbs
(
y
-
x
)>
	glim
)

965  (
	gf_yz
-
	gf_zx
)/(
	gy
-
	gx
);

967 if(
çbs
(
z
-
y
)>
	glim
)

968  (
	gf_zx
-
	gf_xy
)/(
	gz
-
	gy
);

970  
	g__ddf
;

973 autØ
	gdiv_dif_exp3
=[](
ty³0
 
x
,ty³0 
	gy
,ty³0 
	gz
,
	gty³0
& 
	gf_yz
,ty³0& 
	gf_zx
,ty³0& 
	gf_xy
)->type0

975 if(
çbs
(
x
-
z
)>
	gsq¹_•s
)

976  (
	gf_xy
-
	gf_yz
)/(
	gx
-
	gz
);

978 if(
çbs
(
y
-
x
)>
	gsq¹_•s
)

979  (
	gf_yz
-
	gf_zx
)/(
	gy
-
	gx
);

981 if(
çbs
(
z
-
y
)>
	gsq¹_•s
)

982  (
	gf_zx
-
	gf_xy
)/(
	gz
-
	gy
);

984  
exp
((
x
+
y
+
z
)/3.0);

987 
	gF_A0
[2][0]+=
dt2
*dt2*dt2*
A
[2][1]*A[1][0]*
div_dif_f3
(
x
,
y
,
z
,
f_yz
,
f_zx
,
f_xy
);

988 
	gF_A1
[2][0]+=
dt
*dt*dt*
A
[2][1]*A[1][0]*
div_dif_f3
(
__x
,
__y
,
__z
,
__f_yz
,
__f_zx
,
__f_xy
);

989 
	gEXP_A
[2][0]+=
dt2
*dt2*
A
[2][1]*A[1][0]*
div_dif_exp3
(
x
,
y
,
z
,
g_yz
,
g_zx
,
g_xy
);

994 
	gMDM©h
::
ÿlc
(cÚ¡ 
ty³0
 
a
,cÚ¡y³0& 
dt
,cÚ¡y³0& 
dt2
,ty³0(&
A
)[2][2],ty³0(&
EXP_A
)[2][2],ty³0(&
F_A0
)[2][2],ty³0(&
F_A1
)[2][2])

997 autØ
	gdiv_dif_exp
=[](
ty³0
& 
x
,
	gty³0
& 
	gy
,ty³0& 
	gfx
,ty³0& 
	gfy
)->type0

999 if(
çbs
(
x
-
y
)<
	gsq¹_•s
)

1000  
exp
(0.5*(
x
+
y
));

1001  (
	gfx
-
	gfy
)/(
	gx
-
	gy
);

1003 autØ
	gdiv_dif_f
=[](
ty³0
& 
x
,
	gty³0
& 
	gy
,ty³0& 
	gfx
,ty³0& 
	gfy
)->type0

1005 if(
çbs
(
x
-
y
)<
sq¹
(
¡d
::
num”ic_lim™s
<
ty³0
>::
•sÚ
()*
f
(0.5*(x+y))/
ddf
(0.5*(x+y))))

1006  
df
(0.5*(
x
+
y
));

1007  (
	gfx
-
	gfy
)/(
	gx
-
	gy
);

1011 
ty³0
 
	gx
=-
dt2
*(
A
[0][0]+
a
),
	gy
=-dt2*(A[1][1]+a);

1012 
ty³0
 
	g__x
=
dt
*
A
[0][0],
	g__y
=dt*A[1][1];

1013 
	gF_A0
[0][0]=
f
(
x
);

1014 
	gF_A0
[1][1]=
f
(
y
);

1015 
	gF_A0
[1][0]=0.0;

1017 
	gF_A1
[0][0]=
f
(
__x
);

1018 
	gF_A1
[1][1]=
f
(
__y
);

1019 
	gF_A1
[1][0]=0.0;

1021 
	gEXP_A
[0][0]=
exp
(
x
);

1022 
	gEXP_A
[1][1]=
exp
(
y
);

1023 
	gEXP_A
[1][0]=0.0;

1027 
ty³0
 
	gf_xy
=0.0,
	g__f_xy
=0.0,
	gg_xy
=0.0;

1028 if(
	gA
[1][0]!=0.0)

1030 
f_xy
=
div_dif_f
(
x
,
y
,
F_A0
[0][0],F_A0[1][1]);

1031 
	g__f_xy
=
div_dif_f
(
__x
,
__y
,
F_A1
[0][0],F_A1[1][1]);

1032 
	gg_xy
=
div_dif_exp
(
x
,
y
,
EXP_A
[0][0],EXP_A[1][1]);

1036 
	gF_A0
[0][0]*=
dt2
;

1037 
	gF_A0
[1][1]*=
dt2
;

1038 
	gF_A0
[1][0]=-
A
[1][0]*
dt2
*dt2*
f_xy
;

1041 
	gF_A1
[0][0]*=
dt
;

1042 
	gF_A1
[1][1]*=
dt
;

1043 
	gF_A1
[1][0]=
A
[1][0]*
dt
*dt*
__f_xy
;

1045 
	gEXP_A
[1][0]=-
A
[1][0]*
dt2
*
g_xy
;

1050 
	gMDM©h
::
ÿlc
(cÚ¡ 
ty³0
 
a
,cÚ¡y³0& 
dt
,cÚ¡y³0& 
dt2
,ty³0(&
A
)[1][1],ty³0(&
EXP_A
)[1][1],ty³0(&
F_A0
)[1][1],ty³0(&
F_A1
)[1][1])

1052 
	gF_A0
[0][0]=
f
(-
dt2
*(
A
[0][0]+
a
))*dt2;

1053 
	gF_A1
[0][0]=
f
(
dt
*
A
[0][0])*dt;

1054 
	gEXP_A
[0][0]=
exp
(-
dt2
*(
A
[0][0]+
a
));

1059 
	gMDM©h
::
ÿlc
(
ty³0
& 
dt
,ty³0(&
A
)[3][3],ty³0(&
EXP_A
)[3][3],ty³0(&
F_A
)[3][3])

1061 autØ
	gdiv_dif_f
=[](
ty³0
& 
dt
,
	gty³0
& 
	gx
,ty³0& 
	gy
,ty³0& 
	gfx
,ty³0& 
	gfy
)->type0

1063 if(
çbs
(
x
-
y
)<
sq¹
(
¡d
::
num”ic_lim™s
<
ty³0
>::
•sÚ
()*
f
(0.5*
dt
*(x+y))/
ddf
(0.5*dt*(x+y))))

1064  
df
(0.5*
dt
*(
x
+
y
));

1065  (
	gfx
-
	gfy
)/(
x
*
	gdt
-
y
*dt);

1068 autØ
	gdiv_dif_exp
=[](
ty³0
& 
dt
,
	gty³0
& 
	gx
,ty³0& 
	gy
,ty³0& 
	gfx
,ty³0& 
	gfy
)->type0

1070 if(
çbs
((
x
-
y
)*
dt
)<
	gsq¹_•s
)

1071  
exp
(0.5*
dt
*(
x
+
y
));

1072  (
	gfx
-
	gfy
)/((
	gx
-
	gy
)*
	gdt
);

1075 
	gF_A
[0][0]=
f
(
dt
*
A
[0][0]);

1076 
	gF_A
[1][1]=
f
(
dt
*
A
[1][1]);

1077 
	gF_A
[2][2]=
f
(
dt
*
A
[2][2]);

1078 
	gF_A
[2][1]=
F_A
[1][0]=F_A[2][0]=0.0;

1080 
	gEXP_A
[0][0]=
exp
(
dt
*
A
[0][0]);

1081 
	gEXP_A
[1][1]=
exp
(
dt
*
A
[1][1]);

1082 
	gEXP_A
[2][2]=
exp
(
dt
*
A
[2][2]);

1083 
	gEXP_A
[2][1]=
EXP_A
[1][0]=EXP_A[2][0]=0.0;

1087 
ty³0
 
	gf_yz
=0.0,
	gf_zx
=0.0,
	gf_xy
=0.0,
	gg_yz
=0.0,
	gg_zx
=0.0,
	gg_xy
=0.0;

1088 if(
	gA
[2][1]!=0.0)

1090 
f_yz
=
div_dif_f
(
dt
,
A
[1][1],A[2][2],
F_A
[1][1],F_A[2][2]);

1091 
	gg_yz
=
div_dif_exp
(
dt
,
A
[1][1],A[2][2],
EXP_A
[1][1],EXP_A[2][2]);

1093 if(
	gA
[2][0]!=0.0)

1095 
f_zx
=
div_dif_f
(
dt
,
A
[2][2],A[0][0],
F_A
[2][2],F_A[0][0]);

1096 
	gg_zx
=
div_dif_exp
(
dt
,
A
[2][2],A[0][0],
EXP_A
[2][2],EXP_A[0][0]);

1098 if(
	gA
[1][0]!=0.0)

1100 
f_xy
=
div_dif_f
(
dt
,
A
[0][0],A[1][1],
F_A
[0][0],F_A[1][1]);

1101 
	gg_xy
=
div_dif_exp
(
dt
,
A
[0][0],A[1][1],
EXP_A
[0][0],EXP_A[1][1]);

1105 
	gF_A
[0][0]*=
dt
;

1106 
	gF_A
[1][1]*=
dt
;

1107 
	gF_A
[2][2]*=
dt
;

1108 
	gF_A
[2][1]=
A
[2][1]*
dt
*dt*
f_yz
;

1109 
	gF_A
[2][0]=
A
[2][0]*
dt
*dt*
f_zx
;

1110 
	gF_A
[1][0]=
A
[1][0]*
dt
*dt*
f_xy
;

1112 
	gEXP_A
[2][1]=
A
[2][1]*
dt
*
g_yz
;

1113 
	gEXP_A
[2][0]=
A
[2][0]*
dt
*
g_zx
;

1114 
	gEXP_A
[1][0]=
A
[1][0]*
dt
*
g_xy
;

1117 if(
	gA
[1][0]==0.0 || 
A
[2][1]==0.0)

1120 autØ
	gdiv_dif_f3
=[](
ty³0
& 
dt
,
	gty³0
& 
	gx
,ty³0& 
	gy
,ty³0& 
	gz
,ty³0& 
	gf_yz
,ty³0& 
	gf_zx
,ty³0& 
	gf_xy
)->type0

1122 
ty³0
 
	g__ddf
=
ddf
((
x
+
y
+
z
)*
dt
/3.0);

1123 
ty³0
 
	glim
=
sq¹
(
¡d
::
num”ic_lim™s
<ty³0>::
•sÚ
()*
f
((
x
+
y
+
z
)*
dt
/3.0)/
__ddf
);

1125 if(
çbs
((
x
-
z
)*
dt
)>
	glim
)

1126  (
	gf_xy
-
	gf_yz
)/((
	gx
-
	gz
)*
	gdt
);

1128 if(
çbs
((
y
-
x
)*
dt
)>
	glim
)

1129  (
	gf_yz
-
	gf_zx
)/((
	gy
-
	gx
)*
	gdt
);

1131 if(
çbs
((
z
-
y
)*
dt
)>
	glim
)

1132  (
	gf_zx
-
	gf_xy
)/((
	gz
-
	gy
)*
	gdt
);

1134  
	g__ddf
;

1137 autØ
	gdiv_dif_exp3
=[](
ty³0
& 
dt
,
	gty³0
& 
	gx
,ty³0& 
	gy
,ty³0& 
	gz
,ty³0& 
	gf_yz
,ty³0& 
	gf_zx
,ty³0& 
	gf_xy
)->type0

1139 if(
çbs
((
x
-
z
)*
dt
)>
	gsq¹_•s
)

1140  (
	gf_xy
-
	gf_yz
)/((
	gx
-
	gz
)*
	gdt
);

1142 if(
çbs
((
y
-
x
)*
dt
)>
	gsq¹_•s
)

1143  (
	gf_yz
-
	gf_zx
)/((
	gy
-
	gx
)*
	gdt
);

1145 if(
çbs
((
z
-
y
)*
dt
)>
	gsq¹_•s
)

1146  (
	gf_zx
-
	gf_xy
)/((
	gz
-
	gy
)*
	gdt
);

1148  
exp
((
x
+
y
+
z
)*
dt
/3.0);

1151 
	gF_A
[2][0]+=
dt
*dt*dt*
A
[2][1]*A[1][0]*
div_dif_f3
(dt,A[0][0],A[1][1],A[2][2],
f_yz
,
f_zx
,
f_xy
);

1152 
	gEXP_A
[2][0]+=
dt
*dt*
A
[2][1]*A[1][0]*
div_dif_exp3
(dt,A[0][0],A[1][1],A[2][2],
g_yz
,
g_zx
,
g_xy
);

1157 
	gMDM©h
::
ÿlc
(
ty³0
& 
dt
,ty³0(&
A
)[2][2],ty³0(&
EXP_A
)[2][2],ty³0(&
F_A
)[2][2])

1159 autØ
	gdiv_dif_f
=[](
ty³0
 
dt
,
	gty³0
& 
	gx
,ty³0& 
	gy
,ty³0& 
	gfx
,ty³0& 
	gfy
)->type0

1161 if(
çbs
(
x
-
y
)<
sq¹
(
¡d
::
num”ic_lim™s
<
ty³0
>::
•sÚ
()*
f
(0.5*
dt
*(x+y))/
ddf
(0.5*dt*(x+y))))

1162  
df
(0.5*
dt
*(
x
+
y
));

1163  (
	gfx
-
	gfy
)/(
x
*
	gdt
-
y
*dt);

1166 autØ
	gdiv_dif_exp
=[](
ty³0
& 
dt
,
	gty³0
& 
	gx
,ty³0& 
	gy
,ty³0& 
	gfx
,ty³0& 
	gfy
)->type0

1168 if(
çbs
((
x
-
y
)*
dt
)<
	gsq¹_•s
)

1169  
exp
(0.5*
dt
*(
x
+
y
));

1170  (
	gfx
-
	gfy
)/((
	gx
-
	gy
)*
	gdt
);

1173 
	gF_A
[0][0]=
f
(
dt
*
A
[0][0]);

1174 
	gF_A
[1][1]=
f
(
dt
*
A
[1][1]);

1175 
	gF_A
[1][0]=0.0;

1177 
	gEXP_A
[0][0]=
exp
(
dt
*
A
[0][0]);

1178 
	gEXP_A
[1][1]=
exp
(
dt
*
A
[1][1]);

1179 
	gEXP_A
[1][0]=0.0;

1181 if(
	gA
[1][0]!=0.0)

1183 
F_A
[1][0]=
A
[1][0]*
dt
*dt*
div_dif_f
(dt,A[0][0],A[1][1],F_A[0][0],F_A[1][1]);

1184 
	gEXP_A
[1][0]=
A
[1][0]*
div_dif_exp
(
dt
,A[0][0],A[1][1],
EXP_A
[0][0],EXP_A[1][1]);

1186 
	gF_A
[0][0]*=
dt
;

1187 
	gF_A
[1][1]*=
dt
;

1192 
	gMDM©h
::
ÿlc
(
ty³0
& 
dt
,ty³0(&
A
)[1][1],ty³0(&
EXP_A
)[1][1],ty³0(&
F_A
)[1][1])

1194 
	gEXP_A
[0][0]=
exp
(
A
[0][0]*
dt
);

1195 
	gF_A
[0][0]=
dt
*
f
(dt*
A
[0][0]);

	@md_nst.h

1 #iâdeà
__MAPP__md_n¡__


2 
	#__MAPP__md_n¡__


	)

3 
	~"md_nvt.h
"

7 
Çme¥aû
 
	gMAPP_NS


10 şas 
	cMDNST
:
public
 
MDNVT


12 
´iv©e
:

13 
ty³0
 
MLT0
[
__dim__
][__dim__];

14 
ty³0
 
	gMLT1
[
__dim__
][__dim__];

15 
ty³0
 
	gMLT2
[
__dim__
][__dim__];

16 
ty³0
 
	gS_dev
[
__dim__
][__dim__];

17 
ty³0
 
	gs_hyd
;

18 
ty³0
 
	gB_»f
[
__dim__
][__dim__];

21 
ty³0
 
	gV_H_´eçc
[
__dim__
][__dim__];

24 
ty³0
 
	gv0
[
__dim__
];

25 
ty³0
 
	gv1
[
__dim__
];

28 
ty³0
 
	gV_H
[
__dim__
][__dim__];

29 
ty³0
 
	gvŞ_»f
;

30 
	g´Ùeùed
:

34 
ty³0
 
T_b¬o
;

35 
	gndof_b¬o
;

36 
Th”mo¡©NHC
 
	gth”mo_b¬o
;

41 
boŞ
 
	gS_dof
[
__dim__
][__dim__];

42 
ty³0
 
	gS
[
__dim__
][__dim__];

43 
ty³0
 
	gu
[
__dim__
][__dim__];

44 
	gÄe£t
;

46 
upd©e_x_d__x__x_d
(
ty³0
);

47 
upd©e_x_d__x__x_d_w_dof
(
ty³0
);

48 
upd©e_V_H
();

49 
chªge_dt
(
ty³0
);

50 
´e_run_chk
(
AtomsMD
*,
FÜûF›ldMD
*);

51 
´e_š™
();

52 
	gpublic
:

53 
MDNST
(
ty³0
(&)[
__dim__
][__dim__],type0,type0);

54 
	gvœtu®
 ~
MDNST
();

56 
š™
();

57 
run
();

58 
fš
();

65 
PyObjeù_HEAD


66 
MDNST
* 
	gmd
;

67 
	gExpÜtMD
::
Objeù
* 
x´t
;

68 }
	tObjeù
;

71 
PyTy³Objeù
 
	gTy³Objeù
;

72 
PyObjeù
* 
__Ãw__
(
PyTy³Objeù
*,PyObject*, PyObject*);

73 
__š™__
(
PyObjeù
*, PyObject*,PyObject*);

74 
PyObjeù
* 
__®loc__
(
PyTy³Objeù
*,
Py_ssize_t
);

75 
__d—Îoc__
(
PyObjeù
*);

77 
PyG‘S‘Def
 
	gg‘£t
[];

78 
£tup__g‘£t
();

79 
g‘£t_n™”s_s
(
PyG‘S‘Def
&);

80 
g‘£t_L_s
(
PyG‘S‘Def
&);

81 
g‘£t_t_»Ïx_s
(
PyG‘S‘Def
&);

82 
g‘£t_S
(
PyG‘S‘Def
&);

83 
g‘£t_u
(
PyG‘S‘Def
&);

84 
g‘£t_Äe£t
(
PyG‘S‘Def
&);

86 
£tup_
();

93 
	~"xm©h.h
"

94 
Çme¥aû
 
	gMAPP_NS


96 
Çme¥aû
 
	gMDM©h


99 cÚ¡ 
ty³0
 
	gsq¹_•s
=
sq¹
(
¡d
::
num”ic_lim™s
<ty³0>::
•sÚ
());

100 
	g‹m¶©e
<cÚ¡ 
	gdim
>

101 
ÿlc
(
ty³0
&,ty³0(&)[
dim
][dim],type0(&)[dim][dim],type0(&)[dim][dim]){};

102 
ÿlc
(cÚ¡ 
ty³0
,constype0&,constype0&,type0(&)[3][3],type0(&)[3][3],type0(&)[3][3],type0(&)[3][3]);

103 
ÿlc
(cÚ¡ 
ty³0
,constype0&,constype0&,type0(&)[2][2],type0(&)[2][2],type0(&)[2][2],type0(&)[2][2]);

104 
ÿlc
(cÚ¡ 
ty³0
,constype0&,constype0&,type0(&)[1][1],type0(&)[1][1],type0(&)[1][1],type0(&)[1][1]);

105 
ÿlc
(
ty³0
&,type0(&)[3][3],type0(&)[3][3],type0(&)[3][3]);

106 
ÿlc
(
ty³0
&,type0(&)[2][2],type0(&)[2][2],type0(&)[2][2]);

107 
ÿlc
(
ty³0
&,type0(&)[1][1],type0(&)[1][1],type0(&)[1][1]);

109 
ty³0
 
f
(type0);

110 
ty³0
 
df
(type0);

111 
ty³0
 
ddf
(type0);

112 
ty³0
 
dddf
(type0);

114 
	g‹m¶©e
<cÚ¡ 
	gi
,cÚ¡ 
	gdim
>

115 şas 
	c____NONAME0


117 
	gpublic
:

118 
‹m¶©e
<
şass
 
T
>

119 
šlše
 
func
(cÚ¡ 
T
& 
xi
,T* 
x_d
,T* 
MLT_x_d
,cÚ¡ T& 
m_šv
,T* 
f
,T* 
MLT_f
)

121 *
	gx_d
=
xi
*
Algeb¿
::
__V_¡rd_mul_V
<
i
,
	gdim
>::
func
(
MLT_x_d
,
x_d
)+
m_šv
*
	gAlgeb¿
::__V_¡rd_mul_V<i,dim>::func(
MLT_f
,
f
);

122 
	g____NONAME0
<
	gi
-1,
	gdim
>::
func
(
xi
,
x_d
+1,
MLT_x_d
+
dim
+1,
m_šv
,
f
+1,
MLT_f
+dim+1);

125 
	g‹m¶©e
<
şass
 
	gT
>

126 
šlše
 
func
(
T
* 
x_d
,T* 
MLT_x_d
,cÚ¡ T& 
m_šv
,T* 
f
,T* 
MLT_f
)

128 *
	gx_d
=
Algeb¿
::
__V_¡rd_mul_V
<
i
,
	gdim
>::
func
(
MLT_x_d
,
x_d
)+
m_šv
*
	gAlgeb¿
::__V_¡rd_mul_V<i,dim>::func(
MLT_f
,
f
);

129 
	g____NONAME0
<
	gi
-1,
	gdim
>::
func
(
x_d
+1,
MLT_x_d
+
dim
+1,
m_šv
,
f
+1,
MLT_f
+dim+1);

133 
	g‹m¶©e
<cÚ¡ 
	gdim
>

134 
şass
 
	g____NONAME0
<1,
	gdim
>

136 
	gpublic
:

137 
‹m¶©e
<
şass
 
T
>

138 
šlše
 
func
(cÚ¡ 
T
& 
xi
,T* 
x_d
,T* 
MLT_x_d
,cÚ¡ T& 
m_šv
,T* 
f
,T* 
MLT_f
)

140 *
	gx_d
=
xi
**
MLT_x_d
**
x_d
+
m_šv
**
MLT_f
**
f
;

142 
	g‹m¶©e
<
şass
 
	gT
>

143 
šlše
 
func
(
T
* 
x_d
,T* 
MLT_x_d
,cÚ¡ T& 
m_šv
,T* 
f
,T* 
MLT_f
)

145 *
	gx_d
=*
MLT_x_d
**
x_d
+
m_šv
**
MLT_f
**
f
;

150 
	g‹m¶©e
<cÚ¡ 
	gi
,cÚ¡ 
	gdim
>

151 şas 
	c____NONAME1


153 
	gpublic
:

154 
‹m¶©e
<
şass
 
T
>

155 
šlše
 
func
(
T
* 
x
,T* 
MLT_x
,T* 
x_d
,T* 
dx
)

157 *
	gdx
=
Algeb¿
::
__V_¡rd_mul_V
<
i
,
	gdim
>::
func
(
MLT_x
,
x
)+*
	gx_d
;

158 
	g____NONAME1
<
	gi
-1,
	gdim
>::
func
(
x
+1,
MLT_x
+
dim
+1,
x_d
+1,
dx
+1);

162 
	g‹m¶©e
<cÚ¡ 
	gdim
>

163 
şass
 
	g____NONAME1
<1,
	gdim
>

165 
	gpublic
:

166 
‹m¶©e
<
şass
 
T
>

167 
šlše
 
func
(
T
* 
x
,T* 
MLT_x
,T* 
x_d
,T* 
dx
)

169 *
	gdx
=*
MLT_x
**
x
+*
x_d
;

173 
	g‹m¶©e
<cÚ¡ 
	gi
,cÚ¡ 
	gdim
>

174 şas 
	c____NONAME2


176 
	gpublic
:

177 
‹m¶©e
<
şass
 
T
>

178 
šlše
 
func
(
T
* 
dx
,T* 
MLT
)

180 *
	gdx
=
Algeb¿
::
__V_¡rd_mul_V
<
i
,
	gdim
>::
func
(
MLT
,
dx
);

181 
	g____NONAME2
<
	gi
-1,
	gdim
>::
func
(
dx
+1,
MLT
+
dim
+1);

185 
	g‹m¶©e
<cÚ¡ 
	gdim
>

186 
şass
 
	g____NONAME2
<1,
	gdim
>

188 
	gpublic
:

189 
‹m¶©e
<
şass
 
T
>

190 
šlše
 
func
(
T
* 
dx
,T* 
MLT
)

192 *
	gdx
*=*
MLT
;

	@md_nvt.cpp

1 
	~"md_nvt.h
"

2 
	~"xm©h.h
"

3 
	~"©oms_md.h
"

4 
	~"ff_md.h
"

5 
	~"–em’ts.h
"

6 
	~"dyÇmic_md.h
"

7 
	~"MAPP.h
"

8 
	~"th”mo_dyÇmics.h
"

9 
	~<m©h.h
>

10 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

14 
	gMDNVT
::
	$MDNVT
(
ty³0
 
__T
,ty³0 
__dt
):

15 
	`dyÇmic
(
NULL
),

16 
	`©oms
(
NULL
),

17 
	`ff
(
NULL
),

18 
	`x´t
(
NULL
),

19 
	`dt
(
__dt
),

20 
	`T
(
__T
),

21 
	`dt2
(
__dt
/2.0),

22 
	`Á®ly
(10000),

23 
	`th”mo_·¹
(
__dt
/2.0,100.0*__dt,3,1)

25 
	}
}

29 
	gMDNVT
::~
	$MDNVT
()

31 
	}
}

35 
MDNVT
::
	$chªge_dt
(
ty³0
 
__dt
)

37 if(
__dt
==
dt
) ;

38 
dt
=
__dt
;

39 
dt2
=
__dt
/2;

41 
L
=
th”mo_·¹
.L;

42 
n™”s
=
th”mo_·¹
.niters;

43 
ty³0
 
t_»Ïx
=
th”mo_·¹
.t_relax;

45 
th”mo_·¹
.~
	`Th”mo¡©NHC
();

46 
	`Ãw
 (&
th”mo_·¹
è
	`Th”mo¡©NHC
(
__dt
/2.0,
t_»Ïx
,
L
,
n™”s
);

47 
	}
}

51 
	gMDNVT
::
	$upd©e_x_d_fš®
(
ty³0
 
çc_x_d
)

53 cÚ¡ 
n
=
©oms
->
Çtms_lş
*
__dim__
;

54 
ty³0
* 
x_d
=
©oms
->x_d->
	`begš
();

55 
i
=0;i<
n
;i++è
x_d
[i]*=
çc_x_d
;

56 
	}
}

60 
	gMDNVT
::
	$upd©e_x_d_fš®_w_dof
(
ty³0
 
çc_x_d
)

62 cÚ¡ 
n
=
©oms
->
Çtms_lş
*
__dim__
;

63 
ty³0
* 
x_d
=
©oms
->x_d->
	`begš
();

64 
boŞ
* 
dof
=
©oms
->
x_dof
->
	`begš
();

65 
i
=0;i<
n
;i++èif(
dof
[i]è
x_d
[i]*=
çc_x_d
;

66 
	}
}

70 
	gMDNVT
::
	$upd©e_x_d__x__x_d
(
ty³0
 
çc_x_d
)

72 
ty³0
* 
x
=
©oms
->x->
	`begš
();

73 
ty³0
* 
f
=
ff
->f->
	`begš
();

74 
ty³0
* 
x_d
=
©oms
->x_d->
	`begš
();

75 
–em_ty³
* 
–em
=
©oms
->–em->
	`begš
();

76 
ty³0
* 
m
=
©oms
->
–em’ts
.
mas£s
;

77 
ty³0
 
m_i
;

78 
ty³0
 
dx_lş
[
__dim__
]={
	`DESIG
(__dim__,0.0)};

79 cÚ¡ 
Çtms0
=
©oms
->
Çtms_lş
;

80 
i
=0;i<
Çtms0
;++i)

82 
m_i
=
m
[*
–em
];

83 
Algeb¿
::
Do
<
__dim__
>::
	`func
([&
dx_lş
,&
x_d
,&
x
,&
f
,&
m_i
,&
çc_x_d
,
this
](cÚ¡ 
j
)

85 
x_d
[
j
]=x_d[j]*
çc_x_d
+
f
[j]*
dt2
/
m_i
;

86 
dx_lş
[
j
]+=
x_d
[j]*
dt
;

87 
x
[
j
]+=
x_d
[j]*
dt
;

90 
f
+=
__dim__
;

91 
x_d
+=
__dim__
;

92 
x
+=
__dim__
;

93 ++
–em
;

95 
ty³0
 
dx
[
__dim__
]={
	`DESIG
(__dim__,0.0)};

96 
	`MPI_AÎ»duû
(
dx_lş
,
dx
,
__dim__
,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
©oms
->
wÜld
);

97 
ty³0
 
Çtms
=
¡©ic_ÿ¡
<ty³0>(
©oms
->natms);

98 
Algeb¿
::
Do
<
__dim__
>::
	`func
([&
dx
,
Çtms
](cÚ¡ 
i
){dx[i]/=natms;});

99 
x
=
©oms
->x->
	`begš
();

100 
i
=0;i<
Çtms0
;++i,
x
+=
__dim__
)

101 
Algeb¿
::
Do
<
__dim__
>::
	`func
([&
dx
,&
x
](cÚ¡ 
j
){x[j]-=dx[j];});

104 #ifdeà
OLD_UPDATE


105 
dyÇmic
->
	`upd©e
(
©oms
->
x
);

107 
dyÇmic
->
upd©e
<
Œue
>();

109 
ff
->
	`fÜû_ÿlc
();

111 
f
=
ff
->f->
	`begš
();

112 
x_d
=
©oms
->x_d->
	`begš
();

113 
–em
=
©oms
->–em->
	`begš
();

114 
Algeb¿
::
z”o
<
__nvoigt__
>(
__vec_lş
);

115 cÚ¡ 
Çtms1
=
©oms
->
Çtms_lş
;

117 
i
=0;i<
Çtms1
;++i)

119 
m_i
=
m
[*
–em
];

120 
Algeb¿
::
Do
<
__dim__
>::
	`func
([&
x_d
,&
f
,&
m_i
,
this
](cÚ¡ 
j
){x_d[j]+=f[j]*
dt2
/m_i;});

121 
Algeb¿
::
DyadicV
<
__dim__
>(
m_i
,
x_d
,
__vec_lş
);

123 
f
+=
__dim__
;

124 
x_d
+=
__dim__
;

125 ++
–em
;

127 
	`MPI_AÎ»duû
(
__vec_lş
,
mvv
,
__nvoigt__
,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
©oms
->
wÜld
);

128 
T_·¹
=
Algeb¿
::
Tr_DyadicV
<
__dim__
>(
mvv
)/(
ndof_·¹
*
kB
);

129 
	}
}

133 
	gMDNVT
::
	$upd©e_x_d__x__x_d_w_dof
(
ty³0
 
çc_x_d
)

135 
ty³0
* 
x
=
©oms
->x->
	`begš
();

136 
ty³0
* 
f
=
ff
->f->
	`begš
();

137 
ty³0
* 
x_d
=
©oms
->x_d->
	`begš
();

138 
–em_ty³
* 
–em
=
©oms
->–em->
	`begš
();

139 
ty³0
* 
m
=
©oms
->
–em’ts
.
mas£s
;

140 
ty³0
 
m_i
;

141 
ty³0
 
dx_lş
[
__dim__
]={
	`DESIG
(__dim__,0.0)};

142 cÚ¡ 
Çtms0
=
©oms
->
Çtms_lş
;

143 
boŞ
* 
dof
=
©oms
->
x_dof
->
	`begš
();

144 
i
=0;i<
Çtms0
;++i)

146 
m_i
=
m
[*
–em
];

147 
Algeb¿
::
Do
<
__dim__
>::
	`func
([&
dof
,&
dx_lş
,&
x_d
,&
x
,&
f
,&
m_i
,&
çc_x_d
,
this
](cÚ¡ 
j
)

149 if(
dof
[
j
])

151 
x_d
[
j
]=x_d[j]*
çc_x_d
+
f
[j]*
dt2
/
m_i
;

152 
dx_lş
[
j
]+=
x_d
[j]*
dt
;

155 
x
[
j
]+=
x_d
[j]*
dt
;

158 
f
+=
__dim__
;

159 
x_d
+=
__dim__
;

160 
x
+=
__dim__
;

161 
dof
+=
__dim__
;

162 ++
–em
;

164 
ty³0
 
dx
[
__dim__
]={
	`DESIG
(__dim__,0.0)};

165 
	`MPI_AÎ»duû
(
dx_lş
,
dx
,
__dim__
,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
©oms
->
wÜld
);

167 
Algeb¿
::
Do
<
__dim__
>::
	`func
([&
dx
,
this
](cÚ¡ 
i
){dx[i]/=
Ndof_·¹
[i];});

168 
x
=
©oms
->x->
	`begš
();

169 
dof
=
©oms
->
x_dof
->
	`begš
();

170 
i
=0;i<
Çtms0
;++i,
x
+=
__dim__
,
dof
+=__dim__)

171 
Algeb¿
::
Do
<
__dim__
>::
	`func
([&
dx
,&
x
,&
dof
](cÚ¡ 
j
){if(dof[j]) x[j]-=dx[j];});

174 #ifdeà
OLD_UPDATE


175 
dyÇmic
->
	`upd©e
(
©oms
->
x
);

177 
dyÇmic
->
upd©e
<
Œue
>();

179 
ff
->
	`fÜû_ÿlc
();

181 
f
=
ff
->f->
	`begš
();

182 
x_d
=
©oms
->x_d->
	`begš
();

183 
–em
=
©oms
->–em->
	`begš
();

184 
dof
=
©oms
->
x_dof
->
	`begš
();

185 
Algeb¿
::
z”o
<
__nvoigt__
>(
__vec_lş
);

186 
ty³0
 
__x_d
[
__dim__
];

187 cÚ¡ 
Çtms1
=
©oms
->
Çtms_lş
;

189 
i
=0;i<
Çtms1
;++i)

191 
m_i
=
m
[*
–em
];

192 
Algeb¿
::
Do
<
__dim__
>::
	`func
([&
x_d
,&
f
,&
m_i
,&
dof
,&
__x_d
,
this
](cÚ¡ 
j
)

194 
x_d
[
j
]+=
f
[j]*
dt2
/
m_i
;

195 if(
dof
[
j
])

196 
__x_d
[
j
]=
x_d
[j];

198 
__x_d
[
j
]=0.0;

200 
Algeb¿
::
DyadicV
<
__dim__
>(
m_i
,
__x_d
,
__vec_lş
);

202 
f
+=
__dim__
;

203 
x_d
+=
__dim__
;

204 
dof
+=
__dim__
;

205 ++
–em
;

207 
	`MPI_AÎ»duû
(
__vec_lş
,
mvv
,
__nvoigt__
,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
©oms
->
wÜld
);

208 
T_·¹
=
Algeb¿
::
Tr_DyadicV
<
__dim__
>(
mvv
)/(
ndof_·¹
*
kB
);

209 
	}
}

213 
	gMDNVT
::
	$´e_run_chk
(
AtomsMD
* 
©oms
,
FÜûF›ldMD
* 
ff
)

216 if(!
©oms
)

217 
throw
 
¡d
::
	`¡ršg
("cannot start md without initial conditions");

220 if(!
ff
)

221 
throw
 
¡d
::
	`¡ršg
("cannot start md without governingƒquations (force field)");

223 if(
¡d
::
	`i¢ª
(
©oms
->
kB
))

224 
throw
 
¡d
::
	`¡ršg
("boltzmann constant should be set…rioro MD");

225 
	}
}

229 
	gMDNVT
::
	$´e_š™
()

231 
dof_em±y
=
©oms
->
x_dof
->
	`is_em±y
();

232 
kB
=
©oms
->kB;

237 
Çtms
=
©oms
->natms;

238 
ndof_·¹
=
©oms
->
Çtms
*
__dim__
;

239 
Algeb¿
::
Do
<
__dim__
>::
	`func
([
this
,&
Çtms
](
i
){
Ndof_·¹
[i]=
¡©ic_ÿ¡
<
ty³0
>(natms);});

241 if(!
dof_em±y
)

243 
boŞ
* 
dof
=
©oms
->
x_dof
->
	`begš
();

244 
Ndof_»d_lş
[
__dim__
]={
	`DESIG
(__dim__,0)};

245 
Çtms_lş
=
©oms
->natms_lcl;

247 
i
=0;i<
Çtms_lş
;i++,
dof
+=
__dim__
)

248 
Algeb¿
::
Do
<
__dim__
>::
	`func
([&
dof
,&
Ndof_»d_lş
](
j
){if(!dof[j])Ndof_red_lcl[j]++;});

250 
Ndof_»d
[
__dim__
]={
	`DESIG
(__dim__,0)};

252 
	`MPI_AÎ»duû
(
Ndof_»d_lş
,
Ndof_»d
,
__dim__
,
MPI_INT
,
MPI_SUM
,
©oms
->
wÜld
);

254 
Algeb¿
::
Do
<
__dim__
>::
	`func
([&
Ndof_»d
,
this
](
i
)

256 
ndof_·¹
-=
Ndof_»d
[
i
];

257 
Ndof_·¹
[
i
]-=
¡©ic_ÿ¡
<
ty³0
>(
Ndof_»d
[i]);

264 if(
©oms
->
x_d
->
	`is_em±y
())

266 
©oms
->
x_d
->
	`fl
();

267 
Algeb¿
::
Do
<
__nvoigt__
>::
	`func
([
this
](
i
){
mvv
[i]=0.0;});

268 
T_·¹
=0.0;

272 
ty³0
* 
x_d
=
©oms
->x_d->
	`begš
();

273 
ty³0
* 
m
=
©oms
->
–em’ts
.
mas£s
;

274 
ty³0
 
m_i
;

275 
–em_ty³
* 
–em
=
©oms
->–em->
	`begš
();

276 
Algeb¿
::
z”o
<
__nvoigt__
>(
__vec_lş
);

277 cÚ¡ 
Çtms_lş
=
©oms
->natms_lcl;

278 if(
dof_em±y
)

280 
i
=0;i<
Çtms_lş
;i++)

282 
m_i
=
m
[*
–em
];

283 
Algeb¿
::
DyadicV
<
__dim__
>(
m_i
,
x_d
,
__vec_lş
);

284 
x_d
+=
__dim__
;

285 ++
–em
;

290 
boŞ
* 
dof
=
©oms
->
x_dof
->
	`begš
();

291 
ty³0
 
__x_d
[
__dim__
];

292 
i
=0;i<
Çtms_lş
;i++)

294 
Algeb¿
::
V_eq
<
__dim__
>(
x_d
,
__x_d
);

295 
Algeb¿
::
Do
<
__dim__
>::
	`func
([&
dof
,&
x_d
,&
__x_d
](
i
){__x_d[i]=dof[i] ? x_d[i]:0.0;});

296 
m_i
=
m
[*
–em
];

297 
Algeb¿
::
DyadicV
<
__dim__
>(
m_i
,
__x_d
,
__vec_lş
);

299 
dof
+=
__dim__
;

300 
x_d
+=
__dim__
;

301 ++
–em
;

305 
	`MPI_AÎ»duû
(
__vec_lş
,
mvv
,
__nvoigt__
,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
©oms
->
wÜld
);

306 
T_·¹
=
Algeb¿
::
Tr_DyadicV
<
__dim__
>(
mvv
)/(
ndof_·¹
*
kB
);

308 
	}
}

312 
	gMDNVT
::
	$š™
()

314 
	`´e_š™
();

316 
dyÇmic
=
Ãw
 
	`DyÇmicMD
(
©oms
,
ff
,
çl£
,{},{©oms->
x_d
,©oms->
x_dof
},{});

317 
dyÇmic
->
	`š™
();

319 if(
x´t
)

321 
Œy


323 
x´t
->
©oms
=atoms;

324 
x´t
->
	`š™
();

326 
	`ÿtch
(
¡d
::
¡ršg
& 
”r_msg
)

328 
	`fš
();

329 
throw
 
”r_msg
;

332 
	}
}

336 
	gMDNVT
::
	$fš
()

338 if(
x´t
)

340 
x´t
->
	`fš
();

341 
x´t
->
©oms
=
NULL
;

344 
dyÇmic
->
	`fš
();

345 
d–‘e
 
dyÇmic
;

346 
dyÇmic
=
NULL
;

347 
	}
}

351 
	gMDNVT
::
	$run
(
n¡•s
)

353 
¡•
=
©oms
->step;

355 
ff
->
	`fÜû_ÿlc
();

357 
Ãv”y_x´t
=
x´t
==
NULL
 ? 0:x´t->
Ãv”y
;

358 if(
Ãv”y_x´t
è
x´t
->
	`wr™e
(
¡•
);

360 
Th”moDyÇmics
 
	`th”mo
(6,"T",
T_·¹
,"PE",
©oms
->
³
,

361 "S[0][0]",
S_·¹
[0][0],

362 "S[1][1]",
S_·¹
[1][1],

363 "S[2][2]",
S_·¹
[2][2],

364 "S[1][2]",
S_·¹
[2][1],

365 "S[2][0]",
S_·¹
[2][0],

366 "S[0][1]",
S_·¹
[1][0]);

368 if(
Á®ly
è
th”mo
.
	`š™
();

369 
Algeb¿
::
DoLT
<
__dim__
>::
	`func
([
this
](cÚ¡ 
i
,cÚ¡ 
j
)

371 
S_·¹
[
i
][
j
]=
©oms
->
S_³
[i][j]-
mvv
[i+j*
__dim__
-j*(j+1)/2]/©oms->
vŞ
;

375 if(
Á®ly
è
th”mo
.
	`´št
(
¡•
);

377 
ty³0
 
çc
,
çc_x_d
=1.0;

378 if(
dof_em±y
)

380 
i¡•
=0;i¡•<
n¡•s
;istep++)

383 
çc_x_d
*=
çc
=
	`th”mo_·¹
(
T_·¹
/
T
,
ndof_·¹
);

384 
çc
*=fac;

385 
Algeb¿
::
Do
<
__nvoigt__
>::
	`func
([
this
,&
çc
](
i
){
mvv
[i]*=fac;});

386 
T_·¹
*=
çc
;

388 
	`upd©e_x_d__x__x_d
(
çc_x_d
);

392 
çc_x_d
=
çc
=
	`th”mo_·¹
(
T_·¹
/
T
,
ndof_·¹
);

393 
çc
*=fac;

394 
Algeb¿
::
Do
<
__nvoigt__
>::
	`func
([
this
,&
çc
](
i
){
mvv
[i]*=fac;});

395 
T_·¹
*=
çc
;

398 
Algeb¿
::
DoLT
<
__dim__
>::
	`func
([
this
](cÚ¡ 
i
,cÚ¡ 
j
)

400 
S_·¹
[
i
][
j
]=
©oms
->
S_³
[i][j]-
mvv
[i+j*
__dim__
-j*(j+1)/2]/©oms->
vŞ
;

403 if(
Á®ly
 && (
i¡•
+1)%Á®ly==0è
th”mo
.
	`´št
(
¡•
+istep+1);

404 if(
Ãv”y_x´t
 && (
i¡•
+1)%Ãv”y_x´t==0è
x´t
->
	`wr™e
(
¡•
+istep+1);

409 
i¡•
=0;i¡•<
n¡•s
;istep++)

412 
çc_x_d
*=
çc
=
	`th”mo_·¹
(
T_·¹
/
T
,
ndof_·¹
);

413 
çc
*=fac;

414 
Algeb¿
::
Do
<
__nvoigt__
>::
	`func
([
this
,&
çc
](
i
){
mvv
[i]*=fac;});

415 
T_·¹
*=
çc
;

417 
	`upd©e_x_d__x__x_d_w_dof
(
çc_x_d
);

421 
çc_x_d
=
çc
=
	`th”mo_·¹
(
T_·¹
/
T
,
ndof_·¹
);

422 
çc
*=fac;

423 
Algeb¿
::
Do
<
__nvoigt__
>::
	`func
([
this
,&
çc
](
i
){
mvv
[i]*=fac;});

424 
T_·¹
*=
çc
;

427 
Algeb¿
::
DoLT
<
__dim__
>::
	`func
([
this
](cÚ¡ 
i
,cÚ¡ 
j
)

429 
S_·¹
[
i
][
j
]=
©oms
->
S_³
[i][j]-
mvv
[i+j*
__dim__
-j*(j+1)/2]/©oms->
vŞ
;

432 if(
Á®ly
 && (
i¡•
+1)%Á®ly==0è
th”mo
.
	`´št
(
¡•
+istep+1);

433 if(
Ãv”y_x´t
 && (
i¡•
+1)%Ãv”y_x´t==0è
x´t
->
	`wr™e
(
¡•
+istep+1);

437 if(
Á®ly
 && 
n¡•s
%Á®lyè
th”mo
.
	`´št
(
¡•
+nsteps);

438 if(
Ãv”y_x´t
 && 
n¡•s
%Ãv”y_x´tè
x´t
->
	`wr™e
(
¡•
+nsteps);

440 if(
dof_em±y
)

441 
	`upd©e_x_d_fš®
(
çc_x_d
);

443 
	`upd©e_x_d_fš®_w_dof
(
çc_x_d
);

445 if(
Á®ly
è
th”mo
.
	`fš
();

447 
©oms
->
¡•
+=
n¡•s
;

448 
	}
}

452 
PyObjeù
* 
	gMDNVT
::
	$__Ãw__
(
PyTy³Objeù
* 
ty³
,
PyObjeù
* 
¬gs
,PyObjeù* 
kwds
)

454 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
ty³
->
	`_®loc
(type,0));

455 
PyObjeù
* 
£lf
=
»š‹½»t_ÿ¡
<PyObjeù*>(
__£lf
);

456  
£lf
;

457 
	}
}

461 
	gMDNVT
::
	$__š™__
(
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)

463 
FuncAPI
<
ty³0
,ty³0> 
	`f
("__init__",{"T","dt"});

465 
f
.
logics
<0>()[0]=
	`VLogics
("gt",0.0);

466 
f
.
logics
<1>()[0]=
	`VLogics
("gt",0.0);

468 if(
	`f
(
¬gs
,
kwds
)==-1)  -1;

469 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

470 
__£lf
->
md
=
Ãw
 
	`MDNVT
(
f
.
v®
<0>(),f.val<1>());

471 
__£lf
->
x´t
=
NULL
;

474 
	}
}

478 
PyObjeù
* 
	gMDNVT
::
	$__®loc__
(
PyTy³Objeù
* 
ty³
,
Py_ssize_t
)

480 
Objeù
* 
__£lf
=
Ãw
 Object;

481 
	`Py_TYPE
(
__£lf
)=
ty³
;

482 
	`Py_REFCNT
(
__£lf
)=1;

483 
__£lf
->
md
=
NULL
;

484 
__£lf
->
x´t
=
NULL
;

485  
»š‹½»t_ÿ¡
<
PyObjeù
*>(
__£lf
);

486 
	}
}

490 
	gMDNVT
::
	$__d—Îoc__
(
PyObjeù
* 
£lf
)

492 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

493 
d–‘e
 
__£lf
->
md
;

494 
__£lf
->
md
=
NULL
;

495 if(
__£lf
->
x´t
è
	`Py_DECREF
(__self->xprt);

496 
__£lf
->
x´t
=
NULL
;

497 
d–‘e
 
__£lf
;

498 
	}
}

500 
PyTy³Objeù
 
	gMDNVT
::
Ty³Objeù
 ={
PyObjeù_HEAD_INIT
(
NULL
)};

502 
	gMDNVT
::
	$£tup_
()

504 
Ty³Objeù
.
_Çme
="mapp.md.nvt";

505 
Ty³Objeù
.
_doc
=
R
"---(

506 
	`__š™__
(
T
,
dt
)

508 :
m©h
:`
NVT
` 
’£mbË


510 
MŞecuÏr
 
dyÇmics
 
of
 
ÿnÚiÿl
 
’£mbË


512 
P¬am‘”s


514 
T
 : 

515 
Tem³¿tu»
 
of
 
the
 
’£mbË


516 
dt
 : 

517 
Time
 
¡•
 
simuÏtiÚ


519 
NÙes


521 * 
Th”mo¡©
 
D‘as


522 
No£
-
Hoov”
 
chaš


526 
Ty³Objeù
.
_æags
=
Py_TPFLAGS_DEFAULT
;

527 
Ty³Objeù
.
_basicsize
=(
Objeù
);

529 
Ty³Objeù
.
_Ãw
=
__Ãw__
;

530 
Ty³Objeù
.
_š™
=
__š™__
;

531 
Ty³Objeù
.
_®loc
=
__®loc__
;

532 
Ty³Objeù
.
_d—Îoc
=
__d—Îoc__
;

533 
	`£tup__m‘hods
();

534 
Ty³Objeù
.
_m‘hods
=
m‘hods
;

535 
	`£tup__g‘£t
();

536 
Ty³Objeù
.
_g‘£t
=
g‘£t
;

538 
ichk
=
	`PyTy³_R—dy
(&
Ty³Objeù
);

539 if(
ichk
<0)  ichk;

540 
	`Py_INCREF
(&
Ty³Objeù
);

541 
	`GET_WRAPPER_DOC
(
Ty³Objeù
,
__š™__
)=
NULL
;

542  
ichk
;

543 
	}
}

545 
PyG‘S‘Def
 
	gMDNVT
::
g‘£t
[]=
Em±yPyG‘S‘Def
(8);

547 
	gMDNVT
::
	$£tup__g‘£t
()

549 
	`g‘£t_T
(
g‘£t
[0]);

550 
	`g‘£t_dt
(
g‘£t
[1]);

551 
	`g‘£t_n™”s
(
g‘£t
[2]);

552 
	`g‘£t_L
(
g‘£t
[3]);

553 
	`g‘£t_t_»Ïx
(
g‘£t
[4]);

554 
	`g‘£t_expÜt
(
g‘£t
[5]);

555 
	`g‘£t_Á®ly
(
g‘£t
[6]);

556 
	}
}

558 
PyM‘hodDef
 
	gMDNVT
::
m‘hods
[]=
Em±yPyM‘hodDef
(2);

560 
	gMDNVT
::
	$£tup__m‘hods
()

562 
	`ml_run
(
m‘hods
[0]);

563 
	}
}

567 
	gMDNVT
::
	$g‘£t_T
(
PyG‘S‘Def
& 
g‘£t
)

569 
g‘£t
.
Çme
=(*)"T";

570 
g‘£t
.
doc
=(*)
R
"---(

571 (è
‹m³¿tu»


573 
Tem³¿tu»
 
of
 
the
 
’£mbË


575 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

577  
v¬
<
ty³0
>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->
T
);

579 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

581 
V¬API
<
ty³0
> 
	`T
("T");

582 
T
.
logics
[0]=
	`VLogics
("gt",0.0);

583 
ichk
=
T
.
	`£t
(
İ
);

584 if(
ichk
==-1)  -1;

585 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->
T
=T.
v®
;

588 
	}
}

592 
	gMDNVT
::
	$g‘£t_dt
(
PyG‘S‘Def
& 
g‘£t
)

594 
g‘£t
.
Çme
=(*)"dt";

595 
g‘£t
.
doc
=(*)
R
"---(

596 (è
dt


598 
Time
 
¡•
 
simuÏtiÚ


600 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

602  
v¬
<
ty³0
>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->
dt
);

604 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

606 
V¬API
<
ty³0
> 
	`dt
("dt");

607 
dt
.
logics
[0]=
	`VLogics
("gt",0.0);

608 
ichk
=
dt
.
	`£t
(
İ
);

609 if(
ichk
==-1)  -1;

611 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->
	`chªge_dt
(
dt
.
v®
);

614 
	}
}

618 
	gMDNVT
::
	$g‘£t_L
(
PyG‘S‘Def
& 
g‘£t
)

620 
g‘£t
.
Çme
=(*)"L";

621 
g‘£t
.
doc
=(*)
R
"---(

622 (è
Ëngth
 
of
 
·¹işe
 
NHC


624 
Numb”
 
of
 
lšks
 
š
 
NHC
 oà
·¹işe
 
th”mo¡©
, 
£e
 :
»f
:`
nhc
-ref`

626 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

628 
L
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->
th”mo_·¹
.L;

629  
v¬
<>::
	`bud
(
L
);

631 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

633 
V¬API
<> 
	`L
("L");

634 
L
.
logics
[0]=
	`VLogics
("gt",0);

635 
ichk
=
L
.
	`£t
(
İ
);

636 if(
ichk
==-1)  -1;

637 if(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->
th”mo_·¹
.
L
==L.
v®
)

640 
Th”mo¡©NHC
& 
th”mo_·¹
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->thermo_part;

641 
n™”s
=
th”mo_·¹
.niters;

642 
ty³0
 
t_»Ïx
=
th”mo_·¹
.t_relax;

643 
ty³0
 
__dt
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->
dt2
;

644 
th”mo_·¹
.~
	`Th”mo¡©NHC
();

645 
	`Ãw
 (&
th”mo_·¹
è
	`Th”mo¡©NHC
(
__dt
,
t_»Ïx
,
L
.
v®
,
n™”s
);

648 
	}
}

652 
	gMDNVT
::
	$g‘£t_n™”s
(
PyG‘S‘Def
& 
g‘£t
)

654 
g‘£t
.
Çme
=(*)"niters";

655 
g‘£t
.
doc
=(*)
R
"---(

656 (è
numb”
 
of
 
™”©iÚs
 
š
 
NHC
 
·¹işes


658 
Numb”
 
of
 
™”©iÚs
 
š
 
·¹işe
 
th”mo¡©
 
³r
 
—ch
 
¡•
 oà
evŞutiÚ
, 
£e
 :
»f
:`
nhc
-ref`

660 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

662 
n™”s
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->
th”mo_·¹
.niters;

663  
v¬
<>::
	`bud
(
n™”s
);

665 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

667 
V¬API
<> 
	`n™”s
("niters");

668 
n™”s
.
logics
[0]=
	`VLogics
("gt",0);

669 
ichk
=
n™”s
.
	`£t
(
İ
);

670 if(
ichk
==-1)  -1;

671 if(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->
th”mo_·¹
.
n™”s
=ò™”s.
v®
)

674 
Th”mo¡©NHC
& 
th”mo_·¹
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->thermo_part;

675 
L
=
th”mo_·¹
.L;

676 
ty³0
 
t_»Ïx
=
th”mo_·¹
.t_relax;

677 
ty³0
 
__dt
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->
dt2
;

678 
th”mo_·¹
.~
	`Th”mo¡©NHC
();

679 
	`Ãw
 (&
th”mo_·¹
è
	`Th”mo¡©NHC
(
__dt
,
t_»Ïx
,
L
,
n™”s
.
v®
);

682 
	}
}

686 
	gMDNVT
::
	$g‘£t_t_»Ïx
(
PyG‘S‘Def
& 
g‘£t
)

688 
g‘£t
.
Çme
=(*)"t_relax";

689 
g‘£t
.
doc
=(*)"thermostat…arameter,„elaxationime";

690 
g‘£t
.
doc
=(*)
R
"---(

691 (è
NHC
 
»Ïx©iÚ
 
·¿m‘”
 
·¹işes


693 
NHC
 
»Ïx©iÚ
 
	`·¿m‘”
 (
un™
 
of
 
time
è
·¹Ÿşe
 
th”mo¡©
. 
Roughly
 
equiv®’t
 
to
„–ax©iÚimoà
·¹işes
 
w™h
 
th”m®
 
b©h
, 
£e
 :
»f
:`
nhc
-ref`

695 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

697 
ty³0
 
t_»Ïx
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->
th”mo_·¹
.t_relax;

698  
v¬
<
ty³0
>::
	`bud
(
t_»Ïx
);

700 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

702 
V¬API
<
ty³0
> 
	`t_»Ïx
("t_relax");

703 
t_»Ïx
.
logics
[0]=
	`VLogics
("gt",0.0);

704 
ichk
=
t_»Ïx
.
	`£t
(
İ
);

705 if(
ichk
==-1)  -1;

706 if(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->
th”mo_·¹
.
t_»Ïx
=ñ_»Ïx.
v®
)

709 
Th”mo¡©NHC
& 
th”mo_·¹
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->thermo_part;

710 
L
=
th”mo_·¹
.L;

711 
n™”s
=
th”mo_·¹
.niters;

712 
ty³0
 
__dt
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->
dt2
;

713 
th”mo_·¹
.~
	`Th”mo¡©NHC
();

714 
	`Ãw
 (&
th”mo_·¹
è
	`Th”mo¡©NHC
(
__dt
,
t_»Ïx
.
v®
,
L
,
n™”s
);

717 
	}
}

721 
	gMDNVT
::
	$g‘£t_expÜt
(
PyG‘S‘Def
& 
g‘£t
)

723 
g‘£t
.
Çme
=(*)"export";

724 
g‘£t
.
doc
=(*)
R
"---(

725 (
m­p
.
md
.
expÜt
èexpÜˆ
objeù


727 
ExpÜt
 
objeù
 
to
 
»cÜd
 
the
 
¢­shÙs
 
of
h
sy¡em
 
ruÂšg


729 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

731 
ExpÜtMD
::
Objeù
* 
x´t
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
)->xprt;

732 if(!
x´t
è
Py_RETURN_NONE
;

733 
	`Py_INCREF
(
x´t
);

734  
»š‹½»t_ÿ¡
<
PyObjeù
*>(
x´t
);

736 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

738 
V¬API
<
OP
<
ExpÜtMD
>> 
	`x´t
("export");

739 
ichk
=
x´t
.
	`£t
(
İ
);

740 if(
ichk
==-1)  -1;

741 if(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
x´t
è
	`Py_DECREF
(reinterpret_cast<Object*>(self)->xprt);

742 
	`Py_INCREF
(
x´t
.
v®
.
ob
);

743 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
x´t
ôeš‹½»t_ÿ¡<
ExpÜtMD
::Objeù*>(x´t.
v®
.
ob
);

746 
	}
}

750 
	gMDNVT
::
	$g‘£t_Á®ly
(
PyG‘S‘Def
& 
g‘£t
)

752 
g‘£t
.
Çme
=(*)"ntally";

753 
g‘£t
.
doc
=(*)
R
"---(

754 (è
th”modyÇmic
 
Îyšg
 
³riod


756 
Numb”
 
of
 
¡•s
 
to
 
be
 
k’
 
äom
 
Úe
 
th”modyÇmics
 
ouut
Ø
the
 
Ãxt
.

758 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

760  
v¬
<>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->
Á®ly
);

762 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

764 
V¬API
<> 
	`Á®ly
("ntally");

765 
Á®ly
.
logics
[0]=
	`VLogics
("ge",0);

766 
ichk
=
Á®ly
.
	`£t
(
İ
);

767 if(
ichk
==-1)  -1;

768 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
md
->
Á®ly
òÎy.
v®
;

771 
	}
}

775 
	gMDNVT
::
	$ml_run
(
PyM‘hodDef
& 
_m‘hods
)

777 
_m‘hods
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

778 
_m‘hods
.
ml_Çme
="run";

779 
_m‘hods
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

780 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

782 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

783 
FuncAPI
<
OP
<
AtomsMD
>,> 
	`f
("run",{"atoms","nsteps"});

784 
f
.
logics
<1>()[0]=
	`VLogics
("ge",0);

785 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

787 
AtomsMD
* 
__©oms
=
»š‹½»t_ÿ¡
<AtomsMD::
Objeù
*>(
f
.
v®
<0>().
ob
)->
©oms
;

788 
FÜûF›ldMD
* 
__ff
=
»š‹½»t_ÿ¡
<
AtomsMD
::
Objeù
*>(
f
.
v®
<0>().
ob
)->
ff
;

789 
ExpÜtMD
* 
__x´t
=
__£lf
->
x´t
==
NULL
 ? NULL:__self->xprt->xprt;

791 
Œy


793 
__£lf
->
md
->
	`´e_run_chk
(
__©oms
,
__ff
);

795 
	`ÿtch
(
¡d
::
¡ršg
& 
”r_msg
)

797 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,
”r_msg
.
	`c_¡r
());

798  
NULL
;

801 
__£lf
->
md
->
©oms
=
__©oms
;

802 
__£lf
->
md
->
ff
=
__ff
;

803 
__£lf
->
md
->
x´t
=
__x´t
;

805 
Œy


807 
__£lf
->
md
->
	`š™
();

809 
	`ÿtch
(
¡d
::
¡ršg
& 
”r_msg
)

811 
__£lf
->
md
->
x´t
=
NULL
;

812 
__£lf
->
md
->
ff
=
NULL
;

813 
__£lf
->
md
->
©oms
=
NULL
;

814 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,
”r_msg
.
	`c_¡r
());

815  
NULL
;

818 
__£lf
->
md
->
	`run
(
f
.
v®
<1>());

820 
__£lf
->
md
->
	`fš
();

822 
__£lf
->
md
->
x´t
=
NULL
;

823 
__£lf
->
md
->
ff
=
NULL
;

824 
__£lf
->
md
->
©oms
=
NULL
;

827 
Py_RETURN_NONE
;

830 
_m‘hods
.
ml_doc
=(*)
R
"---(

831 
	`run
(
©oms
,
n¡•s
)

833 
Execu‹
 
mŞecuÏr
 
dyÇmics


835 
This
 
m‘hod
 
¡¬ts
 
the
 
mŞecuÏr
 
dyÇmics
 
a
 
giv’
 
©oms
 
objeù
 
ªd
 
numb”
 
of
 
¡•s
.

837 
P¬am‘”s


839 
©oms
 : 
m­p
.
md
.atoms

840 
Sy¡em
 
of
 
š‹»¡


841 
n¡•s
 : 

842 
Numb”
 
of
 
¡•s
 
to
 
³rfÜm
 
mŞecuÏr
 
dyÇmics


844 
R‘uºs


846 
NÚe


849 
	}
}

	@md_nvt.h

1 #iâdeà
__MAPP__md_nvt__


2 
	#__MAPP__md_nvt__


	)

3 
	~"­i.h
"

4 
	~<mpi.h
>

5 
	~<¡dio.h
>

6 
	~<io¡»am
>

7 
	~<lim™s.h
>

8 
	~"©oms_md.h
"

9 
	~"th”mo¡©.h
"

10 
	~"expÜt_¡yËs.h
"

11 
Çme¥aû
 
	gMAPP_NS


13 şas 
	cMDNVT


15 
	g´iv©e
:

16 
´Ùeùed
:

17 
şass
 
AtomsMD
* 
©oms
;

18 
şass
 
FÜûF›ldMD
* 
	gff
;

19 
şass
 
DyÇmicMD
* 
	gdyÇmic
;

20 
şass
 
ExpÜtMD
* 
	gx´t
;

22 
ty³0
 
	gmvv
[
__nvoigt__
];

23 
ty³0
 
	g__vec
[
__nvoigt__
];

24 
ty³0
 
	g__vec_lş
[
__nvoigt__
];

26 
ty³0
 
	gS_·¹
[
__dim__
][__dim__];

28 
ty³0
 
	gT_·¹
;

29 
	gndof_·¹
;

30 
ty³0
 
	gNdof_·¹
[
__dim__
];

31 
Th”mo¡©NHC
 
	gth”mo_·¹
;

33 
boŞ
 
	gdof_em±y
;

34 
ty³0
 
	gkB
;

35 
ty³0
 
	gT
;

36 
ty³0
 
	gdt
;

37 
ty³0
 
	gdt2
;

39 
	gÁ®ly
;

41 
upd©e_x_d__x__x_d
(
ty³0
);

42 
upd©e_x_d_fš®
(
ty³0
);

43 
upd©e_x_d__x__x_d_w_dof
(
ty³0
);

44 
upd©e_x_d_fš®_w_dof
(
ty³0
);

45 
vœtu®
 
chªge_dt
(
ty³0
);

46 
vœtu®
 
´e_run_chk
(
AtomsMD
*,
FÜûF›ldMD
*);

47 
´e_š™
();

48 
	gpublic
:

49 
MDNVT
(
ty³0
,type0);

50 
	gvœtu®
 ~
MDNVT
();

51 
vœtu®
 
š™
();

52 
vœtu®
 
run
();

53 
vœtu®
 
fš
();

57 
PyObjeù_HEAD


58 
MDNVT
* 
	gmd
;

59 
	gExpÜtMD
::
Objeù
* 
x´t
;

60 }
	tObjeù
;

62 
PyTy³Objeù
 
	gTy³Objeù
;

63 
PyObjeù
* 
__Ãw__
(
PyTy³Objeù
*,PyObject*, PyObject*);

64 
__š™__
(
PyObjeù
*, PyObject*,PyObject*);

65 
PyObjeù
* 
__®loc__
(
PyTy³Objeù
*,
Py_ssize_t
);

66 
__d—Îoc__
(
PyObjeù
*);

69 
PyM‘hodDef
 
	gm‘hods
[];

70 
£tup__m‘hods
();

71 
ml_run
(
PyM‘hodDef
&);

74 
PyG‘S‘Def
 
	gg‘£t
[];

75 
£tup__g‘£t
();

76 
g‘£t_n™”s
(
PyG‘S‘Def
&);

77 
g‘£t_L
(
PyG‘S‘Def
&);

78 
g‘£t_dt
(
PyG‘S‘Def
&);

79 
g‘£t_t_»Ïx
(
PyG‘S‘Def
&);

80 
g‘£t_T
(
PyG‘S‘Def
&);

81 
g‘£t_Á®ly
(
PyG‘S‘Def
&);

82 
g‘£t_expÜt
(
PyG‘S‘Def
&);

85 
£tup_
();

	@md_styles.h

1 
	~"md_nvt.h
"

2 
	~"md_n¡.h
"

4 
	~"md_muvt_2.h
"

	@memory.h

1 #iâdeà
__MAPP__memÜy__


2 
	#__MAPP__memÜy__


	)

3 
	~<exû±iÚ
>

4 
	~<Ãw
>

5 
	~<c¡ršg
>

6 
	~"maüos.h
"

7 
Çme¥aû
 
	gMAPP_NS


10 
	g‹m¶©e
<
şass
 
	gT
>

11 şas 
	cMem


13 
	gpublic
:

14 
®loc
(
T
& 
d©a
)

16 
d—Îoc
(
T
& 
d©a
)

20 
	g‹m¶©e
<
şass
 
	gT
,
size_t
 
	gN
>

21 
şass
 
	gMem
<
	gT
[
N
]>

23 
	gpublic
:

24 
‹m¶©e
<
şass
...
Ts
>

25 
®loc
(
T
(&
d©a
)[
N
],
size_t
 
sz
,
Ts
 ... 
szs
)

27 
®loc
(
d©a
[0],
N
*
sz
,
szs
...);

28 if(
	g¡d
::
is_poš‹r
<
T
>::
v®ue
)

30 
T
* 
__d©a
=
d©a
;

31 
size_t
 
	gi
=1;i<
	gsz
;i++è
	g__d©a
[
i
]=
__d©a
[i-1]+
N
;

34 
®loc
(
T
(&
d©a
)[
N
])

37 
d—Îoc
(
T
(&
d©a
)[
N
])

39 
	gMem
<
	gT
>::
d—Îoc
(
d©a
[0]);

42 
	g‹m¶©e
<
şass
 
	gT
>

43 
şass
 
	gMem
<
	gT
*>

45 
	gpublic
:

46 
‹m¶©e
<
şass
...
Ts
>

47 
®loc
(
T
*& 
d©a
,
size_t
 
sz0
,size_ˆ
sz1
,
Ts
 ... 
szs
)

49 if(
	gsz0
==0)

51 
d©a
=
NULL
;

54 
	gd©a
=
Ãw
 
T
[
sz0
];

55 
	gMem
<
	gT
>::
®loc
(*
d©a
,
sz0
*
sz1
,
szs
...);

56 
size_t
 
	gi
=1;i<
	gsz0
;i++è
	gd©a
[
i
]=
d©a
[i-1]+
sz1
;

58 
®loc
(
T
*& 
d©a
, 
size_t
 
sz0
)

60 if(
	gsz0
==0)

62 
d©a
=
NULL
;

65 
	gd©a
=
Ãw
 
T
[
sz0
];

68 
d—Îoc
(
T
*& 
d©a
)

70 if(
	gd©a
è
	gMem
<
	gT
>::
d—Îoc
(*
d©a
);

71 
	gd–‘e
 [] 
	gd©a
;

72 
	gd©a
=
NULL
;

76 şas 
	cMemÜy


78 
	g´iv©e
:

79 
´Ùeùed
:

80 
public
:

83 
‹m¶©e
<
şass
 
T
,
	gşass
...
	gTs
>

84 
šlše
 
®loc
(
T
& 
d©a
,
Ts
 ... 
szs
)

86 
	gMem
<
	gT
>::
®loc
(
d©a
,
szs
...);

88 
	g‹m¶©e
<
şass
 
	gT
>

89 
šlše
 
d—Îoc
(
T
& 
d©a
)

91 
	gMem
<
	gT
>::
d—Îoc
(
d©a
);

95 
	g‹m¶©e
<
şass
 
	gT
>

96 
šlše
 
shršk_to_f™
(
T
*& 
d©a
,
size_t
 
size
,size_ˆ
ÿ·c™y
)

98 if(
	gÿ·c™y
==
size
) ;

100 
T
* 
	g__d©a
=
NULL
;

101 if(
	gsize
è
	g__d©a
=
Ãw
 
T
[
size
];

102 
memıy
(
__d©a
,
d©a
,
size
*(
T
));

103 
	gd–‘e
 [] 
	gd©a
;

104 
	gd©a
=
__d©a
;

107 
	g‹m¶©e
 <
ty³Çme
 
	gTYPE
>

108 
TYPE
* 
ü—‹
(TYPE*&,,const *

111 
	g‹m¶©e
 <
ty³Çme
 
	gTYPE
>

112 
TYPE
** 
ü—‹
(TYPE**&,,,const *

115 
	g‹m¶©e
 <
ty³Çme
 
	gTYPE
>

116 
TYPE
** 
ü—‹_2d
(TYPE**&,,,const *

119 
	g‹m¶©e
 <
ty³Çme
 
	gTYPE
>

120 
d–_2d
(
TYPE
**&);

122 
	g‹m¶©e
 <
ty³Çme
 
	gTYPE
>

123 
TYPE
* 
grow
(TYPE*&,,,const *

125 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

126 
grow
(
T
*&,
size_t
,size_t);

129 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

133 
	g‹m¶©e
<
ty³Çme
 
	gTYPE
>

134 
TYPE
* 
	gMemÜy
::
	$ü—‹
(
TYPE
*& 
¬¿y
,
d0


135 ,cÚ¡ * 
Çme
,
lše_no
,cÚ¡ * 
fe


136 ,cÚ¡ * 
funùiÚ
)

138 
Œy


140 
¬¿y
 = 
Ãw
 
TYPE
 [
d0
];

142 
	`ÿtch
(
¡d
::
bad_®loc
&)

150  
¬¿y
;

151 
	}
}

155 
	g‹m¶©e
 <
ty³Çme
 
	gTYPE
>

156 
TYPE
** 
	gMemÜy
::
	$ü—‹
(
TYPE
**& 
¬¿y
,
d0


157 ,
d1
,cÚ¡ * 
Çme
,
lše_no
,

158 cÚ¡ * 
fe
,cÚ¡ * 
funùiÚ
)

160 
	`ü—‹
(
¬¿y
,
d0
,
Çme
,
lše_no
,
fe
,
funùiÚ
);

161 
i
=0;i<
d0
;i++)

162 
	`ü—‹
(
¬¿y
[
i
],
d1
,
Çme
,
lše_no
,
fe
,
funùiÚ
);

163  
¬¿y
;

164 
	}
}

168 
	g‹m¶©e
 <
ty³Çme
 
	gTYPE
>

169 
TYPE
** 
	gMemÜy
::
	$ü—‹_2d
(
TYPE
**& 
¬¿y
,
d0


170 ,
d1
,cÚ¡ * 
Çme
,
lše_no
,

171 cÚ¡ * 
fe
,cÚ¡ * 
funùiÚ
)

173 
	`ü—‹
(
¬¿y
,
d0
,
Çme
,
lše_no
,
fe
,
funùiÚ
);

174 
	`ü—‹
(*
¬¿y
,
d0
*
d1
,
Çme
,
lše_no
,
fe
,
funùiÚ
);

176 
i
=1;i<
d0
;i++)

177 
¬¿y
[
i
]÷¼ay[i-1]+
d1
;

178  
¬¿y
;

179 
	}
}

183 
	g‹m¶©e
 <
ty³Çme
 
	gTYPE
>

184 
	gMemÜy
::
	$d–_2d
(
TYPE
**& 
¬¿y
)

186 if(
¬¿y
==
NULL
)

188 
d–‘e
 [] 
¬¿y
;

191 
d–‘e
 [] *
¬¿y
;

192 
d–‘e
 [] 
¬¿y
;

193 
	}
}

197 
	g‹m¶©e
 <
ty³Çme
 
	gTYPE
>

198 
TYPE
* 
	gMemÜy
::
	$grow
(
TYPE
*& 
¬¿y
,
Şdsize
,

199 
Ãwsize
,cÚ¡ * 
Çme
,
lše_no
,

200 cÚ¡ * 
fe
,cÚ¡ * 
funùiÚ
)

202 if(
Şdsize
==0)

204  
	`ü—‹
(
¬¿y
,
Ãwsize
,
Çme
,
lše_no
,
fe
,
funùiÚ
);

206 if(
Şdsize
==
Ãwsize
)

208  
¬¿y
;

213 
TYPE
* 
Ãw¬¿y
=
¬¿y
;

214 
Œy


216 
size1
=
Ãwsize
;

217 
size2
=
Şdsize
;

218 
size
=
	`MIN
(
size1
,
size2
);

219 
Ãw¬¿y
 = 
Ãw
 
TYPE
[
Ãwsize
];

220 
	`memıy
(
Ãw¬¿y
,
¬¿y
,
size
*(
TYPE
));

221 
d–‘e
 [] 
¬¿y
;

222 
¬¿y
=
Ãw¬¿y
;

224 
	`ÿtch
 (
¡d
::
bad_®loc
&)

232  
¬¿y
;

234 
	}
}

238 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

239 
	gMemÜy
::
	$grow
(
T
*& 
v
,
size_t
 
Şd_sz
,size_ˆ
Ãw_sz
)

241 
T
* 
v_
=
Ãw
 T[
Ãw_sz
];

242 
	`memıy
(
v_
,
v
,
Şd_sz
*(
T
));

243 
d–‘e
 [] 
v
;

244 
v
=
v_
;

245 
	}
}

	@min.cpp

1 
	~"mš.h
"

2 
	~"ls.h
"

3 
	~"ff_¡yËs.h
"

4 
	~"xm©h.h
"

5 
	~"MAPP.h
"

6 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

7 cÚ¡ * 
	gMš
::
”r_msgs
[]=

32 
	gMš
::
	$Mš
():

33 
H_dof
{
	`DESIG2
(
__dim__
,__dim__,
çl£
)
	}
},

34 
ls
(
NULL
),

35 
chng_box
(
çl£
),

36 
e_tŞ
(
sq¹
(
¡d
::
num”ic_lim™s
<
ty³0
>::
•sÚ
())),

37 
affše
(
çl£
),

38 
max_dx
(1.0),

39 
	$Á®ly
(1000)

41 
	}
}

45 
	gMš
::
Mš
(
ty³0
 
__e_tŞ
,
boŞ
(&
__H_dof
)[
__dim__
][__dim__],boŞ 
__affše
,ty³0 
__max_dx
,
LšeS—rch
* 
__ls
):

46 
H_dof
{
DESIG2
(
__dim__
,__dim__,
çl£
)},

47 
ls
(
__ls
),

48 
chng_box
(
çl£
),

49 
e_tŞ
(
__e_tŞ
),

50 
affše
(
__affše
),

51 
max_dx
(
__max_dx
),

52 
	$Á®ly
(1000)

54 
i
=0;i<
__dim__
;i++)

55 
j
=0;j<
__dim__
;j++)

57 
H_dof
[
i
][
j
]=
__H_dof
[i][j];

58 if(
H_dof
[
i
][
j
]è
chng_box
=
Œue
;

60 
	}
}

64 
	gMš
::~
	$Mš
()

66 
	}
}

70 
Mš
::
	$´e_run_chk
(
Atoms
* 
__©oms
,
FÜûF›ld
* 
__ff
)

73 if(!
__©oms
)

74 
throw
 
¡d
::
	`¡ršg
("cannot start minimization without initial conditions");

77 if(!
__ff
)

78 
throw
 
¡d
::
	`¡ršg
("cannot start minimization without governingƒquations (force field)");

81 if(
chng_box
 && !
__©oms
->
x_dof
->
	`is_em±y
())

83 
boŞ
* 
dof
=
__©oms
->
x_dof
->
	`begš
();

84 
__dof_lş
[
__dim__
]{
	`DESIG
(__dim__,0)};

85 
i
=0;i<
__©oms
->
Çtms_lş
;i++,
dof
+=
__dim__
)

86 
Algeb¿
::
Do
<
__dim__
>::
	`func
([&
dof
,&
__dof_lş
](
i
){ if(!dof[i]) __dof_lcl[i]=1;});

88 
__dof
[
__dim__
]{
	`DESIG
(__dim__,0)};

89 
	`MPI_AÎ»duû
(
__dof_lş
,
__dof
,
__dim__
,
MPI_INT
,
MPI_MAX
,
__©oms
->
wÜld
);

90 
¡d
::
¡ršg
 
”r_msg
=¡d::
	`¡ršg
();

91 
i
=0;i<
__dim__
;i++)

92 
j
=
i
;j<
__dim__
;j++)

93 if(
H_dof
[
i
][
j
] && 
__dof
[i])

101 
”r_msg
+="\nyou hav©om th© dØnÙ havdeg»ä“dom iÀ"+
Pršt
::
	`to_¡ršg
(
i
)

102 +" dœeùiÚhey wÈbdefÜmed‡ffš–y dutØdefšed deg»e oàä“dom H_dof["+
Pršt
::
	`to_¡ršg
(
i
)+"]["+Pršt::to_¡ršg(
j
)+"]";

106 if(!
”r_msg
.
	`em±y
(è&& 
Á®ly
)

108 
”r_msg
="Warning:"+err_msg+"\n";

109 
	`årštf
(
MAPP
::
m­p_out
,"%s",
”r_msg
.
	`c_¡r
());

112 
	}
}

116 
PyObjeù
* 
	gMš
::
	$__Ãw__
(
PyTy³Objeù
* 
ty³
,
PyObjeù
* 
¬gs
,PyObjeù* 
kwds
)

118 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
ty³
->
	`_®loc
(type,0));

119 
PyObjeù
* 
£lf
=
»š‹½»t_ÿ¡
<PyObjeù*>(
__£lf
);

120  
£lf
;

121 
	}
}

125 
	gMš
::
	$__š™__
(
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)

127 
FuncAPI
<> 
	`f
("__init__");

129 if(
	`f
(
¬gs
,
kwds
)==-1)  -1;

130 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

131 
__£lf
->
mš
=
Ãw
 
	`Mš
();

132 
__£lf
->
ls
=
NULL
;

133 
__£lf
->
x´t
=
NULL
;

135 
	}
}

139 
PyObjeù
* 
	gMš
::
	$__®loc__
(
PyTy³Objeù
* 
ty³
,
Py_ssize_t
)

141 
Objeù
* 
__£lf
=
Ãw
 Object;

142 
	`Py_TYPE
(
__£lf
)=
ty³
;

143 
	`Py_REFCNT
(
__£lf
)=1;

144 
__£lf
->
mš
=
NULL
;

145 
__£lf
->
ls
=
NULL
;

146 
__£lf
->
x´t
=
NULL
;

147  
»š‹½»t_ÿ¡
<
PyObjeù
*>(
__£lf
);

148 
	}
}

152 
	gMš
::
	$__d—Îoc__
(
PyObjeù
* 
£lf
)

154 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

155 
d–‘e
 
__£lf
->
mš
;

156 
__£lf
->
mš
=
NULL
;

157 if(
__£lf
->
ls
è
	`Py_DECREF
(__self->ls);

158 
__£lf
->
ls
=
NULL
;

159 if(
__£lf
->
x´t
è
	`Py_DECREF
(__self->xprt);

160 
__£lf
->
x´t
=
NULL
;

161 
d–‘e
 
__£lf
;

162 
	}
}

164 
PyTy³Objeù
 
	gMš
::
Ty³Objeù
={
PyObjeù_HEAD_INIT
(
NULL
)};

166 
	gMš
::
	$£tup_
()

168 
Ty³Objeù
.
_Çme
="min_cg";

169 
Ty³Objeù
.
_doc
="conjugate gradient minimization";

171 
Ty³Objeù
.
_æags
=
Py_TPFLAGS_DEFAULT
;

172 
Ty³Objeù
.
_basicsize
=(
Objeù
);

174 
Ty³Objeù
.
_Ãw
=
__Ãw__
;

175 
Ty³Objeù
.
_š™
=
__š™__
;

176 
Ty³Objeù
.
_®loc
=
__®loc__
;

177 
Ty³Objeù
.
_d—Îoc
=
__d—Îoc__
;

178 
	`£tup__m‘hods
();

179 
Ty³Objeù
.
_m‘hods
=
m‘hods
;

180 
	`£tup__g‘£t
();

181 
Ty³Objeù
.
_g‘£t
=
g‘£t
;

183 
ichk
=
	`PyTy³_R—dy
(&
Ty³Objeù
);

184 if(
ichk
<0)  ichk;

185 
	`Py_INCREF
(&
Ty³Objeù
);

186  
ichk
;

187 
	}
}

189 
PyG‘S‘Def
 
	gMš
::
g‘£t
[]=
Em±yPyG‘S‘Def
(6);

191 
	gMš
::
	$£tup__g‘£t
()

193 
	`g‘£t_max_dx
(
g‘£t
[0]);

194 
	`g‘£t_e_tŞ
(
g‘£t
[1]);

195 
	`g‘£t_affše
(
g‘£t
[2]);

196 
	`g‘£t_H_dof
(
g‘£t
[3]);

197 
	`g‘£t_Á®ly
(
g‘£t
[4]);

198 
	}
}

200 
PyM‘hodDef
 
	gMš
::
m‘hods
[]=
Em±yPyM‘hodDef
(1);

202 
	gMš
::
	$£tup__m‘hods
()

204 
	}
}

208 
Mš
::
	$g‘£t_e_tŞ
(
PyG‘S‘Def
& 
g‘£t
)

210 
g‘£t
.
Çme
=(*)"e_tol";

211 
g‘£t
.
doc
=(*)
R
"---(

212 (è
tŞ”ªû


214 
EÃrgy
 
tŞ”ªû
 
ü™”iÚ
 
¡İpšg
 
mšimiz©iÚ


216 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

218  
v¬
<
ty³0
>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
mš
->
e_tŞ
);

220 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

222 
V¬API
<
ty³0
> 
	`e_tŞ
("e_tol");

223 
e_tŞ
.
logics
[0]=
	`VLogics
("ge",0.0);

224 
ichk
=
e_tŞ
.
	`£t
(
İ
);

225 if(
ichk
==-1)  -1;

226 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
mš
->
e_tŞ
ó_tŞ.
v®
;

229 
	}
}

233 
	gMš
::
	$g‘£t_H_dof
(
PyG‘S‘Def
& 
g‘£t
)

235 
g‘£t
.
Çme
=(*)"H_dof";

236 
g‘£t
.
doc
=(*)
R
"---(

237 (
symm
<
boŞ
[
dim
][dim]>è
un™ûÎ
 
DOFs


239 
Un™ûÎ
 
deg»es
 
of
 
ä“dom
 
duršg
 
mšimiz©iÚ
, 
h”e
 
dim
 
is
 
the
 
dim’siÚ
 oà
simuÏtiÚ


241 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

243  
v¬
<
symm
<
boŞ
[
__dim__
][__dim__]>>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
mš
->
H_dof
);

245 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

247 
V¬API
<
symm
<
boŞ
[
__dim__
][__dim__]>> 
	`H_dof
("H_dof");

248 
ichk
=
H_dof
.
	`£t
(
İ
);

249 if(
ichk
==-1)  -1;

251 
	`boŞ
 (&
__H_dof
)[
__dim__
][__dim__]=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
mš
->
H_dof
;

252 
boŞ
 
chng_box
=
çl£
;

253 
Algeb¿
::
DoLT
<
__dim__
>::
	`func
([&
H_dof
,&
__H_dof
,&
chng_box
](
i
,
j
)

255 
__H_dof
[
i
][
j
]=__H_dof[j][i]=
H_dof
.
v®
[i][j];

256 if(
__H_dof
[
i
][
j
]è
chng_box
=
Œue
;

258 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
mš
->
chng_box
=chng_box;

261 
	}
}

265 
	gMš
::
	$g‘£t_affše
(
PyG‘S‘Def
& 
g‘£t
)

267 
g‘£t
.
Çme
=(*)"affine";

268 
g‘£t
.
doc
=(*)
R
"---(

269 (
boŞ
è
affše
 
ŒªsfÜm©iÚ
 

271 
If
 
£t
 
to
 
True
 
©omic
 
di¥Ïûm’ts
 
would
 
be
 
affše


273 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

275  
v¬
<
boŞ
>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
mš
->
affše
);

277 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

279 
V¬API
<
boŞ
> 
	`affše
("affine");

280 
ichk
=
affše
.
	`£t
(
İ
);

281 if(
ichk
==-1)  -1;

282 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
mš
->
affše
÷ffše.
v®
;

285 
	}
}

289 
	gMš
::
	$g‘£t_max_dx
(
PyG‘S‘Def
& 
g‘£t
)

291 
g‘£t
.
Çme
=(*)"max_dx";

292 
g‘£t
.
doc
=(*)
R
"---(

293 (è
mximum
 
di¥Ïûmªt


295 
Maximum
 
di¥Ïûm’t
 
of
 
ªy
 
©om
 
š
 
Úe
 
¡•
 oà
mšimiz©iÚ


297 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

299  
v¬
<
ty³0
>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
mš
->
max_dx
);

301 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

303 
V¬API
<
ty³0
> 
	`max_dx
("max_dx");

304 
max_dx
.
logics
[0]=
	`VLogics
("gt",0.0);

305 
ichk
=
max_dx
.
	`£t
(
İ
);

306 if(
ichk
==-1)  -1;

307 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
mš
->
max_dx
=max_dx.
v®
;

310 
	}
}

314 
	gMš
::
	$g‘£t_ls
(
PyG‘S‘Def
& 
g‘£t
)

316 
g‘£t
.
Çme
=(*)"ls";

317 
g‘£t
.
doc
=(*)
R
"---(

318 (
m­p
.
ls
è
lše
 
£¬ch
 
®gÜ™hm


320 
Lše
 
£¬ch
 
m‘hod
 
to
 
fšd
 
the
 
’”gy
 
mšimum
 
š
 
Úe
 
dim’siÚ


322 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

324 
LšeS—rch
::
Objeù
* 
ls
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
)->ls;

325 
	`Py_INCREF
(
ls
);

326  
»š‹½»t_ÿ¡
<
PyObjeù
*>(
ls
);

328 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

330 
V¬API
<
OP
<
LšeS—rch
>> 
	`ls
("ls");

331 
ichk
=
ls
.
	`£t
(
İ
);

332 if(
ichk
==-1)  -1;

333 
LšeS—rch
* 
__ls
=&
»š‹½»t_ÿ¡
<LšeS—rch::
Objeù
*>(
ls
.
v®
.
ob
)->ls;

334 
	`Py_DECREF
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
ls
);

335 
	`Py_INCREF
(
ls
.
v®
.
ob
);

336 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
ls
ôeš‹½»t_ÿ¡<
LšeS—rch
::Objeù*>Ös.
v®
.
ob
);

337 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
mš
->
ls
=
__ls
;

340 
	}
}

344 
	gMš
::
	$g‘£t_Á®ly
(
PyG‘S‘Def
& 
g‘£t
)

346 
g‘£t
.
Çme
=(*)"ntally";

347 
g‘£t
.
doc
=(*)
R
"---(

348 (è
th”modyÇmic
 
Îyšg
 
³riod


350 
Numb”
 
of
 
¡•s
 
to
 
be
 
k’
 
äom
 
Úe
 
th”modyÇmics
 
ouut
Ø
the
 
Ãxt
.

352 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

354  
v¬
<>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
mš
->
Á®ly
);

356 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

358 
V¬API
<> 
	`Á®ly
("ntally");

359 
Á®ly
.
logics
[0]=
	`VLogics
("ge",0);

360 
ichk
=
Á®ly
.
	`£t
(
İ
);

361 if(
ichk
==-1)  -1;

362 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
mš
->
Á®ly
òÎy.
v®
;

365 
	}
}

	@min.h

1 #iâdeà
__MAPP__mš__


2 
	#__MAPP__mš__


	)

3 
	~"­i.h
"

4 
	~"ls.h
"

5 
	~"glob®.h
"

6 
	~"©oms_¡yËs.h
"

7 
	~"expÜt_¡yËs.h
"

8 
Çme¥aû
 
	gMAPP_NS


10 şas 
	cMš


12 
	g´iv©e
:

13 
´Ùeùed
:

14 cÚ¡ * 
”r_msgs
[];

15 
ty³0
 
	gmax_dx
;

16 
boŞ
 
	gchng_box
;

17 
ty³0
 
	gf_h
;

18 
boŞ
 
	gaffše
;

19 
ty³0
 
	ge_tŞ
;

20 
boŞ
 
	gH_dof
[
__dim__
][__dim__];

21 
	gÁ®ly
;

22 
şass
 
LšeS—rch
* 
	gls
;

24 
´e_run_chk
(
Atoms
*,
FÜûF›ld
*);

25 
	gpublic
:

26 
Mš
();

27 
Mš
(
ty³0
,
boŞ
(&)[
__dim__
][__dim__],boŞ,ty³0,
şass
 
LšeS—rch
*);

28 
	gvœtu®
 ~
Mš
();

32 
PyObjeù_HEAD


33 
Mš
* 
	gmš
;

34 
	gLšeS—rch
::
Objeù
* 
ls
;

35 
	gExpÜt
::
Objeù
* 
x´t
;

36 }
	tObjeù
;

38 
PyTy³Objeù
 
	gTy³Objeù
;

39 
PyObjeù
* 
__Ãw__
(
PyTy³Objeù
*,PyObject*, PyObject*);

40 
__š™__
(
PyObjeù
*, PyObject*,PyObject*);

41 
PyObjeù
* 
__®loc__
(
PyTy³Objeù
*,
Py_ssize_t
);

42 
__d—Îoc__
(
PyObjeù
*);

44 
PyM‘hodDef
 
	gm‘hods
[];

45 
£tup__m‘hods
();

47 
PyG‘S‘Def
 
	gg‘£t
[];

48 
£tup__g‘£t
();

49 
g‘£t_e_tŞ
(
PyG‘S‘Def
&);

50 
g‘£t_affše
(
PyG‘S‘Def
&);

51 
g‘£t_H_dof
(
PyG‘S‘Def
&);

52 
g‘£t_max_dx
(
PyG‘S‘Def
&);

53 
g‘£t_Á®ly
(
PyG‘S‘Def
&);

54 
g‘£t_ls
(
PyG‘S‘Def
&);

56 
£tup_
();

	@min_cg.cpp

1 
	~"mš_cg.h
"

2 
	~<¡dlib.h
>

3 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

7 
	gMšCG
::
MšCG
(
ty³0
 
__e_tŞ
,

8 
boŞ
(&
__H_dof
)[
__dim__
][__dim__],boŞ 
__affše
,
ty³0
 
__max_dx
,
LšeS—rch
* 
__ls
):

9 
Mš
(
__e_tŞ
,
__H_dof
,
__affše
,
__max_dx
,
__ls
),

10 
©oms
(
NULL
),

11 
ff
(
NULL
),

12 
	$x´t
(
NULL
)

14 
	}
}

18 
	gMšCG
::~
	$MšCG
()

20 
©oms
=
NULL
;

21 
ff
=
NULL
;

22 
	}
}

26 
ty³0
 
	gMšCG
::
	$ÿlc_ndofs
()

29 
	}
}

33 
	gMšCG
::
	$fÜû_ÿlc
()

35 
ff
->
	`d”iv©ive
();

36 if(
chng_box
)

37 
Algeb¿
::
DoLT
<
__dim__
>::
	`func
([
this
](
i
,
j
){
f
.
A
[i][j]=
H_dof
[i][j] ? f.A[i][j]:0.0;});

38 
	}
}

42 
	gMšCG
::
	$´•
()

44 
x_d
=
h
;

45 if(!
chng_box
) ;

47 cÚ¡ 
Çtms_lş
=
©oms
->natms_lcl;

48 
ty³0
* 
xvec
=
x0
.
vecs
[0]->
	`begš
();

49 
ty³0
* 
hvec
=
h
.
vecs
[0]->
	`begš
();

50 
ty³0
* 
x_dvec
=
x_d
.
vecs
[0]->
	`begš
();

51 
Algeb¿
::
	`MLT_mul_MLT
(
©oms
->
H
,
h
.
A
,
x_d
.A);

54 if(
affše
)

56 
Ÿtm
=0;Ÿtm<
Çtms_lş
;Ÿtm++,
xvec
+=
__dim__
,
x_dvec
+=__dim__)

57 
Algeb¿
::
	`V_mul_MLT
(
xvec
,
h
.
A
,
x_dvec
);

61 
Ÿtm
=0;Ÿtm<
Çtms_lş
;Ÿtm++,
xvec
+=
__dim__
,
x_dvec
+=__dim__,
hvec
+=__dim__)

62 
Algeb¿
::
	`V_mul_MLT_add_š
(
xvec
,
h
.
A
,
x_dvec
);

67 
	}
}

71 
	gMšCG
::
	$š™
()

73 
x
.~
	`VecT’s
();

74 
	`Ãw
 (&
x
è
VecT’s
<
ty³0
,1>(
©oms
,
chng_box
,©oms->
H
,atoms->x);

75 
f
.~
	`VecT’s
();

76 
	`Ãw
 (&
f
è
VecT’s
<
ty³0
,1>(
©oms
,
chng_box
,
ff
->
F_H
,ff->f);

77 
h
.~
	`VecT’s
();

78 
	`Ãw
 (&
h
è
VecT’s
<
ty³0
,1>(
©oms
,
chng_box
,
__dim__
);

79 
x0
.~
	`VecT’s
();

80 
	`Ãw
 (&
x0
è
VecT’s
<
ty³0
,1>(
©oms
,
chng_box
,
__dim__
);

81 
x_d
.~
	`VecT’s
();

82 
	`Ãw
 (&
x_d
è
VecT’s
<
ty³0
,1>(
©oms
,
chng_box
,
__dim__
);

83 
f0
.~
	`VecT’s
();

84 
	`Ãw
 (&
f0
è
VecT’s
<
ty³0
,1>(
©oms
,
chng_box
,
__dim__
);

86 
dyÇmic
=
Ãw
 
	`DyÇmicMD
(
©oms
,
ff
,
chng_box
,{},{©oms->
x_dof
,
h
.
vecs
[0],
x0
.vecs[0],
x_d
.vecs[0],
f0
.vecs[0]},{atoms->x_d});

87 
dyÇmic
->
	`š™
();

89 if(
x´t
)

91 
Œy


93 
x´t
->
©oms
=atoms;

94 
x´t
->
	`š™
();

96 
	`ÿtch
(
¡d
::
¡ršg
& 
”r_msg
)

98 
	`fš
();

99 
throw
 
”r_msg
;

102 
	}
}

106 
	gMšCG
::
	$fš
()

108 if(
x´t
)

110 
x´t
->
	`fš
();

111 
x´t
->
©oms
=
NULL
;

114 
dyÇmic
->
	`fš
();

115 
d–‘e
 
dyÇmic
;

116 
dyÇmic
=
NULL
;

118 
f0
.~
	`VecT’s
();

119 
x_d
.~
	`VecT’s
();

120 
x0
.~
	`VecT’s
();

121 
h
.~
	`VecT’s
();

122 
f
.~
	`VecT’s
();

123 
x
.~
	`VecT’s
();

124 
	}
}

128 
	~"¿ndom.h
"

129 
	gMšCG
::
	$ff_‹¡
(
£ed
,
ty³0
 
__max_dx
,ty³0 
__max_¡
,
__n_desc
)

132 
boŞ
 
__chng_box
=
chng_box
;

133 
chng_box
=
Œue
;

134 
boŞ
 
__H_dof
[
__dim__
][__dim__];

135 
Algeb¿
::
V_eq
<
__dim__
*__dim__>(&
H_dof
[0][0],&
__H_dof
[0][0]);

136 
Algeb¿
::
DoLT
<
__dim__
>::
	`func
([
this
](
i
,
j
)

137 {
H_dof
[
i
][
j
]=H_dof[j][i]=
Œue
;});

139 
x
.~
	`VecT’s
();

140 
	`Ãw
 (&
x
è
VecT’s
<
ty³0
,1>(
©oms
,
chng_box
,©oms->
H
,atoms->x);

141 
f
.~
	`VecT’s
();

142 
	`Ãw
 (&
f
è
VecT’s
<
ty³0
,1>(
©oms
,
chng_box
,
ff
->
F_H
,ff->f);

143 
h
.~
	`VecT’s
();

144 
	`Ãw
 (&
h
è
VecT’s
<
ty³0
,1>(
©oms
,
chng_box
,
__dim__
);

145 
x0
.~
	`VecT’s
();

146 
	`Ãw
 (&
x0
è
VecT’s
<
ty³0
,1>(
©oms
,
chng_box
,
__dim__
);

147 
x_d
.~
	`VecT’s
();

148 
	`Ãw
 (&
x_d
è
VecT’s
<
ty³0
,1>(
©oms
,
chng_box
,
__dim__
);

150 
dyÇmic
=
Ãw
 
	`DyÇmicMD
(
©oms
,
ff
,
chng_box
,{},{©oms->
x_dof
,
h
.
vecs
[0],
x0
.vecs[0],
x_d
.vecs[0]},{atoms->x_d});

151 
dyÇmic
->
	`š™
();

156 
Rªdom
 
	`¿nd
(
£ed
+
©oms
->
comm_¿nk
);

158 
Çtms_lş
=
©oms
->natms_lcl;

159 
ty³0
* 
__h
=
h
.
vecs
[0]->
	`begš
();

160 
i
=0;i<
__dim__
*
Çtms_lş
;i++)

161 
__h
[
i
]=(2.0*
¿nd
.
	`unifÜm
()-1.0)*
__max_dx
;

163 
Algeb¿
::
DoLT
<
__dim__
>::
	`func
([
this
,&
¿nd
,&
__max_¡
](
i
,
j
)

164 {
h
.
A
[
i
][
j
]=(2.0*
¿nd
.
	`unifÜm
()-1.0)*
__max_¡
;});

167 
x0
=
x
;

168 
	`fÜû_ÿlc
();

169 
f_h
=
f
*
h
;

172 
	`´•
();

173 
ty³0
 
®pha
=0.0;

174 
ty³0
 
d®pha
=1.0/
¡©ic_ÿ¡
<ty³0>(
__n_desc
);

176 
ty³0
 
u0
=
	`F
(
®pha
);

177 
ty³0
 
du
=0.0;

178 
ty³0
 
du_®pha
=0.0;

180 
Th”moDyÇmics
 
	`th”mo
(12,"®pha",
®pha
,"d–_U",
du
,"dU*®pha",
du_®pha
);

181 
th”mo
.
	`š™
();

182 
i
=0;i<
__n_desc
+1;i++)

184 
du
=
	`F
(
®pha
)-
u0
;

185 
du_®pha
=-
®pha
*
f_h
;

186 
th”mo
.
	`´št
(
i
);

187 
®pha
+=
d®pha
;

189 
th”mo
.
	`fš
();

191 
dyÇmic
->
	`fš
();

192 
d–‘e
 
dyÇmic
;

193 
dyÇmic
=
NULL
;

195 
x_d
.~
	`VecT’s
();

196 
x0
.~
	`VecT’s
();

197 
h
.~
	`VecT’s
();

198 
f
.~
	`VecT’s
();

199 
x
.~
	`VecT’s
();

200 
Algeb¿
::
V_eq
<
__dim__
*__dim__>(&
__H_dof
[0][0],&
H_dof
[0][0]);

201 
chng_box
=
__chng_box
;

202 
	}
}

206 
	gMšCG
::
	$run
(
n¡•s
)

208 if(
dyÇmic_ÿ¡
<
LšeS—rchGŞd’SeùiÚ
*>(
ls
))

209  
	`run
(
dyÇmic_ÿ¡
<
LšeS—rchGŞd’SeùiÚ
*>(
ls
),
n¡•s
);

211 if(
dyÇmic_ÿ¡
<
LšeS—rchB»Á
*>(
ls
))

212  
	`run
(
dyÇmic_ÿ¡
<
LšeS—rchB»Á
*>(
ls
),
n¡•s
);

214 if(
dyÇmic_ÿ¡
<
LšeS—rchBackT¿ck
*>(
ls
))

215  
	`run
(
dyÇmic_ÿ¡
<
LšeS—rchBackT¿ck
*>(
ls
),
n¡•s
);

216 
	}
}

220 
ty³0
 
	gMšCG
::
	$F
(
ty³0
 
®pha
)

222 
x
=
x0
+
®pha
*
x_d
;

223 if(
chng_box
)

224 
©oms
->
	`upd©e_H
();

225 #ifdeà
OLD_UPDATE


226 
dyÇmic
->
	`upd©e
(
©oms
->
x
);

228 
dyÇmic
->
upd©e
<
Œue
>();

230  
ff
->
	`v®ue
();

231 
	}
}

235 
ty³0
 
	gMšCG
::
	$dF
(
ty³0
 
®pha
,ty³0& 
d»v
)

237 
x
=
x0
+
®pha
*
x_d
;

238 if(
chng_box
)

239 
©oms
->
	`upd©e_H
();

240 #ifdeà
OLD_UPDATE


241 
dyÇmic
->
	`upd©e
(
©oms
->
x
);

243 
dyÇmic
->
upd©e
<
Œue
>();

245 
	`fÜû_ÿlc
();

247 
d»v
=-(
f
*
h
);

248  
©oms
->
³
;

249 
	}
}

258 
	gMšCG
::
	$ls_´•
(
ty³0
& 
dç
,ty³0& 
h_nÜm
,ty³0& 
max_a
)

261 
h_nÜm
=
h
*h;

263 
dç
=-
f_h
;

265 if(
h_nÜm
==0.0)

267 
max_a
=0.0;

268 
dç
=0.0;

272 if(
dç
>=0.0)

274 
max_a
=0.0;

275 
dç
=1.0;

279 
h_nÜm
=
	`sq¹
(h_norm);

281 
ty³0
 
max_x_d_lş
=0.0;

282 
ty³0
 
max_x_d
;

283 
ty³0
* 
x_dvec
=
x_d
.
vecs
[0]->
	`begš
();

284 cÚ¡ 
n
=
©oms
->
Çtms_lş
*
__dim__
;

285 
i
=0;i<
n
;i++)

286 
max_x_d_lş
=
	`MAX
(max_x_d_lş,
	`çbs
(
x_dvec
[
i
]));

288 
	`MPI_AÎ»duû
(&
max_x_d_lş
,&
max_x_d
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_MAX
,
©oms
->
wÜld
);

289 
max_a
=
	`çbs
(
max_dx
/
max_x_d
);

291 
	}
}

295 
	gMšCG
::
	$F_»£t
()

297 
x
=
x0
;

298 if(
chng_box
è
©oms
->
	`upd©e_H
();

299 #ifdeà
OLD_UPDATE


300 
dyÇmic
->
	`upd©e
(
©oms
->
x
);

302 
dyÇmic
->
upd©e
<
Œue
>();

304 
	}
}

308 
PyObjeù
* 
	gMšCG
::
	$__Ãw__
(
PyTy³Objeù
* 
ty³
,
PyObjeù
* 
¬gs
,PyObjeù* 
kwds
)

310 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
ty³
->
	`_®loc
(type,0));

311 
PyObjeù
* 
£lf
=
»š‹½»t_ÿ¡
<PyObjeù*>(
__£lf
);

312  
£lf
;

313 
	}
}

317 
	gMšCG
::
	$__š™__
(
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)

319 
FuncAPI
<
ty³0
,
symm
<
boŞ
[
__dim__
][__dim__]>,boŞ,ty³0,
OP
<
LšeS—rch
>> 
	`f
("__init__",{"e_tol","H_dof","affine","max_dx","ls"});

320 
f
.
nİtiÚ®s
=5;

321 
f
.
logics
<0>()[0]=
	`VLogics
("ge",0.0);

322 
f
.
logics
<3>()[0]=
	`VLogics
("gt",0.0);

325 
f
.
v®
<0>()=
	`sq¹
(
¡d
::
num”ic_lim™s
<
ty³0
>::
	`•sÚ
());

326 
i
=0;i<
__dim__
;i++è
j
=0;j<__dim__;j++)
f
.
v®
<1>()[i][j]=
çl£
;

327 
f
.
v®
<2>()=
çl£
;

328 
f
.
v®
<3>()=1.0;

329 
PyObjeù
* 
em±y_tu¶e
=
	`PyTu¶e_New
(0);

330 
PyObjeù
* 
em±y_diù
=
	`PyDiù_New
();

331 
PyObjeù
* 
__ls
=
LšeS—rchBackT¿ck
::
	`__Ãw__
(&LšeS—rchBackT¿ck::
Ty³Objeù
,
em±y_tu¶e
,
em±y_diù
);

332 
LšeS—rchBackT¿ck
::
	`__š™__
(
__ls
,
em±y_tu¶e
,
em±y_diù
);

333 
	`Py_DECREF
(
em±y_diù
);

334 
	`Py_DECREF
(
em±y_tu¶e
);

335 
f
.
v®
<4>().
ob
=
__ls
;

338 if(
	`f
(
¬gs
,
kwds
)==-1)  -1;

342 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

343 
	`Py_INCREF
(
f
.
v®
<4>().
ob
);

344 
__£lf
->
ls
=
»š‹½»t_ÿ¡
<
LšeS—rch
::
Objeù
*>(
f
.
v®
<4>().
ob
);

345 
__£lf
->
mš
=
Ãw
 
	`MšCG
(
f
.
v®
<0>(),f.v®<1>(),f.v®<2>(),f.v®<3>(),&(__£lf->
ls
->ls));

346 
__£lf
->
x´t
=
NULL
;

349 
	}
}

353 
PyObjeù
* 
	gMšCG
::
	$__®loc__
(
PyTy³Objeù
* 
ty³
,
Py_ssize_t
)

355 
Objeù
* 
__£lf
=
Ãw
 Object;

356 
	`Py_TYPE
(
__£lf
)=
ty³
;

357 
	`Py_REFCNT
(
__£lf
)=1;

358 
__£lf
->
mš
=
NULL
;

359 
__£lf
->
ls
=
NULL
;

360 
__£lf
->
x´t
=
NULL
;

361  
»š‹½»t_ÿ¡
<
PyObjeù
*>(
__£lf
);

362 
	}
}

366 
	gMšCG
::
	$__d—Îoc__
(
PyObjeù
* 
£lf
)

368 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

369 
d–‘e
 
__£lf
->
mš
;

370 
__£lf
->
mš
=
NULL
;

371 if(
__£lf
->
ls
è
	`Py_DECREF
(__self->ls);

372 
__£lf
->
ls
=
NULL
;

373 if(
__£lf
->
x´t
è
	`Py_DECREF
(__self->xprt);

374 
__£lf
->
x´t
=
NULL
;

375 
d–‘e
 
__£lf
;

376 
	}
}

378 
PyTy³Objeù
 
	gMšCG
::
Ty³Objeù
={
PyObjeù_HEAD_INIT
(
NULL
)};

380 
	gMšCG
::
	$£tup_
()

382 
Ty³Objeù
.
_Çme
="mapp.md.min_cg";

383 
Ty³Objeù
.
_doc
=
R
"---(

384 
	`__š™__
(
e_tŞ
=1.0e-8,
H_dof
=[[
F®£
],[F®£,F®£],[F®£,F®£,F®£]],
affše
=F®£,
max_dx
=1.0,
ls
=
m­p
.
	`ls_bt
())

386 
CG
 
mšimiz©iÚ
 
®gÜ™hm


388 
P¬am‘”s


390 
e_tŞ
 : 

391 
EÃrgy
 
tŞ”ªû
 
ü™”iÚ
 
¡İpšg
 
mšimiz©iÚ


392 
H_dof
 : 
symm
<
boŞ
[
dim
][dim]>

393 
Un™ûÎ
 
deg»es
 
of
 
ä“dom
 
duršg
 
mšimiz©iÚ
, 
h”e
 
dim
 
is
 
the
 
dim’siÚ
 oà
simuÏtiÚ


394 
affše
 : 
boŞ


395 
If
 
£t
 
to
 
True
 
©omic
 
di¥Ïûm’ts
 
would
 
be
 
affše


396 
max_dx
 : 

397 
Maximum
 
di¥Ïûm’t
 
of
 
ªy
 
©om
 
š
 
Úe
 
¡•
 oà
mšimiz©iÚ


398 
ls
 : 
m­p
.ls

399 
Lše
 
£¬ch
 
m‘hod


401 
NÙes


403 
Cojug©e
 
	`G¿d›Á
 (
CG
è
®gÜ™hm
 
mšimiz©iÚ
, 
£e
 :
c™e
:`
´ess_num”iÿl_2007
`.

405 
Reã»nûs


407 .. 
bibliog¿phy
:: ../
»fs
.
bib


408 :
f‹r
: 
doúame
 
š
 
doúames


409 :
¡yË
: 
un¤t


413 
Ty³Objeù
.
_æags
=
Py_TPFLAGS_DEFAULT
;

414 
Ty³Objeù
.
_basicsize
=(
Objeù
);

416 
Ty³Objeù
.
_Ãw
=
__Ãw__
;

417 
Ty³Objeù
.
_š™
=
__š™__
;

418 
Ty³Objeù
.
_®loc
=
__®loc__
;

419 
Ty³Objeù
.
_d—Îoc
=
__d—Îoc__
;

420 
	`£tup__m‘hods
();

421 
Ty³Objeù
.
_m‘hods
=
m‘hods
;

422 
	`£tup__g‘£t
();

423 
Ty³Objeù
.
_g‘£t
=
g‘£t
;

425 
ichk
=
	`PyTy³_R—dy
(&
Ty³Objeù
);

426 if(
ichk
<0)  ichk;

427 
	`Py_INCREF
(&
Ty³Objeù
);

433 
	`GET_WRAPPER_DOC
(
Ty³Objeù
,
__š™__
)=
NULL
;

434  
ichk
;

435 
	}
}

437 
PyG‘S‘Def
 
	gMšCG
::
g‘£t
[]=
Em±yPyG‘S‘Def
(8);

439 
	gMšCG
::
	$£tup__g‘£t
()

441 
	`g‘£t_e_tŞ
(
g‘£t
[0]);

442 
	`g‘£t_H_dof
(
g‘£t
[1]);

443 
	`g‘£t_affše
(
g‘£t
[2]);

444 
	`g‘£t_max_dx
(
g‘£t
[3]);

445 
	`g‘£t_ls
(
g‘£t
[4]);

446 
	`g‘£t_Á®ly
(
g‘£t
[5]);

447 
	`g‘£t_expÜt
(
g‘£t
[6]);

448 
	}
}

450 
PyM‘hodDef
 
	gMšCG
::
m‘hods
[]=
Em±yPyM‘hodDef
(3);

452 
	gMšCG
::
	$£tup__m‘hods
()

454 
	`ml_run
(
m‘hods
[0]);

455 
	`ml_ff_‹¡
(
m‘hods
[1]);

456 
	}
}

460 
	gMšCG
::
	$g‘£t_expÜt
(
PyG‘S‘Def
& 
g‘£t
)

462 
g‘£t
.
Çme
=(*)"export";

463 
g‘£t
.
doc
=(*)
R
"---(

464 (
m­p
.
md
.
expÜt
èexpÜˆ
objeù


466 
ExpÜt
 
objeù
 
to
 
»cÜd
 
the
 
¢­shÙs
 
of
h
sy¡em
 
mšimizšg


468 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

470 
ExpÜtMD
::
Objeù
* 
x´t
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
)->xprt;

471 if(!
x´t
è
Py_RETURN_NONE
;

472 
	`Py_INCREF
(
x´t
);

473  
»š‹½»t_ÿ¡
<
PyObjeù
*>(
x´t
);

475 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

477 
V¬API
<
OP
<
ExpÜtMD
>> 
	`x´t
("export");

478 
ichk
=
x´t
.
	`£t
(
İ
);

479 if(
ichk
==-1)  -1;

480 if(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
x´t
è
	`Py_DECREF
(reinterpret_cast<Object*>(self)->xprt);

481 
	`Py_INCREF
(
x´t
.
v®
.
ob
);

482 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
x´t
ôeš‹½»t_ÿ¡<
ExpÜtMD
::Objeù*>(x´t.
v®
.
ob
);

485 
	}
}

489 
	gMšCG
::
	$ml_run
(
PyM‘hodDef
& 
_m‘hods
)

491 
_m‘hods
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

492 
_m‘hods
.
ml_Çme
="run";

493 
_m‘hods
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

494 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

496 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

497 
FuncAPI
<
OP
<
AtomsMD
>,> 
	`f
("run",{"atoms","max_nsteps"});

498 
f
.
logics
<1>()[0]=
	`VLogics
("ge",0);

499 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

501 
AtomsMD
* 
__©oms
=
»š‹½»t_ÿ¡
<AtomsMD::
Objeù
*>(
f
.
v®
<0>().
ob
)->
©oms
;

502 
FÜûF›ldMD
* 
__ff
=
»š‹½»t_ÿ¡
<
AtomsMD
::
Objeù
*>(
f
.
v®
<0>().
ob
)->
ff
;

503 
ExpÜtMD
* 
__x´t
=
__£lf
->
x´t
==
NULL
 ? NULL:__self->xprt->xprt;

504 
Œy


506 
__£lf
->
mš
->
	`´e_run_chk
(
__©oms
,
__ff
);

508 
	`ÿtch
(
¡d
::
¡ršg
& 
”r_msg
)

510 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,
”r_msg
.
	`c_¡r
());

511  
NULL
;

514 
__£lf
->
mš
->
©oms
=
__©oms
;

515 
__£lf
->
mš
->
ff
=
__ff
;

516 
__£lf
->
mš
->
x´t
=
__x´t
;

518 
Œy


520 
__£lf
->
mš
->
	`š™
();

522 
	`ÿtch
(
¡d
::
¡ršg
& 
”r_msg
)

524 
__£lf
->
mš
->
x´t
=
NULL
;

525 
__£lf
->
mš
->
ff
=
NULL
;

526 
__£lf
->
mš
->
©oms
=
NULL
;

527 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,
”r_msg
.
	`c_¡r
());

528  
NULL
;

531 
__£lf
->
mš
->
	`run
(
f
.
v®
<1>());

533 
__£lf
->
mš
->
	`fš
();

535 
__£lf
->
mš
->
x´t
=
NULL
;

536 
__£lf
->
mš
->
ff
=
NULL
;

537 
__£lf
->
mš
->
©oms
=
NULL
;

539 
Py_RETURN_NONE
;

543 
_m‘hods
.
ml_doc
=(*)
R
"---(

544 
	`run
(
©oms
,
max_n¡•s
)

546 
Execu‹
 
mšimiz©iÚ


548 
This
 
m‘hod
 
¡¬ts
 
the
 
’”gy
 
mšimiz©iÚ
 
a
 
giv’
 
©oms
 
objeù
 
ªd
 
maximum
 
numb”
 
of
 
¡•s
.

550 
P¬am‘”s


552 
©oms
 : 
m­p
.
md
.atoms

553 
Sy¡em
 
of
 
š‹»¡


554 
max_n¡•s
 : 

555 
Maximum
 
numb”
 
of
 
¡•s
 
to
 
ach›ve
 
’”gy
 
mšimiz©iÚ


557 
R‘uºs


559 
NÚe


562 
	}
}

566 
MšCG
::
	$ml_ff_‹¡
(
PyM‘hodDef
& 
_m‘hods
)

568 
_m‘hods
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

569 
_m‘hods
.
ml_Çme
="ff_test";

570 
_m‘hods
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

571 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

573 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

574 
FuncAPI
<
OP
<
AtomsMD
>,,
ty³0
,ty³0,> 
	`f
("ff_test",{"atoms","seed","max_dx","max_strain","N"});

575 
f
.
logics
<1>()[0]=
	`VLogics
("ge",0);

576 
f
.
logics
<2>()[0]=
	`VLogics
("ge",0.0);

577 
f
.
logics
<3>()[0]=
	`VLogics
("ge",0.0);

578 
f
.
logics
<4>()[0]=
	`VLogics
("gt",0);

579 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

581 
AtomsMD
* 
__©oms
=
»š‹½»t_ÿ¡
<AtomsMD::
Objeù
*>(
f
.
v®
<0>().
ob
)->
©oms
;

582 
FÜûF›ldMD
* 
__ff
=
»š‹½»t_ÿ¡
<
AtomsMD
::
Objeù
*>(
f
.
v®
<0>().
ob
)->
ff
;

584 
__£lf
->
mš
->
©oms
=
__©oms
;

585 
__£lf
->
mš
->
ff
=
__ff
;

587 
__£lf
->
mš
->
	`ff_‹¡
(
f
.
v®
<1>(),f.val<2>(),f.val<3>(),f.val<4>());

591 
__£lf
->
mš
->
ff
=
NULL
;

592 
__£lf
->
mš
->
©oms
=
NULL
;

594 
Py_RETURN_NONE
;

598 
_m‘hods
.
ml_doc
=(*)
R
"---(

599 
ff_‹¡
,(
©oms
,
£ed
,
max_dx
,
max_¡¿š
,
N
)

601 
the
 
pu½o£
 
of
 
‹¡šg


603 
P¬am‘”s


605 
©oms
 : 
m­p
.
md
.atoms

606 
Sy¡em
 
of
 
š‹»¡


607 
max_n¡•s
 : 

608 
Maximum
 
numb”
 
of
 
¡•s
 
to
 
ach›ve
 
’”gy
 
mšimiz©iÚ


610 
R‘uºs


612 
NÚe


615 
	}
}

	@min_cg.h

1 #iâdeà
__MAPP__mš_cg__


2 
	#__MAPP__mš_cg__


	)

3 
	~"mš.h
"

4 
	~"mš_vec.h
"

5 
	~"ff_md.h
"

6 
	~"©oms_md.h
"

7 
	~"dyÇmic_md.h
"

8 
	~"MAPP.h
"

9 
	~"th”mo_dyÇmics.h
"

10 
Çme¥aû
 
	gMAPP_NS


12 şas 
	cMšCG
:
public
 
Mš


14 
´iv©e
:

15 
´Ùeùed
:

17 
´•
();

18 
ty³0
 
ÿlc_ndofs
();

19 
ty³0
 
	gndofs
;

21 
	gVecT’s
<
	gty³0
,1> 
	gh
;

22 
	gVecT’s
<
	gty³0
,1> 
	gx
;

23 
	gVecT’s
<
	gty³0
,1> 
	gx0
;

24 
	gVecT’s
<
	gty³0
,1> 
	gx_d
;

25 
	gVecT’s
<
	gty³0
,1> 
	gf
;

26 
	gVecT’s
<
	gty³0
,1> 
	gf0
;

28 
ty³0
 
	gS_tmp
[
__dim__
][__dim__];

30 
şass
 
AtomsMD
* 
	g©oms
;

31 
şass
 
FÜûF›ldMD
* 
	gff
;

32 
şass
 
DyÇmicMD
* 
	gdyÇmic
;

33 
şass
 
ExpÜtMD
* 
	gx´t
;

35 
	gpublic
:

36 
MšCG
(
ty³0
,
boŞ
(&)[
__dim__
][__dim__],boŞ,ty³0,
şass
 
LšeS—rch
*);

37 ~
MšCG
();

38 
vœtu®
 
run
();

39 
	g‹m¶©e
<
şass
 
	gC
>

40 
run
(
C
*,);

41 
vœtu®
 
š™
();

42 
vœtu®
 
fš
();

43 
ff_‹¡
(,
ty³0
,type0,);

44 
fÜû_ÿlc
();

46 
ty³0
 
F
(type0);

47 
ty³0
 
dF
(type0,type0&);

48 
ls_´•
(
ty³0
&,type0&,type0&);

49 
F_»£t
();

54 
PyObjeù_HEAD


55 
MšCG
* 
	gmš
;

56 
	gLšeS—rch
::
Objeù
* 
ls
;

57 
	gExpÜtMD
::
Objeù
* 
x´t
;

58 }
	tObjeù
;

60 
PyTy³Objeù
 
	gTy³Objeù
;

61 
PyObjeù
* 
__Ãw__
(
PyTy³Objeù
*,PyObject*, PyObject*);

62 
__š™__
(
PyObjeù
*, PyObject*,PyObject*);

63 
PyObjeù
* 
__®loc__
(
PyTy³Objeù
*,
Py_ssize_t
);

64 
__d—Îoc__
(
PyObjeù
*);

66 
PyM‘hodDef
 
	gm‘hods
[];

67 
£tup__m‘hods
();

68 
ml_run
(
PyM‘hodDef
&);

69 
ml_ff_‹¡
(
PyM‘hodDef
&);

71 
PyG‘S‘Def
 
	gg‘£t
[];

72 
£tup__g‘£t
();

73 
g‘£t_expÜt
(
PyG‘S‘Def
&);

75 
£tup_
();

81 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

85 
	g‹m¶©e
<
şass
 
	gC
>

86 
	gMšCG
::
	$run
(
C
* 
ls
,
n¡•s
)

88 
¡•
=
©oms
->step;

90 
	`fÜû_ÿlc
();

92 
Ãv”y_x´t
=
x´t
==
NULL
 ? 0:x´t->
Ãv”y
;

93 if(
Ãv”y_x´t
è
x´t
->
	`wr™e
(
¡•
);

95 
Th”moDyÇmics
 
	`th”mo
(6,

96 "PE",
©oms
->
³
,

97 "S[0][0]",
©oms
->
S_³
[0][0],

98 "S[1][1]",
©oms
->
S_³
[1][1],

99 "S[2][2]",
©oms
->
S_³
[2][2],

100 "S[1][2]",
©oms
->
S_³
[2][1],

101 "S[2][0]",
©oms
->
S_³
[2][0],

102 "S[0][1]",
©oms
->
S_³
[1][0]);

104 if(
Á®ly
è
th”mo
.
	`š™
();

105 if(
Á®ly
è
th”mo
.
	`´št
(
¡•
);

107 
ty³0
 
e_´ev
,
e_cu¼
=
©oms
->
³
;

108 
ty³0
 
f0_f0
,
f_f
,
f_f0
;

109 
ty³0
 
¿tio
,
®pha
;

110 
”r
=
n¡•s
==0? 
MIN_F_MAX_ITER
:
LS_S
;

111 
h
=
f
;

112 
f0_f0
=
f
*f;

113 
i¡•
=0;

114 ;
”r
==
LS_S
;
i¡•
++)

116 if(
f0_f0
==0.0)

118 
”r
=
LS_F_GRAD0
;

122 
x0
=
x
;

123 
f0
=
f
;

125 
e_´ev
=
e_cu¼
;

128 
f_h
=
f
*
h
;

129 if(
f_h
<0.0)

131 
h
=
f
;

132 
f_h
=
f0_f0
;

134 
	`´•
();

135 
”r
=
ls
->
	`mš
(
this
,
e_cu¼
,
®pha
,1);

137 if(
”r
!=
LS_S
)

141 
i¡•
--;

145 
	`fÜû_ÿlc
();

147 if(
Á®ly
 && (
i¡•
+1)%ntally==0)

148 
th”mo
.
	`´št
(
¡•
+
i¡•
+1);

150 if(
Ãv”y_x´t
 && (
i¡•
+1)%Ãv”y_x´t==0è
x´t
->
	`wr™e
(
¡•
+istep+1);

153 if(
e_´ev
-
e_cu¼
<
e_tŞ
è
”r
=
MIN_S_TOLERANCE
;

154 if(
i¡•
+1==
n¡•s
è
”r
=
MIN_F_MAX_ITER
;

155 if(
”r
) ;

157 
f_f
=
f
*f;

158 
f_f0
=
f
*
f0
;

160 
¿tio
=(
f_f
-
f_f0
)/(
f0_f0
);

162 
h
=
¿tio
*h+
f
;

163 
f0_f0
=
f_f
;

166 if(
Á®ly
 && 
i¡•
%ntally)

167 
th”mo
.
	`´št
(
¡•
+
i¡•
);

170 if(
Ãv”y_x´t
 && 
i¡•
%Ãv”y_x´tè
x´t
->
	`wr™e
(
¡•
+istep);

173 if(
Á®ly
è
th”mo
.
	`fš
();

175 if(
Á®ly
è
	`årštf
(
MAPP
::
m­p_out
,"%s",
”r_msgs
[
”r
]);

177 
©oms
->
¡•
+=
i¡•
;

178 
	}
}

	@min_cg3_dmd.cpp

1 
	~"mš_cg3_dmd.h
"

2 
	~<¡dlib.h
>

343 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

347 
	g‹m¶©e
<>

348 
	gMšDMDHªdËr
<
	gçl£
,çl£,çl£,
	gŒue
>::
	$š™
()

350 
f
.~
	`VECTENS1
();

351 
	`Ãw
 (&
f
è
	`VECTENS1
(
©oms
,
çl£
,
ff
->
F_H
,ff->
mu
);

352 
f0
.~
	`VECTENS1
();

353 
	`Ãw
 (&
f0
è
	`VECTENS1
(
©oms
,
çl£
,
c_dim
);

354 
h
.~
	`VECTENS1
();

355 
	`Ãw
 (&
h
è
	`VECTENS1
(
©oms
,
çl£
,
c_dim
);

357 
x
.~
	`VECTENS0
();

358 
	`Ãw
 (&
x
è
	`VECTENS0
(
©oms
,
çl£
,©oms->
H
,©oms->
c
);

359 
x0
.~
	`VECTENS0
();

360 
	`Ãw
 (&
x0
è
	`VECTENS0
(
©oms
,
çl£
,
c_dim
);

361 
x_d
.~
	`VECTENS0
();

362 
	`Ãw
 (&
x_d
è
	`VECTENS0
(
©oms
,
çl£
,
h
.
vecs
[0]);

363 
dyÇmic
=
Ãw
 
NewDyÇmicDMD
<
çl£
,çl£,çl£>(
©oms
,
ff
,{},

365 
©oms
->
x_dof
,©oms->
®pha_dof
,©oms->
c_dof
,

366 
h
.
vecs
[0],

367 
f0
.
vecs
[0],

368 
x0
.
vecs
[0]

370 
	}
}

374 
	g‹m¶©e
<>

375 
	gMšDMDHªdËr
<
	gçl£
,çl£,çl£,
	gŒue
>::
	$add_exŒa_vec
(
VECTENS1
& 
__v
)

377 
__v
.~
	`VECTENS1
();

378 
	`Ãw
 (&
__v
è
	`VECTENS1
(
©oms
,
çl£
,
c_dim
);

379 
dyÇmic
->
	`add_xchng
(
__v
.
vecs
[0]);

380 
	}
}

384 
	g‹m¶©e
<>

385 
	gMšDMDHªdËr
<
	gçl£
,çl£,
	gŒue
,çl£>::
	$š™
()

387 
f
.~
	`VECTENS1
();

388 
	`Ãw
 (&
f
è
	`VECTENS1
(
©oms
,
çl£
,
ff
->
F_H
,ff->
f_®pha
);

389 
f0
.~
	`VECTENS1
();

390 
	`Ãw
 (&
f0
è
	`VECTENS1
(
©oms
,
çl£
,
c_dim
);

391 
h
.~
	`VECTENS1
();

392 
	`Ãw
 (&
h
è
	`VECTENS1
(
©oms
,
çl£
,
c_dim
);

394 
x
.~
	`VECTENS0
();

395 
	`Ãw
 (&
x
è
	`VECTENS0
(
©oms
,
çl£
,©oms->
H
,©oms->
®pha
);

396 
x0
.~
	`VECTENS0
();

397 
	`Ãw
 (&
x0
è
	`VECTENS0
(
©oms
,
çl£
,
c_dim
);

398 
x_d
.~
	`VECTENS0
();

399 
	`Ãw
 (&
x_d
è
	`VECTENS0
(
©oms
,
çl£
,
h
.
vecs
[0]);

400 
dyÇmic
=
Ãw
 
NewDyÇmicDMD
<
çl£
,çl£,
Œue
>(
©oms
,
ff
,{},

402 
©oms
->
x_dof
,©oms->
®pha_dof
,©oms->
c_dof
,

403 
h
.
vecs
[0],

404 
f0
.
vecs
[0],

405 
x0
.
vecs
[0]

407 
	}
}

411 
	g‹m¶©e
<>

412 
	gMšDMDHªdËr
<
	gçl£
,çl£,
	gŒue
,çl£>::
	$add_exŒa_vec
(
VECTENS1
& 
__v
)

414 
__v
.~
	`VECTENS1
();

415 
	`Ãw
 (&
__v
è
	`VECTENS1
(
©oms
,
çl£
,
c_dim
);

416 
dyÇmic
->
	`add_xchng
(
__v
.
vecs
[0]);

417 
	}
}

421 
	g‹m¶©e
<>

422 
	gMšDMDHªdËr
<
	gçl£
,çl£,
	gŒue
,Œue>::
	$š™
()

424 
f
.~
	`VECTENS1
();

425 
	`Ãw
 (&
f
è
	`VECTENS1
(
©oms
,
çl£
,
ff
->
F_H
,ff->
f_®pha
,ff->
mu
);

426 
f0
.~
	`VECTENS1
();

427 
	`Ãw
 (&
f0
è
	`VECTENS1
(
©oms
,
çl£
,
c_dim
,c_dim);

428 
h
.~
	`VECTENS1
();

429 
	`Ãw
 (&
h
è
	`VECTENS1
(
©oms
,
çl£
,
c_dim
,c_dim);

431 
x
.~
	`VECTENS0
();

432 
	`Ãw
 (&
x
è
	`VECTENS0
(
©oms
,
çl£
,©oms->
H
,©oms->
®pha
,©oms->
c
);

433 
x0
.~
	`VECTENS0
();

434 
	`Ãw
 (&
x0
è
	`VECTENS0
(
©oms
,
çl£
,
c_dim
,c_dim);

435 
x_d
.~
	`VECTENS0
();

436 
	`Ãw
 (&
x_d
è
	`VECTENS0
(
©oms
,
çl£
,
h
.
vecs
[0],h.vecs[1]);

437 
dyÇmic
=
Ãw
 
NewDyÇmicDMD
<
çl£
,çl£,
Œue
>(
©oms
,
ff
,{},

439 
©oms
->
x_dof
,©oms->
®pha_dof
,©oms->
c_dof
,

440 
h
.
vecs
[0],h.vecs[1],

441 
f0
.
vecs
[0],f0.vecs[1],

442 
x0
.
vecs
[0],x0.vecs[1]

444 
	}
}

448 
	g‹m¶©e
<>

449 
	gMšDMDHªdËr
<
	gçl£
,çl£,
	gŒue
,Œue>::
	$add_exŒa_vec
(
VECTENS1
& 
__v
)

451 
__v
.~
	`VECTENS1
();

452 
	`Ãw
 (&
__v
è
	`VECTENS1
(
©oms
,
çl£
,
c_dim
,c_dim);

453 
dyÇmic
->
	`add_xchng
(
__v
.
vecs
[0]);

454 
dyÇmic
->
	`add_xchng
(
__v
.
vecs
[1]);

455 
	}
}

459 
	g‹m¶©e
<>

460 
	gMšDMDHªdËr
<
	gçl£
,
	gŒue
,çl£,çl£>::
	$š™
()

462 
f
.~
	`VECTENS1
();

463 
	`Ãw
 (&
f
è
	`VECTENS1
(
©oms
,
çl£
,
ff
->
F_H
,ff->f);

464 
f0
.~
	`VECTENS1
();

465 
	`Ãw
 (&
f0
è
	`VECTENS1
(
©oms
,
çl£
,
__dim__
);

466 
h
.~
	`VECTENS1
();

467 
	`Ãw
 (&
h
è
	`VECTENS1
(
©oms
,
çl£
,
__dim__
);

469 
x
.~
	`VECTENS0
();

470 
	`Ãw
 (&
x
è
	`VECTENS0
(
©oms
,
çl£
,©oms->
H
,atoms->x);

471 
x0
.~
	`VECTENS0
();

472 
	`Ãw
 (&
x0
è
	`VECTENS0
(
©oms
,
çl£
,
__dim__
);

473 
x_d
.~
	`VECTENS0
();

474 
	`Ãw
 (&
x_d
è
	`VECTENS0
(
©oms
,
çl£
,
h
.
vecs
[0]);

475 
dyÇmic
=
Ãw
 
NewDyÇmicDMD
<
çl£
,
Œue
,çl£>(
©oms
,
ff
,{},

477 
©oms
->
x_dof
,©oms->
®pha_dof
,©oms->
c_dof
,

478 
h
.
vecs
[0],

479 
f0
.
vecs
[0],

480 
x0
.
vecs
[0]

482 
	}
}

486 
	g‹m¶©e
<>

487 
	gMšDMDHªdËr
<
	gçl£
,
	gŒue
,çl£,çl£>::
	$add_exŒa_vec
(
VECTENS1
& 
__v
)

489 
__v
.~
	`VECTENS1
();

490 
	`Ãw
 (&
__v
è
	`VECTENS1
(
©oms
,
çl£
,
__dim__
);

491 
dyÇmic
->
	`add_xchng
(
__v
.
vecs
[0]);

492 
	}
}

496 
	g‹m¶©e
<>

497 
	gMšDMDHªdËr
<
	gçl£
,
	gŒue
,çl£,Œue>::
	$š™
()

499 
f
.~
	`VECTENS1
();

500 
	`Ãw
 (&
f
è
	`VECTENS1
(
©oms
,
çl£
,
ff
->
F_H
,ff->f,ff->
mu
);

501 
f0
.~
	`VECTENS1
();

502 
	`Ãw
 (&
f0
è
	`VECTENS1
(
©oms
,
çl£
,
__dim__
,
c_dim
);

503 
h
.~
	`VECTENS1
();

504 
	`Ãw
 (&
h
è
	`VECTENS1
(
©oms
,
çl£
,
__dim__
,
c_dim
);

506 
x
.~
	`VECTENS0
();

507 
	`Ãw
 (&
x
è
	`VECTENS0
(
©oms
,
çl£
,©oms->
H
,©oms->x,©oms->
c
);

508 
x0
.~
	`VECTENS0
();

509 
	`Ãw
 (&
x0
è
	`VECTENS0
(
©oms
,
çl£
,
__dim__
,
c_dim
);

510 
x_d
.~
	`VECTENS0
();

511 
	`Ãw
 (&
x_d
è
	`VECTENS0
(
©oms
,
çl£
,
h
.
vecs
[0],h.vecs[1]);

512 
dyÇmic
=
Ãw
 
NewDyÇmicDMD
<
çl£
,
Œue
,çl£>(
©oms
,
ff
,{},

514 
©oms
->
x_dof
,©oms->
®pha_dof
,©oms->
c_dof
,

515 
h
.
vecs
[0],h.vecs[1],

516 
f0
.
vecs
[0],f0.vecs[1],

517 
x0
.
vecs
[0],x0.vecs[1]

519 
	}
}

523 
	g‹m¶©e
<>

524 
	gMšDMDHªdËr
<
	gçl£
,
	gŒue
,çl£,Œue>::
	$add_exŒa_vec
(
VECTENS1
& 
__v
)

526 
__v
.~
	`VECTENS1
();

527 
	`Ãw
 (&
__v
è
	`VECTENS1
(
©oms
,
çl£
,
__dim__
,
c_dim
);

528 
dyÇmic
->
	`add_xchng
(
__v
.
vecs
[0]);

529 
dyÇmic
->
	`add_xchng
(
__v
.
vecs
[1]);

530 
	}
}

534 
	g‹m¶©e
<>

535 
	gMšDMDHªdËr
<
	gçl£
,
	gŒue
,Œue,çl£>::
	$š™
()

537 
f
.~
	`VECTENS1
();

538 
	`Ãw
 (&
f
è
	`VECTENS1
(
©oms
,
çl£
,
ff
->
F_H
,ff->f,ff->
f_®pha
);

539 
f0
.~
	`VECTENS1
();

540 
	`Ãw
 (&
f0
è
	`VECTENS1
(
©oms
,
çl£
,
__dim__
,
c_dim
);

541 
h
.~
	`VECTENS1
();

542 
	`Ãw
 (&
h
è
	`VECTENS1
(
©oms
,
çl£
,
__dim__
,
c_dim
);

544 
x
.~
	`VECTENS0
();

545 
	`Ãw
 (&
x
è
	`VECTENS0
(
©oms
,
çl£
,©oms->
H
,©oms->x,©oms->
®pha
);

546 
x0
.~
	`VECTENS0
();

547 
	`Ãw
 (&
x0
è
	`VECTENS0
(
©oms
,
çl£
,
__dim__
,
c_dim
);

548 
x_d
.~
	`VECTENS0
();

549 
	`Ãw
 (&
x_d
è
	`VECTENS0
(
©oms
,
çl£
,
h
.
vecs
[0],h.vecs[1]);

550 
dyÇmic
=
Ãw
 
NewDyÇmicDMD
<
çl£
,
Œue
,Œue>(
©oms
,
ff
,{},

552 
©oms
->
x_dof
,©oms->
®pha_dof
,©oms->
c_dof
,

553 
h
.
vecs
[0],h.vecs[1],

554 
f0
.
vecs
[0],f0.vecs[1],

555 
x0
.
vecs
[0],x0.vecs[1]

557 
	}
}

561 
	g‹m¶©e
<>

562 
	gMšDMDHªdËr
<
	gçl£
,
	gŒue
,Œue,çl£>::
	$add_exŒa_vec
(
VECTENS1
& 
__v
)

564 
__v
.~
	`VECTENS1
();

565 
	`Ãw
 (&
__v
è
	`VECTENS1
(
©oms
,
çl£
,
__dim__
,
c_dim
);

566 
dyÇmic
->
	`add_xchng
(
__v
.
vecs
[0]);

567 
dyÇmic
->
	`add_xchng
(
__v
.
vecs
[1]);

568 
	}
}

572 
	g‹m¶©e
<>

573 
	gMšDMDHªdËr
<
	gçl£
,
	gŒue
,Œue,Œue>::
	$š™
()

575 
f
.~
	`VECTENS1
();

576 
	`Ãw
 (&
f
è
	`VECTENS1
(
©oms
,
çl£
,
ff
->
F_H
,ff->f,ff->
f_®pha
,ff->
mu
);

577 
f0
.~
	`VECTENS1
();

578 
	`Ãw
 (&
f0
è
	`VECTENS1
(
©oms
,
çl£
,
__dim__
,
c_dim
,c_dim);

579 
h
.~
	`VECTENS1
();

580 
	`Ãw
 (&
h
è
	`VECTENS1
(
©oms
,
çl£
,
__dim__
,
c_dim
,c_dim);

582 
x
.~
	`VECTENS0
();

583 
	`Ãw
 (&
x
è
	`VECTENS0
(
©oms
,
çl£
,©oms->
H
,©oms->x,©oms->
®pha
,©oms->
c
);

584 
x0
.~
	`VECTENS0
();

585 
	`Ãw
 (&
x0
è
	`VECTENS0
(
©oms
,
çl£
,
__dim__
,
c_dim
,c_dim);

586 
x_d
.~
	`VECTENS0
();

587 
	`Ãw
 (&
x_d
è
	`VECTENS0
(
©oms
,
çl£
,
h
.
vecs
[0],h.vecs[1],h.vecs[2]);

588 
dyÇmic
=
Ãw
 
NewDyÇmicDMD
<
çl£
,
Œue
,Œue>(
©oms
,
ff
,{},

590 
©oms
->
x_dof
,©oms->
®pha_dof
,©oms->
c_dof
,

591 
h
.
vecs
[0],h.vecs[1],h.vecs[2],

592 
f0
.
vecs
[0],f0.vecs[1],f0.vecs[2],

593 
x0
.
vecs
[0],x0.vecs[1],x0.vecs[2]

595 
	}
}

599 
	g‹m¶©e
<>

600 
	gMšDMDHªdËr
<
	gçl£
,
	gŒue
,Œue,Œue>::
	$add_exŒa_vec
(
VECTENS1
& 
__v
)

602 
__v
.~
	`VECTENS1
();

603 
	`Ãw
 (&
__v
è
	`VECTENS1
(
©oms
,
çl£
,
__dim__
,
c_dim
,c_dim);

604 
dyÇmic
->
	`add_xchng
(
__v
.
vecs
[0]);

605 
dyÇmic
->
	`add_xchng
(
__v
.
vecs
[1]);

606 
dyÇmic
->
	`add_xchng
(
__v
.
vecs
[2]);

607 
	}
}

611 
	g‹m¶©e
<>

612 
	gMšDMDHªdËr
<
	gŒue
,
	gçl£
,çl£,çl£>::
	$š™
()

614 
f
.~
	`VECTENS1
();

615 
	`Ãw
 (&
f
è
	`VECTENS1
(
©oms
,
Œue
,
ff
->
F_H
);

616 
f0
.~
	`VECTENS1
();

617 
	`Ãw
 (&
f0
è
	`VECTENS1
(
©oms
,
Œue
);

618 
h
.~
	`VECTENS1
();

619 
	`Ãw
 (&
h
è
	`VECTENS1
(
©oms
,
Œue
);

621 
x
.~
	`VECTENS0
();

622 
	`Ãw
 (&
x
è
	`VECTENS0
(
©oms
,
Œue
,©oms->
H
,atoms->x);

623 
x0
.~
	`VECTENS0
();

624 
	`Ãw
 (&
x0
è
	`VECTENS0
(
©oms
,
Œue
,
__dim__
);

625 
x_d
.~
	`VECTENS0
();

626 
	`Ãw
 (&
x_d
è
	`VECTENS0
(
©oms
,
Œue
,
__dim__
);

627 
dyÇmic
=
Ãw
 
NewDyÇmicDMD
<
Œue
,Œue,
çl£
>(
©oms
,
ff
,{},

629 
©oms
->
x_dof
,©oms->
®pha_dof
,©oms->
c_dof
,

630 
x0
.
vecs
[0],

631 
x_d
.
vecs
[0]

633 
	}
}

637 
	g‹m¶©e
<>

638 
	gMšDMDHªdËr
<
	gŒue
,
	gçl£
,çl£,çl£>::
	$add_exŒa_vec
(
VECTENS1
& 
__v
)

640 
__v
.~
	`VECTENS1
();

641 
	`Ãw
 (&
__v
è
	`VECTENS1
(
©oms
,
Œue
);

642 
	}
}

646 
	g‹m¶©e
<>

647 
	gMšDMDHªdËr
<
	gŒue
,
	gçl£
,çl£,Œue>::
	$š™
()

649 
f
.~
	`VECTENS1
();

650 
	`Ãw
 (&
f
è
	`VECTENS1
(
©oms
,
Œue
,
ff
->
F_H
,ff->
mu
);

651 
f0
.~
	`VECTENS1
();

652 
	`Ãw
 (&
f0
è
	`VECTENS1
(
©oms
,
Œue
,
c_dim
);

653 
h
.~
	`VECTENS1
();

654 
	`Ãw
 (&
h
è
	`VECTENS1
(
©oms
,
Œue
,
c_dim
);

656 
x
.~
	`VECTENS0
();

657 
	`Ãw
 (&
x
è
	`VECTENS0
(
©oms
,
Œue
,©oms->
H
,©oms->x,©oms->
c
);

658 
x0
.~
	`VECTENS0
();

659 
	`Ãw
 (&
x0
è
	`VECTENS0
(
©oms
,
Œue
,
__dim__
,
c_dim
);

660 
x_d
.~
	`VECTENS0
();

661 
	`Ãw
 (&
x_d
è
	`VECTENS0
(
©oms
,
Œue
,
__dim__
,
h
.
vecs
[0]);

662 
dyÇmic
=
Ãw
 
NewDyÇmicDMD
<
Œue
,Œue,
çl£
>(
©oms
,
ff
,{},

664 
©oms
->
x_dof
,©oms->
®pha_dof
,©oms->
c_dof
,

665 
h
.
vecs
[0],

666 
f0
.
vecs
[0],

667 
x0
.
vecs
[0],x0.vecs[1],

668 
x_d
.
vecs
[0]

670 
	}
}

674 
	g‹m¶©e
<>

675 
	gMšDMDHªdËr
<
	gŒue
,
	gçl£
,çl£,Œue>::
	$add_exŒa_vec
(
VECTENS1
& 
__v
)

677 
__v
.~
	`VECTENS1
();

678 
	`Ãw
 (&
__v
è
	`VECTENS1
(
©oms
,
Œue
,
c_dim
);

679 
dyÇmic
->
	`add_xchng
(
__v
.
vecs
[0]);

680 
	}
}

684 
	g‹m¶©e
<>

685 
	gMšDMDHªdËr
<
	gŒue
,
	gçl£
,Œue,çl£>::
	$š™
()

687 
f
.~
	`VECTENS1
();

688 
	`Ãw
 (&
f
è
	`VECTENS1
(
©oms
,
Œue
,
ff
->
F_H
,ff->
f_®pha
);

689 
f0
.~
	`VECTENS1
();

690 
	`Ãw
 (&
f0
è
	`VECTENS1
(
©oms
,
Œue
,
c_dim
);

691 
h
.~
	`VECTENS1
();

692 
	`Ãw
 (&
h
è
	`VECTENS1
(
©oms
,
Œue
,
c_dim
);

694 
x
.~
	`VECTENS0
();

695 
	`Ãw
 (&
x
è
	`VECTENS0
(
©oms
,
Œue
,©oms->
H
,©oms->x,©oms->
®pha
);

696 
x0
.~
	`VECTENS0
();

697 
	`Ãw
 (&
x0
è
	`VECTENS0
(
©oms
,
Œue
,
__dim__
,
c_dim
);

698 
x_d
.~
	`VECTENS0
();

699 
	`Ãw
 (&
x_d
è
	`VECTENS0
(
©oms
,
Œue
,
__dim__
,
h
.
vecs
[0]);

700 
dyÇmic
=
Ãw
 
NewDyÇmicDMD
<
Œue
,Œue,Œue>(
©oms
,
ff
,{},

702 
©oms
->
x_dof
,©oms->
®pha_dof
,©oms->
c_dof
,

703 
h
.
vecs
[0],

704 
f0
.
vecs
[0],

705 
x0
.
vecs
[0],x0.vecs[1],

706 
x_d
.
vecs
[0]

708 
	}
}

712 
	g‹m¶©e
<>

713 
	gMšDMDHªdËr
<
	gŒue
,
	gçl£
,Œue,çl£>::
	$add_exŒa_vec
(
VECTENS1
& 
__v
)

715 
__v
.~
	`VECTENS1
();

716 
	`Ãw
 (&
__v
è
	`VECTENS1
(
©oms
,
Œue
,
c_dim
);

717 
dyÇmic
->
	`add_xchng
(
__v
.
vecs
[0]);

718 
	}
}

722 
	g‹m¶©e
<>

723 
	gMšDMDHªdËr
<
	gŒue
,
	gçl£
,Œue,Œue>::
	$š™
()

725 
f
.~
	`VECTENS1
();

726 
	`Ãw
 (&
f
è
	`VECTENS1
(
©oms
,
Œue
,
ff
->
F_H
,ff->
f_®pha
,ff->
mu
);

727 
f0
.~
	`VECTENS1
();

728 
	`Ãw
 (&
f0
è
	`VECTENS1
(
©oms
,
Œue
,
c_dim
,c_dim);

729 
h
.~
	`VECTENS1
();

730 
	`Ãw
 (&
h
è
	`VECTENS1
(
©oms
,
Œue
,
c_dim
,c_dim);

732 
x
.~
	`VECTENS0
();

733 
	`Ãw
 (&
x
è
	`VECTENS0
(
©oms
,
Œue
,©oms->
H
,©oms->x,©oms->
®pha
,©oms->
c
);

734 
x0
.~
	`VECTENS0
();

735 
	`Ãw
 (&
x0
è
	`VECTENS0
(
©oms
,
Œue
,
__dim__
,
c_dim
,c_dim);

736 
x_d
.~
	`VECTENS0
();

737 
	`Ãw
 (&
x_d
è
	`VECTENS0
(
©oms
,
Œue
,
__dim__
,
h
.
vecs
[0],h.vecs[1]);

738 
dyÇmic
=
Ãw
 
NewDyÇmicDMD
<
Œue
,Œue,Œue>(
©oms
,
ff
,{},

740 
©oms
->
x_dof
,©oms->
®pha_dof
,©oms->
c_dof
,

741 
h
.
vecs
[0],h.vecs[1],

742 
f0
.
vecs
[0],f0.vecs[1],

743 
x0
.
vecs
[0],x0.vecs[1],x0.vecs[2],

744 
x_d
.
vecs
[0]

746 
	}
}

750 
	g‹m¶©e
<>

751 
	gMšDMDHªdËr
<
	gŒue
,
	gçl£
,Œue,Œue>::
	$add_exŒa_vec
(
VECTENS1
& 
__v
)

753 
__v
.~
	`VECTENS1
();

754 
	`Ãw
 (&
__v
è
	`VECTENS1
(
©oms
,
Œue
,
c_dim
,c_dim);

755 
dyÇmic
->
	`add_xchng
(
__v
.
vecs
[0]);

756 
dyÇmic
->
	`add_xchng
(
__v
.
vecs
[1]);

757 
	}
}

761 
	g‹m¶©e
<>

762 
	gMšDMDHªdËr
<
	gŒue
,Œue,
	gçl£
,çl£>::
	$š™
()

764 
f
.~
	`VECTENS1
();

765 
	`Ãw
 (&
f
è
	`VECTENS1
(
©oms
,
Œue
,
ff
->
F_H
,ff->f);

766 
f0
.~
	`VECTENS1
();

767 
	`Ãw
 (&
f0
è
	`VECTENS1
(
©oms
,
Œue
,
__dim__
);

768 
h
.~
	`VECTENS1
();

769 
	`Ãw
 (&
h
è
	`VECTENS1
(
©oms
,
Œue
,
__dim__
);

771 
x
.~
	`VECTENS0
();

772 
	`Ãw
 (&
x
è
	`VECTENS0
(
©oms
,
Œue
,©oms->
H
,atoms->x);

773 
x0
.~
	`VECTENS0
();

774 
	`Ãw
 (&
x0
è
	`VECTENS0
(
©oms
,
Œue
,
__dim__
);

775 
x_d
.~
	`VECTENS0
();

776 
	`Ãw
 (&
x_d
è
	`VECTENS0
(
©oms
,
Œue
,
__dim__
);

777 
dyÇmic
=
Ãw
 
NewDyÇmicDMD
<
Œue
,Œue,
çl£
>(
©oms
,
ff
,{},

779 
©oms
->
x_dof
,©oms->
®pha_dof
,©oms->
c_dof
,

780 
h
.
vecs
[0],

781 
f0
.
vecs
[0],

782 
x0
.
vecs
[0],

783 
x_d
.
vecs
[0]

785 
	}
}

789 
	g‹m¶©e
<>

790 
	gMšDMDHªdËr
<
	gŒue
,Œue,
	gçl£
,çl£>::
	$add_exŒa_vec
(
VECTENS1
& 
__v
)

792 
__v
.~
	`VECTENS1
();

793 
	`Ãw
 (&
__v
è
	`VECTENS1
(
©oms
,
Œue
,
__dim__
);

794 
dyÇmic
->
	`add_xchng
(
__v
.
vecs
[0]);

795 
	}
}

799 
	g‹m¶©e
<>

800 
	gMšDMDHªdËr
<
	gŒue
,Œue,
	gçl£
,Œue>::
	$š™
()

802 
f
.~
	`VECTENS1
();

803 
	`Ãw
 (&
f
è
	`VECTENS1
(
©oms
,
Œue
,
ff
->
F_H
,ff->f,ff->
mu
);

804 
f0
.~
	`VECTENS1
();

805 
	`Ãw
 (&
f0
è
	`VECTENS1
(
©oms
,
Œue
,
__dim__
,
c_dim
);

806 
h
.~
	`VECTENS1
();

807 
	`Ãw
 (&
h
è
	`VECTENS1
(
©oms
,
Œue
,
__dim__
,
c_dim
);

809 
x
.~
	`VECTENS0
();

810 
	`Ãw
 (&
x
è
	`VECTENS0
(
©oms
,
Œue
,©oms->
H
,©oms->x,©oms->
c
);

811 
x0
.~
	`VECTENS0
();

812 
	`Ãw
 (&
x0
è
	`VECTENS0
(
©oms
,
Œue
,
__dim__
,
c_dim
);

813 
x_d
.~
	`VECTENS0
();

814 
	`Ãw
 (&
x_d
è
	`VECTENS0
(
©oms
,
Œue
,
__dim__
,
h
.
vecs
[1]);

815 
dyÇmic
=
Ãw
 
NewDyÇmicDMD
<
Œue
,Œue,
çl£
>(
©oms
,
ff
,{},

817 
©oms
->
x_dof
,©oms->
®pha_dof
,©oms->
c_dof
,

818 
h
.
vecs
[0],h.vecs[1],

819 
f0
.
vecs
[0],f0.vecs[1],

820 
x0
.
vecs
[0],x0.vecs[1],

821 
x_d
.
vecs
[0]

823 
	}
}

827 
	g‹m¶©e
<>

828 
	gMšDMDHªdËr
<
	gŒue
,Œue,
	gçl£
,Œue>::
	$add_exŒa_vec
(
VECTENS1
& 
__v
)

830 
__v
.~
	`VECTENS1
();

831 
	`Ãw
 (&
__v
è
	`VECTENS1
(
©oms
,
Œue
,
__dim__
,
c_dim
);

832 
dyÇmic
->
	`add_xchng
(
__v
.
vecs
[0]);

833 
dyÇmic
->
	`add_xchng
(
__v
.
vecs
[1]);

834 
	}
}

838 
	g‹m¶©e
<>

839 
	gMšDMDHªdËr
<
	gŒue
,Œue,Œue,
	gçl£
>::
	$š™
()

841 
f
.~
	`VECTENS1
();

842 
	`Ãw
 (&
f
è
	`VECTENS1
(
©oms
,
Œue
,
ff
->
F_H
,ff->f,ff->
f_®pha
);

843 
f0
.~
	`VECTENS1
();

844 
	`Ãw
 (&
f0
è
	`VECTENS1
(
©oms
,
Œue
,
__dim__
,
c_dim
);

845 
h
.~
	`VECTENS1
();

846 
	`Ãw
 (&
h
è
	`VECTENS1
(
©oms
,
Œue
,
__dim__
,
c_dim
);

848 
x
.~
	`VECTENS0
();

849 
	`Ãw
 (&
x
è
	`VECTENS0
(
©oms
,
Œue
,©oms->
H
,©oms->x,©oms->
®pha
);

850 
x0
.~
	`VECTENS0
();

851 
	`Ãw
 (&
x0
è
	`VECTENS0
(
©oms
,
Œue
,
__dim__
,
c_dim
);

852 
x_d
.~
	`VECTENS0
();

853 
	`Ãw
 (&
x_d
è
	`VECTENS0
(
©oms
,
Œue
,
__dim__
,
h
.
vecs
[1]);

854 
dyÇmic
=
Ãw
 
NewDyÇmicDMD
<
Œue
,Œue,Œue>(
©oms
,
ff
,{},

856 
©oms
->
x_dof
,©oms->
®pha_dof
,©oms->
c_dof
,

857 
h
.
vecs
[0],h.vecs[1],

858 
f0
.
vecs
[0],f0.vecs[1],

859 
x0
.
vecs
[0],x0.vecs[1],

860 
x_d
.
vecs
[0]

862 
	}
}

866 
	g‹m¶©e
<>

867 
	gMšDMDHªdËr
<
	gŒue
,Œue,Œue,
	gçl£
>::
	$add_exŒa_vec
(
VECTENS1
& 
__v
)

869 
__v
.~
	`VECTENS1
();

870 
	`Ãw
 (&
__v
è
	`VECTENS1
(
©oms
,
Œue
,
__dim__
,
c_dim
);

871 
dyÇmic
->
	`add_xchng
(
__v
.
vecs
[0]);

872 
dyÇmic
->
	`add_xchng
(
__v
.
vecs
[1]);

873 
	}
}

877 
	g‹m¶©e
<>

878 
	gMšDMDHªdËr
<
	gŒue
,Œue,Œue,Œue>::
	$š™
()

880 
f
.~
	`VECTENS1
();

881 
	`Ãw
 (&
f
è
	`VECTENS1
(
©oms
,
Œue
,
ff
->
F_H
,ff->f,ff->
f_®pha
,ff->
mu
);

882 
f0
.~
	`VECTENS1
();

883 
	`Ãw
 (&
f0
è
	`VECTENS1
(
©oms
,
Œue
,
__dim__
,
c_dim
,c_dim);

884 
h
.~
	`VECTENS1
();

885 
	`Ãw
 (&
h
è
	`VECTENS1
(
©oms
,
Œue
,
__dim__
,
c_dim
,c_dim);

887 
x
.~
	`VECTENS0
();

888 
	`Ãw
 (&
x
è
	`VECTENS0
(
©oms
,
Œue
,©oms->
H
,©oms->x,©oms->
®pha
,©oms->
c
);

889 
x0
.~
	`VECTENS0
();

890 
	`Ãw
 (&
x0
è
	`VECTENS0
(
©oms
,
Œue
,
__dim__
,
c_dim
,c_dim);

891 
x_d
.~
	`VECTENS0
();

892 
	`Ãw
 (&
x_d
è
	`VECTENS0
(
©oms
,
Œue
,
__dim__
,
h
.
vecs
[1],h.vecs[2]);

893 
dyÇmic
=
Ãw
 
NewDyÇmicDMD
<
Œue
,Œue,Œue>(
©oms
,
ff
,{},

895 
©oms
->
x_dof
,©oms->
®pha_dof
,©oms->
c_dof
,

896 
h
.
vecs
[0],h.vecs[1],h.vecs[2],

897 
f0
.
vecs
[0],f0.vecs[1],f0.vecs[2],

898 
x0
.
vecs
[0],x0.vecs[1],x0.vecs[2],

899 
x_d
.
vecs
[0]

901 
	}
}

905 
	g‹m¶©e
<>

906 
	gMšDMDHªdËr
<
	gŒue
,Œue,Œue,Œue>::
	$add_exŒa_vec
(
VECTENS1
& 
__v
)

908 
__v
.~
	`VECTENS1
();

909 
	`Ãw
 (&
__v
è
	`VECTENS1
(
©oms
,
Œue
,
__dim__
,
c_dim
,c_dim);

910 
dyÇmic
->
	`add_xchng
(
__v
.
vecs
[0]);

911 
dyÇmic
->
	`add_xchng
(
__v
.
vecs
[1]);

912 
dyÇmic
->
	`add_xchng
(
__v
.
vecs
[2]);

913 
	}
}

927 
	gMšCG3DMD
::
MšCG3DMD
(
ty³0
 
__e_tŞ
,

928 
boŞ
(&
__H_dof
)[
__dim__
][__dim__],boŞ 
__affše
,
ty³0
 
__max_dx
,ty³0 
__max_d®pha
,
LšeS—rch
* 
__ls
):

929 
Mš
(
__e_tŞ
,
__H_dof
,
__affše
,
__max_dx
,
__ls
),

930 
©oms
(
NULL
),

931 
ff
(
NULL
),

932 
max_d®pha
(
__max_d®pha
),

933 
x´t
(
NULL
),

934 
X_DOF
(
Œue
),

935 
ALPHA_DOF
(
Œue
),

936 
	$C_DOF
(
çl£
)

938 
	}
}

942 
	gMšCG3DMD
::~
	$MšCG3DMD
()

944 
©oms
=
NULL
;

945 
ff
=
NULL
;

946 
	}
}

950 
	gMšCG3DMD
::
	$´e_run_chk
(
AtomsDMD
* 
__©oms
,
FÜûF›ldDMD
* 
__ff
)

953 if(!
__©oms
)

954 
throw
 
¡d
::
	`¡ršg
("cannot start minimization without initial conditions");

957 if(!
__ff
)

958 
throw
 
¡d
::
	`¡ršg
("cannot start minimization without governingƒquations (force field)");

960 if(
¡d
::
	`i¢ª
(
__©oms
->
kB
))

961 
throw
 
¡d
::
	`¡ršg
("boltzmann constant should be set…rioro minimizatiom");

963 if(
¡d
::
	`i¢ª
(
__©oms
->
hP
))

964 
throw
 
¡d
::
	`¡ršg
("planck constant should be set…rioro minimizatiom");

967 if(
¡d
::
	`i¢ª
(
__©oms
->
‹mp
))

968 
throw
 
¡d
::
	`¡ršg
("temperature should be set…rioro minimizatiom");

970 if(
C_DOF
)

972 cÚ¡ 
c_dim
=
__©oms
->c_dim;

973 
ty³0
* 
c
=
__©oms
->c->
	`begš
();

974 
Çtms_lş
=
__©oms
->natms_lcl;

975 
boŞ
 
chk
=
Œue
;

976 
ty³0
 
cv
;

977 
i
=0;i<
Çtms_lş
 && 
chk
;i++,
c
+=
c_dim
)

979 
cv
=1.0;

980 
j
=0;j<
c_dim
;j++)

982 if(
c
[
j
]<0.0) ;

983 if(
c
[
j
]==0.0è
chk
=
çl£
;

984 
cv
-=
c
[
j
];

986 if(
cv
<=0.0è
chk
=
çl£
;

989 
”r_lş
=
chk
 ? 0:1;

990 
”r
;

991 
	`MPI_AÎ»duû
(&
”r_lş
,&
”r
,1,
Vec
<>::
MPI_T
,
MPI_MAX
,
__©oms
->
wÜld
);

992 if(
”r
)

993 
throw
 
¡d
::
	`¡ršg
("forƒnergy minimization‚o c can beƒither 0.0 or 1.0");

995 
	}
}

999 
	gMšCG3DMD
::
	$š™
()

1001 if(
x´t
)

1003 
Œy


1005 
x´t
->
©oms
=atoms;

1006 
x´t
->
	`š™
();

1008 
	`ÿtch
(
¡d
::
¡ršg
& 
”r_msg
)

1010 
	`fš
();

1011 
throw
 
”r_msg
;

1014 
	}
}

1018 
	gMšCG3DMD
::
	$fš
()

1020 if(
x´t
)

1022 
x´t
->
	`fš
();

1023 
x´t
->
©oms
=
NULL
;

1025 
	}
}

1029 
	gMšCG3DMD
::
	$run
(
n¡•s
)

1031 if(
dyÇmic_ÿ¡
<
LšeS—rchB»Á
*>(
ls
)!=
NULL
 && 
chng_box
==
çl£
 && 
X_DOF
==çl£ && 
ALPHA_DOF
==çl£ && 
C_DOF
==
Œue
)

1032  
run
<
çl£
,çl£,çl£,
Œue
>(
dyÇmic_ÿ¡
<
LšeS—rchB»Á
*>(
ls
),
n¡•s
);

1033 if(
dyÇmic_ÿ¡
<
LšeS—rchGŞd’SeùiÚ
*>(
ls
)!=
NULL
 && 
chng_box
==
çl£
 && 
X_DOF
==çl£ && 
ALPHA_DOF
==çl£ && 
C_DOF
==
Œue
)

1034  
run
<
çl£
,çl£,çl£,
Œue
>(
dyÇmic_ÿ¡
<
LšeS—rchGŞd’SeùiÚ
*>(
ls
),
n¡•s
);

1035 if(
dyÇmic_ÿ¡
<
LšeS—rchBackT¿ck
*>(
ls
)!=
NULL
 && 
chng_box
==
çl£
 && 
X_DOF
==çl£ && 
ALPHA_DOF
==çl£ && 
C_DOF
==
Œue
)

1036  
run
<
çl£
,çl£,çl£,
Œue
>(
dyÇmic_ÿ¡
<
LšeS—rchBackT¿ck
*>(
ls
),
n¡•s
);

1037 if(
dyÇmic_ÿ¡
<
LšeS—rchB»Á
*>(
ls
)!=
NULL
 && 
chng_box
==
çl£
 && 
X_DOF
==çl£ && 
ALPHA_DOF
==
Œue
 && 
C_DOF
==false)

1038  
run
<
çl£
,çl£,
Œue
,çl£>(
dyÇmic_ÿ¡
<
LšeS—rchB»Á
*>(
ls
),
n¡•s
);

1039 if(
dyÇmic_ÿ¡
<
LšeS—rchGŞd’SeùiÚ
*>(
ls
)!=
NULL
 && 
chng_box
==
çl£
 && 
X_DOF
==çl£ && 
ALPHA_DOF
==
Œue
 && 
C_DOF
==false)

1040  
run
<
çl£
,çl£,
Œue
,çl£>(
dyÇmic_ÿ¡
<
LšeS—rchGŞd’SeùiÚ
*>(
ls
),
n¡•s
);

1041 if(
dyÇmic_ÿ¡
<
LšeS—rchBackT¿ck
*>(
ls
)!=
NULL
 && 
chng_box
==
çl£
 && 
X_DOF
==çl£ && 
ALPHA_DOF
==
Œue
 && 
C_DOF
==false)

1042  
run
<
çl£
,çl£,
Œue
,çl£>(
dyÇmic_ÿ¡
<
LšeS—rchBackT¿ck
*>(
ls
),
n¡•s
);

1043 if(
dyÇmic_ÿ¡
<
LšeS—rchB»Á
*>(
ls
)!=
NULL
 && 
chng_box
==
çl£
 && 
X_DOF
==çl£ && 
ALPHA_DOF
==
Œue
 && 
C_DOF
==true)

1044  
run
<
çl£
,çl£,
Œue
,Œue>(
dyÇmic_ÿ¡
<
LšeS—rchB»Á
*>(
ls
),
n¡•s
);

1045 if(
dyÇmic_ÿ¡
<
LšeS—rchGŞd’SeùiÚ
*>(
ls
)!=
NULL
 && 
chng_box
==
çl£
 && 
X_DOF
==çl£ && 
ALPHA_DOF
==
Œue
 && 
C_DOF
==true)

1046  
run
<
çl£
,çl£,
Œue
,Œue>(
dyÇmic_ÿ¡
<
LšeS—rchGŞd’SeùiÚ
*>(
ls
),
n¡•s
);

1047 if(
dyÇmic_ÿ¡
<
LšeS—rchBackT¿ck
*>(
ls
)!=
NULL
 && 
chng_box
==
çl£
 && 
X_DOF
==çl£ && 
ALPHA_DOF
==
Œue
 && 
C_DOF
==true)

1048  
run
<
çl£
,çl£,
Œue
,Œue>(
dyÇmic_ÿ¡
<
LšeS—rchBackT¿ck
*>(
ls
),
n¡•s
);

1049 if(
dyÇmic_ÿ¡
<
LšeS—rchB»Á
*>(
ls
)!=
NULL
 && 
chng_box
==
çl£
 && 
X_DOF
==
Œue
 && 
ALPHA_DOF
==çl£ && 
C_DOF
==false)

1050  
run
<
çl£
,
Œue
,çl£,çl£>(
dyÇmic_ÿ¡
<
LšeS—rchB»Á
*>(
ls
),
n¡•s
);

1051 if(
dyÇmic_ÿ¡
<
LšeS—rchGŞd’SeùiÚ
*>(
ls
)!=
NULL
 && 
chng_box
==
çl£
 && 
X_DOF
==
Œue
 && 
ALPHA_DOF
==çl£ && 
C_DOF
==false)

1052  
run
<
çl£
,
Œue
,çl£,çl£>(
dyÇmic_ÿ¡
<
LšeS—rchGŞd’SeùiÚ
*>(
ls
),
n¡•s
);

1053 if(
dyÇmic_ÿ¡
<
LšeS—rchBackT¿ck
*>(
ls
)!=
NULL
 && 
chng_box
==
çl£
 && 
X_DOF
==
Œue
 && 
ALPHA_DOF
==çl£ && 
C_DOF
==false)

1054  
run
<
çl£
,
Œue
,çl£,çl£>(
dyÇmic_ÿ¡
<
LšeS—rchBackT¿ck
*>(
ls
),
n¡•s
);

1055 if(
dyÇmic_ÿ¡
<
LšeS—rchB»Á
*>(
ls
)!=
NULL
 && 
chng_box
==
çl£
 && 
X_DOF
==
Œue
 && 
ALPHA_DOF
==çl£ && 
C_DOF
==true)

1056  
run
<
çl£
,
Œue
,çl£,Œue>(
dyÇmic_ÿ¡
<
LšeS—rchB»Á
*>(
ls
),
n¡•s
);

1057 if(
dyÇmic_ÿ¡
<
LšeS—rchGŞd’SeùiÚ
*>(
ls
)!=
NULL
 && 
chng_box
==
çl£
 && 
X_DOF
==
Œue
 && 
ALPHA_DOF
==çl£ && 
C_DOF
==true)

1058  
run
<
çl£
,
Œue
,çl£,Œue>(
dyÇmic_ÿ¡
<
LšeS—rchGŞd’SeùiÚ
*>(
ls
),
n¡•s
);

1059 if(
dyÇmic_ÿ¡
<
LšeS—rchBackT¿ck
*>(
ls
)!=
NULL
 && 
chng_box
==
çl£
 && 
X_DOF
==
Œue
 && 
ALPHA_DOF
==çl£ && 
C_DOF
==true)

1060  
run
<
çl£
,
Œue
,çl£,Œue>(
dyÇmic_ÿ¡
<
LšeS—rchBackT¿ck
*>(
ls
),
n¡•s
);

1061 if(
dyÇmic_ÿ¡
<
LšeS—rchB»Á
*>(
ls
)!=
NULL
 && 
chng_box
==
çl£
 && 
X_DOF
==
Œue
 && 
ALPHA_DOF
=ñru&& 
C_DOF
==false)

1062  
run
<
çl£
,
Œue
,Œue,çl£>(
dyÇmic_ÿ¡
<
LšeS—rchB»Á
*>(
ls
),
n¡•s
);

1063 if(
dyÇmic_ÿ¡
<
LšeS—rchGŞd’SeùiÚ
*>(
ls
)!=
NULL
 && 
chng_box
==
çl£
 && 
X_DOF
==
Œue
 && 
ALPHA_DOF
=ñru&& 
C_DOF
==false)

1064  
run
<
çl£
,
Œue
,Œue,çl£>(
dyÇmic_ÿ¡
<
LšeS—rchGŞd’SeùiÚ
*>(
ls
),
n¡•s
);

1065 if(
dyÇmic_ÿ¡
<
LšeS—rchBackT¿ck
*>(
ls
)!=
NULL
 && 
chng_box
==
çl£
 && 
X_DOF
==
Œue
 && 
ALPHA_DOF
=ñru&& 
C_DOF
==false)

1066  
run
<
çl£
,
Œue
,Œue,çl£>(
dyÇmic_ÿ¡
<
LšeS—rchBackT¿ck
*>(
ls
),
n¡•s
);

1067 if(
dyÇmic_ÿ¡
<
LšeS—rchB»Á
*>(
ls
)!=
NULL
 && 
chng_box
==
çl£
 && 
X_DOF
==
Œue
 && 
ALPHA_DOF
=ñru&& 
C_DOF
==true)

1068  
run
<
çl£
,
Œue
,Œue,Œue>(
dyÇmic_ÿ¡
<
LšeS—rchB»Á
*>(
ls
),
n¡•s
);

1069 if(
dyÇmic_ÿ¡
<
LšeS—rchGŞd’SeùiÚ
*>(
ls
)!=
NULL
 && 
chng_box
==
çl£
 && 
X_DOF
==
Œue
 && 
ALPHA_DOF
=ñru&& 
C_DOF
==true)

1070  
run
<
çl£
,
Œue
,Œue,Œue>(
dyÇmic_ÿ¡
<
LšeS—rchGŞd’SeùiÚ
*>(
ls
),
n¡•s
);

1071 if(
dyÇmic_ÿ¡
<
LšeS—rchBackT¿ck
*>(
ls
)!=
NULL
 && 
chng_box
==
çl£
 && 
X_DOF
==
Œue
 && 
ALPHA_DOF
=ñru&& 
C_DOF
==true)

1072  
run
<
çl£
,
Œue
,Œue,Œue>(
dyÇmic_ÿ¡
<
LšeS—rchBackT¿ck
*>(
ls
),
n¡•s
);

1073 if(
dyÇmic_ÿ¡
<
LšeS—rchB»Á
*>(
ls
)!=
NULL
 && 
chng_box
==
Œue
 && 
X_DOF
==
çl£
 && 
ALPHA_DOF
==çl£ && 
C_DOF
==false)

1074  
run
<
Œue
,
çl£
,çl£,çl£>(
dyÇmic_ÿ¡
<
LšeS—rchB»Á
*>(
ls
),
n¡•s
);

1075 if(
dyÇmic_ÿ¡
<
LšeS—rchGŞd’SeùiÚ
*>(
ls
)!=
NULL
 && 
chng_box
==
Œue
 && 
X_DOF
==
çl£
 && 
ALPHA_DOF
==çl£ && 
C_DOF
==false)

1076  
run
<
Œue
,
çl£
,çl£,çl£>(
dyÇmic_ÿ¡
<
LšeS—rchGŞd’SeùiÚ
*>(
ls
),
n¡•s
);

1077 if(
dyÇmic_ÿ¡
<
LšeS—rchBackT¿ck
*>(
ls
)!=
NULL
 && 
chng_box
==
Œue
 && 
X_DOF
==
çl£
 && 
ALPHA_DOF
==çl£ && 
C_DOF
==false)

1078  
run
<
Œue
,
çl£
,çl£,çl£>(
dyÇmic_ÿ¡
<
LšeS—rchBackT¿ck
*>(
ls
),
n¡•s
);

1079 if(
dyÇmic_ÿ¡
<
LšeS—rchB»Á
*>(
ls
)!=
NULL
 && 
chng_box
==
Œue
 && 
X_DOF
==
çl£
 && 
ALPHA_DOF
==çl£ && 
C_DOF
==true)

1080  
run
<
Œue
,
çl£
,çl£,Œue>(
dyÇmic_ÿ¡
<
LšeS—rchB»Á
*>(
ls
),
n¡•s
);

1081 if(
dyÇmic_ÿ¡
<
LšeS—rchGŞd’SeùiÚ
*>(
ls
)!=
NULL
 && 
chng_box
==
Œue
 && 
X_DOF
==
çl£
 && 
ALPHA_DOF
==çl£ && 
C_DOF
==true)

1082  
run
<
Œue
,
çl£
,çl£,Œue>(
dyÇmic_ÿ¡
<
LšeS—rchGŞd’SeùiÚ
*>(
ls
),
n¡•s
);

1083 if(
dyÇmic_ÿ¡
<
LšeS—rchBackT¿ck
*>(
ls
)!=
NULL
 && 
chng_box
==
Œue
 && 
X_DOF
==
çl£
 && 
ALPHA_DOF
==çl£ && 
C_DOF
==true)

1084  
run
<
Œue
,
çl£
,çl£,Œue>(
dyÇmic_ÿ¡
<
LšeS—rchBackT¿ck
*>(
ls
),
n¡•s
);

1085 if(
dyÇmic_ÿ¡
<
LšeS—rchB»Á
*>(
ls
)!=
NULL
 && 
chng_box
==
Œue
 && 
X_DOF
==
çl£
 && 
ALPHA_DOF
=ñru&& 
C_DOF
==false)

1086  
run
<
Œue
,
çl£
,Œue,çl£>(
dyÇmic_ÿ¡
<
LšeS—rchB»Á
*>(
ls
),
n¡•s
);

1087 if(
dyÇmic_ÿ¡
<
LšeS—rchGŞd’SeùiÚ
*>(
ls
)!=
NULL
 && 
chng_box
==
Œue
 && 
X_DOF
==
çl£
 && 
ALPHA_DOF
=ñru&& 
C_DOF
==false)

1088  
run
<
Œue
,
çl£
,Œue,çl£>(
dyÇmic_ÿ¡
<
LšeS—rchGŞd’SeùiÚ
*>(
ls
),
n¡•s
);

1089 if(
dyÇmic_ÿ¡
<
LšeS—rchBackT¿ck
*>(
ls
)!=
NULL
 && 
chng_box
==
Œue
 && 
X_DOF
==
çl£
 && 
ALPHA_DOF
=ñru&& 
C_DOF
==false)

1090  
run
<
Œue
,
çl£
,Œue,çl£>(
dyÇmic_ÿ¡
<
LšeS—rchBackT¿ck
*>(
ls
),
n¡•s
);

1091 if(
dyÇmic_ÿ¡
<
LšeS—rchB»Á
*>(
ls
)!=
NULL
 && 
chng_box
==
Œue
 && 
X_DOF
==
çl£
 && 
ALPHA_DOF
=ñru&& 
C_DOF
==true)

1092  
run
<
Œue
,
çl£
,Œue,Œue>(
dyÇmic_ÿ¡
<
LšeS—rchB»Á
*>(
ls
),
n¡•s
);

1093 if(
dyÇmic_ÿ¡
<
LšeS—rchGŞd’SeùiÚ
*>(
ls
)!=
NULL
 && 
chng_box
==
Œue
 && 
X_DOF
==
çl£
 && 
ALPHA_DOF
=ñru&& 
C_DOF
==true)

1094  
run
<
Œue
,
çl£
,Œue,Œue>(
dyÇmic_ÿ¡
<
LšeS—rchGŞd’SeùiÚ
*>(
ls
),
n¡•s
);

1095 if(
dyÇmic_ÿ¡
<
LšeS—rchBackT¿ck
*>(
ls
)!=
NULL
 && 
chng_box
==
Œue
 && 
X_DOF
==
çl£
 && 
ALPHA_DOF
=ñru&& 
C_DOF
==true)

1096  
run
<
Œue
,
çl£
,Œue,Œue>(
dyÇmic_ÿ¡
<
LšeS—rchBackT¿ck
*>(
ls
),
n¡•s
);

1097 if(
dyÇmic_ÿ¡
<
LšeS—rchB»Á
*>(
ls
)!=
NULL
 && 
chng_box
==
Œue
 && 
X_DOF
=ñru&& 
ALPHA_DOF
==
çl£
 && 
C_DOF
==false)

1098  
run
<
Œue
,Œue,
çl£
,çl£>(
dyÇmic_ÿ¡
<
LšeS—rchB»Á
*>(
ls
),
n¡•s
);

1099 if(
dyÇmic_ÿ¡
<
LšeS—rchGŞd’SeùiÚ
*>(
ls
)!=
NULL
 && 
chng_box
==
Œue
 && 
X_DOF
=ñru&& 
ALPHA_DOF
==
çl£
 && 
C_DOF
==false)

1100  
run
<
Œue
,Œue,
çl£
,çl£>(
dyÇmic_ÿ¡
<
LšeS—rchGŞd’SeùiÚ
*>(
ls
),
n¡•s
);

1101 if(
dyÇmic_ÿ¡
<
LšeS—rchBackT¿ck
*>(
ls
)!=
NULL
 && 
chng_box
==
Œue
 && 
X_DOF
=ñru&& 
ALPHA_DOF
==
çl£
 && 
C_DOF
==false)

1102  
run
<
Œue
,Œue,
çl£
,çl£>(
dyÇmic_ÿ¡
<
LšeS—rchBackT¿ck
*>(
ls
),
n¡•s
);

1103 if(
dyÇmic_ÿ¡
<
LšeS—rchB»Á
*>(
ls
)!=
NULL
 && 
chng_box
==
Œue
 && 
X_DOF
=ñru&& 
ALPHA_DOF
==
çl£
 && 
C_DOF
==true)

1104  
run
<
Œue
,Œue,
çl£
,Œue>(
dyÇmic_ÿ¡
<
LšeS—rchB»Á
*>(
ls
),
n¡•s
);

1105 if(
dyÇmic_ÿ¡
<
LšeS—rchGŞd’SeùiÚ
*>(
ls
)!=
NULL
 && 
chng_box
==
Œue
 && 
X_DOF
=ñru&& 
ALPHA_DOF
==
çl£
 && 
C_DOF
==true)

1106  
run
<
Œue
,Œue,
çl£
,Œue>(
dyÇmic_ÿ¡
<
LšeS—rchGŞd’SeùiÚ
*>(
ls
),
n¡•s
);

1107 if(
dyÇmic_ÿ¡
<
LšeS—rchBackT¿ck
*>(
ls
)!=
NULL
 && 
chng_box
==
Œue
 && 
X_DOF
=ñru&& 
ALPHA_DOF
==
çl£
 && 
C_DOF
==true)

1108  
run
<
Œue
,Œue,
çl£
,Œue>(
dyÇmic_ÿ¡
<
LšeS—rchBackT¿ck
*>(
ls
),
n¡•s
);

1109 if(
dyÇmic_ÿ¡
<
LšeS—rchB»Á
*>(
ls
)!=
NULL
 && 
chng_box
==
Œue
 && 
X_DOF
=ñru&& 
ALPHA_DOF
=ñru&& 
C_DOF
==
çl£
)

1110  
run
<
Œue
,Œue,Œue,
çl£
>(
dyÇmic_ÿ¡
<
LšeS—rchB»Á
*>(
ls
),
n¡•s
);

1111 if(
dyÇmic_ÿ¡
<
LšeS—rchGŞd’SeùiÚ
*>(
ls
)!=
NULL
 && 
chng_box
==
Œue
 && 
X_DOF
=ñru&& 
ALPHA_DOF
=ñru&& 
C_DOF
==
çl£
)

1112  
run
<
Œue
,Œue,Œue,
çl£
>(
dyÇmic_ÿ¡
<
LšeS—rchGŞd’SeùiÚ
*>(
ls
),
n¡•s
);

1113 if(
dyÇmic_ÿ¡
<
LšeS—rchBackT¿ck
*>(
ls
)!=
NULL
 && 
chng_box
==
Œue
 && 
X_DOF
=ñru&& 
ALPHA_DOF
=ñru&& 
C_DOF
==
çl£
)

1114  
run
<
Œue
,Œue,Œue,
çl£
>(
dyÇmic_ÿ¡
<
LšeS—rchBackT¿ck
*>(
ls
),
n¡•s
);

1115 if(
dyÇmic_ÿ¡
<
LšeS—rchB»Á
*>(
ls
)!=
NULL
 && 
chng_box
==
Œue
 && 
X_DOF
=ñru&& 
ALPHA_DOF
=ñru&& 
C_DOF
==true)

1116  
run
<
Œue
,Œue,Œue,Œue>(
dyÇmic_ÿ¡
<
LšeS—rchB»Á
*>(
ls
),
n¡•s
);

1117 if(
dyÇmic_ÿ¡
<
LšeS—rchGŞd’SeùiÚ
*>(
ls
)!=
NULL
 && 
chng_box
==
Œue
 && 
X_DOF
=ñru&& 
ALPHA_DOF
=ñru&& 
C_DOF
==true)

1118  
run
<
Œue
,Œue,Œue,Œue>(
dyÇmic_ÿ¡
<
LšeS—rchGŞd’SeùiÚ
*>(
ls
),
n¡•s
);

1119 if(
dyÇmic_ÿ¡
<
LšeS—rchBackT¿ck
*>(
ls
)!=
NULL
 && 
chng_box
==
Œue
 && 
X_DOF
=ñru&& 
ALPHA_DOF
=ñru&& 
C_DOF
==true)

1120  
run
<
Œue
,Œue,Œue,Œue>(
dyÇmic_ÿ¡
<
LšeS—rchBackT¿ck
*>(
ls
),
n¡•s
);

1121 
	}
}

1125 
PyObjeù
* 
	gMšCG3DMD
::
	$__Ãw__
(
PyTy³Objeù
* 
ty³
,
PyObjeù
* 
¬gs
,PyObjeù* 
kwds
)

1127 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
ty³
->
	`_®loc
(type,0));

1128 
PyObjeù
* 
£lf
=
»š‹½»t_ÿ¡
<PyObjeù*>(
__£lf
);

1129  
£lf
;

1130 
	}
}

1134 
	gMšCG3DMD
::
	$__š™__
(
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)

1136 
FuncAPI
<
ty³0
,
symm
<
boŞ
[
__dim__
][__dim__]>,boŞ,ty³0,ty³0,
OP
<
LšeS—rch
>> 
	`f
("__init__",{"e_tol","H_dof","affine","max_dx","max_dalpha","ls"});

1137 
f
.
nİtiÚ®s
=6;

1138 
f
.
logics
<0>()[0]=
	`VLogics
("ge",0.0);

1139 
f
.
logics
<3>()[0]=
	`VLogics
("gt",0.0);

1140 
f
.
logics
<4>()[0]=
	`VLogics
("gt",0.0);

1143 
f
.
v®
<0>()=
	`sq¹
(
¡d
::
num”ic_lim™s
<
ty³0
>::
	`•sÚ
());

1144 
i
=0;i<
__dim__
;i++è
j
=0;j<__dim__;j++)
f
.
v®
<1>()[i][j]=
çl£
;

1145 
f
.
v®
<2>()=
çl£
;

1146 
f
.
v®
<3>()=1.0;

1147 
f
.
v®
<4>()=0.1;

1148 
PyObjeù
* 
em±y_tu¶e
=
	`PyTu¶e_New
(0);

1149 
PyObjeù
* 
em±y_diù
=
	`PyDiù_New
();

1150 
PyObjeù
* 
__ls
=
LšeS—rchBackT¿ck
::
	`__Ãw__
(&LšeS—rchBackT¿ck::
Ty³Objeù
,
em±y_tu¶e
,
em±y_diù
);

1151 
LšeS—rchBackT¿ck
::
	`__š™__
(
__ls
,
em±y_tu¶e
,
em±y_diù
);

1152 
	`Py_DECREF
(
em±y_diù
);

1153 
	`Py_DECREF
(
em±y_tu¶e
);

1154 
f
.
v®
<5>().
ob
=
__ls
;

1157 if(
	`f
(
¬gs
,
kwds
)==-1)  -1;

1161 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

1162 
	`Py_INCREF
(
f
.
v®
<5>().
ob
);

1163 
__£lf
->
ls
=
»š‹½»t_ÿ¡
<
LšeS—rch
::
Objeù
*>(
f
.
v®
<5>().
ob
);

1164 
__£lf
->
mš
=
Ãw
 
	`MšCG3DMD
(
f
.
v®
<0>(),f.v®<1>(),f.v®<2>(),f.v®<3>(),f.v®<4>(),&(__£lf->
ls
->ls));

1165 
__£lf
->
x´t
=
NULL
;

1168 
	}
}

1172 
PyObjeù
* 
	gMšCG3DMD
::
	$__®loc__
(
PyTy³Objeù
* 
ty³
,
Py_ssize_t
)

1174 
Objeù
* 
__£lf
=
Ãw
 Object;

1175 
	`Py_TYPE
(
__£lf
)=
ty³
;

1176 
	`Py_REFCNT
(
__£lf
)=1;

1177 
__£lf
->
mš
=
NULL
;

1178 
__£lf
->
ls
=
NULL
;

1179 
__£lf
->
x´t
=
NULL
;

1180  
»š‹½»t_ÿ¡
<
PyObjeù
*>(
__£lf
);

1181 
	}
}

1185 
	gMšCG3DMD
::
	$__d—Îoc__
(
PyObjeù
* 
£lf
)

1187 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

1188 
d–‘e
 
__£lf
->
mš
;

1189 
__£lf
->
mš
=
NULL
;

1190 if(
__£lf
->
ls
è
	`Py_DECREF
(__self->ls);

1191 
__£lf
->
ls
=
NULL
;

1192 if(
__£lf
->
x´t
è
	`Py_DECREF
(__self->xprt);

1193 
__£lf
->
x´t
=
NULL
;

1194 
d–‘e
 
__£lf
;

1195 
	}
}

1197 
PyTy³Objeù
 
	gMšCG3DMD
::
Ty³Objeù
={
PyObjeù_HEAD_INIT
(
NULL
)};

1199 
	gMšCG3DMD
::
	$£tup_
()

1201 
Ty³Objeù
.
_Çme
="mapp.dmd.min_cg";

1202 
Ty³Objeù
.
_doc
=
R
"---(

1203 
	`__š™__
(
e_tŞ
=1.0e-8,
H_dof
=[[
F®£
],[F®£,F®£],[F®£,F®£,F®£]],
affše
=F®£,
max_dx
=1.0,
max_d®pha
=0.1,
ls
=
m­p
.
dmd
.
	`ls_bt
())

1205 
CG
 
mšimiz©iÚ
 
®gÜ™hm


1207 
P¬am‘”s


1209 
e_tŞ
 : 

1210 
EÃrgy
 
tŞ”ªû
 
ü™”iÚ
 
¡İpšg
 
mšimiz©iÚ


1211 
H_dof
 : 
symm
<
boŞ
[
dim
][dim]>

1212 
Un™ûÎ
 
deg»es
 
of
 
ä“dom
 
duršg
 
mšimiz©iÚ
, 
h”e
 
dim
 
is
 
the
 
dim’siÚ
 oà
simuÏtiÚ


1213 
affše
 : 
boŞ


1214 
If
 
£t
 
to
 
True
 
©omic
 
di¥Ïûm’ts
 
would
 
be
 
affše


1215 
max_dx
 : 

1216 
Maximum
 
di¥Ïûm’t
 
of
 
ªy
 
©om
 
š
 
Úe
 
¡•
 oà
mšimiz©iÚ


1217 
max_d®pha
 : 

1218 
Maximum
 
chªge
 
š
 
®pha
 
compÚ’t
 
of
 
ªy
 
©om
 iÀ
Úe
 
¡•
 oà
mšimiz©iÚ


1219 
ls
 : 
m­p
.ls

1220 
Lše
 
£¬ch
 
m‘hod


1222 
NÙes


1224 
Cojug©e
 
	`G¿d›Á
 (
CG
è
®gÜ™hm
 
mšimiz©iÚ
.

1228 
Ty³Objeù
.
_æags
=
Py_TPFLAGS_DEFAULT
;

1229 
Ty³Objeù
.
_basicsize
=(
Objeù
);

1231 
Ty³Objeù
.
_Ãw
=
__Ãw__
;

1232 
Ty³Objeù
.
_š™
=
__š™__
;

1233 
Ty³Objeù
.
_®loc
=
__®loc__
;

1234 
Ty³Objeù
.
_d—Îoc
=
__d—Îoc__
;

1235 
	`£tup__m‘hods
();

1236 
Ty³Objeù
.
_m‘hods
=
m‘hods
;

1237 
	`£tup__g‘£t
();

1238 
Ty³Objeù
.
_g‘£t
=
g‘£t
;

1240 
ichk
=
	`PyTy³_R—dy
(&
Ty³Objeù
);

1241 if(
ichk
<0)  ichk;

1242 
	`Py_INCREF
(&
Ty³Objeù
);

1243 
	`GET_WRAPPER_DOC
(
Ty³Objeù
,
__š™__
)=
NULL
;

1244  
ichk
;

1245 
	}
}

1247 
PyG‘S‘Def
 
	gMšCG3DMD
::
g‘£t
[]=
Em±yPyG‘S‘Def
(11);

1249 
	gMšCG3DMD
::
	$£tup__g‘£t
()

1251 
	`g‘£t_e_tŞ
(
g‘£t
[0]);

1252 
	`g‘£t_H_dof
(
g‘£t
[1]);

1253 
	`g‘£t_max_dx
(
g‘£t
[2]);

1254 
	`g‘£t_max_d®pha
(
g‘£t
[3]);

1255 
	`g‘£t_ls
(
g‘£t
[4]);

1256 
	`g‘£t_Á®ly
(
g‘£t
[5]);

1257 
	`g‘£t_expÜt
(
g‘£t
[6]);

1258 
	`g‘£t_x_dof
(
g‘£t
[7]);

1259 
	`g‘£t_®pha_dof
(
g‘£t
[8]);

1260 
	`g‘£t_c_dof
(
g‘£t
[9]);

1261 
	}
}

1263 
PyM‘hodDef
 
	gMšCG3DMD
::
m‘hods
[]=
Em±yPyM‘hodDef
(2);

1265 
	gMšCG3DMD
::
	$£tup__m‘hods
()

1267 
	`ml_run
(
m‘hods
[0]);

1268 
	}
}

1272 
	gMšCG3DMD
::
	$g‘£t_max_d®pha
(
PyG‘S‘Def
& 
g‘£t
)

1274 
g‘£t
.
Çme
=(*)"max_dalpha";

1275 
g‘£t
.
doc
=(*)
R
"---(

1276 (è
mximum
 
®pha
 
chªge


1278 
Maximum
 
chªge
 
š
 
®pha
 
compÚ’t
 
of
 
ªy
 
©om
 iÀ
Úe
 
¡•
 oà
mšimiz©iÚ


1280 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

1282  
v¬
<
ty³0
>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
mš
->
max_dx
);

1284 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

1286 
V¬API
<
ty³0
> 
	`max_d®pha
("max_dalpha");

1287 
max_d®pha
.
logics
[0]=
	`VLogics
("gt",0.0);

1288 
ichk
=
max_d®pha
.
	`£t
(
İ
);

1289 if(
ichk
==-1)  -1;

1290 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
mš
->
max_d®pha
=max_d®pha.
v®
;

1293 
	}
}

1297 
	gMšCG3DMD
::
	$g‘£t_expÜt
(
PyG‘S‘Def
& 
g‘£t
)

1299 
g‘£t
.
Çme
=(*)"export";

1300 
g‘£t
.
doc
=(*)
R
"---(

1301 (
m­p
.
dmd
.
expÜt
èexpÜˆ
objeù


1303 
ExpÜt
 
objeù
 
to
 
»cÜd
 
the
 
¢­shÙs
 
of
h
sy¡em
 
mšimizšg


1305 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

1307 
ExpÜtDMD
::
Objeù
* 
x´t
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
)->xprt;

1308 if(!
x´t
è
Py_RETURN_NONE
;

1309 
	`Py_INCREF
(
x´t
);

1310  
»š‹½»t_ÿ¡
<
PyObjeù
*>(
x´t
);

1312 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

1314 
V¬API
<
OP
<
ExpÜtDMD
>> 
	`x´t
("export");

1315 
ichk
=
x´t
.
	`£t
(
İ
);

1316 if(
ichk
==-1)  -1;

1317 if(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
x´t
è
	`Py_DECREF
(reinterpret_cast<Object*>(self)->xprt);

1318 
	`Py_INCREF
(
x´t
.
v®
.
ob
);

1319 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
x´t
ôeš‹½»t_ÿ¡<
ExpÜtDMD
::Objeù*>(x´t.
v®
.
ob
);

1322 
	}
}

1326 
	gMšCG3DMD
::
	$g‘£t_x_dof
(
PyG‘S‘Def
& 
g‘£t
)

1328 
g‘£t
.
Çme
=(*)"x_dof";

1329 
g‘£t
.
doc
=(*)
R
"---(

1330 (
boŞ
è
£t
 
Œue
 
pos™iÚ
 
of
 
©oms
 
wl
 
cÚsid”ed
 
as
 
deg»es
 oà
ä“dom


1332 
If
 
£t
 
Œue
 
pos™iÚ
 
of
 
©oms
 
wl
 
cÚsid”ed
 
as
 
deg»es
 oà
ä“dom


1334 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

1336  
v¬
<
boŞ
>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
mš
->
X_DOF
);

1338 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

1340 
V¬API
<
boŞ
> 
	`x_dof
("x_dof");

1341 if(
x_dof
.
	`£t
(
İ
)==-1)  -1;

1342 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
mš
->
X_DOF
=
x_dof
.
v®
;

1345 
	}
}

1349 
	gMšCG3DMD
::
	$g‘£t_®pha_dof
(
PyG‘S‘Def
& 
g‘£t
)

1351 
g‘£t
.
Çme
=(*)"alpha_dof";

1352 
g‘£t
.
doc
=(*)
R
"---(

1353 (
boŞ
è
£t
 
Œue
 
®pha
 
of
 
©oms
 
wl
 
cÚsid”ed
 
as
 
deg»es
 oà
ä“dom


1355 
If
 
£t
 
Œue
 
®pha
 
of
 
©oms
 
wl
 
cÚsid”ed
 
as
 
deg»es
 oà
ä“dom


1357 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

1359  
v¬
<
boŞ
>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
mš
->
ALPHA_DOF
);

1361 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

1363 
V¬API
<
boŞ
> 
	`®pha_dof
("alpha_dof");

1364 if(
®pha_dof
.
	`£t
(
İ
)==-1)  -1;

1365 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
mš
->
ALPHA_DOF
=
®pha_dof
.
v®
;

1368 
	}
}

1372 
	gMšCG3DMD
::
	$g‘£t_c_dof
(
PyG‘S‘Def
& 
g‘£t
)

1374 
g‘£t
.
Çme
=(*)"c_dof";

1375 
g‘£t
.
doc
=(*)
R
"---(

1376 (
boŞ
è
£t
 
Œue
 
c
 
of
 
©oms
 
wl
 
cÚsid”ed
 
as
 
deg»es
 oà
ä“dom


1378 
If
 
£t
 
Œue
 
c
 
of
 
©oms
 
wl
 
cÚsid”ed
 
as
 
deg»es
 oà
ä“dom


1380 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

1382  
v¬
<
boŞ
>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
mš
->
C_DOF
);

1384 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

1386 
V¬API
<
boŞ
> 
	`c_dof
("c_dof");

1387 if(
c_dof
.
	`£t
(
İ
)==-1)  -1;

1388 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
mš
->
C_DOF
=
c_dof
.
v®
;

1391 
	}
}

1395 
	gMšCG3DMD
::
	$ml_run
(
PyM‘hodDef
& 
_m‘hods
)

1397 
_m‘hods
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

1398 
_m‘hods
.
ml_Çme
="run";

1399 
_m‘hods
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

1400 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

1402 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

1403 
FuncAPI
<
OP
<
AtomsDMD
>,> 
	`f
("run",{"atoms","max_nsteps"});

1404 
f
.
logics
<1>()[0]=
	`VLogics
("ge",0);

1408 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

1411 
AtomsDMD
* 
__©oms
=
»š‹½»t_ÿ¡
<AtomsDMD::
Objeù
*>(
f
.
v®
<0>().
ob
)->
©oms
;

1412 
FÜûF›ldDMD
* 
__ff
=
»š‹½»t_ÿ¡
<
AtomsDMD
::
Objeù
*>(
f
.
v®
<0>().
ob
)->
ff
;

1413 
ExpÜtDMD
* 
__x´t
=
__£lf
->
x´t
==
NULL
 ? NULL:__self->xprt->xprt;

1417 
Œy


1419 
__£lf
->
mš
->
	`´e_run_chk
(
__©oms
,
__ff
);

1421 
	`ÿtch
(
¡d
::
¡ršg
& 
”r_msg
)

1423 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,
”r_msg
.
	`c_¡r
());

1424  
NULL
;

1427 
__£lf
->
mš
->
©oms
=
__©oms
;

1428 
__£lf
->
mš
->
ff
=
__ff
;

1429 
__£lf
->
mš
->
x´t
=
__x´t
;

1431 
Œy


1433 
__£lf
->
mš
->
	`run
(
f
.
v®
<1>());

1435 
	`ÿtch
(
¡d
::
¡ršg
& 
”r_msg
)

1437 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,
”r_msg
.
	`c_¡r
());

1438  
NULL
;

1441 
__£lf
->
mš
->
x´t
=
NULL
;

1442 
__£lf
->
mš
->
ff
=
NULL
;

1443 
__£lf
->
mš
->
©oms
=
NULL
;

1445 
Py_RETURN_NONE
;

1448 
_m‘hods
.
ml_doc
=(*)
R
"---(

1449 
	`run
(
©oms
,
max_n¡•s
)

1451 
Execu‹
 
mšimiz©iÚ


1453 
This
 
m‘hod
 
¡¬ts
 
the
 
’”gy
 
mšimiz©iÚ
 
a
 
giv’
 
©oms
 
objeù
 
ªd
 
maximum
 
numb”
 
of
 
¡•s
.

1455 
P¬am‘”s


1457 
©oms
 : 
m­p
.
md
.atoms

1458 
Sy¡em
 
of
 
š‹»¡


1459 
max_n¡•s
 : 

1460 
Maximum
 
numb”
 
of
 
¡•s
 
to
 
ach›ve
 
’”gy
 
mšimiz©iÚ


1462 
R‘uºs


1464 
NÚe


1467 
	}
}

	@min_cg3_dmd.h

1 #iâdeà
__MAPP__mš_cg3_dmd__


2 
	#__MAPP__mš_cg3_dmd__


	)

3 
	~"mš.h
"

4 
	~"mš_vec.h
"

5 
	~"ff_dmd.h
"

6 
	~"©oms_dmd.h
"

7 
	~"dyÇmic_dmd.h
"

8 
	~"MAPP.h
"

9 
	~"th”mo_dyÇmics.h
"

10 
Çme¥aû
 
	gMAPP_NS


12 
	g‹m¶©e
<
boŞ
 
	gBC
,boŞ 
	gX
,boŞ 
	gALPHA
,boŞ 
	gC
>

13 şas 
	cMšDMDHªdËr_t


15 
	gpublic
:

16 
VecT’s
<
	tty³0
,3> 
	tVECTENS0
;

17 
	gVecT’s
<
	tty³0
,3> 
	tVECTENS1
;

19 
	g‹m¶©e
<>

20 
şass
 
	gMšDMDHªdËr_t
<
	gçl£
,çl£,çl£,
	gŒue
>

22 
	gpublic
:

23 
VecT’s
<
	tty³0
,1> 
	tVECTENS0
;

24 
	gVecT’s
<
	tty³0
,1> 
	tVECTENS1
;

26 
	g‹m¶©e
<>

27 
şass
 
	gMšDMDHªdËr_t
<
	gçl£
,çl£,
	gŒue
,false>

29 
	gpublic
:

30 
VecT’s
<
	tty³0
,1> 
	tVECTENS0
;

31 
	gVecT’s
<
	tty³0
,1> 
	tVECTENS1
;

33 
	g‹m¶©e
<>

34 
şass
 
	gMšDMDHªdËr_t
<
	gçl£
,çl£,
	gŒue
,true>

36 
	gpublic
:

37 
VecT’s
<
	tty³0
,2> 
	tVECTENS0
;

38 
	gVecT’s
<
	tty³0
,2> 
	tVECTENS1
;

40 
	g‹m¶©e
<>

41 
şass
 
	gMšDMDHªdËr_t
<
	gçl£
,
	gŒue
,false,false>

43 
	gpublic
:

44 
VecT’s
<
	tty³0
,1> 
	tVECTENS0
;

45 
	gVecT’s
<
	tty³0
,1> 
	tVECTENS1
;

47 
	g‹m¶©e
<>

48 
şass
 
	gMšDMDHªdËr_t
<
	gçl£
,
	gŒue
,false,true>

50 
	gpublic
:

51 
VecT’s
<
	tty³0
,2> 
	tVECTENS0
;

52 
	gVecT’s
<
	tty³0
,2> 
	tVECTENS1
;

54 
	g‹m¶©e
<>

55 
şass
 
	gMšDMDHªdËr_t
<
	gçl£
,
	gŒue
,true,false>

57 
	gpublic
:

58 
VecT’s
<
	tty³0
,2> 
	tVECTENS0
;

59 
	gVecT’s
<
	tty³0
,2> 
	tVECTENS1
;

61 
	g‹m¶©e
<>

62 
şass
 
	gMšDMDHªdËr_t
<
	gçl£
,
	gŒue
,true,true>

64 
	gpublic
:

65 
VecT’s
<
	tty³0
,3> 
	tVECTENS0
;

66 
	gVecT’s
<
	tty³0
,3> 
	tVECTENS1
;

68 
	g‹m¶©e
<>

69 
şass
 
	gMšDMDHªdËr_t
<
	gŒue
,
	gçl£
,false,false>

71 
	gpublic
:

72 
VecT’s
<
	tty³0
,1> 
	tVECTENS0
;

73 
	gVecT’s
<
	tty³0
,0> 
	tVECTENS1
;

75 
	g‹m¶©e
<>

76 
şass
 
	gMšDMDHªdËr_t
<
	gŒue
,
	gçl£
,false,true>

78 
	gpublic
:

79 
VecT’s
<
	tty³0
,2> 
	tVECTENS0
;

80 
	gVecT’s
<
	tty³0
,1> 
	tVECTENS1
;

82 
	g‹m¶©e
<>

83 
şass
 
	gMšDMDHªdËr_t
<
	gŒue
,
	gçl£
,true,false>

85 
	gpublic
:

86 
VecT’s
<
	tty³0
,2> 
	tVECTENS0
;

87 
	gVecT’s
<
	tty³0
,1> 
	tVECTENS1
;

89 
	g‹m¶©e
<>

90 
şass
 
	gMšDMDHªdËr_t
<
	gŒue
,
	gçl£
,true,true>

92 
	gpublic
:

93 
VecT’s
<
	tty³0
,3> 
	tVECTENS0
;

94 
	gVecT’s
<
	tty³0
,2> 
	tVECTENS1
;

96 
	g‹m¶©e
<>

97 
şass
 
	gMšDMDHªdËr_t
<
	gŒue
,Œue,
	gçl£
,false>

99 
	gpublic
:

100 
VecT’s
<
	tty³0
,1> 
	tVECTENS0
;

101 
	gVecT’s
<
	tty³0
,1> 
	tVECTENS1
;

103 
	g‹m¶©e
<>

104 
şass
 
	gMšDMDHªdËr_t
<
	gŒue
,Œue,
	gçl£
,true>

106 
	gpublic
:

107 
VecT’s
<
	tty³0
,2> 
	tVECTENS0
;

108 
	gVecT’s
<
	tty³0
,2> 
	tVECTENS1
;

110 
	g‹m¶©e
<>

111 
şass
 
	gMšDMDHªdËr_t
<
	gŒue
,Œue,Œue,
	gçl£
>

113 
	gpublic
:

114 
VecT’s
<
	tty³0
,2> 
	tVECTENS0
;

115 
	gVecT’s
<
	tty³0
,2> 
	tVECTENS1
;

117 
	g‹m¶©e
<>

118 
şass
 
	gMšDMDHªdËr_t
<
	gŒue
,true,true,true>

120 
	gpublic
:

121 
VecT’s
<
	tty³0
,3> 
	tVECTENS0
;

122 
	gVecT’s
<
	tty³0
,3> 
	tVECTENS1
;

124 
	g‹m¶©e
<
boŞ
 
	gC
>

125 şas 
	cMšDMDHªdËrG‘MaxAÍhaC


127 
	gpublic
:

128 
‹m¶©e
<
şass
 
F
>

129 
func
(
F
& 
f
,
ty³0
& 
__max_a_lş
,
Vec
<ty³0>** 
__vs
)

131 
	gf
.
max_®pha_lş_c
(
__max_a_lş
,(*
__vs
)->
begš
());

134 
	g‹m¶©e
<>

135 
şass
 
	gMšDMDHªdËrG‘MaxAÍhaC
<
	gçl£
>

137 
	gpublic
:

138 
‹m¶©e
<
şass
 
F
>

139 
func
(
F
&,
ty³0
&,
Vec
<type0>**)

144 
	g‹m¶©e
<
boŞ
 
	gALPHA
,boŞ 
	gC
>

145 şas 
	cMšDMDHªdËrG‘MaxAÍhaAÍha


147 
	gpublic
:

148 
‹m¶©e
<
şass
 
F
>

149 
func
(
F
& 
f
,
ty³0
& 
__max_a_lş
,
Vec
<ty³0>** 
__vs
)

151 
	gf
.
max_®pha_lş_®pha
(
__max_a_lş
,(*
__vs
)->
begš
());

152 
	gMšDMDHªdËrG‘MaxAÍhaC
<
	gC
>::
func
(
f
,
__max_a_lş
,
__vs
+1);

155 
	g‹m¶©e
<
boŞ
 
	gC
>

156 
şass
 
	gMšDMDHªdËrG‘MaxAÍhaAÍha
<
	gçl£
,
	gC
>

158 
	gpublic
:

159 
‹m¶©e
<
şass
 
F
>

160 
func
(
F
& 
f
,
ty³0
& 
__max_a_lş
,
Vec
<ty³0>** 
__vs
)

162 
	gMšDMDHªdËrG‘MaxAÍhaC
<
	gC
>::
func
(
f
,
__max_a_lş
,
__vs
);

167 
	g‹m¶©e
<
boŞ
 
	gX
,boŞ 
	gALPHA
,boŞ 
	gC
>

168 şas 
	cMšDMDHªdËrG‘MaxAÍhaX


170 
	gpublic
:

171 
‹m¶©e
<
şass
 
F
>

172 
func
(
F
& 
f
,
ty³0
& 
__max_a_lş
,
Vec
<ty³0>** 
__vs
)

174 
	gf
.
max_®pha_lş_x
(
__max_a_lş
,(*
__vs
)->
begš
());

175 
	gMšDMDHªdËrG‘MaxAÍhaAÍha
<
	gALPHA
,
	gC
>::
func
(
f
,
__max_a_lş
,
__vs
+1);

180 
	g‹m¶©e
<
boŞ
 
	gALPHA
,boŞ 
	gC
>

181 
şass
 
	gMšDMDHªdËrG‘MaxAÍhaX
<
	gçl£
,
	gALPHA
,
	gC
>

183 
	gpublic
:

184 
‹m¶©e
<
şass
 
F
>

185 
func
(
F
& 
f
,
ty³0
& 
__max_a_lş
,
Vec
<ty³0>** 
__vs
)

187 
	gMšDMDHªdËrG‘MaxAÍhaAÍha
<
	gALPHA
,
	gC
>::
func
(
f
,
__max_a_lş
,
__vs
);

192 
	g‹m¶©e
<
boŞ
 
	gC
>

193 şas 
	cMšDMDHªdËrUpd©e


195 
	gpublic
:

196 
‹m¶©e
<
şass
 
F
>

197 
ty³0
 
F
(F& 
f
,ty³0& 
__®pha
)

199 
	gf
.
	gx
=
f
.
x0
+
__®pha
*f.
x_d
;

200 
	gf
.
­rİ_c
();

201 
	gf
.
	gdyÇmic
->
upd©e
(
f
.
©oms
->
c
);

202  
	gf
.
	gff
->
v®ue
();

204 
	g‹m¶©e
<
şass
 
	gF
>

205 
F_»£t
(
F
& 
f
)

207 
	gf
.
	gx
=
f
.
x0
;

208 
	gf
.
	gdyÇmic
->
upd©e
(
f
.
©oms
->
c
);

212 
	g‹m¶©e
<>

213 
şass
 
	gMšDMDHªdËrUpd©e
<
	gçl£
>

215 
	gpublic
:

216 
‹m¶©e
<
şass
 
F
>

217 
ty³0
 
F
(F& 
f
,ty³0& 
__®pha
)

219 
	gf
.
	gx
=
f
.
x0
+
__®pha
*f.
x_d
;

220 
	gf
.
	gdyÇmic
->
upd©e
();

221  
	gf
.
	gff
->
v®ue
();

223 
	g‹m¶©e
<
şass
 
	gF
>

224 
F_»£t
(
F
& 
f
)

226 
	gf
.
	gx
=
f
.
x0
;

227 
	gf
.
	gdyÇmic
->
upd©e
();

232 
	g‹m¶©e
<
boŞ
 
	gBC
,boŞ 
	gX
>

233 şas 
	cMšDMDHªdËrP»p


235 
	gpublic
:

236 
‹m¶©e
<
şass
 
F
>

237 
func
(
F
& 
f
)

242 
	g‹m¶©e
<>

243 
şass
 
	gMšDMDHªdËrP»p
<
	gŒue
,true>

245 
	gpublic
:

246 
‹m¶©e
<
şass
 
F
>

247 
func
(
F
& 
f
)

249 
f
.
´•_x_d
();

254 
	g‹m¶©e
<>

255 
şass
 
	gMšDMDHªdËrP»p
<
	gŒue
,
	gçl£
>

257 
	gpublic
:

258 
‹m¶©e
<
şass
 
F
>

259 
func
(
F
& 
f
)

261 
f
.
´•_x_d_affše
();

267 
	g‹m¶©e
<
boŞ
 
	gBC
>

268 şas 
	cMšDMDHªdËrPo¡FÜûC®cBC


270 
	gpublic
:

271 
‹m¶©e
<
şass
 
F
>

272 
func
(
F
& 
f
)

274 
f
.
po¡_fÜû_ÿlc_box
();

279 
	g‹m¶©e
<>

280 
şass
 
	gMšDMDHªdËrPo¡FÜûC®cBC
<
	gçl£
>

282 
	gpublic
:

283 
‹m¶©e
<
şass
 
F
>

284 
func
(
F
& 
f
)

291 
	g‹m¶©e
<
boŞ
 
	gC
>

292 şas 
	cMšDMDHªdËrPo¡FÜûC®cC


294 
	gpublic
:

295 
‹m¶©e
<
şass
 
F
>

296 
func
(
F
& 
f
)

298 
f
.
po¡_fÜû_ÿlc_c
();

303 
	g‹m¶©e
<>

304 
şass
 
	gMšDMDHªdËrPo¡FÜûC®cC
<
	gçl£
>

306 
	gpublic
:

307 
‹m¶©e
<
şass
 
F
>

308 
func
(
F
& 
f
)

315 
	g‹m¶©e
<
boŞ
 
	gBC
,boŞ 
	gX
,boŞ 
	gALPHA
,boŞ 
	gC
>

316 şas 
	cMšDMDHªdËr


318 
	g´Ùeùed
:

319 
public
:

320 
´•_x_d
()

322 cÚ¡ 
Çtms_lş
=
©oms
->natms_lcl;

323 
ty³0
* 
	gxvec
=
x0
.
vecs
[0]->
begš
();

324 
ty³0
* 
	ghvec
=
h
.
vecs
[0]->
begš
();

325 
ty³0
* 
	gx_dvec
=
x_d
.
vecs
[0]->
begš
();

326 
	gAlgeb¿
::
MLT_mul_MLT
(
©oms
->
H
,
h
.
A
,
x_d
.A);

328 
	gŸtm
=0;Ÿtm<
	gÇtms_lş
;Ÿtm++,
	gxvec
+=
__dim__
,
	gx_dvec
+=__dim__,
	ghvec
+=__dim__)

330 
Algeb¿
::
V_eq
<
__dim__
>(
hvec
,
x_dvec
);

331 
	gAlgeb¿
::
V_mul_MLT_add_š
(
xvec
,
h
.
A
,
x_dvec
);

334 
´•_x_d_affše
()

336 cÚ¡ 
	gÇtms_lş
=
©oms
->
Çtms_lş
;

337 
ty³0
* 
	gxvec
=
x0
.
vecs
[0]->
begš
();

338 
ty³0
* 
	gx_dvec
=
x_d
.
vecs
[0]->
begš
();

339 
	gAlgeb¿
::
MLT_mul_MLT
(
©oms
->
H
,
h
.
A
,
x_d
.A);

340 
	gŸtm
=0;Ÿtm<
	gÇtms_lş
;Ÿtm++,
	gxvec
+=
__dim__
,
	gx_dvec
+=__dim__)

341 
Algeb¿
::
V_mul_MLT
(
xvec
,
h
.
A
,
x_dvec
);

344 
po¡_fÜû_ÿlc_c
()

346 
	gÇtms_lş
=
©oms
->
Çtms_lş
;

347 
ty³0
* 
	gc
=
©oms
->
c
->
begš
();

348 
ty³0
* 
	gmu
=
ff
->
mu
->
begš
();

349 
ty³0
 
	gcv
;

350 
ty³0
 
	glogcv
;

351 
ty³0
 
	gkBT
=
©oms
->
‹mp
*©oms->
kB
;

352 
	gi
=0;i<
	gÇtms_lş
;i++,
	gc
+=
c_dim
,
	gmu
+=c_dim)

354 
cv
=1.0;

355 
	gj
=0;j<
	gc_dim
;j++)

357 if(
	gc
[
j
]>=0.0)

358 
cv
-=
c
[
j
];

360 
	glogcv
=
log
(
cv
);

361 
	gj
=0;j<
	gc_dim
;j++)

363 if(
	gc
[
j
]>=0.0)

364 
mu
[
j
]=-mu[j]-
kBT
*(
log
(
c
[j])-
logcv
);

369 
po¡_fÜû_ÿlc_box
()

371 
ty³0
 (&
S_ã
)[
__dim__
][__dim__]=
©oms
->S_fe;

372 
ty³0
 
	gÃg_v
=-
©oms
->
vŞ
;

373 
	gAlgeb¿
::
DoLT
<
__dim__
>::
func
([
this
,&
S_ã
,&
Ãg_v
](
i
,
j
)

374 {
f
.
A
[
i
][
j
]=
H_dof
[i][j] ? 
S_ã
[i][j]*
Ãg_v
:0.0;});

377 
­rİ_c
()

379 cÚ¡ 
	gn
=
©oms
->
Çtms_lş
*
c_dim
;

380 
ty³0
* 
	gc_vec
=
©oms
->
c
->
begš
();

381 
ty³0
 vŞ©
	gcj
;

382 
	gi
=0;i<
	gn
;i++)

383 if(
	gc_vec
[
i
]>=0.0)

385 
cj
=
c_vec
[
i
];

386 --++
	gcj
;

387 
	gc_vec
[
i
]=
cj
;

394 
ty³Çme
 
	tMšDMDHªdËr_t
<
	tBC
,
	tX
,
	tALPHA
,
	tC
>::
	tVECTENS0
 VECTENS0;

395 
ty³Çme
 
	tMšDMDHªdËr_t
<
	tBC
,
	tX
,
	tALPHA
,
	tC
>::
	tVECTENS1
 VECTENS1;

396 
şass
 
FÜûF›ldDMD
* 
	gff
;

397 
şass
 
AtomsDMD
* 
	g©oms
;

398 
ty³0
 
	gmax_dx
,
	gmax_d®pha
;

399 
boŞ
 
	gH_dof
[
__dim__
][__dim__];

402 
ty³0
 
	gf_h
;

403 
	gc_dim
;

404 
şass
 
	gNewDyÇmicDMD
<
	gBC
,BC||
	gX
,
	gALPHA
>* 
	gdyÇmic
;

405 
VECTENS0
 
	gx
,
	gx0
,
	gx_d
;

406 
VECTENS1
 
	gh
,
	gf
,
	gf0
;

408 
MšDMDHªdËr
(

409 
AtomsDMD
* 
__©oms
,

410 
FÜûF›ldDMD
* 
__ff
,

411 
ty³0
 
__max_dx
,

412 
ty³0
 
__max_d®pha
,

413 
boŞ
 (&
__H_dof
)[
__dim__
][__dim__]

415 
©oms
(
__©oms
),

416 
ff
(
__ff
),

417 
max_dx
(
__max_dx
),

418 
max_d®pha
(
__max_d®pha
),

419 
c_dim
(
__©oms
->c_dim),

420 
dyÇmic
(
NULL
)

422 
	gAlgeb¿
::
V_eq
<
__dim__
*__dim__>(
__H_dof
[0],
	gH_dof
[0]);

425 
MšDMDHªdËr
():

426 
©oms
(
NULL
),

427 
ff
(
NULL
),

428 
max_dx
(0.0),

429 
max_d®pha
(0.0),

430 
c_dim
(0.0),

431 
dyÇmic
(
NULL
)

433 
	gAlgeb¿
::
£t
<
__dim__
*__dim__>(
H_dof
[0],
	gçl£
);

438 
add_exŒa_vec
(
VECTENS1
&){}

439 
rm_exŒa_vec
(
VECTENS1
& 
v
){
	gv
.~VECTENS1();}

440 
š™
(){}

441 
fš
()

444 
d–‘e
 
	gdyÇmic
;

445 
	gdyÇmic
=
NULL
;

448 
	gx_d
.~
VECTENS0
();

449 
	gx0
.~
VECTENS0
();

450 
	gx
.~
VECTENS0
();

452 
	gh
.~
VECTENS1
();

453 
	gf0
.~
VECTENS1
();

454 
	gf
.~
VECTENS1
();

460 
max_®pha_lş_x
(
ty³0
& 
max_a_lş
,ty³0* 
x_d_xvec
)

462 
ty³0
 
	gmax_x_d_lş
=0.0;

463 cÚ¡ 
	gÇtms_lş
=
©oms
->
Çtms_lş
;

464 
	gn
=
Çtms_lş
*
__dim__
;

465 
	gi
=0;i<
	gn
;i++)

466 
	gmax_x_d_lş
=
MAX
(
max_x_d_lş
,
çbs
(
x_d_xvec
[
i
]));

468 
	gmax_a_lş
=
MIN
(
çbs
(
max_dx
/
max_x_d_lş
),
max_a_lş
);

471 
max_®pha_lş_®pha
(
ty³0
& 
max_a_lş
,ty³0* 
x_d_®phavec
)

474 
	gn
=
©oms
->
Çtms_lş
*
c_dim
;

475 
ty³0
 
	gmax_x_d_®pha_lş
=0.0;

476 
ty³0
* 
	g®phavec
=
©oms
->
®pha
->
begš
();

477 
	gi
=0;i<
	gn
;i++)

479 if(
	gx_d_®phavec
[
i
]<0.0)

480 
	gmax_a_lş
=
MIN
(-
®phavec
[
i
]/
x_d_®phavec
[i],
max_a_lş
);

481 
	gmax_x_d_®pha_lş
=
MAX
(
max_x_d_®pha_lş
,
çbs
(
x_d_®phavec
[
i
]));

483 
	gmax_a_lş
=
MIN
(
max_a_lş
,
çbs
(
max_d®pha
/
max_x_d_®pha_lş
));

486 
max_®pha_lş_c
(
ty³0
& 
max_a_lş
,ty³0* 
x_d_cvec
)

488 
ty³0
 
	gmax_c_¿tio
=
max_a_lş
,
	gdc_i
=0.0,
	gdh_i
=0.0;

489 
ty³0
* 
	gcvec
=
©oms
->
c
->
begš
();

490 
ty³0
 
	gx_d_cv
,
	gcv
;

491 
ty³0
 
	glo
=1.0+
¡d
::
num”ic_lim™s
<ty³0>::
•sÚ
();

492 
ty³0
 vŞ©
	gcj
;

493 
	gÇtms_lş
=
©oms
->
Çtms_lş
;

494 
	gi
=0;i<
	gÇtms_lş
;i++,
	gx_d_cvec
+=
c_dim
,
	gcvec
+=c_dim)

496 
x_d_cv
=0.0;

497 
	gcv
=1.0;

498 
	gj
=0;j<
	gc_dim
;j++)

501 if(
	gcvec
[
j
]<0.0) ;

502 
	gx_d_cv
-=
x_d_cvec
[
j
];

503 
	gcv
-=
cvec
[
j
];

504 
	gcj
=1.0+
cvec
[
j
];

505 if(
	gx_d_cvec
[
j
]<0.0 && 
	gcj
+(
max_c_¿tio
*x_d_cvec[j])<
	glo
)

507 
	gmax_c_¿tio
=(
cj
-
lo
)/(-
x_d_cvec
[
j
]);

508 
	gdc_i
=
cj
-
lo
;

509 
	gdh_i
=-
x_d_cvec
[
j
];

513 
	gcj
=1.0+
cv
;

514 if(
	gx_d_cv
<0.0 && 
	gcj
+(
max_c_¿tio
*x_d_cv)<
	glo
)

516 
	gmax_c_¿tio
=(
cj
-
lo
)/(-
x_d_cv
);

517 
	gdc_i
=
cj
-
lo
;

518 
	gdh_i
=-
x_d_cv
;

521 
boŞ
 
	gchk
=
çl£
;

523 !
	gchk
)

525 
	gchk
=
Œue
;

526 
	gcv
=1.0;

527 
	gj
=0;j<
	gc_dim
 && 
	gchk
;j++)

529 if(
	gcvec
[
j
]<0.0) ;

530 
	gcj
=1.0+
cvec
[
j
];

531 
	gcj
+=(
max_c_¿tio
*
x_d_cvec
[
j
]);

533 if(
	gcj
<
	glo
è
	gchk
=
çl£
;

534 --
	gcj
;

535 
	gcv
-=
cj
;

537 
	gcj
=1.0+
cv
;

538 if(
	gcj
<
	glo
è
	gchk
=
çl£
;

539 if(
	gchk
) ;

540 
	gdc_i
-=
¡d
::
num”ic_lim™s
<
ty³0
>::
•sÚ
();

541 
	gmax_c_¿tio
=
dc_i
/
dh_i
;

546 
	gmax_a_lş
=
MIN
(
max_a_lş
,
max_c_¿tio
);

549 
ls_´•
(
ty³0
& 
dç
,ty³0& 
h_nÜm
,ty³0& 
max_a
)

552 
	gh_nÜm
=
h
*h;

554 
	gdç
=-
f_h
;

556 if(
	gh_nÜm
==0.0)

558 
max_a
=0.0;

559 
	gdç
=0.0;

563 if(
	gdç
>=0.0)

565 
max_a
=0.0;

566 
	gdç
=1.0;

570 
	gh_nÜm
=
sq¹
(
h_nÜm
);

572 
ty³0
 
	gmax_a_lş
=
¡d
::
num”ic_lim™s
<ty³0>::
šfš™y
();

573 
	gMšDMDHªdËrG‘MaxAÍhaX
<
	gBC
||
	gX
,
	gALPHA
,
	gC
>::
func
(*
this
,
max_a_lş
,
x_d
.
vecs
);

574 
MPI_AÎ»duû
(&
max_a_lş
,&
max_a
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_MIN
,
©oms
->
wÜld
);

577 
ty³0
 
F
Ñy³0 
__®pha
)

579  
	gMšDMDHªdËrUpd©e
<
	gC
>::
F
(*
this
,
__®pha
);

581 
F_»£t
()

583  
	gMšDMDHªdËrUpd©e
<
	gC
>::
F_»£t
(*
this
);

586 
fÜû_ÿlc
()

588 
	gff
->
d”iv©ive
();

589 
	gMšDMDHªdËrPo¡FÜûC®cBC
<
	gBC
>::
func
(*
this
);

590 
	gMšDMDHªdËrPo¡FÜûC®cC
<
	gC
>::
func
(*
this
);

592 
´•
()

594 
	gMšDMDHªdËrP»p
<
	gBC
,
	gX
>::
func
(*
this
);

603 
	g‹m¶©e
<>
	gMšDMDHªdËr
<
	gçl£
,çl£,çl£,
	gŒue
>::
š™
();

604 
	g‹m¶©e
<>
	gMšDMDHªdËr
<
	gçl£
,çl£,çl£,
	gŒue
>::
add_exŒa_vec
(
VECTENS1
&);

607 
	g‹m¶©e
<>
	gMšDMDHªdËr
<
	gçl£
,çl£,
	gŒue
,çl£>::
š™
();

608 
	g‹m¶©e
<>
	gMšDMDHªdËr
<
	gçl£
,çl£,
	gŒue
,çl£>::
add_exŒa_vec
(
VECTENS1
&);

611 
	g‹m¶©e
<>
	gMšDMDHªdËr
<
	gçl£
,çl£,
	gŒue
,Œue>::
š™
();

612 
	g‹m¶©e
<>
	gMšDMDHªdËr
<
	gçl£
,çl£,
	gŒue
,Œue>::
add_exŒa_vec
(
VECTENS1
&);

615 
	g‹m¶©e
<>
	gMšDMDHªdËr
<
	gçl£
,
	gŒue
,çl£,çl£>::
š™
();

616 
	g‹m¶©e
<>
	gMšDMDHªdËr
<
	gçl£
,
	gŒue
,çl£,çl£>::
add_exŒa_vec
(
VECTENS1
&);

619 
	g‹m¶©e
<>
	gMšDMDHªdËr
<
	gçl£
,
	gŒue
,çl£,Œue>::
š™
();

620 
	g‹m¶©e
<>
	gMšDMDHªdËr
<
	gçl£
,
	gŒue
,çl£,Œue>::
add_exŒa_vec
(
VECTENS1
&);

623 
	g‹m¶©e
<>
	gMšDMDHªdËr
<
	gçl£
,
	gŒue
,Œue,çl£>::
š™
();

624 
	g‹m¶©e
<>
	gMšDMDHªdËr
<
	gçl£
,
	gŒue
,Œue,çl£>::
add_exŒa_vec
(
VECTENS1
&);

627 
	g‹m¶©e
<>
	gMšDMDHªdËr
<
	gçl£
,
	gŒue
,Œue,Œue>::
š™
();

628 
	g‹m¶©e
<>
	gMšDMDHªdËr
<
	gçl£
,
	gŒue
,Œue,Œue>::
add_exŒa_vec
(
VECTENS1
&);

631 
	g‹m¶©e
<>
	gMšDMDHªdËr
<
	gŒue
,
	gçl£
,çl£,çl£>::
š™
();

632 
	g‹m¶©e
<>
	gMšDMDHªdËr
<
	gŒue
,
	gçl£
,çl£,çl£>::
add_exŒa_vec
(
VECTENS1
&);

635 
	g‹m¶©e
<>
	gMšDMDHªdËr
<
	gŒue
,
	gçl£
,çl£,Œue>::
š™
();

636 
	g‹m¶©e
<>
	gMšDMDHªdËr
<
	gŒue
,
	gçl£
,çl£,Œue>::
add_exŒa_vec
(
VECTENS1
&);

639 
	g‹m¶©e
<>
	gMšDMDHªdËr
<
	gŒue
,
	gçl£
,Œue,çl£>::
š™
();

640 
	g‹m¶©e
<>
	gMšDMDHªdËr
<
	gŒue
,
	gçl£
,Œue,çl£>::
add_exŒa_vec
(
VECTENS1
&);

643 
	g‹m¶©e
<>
	gMšDMDHªdËr
<
	gŒue
,
	gçl£
,Œue,Œue>::
š™
();

644 
	g‹m¶©e
<>
	gMšDMDHªdËr
<
	gŒue
,
	gçl£
,Œue,Œue>::
add_exŒa_vec
(
VECTENS1
&);

647 
	g‹m¶©e
<>
	gMšDMDHªdËr
<
	gŒue
,Œue,
	gçl£
,çl£>::
š™
();

648 
	g‹m¶©e
<>
	gMšDMDHªdËr
<
	gŒue
,Œue,
	gçl£
,çl£>::
add_exŒa_vec
(
VECTENS1
&);

651 
	g‹m¶©e
<>
	gMšDMDHªdËr
<
	gŒue
,Œue,
	gçl£
,Œue>::
š™
();

652 
	g‹m¶©e
<>
	gMšDMDHªdËr
<
	gŒue
,Œue,
	gçl£
,Œue>::
add_exŒa_vec
(
VECTENS1
&);

655 
	g‹m¶©e
<>
	gMšDMDHªdËr
<
	gŒue
,Œue,Œue,
	gçl£
>::
š™
();

656 
	g‹m¶©e
<>
	gMšDMDHªdËr
<
	gŒue
,Œue,Œue,
	gçl£
>::
add_exŒa_vec
(
VECTENS1
&);

659 
	g‹m¶©e
<>
	gMšDMDHªdËr
<
	gŒue
,Œue,Œue,Œue>::
š™
();

660 
	g‹m¶©e
<>
	gMšDMDHªdËr
<
	gŒue
,Œue,Œue,Œue>::
add_exŒa_vec
(
VECTENS1
&);

667 
Çme¥aû
 
	gMAPP_NS


669 şas 
	cMšCG3DMD
:
public
 
Mš


671 
´iv©e
:

672 
´Ùeùed
:

673 
boŞ
 
B_DOF
,
	gX_DOF
,
	gALPHA_DOF
,
	gC_DOF
;

674 
ty³0
 
	gmax_d®pha
;

677 
şass
 
AtomsDMD
* 
	g©oms
;

678 
şass
 
FÜûF›ldDMD
* 
	gff
;

679 
şass
 
ExpÜtDMD
* 
	gx´t
;

680 
´e_run_chk
(
AtomsDMD
*,
FÜûF›ldDMD
*);

682 
	gpublic
:

683 
MšCG3DMD
(
ty³0
,
boŞ
(&)[
__dim__
][__dim__],boŞ,ty³0,ty³0,
şass
 
LšeS—rch
*);

684 ~
MšCG3DMD
();

685 
vœtu®
 
run
();

686 
vœtu®
 
š™
();

687 
vœtu®
 
fš
();

690 
	g‹m¶©e
<
boŞ
 
	gBC
,boŞ 
	gX
,boŞ 
	gALPHA
,boŞ 
	gC
,
şass
 
	gLS
>

691 
run
(
LS
* 
ls
,
n¡•s
)

693 
	gMšDMDHªdËr
<
	gBC
,
	gX
,
	gALPHA
,
	gC
> 
hªdËr
(
©oms
,
ff
,
max_dx
,
max_d®pha
,
H_dof
);

694 
	ghªdËr
.
š™
();

695 
	ghªdËr
.
	gdyÇmic
->
š™
();

699 if(
	gx´t
)

701 
	gŒy


703 
	gx´t
->
	g©oms
=
©oms
;

704 
	gx´t
->
š™
();

706 
ÿtch
(
¡d
::
¡ršg
& 
”r_msg
)

708 
x´t
->
fš
();

709 
	gx´t
->
	g©oms
=
NULL
;

710 
	ghªdËr
.
	gdyÇmic
->
fš
();

711 
	ghªdËr
.
fš
();

712 
throw
 
	g”r_msg
;

725 
ty³Çme
 
	gMšDMDHªdËr
<
	gBC
,
	gX
,
	gALPHA
,
	gC
>::
VECTENS1
& 
f
=
hªdËr
.f;

726 
ty³Çme
 
	gMšDMDHªdËr
<
	gBC
,
	gX
,
	gALPHA
,
	gC
>::
VECTENS1
& 
f0
=
hªdËr
.f0;

727 
ty³Çme
 
	gMšDMDHªdËr
<
	gBC
,
	gX
,
	gALPHA
,
	gC
>::
VECTENS1
& 
h
=
hªdËr
.h;

728 
ty³Çme
 
	gMšDMDHªdËr
<
	gBC
,
	gX
,
	gALPHA
,
	gC
>::
VECTENS0
& 
x0
=
hªdËr
.x0;

729 
ty³Çme
 
	gMšDMDHªdËr
<
	gBC
,
	gX
,
	gALPHA
,
	gC
>::
VECTENS0
& 
x
=
hªdËr
.x;

730 
	gty³0
& 
	gf_h
=
hªdËr
.
f_h
;

733 
	g¡•
=
©oms
->
¡•
;

735 
	ghªdËr
.
fÜû_ÿlc
();

740 
Th”moDyÇmics
 
th”mo
(6,

741 "PE",
©oms
->
ã
,

742 "S[0][0]",
©oms
->
S_ã
[0][0],

743 "S[1][1]",
©oms
->
S_ã
[1][1],

744 "S[2][2]",
©oms
->
S_ã
[2][2],

745 "S[1][2]",
©oms
->
S_ã
[2][1],

746 "S[2][0]",
©oms
->
S_ã
[2][0],

747 "S[0][1]",
©oms
->
S_ã
[1][0]);

749 if(
	gÁ®ly
è
	gth”mo
.
š™
();

750 if(
	gÁ®ly
è
	gth”mo
.
´št
(
¡•
);

753 
ty³0
 
	ge_´ev
,
	ge_cu¼
=
©oms
->
ã
;

754 
ty³0
 
	gf0_f0
,
	gf_f
,
	gf_f0
;

755 
ty³0
 
	g¿tio
,
	g®pha
;

756 
	g”r
=
n¡•s
==0? 
MIN_F_MAX_ITER
:
LS_S
;

757 
	gh
=
f
;

758 
	gf0_f0
=
f
*f;

759 
	gi¡•
=0;

760 ;
	g”r
==
LS_S
;
	gi¡•
++)

762 if(
	gf0_f0
==0.0)

764 
”r
=
LS_F_GRAD0
;

768 
	gx0
=
x
;

769 
	gf0
=
f
;

771 
	ge_´ev
=
e_cu¼
;

774 
	gf_h
=
f
*
h
;

775 if(
	gf_h
<0.0)

777 
	gh
=
f
;

778 
	gf_h
=
f0_f0
;

780 
	ghªdËr
.
´•
();

781 
	g”r
=
ls
->
mš
(&
hªdËr
,
e_cu¼
,
®pha
,1);

783 if(
	g”r
!=
LS_S
)

787 
i¡•
--;

791 
	ghªdËr
.
fÜû_ÿlc
();

793 if(
	gÁ®ly
 && (
	gi¡•
+1)%ntally==0)

794 
th”mo
.
´št
(
¡•
+
i¡•
+1);

799 if(
	ge_´ev
-
	ge_cu¼
<
	ge_tŞ
è
	g”r
=
MIN_S_TOLERANCE
;

800 if(
	gi¡•
+1==
n¡•s
è
”r
=
MIN_F_MAX_ITER
;

801 if(
	g”r
) ;

803 
	gf_f
=
f
*f;

804 
	gf_f0
=
f
*
f0
;

806 
	g¿tio
=(
f_f
-
f_f0
)/(
f0_f0
);

808 
	gh
=
¿tio
*
h
+
f
;

809 
	gf0_f0
=
f_f
;

812 if(
	gÁ®ly
 && 
	gi¡•
%ntally)

813 
	gth”mo
.
´št
(
¡•
+
i¡•
);

817 if(
	gÁ®ly
è
	gth”mo
.
fš
();

819 if(
	gÁ®ly
è
årštf
(
MAPP
::
m­p_out
,"%s",
”r_msgs
[
”r
]);

821 
	g©oms
->
	g¡•
+=
i¡•
;

830 
	ghªdËr
.
	gdyÇmic
->
fš
();

831 
	ghªdËr
.
fš
();

838 
PyObjeù_HEAD


839 
MšCG3DMD
* 
	gmš
;

840 
	gLšeS—rch
::
Objeù
* 
ls
;

841 
	gExpÜtDMD
::
Objeù
* 
x´t
;

842 }
	tObjeù
;

844 
PyTy³Objeù
 
	gTy³Objeù
;

845 
PyObjeù
* 
__Ãw__
(
PyTy³Objeù
*,PyObject*, PyObject*);

846 
__š™__
(
PyObjeù
*, PyObject*,PyObject*);

847 
PyObjeù
* 
__®loc__
(
PyTy³Objeù
*,
Py_ssize_t
);

848 
__d—Îoc__
(
PyObjeù
*);

850 
PyM‘hodDef
 
	gm‘hods
[];

851 
£tup__m‘hods
();

852 
ml_run
(
PyM‘hodDef
&);

854 
PyG‘S‘Def
 
	gg‘£t
[];

855 
£tup__g‘£t
();

856 
g‘£t_max_d®pha
(
PyG‘S‘Def
&);

857 
g‘£t_x_dof
(
PyG‘S‘Def
&);

858 
g‘£t_®pha_dof
(
PyG‘S‘Def
&);

859 
g‘£t_c_dof
(
PyG‘S‘Def
&);

860 
g‘£t_expÜt
(
PyG‘S‘Def
&);

862 
£tup_
();

	@min_cg_dmd.cpp

1 
	~"mš_cg_dmd.h
"

2 
	~<¡dlib.h
>

3 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

7 
	gMšCGDMD
::
MšCGDMD
(
ty³0
 
__e_tŞ
,

8 
boŞ
(&
__H_dof
)[
__dim__
][__dim__],boŞ 
__affše
,
ty³0
 
__max_dx
,ty³0 
__max_d®pha
,
LšeS—rch
* 
__ls
):

9 
Mš
(
__e_tŞ
,
__H_dof
,
__affše
,
__max_dx
,
__ls
),

10 
©oms
(
NULL
),

11 
ff
(
NULL
),

12 
max_d®pha
(
__max_d®pha
),

13 
	$x´t
(
NULL
)

15 
	}
}

19 
	gMšCGDMD
::~
	$MšCGDMD
()

21 
©oms
=
NULL
;

22 
ff
=
NULL
;

23 
	}
}

27 
	gMšCGDMD
::
	$´e_run_chk
(
AtomsDMD
* 
©oms
,
FÜûF›ldDMD
* 
ff
)

29 
Œy


31 
Mš
::
	`´e_run_chk
(
©oms
,
ff
);

33 
	`ÿtch
 (
¡d
::
¡ršg
& 
”r_msg
)

35 
throw
 
”r_msg
;

38 if(
¡d
::
	`i¢ª
(
©oms
->
kB
))

39 
throw
 
¡d
::
	`¡ršg
("boltzmann constant should be set…rioro minimizatiom");

41 if(
¡d
::
	`i¢ª
(
©oms
->
hP
))

42 
throw
 
¡d
::
	`¡ršg
("planck constant should be set…rioro minimizatiom");

45 if(
¡d
::
	`i¢ª
(
©oms
->
‹mp
))

46 
throw
 
¡d
::
	`¡ršg
("temperature should be set…rioro minimizatiom");

47 
	}
}

51 
	gMšCGDMD
::
	$fÜû_ÿlc
()

53 
ff
->
	`d”iv©ive
();

55 if(
chng_box
)

57 
	`ty³0
 (&
S_ã
)[
__dim__
][__dim__]=
©oms
->S_fe;

58 
ty³0
 
Ãg_v
=-
©oms
->
vŞ
;

59 
Algeb¿
::
DoLT
<
__dim__
>::
	`func
([
this
,&
S_ã
,&
Ãg_v
](
i
,
j
)

60 {
f
.
A
[
i
][
j
]=
H_dof
[i][j] ? 
S_ã
[i][j]*
Ãg_v
:0.0;});

63 
	}
}

67 
	gMšCGDMD
::
	$´•
()

69 
x_d
=
h
;

70 if(!
chng_box
) ;

72 cÚ¡ 
Çtms_lş
=
©oms
->natms_lcl;

73 
ty³0
* 
xvec
=
x0
.
vecs
[0]->
	`begš
();

74 
ty³0
* 
hvec
=
h
.
vecs
[0]->
	`begš
();

75 
ty³0
* 
x_dvec
=
x_d
.
vecs
[0]->
	`begš
();

76 
Algeb¿
::
	`MLT_mul_MLT
(
©oms
->
H
,
h
.
A
,
x_d
.A);

79 if(
affše
)

81 
Ÿtm
=0;Ÿtm<
Çtms_lş
;Ÿtm++,
xvec
+=
__dim__
,
x_dvec
+=__dim__)

82 
Algeb¿
::
	`V_mul_MLT
(
xvec
,
h
.
A
,
x_dvec
);

86 
Ÿtm
=0;Ÿtm<
Çtms_lş
;Ÿtm++,
xvec
+=
__dim__
,
x_dvec
+=__dim__,
hvec
+=__dim__)

87 
Algeb¿
::
	`V_mul_MLT_add_š
(
xvec
,
h
.
A
,
x_dvec
);

89 
	}
}

93 
ty³0
 
	gMšCGDMD
::
	$ÿlc_ndofs
()

96 
	}
}

100 
	gMšCGDMD
::
	$š™
()

102 cÚ¡ 
c_dim
=
©oms
->
c
->
dim
;

103 
x
.~
	`VecT’s
();

104 
	`Ãw
 (&
x
è
VecT’s
<
ty³0
,2>(
©oms
,
chng_box
,©oms->
H
,©oms->x,©oms->
®pha
);

105 
f
.~
	`VecT’s
();

106 
	`Ãw
 (&
f
è
VecT’s
<
ty³0
,2>(
©oms
,
chng_box
,
ff
->
F_H
,ff->f,ff->
f_®pha
);

107 
h
.~
	`VecT’s
();

108 
	`Ãw
 (&
h
è
VecT’s
<
ty³0
,2>(
©oms
,
chng_box
,
__dim__
,
c_dim
);

109 
x0
.~
	`VecT’s
();

110 
	`Ãw
 (&
x0
è
VecT’s
<
ty³0
,2>(
©oms
,
chng_box
,
__dim__
,
c_dim
);

111 
x_d
.~
	`VecT’s
();

112 
	`Ãw
 (&
x_d
è
VecT’s
<
ty³0
,2>(
©oms
,
chng_box
,
__dim__
,
c_dim
);

113 
f0
.~
	`VecT’s
();

114 
	`Ãw
 (&
f0
è
VecT’s
<
ty³0
,2>(
©oms
,
chng_box
,
__dim__
,
c_dim
);

115 #ifdeà
MINCG_W_NEWTON


116 
dyÇmic
=
Ãw
 
	`DyÇmicDMD
(
©oms
,
ff
,
Œue
,{©oms->
c_dof
},

117 {
©oms
->
x_dof
,©oms->
®pha_dof
,
h
.
vecs
[0],h.vecs[1],
x0
.vecs[0],x0.vecs[1],
x_d
.vecs[0],x_d.vecs[1],
f0
.vecs[0],f0.vecs[1]},{});

119 
dyÇmic
=
Ãw
 
	`DyÇmicDMD
(
©oms
,
ff
,
chng_box
,{},

120 {
©oms
->
x_dof
,©oms->
®pha_dof
,©oms->
c_dof
,
h
.
vecs
[0],h.vecs[1],
x0
.vecs[0],x0.vecs[1],
x_d
.vecs[0],x_d.vecs[1],
f0
.vecs[0],f0.vecs[1]},{});

122 
dyÇmic
->
	`š™
();

123 #ifdeà
OLD_UPDATE


124 
uvecs
[0]=
©oms
->
x
;

125 
uvecs
[1]=
©oms
->
®pha
;

128 if(
x´t
)

130 
Œy


132 
x´t
->
©oms
=atoms;

133 
x´t
->
	`š™
();

135 
	`ÿtch
(
¡d
::
¡ršg
& 
”r_msg
)

137 
	`fš
();

138 
throw
 
”r_msg
;

141 
	}
}

145 
	gMšCGDMD
::
	$fš
()

147 if(
x´t
)

149 
x´t
->
	`fš
();

150 
x´t
->
©oms
=
NULL
;

152 #ifdeà
OLD_UPDATE


153 
uvecs
[1]=
NULL
;

154 
uvecs
[0]=
NULL
;

157 
dyÇmic
->
	`fš
();

158 
d–‘e
 
dyÇmic
;

159 
dyÇmic
=
NULL
;

161 
f0
.~
	`VecT’s
();

162 
x_d
.~
	`VecT’s
();

163 
x0
.~
	`VecT’s
();

164 
h
.~
	`VecT’s
();

165 
f
.~
	`VecT’s
();

166 
x
.~
	`VecT’s
();

167 
	}
}

171 
	gMšCGDMD
::
	$run
(
n¡•s
)

173 if(
dyÇmic_ÿ¡
<
LšeS—rchGŞd’SeùiÚ
*>(
ls
))

174  
	`run
(
dyÇmic_ÿ¡
<
LšeS—rchGŞd’SeùiÚ
*>(
ls
),
n¡•s
);

176 if(
dyÇmic_ÿ¡
<
LšeS—rchB»Á
*>(
ls
))

177  
	`run
(
dyÇmic_ÿ¡
<
LšeS—rchB»Á
*>(
ls
),
n¡•s
);

179 if(
dyÇmic_ÿ¡
<
LšeS—rchBackT¿ck
*>(
ls
))

180  
	`run
(
dyÇmic_ÿ¡
<
LšeS—rchBackT¿ck
*>(
ls
),
n¡•s
);

181 
	}
}

185 
ty³0
 
	gMšCGDMD
::
	$F
(
ty³0
 
®pha
)

187 
x
=
x0
+
®pha
*
x_d
;

188 
ty³0
 
max_®pha_lş
=0.0;

189 cÚ¡ 
n
=
©oms
->
Çtms_lş
*©oms->
®pha
->
dim
;

190 
ty³0
* 
®pha_vec
=
©oms
->
®pha
->
	`begš
();

191 
ty³0
* 
c_vec
=
©oms
->
c
->
	`begš
();

192 
i
=0;i<
n
;i++)

193 if(
c_vec
[
i
]>=0.0è
max_®pha_lş
=
	`MAX
(max_®pha_lş,
®pha_vec
[i]);

194 
	`MPI_AÎ»duû
(&
max_®pha_lş
,&
©oms
->
max_®pha
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_MAX
,©oms->
wÜld
);

196 if(
chng_box
)

197 
©oms
->
	`upd©e_H
();

199 #ifdeà
OLD_UPDATE


200 
dyÇmic
->
	`upd©e
(
uvecs
,2);

202 
dyÇmic
->
upd©e
<
Œue
,true>();

204  
ff
->
	`v®ue
();

205 
	}
}

209 
ty³0
 
	gMšCGDMD
::
	$dF
(
ty³0
 
®pha
,ty³0& 
d»v
)

211 
x
=
x0
+
®pha
*
h
;

212 
ty³0
 
max_®pha_lş
=0.0;

213 cÚ¡ 
n
=
©oms
->
Çtms_lş
*©oms->
®pha
->
dim
;

214 
ty³0
* 
®pha_vec
=
©oms
->
®pha
->
	`begš
();

215 
ty³0
* 
c_vec
=
©oms
->
c
->
	`begš
();

216 
i
=0;i<
n
;i++)

217 if(
c_vec
[
i
]>=0.0è
max_®pha_lş
=
	`MAX
(max_®pha_lş,
®pha_vec
[i]);

218 
	`MPI_AÎ»duû
(&
max_®pha_lş
,&
©oms
->
max_®pha
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_MAX
,©oms->
wÜld
);

220 if(
chng_box
)

221 
©oms
->
	`upd©e_H
();

223 #ifdeà
OLD_UPDATE


224 
dyÇmic
->
	`upd©e
(
uvecs
,2);

226 
dyÇmic
->
upd©e
<
Œue
,true>();

228 
	`fÜû_ÿlc
();

230 
d»v
=-(
f
*
h
);

231  
©oms
->
ã
;

232 
	}
}

236 
	gMšCGDMD
::
	$ls_´•
(
ty³0
& 
dç
,ty³0& 
h_nÜm
,ty³0& 
max_a
)

239 
h_nÜm
=
h
*h;

241 
dç
=-
f_h
;

243 if(
h_nÜm
==0.0)

245 
max_a
=0.0;

246 
dç
=0.0;

250 if(
dç
>=0.0)

252 
max_a
=0.0;

253 
dç
=1.0;

257 
h_nÜm
=
	`sq¹
(h_norm);

260 
ty³0
 
max_x_d_lş
=0.0;

261 
ty³0
* 
x_dvec
=
x_d
.
vecs
[0]->
	`begš
();

262 cÚ¡ 
Çtms_lş
=
©oms
->natms_lcl;

263 
n
=
Çtms_lş
*
__dim__
;

264 
i
=0;i<
n
;i++)

265 
max_x_d_lş
=
	`MAX
(max_x_d_lş,
	`çbs
(
x_dvec
[
i
]));

268 
ty³0
 
max_®pha_¿tio
=
¡d
::
num”ic_lim™s
<ty³0>::
	`šfš™y
();

269 
ty³0
* 
x_d_®phavec
=
x_d
.
vecs
[1]->
	`begš
();

270 
ty³0
* 
®phavec
=
x
.
vecs
[1]->
	`begš
();

271 
n
=
Çtms_lş
*
©oms
->
®pha
->
dim
;

272 
ty³0
 
max_x_d_®pha_lş
=0.0;

273 
i
=0;i<
n
;i++)

275 if(
x_d_®phavec
[
i
]<0.0)

276 
max_®pha_¿tio
=
	`MIN
(-
®phavec
[
i
]/
x_d_®phavec
[i],max_alpha_ratio);

277 
max_x_d_®pha_lş
=
	`MAX
(max_x_d_®pha_lş,
	`çbs
(
x_d_®phavec
[
i
]));

279 
ty³0
 
max_a_lş
=
	`MIN
(
	`çbs
(
max_dx
/
max_x_d_lş
),
max_®pha_¿tio
);

280 
max_a_lş
=
	`MIN
(max_a_lş,
	`çbs
(
max_d®pha
/
max_x_d_®pha_lş
));

282 
	`MPI_AÎ»duû
(&
max_a_lş
,&
max_a
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_MIN
,
©oms
->
wÜld
);

284 
	}
}

288 
	gMšCGDMD
::
	$F_»£t
()

290 
x
=
x0
;

291 cÚ¡ 
n
=
©oms
->
Çtms_lş
*©oms->
®pha
->
dim
;

292 
ty³0
 
max_®pha_lş
=0.0;

293 
ty³0
* 
®pha_vec
=
©oms
->
®pha
->
	`begš
();

294 
ty³0
* 
c_vec
=
©oms
->
c
->
	`begš
();

295 
i
=0;i<
n
;i++)

296 if(
c_vec
[
i
]>=0.0è
max_®pha_lş
=
	`MAX
(max_®pha_lş,
®pha_vec
[i]);

297 
	`MPI_AÎ»duû
(&
max_®pha_lş
,&
©oms
->
max_®pha
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_MAX
,©oms->
wÜld
);

298 if(
chng_box
è
©oms
->
	`upd©e_H
();

299 #ifdeà
OLD_UPDATE


300 
dyÇmic
->
	`upd©e
(
uvecs
,2);

302 
dyÇmic
->
upd©e
<
Œue
,true>();

304 
	}
}

308 
PyObjeù
* 
	gMšCGDMD
::
	$__Ãw__
(
PyTy³Objeù
* 
ty³
,
PyObjeù
* 
¬gs
,PyObjeù* 
kwds
)

310 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
ty³
->
	`_®loc
(type,0));

311 
PyObjeù
* 
£lf
=
»š‹½»t_ÿ¡
<PyObjeù*>(
__£lf
);

312  
£lf
;

313 
	}
}

317 
	gMšCGDMD
::
	$__š™__
(
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)

319 
FuncAPI
<
ty³0
,
symm
<
boŞ
[
__dim__
][__dim__]>,boŞ,ty³0,ty³0,
OP
<
LšeS—rch
>> 
	`f
("__init__",{"e_tol","H_dof","affine","max_dx","max_dalpha","ls"});

320 
f
.
nİtiÚ®s
=6;

321 
f
.
logics
<0>()[0]=
	`VLogics
("ge",0.0);

322 
f
.
logics
<3>()[0]=
	`VLogics
("gt",0.0);

323 
f
.
logics
<4>()[0]=
	`VLogics
("gt",0.0);

326 
f
.
v®
<0>()=
	`sq¹
(
¡d
::
num”ic_lim™s
<
ty³0
>::
	`•sÚ
());

327 
i
=0;i<
__dim__
;i++è
j
=0;j<__dim__;j++)
f
.
v®
<1>()[i][j]=
çl£
;

328 
f
.
v®
<2>()=
çl£
;

329 
f
.
v®
<3>()=1.0;

330 
f
.
v®
<4>()=0.1;

331 
PyObjeù
* 
em±y_tu¶e
=
	`PyTu¶e_New
(0);

332 
PyObjeù
* 
em±y_diù
=
	`PyDiù_New
();

333 
PyObjeù
* 
__ls
=
LšeS—rchBackT¿ck
::
	`__Ãw__
(&LšeS—rchBackT¿ck::
Ty³Objeù
,
em±y_tu¶e
,
em±y_diù
);

334 
LšeS—rchBackT¿ck
::
	`__š™__
(
__ls
,
em±y_tu¶e
,
em±y_diù
);

335 
	`Py_DECREF
(
em±y_diù
);

336 
	`Py_DECREF
(
em±y_tu¶e
);

337 
f
.
v®
<5>().
ob
=
__ls
;

340 if(
	`f
(
¬gs
,
kwds
)==-1)  -1;

344 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

345 
	`Py_INCREF
(
f
.
v®
<5>().
ob
);

346 
__£lf
->
ls
=
»š‹½»t_ÿ¡
<
LšeS—rch
::
Objeù
*>(
f
.
v®
<5>().
ob
);

347 
__£lf
->
mš
=
Ãw
 
	`MšCGDMD
(
f
.
v®
<0>(),f.v®<1>(),f.v®<2>(),f.v®<3>(),f.v®<4>(),&(__£lf->
ls
->ls));

348 
__£lf
->
x´t
=
NULL
;

351 
	}
}

355 
PyObjeù
* 
	gMšCGDMD
::
	$__®loc__
(
PyTy³Objeù
* 
ty³
,
Py_ssize_t
)

357 
Objeù
* 
__£lf
=
Ãw
 Object;

358 
	`Py_TYPE
(
__£lf
)=
ty³
;

359 
	`Py_REFCNT
(
__£lf
)=1;

360 
__£lf
->
mš
=
NULL
;

361 
__£lf
->
ls
=
NULL
;

362 
__£lf
->
x´t
=
NULL
;

363  
»š‹½»t_ÿ¡
<
PyObjeù
*>(
__£lf
);

364 
	}
}

368 
	gMšCGDMD
::
	$__d—Îoc__
(
PyObjeù
* 
£lf
)

370 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

371 
d–‘e
 
__£lf
->
mš
;

372 
__£lf
->
mš
=
NULL
;

373 if(
__£lf
->
ls
è
	`Py_DECREF
(__self->ls);

374 
__£lf
->
ls
=
NULL
;

375 if(
__£lf
->
x´t
è
	`Py_DECREF
(__self->xprt);

376 
__£lf
->
x´t
=
NULL
;

377 
d–‘e
 
__£lf
;

378 
	}
}

380 
PyTy³Objeù
 
	gMšCGDMD
::
Ty³Objeù
={
PyObjeù_HEAD_INIT
(
NULL
)};

382 
	gMšCGDMD
::
	$£tup_
()

384 
Ty³Objeù
.
_Çme
="mapp.dmd.min_cg";

385 
Ty³Objeù
.
_doc
=
R
"---(

386 
	`__š™__
(
e_tŞ
=1.0e-8,
H_dof
=[[
F®£
],[F®£,F®£],[F®£,F®£,F®£]],
affše
=F®£,
max_dx
=1.0,
max_d®pha
=0.1,
ls
=
m­p
.
dmd
.
	`ls_bt
())

388 
CG
 
mšimiz©iÚ
 
®gÜ™hm


390 
P¬am‘”s


392 
e_tŞ
 : 

393 
EÃrgy
 
tŞ”ªû
 
ü™”iÚ
 
¡İpšg
 
mšimiz©iÚ


394 
H_dof
 : 
symm
<
boŞ
[
dim
][dim]>

395 
Un™ûÎ
 
deg»es
 
of
 
ä“dom
 
duršg
 
mšimiz©iÚ
, 
h”e
 
dim
 
is
 
the
 
dim’siÚ
 oà
simuÏtiÚ


396 
affše
 : 
boŞ


397 
If
 
£t
 
to
 
True
 
©omic
 
di¥Ïûm’ts
 
would
 
be
 
affše


398 
max_dx
 : 

399 
Maximum
 
di¥Ïûm’t
 
of
 
ªy
 
©om
 
š
 
Úe
 
¡•
 oà
mšimiz©iÚ


400 
max_d®pha
 : 

401 
Maximum
 
chªge
 
š
 
®pha
 
compÚ’t
 
of
 
ªy
 
©om
 iÀ
Úe
 
¡•
 oà
mšimiz©iÚ


402 
ls
 : 
m­p
.ls

403 
Lše
 
£¬ch
 
m‘hod


405 
NÙes


407 
Cojug©e
 
	`G¿d›Á
 (
CG
è
®gÜ™hm
 
mšimiz©iÚ
.

411 
Ty³Objeù
.
_æags
=
Py_TPFLAGS_DEFAULT
;

412 
Ty³Objeù
.
_basicsize
=(
Objeù
);

414 
Ty³Objeù
.
_Ãw
=
__Ãw__
;

415 
Ty³Objeù
.
_š™
=
__š™__
;

416 
Ty³Objeù
.
_®loc
=
__®loc__
;

417 
Ty³Objeù
.
_d—Îoc
=
__d—Îoc__
;

418 
	`£tup__m‘hods
();

419 
Ty³Objeù
.
_m‘hods
=
m‘hods
;

420 
	`£tup__g‘£t
();

421 
Ty³Objeù
.
_g‘£t
=
g‘£t
;

423 
ichk
=
	`PyTy³_R—dy
(&
Ty³Objeù
);

424 if(
ichk
<0)  ichk;

425 
	`Py_INCREF
(&
Ty³Objeù
);

426 
	`GET_WRAPPER_DOC
(
Ty³Objeù
,
__š™__
)=
NULL
;

427  
ichk
;

428 
	}
}

430 
PyG‘S‘Def
 
	gMšCGDMD
::
g‘£t
[]=
Em±yPyG‘S‘Def
(9);

432 
	gMšCGDMD
::
	$£tup__g‘£t
()

434 
	`g‘£t_e_tŞ
(
g‘£t
[0]);

435 
	`g‘£t_H_dof
(
g‘£t
[1]);

436 
	`g‘£t_affše
(
g‘£t
[2]);

437 
	`g‘£t_max_dx
(
g‘£t
[3]);

438 
	`g‘£t_max_d®pha
(
g‘£t
[4]);

439 
	`g‘£t_ls
(
g‘£t
[5]);

440 
	`g‘£t_Á®ly
(
g‘£t
[6]);

441 
	`g‘£t_expÜt
(
g‘£t
[7]);

442 
	}
}

444 
PyM‘hodDef
 
	gMšCGDMD
::
m‘hods
[]=
Em±yPyM‘hodDef
(2);

446 
	gMšCGDMD
::
	$£tup__m‘hods
()

448 
	`ml_run
(
m‘hods
[0]);

449 
	}
}

453 
	gMšCGDMD
::
	$g‘£t_max_d®pha
(
PyG‘S‘Def
& 
g‘£t
)

455 
g‘£t
.
Çme
=(*)"max_dalpha";

456 
g‘£t
.
doc
=(*)
R
"---(

457 (è
mximum
 
®pha
 
chªge


459 
Maximum
 
chªge
 
š
 
®pha
 
compÚ’t
 
of
 
ªy
 
©om
 iÀ
Úe
 
¡•
 oà
mšimiz©iÚ


461 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

463  
v¬
<
ty³0
>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
mš
->
max_dx
);

465 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

467 
V¬API
<
ty³0
> 
	`max_d®pha
("max_dalpha");

468 
max_d®pha
.
logics
[0]=
	`VLogics
("gt",0.0);

469 
ichk
=
max_d®pha
.
	`£t
(
İ
);

470 if(
ichk
==-1)  -1;

471 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
mš
->
max_d®pha
=max_d®pha.
v®
;

474 
	}
}

478 
	gMšCGDMD
::
	$g‘£t_expÜt
(
PyG‘S‘Def
& 
g‘£t
)

480 
g‘£t
.
Çme
=(*)"export";

481 
g‘£t
.
doc
=(*)
R
"---(

482 (
m­p
.
dmd
.
expÜt
èexpÜˆ
objeù


484 
ExpÜt
 
objeù
 
to
 
»cÜd
 
the
 
¢­shÙs
 
of
h
sy¡em
 
mšimizšg


486 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

488 
ExpÜtDMD
::
Objeù
* 
x´t
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
)->xprt;

489 if(!
x´t
è
Py_RETURN_NONE
;

490 
	`Py_INCREF
(
x´t
);

491  
»š‹½»t_ÿ¡
<
PyObjeù
*>(
x´t
);

493 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

495 
V¬API
<
OP
<
ExpÜtDMD
>> 
	`x´t
("export");

496 
ichk
=
x´t
.
	`£t
(
İ
);

497 if(
ichk
==-1)  -1;

498 if(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
x´t
è
	`Py_DECREF
(reinterpret_cast<Object*>(self)->xprt);

499 
	`Py_INCREF
(
x´t
.
v®
.
ob
);

500 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
x´t
ôeš‹½»t_ÿ¡<
ExpÜtDMD
::Objeù*>(x´t.
v®
.
ob
);

503 
	}
}

507 
	gMšCGDMD
::
	$ml_run
(
PyM‘hodDef
& 
_m‘hods
)

509 
_m‘hods
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

510 
_m‘hods
.
ml_Çme
="run";

511 
_m‘hods
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

512 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

514 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

515 
FuncAPI
<
OP
<
AtomsDMD
>,> 
	`f
("run",{"atoms","max_nsteps"});

516 
f
.
logics
<1>()[0]=
	`VLogics
("ge",0);

517 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

519 
AtomsDMD
* 
__©oms
=
»š‹½»t_ÿ¡
<AtomsDMD::
Objeù
*>(
f
.
v®
<0>().
ob
)->
©oms
;

520 
FÜûF›ldDMD
* 
__ff
=
»š‹½»t_ÿ¡
<
AtomsDMD
::
Objeù
*>(
f
.
v®
<0>().
ob
)->
ff
;

521 
ExpÜtDMD
* 
__x´t
=
__£lf
->
x´t
==
NULL
 ? NULL:__self->xprt->xprt;

523 
Œy


525 
__£lf
->
mš
->
	`´e_run_chk
(
__©oms
,
__ff
);

527 
	`ÿtch
(
¡d
::
¡ršg
& 
”r_msg
)

529 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,
”r_msg
.
	`c_¡r
());

530  
NULL
;

533 
__£lf
->
mš
->
©oms
=
__©oms
;

534 
__£lf
->
mš
->
ff
=
__ff
;

535 
__£lf
->
mš
->
x´t
=
__x´t
;

537 
Œy


539 
__£lf
->
mš
->
	`š™
();

541 
	`ÿtch
(
¡d
::
¡ršg
& 
”r_msg
)

543 
__£lf
->
mš
->
x´t
=
NULL
;

544 
__£lf
->
mš
->
ff
=
NULL
;

545 
__£lf
->
mš
->
©oms
=
NULL
;

546 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,
”r_msg
.
	`c_¡r
());

547  
NULL
;

550 
__£lf
->
mš
->
	`run
(
f
.
v®
<1>());

552 
__£lf
->
mš
->
	`fš
();

554 
__£lf
->
mš
->
x´t
=
NULL
;

555 
__£lf
->
mš
->
ff
=
NULL
;

556 
__£lf
->
mš
->
©oms
=
NULL
;

558 
Py_RETURN_NONE
;

561 
_m‘hods
.
ml_doc
=(*)
R
"---(

562 
	`run
(
©oms
,
max_n¡•s
)

564 
Execu‹
 
mšimiz©iÚ


566 
This
 
m‘hod
 
¡¬ts
 
the
 
’”gy
 
mšimiz©iÚ
 
a
 
giv’
 
©oms
 
objeù
 
ªd
 
maximum
 
numb”
 
of
 
¡•s
.

568 
P¬am‘”s


570 
©oms
 : 
m­p
.
md
.atoms

571 
Sy¡em
 
of
 
š‹»¡


572 
max_n¡•s
 : 

573 
Maximum
 
numb”
 
of
 
¡•s
 
to
 
ach›ve
 
’”gy
 
mšimiz©iÚ


575 
R‘uºs


577 
NÚe


580 
	}
}

	@min_cg_dmd.h

1 #iâdeà
__MAPP__mš_cg_dmd__


2 
	#__MAPP__mš_cg_dmd__


	)

3 
	~"mš.h
"

4 
	~"mš_vec.h
"

5 
	~"ff_dmd.h
"

6 
	~"©oms_dmd.h
"

7 
	~"dyÇmic_dmd.h
"

8 
	~"MAPP.h
"

9 
	~"th”mo_dyÇmics.h
"

10 
Çme¥aû
 
	gMAPP_NS


12 şas 
	cMšCGDMD
:
public
 
Mš


14 #ifdeà
MINCG_W_NEWTON


15 
ä›nd
 
şass
 
DAE
;

17 
	g´iv©e
:

18 
´Ùeùed
:

19 
ty³0
 
max_d®pha
;

21 
´•
();

22 
ty³0
 
ÿlc_ndofs
();

23 
ty³0
 
	gndofs
;

25 
	gVecT’s
<
	gty³0
,2> 
	gh
;

26 
	gVecT’s
<
	gty³0
,2> 
	gx
;

27 
	gVecT’s
<
	gty³0
,2> 
	gx0
;

28 
	gVecT’s
<
	gty³0
,2> 
	gx_d
;

29 
	gVecT’s
<
	gty³0
,2> 
	gf
;

30 
	gVecT’s
<
	gty³0
,2> 
	gf0
;

32 
şass
 
AtomsDMD
* 
	g©oms
;

33 
şass
 
FÜûF›ldDMD
* 
	gff
;

34 
şass
 
DyÇmicDMD
* 
	gdyÇmic
;

35 
şass
 
ExpÜtDMD
* 
	gx´t
;

36 
´št_”rÜ
();

37 #ifdeà
OLD_UPDATE


38 
vec
* 
	guvecs
[2];

41 
´e_run_chk
(
AtomsDMD
*,
FÜûF›ldDMD
*);

43 
	gpublic
:

44 
MšCGDMD
(
ty³0
,
boŞ
(&)[
__dim__
][__dim__],boŞ,ty³0,ty³0,
şass
 
LšeS—rch
*);

45 ~
MšCGDMD
();

46 
vœtu®
 
run
();

47 
	g‹m¶©e
<
şass
 
	gC
>

48 
run
(
C
*,);

49 
vœtu®
 
š™
();

50 
vœtu®
 
fš
();

52 
fÜû_ÿlc
();

54 
ty³0
 
F
(type0);

55 
ty³0
 
dF
(type0,type0&);

56 
ls_´•
(
ty³0
&,type0&,type0&);

57 
F_»£t
();

60 
PyObjeù_HEAD


61 
MšCGDMD
* 
	gmš
;

62 
	gLšeS—rch
::
Objeù
* 
ls
;

63 
	gExpÜtDMD
::
Objeù
* 
x´t
;

64 }
	tObjeù
;

66 
PyTy³Objeù
 
	gTy³Objeù
;

67 
PyObjeù
* 
__Ãw__
(
PyTy³Objeù
*,PyObject*, PyObject*);

68 
__š™__
(
PyObjeù
*, PyObject*,PyObject*);

69 
PyObjeù
* 
__®loc__
(
PyTy³Objeù
*,
Py_ssize_t
);

70 
__d—Îoc__
(
PyObjeù
*);

72 
PyM‘hodDef
 
	gm‘hods
[];

73 
£tup__m‘hods
();

74 
ml_run
(
PyM‘hodDef
&);

76 
PyG‘S‘Def
 
	gg‘£t
[];

77 
£tup__g‘£t
();

78 
g‘£t_max_d®pha
(
PyG‘S‘Def
&);

79 
g‘£t_expÜt
(
PyG‘S‘Def
&);

81 
£tup_
();

88 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

92 
	g‹m¶©e
<
şass
 
	gC
>

93 
	gMšCGDMD
::
	$run
(
C
* 
ls
,
n¡•s
)

95 
¡•
=
©oms
->step;

97 
	`fÜû_ÿlc
();

99 
Ãv”y_x´t
=
x´t
==
NULL
 ? 0:x´t->
Ãv”y
;

100 if(
Ãv”y_x´t
è
x´t
->
	`wr™e
(
¡•
);

102 
Th”moDyÇmics
 
	`th”mo
(6,

103 "PE",
©oms
->
ã
,

104 "S[0][0]",
©oms
->
S_ã
[0][0],

105 "S[1][1]",
©oms
->
S_ã
[1][1],

106 "S[2][2]",
©oms
->
S_ã
[2][2],

107 "S[1][2]",
©oms
->
S_ã
[2][1],

108 "S[2][0]",
©oms
->
S_ã
[2][0],

109 "S[0][1]",
©oms
->
S_ã
[1][0]);

111 if(
Á®ly
è
th”mo
.
	`š™
();

112 if(
Á®ly
è
th”mo
.
	`´št
(
¡•
);

115 
ty³0
 
e_´ev
,
e_cu¼
=
©oms
->
ã
;

116 
ty³0
 
f0_f0
,
f_f
,
f_f0
;

117 
ty³0
 
¿tio
,
®pha
;

118 
”r
=
n¡•s
==0? 
MIN_F_MAX_ITER
:
LS_S
;

119 
h
=
f
;

120 
f0_f0
=
f
*f;

121 
i¡•
=0;

122 ;
”r
==
LS_S
;
i¡•
++)

124 if(
f0_f0
==0.0)

126 
”r
=
LS_F_GRAD0
;

130 
x0
=
x
;

131 
f0
=
f
;

133 
e_´ev
=
e_cu¼
;

136 
f_h
=
f
*
h
;

137 if(
f_h
<0.0)

139 
h
=
f
;

140 
f_h
=
f0_f0
;

142 
	`´•
();

143 
”r
=
ls
->
	`mš
(
this
,
e_cu¼
,
®pha
,1);

145 if(
”r
!=
LS_S
)

149 
i¡•
--;

153 
	`fÜû_ÿlc
();

155 if(
Á®ly
 && (
i¡•
+1)%ntally==0)

156 
th”mo
.
	`´št
(
¡•
+
i¡•
+1);

158 if(
Ãv”y_x´t
 && (
i¡•
+1)%Ãv”y_x´t==0è
x´t
->
	`wr™e
(
¡•
+istep+1);

161 if(
e_´ev
-
e_cu¼
<
e_tŞ
è
”r
=
MIN_S_TOLERANCE
;

162 if(
i¡•
+1==
n¡•s
è
”r
=
MIN_F_MAX_ITER
;

163 if(
”r
) ;

165 
f_f
=
f
*f;

166 
f_f0
=
f
*
f0
;

168 
¿tio
=(
f_f
-
f_f0
)/(
f0_f0
);

170 
h
=
¿tio
*h+
f
;

171 
f0_f0
=
f_f
;

174 if(
Á®ly
 && 
i¡•
%ntally)

175 
th”mo
.
	`´št
(
¡•
+
i¡•
);

177 if(
Ãv”y_x´t
 && 
i¡•
%Ãv”y_x´tè
x´t
->
	`wr™e
(
¡•
+istep);

179 if(
Á®ly
è
th”mo
.
	`fš
();

181 if(
Á®ly
è
	`årštf
(
MAPP
::
m­p_out
,"%s",
”r_msgs
[
”r
]);

183 
©oms
->
¡•
+=
i¡•
;

184 
	}
}

	@min_cg_potfit.cpp

1 
	~"mš_cg_pÙf™.h
"

2 
	~"pÙf™.h
"

3 
	~<¡dlib.h
>

4 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

8 
	gMšCGPÙF™
::
MšCGPÙF™
(
ty³0
 
__e_tŞ
,

9 
boŞ
(&
__H_dof
)[
__dim__
][__dim__],boŞ 
__affše
,
ty³0
 
__max_dx
,
LšeS—rch
* 
__ls
,
vec
* 
__ext_vec_0
,vec* 
__ext_vec_1
):

10 
Mš
(
__e_tŞ
,
__H_dof
,
__affše
,
__max_dx
,
__ls
),

11 
©oms
(
NULL
),

12 
ff
(
NULL
),

13 
x´t
(
NULL
),

14 
ext_vec_0
(
__ext_vec_0
),

15 
	$ext_vec_1
(
__ext_vec_1
)

17 
	}
}

21 
	gMšCGPÙF™
::~
	$MšCGPÙF™
()

23 
ext_vec_0
=
ext_vec_1
=
NULL
;

24 
©oms
=
NULL
;

25 
ff
=
NULL
;

26 
	}
}

30 
	gMšCGPÙF™
::
	$fÜû_ÿlc
()

32 
ff
->
	`d”iv©ive
();

33 if(
chng_box
)

34 
Algeb¿
::
DoLT
<
__dim__
>::
	`func
([
this
](
i
,
j
){
f
.
A
[i][j]=
H_dof
[i][j] ? f.A[i][j]:0.0;});

36 
	}
}

40 
	gMšCGPÙF™
::
	$´•
()

42 if(
chng_box
)

44 cÚ¡ 
Çtms_lş
=
©oms
->natms_lcl;

45 
ty³0
 
MLT
[
__dim__
][__dim__];

46 
Algeb¿
::
	`MLT_mul_MLT
(
©oms
->
B
,
h
.
A
,
MLT
);

47 
ty³0
* 
xvec
=
x0
.
vecs
[0]->
	`begš
();

48 
ty³0
* 
hvec
=
h
.
vecs
[0]->
	`begš
();

49 
ty³0
* 
x_dvec
=
x_d
.
vecs
[0]->
	`begš
();

50 
Algeb¿
::
DoLT
<
__dim__
>::
	`func
([
this
](
i
,
j
)

52 
x_d
.
A
[
i
][
j
]=
h
.A[i][j];

55 if(
affše
)

57 
Ÿtm
=0;Ÿtm<
Çtms_lş
;Ÿtm++,
xvec
+=
__dim__
,
x_dvec
+=__dim__)

58 
Algeb¿
::
	`V_mul_MLT
(
xvec
,
MLT
,
x_dvec
);

62 
Ÿtm
=0;Ÿtm<
Çtms_lş
;Ÿtm++,
xvec
+=
__dim__
,
x_dvec
+=__dim__,
hvec
+=__dim__)

64 
Algeb¿
::
	`V_mul_MLT
(
xvec
,
MLT
,
x_dvec
);

65 
Algeb¿
::
V_add
<
__dim__
>(
hvec
,
x_dvec
);

70 
x_d
=
h
;

72 
	}
}

76 
	gMšCGPÙF™
::
	$š™
()

78 
x
.~
	`VecT’s
();

79 
	`Ãw
 (&
x
è
VecT’s
<
ty³0
,1>(
©oms
,
chng_box
,©oms->
H
,atoms->x);

80 
f
.~
	`VecT’s
();

81 
	`Ãw
 (&
f
è
VecT’s
<
ty³0
,1>(
©oms
,
chng_box
,
ff
->
F_H
,ff->f);

82 
h
.~
	`VecT’s
();

83 
	`Ãw
 (&
h
è
VecT’s
<
ty³0
,1>(
©oms
,
chng_box
,
__dim__
);

84 
x0
.~
	`VecT’s
();

85 
	`Ãw
 (&
x0
è
VecT’s
<
ty³0
,1>(
©oms
,
chng_box
,
__dim__
);

86 
x_d
.~
	`VecT’s
();

87 
	`Ãw
 (&
x_d
è
VecT’s
<
ty³0
,1>(
©oms
,
chng_box
,
__dim__
);

88 
f0
.~
	`VecT’s
();

89 
	`Ãw
 (&
f0
è
VecT’s
<
ty³0
,1>(
©oms
,
chng_box
,
__dim__
);

91 
dyÇmic
=
Ãw
 
	`DyÇmicMD
(
©oms
,
ff
,
chng_box
,{},{©oms->
x_dof
,
h
.
vecs
[0],
x0
.vecs[0],
x_d
.vecs[0],
f0
.vecs[0],
ext_vec_0
,
ext_vec_1
},{});

92 
dyÇmic
->
	`š™
();

94 if(
x´t
)

96 
Œy


98 
x´t
->
©oms
=atoms;

99 
x´t
->
	`š™
();

101 
	`ÿtch
(
¡d
::
¡ršg
& 
”r_msg
)

103 
	`fš
();

104 
throw
 
”r_msg
;

107 
	}
}

111 
	gMšCGPÙF™
::
	$fš
()

113 if(
x´t
)

115 
x´t
->
	`fš
();

116 
x´t
->
©oms
=
NULL
;

119 
dyÇmic
->
	`fš
();

120 
d–‘e
 
dyÇmic
;

121 
dyÇmic
=
NULL
;

123 
f0
.~
	`VecT’s
();

124 
x_d
.~
	`VecT’s
();

125 
x0
.~
	`VecT’s
();

126 
h
.~
	`VecT’s
();

127 
f
.~
	`VecT’s
();

128 
x
.~
	`VecT’s
();

129 
	}
}

133 
	gMšCGPÙF™
::
	$run
(
n¡•s
)

135 if(
dyÇmic_ÿ¡
<
LšeS—rchGŞd’SeùiÚ
*>(
ls
))

136  
	`run
(
dyÇmic_ÿ¡
<
LšeS—rchGŞd’SeùiÚ
*>(
ls
),
n¡•s
);

138 if(
dyÇmic_ÿ¡
<
LšeS—rchB»Á
*>(
ls
))

139  
	`run
(
dyÇmic_ÿ¡
<
LšeS—rchB»Á
*>(
ls
),
n¡•s
);

141 if(
dyÇmic_ÿ¡
<
LšeS—rchBackT¿ck
*>(
ls
))

142  
	`run
(
dyÇmic_ÿ¡
<
LšeS—rchBackT¿ck
*>(
ls
),
n¡•s
);

143 
	}
}

147 
ty³0
 
	gMšCGPÙF™
::
	$F
(
ty³0
 
®pha
)

149 
x
=
x0
+
®pha
*
x_d
;

150 if(
chng_box
)

151 
©oms
->
	`upd©e_H
();

152 #ifdeà
OLD_UPDATE


153 
dyÇmic
->
	`upd©e
(
©oms
->
x
);

155 
dyÇmic
->
upd©e
<
Œue
>();

157  
ff
->
	`v®ue
();

158 
	}
}

162 
ty³0
 
	gMšCGPÙF™
::
	$dF
(
ty³0
 
®pha
,ty³0& 
d»v
)

164 
x
=
x0
+
®pha
*
x_d
;

165 if(
chng_box
)

166 
©oms
->
	`upd©e_H
();

167 #ifdeà
OLD_UPDATE


168 
dyÇmic
->
	`upd©e
(
©oms
->
x
);

170 
dyÇmic
->
upd©e
<
Œue
>();

172 
	`fÜû_ÿlc
();

174 
d»v
=-(
f
*
h
);

175  
©oms
->
³
;

176 
	}
}

185 
	gMšCGPÙF™
::
	$ls_´•
(
ty³0
& 
dç
,ty³0& 
h_nÜm
,ty³0& 
max_a
)

188 
h_nÜm
=
h
*h;

190 
dç
=-
f_h
;

192 if(
h_nÜm
==0.0)

194 
max_a
=0.0;

195 
dç
=0.0;

199 if(
dç
>=0.0)

201 
max_a
=0.0;

202 
dç
=1.0;

206 
h_nÜm
=
	`sq¹
(h_norm);

208 
ty³0
 
max_x_d_lş
=0.0;

209 
ty³0
 
max_x_d
;

210 
ty³0
* 
x_dvec
=
x_d
.
vecs
[0]->
	`begš
();

211 cÚ¡ 
n
=
©oms
->
Çtms_lş
*
__dim__
;

212 
i
=0;i<
n
;i++)

213 
max_x_d_lş
=
	`MAX
(max_x_d_lş,
	`çbs
(
x_dvec
[
i
]));

215 
	`MPI_AÎ»duû
(&
max_x_d_lş
,&
max_x_d
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_MAX
,
©oms
->
wÜld
);

216 
max_a
=
	`çbs
(
max_dx
/
max_x_d
);

218 
	}
}

222 
	gMšCGPÙF™
::
	$F_»£t
()

224 
x
=
x0
;

225 if(
chng_box
è
©oms
->
	`upd©e_H
();

226 #ifdeà
OLD_UPDATE


227 
dyÇmic
->
	`upd©e
(
©oms
->
x
);

229 
dyÇmic
->
upd©e
<
Œue
>();

231 
	}
}

235 
	gMšCGPÙF™
::
g‘_H_dof
(
boŞ
 (& 
__H_dof
)[
__dim__
][__dim__])

237 
memıy
(&
__H_dof
[0][0],&
H_dof
[0][0],
__dim__
*__dim__*(
boŞ
));

242 
	gMšCGPÙF™
::
£t_H_dof
(
boŞ
 (& 
__H_dof
)[
__dim__
][__dim__])

244 
memıy
(&
H_dof
[0][0],&
__H_dof
[0][0],
__dim__
*__dim__*(
boŞ
));

	@min_cg_potfit.h

1 #iâdeà
__MAPP__mš_cg_pÙf™__


2 
	#__MAPP__mš_cg_pÙf™__


	)

3 
	~"mš.h
"

4 
	~"mš_vec.h
"

5 
	~"ff_md.h
"

6 
	~"©oms_md.h
"

7 
	~"dyÇmic_md.h
"

8 
	~"MAPP.h
"

9 
Çme¥aû
 
	gMAPP_NS


11 şas 
	cMšCGPÙF™
:
public
 
Mš


13 
´iv©e
:

14 
´Ùeùed
:

16 
´•
();

18 
	gVecT’s
<
	gty³0
,1> 
	gh
;

19 
	gVecT’s
<
	gty³0
,1> 
	gx
;

20 
	gVecT’s
<
	gty³0
,1> 
	gx0
;

21 
	gVecT’s
<
	gty³0
,1> 
	gx_d
;

22 
	gVecT’s
<
	gty³0
,1> 
	gf
;

23 
	gVecT’s
<
	gty³0
,1> 
	gf0
;

24 
vec
* 
	gext_vec_0
;

25 
vec
* 
	gext_vec_1
;

26 
ty³0
 
	gS_tmp
[
__dim__
][__dim__];

30 
	gpublic
:

31 
MšCGPÙF™
(
ty³0
,
boŞ
(&)[
__dim__
][__dim__],boŞ,ty³0,
şass
 
LšeS—rch
*,
vec
*,vec*);

32 ~
MšCGPÙF™
();

33 
vœtu®
 
run
();

34 
	g‹m¶©e
<
şass
 
	gC
>

35 
run
(
C
*,);

36 
vœtu®
 
š™
();

37 
vœtu®
 
fš
();

39 
fÜû_ÿlc
();

41 
ty³0
 
F
(type0);

42 
ty³0
 
dF
(type0,type0&);

43 
ls_´•
(
ty³0
&,type0&,type0&);

44 
F_»£t
();

46 
g‘_H_dof
(
boŞ
(&)[
__dim__
][__dim__]);

47 
£t_H_dof
(
boŞ
(&)[
__dim__
][__dim__]);

49 
şass
 
AtomsMD
* 
	g©oms
;

50 
şass
 
FÜûF›ldMD
* 
	gff
;

51 
şass
 
ExpÜtMD
* 
	gx´t
;

52 
şass
 
DyÇmicMD
* 
	gdyÇmic
;

56 
PyObjeù_HEAD


57 
MšCGPÙF™
* 
	gmš
;

58 
	gLšeS—rch
::
Objeù
* 
ls
;

59 
	gExpÜtMD
::
Objeù
* 
x´t
;

60 }
	tObjeù
;

62 
PyTy³Objeù
 
	gTy³Objeù
;

63 
PyObjeù
* 
__Ãw__
(
PyTy³Objeù
*,PyObject*, PyObject*);

64 
__š™__
(
PyObjeù
*, PyObject*,PyObject*);

65 
PyObjeù
* 
__®loc__
(
PyTy³Objeù
*,
Py_ssize_t
);

66 
__d—Îoc__
(
PyObjeù
*);

68 
PyM‘hodDef
 
	gm‘hods
[];

69 
£tup__m‘hods
();

70 
ml_run
(
PyM‘hodDef
&);

72 
PyG‘S‘Def
 
	gg‘£t
[];

73 
£tup__g‘£t
();

74 
g‘£t_expÜt
(
PyG‘S‘Def
&);

76 
£tup_
();

82 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

86 
	g‹m¶©e
<
şass
 
	gC
>

87 
	gMšCGPÙF™
::
	$run
(
C
* 
ls
,
n¡•s
)

89 
¡•
=
©oms
->step;

91 
	`fÜû_ÿlc
();

93 
Ãv”y_x´t
=
x´t
==
NULL
 ? 0:x´t->
Ãv”y
;

94 if(
Ãv”y_x´t
è
x´t
->
	`wr™e
(
¡•
);

98 
ty³0
 
e_´ev
,
e_cu¼
=
©oms
->
³
;

99 
ty³0
 
f0_f0
,
f_f
,
f_f0
;

100 
ty³0
 
¿tio
,
®pha
;

101 
”r
=
n¡•s
==0? 
MIN_F_MAX_ITER
:
LS_S
;

102 
h
=
f
;

103 
f0_f0
=
f
*f;

104 
i¡•
=0;

105 ;
”r
==
LS_S
;
i¡•
++)

107 if(
f0_f0
==0.0)

109 
”r
=
LS_F_GRAD0
;

113 
x0
=
x
;

114 
f0
=
f
;

116 
e_´ev
=
e_cu¼
;

119 
f_h
=
f
*
h
;

120 if(
f_h
<0.0)

122 
h
=
f
;

123 
f_h
=
f0_f0
;

125 
	`´•
();

126 
”r
=
ls
->
	`mš
(
this
,
e_cu¼
,
®pha
,1);

128 if(
”r
!=
LS_S
)

132 
i¡•
--;

136 
	`fÜû_ÿlc
();

138 if(
Ãv”y_x´t
 && (
i¡•
+1)%Ãv”y_x´t==0è
x´t
->
	`wr™e
(
¡•
+istep+1);

140 if(
e_´ev
-
e_cu¼
<
e_tŞ
è
”r
=
MIN_S_TOLERANCE
;

141 if(
i¡•
+1==
n¡•s
è
”r
=
MIN_F_MAX_ITER
;

142 if(
”r
) ;

144 
f_f
=
f
*f;

145 
f_f0
=
f
*
f0
;

147 
¿tio
=(
f_f
-
f_f0
)/(
f0_f0
);

149 
h
=
¿tio
*h+
f
;

150 
f0_f0
=
f_f
;

156 if(
Ãv”y_x´t
 && 
i¡•
%Ãv”y_x´tè
x´t
->
	`wr™e
(
¡•
+istep);

161 
©oms
->
¡•
+=
i¡•
;

162 
	}
}

	@min_l-bfgs.cpp

16 
	~"mš_l-bfgs.h
"

17 
	~<¡dlib.h
>

18 
	~"ff.h
"

19 
	~"th”mo_dyÇmics.h
"

20 
	~"ls.h
"

21 
	~"dyÇmic_md.h
"

22 
	~"memÜy.h
"

23 
	~"©oms_md.h
"

24 
	~"ff_¡yËs.h
"

25 
	~"MAPP.h
"

26 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

30 
	gMšLBFGS
::
MšLBFGS
(
__m
,
ty³0
 
__e_tŞ
,

31 
boŞ
(&
__H_dof
)[
__dim__
][__dim__],boŞ 
__affše
,
ty³0
 
__max_dx
,
LšeS—rch
* 
__ls
):

32 
MšCG
(
__e_tŞ
,
__H_dof
,
__affše
,
__max_dx
,
__ls
),

33 
m
(
__m
),

34 
s
(
NULL
),

35 
y
(
NULL
),

36 
®pha
(
NULL
),

37 
	$rho
(
NULL
)

39 
	}
}

43 
	gMšLBFGS
::~
	$MšLBFGS
()

45 
	}
}

49 
MšLBFGS
::
	$š™
()

51 
x
.~
	`VecT’s
();

52 
	`Ãw
 (&
x
è
VecT’s
<
ty³0
,1>(
©oms
,
chng_box
,©oms->
H
,atoms->x);

53 
f
.~
	`VecT’s
();

54 
	`Ãw
 (&
f
è
VecT’s
<
ty³0
,1>(
©oms
,
chng_box
,
ff
->
F_H
,ff->f);

55 
h
.~
	`VecT’s
();

56 
	`Ãw
 (&
h
è
VecT’s
<
ty³0
,1>(
©oms
,
chng_box
,
__dim__
);

57 
x0
.~
	`VecT’s
();

58 
	`Ãw
 (&
x0
è
VecT’s
<
ty³0
,1>(
©oms
,
chng_box
,
__dim__
);

59 
x_d
.~
	`VecT’s
();

60 
	`Ãw
 (&
x_d
è
VecT’s
<
ty³0
,1>(
©oms
,
chng_box
,
__dim__
);

61 
f0
.~
	`VecT’s
();

62 
	`Ãw
 (&
f0
è
VecT’s
<
ty³0
,1>(
©oms
,
chng_box
,
__dim__
);

64 if(
m
)

66 
s
=
Ãw
 
VecT’s
<
ty³0
,1>[
m
];

67 
y
=
Ãw
 
VecT’s
<
ty³0
,1>[
m
];

68 
i
=0;i<
m
;i++)

70 
s
[
i
].~
	`VecT’s
();

71 
	`Ãw
 (
s
+
i
è
VecT’s
<
ty³0
,1>(
©oms
,
chng_box
,
__dim__
);

72 
y
[
i
].~
	`VecT’s
();

73 
	`Ãw
 (
y
+
i
è
VecT’s
<
ty³0
,1>(
©oms
,
chng_box
,
__dim__
);

77 
dyÇmic
=
Ãw
 
	`DyÇmicMD
(
©oms
,
ff
,
chng_box
,{},{©oms->
x_dof
,
h
.
vecs
[0],
x0
.vecs[0],
f0
.vecs[0]},{©oms->
x_d
});

79 
i
=0;i<
m
;i++)

81 
dyÇmic
->
	`add_xchng
(
s
[
i
].
vecs
[0]);

82 
dyÇmic
->
	`add_xchng
(
y
[
i
].
vecs
[0]);

85 
dyÇmic
->
	`š™
();

87 
MemÜy
::
	`®loc
(
rho
,
m
);

88 
MemÜy
::
	`®loc
(
®pha
,
m
);

90 if(
x´t
)

92 
Œy


94 
x´t
->
©oms
=atoms;

95 
x´t
->
	`š™
();

97 
	`ÿtch
(
¡d
::
¡ršg
& 
”r_msg
)

99 
	`fš
();

100 
throw
 
”r_msg
;

103 
	}
}

107 
	gMšLBFGS
::
	$fš
()

109 if(
x´t
)

111 
x´t
->
	`fš
();

112 
x´t
->
©oms
=
NULL
;

115 
MemÜy
::
	`d—Îoc
(
®pha
);

116 
MemÜy
::
	`d—Îoc
(
rho
);

117 
rho
=
®pha
=
NULL
;

119 
dyÇmic
->
	`fš
();

120 
d–‘e
 
dyÇmic
;

121 
dyÇmic
=
NULL
;

123 
d–‘e
 [] 
s
;

124 
d–‘e
 [] 
y
;

125 
s
=
y
=
NULL
;

127 
f0
.~
	`VecT’s
();

128 
x_d
.~
	`VecT’s
();

129 
x0
.~
	`VecT’s
();

130 
h
.~
	`VecT’s
();

131 
f
.~
	`VecT’s
();

132 
x
.~
	`VecT’s
();

133 
	}
}

137 
	gMšLBFGS
::
	$run
(
n¡•s
)

139 if(
dyÇmic_ÿ¡
<
LšeS—rchGŞd’SeùiÚ
*>(
ls
))

140  
	`run
(
dyÇmic_ÿ¡
<
LšeS—rchGŞd’SeùiÚ
*>(
ls
),
n¡•s
);

142 if(
dyÇmic_ÿ¡
<
LšeS—rchB»Á
*>(
ls
))

143  
	`run
(
dyÇmic_ÿ¡
<
LšeS—rchB»Á
*>(
ls
),
n¡•s
);

145 if(
dyÇmic_ÿ¡
<
LšeS—rchBackT¿ck
*>(
ls
))

146  
	`run
(
dyÇmic_ÿ¡
<
LšeS—rchBackT¿ck
*>(
ls
),
n¡•s
);

147 
	}
}

151 
PyObjeù
* 
	gMšLBFGS
::
	$__Ãw__
(
PyTy³Objeù
* 
ty³
,
PyObjeù
* 
¬gs
,PyObjeù* 
kwds
)

153 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
ty³
->
	`_®loc
(type,0));

154 
PyObjeù
* 
£lf
=
»š‹½»t_ÿ¡
<PyObjeù*>(
__£lf
);

155  
£lf
;

156 
	}
}

160 
	gMšLBFGS
::
	$__š™__
(
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)

163 
FuncAPI
<,
ty³0
,
symm
<
boŞ
[
__dim__
][__dim__]>,boŞ,ty³0,
OP
<
LšeS—rch
>> 
	`f
("__init__",{"m","e_tol","H_dof","affine","max_dx","ls"});

164 
f
.
nİtiÚ®s
=6;

165 
f
.
logics
<0>()[0]=
	`VLogics
("ge",0);

166 
f
.
logics
<1>()[0]=
	`VLogics
("ge",0.0);

167 
f
.
logics
<4>()[0]=
	`VLogics
("gt",0.0);

170 
f
.
v®
<0>()=2;

171 
f
.
v®
<1>()=
	`sq¹
(
¡d
::
num”ic_lim™s
<
ty³0
>::
	`•sÚ
());

172 
i
=0;i<
__dim__
;i++è
j
=0;j<__dim__;j++)
f
.
v®
<2>()[i][j]=
çl£
;

173 
f
.
v®
<3>()=
çl£
;

174 
f
.
v®
<4>()=1.0;

175 
PyObjeù
* 
em±y_tu¶e
=
	`PyTu¶e_New
(0);

176 
PyObjeù
* 
em±y_diù
=
	`PyDiù_New
();

177 
PyObjeù
* 
__ls
=
LšeS—rchBackT¿ck
::
	`__Ãw__
(&LšeS—rchBackT¿ck::
Ty³Objeù
,
em±y_tu¶e
,
em±y_diù
);

178 
LšeS—rchBackT¿ck
::
	`__š™__
(
__ls
,
em±y_tu¶e
,
em±y_diù
);

179 
	`Py_DECREF
(
em±y_diù
);

180 
	`Py_DECREF
(
em±y_tu¶e
);

181 
f
.
v®
<5>().
ob
=
__ls
;

184 if(
	`f
(
¬gs
,
kwds
)==-1)  -1;

188 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

189 
	`Py_INCREF
(
f
.
v®
<5>().
ob
);

190 
__£lf
->
ls
=
»š‹½»t_ÿ¡
<
LšeS—rch
::
Objeù
*>(
f
.
v®
<5>().
ob
);

191 
__£lf
->
mš
=
Ãw
 
	`MšLBFGS
(
f
.
v®
<0>(),f.v®<1>(),f.v®<2>(),f.v®<3>(),f.v®<4>(),&(__£lf->
ls
->ls));

192 
__£lf
->
x´t
=
NULL
;

195 
	}
}

199 
PyObjeù
* 
	gMšLBFGS
::
	$__®loc__
(
PyTy³Objeù
* 
ty³
,
Py_ssize_t
)

201 
Objeù
* 
__£lf
=
Ãw
 Object;

202 
	`Py_TYPE
(
__£lf
)=
ty³
;

203 
	`Py_REFCNT
(
__£lf
)=1;

204 
__£lf
->
mš
=
NULL
;

205 
__£lf
->
ls
=
NULL
;

206 
__£lf
->
x´t
=
NULL
;

207  
»š‹½»t_ÿ¡
<
PyObjeù
*>(
__£lf
);

208 
	}
}

212 
	gMšLBFGS
::
	$__d—Îoc__
(
PyObjeù
* 
£lf
)

214 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

215 
d–‘e
 
__£lf
->
mš
;

216 
__£lf
->
mš
=
NULL
;

217 if(
__£lf
->
ls
è
	`Py_DECREF
(__self->ls);

218 
__£lf
->
ls
=
NULL
;

219 if(
__£lf
->
x´t
è
	`Py_DECREF
(__self->xprt);

220 
__£lf
->
x´t
=
NULL
;

221 
d–‘e
 
__£lf
;

222 
	}
}

224 
PyTy³Objeù
 
	gMšLBFGS
::
Ty³Objeù
 ={
PyObjeù_HEAD_INIT
(
NULL
)};

226 
	gMšLBFGS
::
	$£tup_
()

228 
Ty³Objeù
.
_Çme
="mapp.md.min_lbfgs";

229 
Ty³Objeù
.
_doc
=
R
"---(

230 
	`__š™__
(
m
=2,
e_tŞ
=1.0e-8,
H_dof
=[[
F®£
],[F®£,F®£],[F®£,F®£,F®£]],
affše
=F®£,
max_dx
=1.0,
ls
=
m­p
.
md
.
	`ls_bt
())

232 
L
-
BFGS
 
mšimiz©iÚ
 
®gÜ™hm


234 
P¬am‘”s


236 
m
 : 

237 
Maximum
 
numb”
 
of
 
veùÜs
 
to
 
be
 
¡Üed
 
š
 
memÜy


238 
e_tŞ
 : 

239 
EÃrgy
 
tŞ”ªû
 
ü™”iÚ
 
¡İpšg
 
mšimiz©iÚ


240 
H_dof
 : 
symm
<
boŞ
[
dim
][dim]>

241 
Un™ûÎ
 
deg»es
 
of
 
ä“dom
 
duršg
 
mšimiz©iÚ
, 
h”e
 
dim
 
is
 
the
 
dim’siÚ
 oà
simuÏtiÚ


242 
affše
 : 
boŞ


243 
If
 
£t
 
to
 
True
 
©omic
 
di¥Ïûm’ts
 
would
 
be
 
affše


244 
max_dx
 : 

245 
Maximum
 
di¥Ïûm’t
 
of
 
ªy
 
©om
 
š
 
Úe
 
¡•
 oà
mšimiz©iÚ


246 
ls
 : 
m­p
.ls

247 
Lše
 
£¬ch
 
m‘hod


249 
NÙes


251 
Lim™ed
 
memÜy
 
Broyd’
â€“
FËtch”
â€“
GŞdçrb
â€“
	`Shªno
 (
L
-
BFGS
è
®gÜ™hm
 
mšimiz©iÚ
, 
£e
 :
c™e
:`
noûd®_num”iÿl_2006
`.

253 
Reã»nûs


255 .. 
bibliog¿phy
:: ../
»fs
.
bib


256 :
f‹r
: 
doúame
 
š
 
doúames


257 :
¡yË
: 
un¤t


261 
Ty³Objeù
.
_æags
=
Py_TPFLAGS_DEFAULT
;

262 
Ty³Objeù
.
_basicsize
=(
Objeù
);

264 
Ty³Objeù
.
_Ãw
=
__Ãw__
;

265 
Ty³Objeù
.
_š™
=
__š™__
;

266 
Ty³Objeù
.
_®loc
=
__®loc__
;

267 
Ty³Objeù
.
_d—Îoc
=
__d—Îoc__
;

268 
	`£tup__m‘hods
();

269 
Ty³Objeù
.
_m‘hods
=
m‘hods
;

270 
	`£tup__g‘£t
();

271 
Ty³Objeù
.
_g‘£t
=
g‘£t
;

273 
Ty³Objeù
.
_ba£
=&
MšCG
::TypeObject;

275 
ichk
=
	`PyTy³_R—dy
(&
Ty³Objeù
);

276 if(
ichk
<0)  ichk;

277 
	`Py_INCREF
(&
Ty³Objeù
);

278 
	`GET_WRAPPER_DOC
(
Ty³Objeù
,
__š™__
)=
NULL
;

279  
ichk
;

280 
	}
}

282 
PyM‘hodDef
 
	gMšLBFGS
::
m‘hods
[]=
Em±yPyM‘hodDef
(1);

284 
	gMšLBFGS
::
	$£tup__m‘hods
()

286 
	}
}

288 
PyG‘S‘Def
 
MšLBFGS
::
g‘£t
[]=
Em±yPyG‘S‘Def
(2);

290 
	gMšLBFGS
::
	$£tup__g‘£t
()

292 
	`g‘£t_m
(
g‘£t
[0]);

293 
	}
}

297 
	gMšLBFGS
::
	$g‘£t_m
(
PyG‘S‘Def
& 
g‘£t
)

299 
g‘£t
.
Çme
=(*)"m";

300 
g‘£t
.
doc
=(*)
R
"---(

301 (è
Maximum
 
No
. 
of
 
veùÜs


303 
Maximum
 
numb”
 
of
 
veùÜs
 
to
 
be
 
¡Üed
 
š
 
memÜy


305 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

307  
v¬
<>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
mš
->
m
);

309 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

311 
V¬API
<> 
	`m
("m");

312 
m
.
logics
[0]=
	`VLogics
("ge",0);

313 
ichk
=
m
.
	`£t
(
İ
);

314 if(
ichk
==-1)  -1;

315 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
mš
->
m
=m.
v®
;

318 
	}
}

	@min_l-bfgs.h

1 #iâdeà
__MAPP__mš_l_bfgs_md__


2 
	#__MAPP__mš_l_bfgs_md__


	)

3 
	~"mš_cg.h
"

4 
Çme¥aû
 
	gMAPP_NS


6 şas 
	cMšLBFGS
:
public
 
MšCG


8 
´iv©e
:

9 
´Ùeùed
:

10 
m
;

11 
ty³0
* 
	grho
;

12 
ty³0
* 
	g®pha
;

14 
	gVecT’s
<
	gty³0
,1>* 
	gs
;

15 
	gVecT’s
<
	gty³0
,1>* 
	gy
;

16 
	gpublic
:

17 
MšLBFGS
(,
ty³0
,
boŞ
(&)[
__dim__
][__dim__],boŞ,ty³0,
şass
 
LšeS—rch
*);

18 ~
MšLBFGS
();

19 
run
();

20 
	g‹m¶©e
<
şass
 
	gC
>

21 
run
(
C
*,);

22 
š™
();

23 
fš
();

27 
PyObjeù_HEAD


28 
MšLBFGS
* 
	gmš
;

29 
	gLšeS—rch
::
Objeù
* 
ls
;

30 
	gExpÜtMD
::
Objeù
* 
x´t
;

31 }
	tObjeù
;

33 
PyTy³Objeù
 
	gTy³Objeù
;

34 
PyObjeù
* 
__Ãw__
(
PyTy³Objeù
*,PyObject*, PyObject*);

35 
__š™__
(
PyObjeù
*, PyObject*,PyObject*);

36 
PyObjeù
* 
__®loc__
(
PyTy³Objeù
*,
Py_ssize_t
);

37 
__d—Îoc__
(
PyObjeù
*);

39 
PyM‘hodDef
 
	gm‘hods
[];

40 
£tup__m‘hods
();

42 
PyG‘S‘Def
 
	gg‘£t
[];

43 
£tup__g‘£t
();

44 
g‘£t_m
(
PyG‘S‘Def
&);

46 
£tup_
();

49 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

53 
	g‹m¶©e
<
şass
 
	gC
>

54 
	gMšLBFGS
::
	$run
(
C
* 
ls
,
n¡•s
)

56 
¡•
=
©oms
->step;

58 
	`fÜû_ÿlc
();

60 
Ãv”y_x´t
=
x´t
==
NULL
 ? 0:x´t->
Ãv”y
;

61 if(
Ãv”y_x´t
è
x´t
->
	`wr™e
(
¡•
);

63 
Th”moDyÇmics
 
	`th”mo
(6,

64 "PE",
©oms
->
³
,

65 "S[0][0]",
©oms
->
S_³
[0][0],

66 "S[1][1]",
©oms
->
S_³
[1][1],

67 "S[2][2]",
©oms
->
S_³
[2][2],

68 "S[1][2]",
©oms
->
S_³
[2][1],

69 "S[2][0]",
©oms
->
S_³
[2][0],

70 "S[0][1]",
©oms
->
S_³
[1][0]);

73 if(
Á®ly
è
th”mo
.
	`š™
();

74 if(
Á®ly
è
th”mo
.
	`´št
(
¡•
);

77 
ty³0
 
e_´ev
,
e_cu¼
=
©oms
->
³
;

79 
ty³0
 
®pha_m
,
gamma
;

80 
ty³0
 
šÃr0
,
šÃr1
;

84 
k
=0;

85 
gamma
=1.0;

86 
”r
=
n¡•s
==0? 
MIN_F_MAX_ITER
:
LS_S
;

89 
i¡•
=0;

90 ;
”r
==
LS_S
;
i¡•
++)

92 
x0
=
x
;

93 
h
=
f0
=
f
;

95 
i
=0;i<
k
;i++)

97 
®pha
[
i
]=-
rho
[i]*(
s
[i]*
h
);

98 
h
+=
®pha
[
i
]*
y
[i];

101 
h
*=
gamma
;

103 
i
=
k
-1;i>-1;i--)

104 
h
+=(-
®pha
[
i
]-
rho
[i]*(
y
[i]*h))*
s
[i];

106 
e_´ev
=
e_cu¼
;

109 
f_h
=
f
*
h
;

110 if(
f_h
<0.0)

112 
h
=
f
;

113 
k
=0;

114 
f_h
=
f
*f;

116 
	`´•
();

117 
”r
=
ls
->
	`mš
(
this
,
e_cu¼
,
®pha_m
,0);

119 if(
”r
!=
LS_S
)

123 
i¡•
--;

127 
	`fÜû_ÿlc
();

129 if(
Á®ly
 && (
i¡•
+1)%ntally==0)

130 
th”mo
.
	`´št
(
¡•
+
i¡•
+1);

132 if(
Ãv”y_x´t
 && (
i¡•
+1)%Ãv”y_x´t==0è
x´t
->
	`wr™e
(
¡•
+istep+1);

135 if(
e_´ev
-
e_cu¼
<
e_tŞ
è
”r
=
MIN_S_TOLERANCE
;

136 if(
i¡•
+1==
n¡•s
è
”r
=
MIN_F_MAX_ITER
;

137 if(
”r
) ;

139 if(
m
)

141 if(
k
!=
m
) k++;

143 
s
[0].
	`cyşic_shiá
(
k
);

144 
y
[0].
	`cyşic_shiá
(
k
);

146 
i
=
m
-1;i>0;i--)

147 
rho
[
i
]=rho[i-1];

149 
s
[0]=
x
-
x0
;

150 
y
[0]=
f0
-
f
;

152 
šÃr0
=
s
[0]*
y
[0];

153 
šÃr1
=
y
[0]*y[0];

155 
gamma
=
šÃr0
/
šÃr1
;

156 
rho
[0]=1.0/
šÃr0
;

159 
gamma
=(
x
*
f0
-x*
f
-
x0
*f0+x0*f)/(f*f+f0*f0-2.0*(f*f0));

162 if(
Á®ly
 && 
i¡•
%ntally)

163 
th”mo
.
	`´št
(
¡•
+
i¡•
);

165 if(
Ãv”y_x´t
 && 
i¡•
%Ãv”y_x´tè
x´t
->
	`wr™e
(
¡•
+istep);

167 if(
Á®ly
è
th”mo
.
	`fš
();

169 if(
Á®ly
è
	`årštf
(
MAPP
::
m­p_out
,"%s",
”r_msgs
[
”r
]);

171 
©oms
->
¡•
+=
i¡•
;

172 
	}
}

	@min_l-bfgs_dmd.cpp

1 
	~"mš_l-bfgs_dmd.h
"

2 
	~"memÜy.h
"

3 
	~"dyÇmic_dmd.h
"

4 
	~"th”mo_dyÇmics.h
"

5 
	~"ff_dmd.h
"

6 
	~"MAPP.h
"

7 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

11 
	gMšLBFGSDMD
::
MšLBFGSDMD
(
__m
,
ty³0
 
__e_tŞ
,

12 
boŞ
(&
__H_dof
)[
__dim__
][__dim__],boŞ 
__affše
,
ty³0
 
__max_dx
,ty³0 
__max_d®pha
,
LšeS—rch
* 
__ls
):

13 
MšCGDMD
(
__e_tŞ
,
__H_dof
,
__affše
,
__max_dx
,
__max_d®pha
,
__ls
),

14 
m
(
__m
),

15 
s
(
NULL
),

16 
y
(
NULL
),

17 
®pha
(
NULL
),

18 
	$rho
(
NULL
)

20 
	}
}

24 
	gMšLBFGSDMD
::~
	$MšLBFGSDMD
()

26 
	}
}

30 
MšLBFGSDMD
::
	$š™
()

32 cÚ¡ 
c_dim
=
©oms
->
c
->
dim
;

33 
x
.~
	`VecT’s
();

34 
	`Ãw
 (&
x
è
VecT’s
<
ty³0
,2>(
©oms
,
chng_box
,©oms->
H
,©oms->x,©oms->
®pha
);

35 
f
.~
	`VecT’s
();

36 
	`Ãw
 (&
f
è
VecT’s
<
ty³0
,2>(
©oms
,
chng_box
,
ff
->
F_H
,ff->f,ff->
f_®pha
);

37 
h
.~
	`VecT’s
();

38 
	`Ãw
 (&
h
è
VecT’s
<
ty³0
,2>(
©oms
,
chng_box
,
__dim__
,
c_dim
);

39 
x0
.~
	`VecT’s
();

40 
	`Ãw
 (&
x0
è
VecT’s
<
ty³0
,2>(
©oms
,
chng_box
,
__dim__
,
c_dim
);

41 
x_d
.~
	`VecT’s
();

42 
	`Ãw
 (&
x_d
è
VecT’s
<
ty³0
,2>(
©oms
,
chng_box
,
__dim__
,
c_dim
);

43 
f0
.~
	`VecT’s
();

44 
	`Ãw
 (&
f0
è
VecT’s
<
ty³0
,2>(
©oms
,
chng_box
,
__dim__
,
c_dim
);

45 if(
m
)

47 
s
=
Ãw
 
VecT’s
<
ty³0
,2>[
m
];

48 
y
=
Ãw
 
VecT’s
<
ty³0
,2>[
m
];

49 
i
=0;i<
m
;i++)

51 
s
[
i
].~
	`VecT’s
();

52 
	`Ãw
 (
s
+
i
è
VecT’s
<
ty³0
,2>(
©oms
,
chng_box
,
__dim__
,
c_dim
);

53 
y
[
i
].~
	`VecT’s
();

54 
	`Ãw
 (
y
+
i
è
VecT’s
<
ty³0
,2>(
©oms
,
chng_box
,
__dim__
,
c_dim
);

58 
dyÇmic
=
Ãw
 
	`DyÇmicDMD
(
©oms
,
ff
,
chng_box
,{},

59 {
©oms
->
x_dof
,©oms->
®pha_dof
,©oms->
c_dof
,
h
.
vecs
[0],h.vecs[1],
x0
.vecs[0],x0.vecs[1],
x_d
.vecs[0],x_d.vecs[1],
f0
.vecs[0],f0.vecs[1]},{});

61 
i
=0;i<
m
;i++)

63 
dyÇmic
->
	`add_xchng
(
s
[
i
].
vecs
[0]);

64 
dyÇmic
->
	`add_xchng
(
s
[
i
].
vecs
[1]);

65 
dyÇmic
->
	`add_xchng
(
y
[
i
].
vecs
[0]);

66 
dyÇmic
->
	`add_xchng
(
y
[
i
].
vecs
[1]);

69 
dyÇmic
->
	`š™
();

71 
MemÜy
::
	`®loc
(
rho
,
m
);

72 
MemÜy
::
	`®loc
(
®pha
,
m
);

73 #ifdeà
OLD_UPDATE


74 
uvecs
[0]=
©oms
->
x
;

75 
uvecs
[1]=
©oms
->
®pha
;

78 if(
x´t
)

80 
Œy


82 
x´t
->
©oms
=atoms;

83 
x´t
->
	`š™
();

85 
	`ÿtch
(
¡d
::
¡ršg
& 
”r_msg
)

87 
	`fš
();

88 
throw
 
”r_msg
;

91 
	}
}

95 
	gMšLBFGSDMD
::
	$fš
()

98 if(
x´t
)

100 
x´t
->
	`fš
();

101 
x´t
->
©oms
=
NULL
;

103 #ifdeà
OLD_UPDATE


104 
uvecs
[1]=
NULL
;

105 
uvecs
[0]=
NULL
;

108 
MemÜy
::
	`d—Îoc
(
®pha
);

109 
MemÜy
::
	`d—Îoc
(
rho
);

110 
rho
=
®pha
=
NULL
;

112 
dyÇmic
->
	`fš
();

113 
d–‘e
 
dyÇmic
;

114 
dyÇmic
=
NULL
;

116 
d–‘e
 [] 
s
;

117 
d–‘e
 [] 
y
;

118 
s
=
y
=
NULL
;

120 
f0
.~
	`VecT’s
();

121 
x_d
.~
	`VecT’s
();

122 
x0
.~
	`VecT’s
();

123 
h
.~
	`VecT’s
();

124 
f
.~
	`VecT’s
();

125 
x
.~
	`VecT’s
();

126 
	}
}

130 
	gMšLBFGSDMD
::
	$run
(
n¡•s
)

132 if(
dyÇmic_ÿ¡
<
LšeS—rchGŞd’SeùiÚ
*>(
ls
))

133  
	`run
(
dyÇmic_ÿ¡
<
LšeS—rchGŞd’SeùiÚ
*>(
ls
),
n¡•s
);

135 if(
dyÇmic_ÿ¡
<
LšeS—rchB»Á
*>(
ls
))

136  
	`run
(
dyÇmic_ÿ¡
<
LšeS—rchB»Á
*>(
ls
),
n¡•s
);

138 if(
dyÇmic_ÿ¡
<
LšeS—rchBackT¿ck
*>(
ls
))

139  
	`run
(
dyÇmic_ÿ¡
<
LšeS—rchBackT¿ck
*>(
ls
),
n¡•s
);

140 
	}
}

144 
PyObjeù
* 
	gMšLBFGSDMD
::
	$__Ãw__
(
PyTy³Objeù
* 
ty³
,
PyObjeù
* 
¬gs
,PyObjeù* 
kwds
)

146 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
ty³
->
	`_®loc
(type,0));

147 
PyObjeù
* 
£lf
=
»š‹½»t_ÿ¡
<PyObjeù*>(
__£lf
);

148  
£lf
;

149 
	}
}

153 
	gMšLBFGSDMD
::
	$__š™__
(
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)

155 
FuncAPI
<,
ty³0
,
symm
<
boŞ
[
__dim__
][__dim__]>,boŞ,ty³0,ty³0,
OP
<
LšeS—rch
>> 
	`f
("__init__",{"m","e_tol","H_dof","affine","max_dx","max_dalpha","ls"});

156 
f
.
nİtiÚ®s
=7;

157 
f
.
logics
<0>()[0]=
	`VLogics
("ge",0);

158 
f
.
logics
<1>()[0]=
	`VLogics
("ge",0.0);

159 
f
.
logics
<4>()[0]=
	`VLogics
("gt",0.0);

160 
f
.
logics
<5>()[0]=
	`VLogics
("gt",0.0);

163 
f
.
v®
<0>()=2;

164 
f
.
v®
<1>()=
	`sq¹
(
¡d
::
num”ic_lim™s
<
ty³0
>::
	`•sÚ
());

165 
i
=0;i<
__dim__
;i++è
j
=0;j<__dim__;j++)
f
.
v®
<2>()[i][j]=
çl£
;

166 
f
.
v®
<3>()=
çl£
;

167 
f
.
v®
<4>()=1.0;

168 
f
.
v®
<5>()=0.1;

169 
PyObjeù
* 
em±y_tu¶e
=
	`PyTu¶e_New
(0);

170 
PyObjeù
* 
em±y_diù
=
	`PyDiù_New
();

171 
PyObjeù
* 
__ls
=
LšeS—rchBackT¿ck
::
	`__Ãw__
(&LšeS—rchBackT¿ck::
Ty³Objeù
,
em±y_tu¶e
,
em±y_diù
);

172 
LšeS—rchBackT¿ck
::
	`__š™__
(
__ls
,
em±y_tu¶e
,
em±y_diù
);

173 
	`Py_DECREF
(
em±y_diù
);

174 
	`Py_DECREF
(
em±y_tu¶e
);

175 
f
.
v®
<6>().
ob
=
__ls
;

178 if(
	`f
(
¬gs
,
kwds
)==-1)  -1;

182 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

183 
	`Py_INCREF
(
f
.
v®
<6>().
ob
);

184 
__£lf
->
ls
=
»š‹½»t_ÿ¡
<
LšeS—rch
::
Objeù
*>(
f
.
v®
<6>().
ob
);

185 
__£lf
->
mš
=
Ãw
 
	`MšLBFGSDMD
(
f
.
v®
<0>(),f.v®<1>(),f.v®<2>(),f.v®<3>(),f.v®<4>(),f.v®<5>(),&(__£lf->
ls
->ls));

186 
__£lf
->
x´t
=
NULL
;

189 
	}
}

193 
PyObjeù
* 
	gMšLBFGSDMD
::
	$__®loc__
(
PyTy³Objeù
* 
ty³
,
Py_ssize_t
)

195 
Objeù
* 
__£lf
=
Ãw
 Object;

196 
	`Py_TYPE
(
__£lf
)=
ty³
;

197 
	`Py_REFCNT
(
__£lf
)=1;

198 
__£lf
->
mš
=
NULL
;

199 
__£lf
->
ls
=
NULL
;

200 
__£lf
->
x´t
=
NULL
;

201  
»š‹½»t_ÿ¡
<
PyObjeù
*>(
__£lf
);

202 
	}
}

206 
	gMšLBFGSDMD
::
	$__d—Îoc__
(
PyObjeù
* 
£lf
)

208 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

209 
d–‘e
 
__£lf
->
mš
;

210 
__£lf
->
mš
=
NULL
;

211 if(
__£lf
->
ls
è
	`Py_DECREF
(__self->ls);

212 
__£lf
->
ls
=
NULL
;

213 if(
__£lf
->
x´t
è
	`Py_DECREF
(__self->xprt);

214 
__£lf
->
x´t
=
NULL
;

215 
d–‘e
 
__£lf
;

216 
	}
}

218 
PyTy³Objeù
 
	gMšLBFGSDMD
::
Ty³Objeù
 ={
PyObjeù_HEAD_INIT
(
NULL
)};

220 
	gMšLBFGSDMD
::
	$£tup_
()

222 
Ty³Objeù
.
_Çme
="mapp.dmd.min_lbfgs";

223 
Ty³Objeù
.
_doc
=
R
"---(

224 
	`__š™__
(
m
=2,
e_tŞ
=1.0e-8,
H_dof
=[[
F®£
],[F®£,F®£],[F®£,F®£,F®£]],
affše
=F®£,
max_dx
=1.0,
max_d®pha
=0.1,
ls
=
m­p
.
dmd
.
	`ls_bt
())

226 
L
-
BFGS
 
mšimiz©iÚ
 
®gÜ™hm


228 
P¬am‘”s


230 
m
 : 

231 
Maximum
 
numb”
 
of
 
veùÜs
 
to
 
be
 
¡Üed
 
š
 
memÜy


232 
e_tŞ
 : 

233 
EÃrgy
 
tŞ”ªû
 
ü™”iÚ
 
¡İpšg
 
mšimiz©iÚ


234 
H_dof
 : 
symm
<
boŞ
[
dim
][dim]>

235 
Un™ûÎ
 
deg»es
 
of
 
ä“dom
 
duršg
 
mšimiz©iÚ
, 
h”e
 
dim
 
is
 
the
 
dim’siÚ
 oà
simuÏtiÚ


236 
affše
 : 
boŞ


237 
If
 
£t
 
to
 
True
 
©omic
 
di¥Ïûm’ts
 
would
 
be
 
affše


238 
max_dx
 : 

239 
Maximum
 
di¥Ïûm’t
 
of
 
ªy
 
©om
 
š
 
Úe
 
¡•
 oà
mšimiz©iÚ


240 
max_d®pha
 : 

241 
Maximum
 
chªge
 
š
 
®pha
 
compÚ’t
 
of
 
ªy
 
©om
 iÀ
Úe
 
¡•
 oà
mšimiz©iÚ


242 
ls
 : 
m­p
.ls

243 
Lše
 
£¬ch
 
m‘hod


245 
NÙes


247 
Lim™ed
 
memÜy
 
Broyd’
â€“
FËtch”
â€“
GŞdçrb
â€“
	`Shªno
 (
L
-
BFGS
è
®gÜ™hm
 
mšimiz©iÚ
.

251 
Ty³Objeù
.
_æags
=
Py_TPFLAGS_DEFAULT
;

252 
Ty³Objeù
.
_basicsize
=(
Objeù
);

254 
Ty³Objeù
.
_Ãw
=
__Ãw__
;

255 
Ty³Objeù
.
_š™
=
__š™__
;

256 
Ty³Objeù
.
_®loc
=
__®loc__
;

257 
Ty³Objeù
.
_d—Îoc
=
__d—Îoc__
;

258 
	`£tup__m‘hods
();

259 
Ty³Objeù
.
_m‘hods
=
m‘hods
;

260 
	`£tup__g‘£t
();

261 
Ty³Objeù
.
_g‘£t
=
g‘£t
;

263 
Ty³Objeù
.
_ba£
=&
MšCGDMD
::TypeObject;

265 
ichk
=
	`PyTy³_R—dy
(&
Ty³Objeù
);

266 if(
ichk
<0)  ichk;

267 
	`Py_INCREF
(&
Ty³Objeù
);

268 
	`GET_WRAPPER_DOC
(
Ty³Objeù
,
__š™__
)=
NULL
;

269  
ichk
;

270 
	}
}

272 
PyG‘S‘Def
 
	gMšLBFGSDMD
::
g‘£t
[]=
Em±yPyG‘S‘Def
(2);

274 
	gMšLBFGSDMD
::
	$£tup__g‘£t
()

276 
	`g‘£t_m
(
g‘£t
[0]);

277 
	}
}

279 
PyM‘hodDef
 
	gMšLBFGSDMD
::
m‘hods
[]=
Em±yPyM‘hodDef
(1);

281 
	gMšLBFGSDMD
::
	$£tup__m‘hods
()

283 
	}
}

287 
MšLBFGSDMD
::
	$g‘£t_m
(
PyG‘S‘Def
& 
g‘£t
)

289 
g‘£t
.
Çme
=(*)"m";

290 
g‘£t
.
doc
=(*)
R
"---(

291 (è
Maximum
 
No
. 
of
 
veùÜs


293 
Maximum
 
numb”
 
of
 
veùÜs
 
to
 
be
 
¡Üed
 
š
 
memÜy


296 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

298  
v¬
<>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
mš
->
m
);

300 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
İ
,*)->

302 
V¬API
<> 
	`m
("m");

303 
m
.
logics
[0]=
	`VLogics
("ge",0);

304 
ichk
=
m
.
	`£t
(
İ
);

305 if(
ichk
==-1)  -1;

306 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
mš
->
m
=m.
v®
;

309 
	}
}

	@min_l-bfgs_dmd.h

1 #iâdeà
__MAPP__mš_l_bfgs_dmd__


2 
	#__MAPP__mš_l_bfgs_dmd__


	)

3 
	~"mš_cg_dmd.h
"

4 
Çme¥aû
 
	gMAPP_NS


6 şas 
	cMšLBFGSDMD
:
public
 
MšCGDMD


8 
´iv©e
:

9 
´Ùeùed
:

10 
m
;

11 
ty³0
* 
	grho
;

12 
ty³0
* 
	g®pha
;

14 
	gVecT’s
<
	gty³0
,2>* 
	gs
;

15 
	gVecT’s
<
	gty³0
,2>* 
	gy
;

16 
	gpublic
:

17 
MšLBFGSDMD
(,
ty³0
,
boŞ
(&)[
__dim__
][__dim__],boŞ,ty³0,ty³0,
şass
 
LšeS—rch
*);

18 ~
MšLBFGSDMD
();

19 
run
();

20 
	g‹m¶©e
<
şass
 
	gC
>

21 
run
(
C
*,);

22 
š™
();

23 
fš
();

27 
PyObjeù_HEAD


28 
MšLBFGSDMD
* 
	gmš
;

29 
	gLšeS—rch
::
Objeù
* 
ls
;

30 
	gExpÜtDMD
::
Objeù
* 
x´t
;

31 }
	tObjeù
;

33 
PyTy³Objeù
 
	gTy³Objeù
;

34 
PyObjeù
* 
__Ãw__
(
PyTy³Objeù
*,PyObject*, PyObject*);

35 
__š™__
(
PyObjeù
*, PyObject*,PyObject*);

36 
PyObjeù
* 
__®loc__
(
PyTy³Objeù
*,
Py_ssize_t
);

37 
__d—Îoc__
(
PyObjeù
*);

39 
PyM‘hodDef
 
	gm‘hods
[];

40 
£tup__m‘hods
();

42 
PyG‘S‘Def
 
	gg‘£t
[];

43 
£tup__g‘£t
();

44 
g‘£t_m
(
PyG‘S‘Def
&);

46 
£tup_
();

49 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

53 
	g‹m¶©e
<
şass
 
	gC
>

54 
	gMšLBFGSDMD
::
	$run
(
C
* 
ls
,
n¡•s
)

56 
¡•
=
©oms
->step;

58 
	`fÜû_ÿlc
();

60 
Ãv”y_x´t
=
x´t
==
NULL
 ? 0:x´t->
Ãv”y
;

61 if(
Ãv”y_x´t
è
x´t
->
	`wr™e
(
¡•
);

63 
Th”moDyÇmics
 
	`th”mo
(6,

64 "PE",
©oms
->
ã
,

65 "S[0][0]",
©oms
->
S_ã
[0][0],

66 "S[1][1]",
©oms
->
S_ã
[1][1],

67 "S[2][2]",
©oms
->
S_ã
[2][2],

68 "S[1][2]",
©oms
->
S_ã
[2][1],

69 "S[2][0]",
©oms
->
S_ã
[2][0],

70 "S[0][1]",
©oms
->
S_ã
[1][0]);

73 if(
Á®ly
è
th”mo
.
	`š™
();

74 if(
Á®ly
è
th”mo
.
	`´št
(
¡•
);

77 
ty³0
 
e_´ev
,
e_cu¼
=
©oms
->
ã
;

79 
ty³0
 
®pha_m
,
gamma
;

80 
ty³0
 
šÃr0
,
šÃr1
;

84 
k
=0;

85 
gamma
=1.0;

86 
”r
=
n¡•s
==0? 
MIN_F_MAX_ITER
:
LS_S
;

89 
i¡•
=0;

90 ;
i¡•
<
n¡•s
 && 
”r
==
LS_S
;istep++)

92 
x0
=
x
;

93 
h
=
f0
=
f
;

95 
i
=0;i<
k
;i++)

97 
®pha
[
i
]=-
rho
[i]*(
s
[i]*
h
);

98 
h
+=
®pha
[
i
]*
y
[i];

101 
h
*=
gamma
;

103 
i
=
k
-1;i>-1;i--)

104 
h
+=(-
®pha
[
i
]-
rho
[i]*(
y
[i]*h))*
s
[i];

106 
e_´ev
=
e_cu¼
;

109 
f_h
=
f
*
h
;

110 if(
f_h
<0.0)

112 
h
=
f
;

113 
k
=0;

114 
f_h
=
f
*f;

116 
	`´•
();

117 
”r
=
ls
->
	`mš
(
this
,
e_cu¼
,
®pha_m
,0);

119 if(
”r
!=
LS_S
)

123 
i¡•
--;

127 
	`fÜû_ÿlc
();

129 if(
Á®ly
 && (
i¡•
+1)%ntally==0)

130 
th”mo
.
	`´št
(
¡•
+
i¡•
+1);

132 if(
Ãv”y_x´t
 && (
i¡•
+1)%Ãv”y_x´t==0è
x´t
->
	`wr™e
(
¡•
+istep+1);

135 if(
e_´ev
-
e_cu¼
<
e_tŞ
è
”r
=
MIN_S_TOLERANCE
;

136 if(
i¡•
+1==
n¡•s
è
”r
=
MIN_F_MAX_ITER
;

137 if(
”r
) ;

139 if(
m
)

141 if(
k
!=
m
) k++;

143 
s
[0].
	`cyşic_shiá
(
k
);

144 
y
[0].
	`cyşic_shiá
(
k
);

146 
i
=
m
-1;i>0;i--)

147 
rho
[
i
]=rho[i-1];

149 
s
[0]=
x
-
x0
;

150 
y
[0]=
f0
-
f
;

152 
šÃr0
=
s
[0]*
y
[0];

153 
šÃr1
=
y
[0]*y[0];

155 
gamma
=
šÃr0
/
šÃr1
;

156 
rho
[0]=1.0/
šÃr0
;

159 
gamma
=(
x
*
f0
-x*
f
-
x0
*f0+x0*f)/(f*f+f0*f0-2.0*(f*f0));

162 if(
Á®ly
 && 
i¡•
%ntally)

163 
th”mo
.
	`´št
(
¡•
+
i¡•
);

165 if(
Ãv”y_x´t
 && 
i¡•
%Ãv”y_x´tè
x´t
->
	`wr™e
(
¡•
+istep);

167 if(
Á®ly
è
th”mo
.
	`fš
();

169 if(
Á®ly
è
	`årštf
(
MAPP
::
m­p_out
,"%s",
”r_msgs
[
”r
]);

171 
©oms
->
¡•
+=
i¡•
;

172 
	}
}

	@min_styles.h

1 
	~"mš_cg.h
"

2 
	~"mš_l-bfgs.h
"

3 
	~"mš_cg_dmd.h
"

4 
	~"mš_cg3_dmd.h
"

5 
	~"mš_l-bfgs_dmd.h
"

	@min_vec.h

1 #iâdeà
__MAPP__mš_vec__


2 
	#__MAPP__mš_vec__


	)

3 
	~"©oms.h
"

4 
	~"xm©h.h
"

5 
	~"memÜy.h
"

6 
Çme¥aû
 
	gMAPP_NS


10 
	g‹m¶©e
<
şass
 
	gT
,cÚ¡ 
	gN
,şas 
	gE
>

11 şas 
	cVecT’sEx´


13 
	g´iv©e
:

14 
´Ùeùed
:

15 
public
:

16 
size
(cÚ¡ 
i
) const

17 { 
¡©ic_ÿ¡
<cÚ¡ 
E
&>(*
this
).
size
(
i
);}

18 
	g‹m¶©e
<cÚ¡ 
	gI
>

19 
T
 
	gİ”©Ü
[](
	gi
ècÚ¡ { 
	g¡©ic_ÿ¡
<cÚ¡ 
	gE
&>(*
	gthis
).İ”©Ü[]<
	gI
>(i);}

20 
T
 
İ”©Ü
()(
	gi
,
	gj
)cÚ¡{ 
	g¡©ic_ÿ¡
<cÚ¡ 
	gE
&>(*
	gthis
)(i,j);}

22 
T
 
g‘
(
I
,
i
ècÚ¡ { 
	g¡©ic_ÿ¡
<cÚ¡ 
	gE
&>(*
	gthis
).get(I,i);}

25 
	g‹m¶©e
<
şass
 
	gT
,cÚ¡ 
	gN
>

26 
şass
 
	gVecT’s
:
public
 
VecT’sEx´
<
T
,
	gN
,VecT’s<
	gT
,N>>

28 
	g´iv©e
:

29 
´Ùeùed
:

30 
public
:

31 
Vec
<
T
>* 
vecs
[
N
==0 ? 1:N];

32 
boŞ
 
	gvecs_®loc
[
N
==0 ? 1:N];

34 
T
 (*
A
)[
__dim__
];

35 
boŞ
 
	gA_®loc
;

37 
boŞ
 
	gA_dof
;

38 
VecT’s
();

39 ~
VecT’s
();

40 
	g‹m¶©e
<
	gşass
 ...
	gTs
>

41 
VecT’s
(
Atoms
*,
boŞ
,
Ts
...);

42 
	g‹m¶©e
<
	gşass
 ...
	gTs
>

43 
VecT’s
(
Atoms
*,
boŞ
,
T
(&)[
__dim__
][__dim__],
Ts
...);

46 
VecT’s
(const VecTens&);

47 
VecT’s
(VecTens&&);

48 
	gVecT’s
& 
	gİ”©Ü
=(
VecT’s
&&);

50 
assign
(
Atoms
*,)

55 
	g‹m¶©e
<
	gşass
... 
	gTs
>

56 
assign
(
Atoms
* 
©oms
,
i
,
Vec
<
T
>* 
v
,
Ts
... 
vs
 )

58 
assign
(
©oms
,
i
,
v
);

59 
assign
(
©oms
,
i
+1,
vs
...);

61 
assign
(
Atoms
* 
©oms
,
i
,
Vec
<
T
>* 
v
)

63 
	gvecs
[
i
]=
v
;

64 
	gvecs_®loc
[
i
]=
çl£
;

67 
	g‹m¶©e
<
	gşass
... 
	gTs
>

68 
assign
(
Atoms
* 
©oms
,
i
,
d
,
Ts
... 
vs
)

70 
assign
(
©oms
,
i
,
d
);

71 
assign
(
©oms
,
i
+1,
vs
...);

73 
assign
(
Atoms
* 
©oms
,
i
,
d
)

75 
	gvecs
[
i
]=
Ãw
 
Vec
<
T
>(
©oms
,
	gd
);

76 
	gvecs_®loc
[
i
]=
Œue
;

80 
size
(cÚ¡ 
i
) const

81 {  
	gvecs
[
i
]->
	g©oms
->
Çtms_lş
*vecs[i]->
	gdim
;}

83 
	g‹m¶©e
<cÚ¡ 
	gI
>

84 
	gT
& 
	gİ”©Ü
[](
	gi
){ 
	gvecs
[
I
]->
begš
()[
i
];}

85 
	g‹m¶©e
<cÚ¡ 
	gI
>

86 
T
 
	gİ”©Ü
[](
	gi
)cÚ¡ { 
	gvecs
[
I
]->
begš
()[
i
];}

87 
T
 
İ”©Ü
()(
	gi
,
	gj
)cÚ¡{ 
	gA
[
i
][
j
];}

88 
	gT
& 
İ”©Ü
()(
	gi
,
	gj
){ 
	gA
[
i
][
j
];}

90 
T
 
g‘
(
I
,
i
)cÚ¡{ 
	gvecs
[I]->
begš
()[i];}

91 
	gT
& 
g‘
(
I
,
i
){ 
	gvecs
[I]->
begš
()[i];}

93 
	gVecT’s
& 
	gİ”©Ü
*=(cÚ¡ 
T
&);

94 
cyşic_shiá
();

96 
T
 
	gİ”©Ü
*(cÚ¡ 
	gVecT’s
&);

98 
	g‹m¶©e
<
şass
 
	gE
>

99 
	gVecT’s
& 
	gİ”©Ü
+=(cÚ¡ 
VecT’sEx´
<
T
,
	gN
,
	gE
>&);

100 
	gVecT’s
& 
	gİ”©Ü
+=(cÚ¡ 
VecT’s
&);

101 
	g‹m¶©e
<
şass
 
	gE
>

102 
	gVecT’s
& 
	gİ”©Ü
-=(cÚ¡ 
VecT’sEx´
<
T
,
	gN
,
	gE
>&);

103 
	gVecT’s
& 
	gİ”©Ü
-=(cÚ¡ 
VecT’s
&);

104 
	g‹m¶©e
<
şass
 
	gE
>

105 
	gVecT’s
& 
	gİ”©Ü
=(cÚ¡ 
VecT’sEx´
<
T
,
	gN
,
	gE
>&);

106 
	gVecT’s
& 
	gİ”©Ü
=(cÚ¡ 
VecT’s
&);

110 
	g‹m¶©e
 <
şass
 
	gT
,cÚ¡ 
	gN
,şas 
	gE0
,şas 
	gE1
>

111 
şass
 
	gVecT’sSum
:
public
 
VecT’sEx´
<
T
,
	gN
,VecT’sSum<
	gT
,N,
	gE0
,
	gE1
>>

113 
E0
 cÚ¡& 
	gv0
;

114 
E1
 cÚ¡& 
	gv1
;

115 
	gpublic
:

116 
VecT’sSum
(
E0
 cÚ¡& 
__v0
, 
E1
 cÚ¡& 
__v1
):
v0
(__v0),
v1
(__v1){}

117 
	g‹m¶©e
<cÚ¡ 
	gI
>

118 
T
 
	gİ”©Ü
[](
	gi
)cÚ¡{ 
	gv0
.İ”©Ü[]<
	gI
>(i)+
	gv1
.operator[]<I>(i);}

119 
T
 
g‘
(
I
,
i
ècÚ¡ { 
	gv0
.g‘(I,i)+
	gv1
.get(I,i);}

120 
T
 
İ”©Ü
()(
	gi
,
	gj
)cÚ¡{ 
v0
(
i
,
j
)+
v1
(i,j);}

121 
size
(cÚ¡ 
i
) const

122 { 
	gv0
.
size
(
i
);}

125 
	g‹m¶©e
 <
şass
 
	gT
,cÚ¡ 
	gN
,şas 
	gE0
,şas 
	gE1
>

126 
şass
 
	gVecT’sSub
:
public
 
VecT’sEx´
<
T
,
	gN
,VecT’sSub<
	gT
,N,
	gE0
,
	gE1
>>

128 
E0
 cÚ¡& 
	gv0
;

129 
E1
 cÚ¡& 
	gv1
;

130 
	gpublic
:

131 
VecT’sSub
(
E0
 cÚ¡& 
__v0
, 
E1
 cÚ¡& 
__v1
):
v0
(__v0),
v1
(__v1){}

132 
	g‹m¶©e
<cÚ¡ 
	gI
>

133 
T
 
	gİ”©Ü
[](
	gi
)cÚ¡{ 
	gv0
.İ”©Ü[]<
	gI
>(i)-
	gv1
.operator[]<I>(i);}

134 
T
 
g‘
(
I
,
i
ècÚ¡ { 
	gv0
.g‘(I,i)-
	gv1
.get(I,i);}

135 
T
 
İ”©Ü
()(
	gi
,
	gj
)cÚ¡{ 
v0
(
i
,
j
)-
v1
(i,j);}

136 
size
(cÚ¡ 
i
) const

137 { 
	gv0
.
size
(
i
);}

140 
	g‹m¶©e
 <
şass
 
	gT
,cÚ¡ 
	gN
,şas 
	gE
>

141 
şass
 
	gVecT’sMulSş
:
public
 
VecT’sEx´
<
T
,
	gN
,VecT’sMulSş<
	gT
,N,
	gE
>>

143 
E
 cÚ¡& 
	gv
;

144 
T
 cÚ¡& 
	gsş
;

145 
	gpublic
:

146 
VecT’sMulSş
(
T
 cÚ¡& 
__sş
, 
E
 cÚ¡& 
__v
):
sş
(__sş),
v
(__v){}

147 
	g‹m¶©e
<cÚ¡ 
	gI
>

148 
T
 
	gİ”©Ü
[](
	gi
)cÚ¡{ 
	gv
.İ”©Ü[]<
	gI
>(i)*
	gsş
;}

149 
T
 
g‘
(
I
,
i
ècÚ¡ { 
	gv
.g‘(I,i)*
	gsş
;}

150 
T
 
İ”©Ü
()(
	gi
,
	gj
)cÚ¡{ 
v
(
i
,
j
)*
	gsş
;}

151 
size
(cÚ¡ 
i
) const

152 { 
	gv
.
size
(
i
);}

156 
	g‹m¶©e
<
şass
 
	gT
,cÚ¡ 
	gN
,
	gşass
 ...
	gTs
,‹m¶©e<şass,cÚ¡ ,şass...> cÏs 
	gE
>

157 
	gVecT’sMulSş
<
	gT
,
	gN
,
	gE
<T,N,
	gTs
...>> 
	gİ”©Ü
*(
T
 cÚ¡& 
	gu
,cÚ¡ E<T,N,Ts...>& 
	gv
)

159  
	gVecT’sMulSş
<
	gT
,
	gN
,
	gE
<T,N,
	gTs
...>>(
	gu
, 
	gv
);

162 #ià
	$defšed
(
__ICC
è
	$ªd
 (
__INTEL_COMPILER_BUILD_DATE
 =ğ20171018 
Ü
 __INTEL_COMPILER_BUILD_DATE == 20170811)

163 
‹m¶©e
<
şass
 
T
,cÚ¡ 
N
,‹m¶©e<şass,cÚ¡ > cÏs 
E
>

164 
VecT’sMulSş
<
T
,
N
,
E
<T,N>> 
İ”©Ü
*(T cÚ¡& 
u
,cÚ¡ E<T,N>& 
v
)

166  
VecT’sMulSş
<
T
,
N
,
E
<T,N>>(
u
, 
v
);

167 
	}
}

170 
	g‹m¶©e
<
şass
 
	gT
,cÚ¡ 
	gN
,
	gşass
 ...
	gTs0
,şas ...
	gTs1
,‹m¶©e<şass,cÚ¡ ,şass...> cÏs 
	gE0
,‹m¶©e<şass,cÚ¡ ,şass...> cÏs 
	gE1
>

171 
	gVecT’sSum
<
	gT
,
	gN
,
	gE0
<T,N,
	gTs0
...>,
	gE1
<T,N,
	gTs1
...>> 
	gİ”©Ü
+(cÚ¡ E0<T,N,Ts0...>& 
	gv0
,cÚ¡ E1<T,N,Ts1...>& 
	gv1
)

173  
	gVecT’sSum
<
	gT
,
	gN
,
	gE0
<T,N,
	gTs0
...>,
	gE1
<T,N,
	gTs1
...>>(
	gv0
,
	gv1
);

176 #ià
	$defšed
(
__ICC
è
	$ªd
 (
__INTEL_COMPILER_BUILD_DATE
 =ğ20171018 
Ü
 __INTEL_COMPILER_BUILD_DATE == 20170811)

177 
‹m¶©e
<
şass
 
T
,cÚ¡ 
N
,‹m¶©e<şass,cÚ¡ > cÏs 
E0
,‹m¶©e<şass,cÚ¡ > cÏs 
E1
>

178 
VecT’sSum
<
T
,
N
,
E0
<T,N>,
E1
<T,N>> 
İ”©Ü
+(cÚ¡ E0<T,N>& 
v0
,cÚ¡ E1<T,N>& 
v1
)

180  
VecT’sSum
<
T
,
N
,
E0
<T,N>,
E1
<T,N>>(
v0
,
v1
);

181 
	}
}

183 
	g‹m¶©e
<
şass
 
	gT
,cÚ¡ 
	gN
,
	gşass
 ...
	gTs0
,‹m¶©e<şass,cÚ¡ ,şass...> cÏs 
	gE0
,‹m¶©e<şass,cÚ¡ > cÏs 
	gE1
>

184 
	gVecT’sSum
<
	gT
,
	gN
,
	gE0
<T,N,
	gTs0
...>,
	gE1
<T,N>> 
	gİ”©Ü
+(cÚ¡ E0<T,N,Ts0...>& 
	gv0
,cÚ¡ E1<T,N>& 
	gv1
)

186  
	gVecT’sSum
<
	gT
,
	gN
,
	gE0
<T,N,
	gTs0
...>,
	gE1
<T,N>>(
	gv0
,
	gv1
);

189 
	g‹m¶©e
<
şass
 
	gT
,cÚ¡ 
	gN
,
	gşass
 ...
	gTs1
,‹m¶©e<şass,cÚ¡ > cÏs 
	gE0
,‹m¶©e<şass,cÚ¡ ,şass...> cÏs 
	gE1
>

190 
	gVecT’sSum
<
	gT
,
	gN
,
	gE0
<T,N>,
	gE1
<T,N,
	gTs1
...>> 
	gİ”©Ü
+(cÚ¡ E0<T,N>& 
	gv0
,cÚ¡ E1<T,N,Ts1...>& 
	gv1
)

192  
	gVecT’sSum
<
	gT
,
	gN
,
	gE0
<T,N>,
	gE1
<T,N,
	gTs1
...>>(
	gv0
,
	gv1
);

196 
	g‹m¶©e
<
şass
 
	gT
,cÚ¡ 
	gN
,
	gşass
 ...
	gTs0
,şas ...
	gTs1
,‹m¶©e<şass,cÚ¡ ,şass...> cÏs 
	gE0
,‹m¶©e<şass,cÚ¡ ,şass...> cÏs 
	gE1
>

197 
	gVecT’sSub
<
	gT
,
	gN
,
	gE0
<T,N,
	gTs0
...>,
	gE1
<T,N,
	gTs1
...>> 
	gİ”©Ü
-(cÚ¡ E0<T,N,Ts0...>& 
	gv0
,cÚ¡ E1<T,N,Ts1...>& 
	gv1
)

199  
	gVecT’sSub
<
	gT
,
	gN
,
	gE0
<T,N,
	gTs0
...>,
	gE1
<T,N,
	gTs1
...>>(
	gv0
,
	gv1
);

202 #ià
	$defšed
(
__ICC
è
	$ªd
 (
__INTEL_COMPILER_BUILD_DATE
 =ğ20171018 
Ü
 __INTEL_COMPILER_BUILD_DATE == 20170811)

203 
‹m¶©e
<
şass
 
T
,cÚ¡ 
N
,‹m¶©e<şass,cÚ¡ > cÏs 
E0
,‹m¶©e<şass,cÚ¡ > cÏs 
E1
>

204 
VecT’sSub
<
T
,
N
,
E0
<T,N>,
E1
<T,N>> 
İ”©Ü
-(cÚ¡ E0<T,N>& 
v0
,cÚ¡ E1<T,N>& 
v1
)

206  
VecT’sSub
<
T
,
N
,
E0
<T,N>,
E1
<T,N>>(
v0
,
v1
);

207 
	}
}

209 
	g‹m¶©e
<
şass
 
	gT
,cÚ¡ 
	gN
,
	gşass
 ...
	gTs0
,‹m¶©e<şass,cÚ¡ ,şass...> cÏs 
	gE0
,‹m¶©e<şass,cÚ¡ > cÏs 
	gE1
>

210 
	gVecT’sSub
<
	gT
,
	gN
,
	gE0
<T,N,
	gTs0
...>,
	gE1
<T,N>> 
	gİ”©Ü
-(cÚ¡ E0<T,N,Ts0...>& 
	gv0
,cÚ¡ E1<T,N>& 
	gv1
)

212  
	gVecT’sSub
<
	gT
,
	gN
,
	gE0
<T,N,
	gTs0
...>,
	gE1
<T,N>>(
	gv0
,
	gv1
);

215 
	g‹m¶©e
<
şass
 
	gT
,cÚ¡ 
	gN
,
	gşass
 ...
	gTs1
,‹m¶©e<şass,cÚ¡ > cÏs 
	gE0
,‹m¶©e<şass,cÚ¡ ,şass...> cÏs 
	gE1
>

216 
	gVecT’sSub
<
	gT
,
	gN
,
	gE0
<T,N>,
	gE1
<T,N,
	gTs1
...>> 
	gİ”©Ü
-(cÚ¡ E0<T,N>& 
	gv0
,cÚ¡ E1<T,N,Ts1...>& 
	gv1
)

218  
	gVecT’sSub
<
	gT
,
	gN
,
	gE0
<T,N>,
	gE1
<T,N,
	gTs1
...>>(
	gv0
,
	gv1
);

222 
	g‹m¶©e
<cÚ¡ 
	gN
,cÚ¡ 
	gI
=
N
-1>

223 şas 
	cVecOp


225 
public
:

226 
‹m¶©e
<
şass
 
T
,şas 
E
,şas 
F
>

227 
šlše
 
func
(
VecT’s
<
T
,
N
>& 
v0
,cÚ¡ 
VecT’sEx´
<T,N,
E
>& 
v1
,
F
 
f
)

229 
size
=
v0
.size(
I
);

230 
T
* 
	g__v0
=
v0
.
vecs
[
I
]->
begš
();

231 
	gi
=0;i<
	gsize
;i++)

232 
f
(
__v0
[
i
],
v1
.
g‘
(
I
,i));

234 
	gVecOp
<
	gN
,
	gI
-1>::
func
(
v0
,
v1
,
f
);

237 
	g‹m¶©e
<cÚ¡ 
	gN
>

238 
şass
 
	gVecOp
<
	gN
,0>

240 
	gpublic
:

241 
‹m¶©e
<
şass
 
T
,şas 
	gE
,şas 
	gF
>

242 
šlše
 
func
(
VecT’s
<
T
,
N
>& 
v0
,cÚ¡ 
VecT’sEx´
<T,N,
E
>& 
v1
,
F
 
f
)

244 
	gsize
=
v0
.
size
(0);

245 
T
* 
	g__v0
=
v0
.
vecs
[0]->
begš
();

246 
	gi
=0;i<
	gsize
;i++)

248 
f
(
__v0
[
i
],
v1
.
g‘
(0,i));

252 
	g‹m¶©e
<cÚ¡ 
	gN
>

253 
şass
 
	gVecOp
<
	gN
,-1>

255 
	gpublic
:

256 
‹m¶©e
<
şass
 
T
,şas 
	gE
,şas 
	gF
>

257 
šlše
 
func
(
VecT’s
<
T
,
N
>&,cÚ¡ 
VecT’sEx´
<T,N,
E
>&,
F
)

263 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

267 
	g‹m¶©e
<
ty³Çme
 
	gT
,cÚ¡ 
	gN
>

268 
	gVecT’s
<
	gT
,
	gN
>::
	$VecT’s
():

269 
	`A
(
NULL
),

270 
	$A_®loc
(
çl£
)

272 
Algeb¿
::
Do
<
N
>::
	`func
([
this
](
i
)

273 {
vecs
[
i
]=
NULL
; 
vecs_®loc
[i]=
çl£
;});

274 
	}
}

278 
	g‹m¶©e
<
ty³Çme
 
	gT
,cÚ¡ 
	gN
>

279 
	gVecT’s
<
	gT
,
	gN
>::~
	$VecT’s
()

281 
Algeb¿
::
Do
<
N
>::
	`func
([
this
](
i
)

283 if(
vecs_®loc
[
i
]è
d–‘e
 
vecs
[i];

284 
vecs
[
i
]=
NULL
;

286 if(
A_®loc
è
d–‘e
 [] 
A
;

287 
A_®loc
=
çl£
;

288 
A
=
NULL
;

289 
	}
}

293 
	g‹m¶©e
<
ty³Çme
 
	gT
,cÚ¡ 
	gN
>‹m¶©e<
	gşass
... 
	gTs
>

294 
	gVecT’s
<
	gT
,
	gN
>::
	$VecT’s
(
Atoms
* 
©oms
,
boŞ
 
__A_dof
,
Ts
... 
vs
):

295 
	$A_dof
(
__A_dof
)

297 
	`¡©ic_as£¹
(...(
Ts
)==
N
,"notƒnough vecs");

298 
A_®loc
=
çl£
;

299 if(
__A_dof
)

301 
A
=
Ãw
 
T
[
__dim__
][__dim__];

302 
A_®loc
=
Œue
;

304 
	`assign
(
©oms
,0,
vs
...);

305 
	}
}

309 
	g‹m¶©e
<
ty³Çme
 
	gT
,cÚ¡ 
	gN
>‹m¶©e<
	gşass
... 
	gTs
>

310 
	gVecT’s
<
	gT
,
	gN
>::
VecT’s
(
Atoms
* 
©oms
,
boŞ
 
__A_dof
,
T
(&
__A
)[
__dim__
][__dim__],
Ts
... 
vs
):

311 
A_dof
(
__A_dof
),

312 
A_®loc
(
çl£
),

313 
	$A
(
__A
)

315 
	`¡©ic_as£¹
(...(
Ts
)==
N
,"notƒnough vecs");

316 
	`assign
(
©oms
,0,
vs
...);

317 
	}
}

322 
	g‹m¶©e
<
ty³Çme
 
	gT
,cÚ¡ 
	gN
>

323 
	gVecT’s
<
	gT
,
	gN
>::
VecT’s
(cÚ¡ VecT’s<
T
,
N
>& 
r
):

324 
	$A_dof
(
r
.
A_dof
)

326 
Algeb¿
::
Do
<
N
>::
	`func
([
this
,&
r
](
i
)

328 
vecs_®loc
[
i
]=
Œue
;

329 
vecs
[
i
]=
Ãw
 
Vec
<
T
>(
r
.vecs[i]->
©oms
,r.vecs[i]->
dim
);

330 
	`memıy
(
vecs
[
i
]->
	`begš
(),
r
.vecs[i]->begš(),vecs[i]->
dim
*r.vecs[i]->
©oms
->
Çtms_lş
*(
T
));

332 
A_®loc
=
çl£
;

333 if(
A_dof
)

335 
A_®loc
=
Œue
;

336 
A
=
Ãw
 
T
[
__dim__
][__dim__];

337 
	`memıy
(&
A
[0][0],&
r
.A[0][0],
__dim__
*__dim__*(
T
));

339 
	}
}

343 
	g‹m¶©e
<
ty³Çme
 
	gT
,cÚ¡ 
	gN
>

344 
	gVecT’s
<
	gT
,
	gN
>::
VecT’s
(VecT’s<
T
,
N
>&& 
r
):

345 
	$A_dof
(
r
.
A_dof
)

347 
Algeb¿
::
Do
<
N
>::
	`func
([
this
,&
r
](
i
)

349 
vecs_®loc
[
i
]=
r
.vecs_alloc[i];

350 
r
.
vecs_®loc
[
i
]=
çl£
;

351 
vecs
[
i
]=
r
.vecs[i];

352 
r
.
vecs
[
i
]=
NULL
;

355 
A_®loc
=
r
.A_alloc;

356 
r
.
A_®loc
=
çl£
;

357 
A
=
r
.A;

358 
r
.
A
=
NULL
;

359 
	}
}

363 
	g‹m¶©e
<
ty³Çme
 
	gT
,cÚ¡ 
	gN
>

364 
	gVecT’s
<
	gT
,
	gN
>& VecT’s<T,N>::
İ”©Ü
=(
VecT’s
<
T
,N>&& 
	gr
)

366 
	gA_dof
=
r
.
A_dof
;

367 
	gAlgeb¿
::
Do
<
N
>::
func
([
this
,&
r
](
i
)

369 
vecs_®loc
[
i
]=
r
.vecs_alloc[i];

370 
r
.
vecs_®loc
[
i
]=
çl£
;

371 
vecs
[
i
]=
r
.vecs[i];

372 
r
.
vecs
[
i
]=
NULL
;

375 
	gA_®loc
=
r
.
A_®loc
;

376 
	gr
.
	gA_®loc
=
çl£
;

377 
	gA
=
r
.
A
;

378 
	gr
.
	gA
=
NULL
;

379  *
	gthis
;

384 
	g‹m¶©e
<
ty³Çme
 
	gT
,cÚ¡ 
	gN
>

385 
T
 
	gVecT’s
<
	gT
,
	gN
>::
İ”©Ü
*(cÚ¡ 
VecT’s
<T,N>& 
	gr
)

387 
T
 
	gªs_lş
=0.0;

388 cÚ¡ 
	gÇtms_lş
=
vecs
[0]->
©oms
->
Çtms_lş
;

389 
	gAlgeb¿
::
Do
<
N
>::
func
([
this
,&
ªs_lş
,&
Çtms_lş
,&
r
](
j
)

391 cÚ¡ 
dim
=
vecs
[
j
]->dim;

392 
T
* 
v0
=
vecs
[
j
]->
begš
();

393 
T
* 
v1
=
r
.
vecs
[
j
]->
begš
();

394 
i
=0;i<
Çtms_lş
*
dim
;i++)

395 
ªs_lş
+=
v0
[
i
]*
v1
[i];

398 
T
 
	gªs
;

399 
MPI_AÎ»duû
(&
ªs_lş
,&
ªs
,1,
Vec
<
T
>::
MPI_T
,
MPI_SUM
,
vecs
[0]->
©oms
->
wÜld
);

400 if(
	gA_dof
)

401 
	gAlgeb¿
::
DoLT
<
__dim__
>::
func
([
this
,&
r
,&
ªs
](
i
,
j
){ªs+ñhis->
A
[i][j]*r.A[i][j];});

402  
	gªs
;

407 
	g‹m¶©e
<
ty³Çme
 
	gT
,cÚ¡ 
	gN
>

408 
	gVecT’s
<
	gT
,
	gN
>& VecT’s<T,N>::
İ”©Ü
*=(cÚ¡ 
T
& 
sş
)

411 cÚ¡ 
Çtms_lş
=
vecs
[0]->
©oms
->natms_lcl;

412 
	gAlgeb¿
::
Do
<
N
>::
func
([
this
,&
sş
,&
Çtms_lş
](
j
)

414 cÚ¡ 
dim
=
vecs
[
j
]->dim;

415 
T
* 
v0
=
vecs
[
j
]->
begš
();

416 
i
=0;i<
Çtms_lş
*
dim
;i++)

417 
v0
[
i
]*=
sş
;

421 if(
	gA_dof
)

422 
	gAlgeb¿
::
DoLT
<
__dim__
>::
func
([
this
,&
sş
](
i
,
j
){this->
A
[i][j]*=scl;});

423  *
	gthis
;

428 
	g‹m¶©e
<
ty³Çme
 
	gT
,cÚ¡ 
	gN
>‹m¶©e<
şass
 
	gE
>

429 
	gVecT’s
<
	gT
,
	gN
>& VecT’s<T,N>::
İ”©Ü
+=(cÚ¡ 
VecT’sEx´
<
T
,N,
	gE
>& 
	gex´
)

431 
	gVecOp
<
	gN
>::
func
(*
this
,
ex´
,[](
T
& 
l
,cÚ¡ T& 
r
){l+=r;});

432 if(
	gA_dof
)

433 
	gAlgeb¿
::
DoLT
<
__dim__
>::
func
([
this
,&
ex´
](
i
,
j
){this->
A
[i][j]+=expr(i,j);});

434  *
	gthis
;

439 
	g‹m¶©e
<
ty³Çme
 
	gT
,cÚ¡ 
	gN
>

440 
	gVecT’s
<
	gT
,
	gN
>& VecT’s<T,N>::
İ”©Ü
+=(cÚ¡ 
VecT’s
<
T
,N>& 
	gr
)

442 cÚ¡ 
	gÇtms_lş
=
vecs
[0]->
©oms
->
Çtms_lş
;

443 
	gAlgeb¿
::
Do
<
N
>::
func
([
this
,&
Çtms_lş
,&
r
](
j
)

445 cÚ¡ 
dim
=
vecs
[
j
]->dim;

446 
T
* 
v0
=
vecs
[
j
]->
begš
();

447 cÚ¡ 
T
* 
v1
=
r
.
vecs
[
j
]->
begš
();

448 
i
=0;i<
Çtms_lş
*
dim
;i++)

449 
v0
[
i
]+=
v1
[i];

451 if(
	gA_dof
)

452 
	gAlgeb¿
::
DoLT
<
__dim__
>::
func
([
this
,&
r
](
i
,
j
){this->
A
[i][j]+=r.A[i][j];});

453  *
	gthis
;

458 
	g‹m¶©e
<
ty³Çme
 
	gT
,cÚ¡ 
	gN
>‹m¶©e<
şass
 
	gE
>

459 
	gVecT’s
<
	gT
,
	gN
>& VecT’s<T,N>::
İ”©Ü
-=(cÚ¡ 
VecT’sEx´
<
T
,N,
	gE
>& 
	gex´
)

461 
	gVecOp
<
	gN
>::
func
(*
this
,
ex´
,[](
T
& 
l
,cÚ¡ T& 
r
){l-=r;});

462 if(
	gA_dof
)

463 
	gAlgeb¿
::
DoLT
<
__dim__
>::
func
([
this
,&
ex´
](
i
,
j
){this->
A
[i][j]-=expr(i,j);});

464  *
	gthis
;

469 
	g‹m¶©e
<
ty³Çme
 
	gT
,cÚ¡ 
	gN
>

470 
	gVecT’s
<
	gT
,
	gN
>& VecT’s<T,N>::
İ”©Ü
-=(cÚ¡ 
VecT’s
<
T
,N>& 
	gr
)

472 cÚ¡ 
	gÇtms_lş
=
vecs
[0]->
©oms
->
Çtms_lş
;

473 
	gAlgeb¿
::
Do
<
N
>::
func
([
this
,&
Çtms_lş
,&
r
](
j
)

475 cÚ¡ 
dim
=
vecs
[
j
]->dim;

476 
T
* 
v0
=
vecs
[
j
]->
begš
();

477 cÚ¡ 
T
* 
v1
=
r
.
vecs
[
j
]->
begš
();

478 
i
=0;i<
Çtms_lş
*
dim
;i++)

479 
v0
[
i
]-=
v1
[i];

481 if(
	gA_dof
)

482 
	gAlgeb¿
::
DoLT
<
__dim__
>::
func
([
this
,&
r
](
i
,
j
){this->
A
[i][j]-=r.A[i][j];});

483  *
	gthis
;

488 
	g‹m¶©e
<
ty³Çme
 
	gT
,cÚ¡ 
	gN
>‹m¶©e<
şass
 
	gE
>

489 
	gVecT’s
<
	gT
,
	gN
>& VecT’s<T,N>::
İ”©Ü
=(cÚ¡ 
VecT’sEx´
<
T
,N,
	gE
>& 
	gex´
)

491 
	gVecOp
<
	gN
>::
func
(*
this
,
ex´
,[](
T
& 
l
,cÚ¡ T& 
r
){l=r;});

492 if(
	gA_dof
)

493 
	gAlgeb¿
::
DoLT
<
__dim__
>::
func
([
this
,&
ex´
](
i
,
j
){this->
A
[i][j]=expr(i,j);});

494  *
	gthis
;

499 
	g‹m¶©e
<
ty³Çme
 
	gT
,cÚ¡ 
	gN
>

500 
	gVecT’s
<
	gT
,
	gN
>& VecT’s<T,N>::
İ”©Ü
=(cÚ¡ 
VecT’s
<
T
,N>& 
	gr
)

502 cÚ¡ 
	gÇtms_lş
=
vecs
[0]->
©oms
->
Çtms_lş
;

503 
	gAlgeb¿
::
Do
<
N
>::
func
([
this
,&
Çtms_lş
,&
r
](
j
)

505 cÚ¡ 
dim
=
vecs
[
j
]->dim;

506 
T
* 
v0
=
vecs
[
j
]->
begš
();

507 cÚ¡ 
T
* 
v1
=
r
.
vecs
[
j
]->
begš
();

508 
i
=0;i<
Çtms_lş
*
dim
;i++)

509 
v0
[
i
]=
v1
[i];

511 if(
	gA_dof
)

512 
	gAlgeb¿
::
DoLT
<
__dim__
>::
func
([
this
,&
r
](
i
,
j
){this->
A
[i][j]=r.A[i][j];});

513  *
	gthis
;

518 
	g‹m¶©e
<
ty³Çme
 
	gT
,cÚ¡ 
	gN
>

519 
	gVecT’s
<
	gT
,
	gN
>::
	$cyşic_shiá
(
n
)

521 
Algeb¿
::
Do
<
N
>::
	`func
([
this
,&
n
](
j
)

523 
Vec
<
T
>* 
__v
=(
this
+
n
-1)->
vecs
[
j
];

524 
i
=
n
-1;i>0;i--)

525 (
this
+
i
)->
vecs
[
j
]=(this+i-1)->vecs[j];

527 
this
->
vecs
[
j
]=
__v
;

529 if(
A_dof
)

531 
	`T
(*
__A
)[
__dim__
]=(
this
+
n
-1)->
A
;

532 
i
=
n
-1;i>0;i--)

533 (
this
+
i
)->
A
=(this+i-1)->A;

534 
this
->
A
=
__A
;

536 
	}
}

540 
Çme¥aû
 
	gMAPP_NS


542 
	g‹m¶©e
<
şass
 
	gT
,şas 
	gE
>

543 şas 
	c__VecT’sEx´


545 
	g´iv©e
:

546 
´Ùeùed
:

547 
public
:

548 
E
& 
İ”©Ü
()(){ 
¡©ic_ÿ¡
<E&>(*
this
); }

549 cÚ¡ 
	gE
& 
İ”©Ü
()(ècÚ¡{  
	g¡©ic_ÿ¡
<cÚ¡ E&>(*
	gthis
);}

550 
T
 
	gİ”©Ü
[](
	gi
ècÚ¡ { 
	g¡©ic_ÿ¡
<cÚ¡ 
	gE
&>(*
	gthis
)[
i
];}

551 
T
 
İ”©Ü
()(
	gi
,
	gj
)cÚ¡{ 
	g¡©ic_ÿ¡
<cÚ¡ 
	gE
&>(*
	gthis
)(i,j);}

554 
	g‹m¶©e
<
şass
 
	gT
>

555 
şass
 
	g__VecT’s
: 
public
 
__VecT’sEx´
<
T
,__VecT’s<
	gT
>>

557 
	g´iv©e
:

558 
´Ùeùed
:

559 
public
:

560 
Vec
<
T
>* 
vec
;

561 
T
 (*
A
)[
__dim__
];

562 
boŞ
 
	gA_dof
;

563 
	g®loc_æag
;

565 
__VecT’s
();

566 
__VecT’s
(
Atoms
*,
boŞ
);

567 
__VecT’s
(
Atoms
*,
Vec
<
T
>*&,
boŞ
);

568 
__VecT’s
(
Atoms
*,
Vec
<
T
>*& ,T(&)[
__dim__
][__dim__],
boŞ
);

569 
__VecT’s
(__VecTens&&);

570 
__VecT’s
(const __VecTens&);

571 ~
__VecT’s
();

573 
	gVec
<
	gT
>* 
İ”©Ü
()();

574 
T
 
	gİ”©Ü
*(cÚ¡ 
	g__VecT’s
&);

575 
	g__VecT’s
& 
	gİ”©Ü
*ğ(
T
&);

576 
	g__VecT’s
& 
	gİ”©Ü
=(
__VecT’s
&&);

577 
	g__VecT’s
& 
	gİ”©Ü
=(cÚ¡ 
__VecT’s
&);

578 
	g__VecT’s
& 
	gİ”©Ü
-=(cÚ¡ 
__VecT’s
&);

579 
	g__VecT’s
& 
	gİ”©Ü
+=(cÚ¡ 
__VecT’s
&);

580 
	g‹m¶©e
 <
şass
 
	gE
>

581 
	g__VecT’s
& 
	gİ”©Ü
=(cÚ¡ 
__VecT’sEx´
<
T
,
	gE
>&&);

582 
	g‹m¶©e
 <
şass
 
	gE
>

583 
	g__VecT’s
& 
	gİ”©Ü
-=(cÚ¡ 
__VecT’sEx´
<
T
,
	gE
>&&);

584 
	g‹m¶©e
 <
şass
 
	gE
>

585 
	g__VecT’s
& 
	gİ”©Ü
+=(cÚ¡ 
__VecT’sEx´
<
T
,
	gE
>&&);

586 
T
 
	gİ”©Ü
[](
	gi
ècÚ¡ { 
	gvec
->
begš
()[
i
];}

587 
	gT
& 
	gİ”©Ü
[](
	gi
){ 
	gvec
->
begš
()[
i
];}

588 
T
 
İ”©Ü
()(
	gi
,
	gj
)cÚ¡{ 
	gA
[
i
][
j
];}

589 
	gT
& 
İ”©Ü
()(
	gi
,
	gj
){ 
	gA
[
i
][
j
];}

597 
	g‹m¶©e
 <
şass
 
	gT
,şas 
	gE0
,şas 
	gE1
>

598 
şass
 
	g__VecT’sSum
:
public
 
__VecT’sEx´
<
T
,__VecT’sSum<
	gT
,
	gE0
,
	gE1
>>

600 
E0
 cÚ¡& 
	gv0
;

601 
E1
 cÚ¡& 
	gv1
;

602 
	gpublic
:

603 
__VecT’sSum
(
E0
 cÚ¡& 
__v0
, 
E1
 cÚ¡& 
__v1
):
v0
(__v0),
v1
(__v1)

605 
T
 
	gİ”©Ü
[](
	gi
)cÚ¡{ 
	gv0
[
i
]+
	gv1
[i];}

606 
T
 
İ”©Ü
()(
	gi
,
	gj
)cÚ¡{ 
v0
(
i
,
j
)+
v1
(i,j);}

608 
	g‹m¶©e
 <
şass
 
	gT
,şas 
	gE0
,şas 
	gE1
>

609 
şass
 
	g__VecT’sSub
:
public
 
__VecT’sEx´
<
T
,__VecT’sSub<
	gT
,
	gE0
,
	gE1
>>

611 
E0
 cÚ¡& 
	gv0
;

612 
E1
 cÚ¡& 
	gv1
;

613 
	gpublic
:

614 
__VecT’sSub
(
E0
 cÚ¡& 
__v0
, 
E1
 cÚ¡& 
__v1
):
v0
(__v0),
v1
(__v1)

616 
T
 
	gİ”©Ü
[](
	gi
)cÚ¡{ 
	gv0
[
i
]-
	gv1
[i];}

617 
T
 
İ”©Ü
()(
	gi
,
	gj
)cÚ¡{ 
v0
(
i
,
j
)-
v1
(i,j);}

620 
	g‹m¶©e
 <
şass
 
	gT
,şas 
	gE
>

621 
şass
 
	g__VecT’sMulSş
 : 
public
 
__VecT’sEx´
<
T
,__VecT’sMulSş<
	gT
,
	gE
>>

623 
E
 cÚ¡& 
	gv
;

624 
T
 cÚ¡& 
	gsş
;

625 
	gpublic
:

626 
__VecT’sMulSş
(
T
 cÚ¡& 
__sş
, 
E
 cÚ¡& 
__v
):
sş
(__sş),
v
(__v)

628 
T
 
	gİ”©Ü
[](
	gi
)cÚ¡{ 
sş
*
	gv
[
i
];}

629 
T
 
İ”©Ü
()(
	gi
,
	gj
)cÚ¡{ 
sş
*
v
(
i
,
j
);}

632 
	g‹m¶©e
<
şass
 
	gT
,
	gşass
 ...
	gTs
,‹m¶©e<şass,şass...> cÏs 
	gE
>

633 
	g__VecT’sMulSş
<
	gT
,
	gE
<T,
	gTs
...>> 
	gİ”©Ü
*(
T
 cÚ¡& 
	gu
,cÚ¡ E<T,Ts...>& 
	gv
)

635  
	g__VecT’sMulSş
<
	gT
,
	gE
<T,
	gTs
...>>(
	gu
, 
	gv
);

638 
	g‹m¶©e
<
şass
 
	gT
,
	gşass
 ...
	gTs0
,şas ...
	gTs1
,‹m¶©e<şass,şass...> cÏs 
	gE0
,‹m¶©e<şass,şass...> cÏs 
	gE1
>

639 
	g__VecT’sSum
<
	gT
,
	gE0
<T,
	gTs0
...>,
	gE1
<T,
	gTs1
...>> 
	gİ”©Ü
+(cÚ¡ E0<T,Ts0...>& 
	gv0
,cÚ¡ E1<T,Ts1...>& 
	gv1
)

641  
	g__VecT’sSum
<
	gT
,
	gE0
<T,
	gTs0
...>,
	gE1
<T,
	gTs1
...>>(
	gv0
,
	gv1
);

644 
	g‹m¶©e
<
şass
 
	gT
,
	gşass
 ...
	gTs0
,şas ...
	gTs1
,‹m¶©e<şass,şass...> cÏs 
	gE0
,‹m¶©e<şass,şass...> cÏs 
	gE1
>

645 
	g__VecT’sSub
<
	gT
,
	gE0
<T,
	gTs0
...>,
	gE1
<T,
	gTs1
...>> 
	gİ”©Ü
-(cÚ¡ E0<T,Ts0...>& 
	gv0
,cÚ¡ E1<T,Ts1...>& 
	gv1
)

647  
	g__VecT’sSub
<
	gT
,
	gE0
<T,
	gTs0
...>,
	gE1
<T,
	gTs1
...>>(
	gv0
,
	gv1
);

651 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

655 
	g‹m¶©e
<
ty³Çme
 
	gT
>

656 
	g__VecT’s
<
	gT
>::
	$__VecT’s
():

657 
	`vec
(
NULL
),

658 
	`A
(
NULL
),

659 
	`A_dof
(
çl£
),

660 
	$®loc_æag
(0)

662 
	}
}

666 
	g‹m¶©e
<
ty³Çme
 
	gT
>

667 
	g__VecT’s
<
	gT
>::~
	$__VecT’s
()

669 if(
®loc_æag
 & 1)

670 
d–‘e
 
vec
;

671 if(
®loc_æag
 & 2)

672 
d–‘e
 [] 
A
;

674 
vec
=
NULL
;

675 
A
=
NULL
;

676 
®loc_æag
=0;

677 
	}
}

681 
	g‹m¶©e
<
ty³Çme
 
	gT
>

682 
	g__VecT’s
<
	gT
>::
__VecT’s
(
Atoms
* 
__©oms
,
Vec
<
T
>*& 
__vec
,T(&
__A
)[
__dim__
][__dim__],
boŞ
 
__A_dof
):

683 
vec
(
__vec
),

684 
A
(
__A
),

685 
A_dof
(
__A_dof
),

686 
	$®loc_æag
(0)

688 
	}
}

692 
	g‹m¶©e
<
ty³Çme
 
	gT
>

693 
	g__VecT’s
<
	gT
>::
__VecT’s
(
Atoms
* 
__©oms
,
Vec
<
T
>*& 
__vec
,
boŞ
 
__A_dof
):

694 
vec
(
__vec
),

695 
A
(
__A_dof
?
Ãw
 
T
[
__dim__
][__dim__]:
NULL
),

696 
A_dof
(
__A_dof
),

697 
®loc_æag
(
__A_dof
?2:0)

703 
‹m¶©e
<
ty³Çme
 
T
>

704 
__VecT’s
<
T
>::
	$__VecT’s
(
Atoms
* 
__©oms
,
boŞ
 
__A_dof
):

705 
	`vec
(
Ãw
 
Vec
<
T
>(
__©oms
,__©oms->
x
->
dim
)),

706 
	`A
(
__A_dof
 ? 
Ãw
 
T
[
__dim__
][__dim__]:
NULL
),

707 
	`A_dof
(
__A_dof
),

708 
	`®loc_æag
(
__A_dof
?3:1)

710 
	}
}

714 
‹m¶©e
<
ty³Çme
 
T
>

715 
__VecT’s
<
T
>::
	$__VecT’s
(
__VecT’s
&& 
Ùh”
):

716 
	`vec
(
Ùh”
.
vec
),

717 
	`A_dof
(
Ùh”
.
A_dof
),

718 
	`A
(
Ùh”
.
A
),

719 
	$®loc_æag
(
Ùh”
.
®loc_æag
)

721 
Ùh”
.
A
=
NULL
;

722 
Ùh”
.
vec
=
NULL
;

723 
Ùh”
.
®loc_æag
=0;

724 
	}
}

728 
	g‹m¶©e
<
ty³Çme
 
	gT
>

729 
	g__VecT’s
<
	gT
>::
	$__VecT’s
(cÚ¡ 
__VecT’s
& 
Ùh”
):

730 
	`vec
(
Ùh”
.
vec
),

731 
	`A_dof
(
Ùh”
.
A_dof
),

732 
	`A
(
Ùh”
.
A
),

733 
	$®loc_æag
(
Ùh”
.
®loc_æag
)

735 
	}
}

739 
	g‹m¶©e
<
ty³Çme
 
	gT
>

740 
	gVec
<
	gT
>* 
	g__VecT’s
<T>::
	$İ”©Ü
()()

742  
vec
;

743 
	}
}

747 
	g‹m¶©e
<
ty³Çme
 
	gT
>

748 
T
 
	g__VecT’s
<
	gT
>::
İ”©Ü
*(cÚ¡ 
__VecT’s
<T>& 
rhs
)

750 
T
 
ªs_lş
=0.0,
	gªs
;

751 
T
* 
	gvec0
=
this
->
vec
->
begš
();

752 
T
* 
	gvec1
=
rhs
.
vec
->
begš
();

753 cÚ¡ 
	gn
=
this
->
vec
->
©oms
->
Çtms_lş
*this->vec->
dim
;

754 
	gi
=0;i<
	gn
;i++)

755 
	gªs_lş
+=
vec0
[
i
]*
vec1
[i];

757 
MPI_AÎ»duû
(&
ªs_lş
,&
ªs
,1,
Vec
<
T
>::
MPI_T
,
MPI_SUM
,
this
->
vec
->
©oms
->
wÜld
);

758 if(!
	gA_dof
è 
	gªs
;

759 
	gAlgeb¿
::
DoLT
<
__dim__
>::
func
([
this
,&
rhs
,&
ªs
](
i
,
j
)

760 {
ªs
+=
this
->
A
[
i
][
j
]*
rhs
.A[i][j];});

761  
	gªs
;

766 
	g‹m¶©e
<
ty³Çme
 
	gT
>

767 
	g__VecT’s
<
	gT
>& __VecT’s<T>::
İ”©Ü
*=(
T
& 
a
)

769 
T
* 
vec0
=
this
->
vec
->
begš
();

770 cÚ¡ 
	gn
=
this
->
vec
->
©oms
->
Çtms_lş
*this->vec->
dim
;

771 
	gi
=0;i<
	gn
;i++)

772 
	gvec0
[
i
]*=
a
;

773 if(!
	gA_dof
è *
	gthis
;

774 
	gAlgeb¿
::
DoLT
<
__dim__
>::
func
([
this
,&
a
](
i
,
j
)

775 {
this
->
A
[
i
][
j
]*=
a
;});

776  *
	gthis
;

781 
	g‹m¶©e
<
ty³Çme
 
	gT
>

782 
	g__VecT’s
<
	gT
>& __VecT’s<T>::
İ”©Ü
=(
__VecT’s
&& 
Ùh”
)

784 
this
->
vec
=
Ùh”
.vec;

785 
	gÙh”
.
	gvec
=
NULL
;

786 
	gthis
->
	gA
=
Ùh”
.
A
;

787 
	gÙh”
.
	gA
=
NULL
;

788 
	gthis
->
	g®loc_æag
=
Ùh”
.
®loc_æag
;

789 
	gÙh”
.
	g®loc_æag
=0;

790 
	gthis
->
	gA_dof
=
Ùh”
.
A_dof
;

791 
	gÙh”
.
	gA_dof
=
çl£
;

792  *
	gthis
;

797 
	g‹m¶©e
<
ty³Çme
 
	gT
>

798 
	g__VecT’s
<
	gT
>& __VecT’s<T>::
İ”©Ü
=(cÚ¡ 
__VecT’s
& 
Ùh”
)

800 
memıy
(
this
->
vec
->
begš
(),
Ùh”
.vec->begš(),this->vec->
©oms
->
Çtms_lş
*this->vec->
dim
*(
T
));

801 if(!
	gA_dof
è *
	gthis
;

802 
	gAlgeb¿
::
DoLT
<
__dim__
>::
func
([
this
,&
Ùh”
](
i
,
j
)

803 {
this
->
A
[
i
][
j
]=
Ùh”
.A[i][j];});

804  *
	gthis
;

809 
	g‹m¶©e
<
ty³Çme
 
	gT
>

810 
	g__VecT’s
<
	gT
>& __VecT’s<T>::
İ”©Ü
-=(cÚ¡ 
__VecT’s
& 
Ùh”
)

812 
T
* 
vec0
=
this
->
vec
->
begš
();

813 
T
* 
	gvec1
=
Ùh”
.
vec
->
begš
();

814 cÚ¡ 
	gn
=
this
->
vec
->
©oms
->
Çtms_lş
*this->vec->
dim
;

815 
	gi
=0;i<
	gn
;i++è
	gvec0
[
i
]-=
vec1
[i];

817 if(!
	gA_dof
è *
	gthis
;

818 
T
 (&
__A
)[
__dim__
][__dim__]=
Ùh”
.
vec_‹ns
.
A
;

819 
	gAlgeb¿
::
DoLT
<
__dim__
>::
func
([
this
,
__A
](
i
,
j
)

820 {
this
->
A
[
i
][
j
]-=
__A
[i][j];});

821  *
	gthis
;

826 
	g‹m¶©e
<
ty³Çme
 
	gT
>

827 
	g__VecT’s
<
	gT
>& __VecT’s<T>::
İ”©Ü
+=(cÚ¡ 
__VecT’s
& 
Ùh”
)

829 
T
* 
vec0
=
this
->
vec
->
begš
();

830 
T
* 
	gvec1
=
Ùh”
.
vec
->
begš
();

831 cÚ¡ 
	gn
=
this
->
vec
->
©oms
->
Çtms_lş
*this->vec->
dim
;

832 
	gi
=0;i<
	gn
;i++è
	gvec0
[
i
]+=
vec1
[i];

834 if(!
	gA_dof
è *
	gthis
;

835 
T
 (&
__A
)[
__dim__
][__dim__]=
Ùh”
.
vec_‹ns
.
A
;

836 
	gAlgeb¿
::
DoLT
<
__dim__
>::
func
([
this
,
__A
](
i
,
j
)

837 {
this
->
A
[
i
][
j
]+=
__A
[i][j];});

838  *
	gthis
;

843 
	g‹m¶©e
<
ty³Çme
 
	gT
>‹m¶©e<
şass
 
	gE
>

844 
	g__VecT’s
<
	gT
>& __VecT’s<T>::
İ”©Ü
=(cÚ¡ 
__VecT’sEx´
<
T
,
	gE
>&& 
	gÙh”
)

846 
T
* 
	gvec0
=
this
->
vec
->
begš
();

847 cÚ¡ 
	gn
=
this
->
vec
->
©oms
->
Çtms_lş
*this->vec->
dim
;

848 
	gi
=0;i<
	gn
;i++)

849 
	gvec0
[
i
]=
Ùh”
[i];

850 if(!
	gA_dof
è *
	gthis
;

851 
	gAlgeb¿
::
DoLT
<
__dim__
>::
func
([
this
,&
Ùh”
](
i
,
j
)

852 {
this
->
A
[
i
][
j
]=
Ùh”
(i,j);});

853  *
	gthis
;

858 
	g‹m¶©e
<
ty³Çme
 
	gT
>‹m¶©e<
şass
 
	gE
>

859 
	g__VecT’s
<
	gT
>& __VecT’s<T>::
İ”©Ü
-=(cÚ¡ 
__VecT’sEx´
<
T
,
	gE
>&& 
	gÙh”
)

861 
T
* 
	gvec0
=
this
->
vec
->
begš
();

862 cÚ¡ 
	gn
=
this
->
vec
->
©oms
->
Çtms_lş
*this->vec->
dim
;

863 
	gi
=0;i<
	gn
;i++)

864 
	gvec0
[
i
]-=
Ùh”
[i];

865 if(!
	gA_dof
è *
	gthis
;

866 
	gAlgeb¿
::
DoLT
<
__dim__
>::
func
([
this
,&
Ùh”
](
i
,
j
)

867 {
this
->
A
[
i
][
j
]-=
Ùh”
(i,j);});

868  *
	gthis
;

873 
	g‹m¶©e
<
ty³Çme
 
	gT
>‹m¶©e<
şass
 
	gE
>

874 
	g__VecT’s
<
	gT
>& __VecT’s<T>::
İ”©Ü
+=(cÚ¡ 
__VecT’sEx´
<
T
,
	gE
>&& 
	gÙh”
)

876 
T
* 
	gvec0
=
this
->
vec
->
begš
();

877 cÚ¡ 
	gn
=
this
->
vec
->
©oms
->
Çtms_lş
*this->vec->
dim
;

878 
	gi
=0;i<
	gn
;i++)

879 
	gvec0
[
i
]+=
Ùh”
[i];

880 if(!
	gA_dof
è *
	gthis
;

881 
	gAlgeb¿
::
DoLT
<
__dim__
>::
func
([
this
,&
Ùh”
](
i
,
j
)

882 {
this
->
A
[
i
][
j
]+=
Ùh”
(i,j);});

883  *
	gthis
;

891 
Çme¥aû
 
	gMAPP_NS


893 
	g‹m¶©e
<
şass
 
	gV
>

894 şas 
	c__GMRES__


896 
	g´iv©e
:

897 cÚ¡ 
m
;

898 
	gN
;

899 
V
* 
	gQ
;

900 
ty³0
** 
	gA_h©
;

901 
ty³0
* 
	gAx_h©
;

902 
ty³0
(* 
cos_sš
)[2];

904 
ty³0
* 
	gx_h©
;

907 
ty³0
 
ÿlc
(
V
&,V&);

908 
ty³0
 
ÿlc
(,
V
&,V&);

909 
ty³0
 
sŞve_y
(,
V
&);

911 
V
 
	gRES
;

912 
V
 
	gdx
;

914 
	g´Ùeùed
:

915 
public
:

916 
‹m¶©e
<
şass
 ... 
Cs
>

917 
__GMRES__
(,
Cs
 ...);

918 
	g‹m¶©e
<
	gşass
 ... 
	gCs
>

919 
__GMRES__
(,,
Cs
 ...);

920 ~
__GMRES__
();

921 
	g‹m¶©e
<
şass
 
	gKERNEL
>

922 
boŞ
 
sŞve
(
KERNEL
&,
V
&,
ty³0
,type0&,V&);

923 
	g‹m¶©e
<
şass
 
	gKERNEL
>

924 
boŞ
 
sŞve_»¡¬t
(
KERNEL
&,
V
&,
ty³0
,type0&,V&);

925 
	g™”
;

926 
ty³0
 
	g»s
;

928 
»s_ÿlc
(
V
&);

936 
	g‹m¶©e
<
şass
 
	gV
>‹m¶©e<
	gşass
 ... 
	gCs
>

937 
	g__GMRES__
<
	gV
>::
	$__GMRES__
(
__m
,
Cs
 ... 
cs
):

938 
	`m
(
__m
),

939 
	`»s
(0.0),

940 
	`™”
(0),

941 
	`N
(0),

942 
	`RES
(
cs
...),

943 
	$dx
(
cs
...)

947 
A_h©
=
Ãw
 
ty³0
*[
m
];

948 *
A_h©
=
Ãw
 
ty³0
[
m
*(m+1)/2];

949 
i
=1;i<
m
;i++)

950 
A_h©
[
i
]=A_hat[i-1]+i;

952 
MemÜy
::
	`®loc
(
Ax_h©
,
m
+1);

953 
MemÜy
::
	`®loc
(
cos_sš
,
m
+1);

954 
MemÜy
::
	`®loc
(
x_h©
,
m
+1);

956 
Q
=
Ãw
 
V
[
m
+1];

957 
i
=0;i<
m
+1;i++)

959 
Q
[
i
].~
	`V
();

960 
	`Ãw
 (
Q
+
i
è
	`V
(
cs
...);

964 
	}
}

968 
	g‹m¶©e
<
şass
 
	gV
>‹m¶©e<
	gşass
 ... 
	gCs
>

969 
	g__GMRES__
<
	gV
>::
	$__GMRES__
(
__N
,
__m
,
Cs
 ... 
cs
):

970 
__GMRES__
<
V
>(
__m
,
cs
 ...)

972 
N
=
__N
;

974 
	}
}

978 
	g‹m¶©e
<
şass
 
	gV
>

979 
	g__GMRES__
<
	gV
>::~
	$__GMRES__
()

982 
d–‘e
 [] 
Q
;

984 
MemÜy
::
	`d—Îoc
(
x_h©
);

985 
MemÜy
::
	`d—Îoc
(
cos_sš
);

986 
MemÜy
::
	`d—Îoc
(
Ax_h©
);

987 
d–‘e
 [] *
A_h©
;

988 
d–‘e
 [] 
A_h©
;

989 
	}
}

993 
	g‹m¶©e
<
şass
 
	gV
>

994 
ty³0
 
	g__GMRES__
<
	gV
>::
	$ÿlc
(
V
& 
Ax
,V& 
x
)

996 
ty³0
 
nÜm
=
	`sq¹
(
Ax
*Ax);

997 
ty³0
 
nÜm_šv
=1.0/
nÜm
;

999 
Q
[0]=
x
=
nÜm_šv
*
Ax
;

1001 
Ax_h©
[0]=
nÜm
;

1003  
nÜm
;

1004 
	}
}

1008 
	g‹m¶©e
<
şass
 
	gV
>

1009 
ty³0
 
	g__GMRES__
<
	gV
>::
	$ÿlc
(
™”
,
V
& 
Ax
,V& 
x
)

1011 
ty³0
* 
h
=
A_h©
[
™”
];

1012 
ivec
=
™”
+1;

1015 
i
=0;i<
ivec
;i++)

1016 
h
[
i
]=
Ax
*
Q
[i];

1018 
Q
[
ivec
]=
Ax
;

1020 
i
=0;i<
ivec
;i++)

1021 
Q
[
ivec
]-=
h
[
i
]*Q[i];

1023 
ty³0
 
nÜm
=
	`sq¹
(
Q
[
ivec
]*Q[ivec]);

1024 
ty³0
 
nÜm_šv
=1.0/
nÜm
;

1026 
Q
[
ivec
]*=
nÜm_šv
;

1027 
x
=
Q
[
ivec
];

1029 
ty³0
 
tmp
;

1030 
i
=0;i<
™”
;i++)

1032 
tmp
=
cos_sš
[
i
][0]*
h
[i]-cos_sin[i][1]*h[i+1];

1033 
h
[
i
+1]=
cos_sš
[i][1]*h[i]+cos_sin[i][0]*h[i+1];

1034 
h
[
i
]=
tmp
;

1037 
tmp
=
	`sq¹
(
h
[
™”
]*h[™”]+
nÜm
*norm);

1038 
cos_sš
[
™”
][0]=
h
[™”]/
tmp
;

1039 
cos_sš
[
™”
][1]=-
nÜm
/
tmp
;

1041 
h
[
™”
]=
cos_sš
[™”][0]*h[™”]-cos_sš[™”][1]*
nÜm
;

1042 
Ax_h©
[
™”
+1]=
cos_sš
[iter][1]*Ax_hat[iter];

1043 
Ax_h©
[
™”
]*=
cos_sš
[iter][0];

1045  
	`çbs
(
Ax_h©
[
™”
+1]);

1046 
	}
}

1050 
	g‹m¶©e
<
şass
 
	gV
>

1051 
ty³0
 
	g__GMRES__
<
	gV
>::
	$sŞve_y
(
nvecs
,
V
& 
x
)

1053 
i
=
nvecs
-1;i>-1;i--)

1055 
x_h©
[
i
]=
Ax_h©
[i];

1056 
j
=
i
+1;j<
nvecs
;j++)

1057 
x_h©
[
i
]-=
A_h©
[
j
][i]*x_hat[j];

1058 
x_h©
[
i
]/=
A_h©
[i][i];

1061 
x
=
x_h©
[0]*
Q
[0];

1062 
ivec
=1;ivec<
nvecs
;ivec++)

1063 
x
+=
x_h©
[
ivec
]*
Q
[ivec];

1065 
ty³0
 
nÜm
=0.0;

1066 
ivec
=0;ivec<
nvecs
;ivec++)

1067 
nÜm
+=
x_h©
[
ivec
]*x_hat[ivec];

1069  
	`sq¹
(
nÜm
);

1070 
	}
}

1074 
	g‹m¶©e
<
şass
 
	gV
>‹m¶©e<şas 
	gKERNEL
>

1075 
boŞ
 
	g__GMRES__
<
	gV
>::
	$sŞve
(
KERNEL
& 
A
,
V
& 
b
,
ty³0
 
tŞ
,ty³0& 
nÜm
,V& 
x
)

1077 
»s
=
	`ÿlc
(
b
,
x
);

1078 
™”
=0;™”<
m
;iter++)

1080 
	`A
(
x
,
b
);

1081 
»s
=
	`ÿlc
(
™”
,
b
,
x
);

1082 if(
»s
<
tŞ
)

1084 
nÜm
=
	`sŞve_y
(
™”
+1,
x
);

1085 
™”
++;

1086  
Œue
;

1090 
nÜm
=
	`sŞve_y
(
m
,
x
);

1091  
çl£
;

1092 
	}
}

1096 
	g‹m¶©e
<
şass
 
	gV
>‹m¶©e<şas 
	gKERNEL
>

1097 
boŞ
 
	g__GMRES__
<
	gV
>::
	$sŞve_»¡¬t
(
KERNEL
& 
A
,
V
& 
b
,
ty³0
 
tŞ
,ty³0& 
nÜm
,V& 
x
)

1099 
boŞ
 
cÚv
=
	`sŞve
(
A
,
b
,
tŞ
,
nÜm
,
x
);

1100 if(
cÚv
è 
Œue
;

1101 if(
N
==0è 
çl£
;

1102 !
cÚv
)

1104 
	`»s_ÿlc
(
RES
);

1105 
cÚv
=
	`sŞve
(
A
,
RES
,
tŞ
,
nÜm
,
dx
);

1106 
x
+=
dx
;

1111  
Œue
;

1112 
	}
}

1117 
	g‹m¶©e
<
şass
 
	gV
>

1118 
	g__GMRES__
<
	gV
>::
	$»s_ÿlc
(
V
& 
RES
)

1121 
ty³0
 
»s_nÜm
=
Ax_h©
[
™”
];

1123 
RES
=(
»s_nÜm
*
cos_sš
[
™”
-1][0])*
Q
[iter];

1124 
»s_nÜm
*=
cos_sš
[
™”
-1][1];

1125 
i
=
™”
-1;i>0;i--)

1127 
RES
+=(
»s_nÜm
*
cos_sš
[
i
-1][0])*
Q
[i];

1128 
»s_nÜm
*=
cos_sš
[
i
-1][1];

1131 
RES
+=
»s_nÜm
*
Q
[0];

1136 
	}
}

	@neighbor.cpp

5 
	~"ÃighbÜ.h
"

6 
	~"ff.h
"

7 
	~"memÜy.h
"

8 
	~"comm.h
"

9 
	~"xm©h.h
"

10 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

14 
	gNeighbÜ
::
	$NeighbÜ
(
Atoms
* 
©oms_
):

15 
	`©oms
(
©oms_
),

16 
	`·œ_wi£
(
Œue
),

17 
	`ÃighbÜ_li¡_size
(
NULL
),

18 
	`ÃighbÜ_li¡
(
NULL
),

19 
	$ÃighbÜ_li¡_size_size
(0)

21 
	}
}

25 
	gNeighbÜ
::~
	$NeighbÜ
()

27 
	}
}

31 
NeighbÜ
::
	$´št_¡©s
()

41 
	}
}

	@neighbor.h

1 #iâdeà
__MAPP__ÃighbÜ__


2 
	#__MAPP__ÃighbÜ__


	)

3 
	~"©oms.h
"

4 
	~"xm©h.h
"

5 
	~<¡dio.h
>

6 
Çme¥aû
 
	gMAPP_NS


8 
	g‹m¶©e
<
	gty³Çme
> 
şass
 
	gVec
;

9 
	g‹m¶©e
<cÚ¡ > 
şass
 
	gC–l
;

10 şas 
	cNeighbÜ


12 
	g´iv©e
:

13 
şass
 
Atoms
* 
©oms
;

14 
	g´Ùeùed
:

15 
no_Ãigh_li¡s
;

16 
	gpublic
:

17 
boŞ
 
·œ_wi£
;

18 ** 
	gÃighbÜ_li¡
;

19 * 
	gÃighbÜ_li¡_size
;

20 
	gÃighbÜ_li¡_size_size
;

21 
size_t
 
	gno_·œs
;

24 
	gC–l
<1>* 
	gûÎ
;

26 
NeighbÜ
(
şass
 
Atoms
*);

27 
	gvœtu®
 ~
NeighbÜ
();

30 
´št_¡©s
();

32 
vœtu®
 
m¬k_»dndÁ_ph
(
by‹
*)=0;

33 
vœtu®
 
»Çme_©oms
(*)=0;

	@neighbor_dmd.cpp

5 
	~"ÃighbÜ_dmd.h
"

6 
	~"ff_dmd.h
"

7 
	~"©oms_dmd.h
"

8 
	~"memÜy.h
"

9 
	~"MAPP.h
"

10 
	~"xm©h.h
"

11 
	~"ûÎ.h
"

12 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

16 
	gNeighbÜDMD
::
	$NeighbÜDMD
(
AtomsDMD
* 
__©oms
,

17 
ty³0
**& 
__cut_sk
,ty³0*& 
__rsq_üd
):

18 
	`–em
(
__©oms
->
–em
),

19 
	`cut_sk
(
__cut_sk
),

20 
	`rsq_üd
(
__rsq_üd
),

21 
	`NeighbÜ
(
__©oms
),

22 
	`ÃighbÜ_li¡_2nd
(
NULL
),

23 
	`ÃighbÜ_li¡_size_2nd
(
NULL
),

24 
	`ÃighbÜ_li¡_size_size_2nd
(0),

25 
	`sş
(
__©oms
->
xi
[__©oms->
N
-1]),

26 
	`©oms
(
__©oms
),

27 
	$no_·œs_2nd
(0)

29 
	}
}

33 
	gNeighbÜDMD
::~
	$NeighbÜDMD
()

35 
	}
}

39 
NeighbÜDMD
::
	$m¬k_»dndÁ_ph
(
by‹
* 
m¬k
)

41 cÚ¡ 
c_dim
=
©oms
->c_dim;

42 cÚ¡ 
n
=
c_dim
*
©oms
->
Çtms_lş
;

43 
	`mem£t
(
m¬k
,'0',
©oms
->
Çtms_ph
);

44 
i
=0;i<
ÃighbÜ_li¡_size_size
;i++)

45 
j
=0;j<
ÃighbÜ_li¡_size
[
i
];j++)

46 if(
ÃighbÜ_li¡
[
i
][
j
]>=
n
)

47 
m¬k
[(
ÃighbÜ_li¡
[
i
][
j
]-
n
)/
c_dim
]='1';

48 
	}
}

52 
	gNeighbÜDMD
::
	$»Çme_©oms
(* 
Şd_2_Ãw
)

54 cÚ¡ 
c_dim
=
©oms
->c_dim;

55 
i
=0;i<
ÃighbÜ_li¡_size_size
;i++)

56 
j
=0;j<
ÃighbÜ_li¡_size
[
i
];j++)

57 
ÃighbÜ_li¡
[
i
][
j
]=
Şd_2_Ãw
[ÃighbÜ_li¡[i][j]/
c_dim
]+(neighbor_list[i][j]%c_dim);

58 
	}
}

62 
	gNeighbÜDMD
::
	$š™
()

64 
no_Ãigh_li¡s
=0;

65 
ûÎ
=
Ãw
 
C–l
<1>(
©oms
);

66 
	}
}

70 
	gNeighbÜDMD
::
	$fš
()

72 if(
ÃighbÜ_li¡_size_size
)

74 
i
=0;i<
ÃighbÜ_li¡_size_size
;i++)

75 
d–‘e
 [] 
ÃighbÜ_li¡
[
i
];

76 
d–‘e
 [] 
ÃighbÜ_li¡
;

77 
d–‘e
 [] 
ÃighbÜ_li¡_size
;

79 
ÃighbÜ_li¡_size_size
=0;

80 
ÃighbÜ_li¡
=
NULL
;

81 
ÃighbÜ_li¡_size
=
NULL
;

83 if(
ÃighbÜ_li¡_size_size_2nd
)

85 
i
=0;i<
ÃighbÜ_li¡_size_size_2nd
;i++)

86 if(
ÃighbÜ_li¡_size_2nd
[
i
])

87 
d–‘e
 [] 
ÃighbÜ_li¡_2nd
[
i
];

89 
d–‘e
 [] 
ÃighbÜ_li¡_2nd
;

90 
d–‘e
 [] 
ÃighbÜ_li¡_size_2nd
;

92 
ÃighbÜ_li¡_size_size_2nd
=0;

93 
ÃighbÜ_li¡_2nd
=
NULL
;

94 
ÃighbÜ_li¡_size_2nd
=
NULL
;

96 
d–‘e
 
ûÎ
;

97 
	}
}

102 
	gNeighbÜDMD
::
	$ü—‹_li¡
(
boŞ
 
box_chªge
)

104 
i
=0;i<
ÃighbÜ_li¡_size_size
;i++)

105 
d–‘e
 [] 
ÃighbÜ_li¡
[
i
];

106 
d–‘e
 [] 
ÃighbÜ_li¡
;

107 
d–‘e
 [] 
ÃighbÜ_li¡_size
;

109 cÚ¡ 
c_dim
=
©oms
->c_dim;

110 
ÃighbÜ_li¡_size_size
=
©oms
->
Çtms_lş
*
c_dim
;

112 
MemÜy
::
	`®loc
(
ÃighbÜ_li¡
,
ÃighbÜ_li¡_size_size
);

113 
MemÜy
::
	`®loc
(
ÃighbÜ_li¡_size
,
ÃighbÜ_li¡_size_size
);

114 
i
=0;i<
ÃighbÜ_li¡_size_size
;i++)

115 
ÃighbÜ_li¡_size
[
i
]=0;

118 
–em_ty³
* 
–em_vec
=
–em
->
	`begš
();

119 cÚ¡ 
ty³0
* 
c
=
©oms
->c->
	`begš
();

120 cÚ¡ 
ty³0
* 
x
=
©oms
->x->
	`begš
();

121 cÚ¡ 
ty³0
* 
®pha
=
©oms
->®pha->
	`begš
();

124 ** 
tmp_Ãigh_li¡
;

125 * 
tmp_Ãigh_li¡_sz
;

126 
MemÜy
::
	`®loc
(
tmp_Ãigh_li¡
,
c_dim
,
ÃighbÜ_li¡_size_size
+(
©oms
->
Çtms_ph
)*c_dim);

127 
MemÜy
::
	`®loc
(
tmp_Ãigh_li¡_sz
,
c_dim
);

128 
ic
=0;ic<
c_dim
;ic++è
tmp_Ãigh_li¡_sz
[ic]=0;

130 autØ
¡Üe
=[
this
,&
tmp_Ãigh_li¡_sz
,&
tmp_Ãigh_li¡
,&
c
,&
c_dim
](
i
)->

132 
ic
=0;ic<
c_dim
;ic++)

134 
ÃighbÜ_li¡
[
i
*
c_dim
+
ic
]=
NULL
;

135 if(
tmp_Ãigh_li¡_sz
[
ic
])

137 
ÃighbÜ_li¡
[
i
*
c_dim
+
ic
]=
Ãw
 [
tmp_Ãigh_li¡_sz
[ic]];

138 
	`memıy
(
ÃighbÜ_li¡
[
i
*
c_dim
+
ic
],
tmp_Ãigh_li¡
[ic],
tmp_Ãigh_li¡_sz
[ic]*());

139 
ÃighbÜ_li¡_size
[
i
*
c_dim
+
ic
]=
tmp_Ãigh_li¡_sz
[ic];

140 
no_·œs
+=
tmp_Ãigh_li¡_sz
[
ic
];

141 
tmp_Ãigh_li¡_sz
[
ic
]=0;

146 
no_·œs
=0;

147 if(
·œ_wi£
)

149 
ûÎ
->
	`DO
(
box_chªge
,[](){},

150 [&
tmp_Ãigh_li¡
,&
tmp_Ãigh_li¡_sz
,&
–em_vec
,&
x
,&
®pha
,&
c
,&
c_dim
,
this
](
i
,
j
)

152 if(
i
>=
j
) ;

153 
ty³0
 
r
=
	`sq¹
(
Algeb¿
::
RSQ
<
__dim__
>(
x
+
i
*__dim__,x+
j
*__dim__));

154 
ty³0
 cÚ¡ * 
c_i
=
c
+
i
*
c_dim
;

155 
ty³0
 cÚ¡ * 
c_j
=
c
+
j
*
c_dim
;

156 
ty³0
 cÚ¡ * 
®pha_i
=
®pha
+
i
*
c_dim
;

157 
ty³0
 cÚ¡ * 
®pha_j
=
®pha
+
j
*
c_dim
;

158 cÚ¡ 
–em_ty³
* 
–em_i
=
–em_vec
+
i
*
c_dim
;

159 cÚ¡ 
–em_ty³
* 
–em_j
=
–em_vec
+
j
*
c_dim
;

161 
ic
=0;ic<
c_dim
&& 
c_i
[ic]>=0.0;ic++)

162 
jc
=0;jc<
c_dim
&& 
c_j
[jc]>=0.0;jc++)

163 if(
r
-
sş
*
	`sq¹
(
®pha_i
[
ic
]*®pha_i[ic]+
®pha_j
[
jc
]*®pha_j[jc])<
cut_sk
[
–em_i
[ic]][
–em_j
[jc]])

164 
tmp_Ãigh_li¡
[
ic
][
tmp_Ãigh_li¡_sz
[ic]++]=
j
*
c_dim
+
jc
;

166 },
¡Üe
);

170 
ûÎ
->
	`DO
(
box_chªge
,[](){},

171 [&
tmp_Ãigh_li¡
,&
tmp_Ãigh_li¡_sz
,&
–em_vec
,&
x
,&
®pha
,&
c
,&
c_dim
,
this
](
i
,
j
)

173 if(
i
==
j
) ;

174 
ty³0
 
r
=
	`sq¹
(
Algeb¿
::
RSQ
<
__dim__
>(
x
+
i
*__dim__,x+
j
*__dim__));

175 
ty³0
 cÚ¡ * 
c_i
=
c
+
i
*
c_dim
;

176 
ty³0
 cÚ¡ * 
c_j
=
c
+
j
*
c_dim
;

177 cÚ¡ 
–em_ty³
* 
–em_i
=
–em_vec
+
i
*
c_dim
;

178 cÚ¡ 
–em_ty³
* 
–em_j
=
–em_vec
+
j
*
c_dim
;

180 
ic
=0;ic<
c_dim
&& 
c_i
[ic]>=0.0;ic++)

181 
jc
=0;jc<
c_dim
&& 
c_j
[jc]>=0.0;jc++)

182 if(
r
-
sş
*
	`sq¹
(
®pha
[
ic
]*®pha[ic]+®pha[
jc
]*®pha[jc])<
cut_sk
[
–em_i
[ic]][
–em_j
[jc]])

183 
tmp_Ãigh_li¡
[
ic
][
tmp_Ãigh_li¡_sz
[ic]++]=
j
*
c_dim
+
jc
;

185 },
¡Üe
);

186 
no_·œs
/=2;

190 
MemÜy
::
	`d—Îoc
(
tmp_Ãigh_li¡
);

191 
MemÜy
::
	`d—Îoc
(
tmp_Ãigh_li¡_sz
);

193 
no_Ãigh_li¡s
++;

194 
	}
}

198 
	gNeighbÜDMD
::
	$š™_¡©ic
()

200 
no_·œs_2nd
=0;

201 
	}
}

205 
	gNeighbÜDMD
::
	$fš_¡©ic
()

208 if(
ÃighbÜ_li¡_size_size_2nd
)

210 
i
=0;i<
ÃighbÜ_li¡_size_size_2nd
;i++)

211 
d–‘e
 [] 
ÃighbÜ_li¡_2nd
[
i
];

212 
d–‘e
 [] 
ÃighbÜ_li¡_2nd
;

213 
d–‘e
 [] 
ÃighbÜ_li¡_size_2nd
;

215 
ÃighbÜ_li¡_size_size_2nd
=0;

216 
ÃighbÜ_li¡_2nd
=
NULL
;

217 
ÃighbÜ_li¡_size_2nd
=
NULL
;

218 
no_·œs_2nd
=0;

219 
	}
}

224 
	gNeighbÜDMD
::
	$ü—‹_2nd_li¡
()

227 cÚ¡ 
c_dim
=
©oms
->c_dim;

228 cÚ¡ 
n
=
©oms
->
Çtms_lş
*
c_dim
;

229 if(
ÃighbÜ_li¡_size_size_2nd
)

231 
i
=0;i<
ÃighbÜ_li¡_size_size_2nd
;i++)

232 
d–‘e
 [] 
ÃighbÜ_li¡_2nd
[
i
];

233 
d–‘e
 [] 
ÃighbÜ_li¡_2nd
;

234 
d–‘e
 [] 
ÃighbÜ_li¡_size_2nd
;

236 
ÃighbÜ_li¡_size_size_2nd
=
n
;

237 
MemÜy
::
	`®loc
(
ÃighbÜ_li¡_2nd
,
ÃighbÜ_li¡_size_size_2nd
);

238 
MemÜy
::
	`®loc
(
ÃighbÜ_li¡_size_2nd
,
ÃighbÜ_li¡_size_size_2nd
);

243 cÚ¡ 
ty³0
* 
x
=
©oms
->x->
	`begš
();

244 
–em_ty³
* 
–em_vec
=
–em
->
	`begš
();

245 
–em_ty³
 
–em_i
;

246 
ty³0
 
rsq_üd_›Ëm
;

248 * 
tmp_Ãigh_li¡
=
NULL
;

249 
MemÜy
::
	`®loc
(
tmp_Ãigh_li¡
,
©oms
->
Çtms_lş
+©oms->
Çtms_ph
);

250 
ty³0
 
x_i
[
__dim__
];

251 
no_·œs_2nd
=0;

252 
i
=0;i<
n
;i++)

254 
–em_i
=
–em_vec
[
i
];

255 cÚ¡ 
Ãigh_sz
=
ÃighbÜ_li¡_size
[
i
];

256 
__Ãigh_sz
=0;

257 
Algeb¿
::
V_eq
<
__dim__
>(
x
+(
i
/
c_dim
)*__dim__,
x_i
);

258 
rsq_üd_›Ëm
=
rsq_üd
[
–em_i
];

259 
j
,
__j
=0;__j<
Ãigh_sz
;__j++)

261 
j
=
ÃighbÜ_li¡
[
i
][
__j
];

262 if(
–em_vec
[
j
]!=
–em_i
) ;

263 if(
Algeb¿
::
RSQ
<
__dim__
>(
x_i
,
x
+(
j
/
c_dim
)*__dim__)>=
rsq_üd_›Ëm
) ;

264 
tmp_Ãigh_li¡
[
__Ãigh_sz
++]=
j
;

266 
ÃighbÜ_li¡_2nd
[
i
]=
Ãw
 [
__Ãigh_sz
];

267 
	`memıy
(
ÃighbÜ_li¡_2nd
[
i
],
tmp_Ãigh_li¡
,
__Ãigh_sz
*());

268 
ÃighbÜ_li¡_size_2nd
[
i
]=
__Ãigh_sz
;

269 
no_·œs_2nd
+=
__Ãigh_sz
;

272 
MemÜy
::
	`d—Îoc
(
tmp_Ãigh_li¡
);

273 
	}
}

	@neighbor_dmd.h

1 #iâdeà
__MAPP__ÃighbÜ_dmd__


2 
	#__MAPP__ÃighbÜ_dmd__


	)

3 
	~"ÃighbÜ.h
"

4 
Çme¥aû
 
	gMAPP_NS


6 şas 
	cNeighbÜDMD
:
public
 
NeighbÜ


8 
´iv©e
:

9 
´Ùeùed
:

10 
Vec
<
–em_ty³
>*& 
–em
;

11 
	gty³0
**& 
	gcut_sk
;

12 
	gty³0
*& 
	grsq_üd
;

13 cÚ¡ 
ty³0
 
	gsş
;

14 
şass
 
AtomsDMD
* 
	g©oms
;

15 
	gpublic
:

16 
NeighbÜDMD
(
şass
 
AtomsDMD
*,
ty³0
**&,type0*&);

17 ~
NeighbÜDMD
();

18 #ifdeà
SC_DMD


19 
vœtu®
 
ü—‹_li¡
(
boŞ
);

20 
vœtu®
 
š™
();

21 
vœtu®
 
fš
();

23 
vœtu®
 
ü—‹_2nd_li¡
();

24 
vœtu®
 
š™_¡©ic
();

25 
vœtu®
 
fš_¡©ic
();

27 
vœtu®
 
m¬k_»dndÁ_ph
(
by‹
*);

28 
vœtu®
 
»Çme_©oms
(*);

30 
ü—‹_li¡
(
boŞ
);

31 
š™
();

32 
fš
();

34 
ü—‹_2nd_li¡
();

35 
š™_¡©ic
();

36 
fš_¡©ic
();

38 
vœtu®
 
m¬k_»dndÁ_ph
(
by‹
*);

39 
»Çme_©oms
(*);

41 ** 
	gÃighbÜ_li¡_2nd
;

42 * 
	gÃighbÜ_li¡_size_2nd
;

43 
	gÃighbÜ_li¡_size_size_2nd
;

45 
size_t
 
	gno_·œs_2nd
;

	@neighbor_dmd_sc.cpp

5 
	~"ÃighbÜ_dmd_sc.h
"

6 
	~"ff_dmd.h
"

7 
	~"©oms_dmd.h
"

8 
	~"memÜy.h
"

9 
	~"MAPP.h
"

10 
	~"xm©h.h
"

11 
	~"ûÎ.h
"

12 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

16 
	gNeighbÜDMDSC
::
	$NeighbÜDMDSC
(
AtomsDMD
* 
__©oms
,

17 
ty³0
**& 
__cut_sk
,ty³0*& 
__rsq_üd
):

18 
	$NeighbÜDMD
(
__©oms
,
__cut_sk
,
__rsq_üd
)

20 
	}
}

24 
	gNeighbÜDMDSC
::~
	$NeighbÜDMDSC
()

26 
	}
}

30 
NeighbÜDMDSC
::
	$m¬k_»dndÁ_ph
(
by‹
* 
m¬k
)

32 
Çtms_lş
=
©oms
->natms_lcl;

33 
Çtms_ph
=
©oms
->natms_ph;

34 
	`mem£t
(
m¬k
,'0',
Çtms_ph
);

35 
Ÿtm
=0;Ÿtm<
ÃighbÜ_li¡_size_size
;iatm++)

36 
j
=0;j<
ÃighbÜ_li¡_size
[
Ÿtm
];j++)

37 if(
ÃighbÜ_li¡
[
Ÿtm
][
j
]>=
Çtms_lş
)

38 
m¬k
[
ÃighbÜ_li¡
[
Ÿtm
][
j
]-
Çtms_lş
]='1';

39 
	}
}

43 
	gNeighbÜDMDSC
::
	$»Çme_©oms
(* 
Şd_2_Ãw
)

45 
Ÿtm
=0;Ÿtm<
ÃighbÜ_li¡_size_size
;iatm++)

46 
j
=0;j<
ÃighbÜ_li¡_size
[
Ÿtm
];j++)

47 
ÃighbÜ_li¡
[
Ÿtm
][
j
]=
Şd_2_Ãw
[neighbor_list[iatm][j]];

48 
	}
}

52 
	gNeighbÜDMDSC
::
	$š™
()

54 
no_Ãigh_li¡s
=0;

55 
ûÎ
=
Ãw
 
C–l
<1>(
©oms
);

56 
	}
}

60 
	gNeighbÜDMDSC
::
	$fš
()

62 if(
ÃighbÜ_li¡_size_size
)

64 
i
=0;i<
ÃighbÜ_li¡_size_size
;i++)

65 
d–‘e
 [] 
ÃighbÜ_li¡
[
i
];

66 
d–‘e
 [] 
ÃighbÜ_li¡
;

67 
d–‘e
 [] 
ÃighbÜ_li¡_size
;

69 
ÃighbÜ_li¡_size_size
=0;

70 
ÃighbÜ_li¡
=
NULL
;

71 
ÃighbÜ_li¡_size
=
NULL
;

73 
d–‘e
 
ûÎ
;

74 
	}
}

79 
	gNeighbÜDMDSC
::
	$ü—‹_li¡
(
boŞ
 
box_chªge
)

81 
i
=0;i<
ÃighbÜ_li¡_size_size
;i++)

82 
d–‘e
 [] 
ÃighbÜ_li¡
[
i
];

83 
d–‘e
 [] 
ÃighbÜ_li¡
;

84 
d–‘e
 [] 
ÃighbÜ_li¡_size
;

86 cÚ¡ 
c_dim
=
©oms
->c_dim;

87 
ÃighbÜ_li¡_size_size
=
©oms
->
Çtms_lş
;

89 
MemÜy
::
	`®loc
(
ÃighbÜ_li¡
,
ÃighbÜ_li¡_size_size
);

90 
MemÜy
::
	`®loc
(
ÃighbÜ_li¡_size
,
ÃighbÜ_li¡_size_size
);

91 
i
=0;i<
ÃighbÜ_li¡_size_size
;i++)

92 
ÃighbÜ_li¡_size
[
i
]=0;

95 
–em_ty³
* 
–em_vec
=
–em
->
	`begš
();

96 cÚ¡ 
ty³0
* 
c
=
©oms
->c->
	`begš
();

97 cÚ¡ 
ty³0
* 
x
=
©oms
->x->
	`begš
();

98 cÚ¡ 
ty³0
* 
®pha
=
©oms
->®pha->
	`begš
();

99 
ty³0
 
max_cut
=
©oms
->max_cut;

101 * 
tmp_Ãigh_li¡
;

102 
tmp_Ãigh_li¡_sz
=0;

103 
MemÜy
::
	`®loc
(
tmp_Ãigh_li¡
,
ÃighbÜ_li¡_size_size
+(
©oms
->
Çtms_ph
));

105 autØ
¡Üe
=[
this
,&
tmp_Ãigh_li¡_sz
,&
tmp_Ãigh_li¡
,&
c
,&
c_dim
](
i
)->

107 
ÃighbÜ_li¡
[
i
]=
NULL
;

108 if(
tmp_Ãigh_li¡_sz
)

110 
ÃighbÜ_li¡
[
i
]=
Ãw
 [
tmp_Ãigh_li¡_sz
];

111 
	`memıy
(
ÃighbÜ_li¡
[
i
],
tmp_Ãigh_li¡
,
tmp_Ãigh_li¡_sz
*());

112 
ÃighbÜ_li¡_size
[
i
]=
tmp_Ãigh_li¡_sz
;

113 
no_·œs
+=
tmp_Ãigh_li¡_sz
;

114 
tmp_Ãigh_li¡_sz
=0;

118 
no_·œs
=0;

119 if(
·œ_wi£
)

121 
ty³0
 
max_®pha_i
=0.0;

122 
ûÎ
->
	`DO
(
box_chªge
,[&
max_®pha_i
,
this
,&
c_dim
,&
c
,&
®pha
](
i
)

124 
ty³0
 cÚ¡ * 
c_i
=
c
+
i
*
c_dim
;

125 
ty³0
 cÚ¡ * 
®pha_i
=
®pha
+
i
*
c_dim
;

126 
ic
=0;ic<
c_dim
&& 
c_i
[ic]>=0.0;ic++)

127 
max_®pha_i
=
	`MAX
(max_®pha_i,
®pha_i
[
ic
]);

131 [&
tmp_Ãigh_li¡
,&
tmp_Ãigh_li¡_sz
,&
–em_vec
,&
x
,&
®pha
,&
c
,&
c_dim
,&
max_®pha_i
,&
max_cut
,
this
](
i
,
j
)

133 if(
i
>=
j
) ;

134 
ty³0
 
r
=
	`sq¹
(
Algeb¿
::
RSQ
<
__dim__
>(
x
+
i
*__dim__,x+
j
*__dim__));

135 
ty³0
 cÚ¡ * 
c_j
=
c
+
j
*
c_dim
;

136 
ty³0
 cÚ¡ * 
®pha_j
=
®pha
+
j
*
c_dim
;

138 
ty³0
 
max_®pha_j
=0.0;

139 
jc
=0;jc<
c_dim
&& 
c_j
[jc]>=0.0;jc++)

140 
max_®pha_j
=
	`MAX
(max_®pha_j,
®pha_j
[
jc
]);

141 if(
r
-
sş
*
	`sq¹
(
max_®pha_i
*max_®pha_i+
max_®pha_j
*max_®pha_j)<
max_cut
)

142 
tmp_Ãigh_li¡
[
tmp_Ãigh_li¡_sz
++]=
j
;

146 },
¡Üe
);

150 
ty³0
 
max_®pha_i
=0.0;

151 
ûÎ
->
	`DO
(
box_chªge
,[&
max_®pha_i
,
this
,&
c_dim
,&
c
,&
®pha
](
i
)

153 
ty³0
 cÚ¡ * 
c_i
=
c
+
i
*
c_dim
;

154 
ty³0
 cÚ¡ * 
®pha_i
=
®pha
+
i
*
c_dim
;

155 
ic
=0;ic<
c_dim
&& 
c_i
[ic]>=0.0;ic++)

156 
max_®pha_i
=
	`MAX
(max_®pha_i,
®pha_i
[
ic
]);

160 [&
tmp_Ãigh_li¡
,&
tmp_Ãigh_li¡_sz
,&
–em_vec
,&
x
,&
®pha
,&
c
,&
c_dim
,&
max_®pha_i
,&
max_cut
,
this
](
i
,
j
)

162 if(
i
==
j
) ;

163 
ty³0
 
r
=
	`sq¹
(
Algeb¿
::
RSQ
<
__dim__
>(
x
+
i
*__dim__,x+
j
*__dim__));

164 
ty³0
 cÚ¡ * 
c_j
=
c
+
j
*
c_dim
;

165 
ty³0
 cÚ¡ * 
®pha_j
=
®pha
+
j
*
c_dim
;

167 
ty³0
 
max_®pha_j
=0.0;

168 
jc
=0;jc<
c_dim
&& 
c_j
[jc]>=0.0;jc++)

169 
max_®pha_j
=
	`MAX
(max_®pha_j,
®pha_j
[
jc
]);

170 if(
r
-
sş
*
	`sq¹
(
max_®pha_i
*max_®pha_i+
max_®pha_j
*max_®pha_j)<
max_cut
)

171 
tmp_Ãigh_li¡
[
tmp_Ãigh_li¡_sz
++]=
j
;

175 },
¡Üe
);

176 
no_·œs
/=2;

180 
MemÜy
::
	`d—Îoc
(
tmp_Ãigh_li¡
);

182 
no_Ãigh_li¡s
++;

183 
	}
}

	@neighbor_dmd_sc.h

1 #iâdeà
__MAPP__ÃighbÜ_dmd_sc__


2 
	#__MAPP__ÃighbÜ_dmd_sc__


	)

3 
	~"ÃighbÜ_dmd.h
"

4 
Çme¥aû
 
	gMAPP_NS


6 şas 
	cNeighbÜDMDSC
:
public
 
NeighbÜDMD


8 
´iv©e
:

9 
´Ùeùed
:

10 
public
:

11 
NeighbÜDMDSC
(
şass
 
AtomsDMD
*,
ty³0
**&,type0*&);

12 ~
NeighbÜDMDSC
();

14 
ü—‹_li¡
(
boŞ
);

15 
š™
();

16 
fš
();

18 
ü—‹_2nd_li¡
(){};

19 
š™_¡©ic
(){};

20 
fš_¡©ic
(){};

22 
m¬k_»dndÁ_ph
(
by‹
*);

23 
»Çme_©oms
(*);

	@neighbor_md.cpp

5 
	~"ÃighbÜ_md.h
"

6 
	~"ff_md.h
"

7 
	~"©oms_md.h
"

8 
	~"memÜy.h
"

9 
	~"MAPP.h
"

10 
	~"xm©h.h
"

11 
	~"ûÎ.h
"

12 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

16 
	gNeighbÜMD
::
	$NeighbÜMD
(
AtomsMD
* 
__©oms
,

17 
ty³0
**& 
__cut_sk_sq
):

18 
	`NeighbÜ
(
__©oms
),

19 
	`©oms
(
__©oms
),

20 
	`–em
(
__©oms
->
–em
),

21 
	$cut_sk_sq
(
__cut_sk_sq
)

23 
	}
}

27 
	gNeighbÜMD
::~
	$NeighbÜMD
()

29 
	}
}

33 
NeighbÜMD
::
	$m¬k_»dndÁ_ph
(
by‹
* 
m¬k
)

35 
Çtms_lş
=
©oms
->natms_lcl;

36 
Çtms_ph
=
©oms
->natms_ph;

37 
	`mem£t
(
m¬k
,'0',
Çtms_ph
);

38 
Ÿtm
=0;Ÿtm<
ÃighbÜ_li¡_size_size
;iatm++)

39 
j
=0;j<
ÃighbÜ_li¡_size
[
Ÿtm
];j++)

40 if(
ÃighbÜ_li¡
[
Ÿtm
][
j
]>=
Çtms_lş
)

41 
m¬k
[
ÃighbÜ_li¡
[
Ÿtm
][
j
]-
Çtms_lş
]='1';

42 
	}
}

46 
	gNeighbÜMD
::
	$»Çme_©oms
(* 
Şd_2_Ãw
)

48 
Ÿtm
=0;Ÿtm<
ÃighbÜ_li¡_size_size
;iatm++)

49 
j
=0;j<
ÃighbÜ_li¡_size
[
Ÿtm
];j++)

50 
ÃighbÜ_li¡
[
Ÿtm
][
j
]=
Şd_2_Ãw
[neighbor_list[iatm][j]];

51 
	}
}

55 
	gNeighbÜMD
::
	$š™
()

57 
no_Ãigh_li¡s
=0;

58 
ûÎ
=
Ãw
 
C–l
<1>(
©oms
);

59 
	}
}

63 
	gNeighbÜMD
::
	$fš
()

65 if(
ÃighbÜ_li¡_size_size
)

67 
i
=0;i<
ÃighbÜ_li¡_size_size
;i++)

68 
d–‘e
 [] 
ÃighbÜ_li¡
[
i
];

69 
d–‘e
 [] 
ÃighbÜ_li¡
;

70 
d–‘e
 [] 
ÃighbÜ_li¡_size
;

72 
ÃighbÜ_li¡_size_size
=0;

73 
ÃighbÜ_li¡
=
NULL
;

74 
ÃighbÜ_li¡_size
=
NULL
;

76 
d–‘e
 
ûÎ
;

77 
	}
}

82 
	gNeighbÜMD
::
	$ü—‹_li¡
(
boŞ
 
box_chªge
)

85 
i
=0;i<
ÃighbÜ_li¡_size_size
;i++)

86 
d–‘e
 [] 
ÃighbÜ_li¡
[
i
];

87 
d–‘e
 [] 
ÃighbÜ_li¡
;

88 
d–‘e
 [] 
ÃighbÜ_li¡_size
;

91 
ÃighbÜ_li¡_size_size
=
©oms
->
Çtms_lş
;

93 
MemÜy
::
	`®loc
(
ÃighbÜ_li¡
,
ÃighbÜ_li¡_size_size
);

94 
MemÜy
::
	`®loc
(
ÃighbÜ_li¡_size
,
ÃighbÜ_li¡_size_size
);

95 
i
=0;i<
ÃighbÜ_li¡_size_size
;i++)

96 
ÃighbÜ_li¡_size
[
i
]=0;

99 
–em_ty³
* 
–em_vec
=
–em
->
	`begš
();

100 
–em_ty³
 
–em_i
;

104 * 
tmp_Ãigh_li¡
=
NULL
;

105 
MemÜy
::
	`®loc
(
tmp_Ãigh_li¡
,
ÃighbÜ_li¡_size_size
+
©oms
->
Çtms_ph
);

106 
tmp_Ãigh_li¡_sz
=0;

107 cÚ¡ 
ty³0
* 
x
=
©oms
->x->
	`begš
();

108 
no_·œs
=0;

110 
ty³0
 
x_i
[
__dim__
];

111 autØ
¡Üe_xi
=[&
x_i
,&
x
,&
–em_i
,&
–em_vec
](
i
)->

113 
Algeb¿
::
V_eq
<
__dim__
>(
x
+
i
*__dim__,
x_i
);

114 
–em_i
=
–em_vec
[
i
];

117 autØ
¡Üe
=[
this
,&
tmp_Ãigh_li¡_sz
,&
tmp_Ãigh_li¡
](
i
)->

119 
ÃighbÜ_li¡
[
i
]=
NULL
;

120 if(
tmp_Ãigh_li¡_sz
)

122 
ÃighbÜ_li¡
[
i
]=
Ãw
 [
tmp_Ãigh_li¡_sz
];

123 
ÃighbÜ_li¡_size
[
i
]=
tmp_Ãigh_li¡_sz
;

124 
	`memıy
(
ÃighbÜ_li¡
[
i
],
tmp_Ãigh_li¡
,
tmp_Ãigh_li¡_sz
*());

125 
no_·œs
+=
tmp_Ãigh_li¡_sz
;

127 
tmp_Ãigh_li¡_sz
=0;

130 if(
·œ_wi£
)

132 
ûÎ
->
	`DO
(
box_chªge
,
¡Üe_xi
,

133 [&
tmp_Ãigh_li¡
,&
tmp_Ãigh_li¡_sz
,&
–em_vec
,&
x
,&
x_i
,&
–em_i
,
this
](
i
,
j
)

135 if(
i
<
j
 && 
Algeb¿
::
RSQ
<
__dim__
>(
x_i
,
x
+j*__dim__)<
cut_sk_sq
[
–em_i
][
–em_vec
[j]])

136 
tmp_Ãigh_li¡
[
tmp_Ãigh_li¡_sz
++]=
j
;

137 },
¡Üe
);

141 
ûÎ
->
	`DO
(
box_chªge
,
¡Üe_xi
,

142 [&
tmp_Ãigh_li¡
,&
tmp_Ãigh_li¡_sz
,&
–em_vec
,&
x
,&
x_i
,&
–em_i
,
this
](
i
,
j
)

144 if(
i
!=
j
 && 
Algeb¿
::
RSQ
<
__dim__
>(
x_i
,
x
+j*__dim__)<
cut_sk_sq
[
–em_i
][
–em_vec
[j]])

145 
tmp_Ãigh_li¡
[
tmp_Ãigh_li¡_sz
++]=
j
;

146 },
¡Üe
);

147 
no_·œs
/=2;

150 
MemÜy
::
	`d—Îoc
(
tmp_Ãigh_li¡
);

151 
no_Ãigh_li¡s
++;

152 
	}
}

	@neighbor_md.h

1 #iâdeà
__MAPP__ÃighbÜ_md__


2 
	#__MAPP__ÃighbÜ_md__


	)

3 
	~"ÃighbÜ.h
"

4 
Çme¥aû
 
	gMAPP_NS


6 şas 
	cNeighbÜMD
:
public
 
NeighbÜ


8 
´iv©e
:

9 
Vec
<
–em_ty³
>*& 
–em
;

10 
	gty³0
**& 
	gcut_sk_sq
;

11 
şass
 
AtomsMD
* 
	g©oms
;

12 
	g´Ùeùed
:

13 
public
:

14 
NeighbÜMD
(
şass
 
AtomsMD
*,
ty³0
**&);

15 ~
NeighbÜMD
();

17 
ü—‹_li¡
(
boŞ
);

18 
š™
();

19 
fš
();

21 
m¬k_»dndÁ_ph
(
by‹
*);

22 
»Çme_©oms
(*);

	@pgcmc_2.cpp

5 
	~"©oms_md.h
"

6 
	~"pgcmc_2.h
"

7 
	~"memÜy.h
"

8 
	~"¿ndom.h
"

9 
	~"–em’ts.h
"

10 
	~"ÃighbÜ_md.h
"

11 
	~"ff_md.h
"

12 
	~"xm©h.h
"

13 
	~"MAPP.h
"

14 
	~"comm.h
"

15 
	~"dyÇmic_md.h
"

16 
	~"´št.h
"

17 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

19 
	#GCMCDEBUG


20 

	)

23 
	gPGCMC_2
::
	$PGCMC_2
(
AtomsMD
*& 
__©oms
, 
FÜûF›ldMD
*&
__ff
, 
DyÇmicMD
*& 
__dyÇmic
, 
__m
, 
–em_ty³
 
__gas_ty³0
, 
ty³0
 
__mu0
,y³0 
__T
, 
£ed
,ƒËm_ty³ 
__gas_ty³1
,ty³0 
__mu1
,y³0 
__¿tio
):

24 
	`GCMC
(
__©oms
,
__ff
,
__dyÇmic
,
__gas_ty³0
,
__mu0
,
__gas_ty³1
,
__mu1
,
__T
,
£ed
),

25 
	`m
(
__m
),

26 
	$¿tio
(
__¿tio
)

28 
n_comm
=0;

29 
comm_id
=
NULL
;

30 
sucûss
=
NULL
;

31 
ÁrŸl_©ms
=
NULL
;

32 
gcmc_mode
=
NULL
;

33 
gcmc_wÜld
=
NULL
;

34 
cu¼_comms
=
NULL
;

35 
v¬s_comm
=
NULL
;

36 
lş_v¬s_comm
=
NULL
;

37 
št_buff
=
NULL
;

38 
roÙs
=
NULL
;

39 
comms
=
NULL
;

41 
s_buff
=
NULL
;

42 
s_x_buff
=
NULL
;

43 
ûÎ_coÜd_buff
=
NULL
;

45 
n_ûÎs
=0;

46 
h—d_©m
=
NULL
;

48 
max_ÁrŸl_©ms
=0;

49 
ûÎ_coÜd_buff
=
NULL
;

50 
s_x_buff
=
NULL
;

51 
s_buff
=
NULL
;

58 
lş_¿ndom
=
Ãw
 
	`Rªdom
(
£ed
+
©oms
->
comm_¿nk
);

71 
couÁr
[
__dim__
];

72 
i
=0;i<
__dim__
;i++)

73 
couÁr
[
i
]=-
m
;

74 
max_no_Ãighs
=1;

75 
i
=0;i<
__dim__
;i++)

76 
max_no_Ãighs
*=2*
m
+1;

77 
Âeighs
=0;

78 
»l_Ãigh_l¡_coÜd
=
Ãw
 [
max_no_Ãighs
*
__dim__
];

79 * 
»l_Ãigh_l¡_coÜd_
=
»l_Ãigh_l¡_coÜd
;

80 
sum
;

81 
rc_sq
=
m
*m;

82 
i
=0;i<
max_no_Ãighs
;i++)

84 
sum
=0;

85 
j
=0;j<
__dim__
;j++)

87 
sum
+=
couÁr
[
j
]*countr[j];

88 if(
couÁr
[
j
]!=0)

89 
sum
+=1-2*
¡d
::
	`abs
(
couÁr
[
j
]);

92 if(
sum
<
rc_sq
)

94 
j
=0;j<
__dim__
;j++)

95 
»l_Ãigh_l¡_coÜd_
[
j
]=
couÁr
[j];

96 
»l_Ãigh_l¡_coÜd_
+=
__dim__
;

97 
Âeighs
++;

100 
couÁr
[0]++;

101 
j
=0;j<
__dim__
-1;j++)

102 if(
couÁr
[
j
]==
m
+1)

104 
couÁr
[
j
]=-
m
;

105 
couÁr
[
j
+1]++;

108 
»l_Ãigh_l¡_coÜd_
=
Ãw
 [
Âeighs
*
__dim__
];

109 
	`memıy
(
»l_Ãigh_l¡_coÜd_
,
»l_Ãigh_l¡_coÜd
,
Âeighs
*
__dim__
*());

110 
d–‘e
 [] 
»l_Ãigh_l¡_coÜd
;

111 
»l_Ãigh_l¡_coÜd
=
»l_Ãigh_l¡_coÜd_
;

115 
	}
}

119 
	gPGCMC_2
::~
	$PGCMC_2
()

121 
d–‘e
 [] 
»l_Ãigh_l¡_coÜd
;

122 
d–‘e
 
lş_¿ndom
;

123 
	}
}

127 
	gPGCMC_2
::
	$š™
()

129 
dof_em±y
=
©oms
->
x_dof
->
	`is_em±y
();

130 
GCMC
::
	`š™
();

131 
	`box_£tup
();

134 
	}
}

138 
	gPGCMC_2
::
	$fš
()

140 
	`box_dismªe
();

141 
GCMC
::
	`fš
();

142 
	}
}

146 
	gPGCMC_2
::
	$box_£tup
()

148 
	`box_dismªe
();

149 
GCMC
::
	`box_£tup
();

150 
n_ûÎs
=1;

151 
i
=0;i<
__dim__
;i++)

153 
ûÎ_size
[
i
]=
cut_s
[i]/
¡©ic_ÿ¡
<
ty³0
>(
m
);

154 
N_ûÎs
[
i
]=
¡©ic_ÿ¡
<>((
s_hi
[i]-
s_lo
[i])/
ûÎ_size
[i])+1;

156 
B_ûÎs
[
i
]=
n_ûÎs
;

157 
n_ûÎs
*=
N_ûÎs
[
i
];

160 
h—d_©m
=
Ãw
 [
n_ûÎs
];

161 
	`comms_£tup
(
ff
->
gcmc_n_v¬s
,ff->
gcmc_n_cutoff
);

164 
s_buff
=
Ãw
 
ty³0
*[
max_n_úücy
];

165 *
s_buff
=
Ãw
 
ty³0
[
max_n_úücy
*
__dim__
];

166 
i
=1;i<
max_n_úücy
;i++)

167 
s_buff
[
i
]=s_buff[i-1]+
__dim__
;

169 
ûÎ_coÜd_buff
=
Ãw
 *[
max_n_úücy
];

170 *
ûÎ_coÜd_buff
=
Ãw
 [
max_n_úücy
*
max_ÁrŸl_©ms
*
__dim__
];

171 
i
=1;i<
max_n_úücy
;i++)

172 
ûÎ_coÜd_buff
[
i
]=ûÎ_coÜd_buff[i-1]+
max_ÁrŸl_©ms
*
__dim__
;

174 
s_x_buff
=
Ãw
 
ty³0
*[
max_n_úücy
];

175 *
s_x_buff
=
Ãw
 
ty³0
[
max_n_úücy
*
max_ÁrŸl_©ms
*
__dim__
];

176 
i
=1;i<
max_n_úücy
;i++)

177 
s_x_buff
[
i
]=s_x_buff[i-1]+
max_ÁrŸl_©ms
*
__dim__
;

179 
vŞ_lş
=
vŞ
/
¡©ic_ÿ¡
<
ty³0
>(
©oms
->
comm_size
);

180 
	}
}

184 
	gPGCMC_2
::
	$box_dismªe
()

187 
	`comms_dismªe
();

189 if(
s_buff
è
d–‘e
 [] *s_buff;

190 
d–‘e
 [] 
s_buff
;

191 
s_buff
=
NULL
;

193 if(
s_x_buff
è
d–‘e
 [] *s_x_buff;

194 
d–‘e
 [] 
s_x_buff
;

195 
s_x_buff
=
NULL
;

197 if(
ûÎ_coÜd_buff
è
d–‘e
 [] *cell_coord_buff;

198 
d–‘e
 [] 
ûÎ_coÜd_buff
;

199 
ûÎ_coÜd_buff
=
NULL
;

201 
d–‘e
 [] 
h—d_©m
;

202 
h—d_©m
=
NULL
;

204 
n_ûÎs
=0;

205 
	}
}

209 
	gPGCMC_2
::
	$xchng
(
boŞ
 
chng_box
,
Ç‰m±s
)

211 
dyÇmic
->
	`š™_xchng
();

212 if(
chng_box
è
	`box_£tup
();

217 if(
ff
->
gcmc_g_’abËd
è
g_vec_p
=
Ãw
 
Vec
<>(
©oms
,1);

218 
g_vec_p
=
NULL
;

219 
ûÎ_vec_p
=
Ãw
 
Vec
<>(
©oms
,1);

220 
Ãxt_vec_p
=
Ãw
 
Vec
<>(
©oms
,1);

221 
s_vec_p
=
Ãw
 
Vec
<
ty³0
>(
©oms
,
__dim__
);

222 
	`memıy
(
s_vec_p
->
	`begš
(),
©oms
->
x
->begš(),(
ty³0
)*
Çtms_lş
*
__dim__
);

227 
i
=0;i<
n_ûÎs
;i++è
h—d_©m
[i]=-1;

234 * 
Ãxt_vec
=
Ãxt_vec_p
->
	`begš
();

235 * 
ûÎ_vec
=
ûÎ_vec_p
->
	`begš
();

236 
ty³0
* 
s
=
©oms
->
x
->
	`begš
()+(
Çtms_lş
-1)*
__dim__
;

237 
i
=
Çtms_lş
-1;i>-1;i--,
s
-=
__dim__
)

239 
	`fšd_ûÎ_no
(
s
,
ûÎ_vec
[
i
]);

240 
Ãxt_vec
[
i
]=
h—d_©m
[
ûÎ_vec
[i]];

241 
h—d_©m
[
ûÎ_vec
[
i
]]=i;

244 
ff
->
ÃighbÜ
->
	`ü—‹_li¡
(
chng_box
);

246 
ff
->
	`š™_xchng
();

247 
i
=0;i<
©oms
->
ndyÇmic_vecs
;i++)

248 
©oms
->
dyÇmic_vecs
[
i
]->
	`»size
(
Çtms_lş
);

251 
–em_ty³
* 
–em
=
©oms
->–em->
	`begš
();

252 
i
=0;i<
Çtms_lş
;i++)

255 
j
=0; j< 
nGasTy³
;j++)

257 if(
–em
[
i
]==
gas_ty³A¼
[
j
]è
ngas_lşA¼
[j]++;

261 
	`MPI_AÎ»duû
(
ngas_lşA¼
,
ngasA¼
,
nGasTy³
,
MPI_INT
,
MPI_SUM
,
wÜld
);

264 
Ãxt_j©m_p
=&
PGCMC_2
::
Ãxt_j©m_»g
;

267 
nx
=
Ç‰m±s
/
n_´Î
;

268 if(
Ç‰m±s
%
n_´Î
è
nx
++;

273 
dof_diff
=0;

274 
Algeb¿
::
z”o
<
__nvoigt__
>(
mvv_lş
);

276 
i
=0;i<
nx
;i++è
	`©tm±
();

278 
	`MPI_AÎ»duû
(
mvv_lş
,
mvv
,
__nvoigt__
,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

283 
ff
->
	`fš_xchng
();

284 
	`memıy
(
©oms
->
x
->
	`begš
(),
s_vec_p
->begš(),(
ty³0
)*
Çtms_lş
*
__dim__
);

286 
d–‘e
 
s_vec_p
;

287 
d–‘e
 
Ãxt_vec_p
;

288 
d–‘e
 
ûÎ_vec_p
;

289 
d–‘e
 
g_vec_p
;

290 
dyÇmic
->
	`fš_xchng
();

292 
	}
}

296 
šlše
 
	gPGCMC_2
::
	$fšd_ûÎ_no
(
ty³0
*& 
s
,& 
ûÎ_no
)

298 
ûÎ_no
=0;

299 
i
=0;i<
__dim__
;i++)

300 
ûÎ_no
+=
B_ûÎs
[
i
]*
	`MIN
(
¡©ic_ÿ¡
<>((
s
[i]-
s_lo
[i])/
ûÎ_size
[i]),
N_ûÎs
[i]-1);

301 
	}
}

305 
šlše
 
	gPGCMC_2
::
	$fšd_ûÎ_coÜd
(
ty³0
*& 
s
,*& 
ûÎ_coÜd
)

307 
i
=0;i<
__dim__
;i++)

309 if(
s
[
i
]<
s_lo
[i])

310 
ûÎ_coÜd
[
i
]=-
¡©ic_ÿ¡
<>((
s_lo
[i]-
s
[i])/
ûÎ_size
[i])-1;

311 if(
s_hi
[
i
]<=
s
[i])

312 
ûÎ_coÜd
[
i
]=
	`MAX
(
¡©ic_ÿ¡
<>((
s
[i]-
s_lo
[i])/
ûÎ_size
[i]),
N_ûÎs
[i]-1);

314 
ûÎ_coÜd
[
i
]=
	`MIN
(
¡©ic_ÿ¡
<>((
s
[i]-
s_lo
[i])/
ûÎ_size
[i]),
N_ûÎs
[i]-1);

316 
	}
}

320 
	gPGCMC_2
::
	$´•_s_x_buff
()

323 
couÁ
[
__dim__
];

324 
n_³r_dim
[
__dim__
];

325 
ty³0
* 
buff
;

326 * 
ûÎ_coÜd
;

328 
ty³0
 
s
;

329 
no
;

330 
i
=0;i<
n_cu¼_comms
;i++)

332 if(
gcmc_mode
[
i
]==
NOEX_MODE
)

334 
ÁrŸl_©ms
[
i
]=0;

338 
ÁrŸl_©ms
[
i
]=1;

340 
j
=0;j<
__dim__
;j++)

342 
no
=0;

343 
s
=
s_buff
[
i
][
j
];

344 
ty³0
 
s_
=
s
;s_<
s_hi_ph
[
j
];s_++)

345 if(
s_lo_ph
[
j
]<=
s_
 && s_<
s_hi_ph
[j])

346 
s_ŒŸls
[
j
][
no
++]=
s_
;

348 
ty³0
 
s_
=
s
-1.0;
s_lo_ph
[
j
]<=s_;s_--)

349 if(
s_lo_ph
[
j
]<=
s_
 && s_<
s_hi_ph
[j])

350 
s_ŒŸls
[
j
][
no
++]=
s_
;

352 
ÁrŸl_©ms
[
i
]*=
no
;

353 
n_³r_dim
[
j
]=
no
;

357 if(
ÁrŸl_©ms
[
i
]==0) ;

359 
buff
=
s_x_buff
[
i
];

360 
ûÎ_coÜd
=
ûÎ_coÜd_buff
[
i
];

362 
j
=0;j<
__dim__
;j++è
couÁ
[j]=0;

363 
j
=0;j<
ÁrŸl_©ms
[
i
];j++)

365 
k
=0;k<
__dim__
;k++)

366 
buff
[
k
]=
s_ŒŸls
[k][
couÁ
[k]];

368 
	`fšd_ûÎ_coÜd
(
buff
,
ûÎ_coÜd
);

371 
Algeb¿
::
S2X
<
__dim__
>(
©oms
->
__h
,
buff
);

373 
couÁ
[0]++;

374 
k
=0;k<
__dim__
-1;k++)

375 if(
couÁ
[
k
]==
n_³r_dim
[k])

377 
couÁ
[
k
]=0;

378 
couÁ
[
k
+1]++;

380 
ûÎ_coÜd
+=
__dim__
;

381 
buff
+=
__dim__
;

384 
	}
}

388 
	gPGCMC_2
::
	$»£t_Ÿtm
()

390 
™rŸl_©m
=-1;

391 
	`Ãxt_Ÿtm
();

392 
	}
}

396 
	gPGCMC_2
::
	$Ãxt_Ÿtm
()

398 
™rŸl_©m
++;

400 if(
™rŸl_©m
==
ÁrŸl_©ms
[
icomm
])

405 
Ÿtm
=-1;

418 if(
™rŸl_©m
==0 && 
im_roÙ
 && 
xchng_mode
==
DEL_MODE
)

419 
Ÿtm
=
d–_idx
;

421 
Ÿtm
=
Çtms_lş
+
™rŸl_©m
;

427 
i
=0;i<
__dim__
;i++)

428 
iûÎ_coÜd
[
i
]=
ûÎ_coÜd_buff
[
icomm
][
__dim__
*
™rŸl_©m
+i];

433 
ix
=
s_x_buff
[
icomm
]+
™rŸl_©m
*
__dim__
;

434 
	}
}

438 
	gPGCMC_2
::
	$»£t_j©m
()

440 
šeigh
=0;

441 
j©m_Ãxt
=-1;

442 
	`Ãxt_j©m_»g
();

443 
	}
}

447 
šlše
 
	gPGCMC_2
::
	$Ãxt_j©m_»g
()

449 
Œue
)

451 
j©m_Ãxt
==-1 && 
šeigh
<
Âeighs
)

453 
boŞ
 
lş
=
Œue
;

454 
jûÎ
=0;

455 
i
=0;i<
__dim__
 && 
lş
;i++)

457 
jûÎ_coÜd
[
i
]=
iûÎ_coÜd
[i]+
»l_Ãigh_l¡_coÜd
[
šeigh
*
__dim__
+i];

458 
jûÎ
+=
B_ûÎs
[
i
]*
jûÎ_coÜd
[i];

460 if(
jûÎ_coÜd
[
i
]<0 || jûÎ_coÜd[i]>
N_ûÎs
[i]-1)

461 
lş
=
çl£
;

464 if(
lş
)

465 
j©m_Ãxt
=
h—d_©m
[
jûÎ
];

466 
šeigh
++;

469 
j©m
=
j©m_Ãxt
;

470 if(
j©m
==-1)

473 if(
™rŸl_©m
==0 && 
im_roÙ
)

475 
i£lf
=0;

476 
Ãxt_j©m_p
=&
PGCMC_2
::
Ãxt_j©m_£lf
;

477  
	`Ãxt_j©m_£lf
();

482 
j©m_Ãxt
=
Ãxt_vec_p
->
	`begš
()[
j©m
];

484 if(
j©m
==
Ÿtm
) ;

486 
jx
=
©oms
->
x
->
	`begš
()+
__dim__
*
j©m
;

487 
j–em
=
©oms
->
–em
->
	`begš
()[
j©m
];

488 
rsq
=
Algeb¿
::
RSQ
<
__dim__
>(
ix
,
jx
);

489 if(
rsq
>=
cut_sq
[
›Ëm
][
j–em
]) ;

491 if(
g_vec_p
èg_vec_p->
	`begš
()[
j©m
]=
icomm
;

494 
	}
}

498 
šlše
 
	gPGCMC_2
::
	$Ãxt_j©m_£lf
()

500 
Œue
)

502 
i£lf
++;

503 if(
i£lf
==
ÁrŸl_©ms
[
icomm
])

505 
Ãxt_j©m_p
=&
PGCMC_2
::
Ãxt_j©m_»g
;

506 
j©m
=-1;

510 
j©m
=
Çtms_lş
+
i£lf
;

511 
jx
=
s_x_buff
[
icomm
]+
i£lf
*
__dim__
;

513 
j–em
=
–em_buff
;

514 
rsq
=
Algeb¿
::
RSQ
<
__dim__
>(
ix
,
jx
);

516 if(
rsq
>=
cut_sq
[
›Ëm
][
j–em
]) ;

520 
	}
}

524 
	gPGCMC_2
::
	$Ãxt_j©m
()

526 (
this
->*
Ãxt_j©m_p
)();

527 
	}
}

531 
	gPGCMC_2
::
	$Ãxt_icomm
()

533 
icomm
++;

534 if(
icomm
==
n_cu¼_comms
)

536 
icomm
=-1;

539 
xchng_mode
=
gcmc_mode
[
icomm
];

540 
lş_v¬s
=
lş_v¬s_comm
[
icomm
];

541 
v¬s
=
v¬s_comm
[
icomm
];

542 
cu¼_comm
=
cu¼_comms
[
icomm
];

543 
cu¼_roÙ
=
roÙs
[
icomm
];

544 
	}
}

548 
	gPGCMC_2
::
	$»£t_icomm
()

550 
icomm
=-1;

551 
	`Ãxt_icomm
();

552 
	}
}

556 
	gPGCMC_2
::
	$sucûss2g
()

558 * 
g
=
g_vec_p
->
	`begš
();

559 
i
=0;i<
Çtms_lş
;i++)

560 if(
g
[
i
]!=-1)

561 
g
[
i
]=
sucûss
[tag[i]];

562 
	}
}

566 
	gPGCMC_2
::
	$»£t_g
()

568 * 
g
=
g_vec_p
->
	`begš
();

569 
i
=0;i<
Çtms_lş
;i++)

570 
g
[
i
]=-1;

571 
	}
}

575 
	gPGCMC_2
::
	$©tm±
()

577 
	`ü—‹_comm_·‰”n
();

580 if(
im_roÙ
)

582 ià(
lş_¿ndom
->
	`unifÜm
()<
¿tio
)

584 
igasTy³
 = 0;

588 
igasTy³
 = 1;

590 if(
lş_¿ndom
->
	`unifÜm
()<0.5)

592 
gcmc_mode
[0]=
INS_MODE
;

593 
comm_buff
[0]=2;

594 
i
=0;i<
__dim__
;i++)

595 
s_buff
[0][
i
]=
s_lo
[i]+
lş_¿ndom
->
	`unifÜm
()*(
s_hi
[i]-s_lo[i]);

596 
	`memıy
(
comm_buff
+1,
s_buff
[0],
__dim__
*(
ty³0
));

597 
–em_buff
=
gas_ty³A¼
[
igasTy³
];

598 
›Ëm
=
–em_buff
;

602 if(
ngas_lşA¼
[
igasTy³
])

604 
gcmc_mode
[0]=
DEL_MODE
;

605 
comm_buff
[0]=1;

606 
igas
=
¡©ic_ÿ¡
<>(
ngas_lşA¼
[
igasTy³
]*
lş_¿ndom
->
	`unifÜm
());

608 
n
=
igas
;

609 
icouÁ
=-1;

610 
–em_ty³
* 
–em
=
©oms
->–em->
	`begš
();

611 
d–_idx
=0;

612 ;
icouÁ
!=
n
;
d–_idx
++)

613 if(
–em
[
d–_idx
]==
gas_ty³A¼
[
igasTy³
]è
icouÁ
++;

614 
d–_idx
--;

615 
gas_id
=
©oms
->
id
->
	`begš
()[
d–_idx
];

617 
	`memıy
(
s_buff
[0],
s_vec_p
->
	`begš
()+
d–_idx
*
__dim__
,__dim__*(
ty³0
));

618 
	`memıy
(
comm_buff
+1,
s_buff
[0],
__dim__
*(
ty³0
));

622 
gcmc_mode
[0]=
NOEX_MODE
;

623 
comm_buff
[0]=0;

628 
	`MPI_Bÿ¡
(
comm_buff
,
comm_buff_size
,
MPI_BYTE
,
roÙs
[0],*
cu¼_comms
[0]);

632 
i
=0;i<
n_cu¼_comms
;i++)

634 
	`MPI_Bÿ¡
(
comm_buff
,
comm_buff_size
,
MPI_BYTE
,
roÙs
[
i
],*
cu¼_comms
[i]);

635 
	`memıy
(
s_buff
[
i
],
comm_buff
+1,
__dim__
*(
ty³0
));

636 if(
comm_buff
[0]==1)

637 
gcmc_mode
[
i
]=
DEL_MODE
;

638 if(
comm_buff
[0]==2)

639 
gcmc_mode
[
i
]=
INS_MODE
;

641 
gcmc_mode
[
i
]=
NOEX_MODE
;

645 
	`´•_s_x_buff
();

647 if(
g_vec_p
è
	`»£t_g
();

649 
ff
->
	`´e_xchng_’”gy_tim”
(
this
);

651 
d–_u
=
ff
->
	`xchng_’”gy_tim”
(
this
);

653 
roÙ_succ
=
çl£
;

654 if(
im_roÙ
è
	`decide
();

656 
i
=0;i<
n_cu¼_comms
;i++)

657 
	`MPI_Bÿ¡
(&
sucûss
[
i
],1,
MPI_INT
,
roÙs
[i],*
cu¼_comms
[i]);

659 if(
g_vec_p
è
	`sucûss2g
();

661 
ff
->
	`po¡_xchng_’”gy_tim”
(
this
);

663 
	`fš®ize
();

665 
	}
}

669 
	gPGCMC_2
::
	$d–_succ
()

675 * 
p_2_idx
=
h—d_©m
+
ûÎ_vec_p
->
	`begš
()[
d–_idx
];

676 *
p_2_idx
!=
d–_idx
)

677 
p_2_idx
=
Ãxt_vec_p
->
	`begš
()+*p_2_idx;

681 *
p_2_idx
=
Ãxt_vec_p
->
	`begš
()[
d–_idx
];

683 if(
d–_idx
!=
Çtms_lş
-1)

688 * 
p_2_fœ¡_aá_d–
=
h—d_©m
+
ûÎ_vec_p
->
	`begš
()[
Çtms_lş
-1];

689 *
p_2_fœ¡_aá_d–
<
d–_idx
)

690 
p_2_fœ¡_aá_d–
=
Ãxt_vec_p
->
	`begš
()+*p_2_first_aft_del;

695 * 
p_2_Ï¡
=
p_2_fœ¡_aá_d–
;

696 *
p_2_Ï¡
!=
Çtms_lş
-1)

697 
p_2_Ï¡
=
Ãxt_vec_p
->
	`begš
()+*p_2_last;

703 *
p_2_Ï¡
=-1;

710 
Ãxt_vec_p
->
	`begš
()[
Çtms_lş
-1]=*
p_2_fœ¡_aá_d–
;

711 *
p_2_fœ¡_aá_d–
=
d–_idx
;

715 
ty³0
 
__gas_mass
=-
gas_massA¼
[
igasTy³
];

716 
Algeb¿
::
DyadicV
<
__dim__
>(
__gas_mass
,
©oms
->
x_d
->
	`begš
()+
d–_idx
*__dim__,
mvv_lş
);

717 
©oms
->
	`d–
(
d–_idx
);

719 
ngas_lşA¼
[
igasTy³
]--;

720 
	}
}

724 
	gPGCMC_2
::
	$šs_succ
()

726 
©oms
->
	`add
();

729 
j
 = 0; j < 
nGasTy³
; j++)

731 ià(
gas_ty³A¼
[
j
] =ğ
–em_buff
)

733 
i
=0;i<
__dim__
;i++è
v–_buff
[i] = 
lş_¿ndom
->
	`gaussŸn
(è* 
sigmaA¼
[
j
];

738 
	`memıy
(
©oms
->
x
->
	`begš
()+(
Çtms_lş
-1)*
__dim__
,
s_x_buff
[0],__dim__*(
ty³0
));

739 
	`memıy
(
©oms
->
x_d
->
	`begš
()+(
Çtms_lş
-1)*
__dim__
,
v–_buff
,__dim__*(
ty³0
));

741 
©oms
->
–em
->
	`begš
()[
Çtms_lş
-1]=
–em_buff
;

742 
©oms
->
id
->
	`begš
()[
Çtms_lş
-1]=
Ãw_id
;

743 if(
g_vec_p
èg_vec_p->
	`begš
()[
Çtms_lş
-1]=-1;

744 if(!
dof_em±y
)

746 
boŞ
* 
dof
=
©oms
->
x_dof
->
	`begš
()+(
Çtms_lş
-1)*
__dim__
;

747 
i
=0;i<
__dim__
;i++è
dof
[i]=
Œue
;

753 
Algeb¿
::
DyadicV
<
__dim__
>(
gas_massA¼
[
igasTy³
],
©oms
->
x_d
->
	`begš
()+(
Çtms_lş
-1)*__dim__,
mvv_lş
);

755 
	`memıy
(
s_vec_p
->
	`begš
()+(
Çtms_lş
-1)*
__dim__
,
s_buff
[0],__dim__*(
ty³0
));

757 
ûÎ_
=0;

758 
i
=0;i<
__dim__
;i++è
ûÎ_
+=
B_ûÎs
[i]*
ûÎ_coÜd_buff
[0][i];

759 
ûÎ_vec_p
->
	`begš
()[
Çtms_lş
-1]=
ûÎ_
;

762 * 
nxt_p
=
h—d_©m
+
ûÎ_
;

763 *
nxt_p
!=-1)

764 
nxt_p
=
Ãxt_vec_p
->
	`begš
()+*nxt_p;

765 *
nxt_p
=
Çtms_lş
-1;

766 
Ãxt_vec_p
->
	`begš
()[
Çtms_lş
-1]=-1;

768 
ngas_lşA¼
[
igasTy³
]++;

769 
	}
}

774 
	gPGCMC_2
::
	$comms_£tup
(
n_v¬s_
,
n_s_
)

776 
n_v¬s
=
n_v¬s_
;

777 
n_s
=
n_s_
;

778 

=
©oms
->
comm_¿nk
;

779 
n_p
=
©oms
->
comm_size
;

781 
	`memıy
(
p_vec
,
©oms
->
comm
.
coÜds
,()*
__dim__
);

794 
max_n_úücy
=1;

795 
n_p
=
n_´Î
=
n_pcomm
=
n_comm
=1;

796 
comm_id_sz
=0;

797 
i
=0;i<
__dim__
;i++)

799 
N_p
[
i
]=
©oms
->
comm
.
dims
[i];

800 
N_c
[
i
]=
¡©ic_ÿ¡
<>(
	`û
(¡©ic_ÿ¡<
ty³0
>(
N_p
[i])*
cut_s
[i]));

801 
N_s
[
i
]=
¡©ic_ÿ¡
<>(
	`û
(¡©ic_ÿ¡<
ty³0
>(
n_s
*
N_p
[i])*
cut_s
[i]));

802 
N_´Î
[
i
]=
	`MAX
(
N_p
[i]/(
N_s
[i]+1),1);

803 if(
N_´Î
[
i
]>1)

805 
N_pcomm
[
i
]=2*
N_c
[i]+1;

806 
N_comm
[
i
]=2*
N_c
[i]+1;

807 
´Î_dim
[
i
]=
Œue
;

808 
max_N_úücy
[
i
]=(2*
N_c
[i])/(
N_s
[i]+1)+1;

813 
N_pcomm
[
i
]=
N_p
[i];

814 
N_comm
[
i
]=1;

815 
´Î_dim
[
i
]=
çl£
;

816 
max_N_úücy
[
i
]=1;

819 
B_p
[
i
]=
n_p
;

820 
B_´Î
[
i
]=
n_´Î
;

821 
B_pcomm
[
i
]=
n_pcomm
;

822 
B_comm
[
i
]=
n_comm
;

824 
n_p
*=
N_p
[
i
];

825 
n_´Î
*=
N_´Î
[
i
];

826 
n_pcomm
*=
N_pcomm
[
i
];

827 
n_comm
*=
N_comm
[
i
];

829 
max_n_úücy
*=
max_N_úücy
[
i
];;

831 
comm_id_sz
+=
max_N_úücy
[
i
];

834 
comm_id
=
Ãw
 *[
__dim__
];

835 *
comm_id
=
Ãw
 [
comm_id_sz
];

836 
i
=1;i<
__dim__
;i++è
comm_id
[i]=comm_id[i-1]+
max_N_úücy
[i-1];

838 
sucûss
=
Ãw
 [
max_n_úücy
];

839 
ÁrŸl_©ms
=
Ãw
 [
max_n_úücy
];

840 
gcmc_mode
=
Ãw
 [
max_n_úücy
];

841 
cu¼_comms
=
Ãw
 
MPI_Comm
*[
max_n_úücy
];

843 
v¬s_comm
=
Ãw
 
ty³0
*[
max_n_úücy
];

844 *
v¬s_comm
=
Ãw
 
ty³0
[
max_n_úücy
*
n_v¬s
];

845 
i
=1;i<
max_n_úücy
;i++è
v¬s_comm
[i]=v¬s_comm[i-1]+
n_v¬s
;

847 
lş_v¬s_comm
=
Ãw
 
ty³0
*[
max_n_úücy
];

848 *
lş_v¬s_comm
=
Ãw
 
ty³0
[
max_n_úücy
*
n_v¬s
];

849 
i
=1;i<
max_n_úücy
;i++è
lş_v¬s_comm
[i]öş_v¬s_comm[i-1]+
n_v¬s
;

851 
št_buff
=
Ãw
 [2+
n_´Î
];

853 
roÙs
=
Ãw
 [
n_comm
];

854 
comms
=
Ãw
 
MPI_Comm
[
n_comm
];

855 
gcmc_wÜld
=
Ãw
 
MPI_Comm
;

856 
	`¥l™_muÉ
();

858 
	}
}

862 
	gPGCMC_2
::
	$¥l™_sšg
()

864 
_vec
[
__dim__
];

865 
i
=0;i<
__dim__
;i++)

866 
_vec
[
i
]=0;

868 
MPI_Comm
 
dummy
;

869 
jcomm
,
d
,
jkey
,
jcŞÜ
,
j¿nk
,
jsize
;

870 
jkey
=0;

871 
i
=0;i<
__dim__
;i++)

872 
jkey
+=
p_vec
[
i
]*
B_p
[i];

873 
	`MPI_Comm_¥l™
(
wÜld
,0,
jkey
,
gcmc_wÜld
);

874 
i
=0;i<
n_p
;i++)

876 
jcomm
=0;

877 
jkey
=0;

878 
jcŞÜ
=0;

879 
j
=0;j<
__dim__
 && 
jcŞÜ
!=
MPI_UNDEFINED
;j++)

882 if(
´Î_dim
[
j
])

884 
d
=
p_vec
[
j
]-
_vec
[j];

885 if(
d
<0èd+=
N_p
[
j
];

887 if(
d
<2*
N_c
[
j
]+1)

889 
jcŞÜ
+=
_vec
[
j
]*
B_p
[j];

890 
jcomm
+=
d
*
B_comm
[
j
];

891 
d
-=
N_c
[
j
];

892 if(
d
<0èd+=2*
N_c
[
i
]+1;

893 
jkey
+=
d
*
B_pcomm
[
j
];

897 
jcŞÜ
=
MPI_UNDEFINED
;

900 
jkey
+=
p_vec
[
j
]*
B_pcomm
[j];

903 if(
jcŞÜ
!=
MPI_UNDEFINED
)

905 
	`MPI_Comm_¥l™
(
wÜld
,
jcŞÜ
,
jkey
,&
comms
[
jcomm
]);

907 
	`MPI_Comm_¿nk
(
comms
[
jcomm
],&
j¿nk
);

908 
	`MPI_Comm_size
(
comms
[
jcomm
],&
jsize
);

916 
	`MPI_Comm_¥l™
(
wÜld
,
jcŞÜ
,

,&
dummy
);

918 
_vec
[0]++;

919 
j
=0;j<
__dim__
-1;j++)

920 if(
_vec
[
j
]==
N_p
[j])

922 
_vec
[
j
]=0;

923 
_vec
[
j
+1]++;

926 
	}
}

930 
	gPGCMC_2
::
	$¥l™_muÉ
()

932 
hi
[
__dim__
];

933 
mid
[
__dim__
];

934 
úŒ
[
__dim__
];

935 
no
=1;

936 
i
=0;i<
__dim__
;i++)

938 if(
´Î_dim
[
i
])

940 
mid
[
i
]=2*
N_c
[i]+1;

941 
hi
[
i
]=
mid
[i]+(
N_p
[i]%(2*
N_c
[i]+1));

944 
mid
[
i
]=
hi
[i]=1;

946 
no
*=
hi
[
i
];

947 
úŒ
[
i
]=0;

950 
MPI_Comm
 
dummy
;

951 
jcomm
,
d
,
t
,
r
,
s
,
l
,
jkey
,
jcŞÜ
,
j¿nk
,
jsize
;

952 
jkey
=0;

953 
i
=0;i<
__dim__
;i++)

954 
jkey
+=
p_vec
[
i
]*
B_p
[i];

955 
	`MPI_Comm_¥l™
(
wÜld
,0,
jkey
,
gcmc_wÜld
);

957 
i
=0;i<
no
;i++)

959 
jcomm
=0;

960 
jkey
=0;

961 
jcŞÜ
=0;

962 
j
=0;j<
__dim__
 && 
jcŞÜ
!=
MPI_UNDEFINED
;j++)

965 if(
´Î_dim
[
j
])

968 if(
úŒ
[
j
]<
mid
[j])

970 
d
=
p_vec
[
j
]-
úŒ
[j];

971 
l
=
N_p
[
j
]/
mid
[j];

975 
d
=
p_vec
[
j
]-((
úŒ
[j]-
mid
[j])+(
N_p
[j]/mid[j])*mid[j]);

976 
l
=1;

979 if(
d
<0)

980 
d
+=
N_p
[
j
];

981 
t
=
d
/
mid
[
j
];

982 if(
t
<
l
)

984 
r
=
d
%
mid
[
j
];

985 
jcomm
+=
r
*
B_comm
[
j
];

986 
s
=
p_vec
[
j
]+
N_c
[j]-
r
;

987 if(
s
<0)

988 
s
+=
N_p
[
j
];

989 if(
s
>=
N_p
[
j
])

990 
s
-=
N_p
[
j
];

991 
jcŞÜ
+=
B_p
[
j
]*
s
;

993 
r
-=
N_c
[
j
];

994 if(
r
<0èr+=
mid
[
j
];

995 
jkey
+=
r
*
B_pcomm
[
j
];

999 
jcŞÜ
=
MPI_UNDEFINED
;

1002 
jkey
+=
p_vec
[
j
]*
B_pcomm
[j];

1005 if(
jcŞÜ
!=
MPI_UNDEFINED
)

1007 
	`MPI_Comm_¥l™
(
wÜld
,
jcŞÜ
,
jkey
,&
comms
[
jcomm
]);

1009 
	`MPI_Comm_¿nk
(
comms
[
jcomm
],&
j¿nk
);

1010 
	`MPI_Comm_size
(
comms
[
jcomm
],&
jsize
);

1017 
	`MPI_Comm_¥l™
(
wÜld
,
jcŞÜ
,

,&
dummy
);

1019 
úŒ
[0]++;

1020 
j
=0;j<
__dim__
-1;j++)

1021 if(
úŒ
[
j
]==
hi
[j])

1023 
úŒ
[
j
]=0;

1024 
úŒ
[
j
+1]++;

1027 
	}
}

1031 
	gPGCMC_2
::
	$comms_dismªe
()

1033 if(
comm_id
è
d–‘e
 [] *comm_id;

1034 
d–‘e
 [] 
comm_id
;

1035 
comm_id
=
NULL
;

1036 
d–‘e
 [] 
sucûss
;

1037 
sucûss
=
NULL
;

1038 
d–‘e
 [] 
ÁrŸl_©ms
;

1039 
ÁrŸl_©ms
=
NULL
;

1040 
d–‘e
 [] 
gcmc_mode
;

1041 
gcmc_mode
=
NULL
;

1042 
d–‘e
 [] 
cu¼_comms
;

1043 
cu¼_comms
=
NULL
;

1044 if(
v¬s_comm
è
d–‘e
 *vars_comm;

1045 
d–‘e
 [] 
v¬s_comm
;

1046 
v¬s_comm
=
NULL
;

1047 if(
lş_v¬s_comm
è
d–‘e
 *lcl_vars_comm;

1048 
d–‘e
 [] 
lş_v¬s_comm
;

1049 
lş_v¬s_comm
=
NULL
;

1050 
d–‘e
 [] 
št_buff
;

1051 
št_buff
=
NULL
;

1052 
d–‘e
 [] 
roÙs
;

1053 
roÙs
=
NULL
;

1054 if(
gcmc_wÜld
è
	`MPI_Comm_ä“
(gcmc_world);

1055 
d–‘e
 
gcmc_wÜld
;

1056 
gcmc_wÜld
=
NULL
;

1057 
i
=0;i<
n_comm
;i++è
	`MPI_Comm_ä“
(&
comms
[i]);

1058 
d–‘e
 [] 
comms
;

1059 
comms
=
NULL
;

1061 
n_comm
=0;

1062 
	}
}

1066 
	gPGCMC_2
::
	$ü—‹_comm_·‰”n
()

1068 
n
,
d
,
r
,
l
;

1069 
n_cu¼_comms
=1;

1070 
im_roÙ
=
Œue
;

1071 
Üigš_p
=0;

1072 
¾l
=0;

1073 
i
=0;i<
__dim__
;i++)

1076 
İ_vec
[
i
]=
¡©ic_ÿ¡
<>(
N_p
[i]*
¿ndom
->
	`unifÜm
());

1077 
Üigš_p
+=
İ_vec
[
i
]*
B_p
[i];

1079 
N_cu¼_comms
[
i
]=0;

1080 if(!
´Î_dim
[
i
])

1082 
comm_id
[
i
][0]=
İ_vec
[i];

1083 if(
İ_vec
[
i
]!=
p_vec
[i]è
im_roÙ
=
çl£
;

1084 
N_cu¼_comms
[
i
]=1;

1088 
n
=
p_vec
[
i
]-
İ_vec
[i];

1089 if(
n
<0èn+=
N_p
[
i
];

1090 
d
=
n
/(
N_s
[
i
]+1);

1091 
l
=
n
%(
N_s
[
i
]+1);

1094 if(
d
==
N_´Î
[
i
])

1096 
l
+=
N_s
[
i
]+1;

1097 
d
--;

1099 
¾l
+=
d
*
B_´Î
[
i
];

1104 if(
l
!=0è
im_roÙ
=
çl£
;

1106 if(
d
==
N_´Î
[
i
]-1)

1107 
r
=
N_p
[
i
]-
n
;

1109 
r
=
N_s
[
i
]+1-
l
;

1111 if((
d
%2==0 && d!=
N_´Î
[
i
]-1) || (d%2==1 && d==N_prll[i]-2))

1114 if(
l
<=
N_c
[
i
])

1115 
comm_id
[
i
][
N_cu¼_comms
[i]++]=
N_c
[i]+
l
;

1117 if(
r
<=
N_c
[
i
])

1118 
comm_id
[
i
][
N_cu¼_comms
[i]++]=
N_c
[i]-
r
;

1124 if(
r
<=
N_c
[
i
])

1125 
comm_id
[
i
][
N_cu¼_comms
[i]++]=
N_c
[i]-
r
;

1127 if(
l
<=
N_c
[
i
])

1128 
comm_id
[
i
][
N_cu¼_comms
[i]++]=
N_c
[i]+
l
;

1132 
n_cu¼_comms
*=
N_cu¼_comms
[
i
];

1136 
i
=0;i<
__dim__
;i++)

1137 
i_cu¼_comms
[
i
]=0;

1139 
ic
,
œoÙ
;

1140 
i
=0;i<
n_cu¼_comms
;i++)

1142 
ic
=0;

1143 
œoÙ
=0;

1144 
j
=0;j<
__dim__
;j++)

1146 if(
´Î_dim
[
j
])

1147 
ic
+=
comm_id
[
j
][
i_cu¼_comms
[j]]*
B_comm
[j];

1149 
œoÙ
+=
comm_id
[
j
][
i_cu¼_comms
[j]]*
B_pcomm
[j];

1152 
roÙs
[
i
]=
œoÙ
;

1153 
cu¼_comms
[
i
]=&
comms
[
ic
];

1155 
i_cu¼_comms
[0]++;

1156 
j
=0;j<
__dim__
-1;j++)

1157 if(
i_cu¼_comms
[
j
]==
N_cu¼_comms
[j])

1159 
i_cu¼_comms
[
j
]=0;

1160 
i_cu¼_comms
[
j
+1]++;

1165 if(
im_roÙ
)

1169 
Ãxt
=
¾l
-1;

1170 
´ev
=
¾l
+1;

1172 if(
Ãxt
!=-1)

1174 
Ãxt_p
=0;

1175 
i
=
__dim__
-1;i>-1;i--)

1177 
Ãxt_p
+=((
İ_vec
[
i
]+(
Ãxt
/
B_´Î
[i])*(
N_s
[i]+1))%
N_p
[i])*
B_p
[i];

1178 
Ãxt
%=
B_´Î
[
i
];

1182 
Ãxt_p
=-1;

1184 if(
´ev
!=
n_´Î
)

1186 
´ev_p
=0;

1187 
i
=
__dim__
-1;i>-1;i--)

1189 
´ev_p
+=((
İ_vec
[
i
]+(
´ev
/
B_´Î
[i])*(
N_s
[i]+1))%
N_p
[i])*
B_p
[i];

1190 
´ev
%=
B_´Î
[
i
];

1194 
´ev_p
=-1;

1198 
	}
}

1202 
	gPGCMC_2
::
	$decide
()

1204 if(
´ev_p
!=-1)

1206 
	`MPI_Recv
(&
št_buff_sz
,1,
MPI_INT
,
´ev_p
,0,*
gcmc_wÜld
,
MPI_STATUS_IGNORE
);

1207 
	`MPI_Recv
(
št_buff
,
št_buff_sz
,
MPI_INT
,
´ev_p
,1,*
gcmc_wÜld
,
MPI_STATUS_IGNORE
);

1211 
št_buff_sz
=2;

1212 
št_buff
[0]=0;

1213 
št_buff
[1]=
d–_ids_sz
;

1216 
sucûss
[0]=-1;

1217 
ty³0
 
çc
;

1218 if(
gcmc_mode
[0]==
INS_MODE
)

1222 
çc
=
z_çcA¼
[
igasTy³
]*
vŞ_lş
/(
¡©ic_ÿ¡
<
ty³0
>(
ngas_lşA¼
[igasTy³]+1)*
	`exp
(
b‘a
*
d–_u
));

1223 if(
lş_¿ndom
->
	`unifÜm
()<
çc
)

1229 
roÙ_succ
=
Œue
;

1230 
sucûss
[0]=0;

1231 
št_buff
[0]++;

1233 if(
št_buff_sz
>2)

1235 
Ãw_id
=
št_buff
[
št_buff_sz
-1];

1236 
št_buff_sz
--;

1240 if(
št_buff
[1]>0)

1241 
Ãw_id
=
d–_ids
[
št_buff
[1]-1];

1243 
Ãw_id
=
max_id
+1-
št_buff
[1];

1245 
št_buff
[1]--;

1253 if(
gcmc_mode
[0]==
DEL_MODE
)

1257 
çc
=
¡©ic_ÿ¡
<
ty³0
>(
ngas_lşA¼
[
igasTy³
])*
	`exp
(
b‘a
*
d–_u
)/(
z_çcA¼
[igasTy³]*
vŞ_lş
);

1258 if(
lş_¿ndom
->
	`unifÜm
()<
çc
)

1263 
roÙ_succ
=
Œue
;

1264 
sucûss
[0]=0;

1265 
št_buff
[0]--;

1266 
št_buff
[
št_buff_sz
]=
gas_id
;

1267 
št_buff_sz
++;

1271 if(
Ãxt_p
!=-1)

1273 
	`MPI_S’d
(&
št_buff_sz
,1,
MPI_INT
,
Ãxt_p
,0,*
gcmc_wÜld
);

1274 
	`MPI_S’d
(
št_buff
,
št_buff_sz
,
MPI_INT
,
Ãxt_p
,1,*
gcmc_wÜld
);

1277 if(
roÙ_succ
)

1279 if(
gcmc_mode
[0]==
INS_MODE
è
	`šs_succ
();

1280 if(
gcmc_mode
[0]==
DEL_MODE
è
	`d–_succ
();

1282 
	}
}

1286 
	gPGCMC_2
::
	$fš®ize
()

1288 
	`MPI_Bÿ¡
(&
št_buff_sz
,1,
MPI_INT
,
Üigš_p
,*
gcmc_wÜld
);

1289 
	`MPI_Bÿ¡
(
št_buff
,
št_buff_sz
,
MPI_INT
,
Üigš_p
,*
gcmc_wÜld
);

1292 if(
št_buff
[1]>0)

1293 
d–_ids_sz
=
št_buff
[1];

1296 
d–_ids_sz
=0;

1297 
max_id
-=
št_buff
[1];

1299 
	`add_d–_id
(
št_buff
+2,
št_buff_sz
-2);

1302 
ngasA¼
[
igasTy³
]+=
št_buff
[0];

1303 
©oms
->
Çtms
+=
št_buff
[0];

1304 
dof_diff
+=
št_buff
[0]*
__dim__
;

1305 
	}
}

	@pgcmc_2.h

1 #iâdeà
__MAPP__pgcmc_2__


2 
	#__MAPP__pgcmc_2__


	)

3 
	~"gcmc.h
"

4 
Çme¥aû
 
	gMAPP_NS


7 şas 
	cPGCMC_2
:
public
 
GCMC


9 
´iv©e
:

11 
ty³0
 
¿tio
;

12 
boŞ
 
	gdof_em±y
;

14 
	gN_c
[
__dim__
];

15 
	gN_s
[
__dim__
];

16 
	gN_cu¼_comms
[
__dim__
];

17 
	gi_cu¼_comms
[
__dim__
];

18 
boŞ
 
	g´Î_dim
[
__dim__
];

20 
	gmax_n_úücy
;

21 
	gmax_N_úücy
[
__dim__
];

23 
cÚ¡ex´
 
	gcomm_buff_size
=
__dim__
*(
ty³0
)+1;

24 
by‹
 
	gcomm_buff
[
comm_buff_size
];

26 
	g
;

27 
	gn_p
;

28 
	gİ_vec
[
__dim__
];

29 
	gp_vec
[
__dim__
];

30 
	gN_p
[
__dim__
];

31 
	gB_p
[
__dim__
];

33 
	gn_´Î
;

34 
	gN_´Î
[
__dim__
];

35 
	gB_´Î
[
__dim__
];

37 
	gn_pcomm
;

38 
	gN_pcomm
[
__dim__
];

39 
	gB_pcomm
[
__dim__
];

41 
	gn_comm
;

42 
	gN_comm
[
__dim__
];

43 
	gB_comm
[
__dim__
];

46 cÚ¡ 
	gm
;

51 
	gN_ûÎs
[
__dim__
];

52 
	gB_ûÎs
[
__dim__
];

53 
	giûÎ_coÜd
[
__dim__
];

54 
	gjûÎ_coÜd
[
__dim__
];

55 
ty³0
 
	gûÎ_size
[
__dim__
];

57 
–em_ty³
 
	g–em_buff
;

58 
	gigasTy³
 = 0;

64 * 
	g»l_Ãigh_l¡_coÜd
;

69 * 
	gh—d_©m
;

74 ** 
	gûÎ_coÜd_buff
;

75 
ty³0
** 
	gs_x_buff
;

76 
ty³0
** 
	gs_buff
;

81 * 
	gÁrŸl_©ms
;

82 * 
	groÙs
;

83 * 
	ggcmc_mode
;

84 
MPI_Comm
* 
	ggcmc_wÜld
;

85 
MPI_Comm
* 
	gcomms
;

86 
MPI_Comm
** 
	gcu¼_comms
;

87 ** 
	gcomm_id
;

88 
ty³0
** 
	glş_v¬s_comm
;

89 
ty³0
** 
	gv¬s_comm
;

90 * 
	gsucûss
;

91 * 
	gšt_buff
;

92 
	gšt_buff_sz
;

94 
	gj©m_Ãxt
;

95 
	gi£lf
;

96 
	gšeigh
;

97 
	gÂeighs
;

100 
	giûÎ
,
	gjûÎ
;

101 
	gn_ûÎs
;

104 
	gVec
<>* 
	gûÎ_vec_p
;

105 
	gVec
<>* 
	gÃxt_vec_p
;

107 
fšd_ûÎ_no
(
ty³0
*&,&);

108 
fšd_ûÎ_coÜd
(
ty³0
*&,*&);

111 
´•_s_x_buff
();

114 
Ãxt_j©m_»g
();

115 
Ãxt_j©m_£lf
();

116 (
	gPGCMC_2
::*
Ãxt_j©m_p
)();

118 
©tm±
();

124 
şass
 
Rªdom
* 
	glş_¿ndom
;

125 
	gn_v¬s
;

126 
	gn_s
;

128 
comms_£tup
(,);

129 
comms_dismªe
();

130 
ü—‹_comm_·‰”n
();

131 
	gn_cu¼_comms
;

132 
sucûss2g
();

133 
»£t_g
();

134 
	g´ev_p
,
	gÃxt_p
,
	gÜigš_p
;

135 
ty³0
 
	gd–_u
;

136 
	gÃw_id
;

137 
decide
();

138 
fš®ize
();

139 
¥l™_sšg
();

140 
¥l™_muÉ
();

144 
ty³0
 
	gvŞ_lş
;

145 
	g´Ùeùed
:

146 
šs_succ
();

147 
d–_succ
();

148 
box_£tup
();

149 
box_dismªe
();

150 
–em_ty³
 
	giGasTy³
;

153 
	gpublic
:

154 
PGCMC_2
(
şass
 
AtomsMD
*&, cÏs 
FÜûF›ldMD
*&,şas 
DyÇmicMD
*&,,
–em_ty³
,
ty³0
,type0,,elem_type,type0,type0);

155 ~
PGCMC_2
();

157 
š™
();

158 
fš
();

161 
xchng
(
boŞ
,);

163 
po¡_xchng
();

165 
Ãxt_Ÿtm
();

166 
Ãxt_j©m
();

167 
Ãxt_icomm
();

169 
»£t_Ÿtm
();

170 
»£t_j©m
();

171 
»£t_icomm
();

	@potfit.cpp

	@potfit.h

1 #iâdeà
__MAPP__pÙf™__


2 
	#__MAPP__pÙf™__


	)

3 
	~"ff_—m_pÙf™.h
"

4 
	~"©oms_md.h
"

5 
	~"mš_cg_pÙf™.h
"

6 
	~"ff_—m_f™.h
"

7 
	~"th”mo_dyÇmics.h
"

8 
	~"impÜt_cfg.h
"

9 
	~"¿ndom.h
"

10 
Çme¥aû
 
	gMAPP_NS


12 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

13 şas 
	cPÙF™


15 
	g´iv©e
:

16 
ty³0
* 
f
;

17 
ty³0
* 
	gh
;

18 
ty³0
* 
	gf0
;

19 
size_t
 
	gnv¬s
;

20 
	gÁ®ly
;

21 
	gÁrŸls
,
	gmax_ÁrŸls
;

22 
ty³0
 
	g”r_tŞ
;

23 
	gnmš_¡•s
;

24 cÚ¡ * 
	g”r_msgs
[];

25 
ty³0
* 
g‘_’_cÛfs
();

26 
ty³0
* 
g‘_f_cÛfs
();

27 
ty³0
* 
g‘_S_cÛfs
();

28 
boŞ
* 
g‘_H_dofs
();

29 
ty³0
* 
g‘_m—n_rho
(
–em_ty³
);

30 
Rªdom
* 
	g¿ndom
;

31 
	g´Ùeùed
:

32 
public
:

33 
FÜûF›ldEAMPÙF™
<
NELEMS
>* 
ff
;

34 
AtomsMD
* 
	g©oms
;

35 
MšCGPÙF™
* 
	gmš
;

36 
LšeS—rchB»Á
* 
	gmš_ls
;

38 
	gncÚfigs
;

39 
ty³0
* 
	g”rs
;

40 
ty³0
 
	gmy_§_”r
,
	g§_”r
;

41 * 
	groÙs
;

42 
	g¡d
::
¡ršg
* 
Çmes_¡r
;

43 cÚ¡ ** 
	gÇmes
;

45 
MPI_Comm
 
	gwÜld
;

46 
MPI_Comm
* 
	gmy_wÜld
;

47 
	gmy_¿nk
,
	gmy_cÚf
,
	gmy_lş_¿nk
;

49 
ty³0
 
	gf_cÛf
;

50 
ty³0
 
	gcÛf
[1+
__nvoigt__
];

51 
ty³0
 
	grg‘
[1+
__nvoigt__
];

52 
ty³0
 
	g”r
;

57 
	gVecT’s
<
	gty³0
,1> 
	gX0
;

58 
	gVecT’s
<
	gty³0
,1> 
	gXÜig
;

60 
PÙF™
(
PyObjeù
*,

61 
¡d
::
¡ršg
*&&,std::string*&,*&,

62 
ty³0
(*&)[1+
__nvoigt__
],

63 
PyObjeù
**,
size_t
,
MPI_Comm
&);

64 ~
PÙF™
();

66 
š™
();

67 
fš
();

68 
¡Üe_x0
();

69 
»¡Üe_x0
();

70 
fuÎ_»£t
();

71 
™”
();

72 
‹¡_d”iv
(
±rdiff_t
,
ty³0
,);

73 
mš_cg
();

74 
Ãw_cÚf
();

75 
ty³0
 
co¡
();

76 
ty³0
 
co¡_’_S_f
();

77 
mš_§
(,,,
ty³0
,type0);

78 
ls_´•
(
ty³0
&,type0&,type0&);

79 
ty³0
 
F
(type0);

80 
F_»£t
();

84 
Th”moDyÇmics
 
g‘_th”mo
(){
	gRET_POTFIT_THRMO
};

88 
PyObjeù_HEAD


89 
şass
 
	gPÙF™
<
	gFF
,
	gNELEMS
>* 
	gpÙf™
;

90 }
	tObjeù
;

92 
PyTy³Objeù
 
	gTy³Objeù
;

93 
£tup_
();

95 
PyObjeù
* 
__Ãw__
(
PyTy³Objeù
*,PyObject*, PyObject*);

96 
__š™__
(
PyObjeù
*, PyObject*,PyObject*);

97 
PyObjeù
* 
__®loc__
(
PyTy³Objeù
*,
Py_ssize_t
);

98 
__d—Îoc__
(
PyObjeù
*);

100 
PyG‘S‘Def
 
	gg‘£t
[];

101 
£tup__g‘£t
();

103 
g‘£t_A_phi
(
PyG‘S‘Def
& 
g‘£t
);

104 
g‘£t_dA_phi_max
(
PyG‘S‘Def
& 
g‘£t
);

105 
g‘£t_A_phi_dof
(
PyG‘S‘Def
& 
g‘£t
);

106 
g‘£t_A_rho
(
PyG‘S‘Def
& 
g‘£t
);

107 
g‘£t_dA_rho_max
(
PyG‘S‘Def
& 
g‘£t
);

108 
g‘£t_A_rho_dof
(
PyG‘S‘Def
& 
g‘£t
);

109 
g‘£t_A_F
(
PyG‘S‘Def
& 
g‘£t
);

110 
g‘£t_dA_F_max
(
PyG‘S‘Def
& 
g‘£t
);

111 
g‘£t_A_F_dof
(
PyG‘S‘Def
& 
g‘£t
);

113 
g‘£t_max_ÁrŸls
(
PyG‘S‘Def
&);

114 
g‘£t_Á®ly
(
PyG‘S‘Def
&);

115 
g‘£t_nmš_¡•s
(
PyG‘S‘Def
&);

116 
g‘£t_tŞ
(
PyG‘S‘Def
&);

117 
g‘£t_’_cÛfs
(
PyG‘S‘Def
&);

118 
g‘£t_f_cÛfs
(
PyG‘S‘Def
&);

119 
g‘£t_S_cÛfs
(
PyG‘S‘Def
&);

120 
g‘£t_H_dofs
(
PyG‘S‘Def
&);

121 
g‘£t_”rs
(
PyG‘S‘Def
&);

122 
g‘£t_”r
(
PyG‘S‘Def
&);

125 
PyM‘hodDef
 
	gm‘hods
[];

126 
£tup__m‘hods
();

127 
ml_mš_cg
(
PyM‘hodDef
&);

128 
ml_mš_§
(
PyM‘hodDef
&);

129 
ml_m—n_rho
(
PyM‘hodDef
&);

130 
ml_‹¡_A_phi
(
PyM‘hodDef
&);

131 
ml_‹¡_A_rho
(
PyM‘hodDef
&);

132 
ml_‹¡_A_F
(
PyM‘hodDef
&);

140 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

141 cÚ¡ * 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
”r_msgs
[]=

166 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

167 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
PÙF™
(
PyObjeù
* 
ff_¬gs
,

168 
¡d
::
¡ršg
*&& 
__Çmes_¡r
,¡d::¡ršg*& 
fes
,*& 
Årocs
,

169 
ty³0
(*& 
__rg‘s
)[1+
__nvoigt__
],

170 
PyObjeù
** 
dof_funcs
,
size_t
 
__ncÚfigs
,

171 
MPI_Comm
& 
__wÜld
):

172 
©oms
(
NULL
),

173 
	$wÜld
(
__wÜld
)

176 
Á®ly
=1;

177 
nmš_¡•s
=0;

178 
ÁrŸls
=0;

179 
max_ÁrŸls
=5;

180 
”r_tŞ
=1.0e-8;

182 
ncÚfigs
=
¡©ic_ÿ¡
<>(
__ncÚfigs
);

183 
Çmes_¡r
=
__Çmes_¡r
;

184 
__Çmes_¡r
=
NULL
;

185 
MemÜy
::
	`®loc
(
”rs
,
__ncÚfigs
);

186 
MemÜy
::
	`®loc
(
roÙs
,
__ncÚfigs
);

187 
MemÜy
::
	`®loc
(
Çmes
,
__ncÚfigs
);

188 
	`MPI_Comm_¿nk
(
wÜld
,&
my_¿nk
);

192 
tÙ_Åroc
=0;

193 
my_cÚf
=0;

194 
my_lş_¿nk
=0;

195 
i
=0;i<
ncÚfigs
;i++)

197 
Çmes
[
i
]=
Çmes_¡r
[i].
	`c_¡r
();

198 if(
tÙ_Åroc
<=
my_¿nk
 && my_¿nk<tÙ_Åroc+
Årocs
[
i
])

200 
my_cÚf
=
i
;

201 
my_lş_¿nk
=
my_¿nk
-
tÙ_Åroc
;

203 
roÙs
[
i
]=
tÙ_Åroc
;

204 
tÙ_Åroc
+=
Årocs
[
i
];

208 
my_wÜld
=
Ãw
 
MPI_Comm
;

209 
	`MPI_Comm_¥l™
(
wÜld
,
my_cÚf
,
my_lş_¿nk
,
my_wÜld
);

213 
Algeb¿
::
Do
<1+
__nvoigt__
>::
	`func
([
this
](
i
){
cÛf
[i]=1.0;});

214 
f_cÛf
=0.0;

215 
Algeb¿
::
z”o
<1+
__nvoigt__
>(
cÛf
);

216 
cÛf
[0]=1.0;

217 
Algeb¿
::
V_eq
<1+
__nvoigt__
>(
__rg‘s
[
my_cÚf
],
rg‘
);

220 
ImpÜtCFGMD
 
	`»ad
(*
my_wÜld
);

221 
©oms
=
	`»ad
(
fes
[
my_cÚf
].
	`c_¡r
());

222 if(
dof_funcs
[
my_cÚf
]è
©oms
->
	`DO
(dof_funcs[my_conf]);

223 
ff
=
FF
::
	`g‘_Ãw_ff
(
©oms
,
ff_¬gs
,
NULL
);

225 
boŞ
 
H_dof
[
__dim__
][__dim__];

226 
i
=0;i<
__dim__
;i++è
j
=0;j<__dim__;j++è
H_dof
[i][j]=
çl£
;

227 
H_dof
[0][0]=H_dof[1][1]=H_dof[2][2]=
Œue
;

229 
XÜig
.~
	`VecT’s
();

230 
	`Ãw
 (&
XÜig
è
VecT’s
<
ty³0
,1>(
©oms
,
Œue
,
__dim__
);

231 
X0
.~
	`VecT’s
();

232 
	`Ãw
 (&
X0
è
VecT’s
<
ty³0
,1>(
©oms
,
Œue
,
__dim__
);

234 
mš_ls
=
Ãw
 
	`LšeS—rchB»Á
();

235 
mš
=
Ãw
 
	`MšCGPÙF™
(0.0,
H_dof
,
çl£
,0.4,
mš_ls
,
XÜig
.
vecs
[0],
X0
.vecs[0]);

236 
mš
->
©oms
=atoms;

237 
mš
->
ff
=ff;

239 
	`memıy
(
XÜig
.
vecs
[0]->
	`begš
(),
©oms
->
x
->begš(),(
ty³0
)*
__dim__
*©oms->
Çtms_lş
);

240 
	`memıy
(&
XÜig
.
A
[0][0],&
©oms
->
H
[0][0],(
ty³0
)*
__dim__
*__dim__);

242 
f
=
ff
->
fvs
;

243 
f0
=
ff
->
f0vs
;

244 
h
=
ff
->
hvs
;

245 
nv¬s
=
ff
->
nvs
;

246 
	}
}

250 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

251 
	gPÙF™
<
	gFF
,
	gNELEMS
>::~
	$PÙF™
()

253 
XÜig
.~
	`VecT’s
();

254 
X0
.~
	`VecT’s
();

256 
d–‘e
 
mš_ls
;

258 
d–‘e
 
mš
;

260 
d–‘e
 
ff
;

261 
d–‘e
 
©oms
;

262 
	`MPI_Comm_ä“
(
my_wÜld
);

263 
d–‘e
 
my_wÜld
;

266 
MemÜy
::
	`d—Îoc
(
roÙs
);

267 
MemÜy
::
	`d—Îoc
(
”rs
);

268 *
Çmes
=
NULL
;

269 
MemÜy
::
	`d—Îoc
(
Çmes
);

270 
MemÜy
::
	`d—Îoc
(
Çmes_¡r
);

271 
	}
}

275 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

276 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$š™
()

278 
mš
->
	`š™
();

279 
	}
}

283 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

284 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$fš
()

286 
mš
->
	`fš
();

287 
	}
}

291 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

292 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$Ãw_cÚf
()

294 
boŞ
 
v®id
=
çl£
;

295 !
v®id
)

297 
size_t
 
i
=0;i<
ff
->
nuniq_phi_±rs
;i++)

298 
ff
->
uniq_phi_±r
[
i
]->
	`¿ndom_Ãigh
(
¿ndom
);

299 
size_t
 
i
=0;i<
ff
->
nuniq_F_±rs
;i++)

300 
ff
->
uniq_F_±r
[
i
]->
	`¿ndom_Ãigh
(
¿ndom
);

301 
size_t
 
i
=0;i<
ff
->
nuniq_rho_±rs
;i++)

302 
ff
->
uniq_rho_±r
[
i
]->
	`¿ndom_Ãigh
(
¿ndom
);

304 
size_t
 
i
=0;i<
nv¬s
;i++)

305 if(!
ff
->
dofs
[
i
]è
h
[i]=0.0;

307 
size_t
 
i
=0;i<
nv¬s
;i++)

308 
ff
->
vs
[
i
]=ff->
v0s
[i]+
h
[i];

310 
v®id
=
Œue
;

311 
size_t
 
i
=0;i<
ff
->
nuniq_phi_±rs
 && 
v®id
;i++)

312 
v®id
=
ff
->
uniq_phi_±r
[
i
]->
	`v®id©e
();

313 
size_t
 
i
=0;i<
ff
->
nuniq_F_±rs
 && 
v®id
;i++)

314 
v®id
=
ff
->
uniq_F_±r
[
i
]->
	`v®id©e
();

315 
size_t
 
i
=0;i<
ff
->
nuniq_rho_±rs
 && 
v®id
;i++)

316 
v®id
=
ff
->
uniq_rho_±r
[
i
]->
	`v®id©e
();

319 
	}
}

323 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

324 
ty³0
 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$co¡
()

326 
ty³0
 
”r_lş
;

327 
my_§_”r
=
ff
->
	`v®ue_tim”
()-
rg‘
[0];

328 if(
my_lş_¿nk
==0è
”r_lş
=
cÛf
[0]*
Algeb¿
::
pow
<2>(
my_§_”r
);

329 
	`MPI_AÎ»duû
(&
”r_lş
,&
§_”r
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

330  
§_”r
;

331 
	}
}

335 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

336 
ty³0
 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$co¡_’_S_f
()

338 
ty³0
 
”r_lş
,
”r_lş_lş
;

339 
ty³0
* 
cu¼_v®
=
ff
->
	`d”iv©ive
();

340 
my_§_”r
=
cu¼_v®
[0]-
rg‘
[0];

341 
ty³0
* 
f_vec
=
ff
->
f
->
	`begš
();

342 
”r_lş_lş
=0.0;

343 
i
=0;i<
©oms
->
Çtms_lş
*
__dim__
;i++è
”r_lş_lş
+=
f_vec
[i]*f_vec[i];

344 
	`MPI_AÎ»duû
(&
”r_lş_lş
,&
”r_lş
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,*
my_wÜld
);

345 
”r_lş
*=
f_cÛf
/
¡©ic_ÿ¡
<
ty³0
>(
©oms
->
Çtms
);

346 
Algeb¿
::
Do
<1+
__nvoigt__
>::
	`func
([
this
,&
”r_lş
,&
cu¼_v®
](
i
)

347 { 
”r_lş
+=
cÛf
[
i
]*(
cu¼_v®
[i]-
rg‘
[i])*(curr_val[i]-target[i]);});

348 if(
my_lş_¿nk
!=0è
”r_lş
=0.0;

349 
	`MPI_AÎ»duû
(&
”r_lş
,&
§_”r
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

350  
§_”r
;

351 
	}
}

355 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

356 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$mš_§
(
£ed
,
n¡•s
,
ÁrŸls
,
ty³0
 
‹mp
,ty³0 
gamma
)

360 
¿ndom
=
Ãw
 
	`Rªdom
 (
£ed
);

362 
ty³0
 
Şd_skš
=
©oms
->
comm
.
skš
;

363 
©oms
->
comm
.
skš
=0.0001;

364 
	`š™
();

366 
ty³0
 
dc
,
c_n
,
c_o
;

367 
c_o
=
	`co¡_’_S_f
();

368 
”rs
[
my_cÚf
]=
my_§_”r
;

369 
”r
=
§_”r
;

370 
i
=0;i<
ncÚfigs
;i++)

371 
	`MPI_Bÿ¡
(&
”rs
[
i
],1,
Vec
<
ty³0
>::
MPI_T
,
roÙs
[i],
wÜld
);

373 
Th”moDyÇmics
 
th”mo
=
	`g‘_th”mo
();

374 
th”mo
.
	`š™
();

375 if(
Á®ly
è
th”mo
.
	`´št
(0);

376 
i¡•
=0;i¡•<
n¡•s
;istep++)

379 
j
=0;j<
ÁrŸls
;j++)

381 
	`memıy
(
ff
->
v0s
,ff->
vs
,
nv¬s
*(
ty³0
));

383 
	`Ãw_cÚf
();

384 
c_n
=
	`co¡_’_S_f
();

385 
dc
=
c_n
-
c_o
;

387 if(
¿ndom
->
	`unifÜm
()>=
	`exp
(-
dc
/
‹mp
))

388 
	`memıy
(
ff
->
vs
,ff->
v0s
,
nv¬s
*(
ty³0
));

391 
c_o
=
c_n
;

392 
”rs
[
my_cÚf
]=
my_§_”r
;

393 
”r
=
§_”r
;

397 
i
=0;i<
ncÚfigs
;i++)

398 
	`MPI_Bÿ¡
(&
”rs
[
i
],1,
Vec
<
ty³0
>::
MPI_T
,
roÙs
[i],
wÜld
);

400 if(
Á®ly
 && (
i¡•
+1)%Á®ly==0è
th”mo
.
	`´št
(istep+1);

401 
‹mp
*=
gamma
;

404 if(
Á®ly
 && 
n¡•s
%Á®lyè
th”mo
.
	`´št
(nsteps);

405 
th”mo
.
	`fš
();

407 
d–‘e
 
¿ndom
;

408 
¿ndom
=
NULL
;

409 
	`fš
();

410 
©oms
->
comm
.
skš
=
Şd_skš
;

411 
	}
}

415 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

416 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$mš_cg
(
n¡•s
)

418 
	`š™
();

419 
Th”moDyÇmics
 
th”mo
=
	`g‘_th”mo
();

421 
ty³0
 
cu¼_”r
,
´ev_”r
,
f0_f0
,
f_f0
,
f_f
,
f_h
,
¿tio
,
®pha
,
tŞ
=1.0e-12;

422 
	`™”
();

423 
cu¼_”r
=
”r
;

424 
	`memıy
(
h
,
f
,
nv¬s
*(
ty³0
));

425 
f0_f0
=0.0;

426 
size_t
 
i
=0;i<
nv¬s
;i++è
f0_f0
+=
f
[i]*f[i];

428 
i¡•
=0;

429 
th”mo
.
	`š™
();

430 if(
Á®ly
è
th”mo
.
	`´št
(0);

431 
ERR
=
n¡•s
==0? 
MIN_F_MAX_ITER
:
LS_S
;

432 ;
ERR
==
LS_S
;
i¡•
++)

434 if(
f0_f0
==0.0)

436 
ERR
=
LS_F_GRAD0
;

440 
	`¡Üe_x0
();

442 
	`memıy
(
f0
,
f
,
nv¬s
*(
ty³0
));

443 
´ev_”r
=
cu¼_”r
;

444 
f_h
=0.0;

445 
size_t
 
i
=0;i<
nv¬s
;i++è
f_h
+=
f
[i]*
h
[i];

446 if(
f_h
<0.0)

448 
	`memıy
(
h
,
f
,
nv¬s
*(
ty³0
));

449 
f_h
=
f0_f0
;

455 
ERR
=
mš_ls
->
	`mš
(
this
,
cu¼_”r
,
®pha
,1);

457 if(
ERR
!=
LS_S
)

461 
i¡•
--;

464 
	`™”
();

465 
cu¼_”r
=
”r
;

466 if(
Á®ly
 && (
i¡•
+1)%Á®ly==0è
th”mo
.
	`´št
(istep+1);

468 if(
´ev_”r
-
cu¼_”r
<
tŞ
 || cu¼_”r<
”r_tŞ
è
ERR
=
MIN_S_TOLERANCE
;

469 if(
i¡•
+1==
n¡•s
è
ERR
=
MIN_F_MAX_ITER
;

470 if(
ERR
) ;

472 
f_f
=0.0;

473 
size_t
 
i
=0;i<
nv¬s
;i++è
f_f
+=
f
[i]*f[i];

474 
f_f0
=0.0;

475 
size_t
 
i
=0;i<
nv¬s
;i++è
f_f0
+=
f
[i]*
f0
[i];

476 
¿tio
=(
f_f
-
f_f0
)/(
f0_f0
);

477 
j
=0;j<
nv¬s
;j++è
h
[j]=
¿tio
*h[j]+
f
[j];

479 
f0_f0
=
f_f
;

481 if(
Á®ly
 && 
n¡•s
%Á®lyè
th”mo
.
	`´št
(nsteps);

482 
th”mo
.
	`fš
();

483 
	`årštf
(
MAPP
::
m­p_out
,"%s",
”r_msgs
[
ERR
]);

484 
	`fš
();

485 
	}
}

493 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

494 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$ls_´•
(
ty³0
& 
dç
,ty³0& 
h_nÜm
,ty³0& 
max_a
)

498 
max_a
=
¡d
::
num”ic_lim™s
<
ty³0
>::
	`šfš™y
();

499 
size_t
 
i
=0;i<
ff
->
nuniq_phi_±rs
;i++)

500 
ff
->
uniq_phi_±r
[
i
]->
	`fšd_max_®pha
(
max_a
);

501 
size_t
 
i
=0;i<
ff
->
nuniq_F_±rs
;i++)

502 
ff
->
uniq_F_±r
[
i
]->
	`fšd_max_®pha
(
max_a
);

503 
size_t
 
i
=0;i<
ff
->
nuniq_rho_±rs
;i++)

504 
ff
->
uniq_rho_±r
[
i
]->
	`fšd_max_®pha
(
max_a
);

506 
h_nÜm
=0.0;

507 
size_t
 
i
=0;i<
nv¬s
;i++è
h_nÜm
+=
h
[i]*h[i];

509 
dç
=0.0;

510 
size_t
 
i
=0;i<
nv¬s
;i++è
dç
-=
f
[i]*
h
[i];

513 if(
h_nÜm
==0.0)

515 
max_a
=0.0;

516 
dç
=0.0;

520 if(
dç
>=0.0)

522 
max_a
=0.0;

523 
dç
=1.0;

527 
h_nÜm
=
	`sq¹
(h_norm);

529 
	}
}

533 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

534 
ty³0
 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$F
(
ty³0
 
®pha
)

537 if(
ÁrŸls
%
max_ÁrŸls
==0è
	`fuÎ_»£t
();

538 
ÁrŸls
++;

540 
size_t
 
i
=0;i<
nv¬s
;i++)

541 
ff
->
vs
[
i
]=ff->
v0s
[i]+
®pha
*
h
[i];

543 
mš
->
	`run
(
nmš_¡•s
);

544 
ty³0
 
”r_lş
=0.0;

545 if(
my_lş_¿nk
==0è
”r_lş
=
cÛf
[0]*
Algeb¿
::
pow
<2>(
©oms
->
³
-
rg‘
[0]);

546 
	`MPI_AÎ»duû
(&
”r_lş
,&
”r
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

547  
”r
;

548 
	}
}

552 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

553 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$‹¡_d”iv
(
±rdiff_t
 
off£t
,
ty³0
 
d–
,
n¡•s
)

555 
	`š™
();

556 
__max_ÁrŸls
=
max_ÁrŸls
;

557 
__nmš_¡•s
=
nmš_¡•s
;

558 
max_ÁrŸls
=9999999;

559 
nmš_¡•s
=0;

560 
ÁrŸls
=1;

562 
	`fuÎ_»£t
();

563 
	`¡Üe_x0
();

564 
	`™”
();

565 
ty³0
 
”r0
=
”r
;

566 
ty³0
 
d”iv
=-
f
[
off£t
];

567 
size_t
 
i
=0;i<
nv¬s
;i++)

568 
h
[
i
]=0.0;

569 
h
[
off£t
]=1.0;

570 
ty³0
 
D–X
=0.0,
D–ERR
,
DERRDX
;

571 
Th”moDyÇmics
 
	`th”mo
(6,"D–X",
D–X
,"D–ERR",
D–ERR
,"DERR*DX",
DERRDX
);

572 
th”mo
.
	`š™
();

573 
i
=0;i<
n¡•s
;i++)

575 
D–ERR
=
	`F
(
D–X
)-
”r0
;

576 
DERRDX
=
D–X
*
d”iv
;

577 
th”mo
.
	`´št
(
i
);

578 
D–X
+=
d–
;

580 
th”mo
.
	`fš
();

581 
	`»¡Üe_x0
();

583 
max_ÁrŸls
=
__max_ÁrŸls
;

584 
nmš_¡•s
=
__nmš_¡•s
;

586 
	`fš
();

587 
	}
}

591 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

592 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$™”
()

594 if(
ÁrŸls
%
max_ÁrŸls
==0è
	`fuÎ_»£t
();

595 
ÁrŸls
++;

596 
mš
->
	`run
(
nmš_¡•s
);

597 
ff
->
	`’”gy_g¿d›Á
();

598 
ty³0
 
”r_lş
=0.0;

599 if(
my_lş_¿nk
==0)

601 
”r_lş
=
cÛf
[0]*
Algeb¿
::
pow
<2>(
©oms
->
³
-
rg‘
[0]);

602 
size_t
 
i
=0;i<
nv¬s
;i++è
ff
->
dvs
[i]*=-2.0*
cÛf
[0]*(
©oms
->
³
-
rg‘
[0]);

603 
”rs
[
my_cÚf
]=
©oms
->
³
-
rg‘
[0];

605 
	`MPI_AÎ»duû
(
ff
->
dvs
,
f
,
¡©ic_ÿ¡
<>(
nv¬s
),
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

606 
	`MPI_AÎ»duû
(&
”r_lş
,&
”r
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

607 
i
=0;i<
ncÚfigs
;i++è
	`MPI_Bÿ¡
(&
”rs
[i],1,
Vec
<
ty³0
>::
MPI_T
,
roÙs
[i],
wÜld
);

608 
	}
}

612 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

613 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$F_»£t
()

615 
	`»¡Üe_x0
();

616 if(
ÁrŸls
%
max_ÁrŸls
==0è
	`fuÎ_»£t
();

617 
ÁrŸls
++;

618 
mš
->
	`run
(
nmš_¡•s
);

619 
	}
}

623 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

624 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$¡Üe_x0
()

626 
	`memıy
(
ff
->
v0s
,ff->
vs
,
nv¬s
*(
ty³0
));

627 
	`memıy
(
X0
.
vecs
[0]->
	`begš
(),
©oms
->
x
->begš(),(
ty³0
)*
__dim__
*©oms->
Çtms_lş
);

628 
	`memıy
(&
X0
.
A
[0][0],&
©oms
->
H
[0][0],(
ty³0
)*
__dim__
*__dim__);

629 
	}
}

633 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

634 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$»¡Üe_x0
()

636 
	`memıy
(
ff
->
vs
,ff->
v0s
,
nv¬s
*(
ty³0
));

637 
	`memıy
(
©oms
->
x
->
	`begš
(),
X0
.
vecs
[0]->begš(),(
ty³0
)*
__dim__
*©oms->
Çtms_lş
);

638 
	`memıy
(&
©oms
->
H
[0][0],&
X0
.
A
[0][0],(
ty³0
)*
__dim__
*__dim__);

639 
©oms
->
	`upd©e_H
();

640 #ifdeà
OLD_UPDATE


641 
mš
->
dyÇmic
->
	`upd©e
(
©oms
->
x
);

643 
mš
->
dyÇmic
->
upd©e
<
Œue
>();

645 
	}
}

649 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

650 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$fuÎ_»£t
()

652 
	`memıy
(
©oms
->
x
->
	`begš
(),
XÜig
.
vecs
[0]->begš(),(
ty³0
)*
__dim__
*©oms->
Çtms_lş
);

653 
	`memıy
(&
©oms
->
H
[0][0],&
XÜig
.
A
[0][0],(
ty³0
)*
__dim__
*__dim__);

654 
©oms
->
	`upd©e_H
();

655 #ifdeà
OLD_UPDATE


656 
mš
->
dyÇmic
->
	`upd©e
(
©oms
->
x
);

658 
mš
->
dyÇmic
->
upd©e
<
Œue
>();

660 
	}
}

664 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

665 
ty³0
* 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$g‘_’_cÛfs
()

667 
ty³0
* 
__’_cÛfs
=
NULL
;

669 
MemÜy
::
	`®loc
(
__’_cÛfs
,
ncÚfigs
);

670 
__’_cÛfs
[
my_cÚf
]=
cÛf
[0];

671 
i
=0;i<
ncÚfigs
;i++)

672 
	`MPI_Bÿ¡
(&
__’_cÛfs
[
i
],1,
Vec
<
ty³0
>::
MPI_T
,
roÙs
[i],
wÜld
);

674  
__’_cÛfs
;

675 
	}
}

679 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

680 
ty³0
* 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$g‘_f_cÛfs
()

682 
ty³0
* 
__f_cÛfs
=
NULL
;

684 
MemÜy
::
	`®loc
(
__f_cÛfs
,
ncÚfigs
);

685 
__f_cÛfs
[
my_cÚf
]=
f_cÛf
;

686 
i
=0;i<
ncÚfigs
;i++)

687 
	`MPI_Bÿ¡
(&
__f_cÛfs
[
i
],1,
Vec
<
ty³0
>::
MPI_T
,
roÙs
[i],
wÜld
);

689  
__f_cÛfs
;

690 
	}
}

694 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

695 
ty³0
* 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$g‘_S_cÛfs
()

697 
	`ty³0
(* 
__S_cÛfs
)[
__dim__
][__dim__]=
NULL
;

699 
MemÜy
::
	`®loc
(
__S_cÛfs
,
ncÚfigs
);

701 
Algeb¿
::
	`DyadicV_2_MSY
(
cÛf
+1,
__S_cÛfs
[
my_cÚf
]);

702 
i
=0;i<
ncÚfigs
;i++)

703 
	`MPI_Bÿ¡
(&
__S_cÛfs
[
i
][0][0],
__dim__
*__dim__,
Vec
<
ty³0
>::
MPI_T
,
roÙs
[i],
wÜld
);

705  &
__S_cÛfs
[0][0][0];

706 
	}
}

710 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

711 
boŞ
* 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$g‘_H_dofs
()

713 
	`boŞ
(* 
__H_dofs
)[
__dim__
][__dim__]=
NULL
;

714 
MemÜy
::
	`®loc
(
__H_dofs
,
ncÚfigs
);

715 
mš
->
	`g‘_H_dof
(
__H_dofs
[
my_cÚf
]);

716 
i
=0;i<
ncÚfigs
;i++)

717 
	`MPI_Bÿ¡
(&
__H_dofs
[
i
][0][0],
__dim__
*__dim__,
Vec
<
boŞ
>::
MPI_T
,
roÙs
[i],
wÜld
);

719  &
__H_dofs
[0][0][0];

720 
	}
}

724 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

725 
ty³0
* 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$g‘_m—n_rho
(
–em_ty³
 
›Ëm
)

727 
ty³0
* 
__m—n_rhos
=
NULL
;

729 
MemÜy
::
	`®loc
(
__m—n_rhos
,
ncÚfigs
);

730 
__m—n_rhos
[
my_cÚf
]=
ff
->
	`m—n_rho
(
›Ëm
);

731 
i
=0;i<
ncÚfigs
;i++)

732 
	`MPI_Bÿ¡
(&
__m—n_rhos
[
i
],1,
Vec
<
ty³0
>::
MPI_T
,
roÙs
[i],
wÜld
);

734  
__m—n_rhos
;

735 
	}
}

739 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

740 
PyObjeù
* 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$__Ãw__
(
PyTy³Objeù
* 
ty³
,
PyObjeù
* 
¬gs
,PyObjeù* 
kwds
)

742 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
ty³
->
	`_®loc
(type,0));

743 
PyObjeù
* 
£lf
=
»š‹½»t_ÿ¡
<PyObjeù*>(
__£lf
);

744  
£lf
;

745 
	}
}

749 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

750 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$__š™__
(
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)

754 
FuncAPI
<
OB
<
PyLi¡Objeù
,
PyLi¡_Ty³
>,OB<PyListObject,PyList_Type>>

755 
	`f
("__init__",{

759 if(
	`f
(
¬gs
,
kwds
))  -1;

761 
PyObjeù
* 
cÚfigs
=
f
.
v®
<1>();

762 
size_t
 
ncÚfigs
=
	`PyLi¡_Size
(
cÚfigs
);

763 
¡d
::
¡ršg
* 
Çmes
;

764 
MemÜy
::
	`®loc
(
Çmes
,
ncÚfigs
);

765 
¡d
::
¡ršg
* 
fes
;

766 
MemÜy
::
	`®loc
(
fes
,
ncÚfigs
);

767 * 
Årocs
;

768 
MemÜy
::
	`®loc
(
Årocs
,
ncÚfigs
);

769 
	`ty³0
(* 
rg‘s
)[1+
__nvoigt__
];

770 
MemÜy
::
	`®loc
(
rg‘s
,
ncÚfigs
);

771 
PyObjeù
** 
funcs
;

772 
MemÜy
::
	`®loc
(
funcs
,
ncÚfigs
);

775 
tÙ_Åroc
=0;

776 
size_t
 
i
=0;i<
ncÚfigs
;i++)

778 
PyObjeù
* 
cÚfig
=
	`PyLi¡_G‘I‹m
(
cÚfigs
,
i
);

779 
FuncAPI
<
¡d
::
¡ršg
,std::string,

781 
ty³0
,
symm
<ty³0[
__dim__
][__dim__]>,

782 
OB
<
PyFunùiÚObjeù
,
PyFunùiÚ_Ty³
>>

783 
	`cÚf
("configurationuple",{"name","cfg_file","nproc","pe_target","S_target","dof_func"});

785 
cÚf
.
v®
<5>()=
NULL
;

786 
cÚf
.
nİtiÚ®s
=1;

787 if(
	`cÚf
(
cÚfig
,
NULL
))

789 
MemÜy
::
	`d—Îoc
(
Çmes
);

790 
MemÜy
::
	`d—Îoc
(
fes
);

791 
MemÜy
::
	`d—Îoc
(
rg‘s
);

792 *
funcs
=
NULL
;

793 
MemÜy
::
	`d—Îoc
(
funcs
);

796 
Çmes
[
i
]=
cÚf
.
v®
<0>();

797 
fes
[
i
]=
cÚf
.
v®
<1>();

798 
Årocs
[
i
]=
cÚf
.
v®
<2>();

799 
rg‘s
[
i
][0]=
cÚf
.
v®
<3>();

800 
Algeb¿
::
	`MSY_2_DyadicV
(
cÚf
.
v®
<4>(),&
rg‘s
[
i
][1]);

801 
funcs
[
i
]=
cÚf
.
v®
<5>();

802 
tÙ_Åroc
+=
Årocs
[
i
];

805 
MPI_Comm
 
wÜld
=
MPI_COMM_WORLD
;

806 
comm_size
;

807 
	`MPI_Comm_size
(
wÜld
,&
comm_size
);

808 if(
tÙ_Åroc
!=
comm_size
)

810 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"numb” oà´oûssÜ dØnÙ m©ch:‡vaabË: %d v »que¡ed: %d",
comm_size
,
tÙ_Åroc
);

811 
MemÜy
::
	`d—Îoc
(
Çmes
);

812 
MemÜy
::
	`d—Îoc
(
fes
);

813 
MemÜy
::
	`d—Îoc
(
rg‘s
);

814 *
funcs
=
NULL
;

815 
MemÜy
::
	`d—Îoc
(
funcs
);

822 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

823 
__£lf
->
pÙf™
=
Ãw
 
PÙF™
<
FF
,
NELEMS
>(
f
.
v®
<0>(),
¡d
::
	`move
(
Çmes
),
fes
,
Årocs
,
rg‘s
,
funcs
,
ncÚfigs
,
wÜld
);

824 
MemÜy
::
	`d—Îoc
(
Çmes
);

825 
MemÜy
::
	`d—Îoc
(
fes
);

826 
MemÜy
::
	`d—Îoc
(
rg‘s
);

827 *
funcs
=
NULL
;

828 
MemÜy
::
	`d—Îoc
(
funcs
);

831 
	}
}

835 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

836 
PyObjeù
* 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$__®loc__
(
PyTy³Objeù
* 
ty³
,
Py_ssize_t
)

838 
Objeù
* 
__£lf
=
Ãw
 Object;

839 
	`Py_TYPE
(
__£lf
)=
ty³
;

840 
	`Py_REFCNT
(
__£lf
)=1;

841 
__£lf
->
pÙf™
=
NULL
;

842  
»š‹½»t_ÿ¡
<
PyObjeù
*>(
__£lf
);

843 
	}
}

847 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

848 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$__d—Îoc__
(
PyObjeù
* 
£lf
)

850 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

851 
d–‘e
 
__£lf
->
pÙf™
;

852 
__£lf
->
pÙf™
=
NULL
;

853 
d–‘e
 
__£lf
;

854 
	}
}

856 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

857 
PyTy³Objeù
 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
Ty³Objeù
={
PyObjeù_HEAD_INIT
(
NULL
)};

859 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

860 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$£tup_
()

862 
Ty³Objeù
.
_Çme
="mapp.potfit";

863 
Ty³Objeù
.
_doc
="";

865 
Ty³Objeù
.
_æags
=
Py_TPFLAGS_DEFAULT
;

866 
Ty³Objeù
.
_basicsize
=(
Objeù
);

868 
Ty³Objeù
.
_Ãw
=
__Ãw__
;

869 
Ty³Objeù
.
_š™
=
__š™__
;

870 
Ty³Objeù
.
_®loc
=
__®loc__
;

871 
Ty³Objeù
.
_d—Îoc
=
__d—Îoc__
;

872 
	`£tup__m‘hods
();

873 
Ty³Objeù
.
_m‘hods
=
m‘hods
;

874 
	`£tup__g‘£t
();

875 
Ty³Objeù
.
_g‘£t
=
g‘£t
;

877 
ichk
=
	`PyTy³_R—dy
(&
Ty³Objeù
);

878 if(
ichk
<0)  ichk;

879 
	`Py_INCREF
(&
Ty³Objeù
);

885 
	`GET_WRAPPER_DOC
(
Ty³Objeù
,
__š™__
)=
NULL
;

886  
ichk
;

887 
	}
}

889 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

890 
PyG‘S‘Def
 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
g‘£t
[]=
Em±yPyG‘S‘Def
(20);

892 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

893 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$£tup__g‘£t
()

895 
	`g‘£t_A_phi
(
g‘£t
[0]);

896 
	`g‘£t_dA_phi_max
(
g‘£t
[1]);

897 
	`g‘£t_A_phi_dof
(
g‘£t
[2]);

898 
	`g‘£t_A_rho
(
g‘£t
[3]);

899 
	`g‘£t_dA_rho_max
(
g‘£t
[4]);

900 
	`g‘£t_A_rho_dof
(
g‘£t
[5]);

901 
	`g‘£t_A_F
(
g‘£t
[6]);

902 
	`g‘£t_dA_F_max
(
g‘£t
[7]);

903 
	`g‘£t_A_F_dof
(
g‘£t
[8]);

906 
	`g‘£t_Á®ly
(
g‘£t
[9]);

907 
	`g‘£t_max_ÁrŸls
(
g‘£t
[10]);

908 
	`g‘£t_nmš_¡•s
(
g‘£t
[11]);

909 
	`g‘£t_tŞ
(
g‘£t
[12]);

910 
	`g‘£t_’_cÛfs
(
g‘£t
[13]);

911 
	`g‘£t_f_cÛfs
(
g‘£t
[14]);

912 
	`g‘£t_S_cÛfs
(
g‘£t
[15]);

913 
	`g‘£t_H_dofs
(
g‘£t
[16]);

914 
	`g‘£t_”rs
(
g‘£t
[17]);

915 
	`g‘£t_”r
(
g‘£t
[18]);

916 
	}
}

920 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

921 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$g‘£t_A_phi
(
PyG‘S‘Def
& 
g‘£t
)

923 
g‘£t
.
Çme
=(*)"A_phi";

924 
g‘£t
.
doc
=(*)"";

925 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

927 
PÙF™
<
FF
,
NELEMS
>* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

928 
PyObjeù
* 
py_obj
=
	`PyLi¡_New
(
NELEMS
);

929 
size_t
 
i
=0;i<
NELEMS
;i++)

930 
	`PyLi¡_SET_ITEM
(
py_obj
,
i
,
	`PyLi¡_New
(
NELEMS
));

931 
size_t
 
i
=0;i<
NELEMS
;i++)

932 
size_t
 
j
=0;j<
NELEMS
;j++)

933 
	`PyLi¡_SET_ITEM
(
	`PyLi¡_GET_ITEM
(
py_obj
,
i
),
j
,
pÙf™
->
ff
->
phi_±r
[i][j]->
	`g‘_A
());

935  
py_obj
;

937 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

939 
PÙF™
<
FF
,
NELEMS
>* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

940 
V¬API
<
OB
<
PyLi¡Objeù
,
PyLi¡_Ty³
>> 
	`v¬
("A_phi");

941 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

942 
PyObjeù
* 
py_ob
=
v¬
.
v®
;

943 
size_t
 
ÃËms
=
	`PyLi¡_Size
(
py_ob
);

944 if(
ÃËms
!=
NELEMS
)

946 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"size mismatch in A_phi");

950 
size_t
 
i
=0;i<
ÃËms
;i++)

951 if(
	`PyLi¡_Size
(
	`PyLi¡_GET_ITEM
(
py_ob
,
i
))!=
NELEMS
)

953 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"size mismatch in A_phi");

957 
size_t
 
i
=0;i<
ÃËms
;i++)

958 
size_t
 
j
=0;j<
ÃËms
;j++)

959 if(
pÙf™
->
ff
->
phi_±r
[
i
][
j
]->
	`£t_A
(
	`PyLi¡_GET_ITEM
(PyLi¡_GET_ITEM(
py_ob
,i),j))!=0)

966 
	}
}

970 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

971 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$g‘£t_dA_phi_max
(
PyG‘S‘Def
& 
g‘£t
)

973 
g‘£t
.
Çme
=(*)"dA_phi_max";

974 
g‘£t
.
doc
=(*)"";

975 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

977 
PÙF™
<
FF
,
NELEMS
>* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

978 
PyObjeù
* 
py_obj
=
	`PyLi¡_New
(
NELEMS
);

979 
size_t
 
i
=0;i<
NELEMS
;i++)

980 
	`PyLi¡_SET_ITEM
(
py_obj
,
i
,
	`PyLi¡_New
(
NELEMS
));

981 
size_t
 
i
=0;i<
NELEMS
;i++)

982 
size_t
 
j
=0;j<
NELEMS
;j++)

983 
	`PyLi¡_SET_ITEM
(
	`PyLi¡_GET_ITEM
(
py_obj
,
i
),
j
,
pÙf™
->
ff
->
phi_±r
[i][j]->
	`g‘_dA_max
());

985  
py_obj
;

987 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

989 
PÙF™
<
FF
,
NELEMS
>* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

990 
V¬API
<
OB
<
PyLi¡Objeù
,
PyLi¡_Ty³
>> 
	`v¬
("dA_phi_max");

991 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

992 
PyObjeù
* 
py_ob
=
v¬
.
v®
;

993 
size_t
 
ÃËms
=
	`PyLi¡_Size
(
py_ob
);

994 if(
ÃËms
!=
NELEMS
)

996 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"size mismatch in dA_phi_max");

1000 
size_t
 
i
=0;i<
ÃËms
;i++)

1001 if(
	`PyLi¡_Size
(
	`PyLi¡_GET_ITEM
(
py_ob
,
i
))!=
NELEMS
)

1003 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"size mismatch in dA_phi_max");

1007 
size_t
 
i
=0;i<
ÃËms
;i++)

1008 
size_t
 
j
=0;j<
ÃËms
;j++)

1009 if(
pÙf™
->
ff
->
phi_±r
[
i
][
j
]->
	`£t_dA_max
(
	`PyLi¡_GET_ITEM
(PyLi¡_GET_ITEM(
py_ob
,i),j))!=0)

1016 
	}
}

1020 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

1021 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$g‘£t_A_phi_dof
(
PyG‘S‘Def
& 
g‘£t
)

1023 
g‘£t
.
Çme
=(*)"A_phi_dof";

1024 
g‘£t
.
doc
=(*)"";

1025 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

1027 
PÙF™
<
FF
,
NELEMS
>* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

1028 
PyObjeù
* 
py_obj
=
	`PyLi¡_New
(
NELEMS
);

1029 
size_t
 
i
=0;i<
NELEMS
;i++)

1030 
	`PyLi¡_SET_ITEM
(
py_obj
,
i
,
	`PyLi¡_New
(
NELEMS
));

1031 
size_t
 
i
=0;i<
NELEMS
;i++)

1032 
size_t
 
j
=0;j<
NELEMS
;j++)

1033 
	`PyLi¡_SET_ITEM
(
	`PyLi¡_GET_ITEM
(
py_obj
,
i
),
j
,
pÙf™
->
ff
->
phi_±r
[i][j]->
	`g‘_A_dof
());

1035  
py_obj
;

1037 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

1039 
PÙF™
<
FF
,
NELEMS
>* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

1040 
V¬API
<
OB
<
PyLi¡Objeù
,
PyLi¡_Ty³
>> 
	`v¬
("A_phi_dof");

1041 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

1042 
PyObjeù
* 
py_ob
=
v¬
.
v®
;

1043 
size_t
 
ÃËms
=
	`PyLi¡_Size
(
py_ob
);

1044 if(
ÃËms
!=
NELEMS
)

1046 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"size mismatch in A_phi_dof");

1050 
size_t
 
i
=0;i<
ÃËms
;i++)

1051 if(
	`PyLi¡_Size
(
	`PyLi¡_GET_ITEM
(
py_ob
,
i
))!=
NELEMS
)

1053 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"size mismatch in A_phi_dof");

1057 
size_t
 
i
=0;i<
ÃËms
;i++)

1058 
size_t
 
j
=0;j<
ÃËms
;j++)

1059 if(
pÙf™
->
ff
->
phi_±r
[
i
][
j
]->
	`£t_A_dof
(
	`PyLi¡_GET_ITEM
(PyLi¡_GET_ITEM(
py_ob
,i),j))!=0)

1065 
	}
}

1069 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

1070 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$g‘£t_A_rho
(
PyG‘S‘Def
& 
g‘£t
)

1072 
g‘£t
.
Çme
=(*)"A_rho";

1073 
g‘£t
.
doc
=(*)"";

1074 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

1076 
PÙF™
<
FF
,
NELEMS
>* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

1077 
PyObjeù
* 
py_obj
=
	`PyLi¡_New
(
NELEMS
);

1078 
size_t
 
i
=0;i<
NELEMS
;i++)

1079 
	`PyLi¡_SET_ITEM
(
py_obj
,
i
,
	`PyLi¡_New
(
NELEMS
));

1080 
size_t
 
i
=0;i<
NELEMS
;i++)

1081 
size_t
 
j
=0;j<
NELEMS
;j++)

1082 
	`PyLi¡_SET_ITEM
(
	`PyLi¡_GET_ITEM
(
py_obj
,
i
),
j
,
pÙf™
->
ff
->
rho_±r
[i][j]->
	`g‘_A
());

1084  
py_obj
;

1086 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

1088 
PÙF™
<
FF
,
NELEMS
>* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

1089 
V¬API
<
OB
<
PyLi¡Objeù
,
PyLi¡_Ty³
>> 
	`v¬
("A_rho");

1090 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

1091 
PyObjeù
* 
py_ob
=
v¬
.
v®
;

1092 
size_t
 
ÃËms
=
	`PyLi¡_Size
(
py_ob
);

1093 if(
ÃËms
!=
NELEMS
)

1095 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"size mismatch in A_rho");

1099 
size_t
 
i
=0;i<
ÃËms
;i++)

1100 if(
	`PyLi¡_Size
(
	`PyLi¡_GET_ITEM
(
py_ob
,
i
))!=
NELEMS
)

1102 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"size mismatch in A_rho");

1106 
size_t
 
i
=0;i<
ÃËms
;i++)

1107 
size_t
 
j
=0;j<
ÃËms
;j++)

1108 if(
pÙf™
->
ff
->
rho_±r
[
i
][
j
]->
	`£t_A
(
	`PyLi¡_GET_ITEM
(PyLi¡_GET_ITEM(
py_ob
,i),j))!=0)

1115 
	}
}

1119 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

1120 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$g‘£t_dA_rho_max
(
PyG‘S‘Def
& 
g‘£t
)

1122 
g‘£t
.
Çme
=(*)"dA_rho_max";

1123 
g‘£t
.
doc
=(*)"";

1124 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

1126 
PÙF™
<
FF
,
NELEMS
>* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

1127 
PyObjeù
* 
py_obj
=
	`PyLi¡_New
(
NELEMS
);

1128 
size_t
 
i
=0;i<
NELEMS
;i++)

1129 
	`PyLi¡_SET_ITEM
(
py_obj
,
i
,
	`PyLi¡_New
(
NELEMS
));

1130 
size_t
 
i
=0;i<
NELEMS
;i++)

1131 
size_t
 
j
=0;j<
NELEMS
;j++)

1132 
	`PyLi¡_SET_ITEM
(
	`PyLi¡_GET_ITEM
(
py_obj
,
i
),
j
,
pÙf™
->
ff
->
rho_±r
[i][j]->
	`g‘_dA_max
());

1134  
py_obj
;

1136 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

1138 
PÙF™
<
FF
,
NELEMS
>* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

1139 
V¬API
<
OB
<
PyLi¡Objeù
,
PyLi¡_Ty³
>> 
	`v¬
("dA_rho_max");

1140 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

1141 
PyObjeù
* 
py_ob
=
v¬
.
v®
;

1142 
size_t
 
ÃËms
=
	`PyLi¡_Size
(
py_ob
);

1143 if(
ÃËms
!=
NELEMS
)

1145 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"size mismatch in dA_rho_max");

1149 
size_t
 
i
=0;i<
ÃËms
;i++)

1150 if(
	`PyLi¡_Size
(
	`PyLi¡_GET_ITEM
(
py_ob
,
i
))!=
NELEMS
)

1152 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"size mismatch in dA_rho_max");

1156 
size_t
 
i
=0;i<
ÃËms
;i++)

1157 
size_t
 
j
=0;j<
ÃËms
;j++)

1158 if(
pÙf™
->
ff
->
rho_±r
[
i
][
j
]->
	`£t_dA_max
(
	`PyLi¡_GET_ITEM
(PyLi¡_GET_ITEM(
py_ob
,i),j))!=0)

1165 
	}
}

1169 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

1170 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$g‘£t_A_rho_dof
(
PyG‘S‘Def
& 
g‘£t
)

1172 
g‘£t
.
Çme
=(*)"A_rho_dof";

1173 
g‘£t
.
doc
=(*)"";

1174 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

1176 
PÙF™
<
FF
,
NELEMS
>* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

1177 
PyObjeù
* 
py_obj
=
	`PyLi¡_New
(
NELEMS
);

1178 
size_t
 
i
=0;i<
NELEMS
;i++)

1179 
	`PyLi¡_SET_ITEM
(
py_obj
,
i
,
	`PyLi¡_New
(
NELEMS
));

1180 
size_t
 
i
=0;i<
NELEMS
;i++)

1181 
size_t
 
j
=0;j<
NELEMS
;j++)

1182 
	`PyLi¡_SET_ITEM
(
	`PyLi¡_GET_ITEM
(
py_obj
,
i
),
j
,
pÙf™
->
ff
->
rho_±r
[i][j]->
	`g‘_A_dof
());

1184  
py_obj
;

1186 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

1188 
PÙF™
<
FF
,
NELEMS
>* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

1189 
V¬API
<
OB
<
PyLi¡Objeù
,
PyLi¡_Ty³
>> 
	`v¬
("A_rho_dof");

1190 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

1191 
PyObjeù
* 
py_ob
=
v¬
.
v®
;

1192 
size_t
 
ÃËms
=
	`PyLi¡_Size
(
py_ob
);

1193 if(
ÃËms
!=
NELEMS
)

1195 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"size mismatch in A_rho_dof");

1199 
size_t
 
i
=0;i<
ÃËms
;i++)

1200 if(
	`PyLi¡_Size
(
	`PyLi¡_GET_ITEM
(
py_ob
,
i
))!=
NELEMS
)

1202 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"size mismatch in A_rho_dof");

1206 
size_t
 
i
=0;i<
ÃËms
;i++)

1207 
size_t
 
j
=0;j<
ÃËms
;j++)

1208 if(
pÙf™
->
ff
->
rho_±r
[
i
][
j
]->
	`£t_A_dof
(
	`PyLi¡_GET_ITEM
(PyLi¡_GET_ITEM(
py_ob
,i),j))!=0)

1214 
	}
}

1218 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

1219 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$g‘£t_A_F
(
PyG‘S‘Def
& 
g‘£t
)

1221 
g‘£t
.
Çme
=(*)"A_F";

1222 
g‘£t
.
doc
=(*)"";

1223 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

1225 
PÙF™
<
FF
,
NELEMS
>* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

1226 
PyObjeù
* 
py_obj
=
	`PyLi¡_New
(
NELEMS
);

1227 
size_t
 
i
=0;i<
NELEMS
;i++)

1228 
	`PyLi¡_SET_ITEM
(
py_obj
,
i
,
pÙf™
->
ff
->
F_±r
[i]->
	`g‘_A
());

1229  
py_obj
;

1231 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

1233 
PÙF™
<
FF
,
NELEMS
>* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

1234 
V¬API
<
OB
<
PyLi¡Objeù
,
PyLi¡_Ty³
>> 
	`v¬
("A_F");

1235 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

1236 
PyObjeù
* 
py_ob
=
v¬
.
v®
;

1237 
size_t
 
ÃËms
=
	`PyLi¡_Size
(
py_ob
);

1238 if(
ÃËms
!=
NELEMS
)

1240 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"size mismatch in A_F");

1244 
size_t
 
i
=0;i<
ÃËms
;i++)

1245 if(
pÙf™
->
ff
->
F_±r
[
i
]->
	`£t_A
(
	`PyLi¡_GET_ITEM
(
py_ob
,i))!=0)

1249 
	}
}

1253 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

1254 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$g‘£t_dA_F_max
(
PyG‘S‘Def
& 
g‘£t
)

1256 
g‘£t
.
Çme
=(*)"dA_F_max";

1257 
g‘£t
.
doc
=(*)"";

1258 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

1260 
PÙF™
<
FF
,
NELEMS
>* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

1261 
PyObjeù
* 
py_obj
=
	`PyLi¡_New
(
NELEMS
);

1262 
size_t
 
i
=0;i<
NELEMS
;i++)

1263 
	`PyLi¡_SET_ITEM
(
py_obj
,
i
,
pÙf™
->
ff
->
F_±r
[i]->
	`g‘_dA_max
());

1264  
py_obj
;

1266 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

1268 
PÙF™
<
FF
,
NELEMS
>* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

1269 
V¬API
<
OB
<
PyLi¡Objeù
,
PyLi¡_Ty³
>> 
	`v¬
("dA_F_max");

1270 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

1271 
PyObjeù
* 
py_ob
=
v¬
.
v®
;

1272 
size_t
 
ÃËms
=
	`PyLi¡_Size
(
py_ob
);

1273 if(
ÃËms
!=
NELEMS
)

1275 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"size mismatch in dA_F_max");

1279 
size_t
 
i
=0;i<
ÃËms
;i++)

1280 if(
pÙf™
->
ff
->
F_±r
[
i
]->
	`£t_dA_max
(
	`PyLi¡_GET_ITEM
(
py_ob
,i))!=0)

1284 
	}
}

1288 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

1289 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$g‘£t_A_F_dof
(
PyG‘S‘Def
& 
g‘£t
)

1291 
g‘£t
.
Çme
=(*)"A_F_dof";

1292 
g‘£t
.
doc
=(*)"";

1293 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

1295 
PÙF™
<
FF
,
NELEMS
>* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

1296 
PyObjeù
* 
py_obj
=
	`PyLi¡_New
(
NELEMS
);

1297 
size_t
 
i
=0;i<
NELEMS
;i++)

1298 
	`PyLi¡_SET_ITEM
(
py_obj
,
i
,
pÙf™
->
ff
->
F_±r
[i]->
	`g‘_A_dof
());

1299  
py_obj
;

1301 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

1303 
PÙF™
<
FF
,
NELEMS
>* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

1304 
V¬API
<
OB
<
PyLi¡Objeù
,
PyLi¡_Ty³
>> 
	`v¬
("A_F_dof");

1305 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

1306 
PyObjeù
* 
py_ob
=
v¬
.
v®
;

1307 
size_t
 
ÃËms
=
	`PyLi¡_Size
(
py_ob
);

1308 if(
ÃËms
!=
NELEMS
)

1310 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"size mismatch in A_F_dof");

1314 
size_t
 
i
=0;i<
ÃËms
;i++)

1315 if(
pÙf™
->
ff
->
F_±r
[
i
]->
	`£t_A_dof
(
	`PyLi¡_GET_ITEM
(
py_ob
,i))!=0)

1319 
	}
}

1323 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

1324 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$g‘£t_Á®ly
(
PyG‘S‘Def
& 
g‘£t
)

1326 
g‘£t
.
Çme
=(*)"ntally";

1327 
g‘£t
.
doc
=(*)"";

1329 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

1331  
v¬
<>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
pÙf™
->
Á®ly
);

1333 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

1335 
V¬API
<> 
	`v¬
("ntally");

1336 
v¬
.
logics
[0]=
	`VLogics
("ge",0);

1337 
ichk
=
v¬
.
	`£t
(
v®
);

1338 if(
ichk
==-1)  -1;

1339 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
pÙf™
->
Á®ly
=
v¬
.
v®
;

1342 
	}
}

1346 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

1347 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$g‘£t_max_ÁrŸls
(
PyG‘S‘Def
& 
g‘£t
)

1349 
g‘£t
.
Çme
=(*)"max_ntrials";

1350 
g‘£t
.
doc
=(*)"";

1352 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

1354  
v¬
<>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
pÙf™
->
max_ÁrŸls
);

1356 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

1358 
V¬API
<> 
	`v¬
("max_ntrials");

1359 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

1360 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
pÙf™
->
max_ÁrŸls
=
v¬
.
v®
;

1363 
	}
}

1367 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

1368 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$g‘£t_nmš_¡•s
(
PyG‘S‘Def
& 
g‘£t
)

1370 
g‘£t
.
Çme
=(*)"nmin_steps";

1371 
g‘£t
.
doc
=(*)"";

1373 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

1375  
v¬
<>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
pÙf™
->
nmš_¡•s
);

1377 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

1379 
V¬API
<> 
	`v¬
("nmin_steps");

1380 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

1381 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
pÙf™
->
nmš_¡•s
=
v¬
.
v®
;

1384 
	}
}

1388 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

1389 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$g‘£t_tŞ
(
PyG‘S‘Def
& 
g‘£t
)

1391 
g‘£t
.
Çme
=(*)"tol";

1392 
g‘£t
.
doc
=(*)"";

1394 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

1396  
v¬
<
ty³0
>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
pÙf™
->
”r_tŞ
);

1398 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

1400 
V¬API
<
ty³0
> 
	`v¬
("tol");

1401 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

1402 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
pÙf™
->
”r_tŞ
=
v¬
.
v®
;

1405 
	}
}

1409 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

1410 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$g‘£t_”rs
(
PyG‘S‘Def
& 
g‘£t
)

1412 
g‘£t
.
Çme
=(*)"errs";

1413 
g‘£t
.
doc
=(*)"";

1415 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

1417 
PÙF™
<
FF
,
NELEMS
>* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

1418 
size_t
 
sz
;

1419 
size_t
* 
szp
=&
sz
;

1420 
sz
=
pÙf™
->
ncÚfigs
;

1421 
PyObjeù
* 
İ
=
v¬
<
ty³0
*>::
	`bud
(
pÙf™
->
”rs
,&
szp
);

1422  
İ
;

1424 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

1426 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,"readonly‡ttribute");

1429 
	}
}

1433 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

1434 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$g‘£t_”r
(
PyG‘S‘Def
& 
g‘£t
)

1436 
g‘£t
.
Çme
=(*)"err";

1437 
g‘£t
.
doc
=(*)"";

1439 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

1441  
v¬
<
ty³0
>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
pÙf™
->
”r
);

1443 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

1445 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,"readonly‡ttribute");

1448 
	}
}

1452 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

1453 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$g‘£t_’_cÛfs
(
PyG‘S‘Def
& 
g‘£t
)

1455 
g‘£t
.
Çme
=(*)"en_coefs";

1456 
g‘£t
.
doc
=(*)"";

1458 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

1460 
PÙF™
<
FF
,
NELEMS
>* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

1461 
size_t
 
sz
;

1462 
size_t
* 
szp
=&
sz
;

1463 
sz
=
pÙf™
->
ncÚfigs
;

1464 
ty³0
* 
v
=
pÙf™
->
	`g‘_’_cÛfs
();

1465 
PyObjeù
* 
İ
=
v¬
<
ty³0
*>::
	`bud
(
v
,&
szp
);

1466 
MemÜy
::
	`d—Îoc
(
v
);

1467  
İ
;

1469 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

1471 
V¬API
<
ty³0
*> 
	`v¬
("en_coefs");

1472 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

1473 
PÙF™
<
FF
,
NELEMS
>* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

1474 if(
v¬
.
__v¬__
.
size
!=
¡©ic_ÿ¡
<
size_t
>(
pÙf™
->
ncÚfigs
))

1476 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,"size mismatch");

1480 
__my_cÚf
=
pÙf™
->
my_cÚf
;

1481 
pÙf™
->
cÛf
[0]=
v¬
.
v®
[
__my_cÚf
];

1484 
	}
}

1488 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

1489 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$g‘£t_f_cÛfs
(
PyG‘S‘Def
& 
g‘£t
)

1491 
g‘£t
.
Çme
=(*)"f_coefs";

1492 
g‘£t
.
doc
=(*)"";

1494 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

1496 
PÙF™
<
FF
,
NELEMS
>* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

1497 
size_t
 
sz
;

1498 
size_t
* 
szp
=&
sz
;

1499 
sz
=
pÙf™
->
ncÚfigs
;

1500 
ty³0
* 
v
=
pÙf™
->
	`g‘_f_cÛfs
();

1501 
PyObjeù
* 
İ
=
v¬
<
ty³0
*>::
	`bud
(
v
,&
szp
);

1502 
MemÜy
::
	`d—Îoc
(
v
);

1503  
İ
;

1505 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

1507 
V¬API
<
ty³0
*> 
	`v¬
("f_coefs");

1508 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

1509 
PÙF™
<
FF
,
NELEMS
>* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

1510 if(
v¬
.
__v¬__
.
size
!=
¡©ic_ÿ¡
<
size_t
>(
pÙf™
->
ncÚfigs
))

1512 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,"size mismatch");

1516 
__my_cÚf
=
pÙf™
->
my_cÚf
;

1517 
pÙf™
->
f_cÛf
=
v¬
.
v®
[
__my_cÚf
];

1520 
	}
}

1524 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

1525 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$g‘£t_S_cÛfs
(
PyG‘S‘Def
& 
g‘£t
)

1527 
g‘£t
.
Çme
=(*)"S_coefs";

1528 
g‘£t
.
doc
=(*)"";

1530 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

1532 
PÙF™
<
FF
,
NELEMS
>* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

1533 
size_t
 
sz
;

1534 
size_t
* 
szp
=&
sz
;

1535 
sz
=
pÙf™
->
ncÚfigs
;

1536 
	`ty³0
(* 
v
)[
__dim__
][__dim__]=
»š‹½»t_ÿ¡
<ty³0(*)[__dim__][__dim__]>(
pÙf™
->
	`g‘_S_cÛfs
());

1538 
PyObjeù
* 
İ
=
v¬
<
	`ty³0
(*)[
__dim__
][__dim__]>::
	`bud
(
v
,&
szp
);

1539 
MemÜy
::
	`d—Îoc
(
v
);

1540  
İ
;

1542 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

1544 
V¬API
<
symm
<
ty³0
[
__dim__
][__dim__]>*> 
	`v¬
("S_coefs");

1545 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

1546 
PÙF™
<
FF
,
NELEMS
>* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

1547 if(
v¬
.
__v¬__
.
size
!=
¡©ic_ÿ¡
<
size_t
>(
pÙf™
->
ncÚfigs
))

1549 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,"size mismatch");

1552 
__my_cÚf
=
pÙf™
->
my_cÚf
;

1553 
Algeb¿
::
	`MSY_2_DyadicV
(
v¬
.
v®
[
__my_cÚf
],
pÙf™
->
cÛf
+1);

1557 
	}
}

1561 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

1562 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$g‘£t_H_dofs
(
PyG‘S‘Def
& 
g‘£t
)

1564 
g‘£t
.
Çme
=(*)"H_dofs";

1565 
g‘£t
.
doc
=(*)"";

1567 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

1569 
PÙF™
<
FF
,
NELEMS
>* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

1570 
size_t
 
sz
;

1571 
size_t
* 
szp
=&
sz
;

1572 
sz
=
pÙf™
->
ncÚfigs
;

1573 
	`boŞ
(* 
v
)[
__dim__
][__dim__]=
»š‹½»t_ÿ¡
<boŞ(*)[__dim__][__dim__]>(
pÙf™
->
	`g‘_H_dofs
());

1575 
PyObjeù
* 
İ
=
v¬
<
	`boŞ
(*)[
__dim__
][__dim__]>::
	`bud
(
v
,&
szp
);

1576 
MemÜy
::
	`d—Îoc
(
v
);

1577  
İ
;

1579 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

1581 
V¬API
<
symm
<
boŞ
[
__dim__
][__dim__]>*> 
	`v¬
("H_dofs");

1582 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

1583 
PÙF™
<
FF
,
NELEMS
>* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

1584 if(
v¬
.
__v¬__
.
size
!=
¡©ic_ÿ¡
<
size_t
>(
pÙf™
->
ncÚfigs
))

1586 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,"size mismatch");

1589 
__my_cÚf
=
pÙf™
->
my_cÚf
;

1590 
pÙf™
->
mš
->
	`£t_H_dof
(
v¬
.
v®
[
__my_cÚf
]);

1594 
	}
}

1596 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

1597 
PyM‘hodDef
 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
m‘hods
[]=
Em±yPyM‘hodDef
(7);

1599 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

1600 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$£tup__m‘hods
()

1602 
	`ml_mš_cg
(
m‘hods
[0]);

1603 
	`ml_mš_§
(
m‘hods
[1]);

1604 
	`ml_m—n_rho
(
m‘hods
[2]);

1605 
	`ml_‹¡_A_phi
(
m‘hods
[3]);

1606 
	`ml_‹¡_A_rho
(
m‘hods
[4]);

1607 
	`ml_‹¡_A_F
(
m‘hods
[5]);

1608 
	}
}

1612 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

1613 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$ml_mš_cg
(
PyM‘hodDef
& 
_m‘hods
)

1615 
_m‘hods
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

1616 
_m‘hods
.
ml_Çme
="min_cg";

1617 
_m‘hods
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

1618 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

1621 
FuncAPI
<>
	`f
("min_cg",{"nsteps"});

1622 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

1624 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
pÙf™
->
	`mš_cg
(
f
.
v®
<0>());

1626 
Py_RETURN_NONE
;

1630 
_m‘hods
.
ml_doc
=(*)"";

1631 
	}
}

1635 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

1636 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$ml_mš_§
(
PyM‘hodDef
& 
_m‘hods
)

1638 
_m‘hods
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

1639 
_m‘hods
.
ml_Çme
="min_sa";

1640 
_m‘hods
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

1641 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

1644 
FuncAPI
<,,,
ty³0
,ty³0>
	`f
("min_sa",{"seed","nsteps","ntrials","temp","gamma"});

1645 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

1647 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
pÙf™
->
	`mš_§
(
f
.
v®
<0>(),f.val<1>(),

1648 
f
.
v®
<2>(),f.val<3>(),f.val<4>());

1650 
Py_RETURN_NONE
;

1654 
_m‘hods
.
ml_doc
=(*)"";

1655 
	}
}

1659 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

1660 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$ml_m—n_rho
(
PyM‘hodDef
& 
_m‘hods
)

1662 
_m‘hods
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

1663 
_m‘hods
.
ml_Çme
="mean_rho";

1664 
_m‘hods
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

1665 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

1668 
FuncAPI
<
–em_ty³
>
	`f
("mean_rho",{"ielem"});

1669 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

1670 
PÙF™
<
FF
,
NELEMS
>* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

1672 
size_t
 
sz
;

1673 
size_t
* 
szp
=&
sz
;

1674 
sz
=
pÙf™
->
ncÚfigs
;

1676 
pÙf™
->
	`š™
();

1677 
pÙf™
->
ff
->
	`d”iv©ive
();

1678 
ty³0
* 
v
=
pÙf™
->
	`g‘_m—n_rho
(
f
.
v®
<0>());

1679 
pÙf™
->
	`fš
();

1681 
PyObjeù
* 
İ
=
v¬
<
ty³0
*>::
	`bud
(
v
,&
szp
);

1682 
MemÜy
::
	`d—Îoc
(
v
);

1683  
İ
;

1687 
_m‘hods
.
ml_doc
=(*)"";

1688 
	}
}

1692 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

1693 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$ml_‹¡_A_phi
(
PyM‘hodDef
& 
_m‘hods
)

1695 
_m‘hods
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

1696 
_m‘hods
.
ml_Çme
="test_A_phi";

1697 
_m‘hods
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

1698 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

1702 
FuncAPI
<,,,
ty³0
,>
	`f
("test_A_phi",{"i","j","k","delta","nsteps"});

1703 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

1705 
PÙF™
<
FF
,
NELEMS
>* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

1706 
±rdiff_t
 
off£t
=
pÙf™
->
ff
->
phi_±r
[
f
.
v®
<0>()][f.v®<1>()]->
v¬s
-pÙf™->ff->
vs
;

1707 
off£t
+=
f
.
v®
<2>();

1708 
pÙf™
->
	`‹¡_d”iv
(
off£t
,
f
.
v®
<3>(),f.val<4>());

1711 
Py_RETURN_NONE
;

1715 
_m‘hods
.
ml_doc
=(*)"";

1716 
	}
}

1720 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

1721 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$ml_‹¡_A_rho
(
PyM‘hodDef
& 
_m‘hods
)

1723 
_m‘hods
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

1724 
_m‘hods
.
ml_Çme
="test_A_rho";

1725 
_m‘hods
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

1726 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

1730 
FuncAPI
<,,,
ty³0
,>
	`f
("test_A_rho",{"i","j","k","delta","nsteps"});

1731 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

1733 
PÙF™
<
FF
,
NELEMS
>* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

1734 
±rdiff_t
 
off£t
=
pÙf™
->
ff
->
rho_±r
[
f
.
v®
<0>()][f.v®<1>()]->
v¬s
-pÙf™->ff->
vs
;

1735 
off£t
+=
f
.
v®
<2>();

1736 
pÙf™
->
	`‹¡_d”iv
(
off£t
,
f
.
v®
<3>(),f.val<4>());

1739 
Py_RETURN_NONE
;

1743 
_m‘hods
.
ml_doc
=(*)"";

1744 
	}
}

1748 
	g‹m¶©e
<
şass
 
	gFF
,
size_t
 
	gNELEMS
>

1749 
	gPÙF™
<
	gFF
,
	gNELEMS
>::
	$ml_‹¡_A_F
(
PyM‘hodDef
& 
_m‘hods
)

1751 
_m‘hods
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

1752 
_m‘hods
.
ml_Çme
="test_A_F";

1753 
_m‘hods
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

1754 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

1758 
FuncAPI
<,,
ty³0
,>
	`f
("test_A_F",{"i","j","delta","nsteps"});

1759 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

1761 
PÙF™
<
FF
,
NELEMS
>* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

1762 
±rdiff_t
 
off£t
=
pÙf™
->
ff
->
F_±r
[
f
.
v®
<0>()]->
v¬s
-pÙf™->ff->
vs
;

1763 
off£t
+=
f
.
v®
<1>();

1764 
pÙf™
->
	`‹¡_d”iv
(
off£t
,
f
.
v®
<2>(),f.val<3>());

1767 
Py_RETURN_NONE
;

1771 
_m‘hods
.
ml_doc
=(*)"";

1772 
	}
}

	@potfit_funcs.cpp

1 
	~"pÙf™_funcs.h
"

2 
	~"memÜy.h
"

3 
	~"¿ndom.h
"

4 
	#NMAX_ALPHA_SHRNK_ATTMPS
 10

	)

5 
	~<cm©h
>

6 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

10 
ty³0
 
	gPÙF™Aux
::
	$fšd_max_®pha
(cÚ¡ 
ty³0
 
xlo
,cÚ¡y³0 
xhi
,
boŞ
 
dof
,ty³0 
max_dx
,ty³0 
x
,ty³0 
h
)

13 if(
dof
==
çl£
 || 
h
==0.0è 
¡d
::
num”ic_lim™s
<
ty³0
>::
	`šfš™y
();

14 
ty³0
 
max_®pha
=
	`çbs
(
max_dx
/
h
);

16 if(
h
>0.0 && 
¡d
::
	`i¢ª
(
xhi
)==
çl£
)

18 
max_®pha
=
	`MIN
(max_®pha,(
xhi
-
x
)/
h
);

19 
™
=0;™<
NMAX_ALPHA_SHRNK_ATTMPS
 && 
x
+
max_®pha
*
h
>
xhi
;it++)

20 
max_®pha
=
	`Ãxá”
(max_alpha,0.0);

21 if(
x
+
max_®pha
*
h
>
xhi
)  0.0;

23 if(
h
<0.0 && 
¡d
::
	`i¢ª
(
xlo
)==
çl£
)

25 
max_®pha
=
	`MIN
(max_®pha,(
xlo
-
x
)/
h
);

26 
™
=0;™<
NMAX_ALPHA_SHRNK_ATTMPS
 && 
x
+
max_®pha
*
h
<
xlo
;it++)

27 
max_®pha
=
	`Ãxá”
(max_alpha,0.0);

28 if(
x
+
max_®pha
*
h
<
xlo
)  0.0;

32  
max_®pha
;

33 
	}
}

37 
ty³0
 
	gPÙF™Aux
::
	$fšd_max_®pha
(cÚ¡ 
ty³0
 
xlo
,cÚ¡y³0 
xhi
,ty³0 
max_dx
,ty³0 
x
,ty³0 
h
)

39 if(
h
==0.0è 
¡d
::
num”ic_lim™s
<
ty³0
>::
	`šfš™y
();

40 
ty³0
 
max_®pha
=
	`çbs
(
max_dx
/
h
);

42 if(
h
>0.0 && 
¡d
::
	`i¢ª
(
xhi
)==
çl£
)

44 
max_®pha
=
	`MIN
(max_®pha,(
xhi
-
x
)/
h
);

45 
™
=0;™<
NMAX_ALPHA_SHRNK_ATTMPS
 && 
x
+
max_®pha
*
h
>
xhi
;it++)

46 
max_®pha
=
	`Ãxá”
(max_alpha,0.0);

47 if(
x
+
max_®pha
*
h
>
xhi
)  0.0;

49 if(
h
<0.0 && 
¡d
::
	`i¢ª
(
xlo
)==
çl£
)

51 
max_®pha
=
	`MIN
(max_®pha,(
xlo
-
x
)/
h
);

52 
™
=0;™<
NMAX_ALPHA_SHRNK_ATTMPS
 && 
x
+
max_®pha
*
h
<
xlo
;it++)

53 
max_®pha
=
	`Ãxá”
(max_alpha,0.0);

54 if(
x
+
max_®pha
*
h
<
xlo
)  0.0;

57  
max_®pha
;

58 
	}
}

68 
	gPÙF™PaœFunc
::
	$PÙF™PaœFunc
(cÚ¡ * 
__Çme
):

69 
	`Çme
(
__Çme
),
	`nv¬s
(0),
	`rc
(0.0),
	`v¬s
(
NULL
),
	`dv¬s_lş
(NULL),

70 
	`A_Çme
(
¡d
::
	`¡ršg
("A_")+¡d::¡ršg(
Çme
)),

71 
	`dA_Çme_max
(
¡d
::
	`¡ršg
("dA_")+¡d::¡ršg(
Çme
)+std::string("_max")),

72 
	`A_Çme_dof
(
¡d
::
	`¡ršg
("A_")+¡d::¡ršg(
Çme
)+std::string("_dof"))

74 
	}
}

78 
PÙF™PaœFunc
::~
	$PÙF™PaœFunc
()

80 
	}
}

84 
PÙF™PaœFunc
::
	$¿ndom_Ãigh
(
Rªdom
* 
¿ndom
)

86 
size_t
 
i
=0;i<
nv¬s
;i++)

87 if(
dofs
[
i
])

88 
hv¬s
[
i
]=(2.0*
¿ndom
->
	`unifÜm
()-1.0)*
dv¬s_max
[i];

90 
	}
}

94 
	gPÙF™PaœFunc
::
	$£t_A
(
PyObjeù
* 
v®
)

96 
V¬API
<
ty³0
*> 
	`v¬
(
A_Çme
.
	`c_¡r
());

97 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

98 if(
v¬
.
__v¬__
.
size
!=
nv¬s
)

100 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"sizmism©ch iÀ%s",
A_Çme
.
	`c_¡r
());

103 
	`memıy
(
v¬s
,
v¬
.
v®
,
nv¬s
*(
ty³0
));

105 
	}
}

109 
PyObjeù
* 
	gPÙF™PaœFunc
::
	$g‘_A
()

111 
size_t
* 
szp
=&
nv¬s
;

112  
v¬
<
ty³0
*>::
	`bud
(
v¬s
,&
szp
);

113 
	}
}

117 
	gPÙF™PaœFunc
::
	$£t_dA_max
(
PyObjeù
* 
v®
)

119 
V¬API
<
ty³0
*> 
	`v¬
(
dA_Çme_max
.
	`c_¡r
());

120 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

121 if(
v¬
.
__v¬__
.
size
!=
nv¬s
)

123 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"sizmism©ch iÀ%s",
dA_Çme_max
.
	`c_¡r
());

126 
	`memıy
(
dv¬s_max
,
v¬
.
v®
,
nv¬s
*(
ty³0
));

128 
	}
}

132 
PyObjeù
* 
	gPÙF™PaœFunc
::
	$g‘_dA_max
()

134 
size_t
* 
szp
=&
nv¬s
;

135  
v¬
<
ty³0
*>::
	`bud
(
dv¬s_max
,&
szp
);

136 
	}
}

140 
	gPÙF™PaœFunc
::
	$£t_A_dof
(
PyObjeù
* 
v®
)

142 
V¬API
<
boŞ
*> 
	`v¬
(
A_Çme_dof
.
	`c_¡r
());

143 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

144 if(
v¬
.
__v¬__
.
size
!=
nv¬s
)

146 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"sizmism©ch iÀ%s",
A_Çme_dof
.
	`c_¡r
());

149 
	`memıy
(
dofs
,
v¬
.
v®
,
nv¬s
*(
boŞ
));

151 
	}
}

155 
PyObjeù
* 
	gPÙF™PaœFunc
::
	$g‘_A_dof
()

157 
size_t
* 
szp
=&
nv¬s
;

158  
v¬
<
boŞ
*>::
	`bud
(
dofs
,&
szp
);

159 
	}
}

163 
	gPÙF™RhoS¶
::
	$PÙF™RhoS¶
(cÚ¡ * 
__Çme
):

164 
	`PÙF™PaœFunc
(
__Çme
),

165 
	$R
(
NULL
)

167 
	}
}

171 
	gPÙF™RhoS¶
::~
	$PÙF™RhoS¶
()

173 
MemÜy
::
	`d—Îoc
(
R
);

174 
	}
}

178 
ty³0
 
	gPÙF™RhoS¶
::
	$sÜt
(
ty³0
* 
A
,ty³0* 
R
,
size_t
 
sz
)

180 if(
sz
==0)  0.0;

181 
size_t
* 
key
=
NULL
;

182 
MemÜy
::
	`®loc
(
key
,
sz
);

183 
size_t
 
i
=0;i<
sz
;i++è
key
[i]=i;

185 
XM©h
::
	`quicksÜt
(
key
,key+
sz
,

186 [&
R
](
size_t
* 
¿nk_i
,size_t* 
¿nk_j
){ (R[*rank_i]>R[*rank_j]);},

187 [&
A
,&
R
](
size_t
* 
¿nk_i
,size_t* 
¿nk_j
)

189 
¡d
::
	`sw­
(
R
[*
¿nk_i
],R[*
¿nk_j
]);

190 
¡d
::
	`sw­
(
A
[*
¿nk_i
],A[*
¿nk_j
]);

193 
MemÜy
::
	`d—Îoc
(
key
);

194  
R
[0];

196 
	}
}

200 
ty³0
 
	gPÙF™RhoS¶
::
	$F
(
ty³0
 
r
)

202 if(
r
>=
rc
)  0.0;

203 
ty³0
 
ªs
=0.0;

204 
size_t
 
i
=0;i<
nv¬s
 && 
r
<
R
[i];i++)

205 
ªs
+=
v¬s
[
i
]*
Algeb¿
::
pow
<3>(
R
[i]-
r
);

206  
ªs
;

207 
	}
}

211 
ty³0
 
	gPÙF™RhoS¶
::
	$dF
(
ty³0
 
r
)

213 if(
r
>=
rc
)  0.0;

214 
ty³0
 
ªs
=0.0;

215 
size_t
 
i
=0;i<
nv¬s
 && 
r
<
R
[i];i++)

216 
ªs
+=-3.0*
v¬s
[
i
]*
Algeb¿
::
pow
<2>(
R
[i]-
r
);

217  
ªs
;

218 
	}
}

222 
ty³0
 
	gPÙF™RhoS¶
::
	$ddF
(
ty³0
 
r
)

224 if(
r
>=
rc
)  0.0;

225 
ty³0
 
ªs
=0.0;

226 
size_t
 
i
=0;i<
nv¬s
 && 
r
<
R
[i];i++)

227 
ªs
+=6.0*
v¬s
[
i
]*(
R
[i]-
r
);

228  
ªs
;

229 
	}
}

233 
	gPÙF™RhoS¶
::
	$DF
(
ty³0
 
cÛf
,ty³0 
r
,ty³0* 
dv
)

235 if(
r
>=
rc
) ;

236 
size_t
 
i
=0;i<
nv¬s
 && 
r
<
R
[i];i++)

237 
dv
[
i
]+=
cÛf
*
Algeb¿
::
pow
<3>(
R
[i]-
r
);

238 
	}
}

242 
	gPÙF™RhoS¶
::
	$DdF
(
ty³0
 
cÛf
,ty³0 
r
,ty³0* 
dv
)

244 if(
r
>=
rc
) ;

245 
size_t
 
i
=0;i<
nv¬s
 && 
r
<
R
[i];i++)

246 
dv
[
i
]+=-
cÛf
*3.0*
Algeb¿
::
pow
<2>(
R
[i]-
r
);

247 
	}
}

251 
	gPÙF™RhoS¶
::
	$quad¿tic
(
ty³0
* 
c
,ty³0* 
ªs
)

253 
ty³0
 
d–_sq
=
c
[0]*c[0]-4.0*c[1];

254 if(
d–_sq
<0.0)  0;

255 if(
d–_sq
==0.0)

257 
ªs
[0]=-0.5*
c
[0];

261 
ty³0
 
d–
=
	`sq¹
(
d–_sq
);

262 
ªs
[0]=0.5*(-
c
[0]+
d–
);

263 
ªs
[1]=0.5*(-
c
[0]-
d–
);

265 
	}
}

269 
	gPÙF™RhoS¶
::
	$cubic
(
ty³0
* 
c
,ty³0* 
ªs
)

271 
ty³0
 
p
=
c
[1]-c[0]*c[0]/3.0;

272 
ty³0
 
q
=2.0*
c
[0]*c[0]*c[0]/27.0-c[0]*c[1]/3.0+c[2];

274 if(
p
==0.0)

276 if(
q
>=0.0è
ªs
[0]=-
	`pow
(q,1.0/3.0)-
c
[0]/3.0;

277 
ªs
[0]=
	`pow
(-
q
,1.0/3.0)-
c
[0]/3.0;

280 if(
q
==0.0)

282 
ÄoÙs
=0;

283 
ªs
[
ÄoÙs
++]=-
c
[0]/3.0;

284 if(
p
<0.0)

286 
ªs
[
ÄoÙs
++]=
	`sq¹
(-
p
)-
c
[0]/3.0;

287 
ªs
[
ÄoÙs
++]=-
	`sq¹
(-
p
)-
c
[0]/3.0;

289  
ÄoÙs
;

292 
ty³0
 
t
=
	`sq¹
(
	`çbs
(
p
)/3.0);

293 
ty³0
 
g
=1.5*
q
/(
p
*
t
);

294 if(
p
>0.0)

296 
ªs
[0]=-2.0*
t
*
	`sšh
(
	`asšh
(
g
)/3.0)-
c
[0]/3.0;

301 if(4.0*
p
*p*p+27.0*
q
*q<0.0)

303 
ty³0
 
th‘a
=
	`acos
(
g
)/3.0;

304 
ªs
[0]=2.0*
t
*
	`cos
(
th‘a
)-
c
[0]/3.0;

305 
ªs
[1]=2.0*
t
*
	`cos
(
th‘a
+2.0*
M_PI
/3.0)-
c
[0]/3.0;

306 
ªs
[2]=2.0*
t
*
	`cos
(
th‘a
-2.0*
M_PI
/3.0)-
c
[0]/3.0;

310 if(
q
>0.0)

312 
ªs
[0]=-2.0*
t
*
	`cosh
(
	`acosh
(-
g
)/3.0)-
c
[0]/3.0;

316 
ªs
[0]=2.0*
t
*
	`cosh
(
	`acosh
(
g
)/3.0)-
c
[0]/3.0;

318 
	}
}

322 
	gPÙF™RhoS¶
::
	$qu¬tic
(
ty³0
* 
c
,ty³0* 
ªs
)

324 
ty³0
 
p
=
c
[1]-0.375*c[0]*c[0];

325 
ty³0
 
q
=0.125*
c
[0]*(c[0]*c[0]-4.0*c[1])+c[2];

326 
ty³0
 
r
=0.25*
p
*p+0.01171875*
c
[0]*c[0]*c[0]*c[0]-0.0625*c[0]*c[0]*c[1]+0.25*c[0]*c[2]-c[3];

327 if(
q
==0)

330 if(
r
<0.0)  0;

331 
ÄoÙs
=0;

333 if(
r
-0.5*
p
>=0.0)

335 
ty³0
 
absy
=
	`sq¹
(
r
-0.5*
p
);

336 
ªs
[
ÄoÙs
++]=
absy
-0.25*
c
[0];

337 
ªs
[
ÄoÙs
++]=-
absy
-0.25*
c
[0];

339 if(
r
+0.5*
p
>=0.0)

341 
ty³0
 
absy
=
	`sq¹
(
r
+0.5*
p
);

342 
ªs
[
ÄoÙs
++]=
absy
-0.25*
c
[0];

343 
ªs
[
ÄoÙs
++]=-
absy
-0.25*
c
[0];

346  
ÄoÙs
;

348 
ty³0
 
__c
[3]={
p
,
r
,-0.125*
q
*q};

349 
ty³0
 
__ªs
[3];

350 
	`cubic
(
__c
,
__ªs
);

351 
ty³0
 
m
=
__ªs
[0];

353 if(
m
<0.0)  0;

354 
ty³0
 
sq¹_2m
=
	`sq¹
(2.0*
m
);

355 
ÄoÙs
=0;

356 if(-
m
-
p
+
q
/
sq¹_2m
>=0.0)

358 
ty³0
 
d–
=
	`sq¹
(2.0*(-
m
-
p
+
q
/
sq¹_2m
));

359 
ªs
[
ÄoÙs
++]=0.5*(-
sq¹_2m
+
d–
)-0.25*
c
[0];

360 
ªs
[
ÄoÙs
++]=0.5*(-
sq¹_2m
-
d–
)-0.25*
c
[0];

363 if(-
m
-
p
-
q
/
sq¹_2m
>=0.0)

365 
ty³0
 
d–
=
	`sq¹
(2.0*(-
m
-
p
-
q
/
sq¹_2m
));

366 
ªs
[
ÄoÙs
++]=0.5*(
sq¹_2m
+
d–
)-0.25*
c
[0];

367 
ªs
[
ÄoÙs
++]=0.5*(
sq¹_2m
-
d–
)-0.25*
c
[0];

370  
ÄoÙs
;

371 
	}
}

375 
	gPÙF™RhoS¶
::
¦pše_max_®pha
(

376 
ty³0
 (&
c0
)[4],ty³0 (&
dc
)[4],

377 cÚ¡ 
ty³0
& 
x_lo
,cÚ¡y³0& 
x_hi
,ty³0& 
max_®pha
)

380 
ty³0
 
	g__c
[5]={

381 
c0
[0]*
dc
[1]-c0[1]*dc[0],

382 2.0*(
c0
[0]*
dc
[2]-c0[2]*dc[0]),

383 3.0*(
c0
[0]*
dc
[3]-c0[3]*dc[0])+(c0[1]*dc[2]-c0[2]*dc[1]),

384 2.0*(
c0
[1]*
dc
[3]-c0[3]*dc[1]),

385 
c0
[2]*
dc
[3]-c0[3]*dc[2]};

387 
ty³0
 
	gªs
[4];

388 
	gn
;

389 if(
	g__c
[0]!=0.0)

391 
__c
[1]/=__c[0];

392 
	g__c
[2]/=
__c
[0];

393 
	g__c
[3]/=
__c
[0];

394 
	g__c
[4]/=
__c
[0];

395 
	gn
=
qu¬tic
(
__c
+1,
ªs
);

397 if(
	g__c
[1]!=0.0)

399 
__c
[2]/=__c[1];

400 
	g__c
[3]/=
__c
[1];

401 
	g__c
[4]/=
__c
[1];

402 
	gn
=
cubic
(
__c
+2,
ªs
);

404 if(
	g__c
[2]!=0.0)

406 
__c
[3]/=__c[2];

407 
	g__c
[4]/=
__c
[2];

408 
	gn
=
quad¿tic
(
__c
+3,
ªs
);

410 if(
	g__c
[3]!=0.0)

412 
n
=1;

413 
	gªs
[0]=-
__c
[4]/__c[3];

417 if(
	gc0
[0]*
	gdc
[0]<0.0)

418 
	gmax_®pha
=
MIN
(
max_®pha
,-
c0
[0]/
dc
[0]);

420 
	gmax_®pha
=0.0;

425 
ty³0
 
	gf0
;

426 
ty³0
 
	gdf
;

427 
	gi
=0;i<
	gn
;i++)

429 if(
	gx_lo
<
	gªs
[
i
] &&‡ns[i]<
	gx_hi
 &&(
	gdf
=((
dc
[0]*
ªs
[i]+dc[1])*ans[i]+dc[2])*ans[i]+dc[3])<0.0)

431 
f0
=((
c0
[0]*
ªs
[
i
]+c0[1])*ans[i]+c0[2])*ans[i]+c0[3];

432 
	gmax_®pha
=
MIN
(
max_®pha
,-
f0
/
df
);

441 
	gPÙF™RhoS¶
::
¦pše_max_®pha
(
ty³0
* 
h
,

442 
ty³0
 (&
c0
)[4],ty³0 (&
dc
)[4],

443 cÚ¡ 
ty³0
& 
x_lo
,cÚ¡y³0& 
x_hi
,ty³0& 
max_®pha
)

447 
	gn
=0;

448 
ty³0
 
	g__max_®pha
;

449 
ty³0
 
	gc
[4];

450 
ty³0
 
	g__c
[2];

451 
ty³0
 
	gªs
[2];

452 
ty³0
 
	gdf
;

453 
boŞ
 
	gŒŸl
=
Œue
;

454 
	g™
=0;™<
	gNMAX_ALPHA_SHRNK_ATTMPS
 && 
	gŒŸl
;it++)

456 
	gAlgeb¿
::
V_eq
<4>(
c0
,
	gc
);

457 
	gAlgeb¿
::
V_add_x_mul_V
<4>(
max_®pha
,
	gdc
,
	gc
);

459 if(
	gc
[0]!=0.0)

461 
__c
[0]=2.0*
c
[1]/(3.0*c[0]);

462 
	g__c
[1]=
c
[2]/(3.0*c[0]);

463 
	gn
=
quad¿tic
(
__c
,
ªs
);

465 if(
	gc
[1]!=0.0)

467 
ªs
[0]=-
c
[2]/c[1];

468 
	gn
=1;

472 
	gŒŸl
=
çl£
;

475 
	gŒŸl
=
çl£
;

476 
	gi
=0;i<
	gn
;i++)

478 
	gdf
=
F
(
max_®pha
,
h
,
ªs
[
i
]);

479 if((
	gx_lo
<=
ªs
[
i
] &&‡ns[i]<
x_hi
è&& 
df
<0.0)

481 
ŒŸl
=
Œue
;

482 
	g__max_®pha
=-
F
(
ªs
[
i
])/
df
;

483 if(
	g__max_®pha
>=
max_®pha
)

484 
max_®pha
=
Ãxá”
(max_alpha,0.0);

486 
	gmax_®pha
=
__max_®pha
;

491 if(
	gŒŸl
è
	gmax_®pha
=0.0;

497 
ty³0
 
	gPÙF™RhoS¶
::
	$F
(
ty³0
* 
h
,ty³0 
r
)

499 if(
r
>=
rc
)  0.0;

500 
ty³0
 
ªs
=0.0;

501 
size_t
 
i
=0;i<
nv¬s
 && 
r
<
R
[i];i++)

502 
ªs
+=
h
[
i
]*
Algeb¿
::
pow
<3>(
R
[i]-
r
);

503  
ªs
;

504 
	}
}

508 
ty³0
 
	gPÙF™RhoS¶
::
	$F
(
ty³0
 
®pha
,ty³0* 
h
,ty³0 
r
)

510 if(
r
>=
rc
)  0.0;

511 
ty³0
 
ªs
=0.0;

512 
size_t
 
i
=0;i<
nv¬s
 && 
r
<
R
[i];i++)

513 
ªs
+=(
v¬s
[
i
]+
®pha
*
h
[i])*
Algeb¿
::
pow
<3>(
R
[i]-
r
);

514  
ªs
;

515 
	}
}

519 
	gPÙF™RhoS¶
::
	$fšd_max_®pha
(
ty³0
& 
max_®pha
)

522 
ty³0
 
c0
[4]={0.0,0.0,0.0,0.0};

523 
ty³0
 
dc
[4]={0.0,0.0,0.0,0.0};

524 
ty³0
 
x_hi
,
x_lo
,
f_lo
,
df_lo
;

525 
boŞ
 
dof
=
çl£
;

526 
size_t
 
i
=0;i<
nv¬s
;i++)

528 if(
max_®pha
==0.0) ;

530 
c0
[0]+=-
v¬s
[
i
];

531 
c0
[1]+=
v¬s
[
i
]*3.0*
R
[i];

532 
c0
[2]+=-
v¬s
[
i
]*3.0*
R
[i]*R[i];

533 
c0
[3]+=
v¬s
[
i
]*
R
[i]*R[i]*R[i];

534 if(
dofs
[
i
]è
dof
=
Œue
;

535 if(!
dof
) ;

536 
dc
[0]+=-
hv¬s
[
i
];

537 
dc
[1]+=
hv¬s
[
i
]*3.0*
R
[i];

538 
dc
[2]+=-
hv¬s
[
i
]*3.0*
R
[i]*R[i];

539 
dc
[3]+=
hv¬s
[
i
]*
R
[i]*R[i]*R[i];

540 
x_hi
=
R
[
i
];

541 if(
i
!=
nv¬s
-1è
x_lo
=
R
[i+1];

542 
x_lo
=0.0;

544 
df_lo
=
	`F
(
hv¬s
,
x_lo
);

545 if(
df_lo
!=0.0)

546 
max_®pha
=
	`MIN
(max_®pha,
dv¬s_max
[
i
]/
	`çbs
(
df_lo
));

548 
f_lo
=
	`F
(
x_lo
);

549 if((
df_lo
<0.0 && 
¡d
::
	`isšf
(
max_®pha
)è|| 
f_lo
+max_alpha*df_lo<0.0)

551 
max_®pha
=
	`MIN
(max_®pha,-
f_lo
/
df_lo
);

553 
™
=0;™<
NMAX_ALPHA_SHRNK_ATTMPS
&&
	`F
(
max_®pha
,
hv¬s
,
x_lo
)<0.0;it++)

554 
max_®pha
=
	`Ãxá”
(max_alpha,0.0);

555 if(
	`F
(
max_®pha
,
hv¬s
,
x_lo
)<0.0) max_alpha=0.0;

558 if(
¡d
::
	`isšf
(
max_®pha
))

559 
	`¦pše_max_®pha
(
c0
,
dc
,
x_lo
,
x_hi
,
max_®pha
);

561 
	`¦pše_max_®pha
(
hv¬s
,
c0
,
dc
,
x_lo
,
x_hi
,
max_®pha
);

563 
	}
}

567 
	gPÙF™RhoS¶
::
	$¿ndom_Ãigh
(
Rªdom
* 
¿ndom
)

569 
size_t
 
i
=0;i<
nv¬s
;i++)

570 
hv¬s
[
i
]=(2.0*
¿ndom
->
	`unifÜm
()-1.0)*
dv¬s_max
[i];

587 
	}
}

591 
boŞ
 
	gPÙF™RhoS¶
::
	$v®id©e
()

593 
ty³0
 
c0
[4]={0.0,0.0,0.0,0.0};

594 
ty³0
 
c1
[3]={0.0,0.0,0.0};

595 
ty³0
 
ªs
[3];

596 
boŞ
 
dof
=
çl£
;

597 
ty³0
 
x_hi
,
x_lo
;

598 
ÄoÙs
;

600 
size_t
 
i
=0;i<
nv¬s
;i++)

602 
c0
[0]+=-
v¬s
[
i
];

603 
c0
[1]+=
v¬s
[
i
]*3.0*
R
[i];

604 
c0
[2]+=-
v¬s
[
i
]*3.0*
R
[i]*R[i];

605 
c0
[3]+=
v¬s
[
i
]*
R
[i]*R[i]*R[i];

606 if(
dofs
[
i
]è
dof
=
Œue
;

607 if(!
dof
) ;

608 
x_hi
=
R
[
i
];

609 if(
i
!=
nv¬s
-1è
x_lo
=
R
[i+1];

610 
x_lo
=0.0;

611 
ÄoÙs
=0;

612 if(
c0
[0]!=0.0)

614 
c1
[0]=
c0
[1]/c0[0];

615 
c1
[1]=
c0
[2]/c0[0];

616 
c1
[2]=
c0
[3]/c0[0];

617 
ÄoÙs
=
	`cubic
(
c1
,
ªs
);

619 if(
c0
[1]!=0.0)

621 
c1
[0]=
c0
[2]/c0[1];

622 
c1
[1]=
c0
[3]/c0[1];

623 
ÄoÙs
=
	`quad¿tic
(
c1
,
ªs
);

625 if(
c0
[2]!=0.0)

627 
ÄoÙs
=1;

628 
ªs
[0]=-
c0
[3]/c0[2];

630 if(
c0
[3]<0.0è 
çl£
;

632 
j
=0;j<
ÄoÙs
;j++)

633 if(
x_lo
<=
ªs
[
j
] &&‡ns[j]<
x_hi
è 
çl£
;

636  
Œue
;

637 
	}
}

641 
	gPÙF™RhoS¶
::
	$£t_š™
(
PyObjeù
* 
v®
,
ty³0
*& 
d©a
,
size_t
& 
d©a_sz
)

643 
V¬API
<
ty³0
* [2]> 
	`v¬
(
Çme
);

644 
v¬
.
v®
[0]=
NULL
;

645 
v¬
.
v®
[1]=
NULL
;

646 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

647 if(
v¬
.
__v¬__
[0].
size
!=var.__var__[1].size)

649 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"sizmism©ch iÀ%s",
Çme
);

652 
nv¬s
=
v¬
.
__v¬__
[0].
size
;

653 
MemÜy
::
	`d—Îoc
(
R
);

654 
R
=
NULL
;

655 
MemÜy
::
	`®loc
(
R
,
nv¬s
);

656 
MemÜy
::
	`grow
(
d©a
,
d©a_sz
,d©a_sz+
nv¬s
);

657 
	`memıy
(
d©a
+
d©a_sz
,
v¬
.
v®
[0],
nv¬s
*(
ty³0
));

658 
	`memıy
(
R
,
v¬
.
v®
[1],
nv¬s
*(
ty³0
));

659 
rc
=
PÙF™RhoS¶
::
	`sÜt
(
d©a
+
d©a_sz
,
R
,
nv¬s
);

660 
d©a_sz
+=
nv¬s
;

662 
	}
}

666 
	gPÙF™RhoS¶
::
	$£t
(
PyObjeù
* 
v®
)

668 
V¬API
<
ty³0
*> 
	`v¬
(
Çme
);

669 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

670 if(
v¬
.
__v¬__
.
size
!=
nv¬s
)

672 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"sizmism©ch iÀ%s",
Çme
);

675 
	`memıy
(
v¬s
,
v¬
.
v®
,
nv¬s
*(
ty³0
));

677 
	}
}

681 
	gPÙF™RhoAng
::
	$PÙF™RhoAng
(cÚ¡ * 
__Çme
):

682 
	$PÙF™PaœFunc
(
__Çme
)

684 
rc
=2.8;

685 
	}
}

689 
	gPÙF™RhoAng
::~
	$PÙF™RhoAng
()

691 
	}
}

695 
ty³0
 
PÙF™RhoAng
::
	$F
(
ty³0
 
r
)

697 if(
r
>=
rc
)  0.0;

698 
ty³0
 
y
=
	`exp
(-
v¬s
[1]*
r
);

699  
v¬s
[0]*
	`exp
(1.0/(
r
-
rc
))*
Algeb¿
::
pow
<6>Ô)*
y
*(1.0+512.0*y);

700 
	}
}

704 
ty³0
 
	gPÙF™RhoAng
::
	$dF
(
ty³0
 
r
)

706 if(
r
>=
rc
)  0.0;

707 
ty³0
 
y
=
	`exp
(-
v¬s
[1]*
r
);

708 
ty³0
 
rho
=
v¬s
[0]*
	`exp
(1.0/(
r
-
rc
))*
Algeb¿
::
pow
<6>Ô)*
y
*(1.0+512.0*y);

709  
rho
*(6.0/
r
-1.0/(Ô-
rc
)*Ô-rc))-
v¬s
[1]*(1.0+
y
/(0.001953125+y)));

710 
	}
}

714 
ty³0
 
	gPÙF™RhoAng
::
	$ddF
(
ty³0
 
r
)

716 if(
r
>=
rc
)  0.0;

717 
ty³0
 
y
=
	`exp
(-
v¬s
[1]*
r
);

718 
ty³0
 
z
=(
r
-
rc
)*(r-rc);

719 
ty³0
 
x0
=1.0+512.0*
y
;

720 
ty³0
 
x1
=1.0+1024.0*
y
;

721 
ty³0
 
x2
=1.0+2048.0*
y
;

725 
v¬s
[0]*
r
*r*r*r*
y
*
	`exp
(1.0/Ô-
rc
))*

726 ((30.0+
r
*Ô+r*r-11.0*
z
-
rc
*rc)/(z*z))*
x0
+

727 2.0*
v¬s
[1]*
r
*Ô/
z
-6.0)*
x1
+

728 
v¬s
[1]*v¬s[1]*
r
*r*
x2
);

729 
	}
}

733 
	gPÙF™RhoAng
::
	$DF
(
ty³0
 
cÛf
,ty³0 
r
,ty³0* 
dv
)

735 if(
r
>=
rc
) ;

736 
ty³0
 
y
=
	`exp
(-
v¬s
[1]*
r
);

737 
ty³0
 
c0
=
	`exp
(1.0/(
r
-
rc
))*
Algeb¿
::
pow
<6>(r);

738 
dv
[0]+=
cÛf
*
c0
*
y
*(1.0+512.0*y);

739 
dv
[1]+=-
cÛf
*
v¬s
[0]*
r
*
c0
*
y
*(1.0+1024.0*y);

740 
	}
}

744 
	gPÙF™RhoAng
::
	$DdF
(
ty³0
 
cÛf
,ty³0 
r
,ty³0* 
dv
)

746 if(
r
>=
rc
) ;

747 
ty³0
 
y
=
	`exp
(-
v¬s
[1]*
r
);

748 
dv
[0]+=
cÛf
*(6.0/
r
-1.0/(Ô-
rc
)*Ô-rc))-
v¬s
[1]*(1.0+
y
/(0.001953125+y)))*
	`exp
(1.0/Ô-rc))*
Algeb¿
::
pow
<6>(r)*y*(1.0+512.0*y);

749 
ty³0
 
c0
=
	`exp
(1.0/(
r
-
rc
))*
Algeb¿
::
pow
<7>Ô)*
y
*(1.0+1024.0*y);

750 
dv
[1]+=
cÛf
*
v¬s
[0]*
c0
*(v¬s[1]*(1.0+
y
/(0.0009765625+y))-7.0/
r
+1.0/
Algeb¿
::
pow
<2>Ô-
rc
));

751 
	}
}

755 
	gPÙF™RhoAng
::
	$fšd_max_®pha
(
ty³0
& 
max_®pha
)

757 
max_®pha
=
	`MIN
(max_®pha,
PÙF™Aux
::
	`fšd_max_®pha
(0.0,
¡d
::
num”ic_lim™s
<
ty³0
>::
	`qu›t_NaN
(),
dv¬s_max
[0],
v¬s
[0],
hv¬s
[0]));

758 
max_®pha
=
	`MIN
(max_®pha,
PÙF™Aux
::
	`fšd_max_®pha
(0.0,
¡d
::
num”ic_lim™s
<
ty³0
>::
	`qu›t_NaN
(),
dv¬s_max
[1],
v¬s
[1],
hv¬s
[1]));

760 
	}
}

764 
boŞ
 
	gPÙF™RhoAng
::
	$v®id©e
()

766 if(
v¬s
[0]<0.0è 
çl£
;

767 if(
v¬s
[1]<0.0è 
çl£
;

768  
Œue
;

769 
	}
}

773 
	gPÙF™RhoAng
::
	$£t_š™
(
PyObjeù
* 
v®
,
ty³0
*& 
d©a
,
size_t
& 
d©a_sz
)

776 
V¬API
<
ty³0
 [2]> 
	`v¬
(
Çme
);

777 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

778 
nv¬s
=2;

779 
MemÜy
::
	`grow
(
d©a
,
d©a_sz
,d©a_sz+
nv¬s
);

780 
	`memıy
(
d©a
+
d©a_sz
,
v¬
.
v®
,
nv¬s
*(
ty³0
));

781 
d©a_sz
+=
nv¬s
;

783 
	}
}

787 
	gPÙF™RhoAng
::
	$£t
(
PyObjeù
* 
v®
)

789 
V¬API
<
ty³0
[2]> 
	`v¬
(
Çme
);

790 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

791 
	`memıy
(
v¬s
,
v¬
.
v®
,
nv¬s
*(
ty³0
));

793 
	}
}

803 
	gPÙF™PhiS¶
::
	$PÙF™PhiS¶
(cÚ¡ * 
__Çme
):

804 
	`PÙF™PaœFunc
(
__Çme
),

805 
	$R
(
NULL
)

807 
	}
}

811 
	gPÙF™PhiS¶
::~
	$PÙF™PhiS¶
()

813 
MemÜy
::
	`d—Îoc
(
R
);

814 
	}
}

818 
ty³0
 
	gPÙF™PhiS¶
::
	$F
(
ty³0
 
r
)

820 if(
r
>=
rc
)  0.0;

821 
ty³0
 
ªs
=0.0;

822 
size_t
 
i
=0;i<
nv¬s
 && 
r
<
R
[i];i++)

823 
ªs
+=
v¬s
[
i
]*
Algeb¿
::
pow
<3>(
R
[i]-
r
);

824  
ªs
;

825 
	}
}

829 
ty³0
 
	gPÙF™PhiS¶
::
	$dF
(
ty³0
 
r
)

831 if(
r
>=
rc
)  0.0;

832 
ty³0
 
ªs
=0.0;

833 
size_t
 
i
=0;i<
nv¬s
 && 
r
<
R
[i];i++)

834 
ªs
+=-3.0*
v¬s
[
i
]*
Algeb¿
::
pow
<2>(
R
[i]-
r
);

835  
ªs
;

836 
	}
}

840 
ty³0
 
	gPÙF™PhiS¶
::
	$ddF
(
ty³0
 
r
)

842 if(
r
>=
rc
)  0.0;

843 
ty³0
 
ªs
=0.0;

844 
size_t
 
i
=0;i<
nv¬s
 && 
r
<
R
[i];i++)

845 
ªs
+=6.0*
v¬s
[
i
]*(
R
[i]-
r
);

846  
ªs
;

847 
	}
}

851 
	gPÙF™PhiS¶
::
	$DF
(
ty³0
 
cÛf
,ty³0 
r
,ty³0* 
dv
)

853 if(
r
>=
rc
) ;

854 
size_t
 
i
=0;i<
nv¬s
 && 
r
<
R
[i];i++)

855 
dv
[
i
]+=
cÛf
*
Algeb¿
::
pow
<3>(
R
[i]-
r
);

856 
	}
}

860 
	gPÙF™PhiS¶
::
	$DdF
(
ty³0
 
cÛf
,ty³0 
r
,ty³0* 
dv
)

862 if(
r
>=
rc
) ;

863 
size_t
 
i
=0;i<
nv¬s
 && 
r
<
R
[i];i++)

864 
dv
[
i
]+=-
cÛf
*3.0*
Algeb¿
::
pow
<2>(
R
[i]-
r
);

865 
	}
}

869 
ty³0
 
	gPÙF™PhiS¶
::
	$F
(
ty³0
* 
h
,ty³0 
r
)

871 if(
r
>=
rc
)  0.0;

872 
ty³0
 
ªs
=0.0;

873 
size_t
 
i
=0;i<
nv¬s
 && 
r
<
R
[i];i++)

874 
ªs
+=
h
[
i
]*
Algeb¿
::
pow
<3>(
R
[i]-
r
);

875  
ªs
;

876 
	}
}

880 
	gPÙF™PhiS¶
::
	$fšd_max_®pha
(
ty³0
& 
max_®pha
)

882 
ty³0
 
x_lo
,
df_lo
;

883 
boŞ
 
dof
=
çl£
;

884 
size_t
 
i
=0;i<
nv¬s
;i++)

886 if(
max_®pha
==0.0) ;

887 if(
hv¬s
[
i
]!=0.0è
dof
=
Œue
;

888 if(!
dof
) ;

890 if(
i
!=
nv¬s
-1è
x_lo
=
R
[i+1];

891 
x_lo
=0.0;

893 
df_lo
=
	`F
(
hv¬s
,
x_lo
);

894 if(
df_lo
!=0.0)

895 
max_®pha
=
	`MIN
(max_®pha,
dv¬s_max
[
i
]/
	`çbs
(
df_lo
));

897 
	}
}

901 
	gPÙF™PhiS¶
::
	$¿ndom_Ãigh
(
Rªdom
* 
¿ndom
)

903 
size_t
 
i
=0;i<
nv¬s
;i++)

904 
hv¬s
[
i
]=(2.0*
¿ndom
->
	`unifÜm
()-1.0)*
dv¬s_max
[i];

921 
	}
}

925 
boŞ
 
	gPÙF™PhiS¶
::
	$v®id©e
()

927  
Œue
;

928 
	}
}

932 
	gPÙF™PhiS¶
::
	$£t_š™
(
PyObjeù
* 
v®
,
ty³0
*& 
d©a
,
size_t
& 
d©a_sz
)

934 
V¬API
<
ty³0
* [2]> 
	`v¬
(
Çme
);

935 
v¬
.
v®
[0]=
NULL
;

936 
v¬
.
v®
[1]=
NULL
;

938 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

939 if(
v¬
.
__v¬__
[0].
size
!=var.__var__[1].size)

941 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"sizmism©ch iÀ%s",
Çme
);

944 
nv¬s
=
v¬
.
__v¬__
[0].
size
;

945 
MemÜy
::
	`d—Îoc
(
R
);

946 
R
=
NULL
;

947 
MemÜy
::
	`®loc
(
R
,
nv¬s
);

948 
MemÜy
::
	`grow
(
d©a
,
d©a_sz
,d©a_sz+
nv¬s
);

949 
	`memıy
(
d©a
+
d©a_sz
,
v¬
.
v®
[0],
nv¬s
*(
ty³0
));

950 
	`memıy
(
R
,
v¬
.
v®
[1],
nv¬s
*(
ty³0
));

951 
rc
=
PÙF™RhoS¶
::
	`sÜt
(
d©a
+
d©a_sz
,
R
,
nv¬s
);

952 
d©a_sz
+=
nv¬s
;

954 
	}
}

958 
	gPÙF™PhiS¶
::
	$£t
(
PyObjeù
* 
v®
)

960 
V¬API
<
ty³0
*> 
	`v¬
(
Çme
);

961 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

962 if(
v¬
.
__v¬__
.
size
!=
nv¬s
)

964 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"sizmism©ch iÀ%s",
Çme
);

967 
	`memıy
(
v¬s
,
v¬
.
v®
,
nv¬s
*(
ty³0
));

969 
	}
}

979 
	gPÙF™EmbFunc
::
	$PÙF™EmbFunc
(cÚ¡ * 
__Çme
):

980 
	`Çme
(
__Çme
),
	`nv¬s
(0),
	`v¬s
(
NULL
),
	`dv¬s_lş
(NULL),

981 
	`A_Çme
(
¡d
::
	`¡ršg
("A_")+¡d::¡ršg(
Çme
)),

982 
	`dA_Çme_max
(
¡d
::
	`¡ršg
("dA_")+¡d::¡ršg(
Çme
)+std::string("_max")),

983 
	`A_Çme_dof
(
¡d
::
	`¡ršg
("A_")+¡d::¡ršg(
Çme
)+std::string("_dof"))

985 
	}
}

989 
PÙF™EmbFunc
::~
	$PÙF™EmbFunc
()

991 
	}
}

995 
PÙF™EmbFunc
::
	$¿ndom_Ãigh
(
Rªdom
* 
¿ndom
)

997 
size_t
 
i
=0;i<
nv¬s
;i++)

998 
hv¬s
[
i
]=(2.0*
¿ndom
->
	`unifÜm
()-1.0)*
dv¬s_max
[i];

999 
	}
}

1003 
	gPÙF™EmbFunc
::
	$£t_A
(
PyObjeù
* 
v®
)

1005 
V¬API
<
ty³0
*> 
	`v¬
(
A_Çme
.
	`c_¡r
());

1006 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

1007 if(
v¬
.
__v¬__
.
size
!=
nv¬s
)

1009 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"sizmism©ch iÀ%s",
A_Çme
.
	`c_¡r
());

1012 
	`memıy
(
v¬s
,
v¬
.
v®
,
nv¬s
*(
ty³0
));

1014 
	}
}

1018 
PyObjeù
* 
	gPÙF™EmbFunc
::
	$g‘_A
()

1020 
size_t
* 
szp
=&
nv¬s
;

1021  
v¬
<
ty³0
*>::
	`bud
(
v¬s
,&
szp
);

1022 
	}
}

1026 
	gPÙF™EmbFunc
::
	$£t_dA_max
(
PyObjeù
* 
v®
)

1028 
V¬API
<
ty³0
*> 
	`v¬
(
dA_Çme_max
.
	`c_¡r
());

1029 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

1030 if(
v¬
.
__v¬__
.
size
!=
nv¬s
)

1032 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"sizmism©ch iÀ%s",
dA_Çme_max
.
	`c_¡r
());

1035 
	`memıy
(
dv¬s_max
,
v¬
.
v®
,
nv¬s
*(
ty³0
));

1037 
	}
}

1041 
PyObjeù
* 
	gPÙF™EmbFunc
::
	$g‘_dA_max
()

1043 
size_t
* 
szp
=&
nv¬s
;

1044  
v¬
<
ty³0
*>::
	`bud
(
dv¬s_max
,&
szp
);

1045 
	}
}

1049 
	gPÙF™EmbFunc
::
	$£t_A_dof
(
PyObjeù
* 
v®
)

1051 
V¬API
<
boŞ
*> 
	`v¬
(
A_Çme_dof
.
	`c_¡r
());

1052 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

1053 if(
v¬
.
__v¬__
.
size
!=
nv¬s
)

1055 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"sizmism©ch iÀ%s",
A_Çme_dof
.
	`c_¡r
());

1058 
	`memıy
(
dofs
,
v¬
.
v®
,
nv¬s
*(
boŞ
));

1060 
	}
}

1064 
PyObjeù
* 
	gPÙF™EmbFunc
::
	$g‘_A_dof
()

1066 
size_t
* 
szp
=&
nv¬s
;

1067  
v¬
<
boŞ
*>::
	`bud
(
dofs
,&
szp
);

1068 
	}
}

1072 
	gPÙF™EmbAck
::
	$PÙF™EmbAck
(cÚ¡ * 
__Çme
):

1073 
	$PÙF™EmbFunc
(
__Çme
)

1075 
	}
}

1079 
PÙF™EmbAck
::~
	$PÙF™EmbAck
()

1081 
	}
}

1085 
ty³0
 
PÙF™EmbAck
::
	$F
(
ty³0
 
rho
)

1087  
v¬s
[0]*
	`sq¹
(
rho
)+(vars[1]+vars[2]*rho*rho)*rho*rho;

1088 
	}
}

1092 
ty³0
 
	gPÙF™EmbAck
::
	$dF
(
ty³0
 
rho
)

1094 if(
rho
==0.0)  0.0;

1095  0.5*
v¬s
[0]/
	`sq¹
(
rho
)+2.0*rho*(vars[1]+2.0*vars[2]*rho*rho);

1096 
	}
}

1100 
ty³0
 
	gPÙF™EmbAck
::
	$ddF
(
ty³0
 
rho
)

1102 if(
rho
==0.0)  0.0;

1104  -0.25*
v¬s
[0]/(
rho
*
	`sq¹
(rho))+2.0*vars[1]+12.0*vars[2]*rho*rho;

1105 
	}
}

1109 
	gPÙF™EmbAck
::
	$DF
(
ty³0
 
rho
,ty³0* 
dv
)

1111 if(
rho
==0.0) ;

1112 
dv
[0]+=
	`sq¹
(
rho
);

1113 
dv
[1]+=
rho
*rho;

1114 
dv
[2]+=
rho
*rho*rho*rho;

1115 
	}
}

1119 
	gPÙF™EmbAck
::
	$DdF
(
ty³0
 
rho
,ty³0* 
dv
)

1121 if(
rho
==0.0) ;

1122 
dv
[0]+=0.5/
	`sq¹
(
rho
);

1123 
dv
[1]+=2.0*
rho
;

1124 
dv
[2]+=4.0*
rho
*rho*rho;

1125 
	}
}

1129 
	gPÙF™EmbAck
::
	$fšd_max_®pha
(
ty³0
& 
max_®pha
)

1131 
max_®pha
=
	`MIN
(max_®pha,
PÙF™Aux
::
	`fšd_max_®pha
(
¡d
::
num”ic_lim™s
<
ty³0
>::
	`qu›t_NaN
(),0.0,
dv¬s_max
[0],
v¬s
[0],
hv¬s
[0]));

1132 
max_®pha
=
	`MIN
(max_®pha,
PÙF™Aux
::
	`fšd_max_®pha
(
¡d
::
num”ic_lim™s
<
ty³0
>::
	`qu›t_NaN
(),¡d::num”ic_lim™s<ty³0>::qu›t_NaN(),
dv¬s_max
[1],
v¬s
[1],
hv¬s
[1]));

1133 
max_®pha
=
	`MIN
(max_®pha,
PÙF™Aux
::
	`fšd_max_®pha
(
¡d
::
num”ic_lim™s
<
ty³0
>::
	`qu›t_NaN
(),¡d::num”ic_lim™s<ty³0>::qu›t_NaN(),
dv¬s_max
[2],
v¬s
[2],
hv¬s
[2]));

1134 
	}
}

1138 
boŞ
 
	gPÙF™EmbAck
::
	$v®id©e
()

1140 if(
v¬s
[0]>0.0è 
çl£
;

1141 if(
v¬s
[2]>0.0 && 0.875*
	`pow
(-2.0*v¬s[0],4.0/7.0)*pow(v¬s[2],3.0/7.0)+v¬s[1]<0.0è 
çl£
;

1142  
Œue
;

1143 
	}
}

1147 
	gPÙF™EmbAck
::
	$£t_š™
(
PyObjeù
* 
v®
,
ty³0
*& 
d©a
,
size_t
& 
d©a_sz
)

1150 
V¬API
<
ty³0
 [3]> 
	`v¬
("F");

1151 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

1152 
nv¬s
=3;

1153 
MemÜy
::
	`grow
(
d©a
,
d©a_sz
,d©a_sz+
nv¬s
);

1154 
	`memıy
(
d©a
+
d©a_sz
,
v¬
.
v®
,
nv¬s
*(
ty³0
));

1155 
d©a_sz
+=
nv¬s
;

1157 
	}
}

1161 
	gPÙF™EmbAck
::
	$£t
(
PyObjeù
* 
v®
)

1163 
V¬API
<
ty³0
[3]> 
	`v¬
(
Çme
);

1164 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

1165 
	`memıy
(
v¬s
,
v¬
.
v®
,
nv¬s
*(
ty³0
));

1167 
	}
}

1171 
	gPÙF™EmbAng
::
	$PÙF™EmbAng
(cÚ¡ * 
__Çme
):

1172 
	$PÙF™EmbFunc
(
__Çme
)

1174 
ty³0
 
t
=3.0*
	`sq¹
(5.0)*
	`cos
((
M_PI
-
	`acos
(0.4*sqrt(5.0)))/3.0)-2.5;

1175 
lim
=
	`pow
(
t
,2.0/3.0)*(Ñ+5.0)*t-5.0)/(9.0*t*
Algeb¿
::
pow
<3>(1.0+t));

1176 
	}
}

1180 
	gPÙF™EmbAng
::~
	$PÙF™EmbAng
()

1182 
	}
}

1186 
ty³0
 
PÙF™EmbAng
::
	$F
(
ty³0
 
rho
)

1188 
ty³0
 
rho_b
=
rho
/
v¬s
[3];

1189 
ty³0
 
rho_b_2_3
=
	`pow
(
rho_b
,2.0/3.0);

1191  (
v¬s
[0]*
rho_b
+v¬s[1]+v¬s[2]*
lim
*rho_b+v¬s[2]*
rho_b_2_3
/(1.0+rho_b))*rho_b;

1192 
	}
}

1196 
ty³0
 
	gPÙF™EmbAng
::
	$dF
(
ty³0
 
rho
)

1198 if(
rho
==0.0)  0.0;

1199 
ty³0
 
rho_b
=
rho
/
v¬s
[3];

1200 
ty³0
 
rho_b_2_3
=
	`pow
(
rho_b
,2.0/3.0);

1202  (2.0*
v¬s
[0]*
rho_b
+v¬s[1]+2.0*v¬s[2]*
lim
*rho_b+v¬s[2]*
rho_b_2_3
*(5.0+2.0*rho_b)/(3.0*
Algeb¿
::
pow
<2>(1.0+rho_b)))/vars[3];

1203 
	}
}

1207 
ty³0
 
	gPÙF™EmbAng
::
	$ddF
(
ty³0
 
rho
)

1209 if(
rho
==0.0)  0.0;

1210 
ty³0
 
rho_b
=
rho
/
v¬s
[3];

1211 
ty³0
 
rho_b_2_3
=
	`pow
(
rho_b
,2.0/3.0);

1213  2.0*(
v¬s
[0]-v¬s[2]*
lim
-v¬s[2]*
rho_b_2_3
*((
rho_b
+5.0)*rho_b-5.0)/(9.0*rho_b*
Algeb¿
::
pow
<3>(1.0+rho_b)))/(vars[3]*vars[3]);

1214 
	}
}

1218 
	gPÙF™EmbAng
::
	$DF
(
ty³0
 
rho
,ty³0* 
dv
)

1220 if(
rho
==0.0) ;

1221 
ty³0
 
rho_b
=
rho
/
v¬s
[3];

1222 
ty³0
 
rho_b_2_3
=
	`pow
(
rho_b
,2.0/3.0);

1223 
dv
[0]+=
rho_b
*rho_b;

1224 
dv
[1]+=
rho_b
;

1226 
dv
[2]+=
lim
*
rho_b
*rho_b+rho_b*
rho_b_2_3
/(1.0+rho_b);

1227 
dv
[3]+=-
rho_b
*(2.0*
v¬s
[0]*rho_b+v¬s[1]+v¬s[2]*
rho_b_2_3
*(5.0+2.0*rho_b)/(3.0*
Algeb¿
::
pow
<2>(1.0+rho_b)))/vars[3];

1229 
	}
}

1233 
	gPÙF™EmbAng
::
	$DdF
(
ty³0
 
rho
,ty³0* 
dv
)

1235 if(
rho
==0.0) ;

1236 
ty³0
 
rho_b
=
rho
/
v¬s
[3];

1237 
ty³0
 
rho_b_2_3
=
	`pow
(
rho_b
,2.0/3.0);

1238 
dv
[0]+=2.0*
rho_b
/
v¬s
[3];

1239 
dv
[1]+=1.0/
v¬s
[3];

1241 
dv
[2]+=(2.0*
lim
*
rho_b
+
rho_b_2_3
*(5.0+2.0*rho_b)/(3.0*(1.0+rho_b)*(1.0+rho_b)))/
v¬s
[3];

1242 
dv
[3]+=

1243 (
v¬s
[0]+

1244 
v¬s
[1]*4.0*
rho_b
+

1245 
v¬s
[2]*
rho_b_2_3
*((4.0*
rho_b
+11.0)*rho_b+25.0)/(9.0*
Algeb¿
::
pow
<3>((1.0+rho_b))))/(vars[3]*vars[3]);

1246 
	}
}

1250 
	gPÙF™EmbAng
::
	$fšd_max_®pha
(
ty³0
& 
max_®pha
)

1252 
max_®pha
=
	`MIN
(max_®pha,
PÙF™Aux
::
	`fšd_max_®pha
(0.0,
¡d
::
num”ic_lim™s
<
ty³0
>::
	`qu›t_NaN
(),
dv¬s_max
[2],
v¬s
[2],
hv¬s
[2]));

1253 
max_®pha
=
	`MIN
(max_®pha,
PÙF™Aux
::
	`fšd_max_®pha
(0.0,
¡d
::
num”ic_lim™s
<
ty³0
>::
	`qu›t_NaN
(),
dv¬s_max
[3],
v¬s
[3],
hv¬s
[3]));

1254 
max_®pha
=
	`MIN
(max_®pha,
PÙF™Aux
::
	`fšd_max_®pha
(
¡d
::
num”ic_lim™s
<
ty³0
>::
	`qu›t_NaN
(),¡d::num”ic_lim™s<ty³0>::qu›t_NaN(),
dv¬s_max
[1],
v¬s
[1],
hv¬s
[1]));

1255 
max_®pha
=
	`MIN
(max_®pha,
PÙF™Aux
::
	`fšd_max_®pha
(0.0,
¡d
::
num”ic_lim™s
<
ty³0
>::
	`qu›t_NaN
(),
dv¬s_max
[0],
v¬s
[0],
hv¬s
[0]));

1256 
	}
}

1260 
boŞ
 
	gPÙF™EmbAng
::
	$v®id©e
()

1262 if(
v¬s
[3]<0.0è 
çl£
;

1263 if(
v¬s
[0]<0.0è 
çl£
;

1264 if(
v¬s
[2]<0.0è 
çl£
;

1265  
Œue
;

1266 
	}
}

1270 
	gPÙF™EmbAng
::
	$£t_š™
(
PyObjeù
* 
v®
,
ty³0
*& 
d©a
,
size_t
& 
d©a_sz
)

1273 
V¬API
<
ty³0
 [4]> 
	`v¬
(
Çme
);

1274 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

1275 
nv¬s
=4;

1276 
MemÜy
::
	`grow
(
d©a
,
d©a_sz
,d©a_sz+
nv¬s
);

1277 
	`memıy
(
d©a
+
d©a_sz
,
v¬
.
v®
,
nv¬s
*(
ty³0
));

1278 
d©a_sz
+=
nv¬s
;

1280 
	}
}

1284 
	gPÙF™EmbAng
::
	$£t
(
PyObjeù
* 
v®
)

1286 
V¬API
<
ty³0
[4]> 
	`v¬
(
Çme
);

1287 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

1288 
	`memıy
(
v¬s
,
v¬
.
v®
,
nv¬s
*(
ty³0
));

1290 
	}
}

	@potfit_funcs.h

1 #iâdeà
__MAPP__pÙf™_funcs__


2 
	#__MAPP__pÙf™_funcs__


	)

3 
	~"­i.h
"

4 
	~"glob®.h
"

5 
	~"xm©h.h
"

6 
Çme¥aû
 
	gMAPP_NS


8 şas 
	cPÙF™Aux


10 
	g´iv©e
:

11 
´Ùeùed
:

12 
public
:

13 
ty³0
 
fšd_max_®pha
(cÚ¡y³0,cÚ¡y³0,
boŞ
,type0,type0,type0);

14 
ty³0
 
fšd_max_®pha
(constype0,constype0,type0,type0,type0);

16 şas 
	cPÙF™PaœFunc


18 
	g´iv©e
:

19 
´Ùeùed
:

20 
public
:

21 
PÙF™PaœFunc
(const *);

22 
	gvœtu®
 ~
PÙF™PaœFunc
();

23 cÚ¡ * 
	gÇme
;

24 
	g¡d
::
¡ršg
 
A_Çme
;

25 
	g¡d
::
¡ršg
 
dA_Çme_max
;

26 
	g¡d
::
¡ršg
 
A_Çme_dof
;

28 
ty³0
* 
	gv¬s
;

29 
ty³0
* 
	ghv¬s
;

30 
ty³0
* 
	gdv¬s_max
;

31 
ty³0
* 
	gdv¬s_lş
;

32 
boŞ
* 
	gdofs
;

33 
ty³0
 
	grc
;

34 
size_t
 
	gnv¬s
;

35 
vœtu®
 
ty³0
 
F
(type0)=0;

36 
vœtu®
 
ty³0
 
dF
(type0)=0;

37 
vœtu®
 
ty³0
 
ddF
(type0)=0;

38 
vœtu®
 
DF
(
ty³0
,type0,type0*)=0;

39 
vœtu®
 
DdF
(
ty³0
,type0,type0*)=0;

40 
vœtu®
 
fšd_max_®pha
(
ty³0
&)=0;

41 
vœtu®
 
¿ndom_Ãigh
(
şass
 
Rªdom
*);

42 
vœtu®
 
boŞ
 
v®id©e
()=0;

43 
vœtu®
 
£t_š™
(
PyObjeù
*,
ty³0
*&,
size_t
&)=0;

45 
DF
(
ty³0
 
cÛf
,ty³0 
r
){DF(cÛf,r,
dv¬s_lş
);};

46 
DdF
(
ty³0
 
cÛf
,ty³0 
r
){DdF(cÛf,r,
dv¬s_lş
);};

48 
vœtu®
 
£t_A
(
PyObjeù
*);

49 
vœtu®
 
PyObjeù
* 
g‘_A
();

50 
vœtu®
 
£t_dA_max
(
PyObjeù
*);

51 
vœtu®
 
PyObjeù
* 
g‘_dA_max
();

52 
vœtu®
 
£t_A_dof
(
PyObjeù
*);

53 
vœtu®
 
PyObjeù
* 
g‘_A_dof
();

56 şas 
	cPÙF™EmbFunc


58 
	g´iv©e
:

59 
´Ùeùed
:

60 
public
:

61 
PÙF™EmbFunc
(const *);

62 
	gvœtu®
 ~
PÙF™EmbFunc
();

63 cÚ¡ * 
	gÇme
;

64 
	g¡d
::
¡ršg
 
A_Çme
;

65 
	g¡d
::
¡ršg
 
dA_Çme_max
;

66 
	g¡d
::
¡ršg
 
A_Çme_dof
;

68 
ty³0
* 
	gv¬s
;

69 
ty³0
* 
	ghv¬s
;

70 
ty³0
* 
	gdv¬s_max
;

71 
ty³0
* 
	gdv¬s_lş
;

72 
boŞ
* 
	gdofs
;

73 
size_t
 
	gnv¬s
;

74 
vœtu®
 
ty³0
 
F
(type0)=0;

75 
vœtu®
 
ty³0
 
dF
(type0)=0;

76 
vœtu®
 
ty³0
 
ddF
(type0)=0;

77 
vœtu®
 
DF
(
ty³0
,type0*)=0;

78 
vœtu®
 
DdF
(
ty³0
,type0*)=0;

79 
vœtu®
 
fšd_max_®pha
(
ty³0
&)=0;

80 
vœtu®
 
¿ndom_Ãigh
(
şass
 
Rªdom
*);

81 
vœtu®
 
boŞ
 
v®id©e
()=0;

82 
vœtu®
 
£t_š™
(
PyObjeù
*,
ty³0
*&,
size_t
&)=0;

83 
DF
(
ty³0
 
rho
){DFÔho,
dv¬s_lş
);};

84 
DdF
(
ty³0
 
rho
){DdFÔho,
dv¬s_lş
);};

86 
vœtu®
 
£t_A
(
PyObjeù
*);

87 
vœtu®
 
PyObjeù
* 
g‘_A
();

88 
vœtu®
 
£t_dA_max
(
PyObjeù
*);

89 
vœtu®
 
PyObjeù
* 
g‘_dA_max
();

90 
vœtu®
 
£t_A_dof
(
PyObjeù
*);

91 
vœtu®
 
PyObjeù
* 
g‘_A_dof
();

95 şas 
	cPÙF™RhoS¶
: 
public
 
PÙF™PaœFunc


97 
´iv©e
:

98 
ty³0
* 
R
;

99 
quad¿tic
(
ty³0
*,type0*);

100 
cubic
(
ty³0
*,type0*);

101 
qu¬tic
(
ty³0
*,type0*);

104 
¦pše_max_®pha
(
ty³0
 (&)[4],type0 (&)[4],constype0&,constype0&,type0&);

105 
¦pše_max_®pha
(
ty³0
*,type0 (&)[4],type0 (&)[4],constype0&,constype0&,type0&);

107 
ty³0
 
F
(type0*,type0);

108 
ty³0
 
F
(type0,type0*,type0);

109 
	g´Ùeùed
:

110 
public
:

111 
ty³0
 
sÜt
Ñy³0*,ty³0*,
size_t
);

112 
PÙF™RhoS¶
(const *);

113 ~
PÙF™RhoS¶
();

114 
ty³0
 
F
(type0);

115 
ty³0
 
dF
(type0);

116 
ty³0
 
ddF
(type0);

117 
DF
(
ty³0
,type0,type0*);

118 
DdF
(
ty³0
,type0,type0*);

119 
fšd_max_®pha
(
ty³0
&);

120 
¿ndom_Ãigh
(
şass
 
Rªdom
*);

121 
boŞ
 
v®id©e
();

122 
£t_š™
(
PyObjeù
*,
ty³0
*&,
size_t
&);

123 
£t
(
PyObjeù
*);

127 şas 
	cPÙF™RhoAng
: 
public
 
PÙF™PaœFunc


129 
´iv©e
:

130 
´Ùeùed
:

131 
public
:

132 
PÙF™RhoAng
(const *);

133 ~
PÙF™RhoAng
();

134 
ty³0
 
F
(type0);

135 
ty³0
 
dF
(type0);

136 
ty³0
 
ddF
(type0);

137 
DF
(
ty³0
,type0,type0*);

138 
DdF
(
ty³0
,type0,type0*);

139 
fšd_max_®pha
(
ty³0
&);

140 
boŞ
 
v®id©e
();

141 
£t_š™
(
PyObjeù
*,
ty³0
*&,
size_t
&);

142 
£t
(
PyObjeù
*);

146 şas 
	cPÙF™PhiS¶
: 
public
 
PÙF™PaœFunc


148 
´iv©e
:

149 
ty³0
* 
R
;

150 
ty³0
 
F
(type0*,type0);

151 
	g´Ùeùed
:

152 
public
:

154 
PÙF™PhiS¶
(const *);

155 ~
PÙF™PhiS¶
();

156 
ty³0
 
F
(type0);

157 
ty³0
 
dF
(type0);

158 
ty³0
 
ddF
(type0);

159 
DF
(
ty³0
,type0,type0*);

160 
DdF
(
ty³0
,type0,type0*);

161 
fšd_max_®pha
(
ty³0
&);

162 
¿ndom_Ãigh
(
şass
 
Rªdom
*);

163 
boŞ
 
v®id©e
();

164 
£t_š™
(
PyObjeù
*,
ty³0
*&,
size_t
&);

165 
£t
(
PyObjeù
*);

169 şas 
	cPÙF™EmbAck
:
public
 
PÙF™EmbFunc


171 
´iv©e
:

172 
´Ùeùed
:

173 
public
:

174 
PÙF™EmbAck
(const *);

175 ~
PÙF™EmbAck
();

176 
ty³0
 
F
(type0);

177 
ty³0
 
dF
(type0);

178 
ty³0
 
ddF
(type0);

179 
DF
(
ty³0
,type0*);

180 
DdF
(
ty³0
,type0*);

181 
fšd_max_®pha
(
ty³0
&);

182 
boŞ
 
v®id©e
();

183 
£t_š™
(
PyObjeù
*,
ty³0
*&,
size_t
&);

184 
£t
(
PyObjeù
*);

187 şas 
	cPÙF™EmbAng
:
public
 
PÙF™EmbFunc


189 
´iv©e
:

190 
ty³0
 
lim
;

191 
	g´Ùeùed
:

192 
public
:

193 
PÙF™EmbAng
(const *);

194 ~
PÙF™EmbAng
();

195 
ty³0
 
F
(type0);

196 
ty³0
 
dF
(type0);

197 
ty³0
 
ddF
(type0);

198 
DF
(
ty³0
,type0*);

199 
DdF
(
ty³0
,type0*);

200 
fšd_max_®pha
(
ty³0
&);

202 
boŞ
 
v®id©e
();

203 
£t_š™
(
PyObjeù
*,
ty³0
*&,
size_t
&);

204 
£t
(
PyObjeù
*);

	@potfit_o.cpp

1 
	~"pÙf™_o.h
"

2 
	~"impÜt_cfg.h
"

3 
	~"mš.h
"

6 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

7 cÚ¡ * 
	gPÙF™O
::
”r_msgs
[]=

32 
	gPÙF™O
::
PÙF™O
(

33 
ty³0
(&
__A_rho_H
)[
Äho_H
],ty³0(&
__A_phi_FeH
)[
Åhi_FeH
],ty³0(&
__A_phi_HH
)[
Åhi_HH
],ty³0(&
__A_F_H
)[
nF_H
],

34 
¡d
::
¡ršg
*&& 
__Çmes_¡r
,

35 
¡d
::
¡ršg
*& 
fes
,

36 *& 
Årocs
,

37 
ty³0
(*& 
__rg‘s
)[1+
__nvoigt__
],

38 
ty³0
(*& 
__cÛfs
)[1+
__nvoigt__
],

39 
PyObjeù
** 
dof_funcs
,

40 
size_t
 
__ncÚfigs
,

41 
MPI_Comm
& 
__wÜld
):

42 
©oms
(
NULL
),

43 
	$wÜld
(
__wÜld
)

45 
nmš_¡•s
=1000;

46 
max_ÁrŸls
=5;

47 
”r_tŞ
=1.0e-8;

48 
ty³0
* 
__dx_max
;

49 
__dx_max
=
dx_max
+
rho_H_off£t
;

50 
__dx_max
[0]=100.0;

51 
__dx_max
[1]=0.1;

53 
__dx_max
=
dx_max
+
phi_FeH_off£t
;

54 
__dx_max
[0]=0.1;

55 
__dx_max
[1]=0.1;

56 
__dx_max
[2]=0.05;

57 
__dx_max
[2]=0.1;

59 
__dx_max
=
dx_max
+
phi_HH_off£t
;

60 
__dx_max
[0]=0.01;

61 
__dx_max
[1]=0.01;

62 
__dx_max
[2]=0.01;

63 
__dx_max
[3]=0.01;

65 
__dx_max
=
dx_max
+
F_H_off£t
;

66 
__dx_max
[0]=0.1;

67 
__dx_max
[1]=1.0;

68 
__dx_max
[2]=1.0;

72 
ncÚfigs
=
¡©ic_ÿ¡
<>(
__ncÚfigs
);

73 
Çmes_¡r
=
__Çmes_¡r
;

74 
__Çmes_¡r
=
NULL
;

75 
MemÜy
::
	`®loc
(
”rs
,
__ncÚfigs
);

76 
MemÜy
::
	`®loc
(
roÙs
,
__ncÚfigs
);

77 
MemÜy
::
	`®loc
(
Çmes
,
__ncÚfigs
);

78 
MemÜy
::
	`®loc
(
nHs
,
__ncÚfigs
);

79 
MemÜy
::
	`®loc
(
m—n_rhoHs
,
__ncÚfigs
);

80 
	`MPI_Comm_¿nk
(
wÜld
,&
my_¿nk
);

82 
tÙ_Åroc
=0;

83 
my_cÚf
=0;

84 
my_lş_¿nk
=0;

85 
i
=0;i<
ncÚfigs
;i++)

87 
Çmes
[
i
]=
Çmes_¡r
[i].
	`c_¡r
();

88 if(
tÙ_Åroc
<=
my_¿nk
 && my_¿nk<tÙ_Åroc+
Årocs
[
i
])

90 
my_cÚf
=
i
;

91 
my_lş_¿nk
=
my_¿nk
-
tÙ_Åroc
;

93 
roÙs
[
i
]=
tÙ_Åroc
;

94 
tÙ_Åroc
+=
Årocs
[
i
];

96 
my_wÜld
=
Ãw
 
MPI_Comm
;

98 
	`MPI_Comm_¥l™
(
wÜld
,
my_cÚf
,
my_lş_¿nk
,
my_wÜld
);

99 
cÛf
=
__cÛfs
[
my_cÚf
][0];

100 
rg‘
=
__rg‘s
[
my_cÚf
][0];

106 
ÁrŸl
=0;

113 
ImpÜtCFGMD
 
	`»ad
(*
my_wÜld
);

114 
©oms
=
	`»ad
(
fes
[
my_cÚf
].
	`c_¡r
());

115 if(
dof_funcs
[
my_cÚf
]è
©oms
->
	`DO
(dof_funcs[my_conf]);

118 
ff
=
Ãw
 
	`FÜûF›ldEAMF™O
(
©oms
,
__A_rho_H
,
__A_phi_FeH
,
__A_phi_HH
,
__A_F_H
);

120 
boŞ
 
H_dof
[
__dim__
][__dim__];

121 
i
=0;i<
__dim__
;i++è
j
=0;j<__dim__;j++è
H_dof
[i][j]=
çl£
;

122 
H_dof
[0][0]=H_dof[1][1]=H_dof[2][2]=
Œue
;

124 
XÜig
.~
	`VecT’s
();

125 
	`Ãw
 (&
XÜig
è
VecT’s
<
ty³0
,1>(
©oms
,
Œue
,
__dim__
);

126 
X0
.~
	`VecT’s
();

127 
	`Ãw
 (&
X0
è
VecT’s
<
ty³0
,1>(
©oms
,
Œue
,
__dim__
);

129 
mš_ls
=
Ãw
 
	`LšeS—rchB»Á
();

130 
mš
=
Ãw
 
	`MšCGPÙF™
(0.0,
H_dof
,
çl£
,0.4,
mš_ls
,
XÜig
.
vecs
[0],
X0
.vecs[0]);

131 
mš
->
©oms
=atoms;

132 
mš
->
ff
=ff;

134 
	`memıy
(
XÜig
.
vecs
[0]->
	`begš
(),
©oms
->
x
->begš(),(
ty³0
)*
__dim__
*©oms->
Çtms_lş
);

135 
	`memıy
(&
XÜig
.
A
[0][0],&
©oms
->
H
[0][0],(
ty³0
)*
__dim__
*__dim__);

138 
	}
}

142 
	gPÙF™O
::~
	$PÙF™O
()

144 
X0
.~
	`VecT’s
();

145 
XÜig
.~
	`VecT’s
();

146 
d–‘e
 
ff
;

147 
d–‘e
 
mš_ls
;

148 
d–‘e
 
mš
;

149 
d–‘e
 
©oms
;

150 
MemÜy
::
	`d—Îoc
(
roÙs
);

151 
MemÜy
::
	`d—Îoc
(
”rs
);

152 *
Çmes
=
NULL
;

153 
MemÜy
::
	`d—Îoc
(
Çmes
);

154 
MemÜy
::
	`d—Îoc
(
Çmes_¡r
);

155 
MemÜy
::
	`d—Îoc
(
m—n_rhoHs
);

156 
MemÜy
::
	`d—Îoc
(
nHs
);

157 
	}
}

161 
	gPÙF™O
::
	$ÿlc_nHs
()

163 
nH_lş
=0,
nH
;

164 
–em_ty³
* 
–em
=
©oms
->–em->
	`begš
();

165 cÚ¡ 
Çtms_lş
=
©oms
->natms_lcl;

166 
i
=0;i<
Çtms_lş
;i++èif(
–em
[i]==1è
nH_lş
++;

167 
	`MPI_AÎ»duû
(&
nH_lş
,&
nH
,1,
Vec
<>::
MPI_T
,
MPI_SUM
,*
my_wÜld
);

168 
nHs
[
my_cÚf
]=
nH
;

169 
i
=0;i<
ncÚfigs
;i++)

170 
	`MPI_Bÿ¡
(&
nHs
[
i
],1,
Vec
<>::
MPI_T
,
roÙs
[i],
wÜld
);

171 
	}
}

175 
	gPÙF™O
::
	$ÿlc_m—n_rho_Hs
()

177 
i
=0;i<
ncÚfigs
;i++)

178 
	`MPI_Bÿ¡
(&
m—n_rhoHs
[
i
],1,
Vec
<
ty³0
>::
MPI_T
,
roÙs
[i],
wÜld
);

179 
	}
}

183 
	gPÙF™O
::
	$g’_‹¡
(
comp
,
ty³0
 
d–
,
n
)

185 
ty³0
 
dx
[
nHv¬s
];

186 
Algeb¿
::
z”o
<
nHv¬s
>(
dx
);

187 
dx
[
comp
]=1.0;

189 
mš
->
	`š™
();

190 
mš
->
	`run
(0);

191 
ff
->
	`g¿d›Á
();

192 
ty³0
 
³0
=
©oms
->
³
;

193 
ty³0
 
d”iv
=0.0;

194 
Algeb¿
::
Do
<
nHv¬s
>::
	`func
([
this
,&
d”iv
,&
dx
](
i
){d”iv+=
ff
->
dv
[i]*dx[i];});

196 
i
=0;i<
n
;i++)

198 
mš
->
	`run
(0);

199 
	`´štf
("%.16lf\t%.16lf\t%.16lf\n",
i
*
d–
,
d”iv
*d–*i,
©oms
->
³
-
³0
);

200 
Algeb¿
::
Do
<
nHv¬s
>::
	`func
([
this
,&
d–
,&
dx
](
i
){
ff
->
v
[i]+=dx[i]*delta;});

203 
mš
->
	`fš
();

204 
	}
}

208 
	gPÙF™O
::
	$¡Üe_x0
()

210 
Algeb¿
::
V_eq
<
nHv¬s
>(
ff
->
v
,
x0
);

211 
	`memıy
(
X0
.
vecs
[0]->
	`begš
(),
©oms
->
x
->begš(),(
ty³0
)*
__dim__
*©oms->
Çtms_lş
);

212 
	`memıy
(&
X0
.
A
[0][0],&
©oms
->
H
[0][0],(
ty³0
)*
__dim__
*__dim__);

213 
	}
}

217 
	gPÙF™O
::
	$»¡Üe_x0
()

219 
Algeb¿
::
V_eq
<
nHv¬s
>(
x0
,
ff
->
v
);

220 
	`memıy
(
©oms
->
x
->
	`begš
(),
X0
.
vecs
[0]->begš(),(
ty³0
)*
__dim__
*©oms->
Çtms_lş
);

221 
	`memıy
(&
©oms
->
H
[0][0],&
X0
.
A
[0][0],(
ty³0
)*
__dim__
*__dim__);

222 
©oms
->
	`upd©e_H
();

223 
	}
}

227 
	gPÙF™O
::
	$fuÎ_»£t
()

229 
	`memıy
(
©oms
->
x
->
	`begš
(),
XÜig
.
vecs
[0]->begš(),(
ty³0
)*
__dim__
*©oms->
Çtms_lş
);

230 
	`memıy
(&
©oms
->
H
[0][0],&
XÜig
.
A
[0][0],(
ty³0
)*
__dim__
*__dim__);

231 
©oms
->
	`upd©e_H
();

232 
	}
}

236 
Th”moDyÇmics
 
	gPÙF™O
::
	$g‘_th”mo
()

238 if(
ncÚfigs
==2)

239  
	`Th”moDyÇmics
(6,"ERR",
tÙ_”r
,
Çmes
[0],
”rs
[0],names[1],errs[1]);

240 if(
ncÚfigs
==3)

241  
	`Th”moDyÇmics
(6,"ERR",
tÙ_”r
,
Çmes
[0],
”rs
[0],names[1],errs[1],names[2],errs[2]);

242 if(
ncÚfigs
==4)

243  
	`Th”moDyÇmics
(6,"ERR",
tÙ_”r
,
Çmes
[0],
”rs
[0],names[1],errs[1],names[2],errs[2],names[3],errs[3]);

244 if(
ncÚfigs
==5)

245  
	`Th”moDyÇmics
(6,"ERR",
tÙ_”r
,
Çmes
[0],
”rs
[0],names[1],errs[1],names[2],errs[2],names[3],errs[3],names[4],errs[4]);

246 if(
ncÚfigs
==6)

247  
	`Th”moDyÇmics
(6,"ERR",
tÙ_”r
,
Çmes
[0],
”rs
[0],names[1],errs[1],names[2],errs[2],names[3],errs[3],names[4],errs[4],names[5],errs[5]);

248 if(
ncÚfigs
==7)

249  
	`Th”moDyÇmics
(6,"ERR",
tÙ_”r
,
Çmes
[0],
”rs
[0],names[1],errs[1],names[2],errs[2],names[3],errs[3],names[4],errs[4],names[5],errs[5],names[6],errs[6]);

250 if(
ncÚfigs
==8)

251  
	`Th”moDyÇmics
(6,"ERR",
tÙ_”r
,
Çmes
[0],
”rs
[0],names[1],errs[1],names[2],errs[2],names[3],errs[3],names[4],errs[4],names[5],errs[5],names[6],errs[6],names[7],errs[7]);

252 if(
ncÚfigs
==9)

253  
	`Th”moDyÇmics
(6,"ERR",
tÙ_”r
,
Çmes
[0],
”rs
[0],names[1],errs[1],names[2],errs[2],names[3],errs[3],names[4],errs[4],names[5],errs[5],names[6],errs[6],names[7],errs[7],names[8],errs[8]);

254 if(
ncÚfigs
==10)

255  
	`Th”moDyÇmics
(6,"ERR",
tÙ_”r
,
Çmes
[0],
”rs
[0],names[1],errs[1],names[2],errs[2],names[3],errs[3],names[4],errs[4],names[5],errs[5],names[6],errs[6],names[7],errs[7],names[8],errs[8],names[9],errs[9]);

256  
	`Th”moDyÇmics
(6,"ERR",
tÙ_”r
,
Çmes
[0],
”rs
[0]);

258 
	}
}

262 
	gPÙF™O
::
	$mš_cg
(
n¡•s
)

264 
ty³0
 
cu¼_”r
,
´ev_”r
,
f0_f0
,
f_f0
,
f_f
,
f_h
,
¿tio
,
®pha
,
tŞ
=1.0e-12;

266 
cu¼_”r
=
	`™”
();

267 
Algeb¿
::
V_eq
<
nHv¬s
>(
f
,
h
);

268 
f0_f0
=
Algeb¿
::
V_mul_V
<
nHv¬s
>(
f
,f);

270 
Th”moDyÇmics
 
th”mo
=
	`g‘_th”mo
();

272 
i¡•
=0;

273 
th”mo
.
	`š™
();

274 
th”mo
.
	`´št
(0);

275 
”r
=
n¡•s
==0? 
MIN_F_MAX_ITER
:
LS_S
;

276 ;
”r
==
LS_S
;
i¡•
++)

278 if(
f0_f0
==0.0)

280 
”r
=
LS_F_GRAD0
;

284 
	`¡Üe_x0
();

286 
Algeb¿
::
V_eq
<
nHv¬s
>(
f
,
f0
);

287 
´ev_”r
=
cu¼_”r
;

288 
f_h
=
Algeb¿
::
V_mul_V
<
nHv¬s
>(
f
,
h
);

289 if(
f_h
<0.0)

291 
Algeb¿
::
V_eq
<
nHv¬s
>(
f
,
h
);

292 
f_h
=
f0_f0
;

298 
”r
=
mš_ls
->
	`mš
(
this
,
cu¼_”r
,
®pha
,1);

300 if(
”r
!=
LS_S
)

304 
i¡•
--;

307 
cu¼_”r
=
	`™”
();

308 
th”mo
.
	`´št
(
i¡•
+1);

310 if(
´ev_”r
-
cu¼_”r
<
tŞ
 || cu¼_”r<
”r_tŞ
è
”r
=
MIN_S_TOLERANCE
;

311 if(
i¡•
+1==
n¡•s
è
”r
=
MIN_F_MAX_ITER
;

312 if(
”r
) ;

314 
f_f
=
Algeb¿
::
V_mul_V
<
nHv¬s
>(
f
,f);

315 
f_f0
=
Algeb¿
::
V_mul_V
<
nHv¬s
>(
f
,
f0
);

316 
¿tio
=(
f_f
-
f_f0
)/(
f0_f0
);

318 
j
=0;j<
nHv¬s
;j++è
h
[j]=
¿tio
*h[j]+
f
[j];

320 
f0_f0
=
f_f
;

323 
th”mo
.
	`fš
();

324 
	`årštf
(
MAPP
::
m­p_out
,"%s",
”r_msgs
[
”r
]);

325 
	}
}

329 
ty³0
 
	gPÙF™O
::
	$™”
()

331 if(
ÁrŸl
%
max_ÁrŸls
==0è
	`fuÎ_»£t
();

332 
ÁrŸl
++;

333 
mš
->
	`š™
();

334 
mš
->
	`run
(
nmš_¡•s
);

335 
m—n_rhoHs
[
my_cÚf
]=
ff
->
	`m—n_rho_H
();

336 
ff
->
	`g¿d›Á
();

337 
mš
->
	`fš
();

338 
ty³0
 
”r_lş
=0.0,
”r
;

339 
Algeb¿
::
z”o
<
nHv¬s
>(
f_lş
);

340 if(
my_lş_¿nk
==0)

342 
”r_lş
=
cÛf
*
Algeb¿
::
pow
<2>(
©oms
->
³
-
rg‘
);

343 
Algeb¿
::
V_eq_x_mul_V
<
nHv¬s
>(-2.0*
cÛf
*(
©oms
->
³
-
rg‘
),
ff
->
dv
,
f_lş
);

344 
”rs
[
my_cÚf
]=
©oms
->
³
-
rg‘
;

346 
	`MPI_AÎ»duû
(
f_lş
,
f
,
nHv¬s
,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

347 
	`MPI_AÎ»duû
(&
”r_lş
,&
”r
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

348 
i
=0;i<
ncÚfigs
;i++)

349 
	`MPI_Bÿ¡
(&
”rs
[
i
],1,
Vec
<
ty³0
>::
MPI_T
,
roÙs
[i],
wÜld
);

350 
tÙ_”r
=
”r
;

352 
Algeb¿
::
Do
<
nHv¬s
>::
	`func
([
this
](
i
){if(!
ff
->
dof
[i]è
f
[i]=0.0;});

354  
”r
;

355 
	}
}

364 
	gPÙF™O
::
	$ls_´•
(
ty³0
& 
dç
,ty³0& 
h_nÜm
,ty³0& 
max_a
)

367 
h_nÜm
=
Algeb¿
::
V_mul_V
<
nHv¬s
>(
h
,h);

369 
dç
=-
Algeb¿
::
V_mul_V
<
nHv¬s
>(
f
,
h
);

371 if(
h_nÜm
==0.0)

373 
max_a
=0.0;

374 
dç
=0.0;

378 if(
dç
>=0.0)

380 
max_a
=0.0;

381 
dç
=1.0;

385 
h_nÜm
=
	`sq¹
(h_norm);

389 
max_a
=
¡d
::
num”ic_lim™s
<
ty³0
>::
	`šfš™y
();

390 
max_a
=
	`MIN
(max_a,
	`fšd_max_®pha_A_rho_H
());

391 
max_a
=
	`MIN
(max_a,
	`fšd_max_®pha_A_phi_FeH
());

392 
max_a
=
	`MIN
(max_a,
	`fšd_max_®pha_A_phi_HH
());

396 
max_a
=
	`MIN
(max_a,
	`fšd_max_®pha_A_F_H
());

397 
	}
}

401 
ty³0
 
	gPÙF™O
::
	$F
(
ty³0
 
®pha
)

403 
Algeb¿
::
V_eq
<
nHv¬s
>(
x0
,
ff
->
v
);

404 
Algeb¿
::
V_add_x_mul_V
<
nHv¬s
>(
®pha
,
h
,
ff
->
v
);

405 
boŞ
 
·¿m_”r
=
çl£
;

406 
i
=0;i<
nHv¬s
;i++)

407 if(
¡d
::
	`i¢ª
(
ff
->
v
[
i
]è|| std::
	`isšf
(ff->v[i]))

408 
·¿m_”r
=
Œue
;

420 if(
ÁrŸl
%
max_ÁrŸls
==0è
	`fuÎ_»£t
();

421 
ÁrŸl
++;

422 
mš
->
	`š™
();

423 
mš
->
	`run
(
nmš_¡•s
);

424 
m—n_rhoHs
[
my_cÚf
]=
ff
->
	`m—n_rho_H
();

425 
mš
->
	`fš
();

426 
ty³0
 
”r_lş
=0.0,
”r
;

427 if(
my_lş_¿nk
==0è
”r_lş
=
cÛf
*
Algeb¿
::
pow
<2>(
©oms
->
³
-
rg‘
);

428 
	`MPI_AÎ»duû
(&
”r_lş
,&
”r
,1,
Vec
<
ty³0
>::
MPI_T
,
MPI_SUM
,
wÜld
);

429 
tÙ_”r
=
”r
;

430  
”r
;

431 
	}
}

435 
	gPÙF™O
::
	$F_»£t
()

437 
	`»¡Üe_x0
();

438 if(
ÁrŸl
%
max_ÁrŸls
==0è
	`fuÎ_»£t
();

439 
ÁrŸl
++;

440 
mš
->
	`š™
();

441 
mš
->
	`run
(
nmš_¡•s
);

442 
m—n_rhoHs
[
my_cÚf
]=
ff
->
	`m—n_rho_H
();

443 
mš
->
	`fš
();

444 
	}
}

448 
ty³0
 
	gPÙF™O
::
	$fšd_max_®pha_A_rho_H
()

450 
ty³0
 
__max_a
=
¡d
::
num”ic_lim™s
<ty³0>::
	`šfš™y
();

451 
ty³0
* 
__x0
=
x0
+
rho_H_off£t
;

452 
boŞ
* 
__dof
=
ff
->
dof
+
rho_H_off£t
;

453 
ty³0
* 
__h
=
h
+
rho_H_off£t
;

454 
ty³0
* 
__dx_max
=
dx_max
+
rho_H_off£t
;

456 
__max_a
=
	`MIN
(__max_a,
	`fšd_max_®pha
(0.0, 
¡d
::
num”ic_lim™s
<
ty³0
>::
	`qu›t_NaN
(),
__dof
[0],
__dx_max
[0],
__x0
[0],
__h
[0]));

457 
__max_a
=
	`MIN
(__max_a,
	`fšd_max_®pha
(0.0, 
¡d
::
num”ic_lim™s
<
ty³0
>::
	`qu›t_NaN
(),
__dof
[1],
__dx_max
[1],
__x0
[1],
__h
[1]));

459  
__max_a
;

460 
	}
}

464 
ty³0
 
	gPÙF™O
::
	$fšd_max_®pha_A_phi_FeH
()

466 
ty³0
 
__max_a
=
¡d
::
num”ic_lim™s
<ty³0>::
	`šfš™y
();

467 
ty³0
* 
__x0
=
x0
+
phi_FeH_off£t
;

469 
ty³0
* 
__h
=
h
+
phi_FeH_off£t
;

470 
ty³0
* 
__dx_max
=
dx_max
+
phi_FeH_off£t
;

471 #ifdeà
FeH_SPLINE


472 
ty³0
 
___h
,
___x0
,
t
;

473 
i
=0;i<
Åhi_FeH
-1;i++)

475 
___h
=
___x0
=0.0;

476 
j
=
i
+1;j<
Åhi_FeH
;j++)

478 
t
=
Algeb¿
::
pow
<3>(
ff
->
R_phi_FeH
[
j
]-ff->R_phi_FeH[
i
]);

479 
___h
+=
__h
[
j
]*
t
;

480 
___x0
+=
__x0
[
j
]*
t
;

481 
__max_a
=
	`MIN
(__max_a,
	`fšd_max_®pha
(
¡d
::
num”ic_lim™s
<
ty³0
>::
	`qu›t_NaN
(), std::num”ic_lim™s<ty³0>::qu›t_NaN(),
Œue
,
__dx_max
[
i
],
___x0
,
___h
));

484  
__max_a
;

486 
boŞ
* 
__dof
=
ff
->
dof
+
phi_FeH_off£t
;

487 
__max_a
=
	`MIN
(__max_a,
	`fšd_max_®pha
(0.0, 
¡d
::
num”ic_lim™s
<
ty³0
>::
	`qu›t_NaN
(),
__dof
[0],
__dx_max
[0],
__x0
[0],
__h
[0]));

488 
__max_a
=
	`MIN
(__max_a,
	`fšd_max_®pha
(0.0, 
¡d
::
num”ic_lim™s
<
ty³0
>::
	`qu›t_NaN
(),
__dof
[1],
__dx_max
[1],
__x0
[1],
__h
[1]));

489 
__max_a
=
	`MIN
(__max_a,
	`fšd_max_®pha
(0.0, 
¡d
::
num”ic_lim™s
<
ty³0
>::
	`qu›t_NaN
(),
__dof
[2],
__dx_max
[2],
__x0
[2],
__h
[2]));

490 
__max_a
=
	`MIN
(__max_a,
	`fšd_max_®pha
(
¡d
::
num”ic_lim™s
<
ty³0
>::
	`qu›t_NaN
(), std::num”ic_lim™s<ty³0>::qu›t_NaN(),
__dof
[3],
__dx_max
[3],
__x0
[3],
__h
[3]));

492  
__max_a
;

494 
	}
}

498 
ty³0
 
	gPÙF™O
::
	$fšd_max_®pha_A_phi_HH
()

500 
ty³0
 
__max_a
=
¡d
::
num”ic_lim™s
<ty³0>::
	`šfš™y
();

501 
ty³0
* 
__x0
=
x0
+
phi_HH_off£t
;

502 
boŞ
* 
__dof
=
ff
->
dof
+
phi_HH_off£t
;

503 
ty³0
* 
__h
=
h
+
phi_HH_off£t
;

504 
ty³0
* 
__dx_max
=
dx_max
+
phi_HH_off£t
;

506 
__max_a
=
	`MIN
(__max_a,
	`fšd_max_®pha
(
¡d
::
num”ic_lim™s
<
ty³0
>::
	`qu›t_NaN
(), std::num”ic_lim™s<ty³0>::qu›t_NaN(),
__dof
[0],
__dx_max
[0],
__x0
[0],
__h
[0]));

507 
__max_a
=
	`MIN
(__max_a,
	`fšd_max_®pha
(
¡d
::
num”ic_lim™s
<
ty³0
>::
	`qu›t_NaN
(), std::num”ic_lim™s<ty³0>::qu›t_NaN(),
__dof
[1],
__dx_max
[1],
__x0
[1],
__h
[1]));

508 
__max_a
=
	`MIN
(__max_a,
	`fšd_max_®pha
(0.0, 
¡d
::
num”ic_lim™s
<
ty³0
>::
	`qu›t_NaN
(),
__dof
[2],
__dx_max
[2],
__x0
[2],
__h
[2]));

509 
__max_a
=
	`MIN
(__max_a,
	`fšd_max_®pha
(0.9,1.5,
__dof
[3],
__dx_max
[3],
__x0
[3],
__h
[3]));

511  
__max_a
;

512 
	}
}

516 
ty³0
 
	gPÙF™O
::
	$fšd_max_®pha_A_F_H
()

518 
ty³0
 
__max_a
=
¡d
::
num”ic_lim™s
<ty³0>::
	`šfš™y
();

519 
ty³0
* 
__x0
=
x0
+
F_H_off£t
;

520 
boŞ
* 
__dof
=
ff
->
dof
+
F_H_off£t
;

521 
ty³0
* 
__h
=
h
+
F_H_off£t
;

522 
ty³0
* 
__dx_max
=
dx_max
+
F_H_off£t
;

523 
__max_a
=
	`MIN
(__max_a,
	`fšd_max_®pha
(0.0, 
¡d
::
num”ic_lim™s
<
ty³0
>::
	`qu›t_NaN
(),
__dof
[0],
__dx_max
[0],
__x0
[0],
__h
[0]));

524 
__max_a
=
	`MIN
(__max_a,
	`fšd_max_®pha
(
¡d
::
num”ic_lim™s
<
ty³0
>::
	`qu›t_NaN
(), std::num”ic_lim™s<ty³0>::qu›t_NaN(),
__dof
[1],
__dx_max
[1],
__x0
[1],
__h
[1]));

525 
__max_a
=
	`MIN
(__max_a,
	`fšd_max_®pha
(0.0, 
¡d
::
num”ic_lim™s
<
ty³0
>::
	`qu›t_NaN
(),
__dof
[2],
__dx_max
[2],
__x0
[2],
__h
[2]));

526 
__max_a
=
	`MIN
(__max_a,
	`fšd_max_®pha
(0.0, 
¡d
::
num”ic_lim™s
<
ty³0
>::
	`qu›t_NaN
(),
__dof
[3],
__dx_max
[3],
__x0
[3],
__h
[3]));

527 
__max_a
=
	`MIN
(__max_a,
	`fšd_max_®pha
(0.0, 
¡d
::
num”ic_lim™s
<
ty³0
>::
	`qu›t_NaN
(),
__dof
[4],
__dx_max
[4],
__x0
[4],
__h
[4]));

529  
__max_a
;

530 
	}
}

534 
ty³0
 
	gPÙF™O
::
	$fšd_max_®pha
(cÚ¡ 
ty³0
 
xlo
,cÚ¡y³0 
xhi
,
boŞ
 
dof
,ty³0 
max_dx
,ty³0 
x
,ty³0 
h
)

537 if(
dof
==
çl£
 || 
h
==0.0è 
¡d
::
num”ic_lim™s
<
ty³0
>::
	`šfš™y
();

538 
ty³0
 
max_®pha
=
	`çbs
(
max_dx
/
h
);

540 if(
h
>0.0 && 
¡d
::
	`i¢ª
(
xhi
)==
çl£
)

542 
max_®pha
=
	`MIN
(max_®pha,(
xhi
-
x
)/
h
);

543 
x
+
max_®pha
*
h
>
xhi
)

544 
max_®pha
=
	`Ãxá”
(max_alpha,0.0);

546 if(
h
<0.0 && 
¡d
::
	`i¢ª
(
xlo
)==
çl£
)

548 
max_®pha
=
	`MIN
(max_®pha,(
xlo
-
x
)/
h
);

549 
x
+
max_®pha
*
h
<
xlo
)

550 
max_®pha
=
	`Ãxá”
(max_alpha,0.0);

554  
max_®pha
;

555 
	}
}

559 
size_t
 
	gPÙF™O
::
	$g‘_rFeH
(
ty³0
*& 
Rs
,ty³0*& 
Fs
,*& 
Ns
)

561 if(
ÁrŸl
%
max_ÁrŸls
==0è
	`fuÎ_»£t
();

562 
ÁrŸl
++;

563 
mš
->
	`š™
();

564 
mš
->
	`run
(
nmš_¡•s
);

565 
size_t
 
sz
=
ff
->
	`g‘_rFeH
(
Rs
,
Fs
,
Ns
);

566 
mš
->
	`fš
();

568  
sz
;

569 
	}
}

573 
ty³0
* 
	gPÙF™O
::
	$g‘_cÛfs
()

575 
ty³0
* 
cÛfs
=
NULL
;

577 
MemÜy
::
	`®loc
(
cÛfs
,
ncÚfigs
);

578 
cÛfs
[
my_cÚf
]=
cÛf
;

579 
i
=0;i<
ncÚfigs
;i++)

580 
	`MPI_Bÿ¡
(&
cÛfs
[
i
],1,
Vec
<
ty³0
>::
MPI_T
,
roÙs
[i],
wÜld
);

582  
cÛfs
;

583 
	}
}

587 
	gPÙF™O
::
	$£t_cÛfs
(
ty³0
* 
cÛfs
)

589 
cÛf
=
cÛfs
[
my_cÚf
];

590 
	}
}

594 
PyObjeù
* 
	gPÙF™O
::
	$__Ãw__
(
PyTy³Objeù
* 
ty³
,
PyObjeù
* 
¬gs
,PyObjeù* 
kwds
)

596 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
ty³
->
	`_®loc
(type,0));

597 
PyObjeù
* 
£lf
=
»š‹½»t_ÿ¡
<PyObjeù*>(
__£lf
);

598  
£lf
;

599 
	}
}

603 
	gPÙF™O
::
	$__š™__
(
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)

607 
FuncAPI
<
ty³0
[
Äho_H
],ty³0[
Åhi_FeH
],ty³0[
Åhi_HH
],ty³0[
nF_H
],

608 
OB
<
PyLi¡Objeù
,
PyLi¡_Ty³
>>

609 
	`f
("__init__",{

616 if(
	`f
(
¬gs
,
kwds
))  -1;

618 
PyObjeù
* 
cÚfigs
=
f
.
v®
<4>();

619 
size_t
 
ncÚfigs
=
	`PyLi¡_Size
(
cÚfigs
);

620 
¡d
::
¡ršg
* 
Çmes
;

621 
MemÜy
::
	`®loc
(
Çmes
,
ncÚfigs
);

622 
¡d
::
¡ršg
* 
fes
;

623 
MemÜy
::
	`®loc
(
fes
,
ncÚfigs
);

624 * 
Årocs
;

625 
MemÜy
::
	`®loc
(
Årocs
,
ncÚfigs
);

626 
	`ty³0
(* 
rg‘s
)[1+
__nvoigt__
];

627 
MemÜy
::
	`®loc
(
rg‘s
,
ncÚfigs
);

628 
	`ty³0
(* 
cÛfs
)[1+
__nvoigt__
];

629 
MemÜy
::
	`®loc
(
cÛfs
,
ncÚfigs
);

630 
PyObjeù
** 
funcs
;

631 
MemÜy
::
	`®loc
(
funcs
,
ncÚfigs
);

634 
tÙ_Åroc
=0;

635 
size_t
 
i
=0;i<
ncÚfigs
;i++)

637 
PyObjeù
* 
cÚfig
=
	`PyLi¡_G‘I‹m
(
cÚfigs
,
i
);

638 
FuncAPI
<
¡d
::
¡ršg
,std::string,

640 
ty³0
,
symm
<ty³0[
__dim__
][__dim__]>,

641 
ty³0
,
symm
<ty³0[
__dim__
][__dim__]>,

642 
OB
<
PyFunùiÚObjeù
,
PyFunùiÚ_Ty³
>>

643 
	`cÚf
("configurationuple",{"name","cfg_file","nproc","pe_target","S_target","pe_coef","S_coef","dof_func"});

645 
cÚf
.
v®
<7>()=
NULL
;

646 
cÚf
.
nİtiÚ®s
=1;

647 if(
	`cÚf
(
cÚfig
,
NULL
))

649 
MemÜy
::
	`d—Îoc
(
Çmes
);

650 
MemÜy
::
	`d—Îoc
(
fes
);

651 
MemÜy
::
	`d—Îoc
(
rg‘s
);

652 
MemÜy
::
	`d—Îoc
(
cÛfs
);

653 *
funcs
=
NULL
;

654 
MemÜy
::
	`d—Îoc
(
funcs
);

657 
Çmes
[
i
]=
cÚf
.
v®
<0>();

658 
fes
[
i
]=
cÚf
.
v®
<1>();

659 
Årocs
[
i
]=
cÚf
.
v®
<2>();

660 
rg‘s
[
i
][0]=
cÚf
.
v®
<3>();

661 
Algeb¿
::
	`MSY_2_DyadicV
(
cÚf
.
v®
<4>(),&
rg‘s
[
i
][1]);

662 
cÛfs
[
i
][0]=
cÚf
.
v®
<5>();

663 
Algeb¿
::
	`MSY_2_DyadicV
(
cÚf
.
v®
<6>(),&
cÛfs
[
i
][1]);

664 
funcs
[
i
]=
cÚf
.
v®
<7>();

665 
tÙ_Åroc
+=
Årocs
[
i
];

668 
MPI_Comm
 
wÜld
=
MPI_COMM_WORLD
;

669 
comm_size
;

670 
	`MPI_Comm_size
(
wÜld
,&
comm_size
);

671 if(
tÙ_Åroc
!=
comm_size
)

673 
	`PyE¼_FÜm©
(
PyExc_Ty³E¼Ü
,"numb” oà´oûssÜ dØnÙ m©ch: %d v %d",
comm_size
,
tÙ_Åroc
);

674 
MemÜy
::
	`d—Îoc
(
Çmes
);

675 
MemÜy
::
	`d—Îoc
(
fes
);

676 
MemÜy
::
	`d—Îoc
(
rg‘s
);

677 
MemÜy
::
	`d—Îoc
(
cÛfs
);

678 *
funcs
=
NULL
;

679 
MemÜy
::
	`d—Îoc
(
funcs
);

686 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

687 
__£lf
->
pÙf™
=
Ãw
 
	`PÙF™O
(
f
.
v®
<0>(),f.val<1>(),f.val<2>(),f.val<3>(),

688 
¡d
::
	`move
(
Çmes
),
fes
,
Årocs
,
rg‘s
,
cÛfs
,
funcs
,
ncÚfigs
,
wÜld
);

689 
MemÜy
::
	`d—Îoc
(
Çmes
);

690 
MemÜy
::
	`d—Îoc
(
fes
);

691 
MemÜy
::
	`d—Îoc
(
rg‘s
);

692 
MemÜy
::
	`d—Îoc
(
cÛfs
);

693 *
funcs
=
NULL
;

694 
MemÜy
::
	`d—Îoc
(
funcs
);

697 
	}
}

701 
PyObjeù
* 
	gPÙF™O
::
	$__®loc__
(
PyTy³Objeù
* 
ty³
,
Py_ssize_t
)

703 
Objeù
* 
__£lf
=
Ãw
 Object;

704 
	`Py_TYPE
(
__£lf
)=
ty³
;

705 
	`Py_REFCNT
(
__£lf
)=1;

706 
__£lf
->
pÙf™
=
NULL
;

707  
»š‹½»t_ÿ¡
<
PyObjeù
*>(
__£lf
);

708 
	}
}

712 
	gPÙF™O
::
	$__d—Îoc__
(
PyObjeù
* 
£lf
)

714 
Objeù
* 
__£lf
=
»š‹½»t_ÿ¡
<Objeù*>(
£lf
);

715 
d–‘e
 
__£lf
->
pÙf™
;

716 
__£lf
->
pÙf™
=
NULL
;

717 
d–‘e
 
__£lf
;

718 
	}
}

720 
PyTy³Objeù
 
	gPÙF™O
::
Ty³Objeù
={
PyObjeù_HEAD_INIT
(
NULL
)};

722 
	gPÙF™O
::
	$£tup_
()

724 
Ty³Objeù
.
_Çme
="mapp.potfit_o";

725 
Ty³Objeù
.
_doc
="";

727 
Ty³Objeù
.
_æags
=
Py_TPFLAGS_DEFAULT
;

728 
Ty³Objeù
.
_basicsize
=(
Objeù
);

730 
Ty³Objeù
.
_Ãw
=
__Ãw__
;

731 
Ty³Objeù
.
_š™
=
__š™__
;

732 
Ty³Objeù
.
_®loc
=
__®loc__
;

733 
Ty³Objeù
.
_d—Îoc
=
__d—Îoc__
;

734 
	`£tup__m‘hods
();

735 
Ty³Objeù
.
_m‘hods
=
m‘hods
;

736 
	`£tup__g‘£t
();

737 
Ty³Objeù
.
_g‘£t
=
g‘£t
;

739 
ichk
=
	`PyTy³_R—dy
(&
Ty³Objeù
);

740 if(
ichk
<0)  ichk;

741 
	`Py_INCREF
(&
Ty³Objeù
);

747 
	`GET_WRAPPER_DOC
(
Ty³Objeù
,
__š™__
)=
NULL
;

748  
ichk
;

749 
	}
}

751 
PyG‘S‘Def
 
	gPÙF™O
::
g‘£t
[]=
Em±yPyG‘S‘Def
(20);

753 
	gPÙF™O
::
	$£tup__g‘£t
()

755 
	`g‘£t_A_rho_H
(
g‘£t
[0]);

756 
	`g‘£t_A_phi_FeH
(
g‘£t
[1]);

757 
	`g‘£t_A_phi_HH
(
g‘£t
[2]);

758 
	`g‘£t_A_F_H
(
g‘£t
[3]);

760 
	`g‘£t_dA_rho_H_max
(
g‘£t
[4]);

761 
	`g‘£t_dA_phi_FeH_max
(
g‘£t
[5]);

762 
	`g‘£t_dA_phi_HH_max
(
g‘£t
[6]);

763 
	`g‘£t_dA_F_H_max
(
g‘£t
[7]);

765 
	`g‘£t_A_rho_H_dof
(
g‘£t
[8]);

766 
	`g‘£t_A_phi_FeH_dof
(
g‘£t
[9]);

767 
	`g‘£t_A_phi_HH_dof
(
g‘£t
[10]);

768 
	`g‘£t_A_F_H_dof
(
g‘£t
[11]);

770 
	`g‘£t_m—n_rho_H
(
g‘£t
[12]);

771 
	`g‘£t_max_ÁrŸls
(
g‘£t
[13]);

772 
	`g‘£t_nmš_¡•s
(
g‘£t
[14]);

773 
	`g‘£t_tŞ
(
g‘£t
[15]);

774 
	`g‘£t_cÛfs
(
g‘£t
[16]);

775 
	`g‘£t_”rs
(
g‘£t
[17]);

777 
	`g‘£t_RFeH
(
g‘£t
[18]);

778 
	}
}

780 
PyM‘hodDef
 
	gPÙF™O
::
m‘hods
[]=
Em±yPyM‘hodDef
(6);

782 
	gPÙF™O
::
	$£tup__m‘hods
()

784 
	`ml_‹¡_A_rho_H
(
m‘hods
[0]);

785 
	`ml_‹¡_A_phi_FeH
(
m‘hods
[1]);

786 
	`ml_‹¡_A_phi_HH
(
m‘hods
[2]);

787 
	`ml_‹¡_A_F_H
(
m‘hods
[3]);

788 
	`ml_mš
(
m‘hods
[4]);

790 
	}
}

794 
	gPÙF™O
::
	$g‘£t_A_rho_H
(
PyG‘S‘Def
& 
g‘£t
)

796 
g‘£t
.
Çme
=(*)"A_rho_H";

797 
g‘£t
.
doc
=(*)"";

799 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

801 
PÙF™O
* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

802 
size_t
 
sz
;

803 
size_t
* 
szp
=&
sz
;

804 
sz
=
Äho_H
;

805 
ty³0
* 
v
=
pÙf™
->
ff
->v+
rho_H_off£t
;

806  
v¬
<
ty³0
*>::
	`bud
(
v
,&
szp
);

808 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

810 
PÙF™O
* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

811 
V¬API
<
ty³0
[
Äho_H
]> 
	`v¬
("A_rho_H");

812 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

813 
	`memıy
(
pÙf™
->
ff
->
v
+
rho_H_off£t
,
v¬
.
v®
,
Äho_H
*(
ty³0
));

816 
	}
}

820 
	gPÙF™O
::
	$g‘£t_A_phi_FeH
(
PyG‘S‘Def
& 
g‘£t
)

822 
g‘£t
.
Çme
=(*)"A_phi_FeH";

823 
g‘£t
.
doc
=(*)"";

825 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

827 
PÙF™O
* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

828 
size_t
 
sz
;

829 
size_t
* 
szp
=&
sz
;

830 
sz
=
Åhi_FeH
;

831 
ty³0
* 
v
=
pÙf™
->
ff
->v+
phi_FeH_off£t
;

832  
v¬
<
ty³0
*>::
	`bud
(
v
,&
szp
);

834 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

836 
PÙF™O
* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

837 
V¬API
<
ty³0
[
Åhi_FeH
]> 
	`v¬
("A_phi_FeH");

838 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

839 
	`memıy
(
pÙf™
->
ff
->
v
+
phi_FeH_off£t
,
v¬
.
v®
,
Åhi_FeH
*(
ty³0
));

842 
	}
}

846 
	gPÙF™O
::
	$g‘£t_A_phi_HH
(
PyG‘S‘Def
& 
g‘£t
)

848 
g‘£t
.
Çme
=(*)"A_phi_HH";

849 
g‘£t
.
doc
=(*)"";

851 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

853 
PÙF™O
* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

854 
size_t
 
sz
;

855 
size_t
* 
szp
=&
sz
;

856 
sz
=
Åhi_HH
;

857 
ty³0
* 
v
=
pÙf™
->
ff
->v+
phi_HH_off£t
;

858  
v¬
<
ty³0
*>::
	`bud
(
v
,&
szp
);

860 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

862 
PÙF™O
* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

863 
V¬API
<
ty³0
[
Åhi_HH
]> 
	`v¬
("A_phi_HH");

864 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

865 
	`memıy
(
pÙf™
->
ff
->
v
+
phi_HH_off£t
,
v¬
.
v®
,
Åhi_HH
*(
ty³0
));

868 
	}
}

872 
	gPÙF™O
::
	$g‘£t_A_F_H
(
PyG‘S‘Def
& 
g‘£t
)

874 
g‘£t
.
Çme
=(*)"A_F_H";

875 
g‘£t
.
doc
=(*)"";

877 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

879 
PÙF™O
* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

880 
size_t
 
sz
;

881 
size_t
* 
szp
=&
sz
;

882 
sz
=
nF_H
;

883 
ty³0
* 
v
=
pÙf™
->
ff
->v+
F_H_off£t
;

884  
v¬
<
ty³0
*>::
	`bud
(
v
,&
szp
);

886 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

888 
PÙF™O
* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

889 
V¬API
<
ty³0
[
nF_H
]> 
	`v¬
("A_F_H");

890 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

891 
	`memıy
(
pÙf™
->
ff
->
v
+
F_H_off£t
,
v¬
.
v®
,
nF_H
*(
ty³0
));

894 
	}
}

898 
	gPÙF™O
::
	$g‘£t_dA_rho_H_max
(
PyG‘S‘Def
& 
g‘£t
)

900 
g‘£t
.
Çme
=(*)"dA_rho_H_max";

901 
g‘£t
.
doc
=(*)"";

903 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

905 
PÙF™O
* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

906 
size_t
 
sz
;

907 
size_t
* 
szp
=&
sz
;

908 
sz
=
Äho_H
;

909 
ty³0
* 
v
=
pÙf™
->
dx_max
+
rho_H_off£t
;

910  
v¬
<
ty³0
*>::
	`bud
(
v
,&
szp
);

912 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

914 
PÙF™O
* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

915 
V¬API
<
ty³0
[
Äho_H
]> 
	`v¬
("dA_rho_H_max");

916 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

917 
	`memıy
(
pÙf™
->
dx_max
+
rho_H_off£t
,
v¬
.
v®
,
Äho_H
*(
ty³0
));

920 
	}
}

924 
	gPÙF™O
::
	$g‘£t_dA_phi_FeH_max
(
PyG‘S‘Def
& 
g‘£t
)

926 
g‘£t
.
Çme
=(*)"dA_phi_FeH_max";

927 
g‘£t
.
doc
=(*)"";

929 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

931 
PÙF™O
* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

932 
size_t
 
sz
;

933 
size_t
* 
szp
=&
sz
;

934 
sz
=
Åhi_FeH
;

935 
ty³0
* 
v
=
pÙf™
->
dx_max
+
phi_FeH_off£t
;

936  
v¬
<
ty³0
*>::
	`bud
(
v
,&
szp
);

938 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

940 
PÙF™O
* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

941 
V¬API
<
ty³0
[
Åhi_FeH
]> 
	`v¬
("dA_phi_FeH_max");

942 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

943 
	`memıy
(
pÙf™
->
dx_max
+
phi_FeH_off£t
,
v¬
.
v®
,
Åhi_FeH
*(
ty³0
));

946 
	}
}

950 
	gPÙF™O
::
	$g‘£t_dA_phi_HH_max
(
PyG‘S‘Def
& 
g‘£t
)

952 
g‘£t
.
Çme
=(*)"dA_phi_HH_max";

953 
g‘£t
.
doc
=(*)"";

955 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

957 
PÙF™O
* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

958 
size_t
 
sz
;

959 
size_t
* 
szp
=&
sz
;

960 
sz
=
Åhi_HH
;

961 
ty³0
* 
v
=
pÙf™
->
dx_max
+
phi_HH_off£t
;

962  
v¬
<
ty³0
*>::
	`bud
(
v
,&
szp
);

964 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

966 
PÙF™O
* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

967 
V¬API
<
ty³0
[
Åhi_HH
]> 
	`v¬
("dA_phi_HH_max");

968 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

969 
	`memıy
(
pÙf™
->
dx_max
+
phi_HH_off£t
,
v¬
.
v®
,
Åhi_HH
*(
ty³0
));

972 
	}
}

976 
	gPÙF™O
::
	$g‘£t_dA_F_H_max
(
PyG‘S‘Def
& 
g‘£t
)

978 
g‘£t
.
Çme
=(*)"dA_F_H_max";

979 
g‘£t
.
doc
=(*)"";

981 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

983 
PÙF™O
* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

984 
size_t
 
sz
;

985 
size_t
* 
szp
=&
sz
;

986 
sz
=
nF_H
;

987 
ty³0
* 
v
=
pÙf™
->
dx_max
+
F_H_off£t
;

988  
v¬
<
ty³0
*>::
	`bud
(
v
,&
szp
);

990 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

992 
PÙF™O
* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

993 
V¬API
<
ty³0
[
nF_H
]> 
	`v¬
("dA_F_H_max");

994 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

995 
	`memıy
(
pÙf™
->
dx_max
+
F_H_off£t
,
v¬
.
v®
,
nF_H
*(
ty³0
));

998 
	}
}

1002 
	gPÙF™O
::
	$g‘£t_A_rho_H_dof
(
PyG‘S‘Def
& 
g‘£t
)

1004 
g‘£t
.
Çme
=(*)"A_rho_H_dof";

1005 
g‘£t
.
doc
=(*)"";

1007 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

1009 
PÙF™O
* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

1010 
size_t
 
sz
;

1011 
size_t
* 
szp
=&
sz
;

1012 
sz
=
Äho_H
;

1013 
boŞ
* 
v
=
pÙf™
->
ff
->
dof
+
rho_H_off£t
;

1014  
v¬
<
boŞ
*>::
	`bud
(
v
,&
szp
);

1016 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

1018 
PÙF™O
* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

1019 
V¬API
<
boŞ
[
Äho_H
]> 
	`v¬
("A_rho_H_dof");

1020 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

1021 
	`memıy
(
pÙf™
->
ff
->
dof
+
rho_H_off£t
,
v¬
.
v®
,
Äho_H
*(
boŞ
));

1024 
	}
}

1028 
	gPÙF™O
::
	$g‘£t_A_phi_FeH_dof
(
PyG‘S‘Def
& 
g‘£t
)

1030 
g‘£t
.
Çme
=(*)"A_phi_FeH_dof";

1031 
g‘£t
.
doc
=(*)"";

1033 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

1035 
PÙF™O
* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

1036 
size_t
 
sz
;

1037 
size_t
* 
szp
=&
sz
;

1038 
sz
=
Åhi_FeH
;

1039 
boŞ
* 
v
=
pÙf™
->
ff
->
dof
+
phi_FeH_off£t
;

1040  
v¬
<
boŞ
*>::
	`bud
(
v
,&
szp
);

1042 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

1044 
PÙF™O
* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

1045 
V¬API
<
boŞ
[
Åhi_FeH
]> 
	`v¬
("A_phi_FeH_dof");

1046 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

1047 
	`memıy
(
pÙf™
->
ff
->
dof
+
phi_FeH_off£t
,
v¬
.
v®
,
Åhi_FeH
*(
boŞ
));

1050 
	}
}

1054 
	gPÙF™O
::
	$g‘£t_A_phi_HH_dof
(
PyG‘S‘Def
& 
g‘£t
)

1056 
g‘£t
.
Çme
=(*)"A_phi_HH_dof";

1057 
g‘£t
.
doc
=(*)"";

1059 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

1061 
PÙF™O
* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

1062 
size_t
 
sz
;

1063 
size_t
* 
szp
=&
sz
;

1064 
sz
=
Åhi_HH
;

1065 
boŞ
* 
v
=
pÙf™
->
ff
->
dof
+
phi_HH_off£t
;

1066  
v¬
<
boŞ
*>::
	`bud
(
v
,&
szp
);

1068 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

1070 
PÙF™O
* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

1071 
V¬API
<
boŞ
[
Åhi_HH
]> 
	`v¬
("A_phi_HH_dof");

1072 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

1073 
	`memıy
(
pÙf™
->
ff
->
dof
+
phi_HH_off£t
,
v¬
.
v®
,
Åhi_HH
*(
boŞ
));

1076 
	}
}

1080 
	gPÙF™O
::
	$g‘£t_A_F_H_dof
(
PyG‘S‘Def
& 
g‘£t
)

1082 
g‘£t
.
Çme
=(*)"A_F_H_dof";

1083 
g‘£t
.
doc
=(*)"";

1085 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

1087 
PÙF™O
* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

1088 
size_t
 
sz
;

1089 
size_t
* 
szp
=&
sz
;

1090 
sz
=
nF_H
;

1091 
boŞ
* 
v
=
pÙf™
->
ff
->
dof
+
F_H_off£t
;

1092  
v¬
<
boŞ
*>::
	`bud
(
v
,&
szp
);

1094 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

1096 
PÙF™O
* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

1097 
V¬API
<
boŞ
[
nF_H
]> 
	`v¬
("A_F_H_dof");

1098 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

1099 
	`memıy
(
pÙf™
->
ff
->
dof
+
F_H_off£t
,
v¬
.
v®
,
nF_H
*(
boŞ
));

1102 
	}
}

1106 
	gPÙF™O
::
	$g‘£t_m—n_rho_H
(
PyG‘S‘Def
& 
g‘£t
)

1108 
g‘£t
.
Çme
=(*)"mean_rho_H";

1109 
g‘£t
.
doc
=(*)"";

1111 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

1114 
PÙF™O
* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

1115 
size_t
 
sz
;

1116 
size_t
* 
szp
=&
sz
;

1117 
sz
=
pÙf™
->
ncÚfigs
;

1118 
pÙf™
->
	`ÿlc_m—n_rho_Hs
();

1119 
ty³0
* 
v
=
pÙf™
->
m—n_rhoHs
;

1120  
v¬
<
ty³0
*>::
	`bud
(
v
,&
szp
);

1122 
g‘£t
.
£t
=[](
PyObjeù
*,PyObject*,*)->

1124 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,"readonly‡ttribute");

1127 
	}
}

1131 
	gPÙF™O
::
	$g‘£t_max_ÁrŸls
(
PyG‘S‘Def
& 
g‘£t
)

1133 
g‘£t
.
Çme
=(*)"max_ntrials";

1134 
g‘£t
.
doc
=(*)"";

1136 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

1138  
v¬
<>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
pÙf™
->
max_ÁrŸls
);

1140 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

1142 
V¬API
<> 
	`v¬
("max_ntrials");

1143 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

1144 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
pÙf™
->
max_ÁrŸls
=
v¬
.
v®
;

1147 
	}
}

1151 
	gPÙF™O
::
	$g‘£t_nmš_¡•s
(
PyG‘S‘Def
& 
g‘£t
)

1153 
g‘£t
.
Çme
=(*)"nmin_steps";

1154 
g‘£t
.
doc
=(*)"";

1156 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

1158  
v¬
<>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
pÙf™
->
nmš_¡•s
);

1160 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

1162 
V¬API
<> 
	`v¬
("nmin_steps");

1163 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

1164 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
pÙf™
->
nmš_¡•s
=
v¬
.
v®
;

1167 
	}
}

1171 
	gPÙF™O
::
	$g‘£t_tŞ
(
PyG‘S‘Def
& 
g‘£t
)

1173 
g‘£t
.
Çme
=(*)"tol";

1174 
g‘£t
.
doc
=(*)"";

1176 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

1178  
v¬
<
ty³0
>::
	`bud
(
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
pÙf™
->
”r_tŞ
);

1180 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

1182 
V¬API
<
ty³0
> 
	`v¬
("tol");

1183 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

1184 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
pÙf™
->
”r_tŞ
=
v¬
.
v®
;

1187 
	}
}

1191 
	gPÙF™O
::
	$g‘£t_”rs
(
PyG‘S‘Def
& 
g‘£t
)

1193 
g‘£t
.
Çme
=(*)"errs";

1194 
g‘£t
.
doc
=(*)"";

1196 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

1198 
PÙF™O
* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

1199 
size_t
 
sz
;

1200 
size_t
* 
szp
=&
sz
;

1201 
sz
=
pÙf™
->
ncÚfigs
;

1202 
PyObjeù
* 
İ
=
v¬
<
ty³0
*>::
	`bud
(
pÙf™
->
”rs
,&
szp
);

1203  
İ
;

1205 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

1207 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,"readonly‡ttribute");

1210 
	}
}

1214 
	gPÙF™O
::
	$g‘£t_cÛfs
(
PyG‘S‘Def
& 
g‘£t
)

1216 
g‘£t
.
Çme
=(*)"coefs";

1217 
g‘£t
.
doc
=(*)"";

1219 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

1221 
PÙF™O
* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

1222 
size_t
 
sz
;

1223 
size_t
* 
szp
=&
sz
;

1224 
sz
=
pÙf™
->
ncÚfigs
;

1225 
ty³0
* 
v
=
pÙf™
->
	`g‘_cÛfs
();

1226 
PyObjeù
* 
İ
=
v¬
<
ty³0
*>::
	`bud
(
v
,&
szp
);

1227 
MemÜy
::
	`d—Îoc
(
v
);

1228  
İ
;

1230 
g‘£t
.
£t
=[](
PyObjeù
* 
£lf
,PyObjeù* 
v®
,*)->

1232 
V¬API
<
ty³0
*> 
	`v¬
("coefs");

1233 if(
v¬
.
	`£t
(
v®
)!=0)  -1;

1234 
PÙF™O
* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

1235 if(
v¬
.
__v¬__
.
size
!=
¡©ic_ÿ¡
<
size_t
>(
pÙf™
->
ncÚfigs
))

1237 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,"size mismatch");

1240 
pÙf™
->
	`£t_cÛfs
(
v¬
.
v®
);

1243 
	}
}

1247 
	gPÙF™O
::
	$g‘£t_RFeH
(
PyG‘S‘Def
& 
g‘£t
)

1249 
g‘£t
.
Çme
=(*)"RFeH";

1250 
g‘£t
.
doc
=(*)"";

1252 
g‘£t
.
g‘
=[](
PyObjeù
* 
£lf
,*)->PyObject*

1255 
PÙF™O
* 
pÙf™
=
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->potfit;

1256 if(
pÙf™
->
ncÚfigs
!=1)

1258 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,"cannot calculate RFeH for multiple configurations");

1259  
NULL
;

1262 
ty³0
* 
Rs
=
NULL
;

1263 
ty³0
* 
Fs
=
NULL
;

1264 * 
Ns
=
NULL
;

1265 
size_t
 
sz
=
pÙf™
->
	`g‘_rFeH
(
Rs
,
Fs
,
Ns
);

1266 
size_t
* 
szp
=&
sz
;

1268 
PyObjeù
* 
py_obj
=
	`PyLi¡_New
(3);

1269 
	`PyLi¡_SET_ITEM
(
py_obj
,0,
v¬
<
ty³0
*>::
	`bud
(
Rs
,&
szp
));

1270 
	`PyLi¡_SET_ITEM
(
py_obj
,1,
v¬
<
ty³0
*>::
	`bud
(
Fs
,&
szp
));

1271 
	`PyLi¡_SET_ITEM
(
py_obj
,2,
v¬
<*>::
	`bud
(
Ns
,&
szp
));

1273 
MemÜy
::
	`d—Îoc
(
Rs
);

1274 
MemÜy
::
	`d—Îoc
(
Fs
);

1275 
MemÜy
::
	`d—Îoc
(
Ns
);

1277  
py_obj
;

1281 
g‘£t
.
£t
=[](
PyObjeù
*,PyObject*,*)->

1283 
	`PyE¼_S‘SŒšg
(
PyExc_Ty³E¼Ü
,"readonly‡ttribute");

1286 
	}
}

1290 
	gPÙF™O
::
	$ml_mš
(
PyM‘hodDef
& 
_m‘hods
)

1292 
_m‘hods
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

1293 
_m‘hods
.
ml_Çme
="min";

1294 
_m‘hods
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

1295 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

1298 
FuncAPI
<>
	`f
("min",{"nsteps"});

1299 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

1301 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
pÙf™
->
	`mš_cg
(
f
.
v®
<0>());

1303 
Py_RETURN_NONE
;

1307 
_m‘hods
.
ml_doc
=(*)
R
"---(

1308 
quick
 
funùiÚ
 
ÿlcuÏ‹šg
 
phÚÚ
 
äeq


1309 
u£
 
w™h
 
ÿutiÚ


1312 
	}
}

1340 
	gPÙF™O
::
	$ml_‹¡_A_rho_H
(
PyM‘hodDef
& 
_m‘hods
)

1342 
_m‘hods
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

1343 
_m‘hods
.
ml_Çme
="test_A_rho_H";

1344 
_m‘hods
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

1345 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

1347 
FuncAPI
<,
ty³0
,>
	`f
("test_A_rho_H",{"comp","delta","n"});

1348 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

1349 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
pÙf™
->
	`g’_‹¡
(
rho_H_off£t
+
f
.
v®
<0>(),f.val<1>(),f.val<2>());

1350 
Py_RETURN_NONE
;

1352 
_m‘hods
.
ml_doc
="";

1353 
	}
}

1357 
	gPÙF™O
::
	$ml_‹¡_A_phi_FeH
(
PyM‘hodDef
& 
_m‘hods
)

1359 
_m‘hods
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

1360 
_m‘hods
.
ml_Çme
="test_A_phi_FeH";

1361 
_m‘hods
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

1362 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

1364 
FuncAPI
<,
ty³0
,>
	`f
("test_A_phi_FeH",{"comp","delta","n"});

1365 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

1366 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
pÙf™
->
	`g’_‹¡
(
phi_HH_off£t
+
f
.
v®
<0>(),f.val<1>(),f.val<2>());

1367 
Py_RETURN_NONE
;

1369 
_m‘hods
.
ml_doc
="";

1370 
	}
}

1374 
	gPÙF™O
::
	$ml_‹¡_A_phi_HH
(
PyM‘hodDef
& 
_m‘hods
)

1376 
_m‘hods
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

1377 
_m‘hods
.
ml_Çme
="test_A_phi_HH";

1378 
_m‘hods
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

1379 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

1381 
FuncAPI
<,
ty³0
,>
	`f
("test_A_phi_HH",{"comp","delta","n"});

1382 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

1383 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
pÙf™
->
	`g’_‹¡
(
phi_FeH_off£t
+
f
.
v®
<0>(),f.val<1>(),f.val<2>());

1384 
Py_RETURN_NONE
;

1386 
_m‘hods
.
ml_doc
="";

1387 
	}
}

1391 
	gPÙF™O
::
	$ml_‹¡_A_F_H
(
PyM‘hodDef
& 
_m‘hods
)

1393 
_m‘hods
.
ml_æags
=
METH_VARARGS
 | 
METH_KEYWORDS
;

1394 
_m‘hods
.
ml_Çme
="test_A_F_H";

1395 
_m‘hods
.
ml_m‘h
=(
PyCFunùiÚ
)(
PyCFunùiÚW™hKeywÜds
)(

1396 [](
PyObjeù
* 
£lf
,PyObjeù* 
¬gs
,PyObjeù* 
kwds
)->PyObject*

1398 
FuncAPI
<,
ty³0
,>
	`f
("test_A_F_H",{"comp","delta","n"});

1399 if(
	`f
(
¬gs
,
kwds
)è 
NULL
;

1400 
»š‹½»t_ÿ¡
<
Objeù
*>(
£lf
)->
pÙf™
->
	`g’_‹¡
(
F_H_off£t
+
f
.
v®
<0>(),f.val<1>(),f.val<2>());

1401 
Py_RETURN_NONE
;

1403 
_m‘hods
.
ml_doc
="";

1404 
	}
}

	@potfit_o.h

1 #iâdeà
__MAPP__pÙf™_o__


2 
	#__MAPP__pÙf™_o__


	)

3 
	~"©oms_md.h
"

4 
	~"mš_cg_pÙf™.h
"

5 
	~"ff_—m_f™_o.h
"

6 
	~"th”mo_dyÇmics.h
"

7 
Çme¥aû
 
	gMAPP_NS


9 şas 
	cPÙF™O


11 
	g´iv©e
:

12 
ÁrŸl
;

13 
ty³0
 
	g”r_tŞ
;

14 
	gnmš_¡•s
;

15 cÚ¡ * 
	g”r_msgs
[];

17 
	g´Ùeùed
:

18 
public
:

19 
PÙF™O
(

20 
ty³0
(&)[
Äho_H
],ty³0(&)[
Åhi_FeH
],ty³0(&)[
Åhi_HH
],ty³0(&)[
nF_H
],

21 
¡d
::
¡ršg
*&&,¡d::¡ršg*&,*&,
ty³0
(*&)[1+
__nvoigt__
],ty³0(*&)[1+__nvoigt__],
PyObjeù
**,
size_t
,
MPI_Comm
&);

23 ~
PÙF™O
();

25 
Th”moDyÇmics
 
g‘_th”mo
();

26 
ty³0
 
F
(type0);

27 
ls_´•
(
ty³0
&,type0&,type0&);

28 
F_»£t
();

29 
size_t
 
g‘_rFeH
(
ty³0
*&,type0*&,*&);

32 
	gncÚfigs
;

33 
ty³0
* 
	g”rs
;

34 * 
	groÙs
;

35 
	g¡d
::
¡ršg
* 
Çmes_¡r
;

36 cÚ¡ ** 
	gÇmes
;

37 
MPI_Comm
 
	gwÜld
;

38 
MPI_Comm
* 
	gmy_wÜld
;

39 
	gmy_¿nk
,
	gmy_cÚf
,
	gmy_lş_¿nk
;

40 
AtomsMD
* 
	g©oms
;

41 
MšCGPÙF™
* 
	gmš
;

42 
LšeS—rchB»Á
* 
	gmš_ls
;

43 
FÜûF›ldEAMF™O
* 
	gff
;

44 * 
	gnHs
;

45 
ty³0
* 
	gm—n_rhoHs
;

47 
	gVecT’s
<
	gty³0
,1> 
	gX0
;

48 
	gVecT’s
<
	gty³0
,1> 
	gXÜig
;

51 
ty³0
 
fšd_max_®pha_A_rho_H
();

52 
ty³0
 
fšd_max_®pha_A_phi_FeH
();

53 
ty³0
 
fšd_max_®pha_A_phi_HH
();

54 
ty³0
 
fšd_max_®pha_A_F_H
();

58 
ty³0
 
	gtÙ_”r
;

59 
ÿlc_nHs
();

60 
ÿlc_m—n_rho_Hs
();

61 
ty³0
 
™”
();

62 
mš_cg
();

63 
¡Üe_x0
();

64 
»¡Üe_x0
();

65 
fuÎ_»£t
();

66 
g’_‹¡
(,
ty³0
,);

68 
	gmax_ÁrŸls
;

69 
ty³0
 
	gcÛf
;

70 
ty³0
 
	grg‘
;

71 
ty³0
 
	gf_lş
[
nHv¬s
];

72 
ty³0
 
	gf
[
nHv¬s
];

73 
ty³0
 
	gf0
[
nHv¬s
];

74 
ty³0
 
	gh
[
nHv¬s
];

75 
ty³0
 
	gx0
[
nHv¬s
];

76 
ty³0
 
	gdx_max
[
nHv¬s
];

78 
ty³0
* 
g‘_cÛfs
();

79 
£t_cÛfs
(
ty³0
*);

84 
PyObjeù_HEAD


85 
şass
 
PÙF™O
* 
	gpÙf™
;

86 }
	tObjeù
;

90 
PyTy³Objeù
 
	gTy³Objeù
;

91 
PyObjeù
* 
__Ãw__
(
PyTy³Objeù
*,PyObject*, PyObject*);

92 
__š™__
(
PyObjeù
*, PyObject*,PyObject*);

93 
PyObjeù
* 
__®loc__
(
PyTy³Objeù
*,
Py_ssize_t
);

94 
__d—Îoc__
(
PyObjeù
*);

97 
PyG‘S‘Def
 
	gg‘£t
[];

98 
£tup__g‘£t
();

102 
g‘£t_A_rho_H
(
PyG‘S‘Def
&);

103 
g‘£t_A_phi_FeH
(
PyG‘S‘Def
&);

104 
g‘£t_A_phi_HH
(
PyG‘S‘Def
&);

105 
g‘£t_A_F_H
(
PyG‘S‘Def
&);

107 
g‘£t_dA_rho_H_max
(
PyG‘S‘Def
&);

108 
g‘£t_dA_phi_FeH_max
(
PyG‘S‘Def
&);

109 
g‘£t_dA_phi_HH_max
(
PyG‘S‘Def
&);

110 
g‘£t_dA_F_H_max
(
PyG‘S‘Def
&);

112 
g‘£t_A_rho_H_dof
(
PyG‘S‘Def
&);

113 
g‘£t_A_phi_FeH_dof
(
PyG‘S‘Def
&);

114 
g‘£t_A_phi_HH_dof
(
PyG‘S‘Def
&);

115 
g‘£t_A_F_H_dof
(
PyG‘S‘Def
&);

116 
g‘£t_m—n_rho_H
(
PyG‘S‘Def
&);

117 
g‘£t_max_ÁrŸls
(
PyG‘S‘Def
&);

118 
g‘£t_nmš_¡•s
(
PyG‘S‘Def
&);

119 
g‘£t_tŞ
(
PyG‘S‘Def
&);

120 
g‘£t_cÛfs
(
PyG‘S‘Def
&);

121 
g‘£t_”rs
(
PyG‘S‘Def
&);

123 
g‘£t_RFeH
(
PyG‘S‘Def
&);

128 
PyM‘hodDef
 
	gm‘hods
[];

129 
£tup__m‘hods
();

130 
ml_»£t
(
PyM‘hodDef
&);

131 
ml_mš
(
PyM‘hodDef
&);

132 
ml_‹¡_A_rho_H
(
PyM‘hodDef
&);

133 
ml_‹¡_A_F_H
(
PyM‘hodDef
&);

134 
ml_‹¡_A_phi_FeH
(
PyM‘hodDef
&);

135 
ml_‹¡_A_phi_HH
(
PyM‘hodDef
&);

138 
£tup_
();

142 
ty³0
 
fšd_max_®pha
(cÚ¡y³0,cÚ¡y³0,
boŞ
,type0,type0,type0);

	@print.h

1 #iâdeà
__MAPP__´št__


2 
	#__MAPP__´št__


	)

3 
	~<¡ršg
>

4 
	~<c¡ršg
>

5 
	~<io¡»am
>

6 
	~<lim™s
>

7 şas 
	cPršt


9 
	m´iv©e
:

10 
‹m¶©e
<>

11 
cÚ¡ex´
 
ndig™s
();

12 
	mpublic
:

14 
‹m¶©e
 <
şass
... 
Ts
>

15 
šlše
 * 
v´štf
(*,
Ts
...);

16 
	m‹m¶©e
 <
	mşass
... 
	mTs
>

17 
šlše
 * 
v´štf
(cÚ¡ *,
Ts
...);

19 
šlše
 * 
v´štf
(const *);

21 
šlše
 * 
v´štf
(*);

23 
	m‹m¶©e
<
	mşass
>

24 
šlše
 
cÚ¡ex´
 
mš_Ëngth
();

25 
	m‹m¶©e
<
	mşass
>

26 
šlše
 
cÚ¡ex´
 
max_Ëngth
();

28 
	m‹m¶©e
<
	mşass
>

29 
šlše
 
cÚ¡ex´
 
d–_Ëngth
();

31 
	m‹m¶©e
<
şass
 
	mT
>

32 
šlše
 
	m¡d
::
¡ršg
 
	$to_¡ršg
(
T
 
__v®
)

34 if(
¡d
::
is_š‹g¿l
<
T
>::
v®ue
)

36 if(
¡d
::
is_unsigÃd
<
T
>::
v®ue
)

37  
¡d
::
	`to_¡ršg
(
¡©ic_ÿ¡
<>(
__v®
));

39  
¡d
::
	`to_¡ršg
(
¡©ic_ÿ¡
<>(
__v®
));

42  
¡d
::
	`to_¡ršg
(
¡©ic_ÿ¡
<>(
__v®
));

45 
	}
};

49 
	g‹m¶©e
 <
	gşass
... 
	gTs
>

50 
šlše
 * 
	gPršt
::
	$v´štf
(* 
fÜm©
,
Ts
... 
v®s
)

52 
size_t
 
Ën
=
	`¢´štf
(
NULL
,0,
fÜm©
,
v®s
...)+1;

53 * 
buff
=
Ãw
 [
Ën
];

54 
	`¥rštf
(
buff
,
fÜm©
,
v®s
...);

55 
d–‘e
 [] 
fÜm©
;

56 
fÜm©
=
NULL
;

57  
buff
;

58 
	}
}

62 
	g‹m¶©e
 <
	gşass
... 
	gTs
>

63 
šlše
 * 
	gPršt
::
	$v´štf
(cÚ¡ * 
fÜm©
,
Ts
... 
v®s
)

65 
size_t
 
Ën
=
	`¢´štf
(
NULL
,0,
fÜm©
,
v®s
...)+1;

66 * 
buff
=
Ãw
 [
Ën
];

67 
	`¥rštf
(
buff
,
fÜm©
,
v®s
...);

69  
buff
;

70 
	}
}

74 
šlše
 * 
	gPršt
::
	$v´štf
(cÚ¡ * 
fÜm©
)

76 
size_t
 
Ën
=
	`¡¾’
(
fÜm©
)+1;

77 * 
buff
=
Ãw
 [
Ën
];

78 
	`memıy
(
buff
,
fÜm©
,
Ën
*());

79  
buff
;

80 
	}
}

84 
šlše
 * 
	gPršt
::
	$v´štf
(* 
fÜm©
)

86  
fÜm©
;

87 
	}
}

91 
	g‹m¶©e
<>

92 
šlše
 
cÚ¡ex´
 
	gPršt
::
ndig™s
<0>()

99 
	g‹m¶©e
<
	gN
>

100 
cÚ¡ex´
 
	gPršt
::
	$ndig™s
()

102  1+
ndig™s
<
N
/10>();

103 
	}
}

107 
	g‹m¶©e
<>

108 
šlše
 
cÚ¡ex´
 
	gPršt
::
mš_Ëngth
<>()

115 
	g‹m¶©e
<>

116 
šlše
 
cÚ¡ex´
 
	gPršt
::
mš_Ëngth
<>()

123 
	g‹m¶©e
<>

124 
šlše
 
cÚ¡ex´
 
	gPršt
::
mš_Ëngth
<>()

131 
	g‹m¶©e
<
şass
 
	gT
>

132 
šlše
 
cÚ¡ex´
 
	gPršt
::
	$mš_Ëngth
()

135 
	}
}

136 
	#MAX
(
A
,
B
è(A>B?A:B)

	)

140 
	g‹m¶©e
<>

141 
šlše
 
cÚ¡ex´
 
	gPršt
::
max_Ëngth
<>()

143  
ndig™s
<
¡d
::
num”ic_lim™s
<>::
max_expÚ’t10
>()+5;

148 
	g‹m¶©e
<>

149 
šlše
 
cÚ¡ex´
 
	gPršt
::
max_Ëngth
<>()

151  
ndig™s
<
¡d
::
num”ic_lim™s
<>::
max_expÚ’t10
>()+5;

156 
	g‹m¶©e
<>

157 
šlše
 
cÚ¡ex´
 
	gPršt
::
max_Ëngth
<>()

159  
ndig™s
<
¡d
::
num”ic_lim™s
<>::
max_expÚ’t10
>()+5;

164 
	g‹m¶©e
<
şass
 
	gT
>

165 
šlše
 
cÚ¡ex´
 
	gPršt
::
	$max_Ëngth
()

167  
¡©ic_ÿ¡
<>(
	`MAX
(
Pršt
::
	`to_¡ršg
(
¡d
::
num”ic_lim™s
<
T
>::
	`max
()).
	`Ëngth
(),Pršt::to_¡ršg(¡d::num”ic_lim™s<T>::
	`mš
()).length()));

168 
	}
}

172 
	g‹m¶©e
<
şass
 
	gT
>

173 
šlše
 
cÚ¡ex´
 
	gPršt
::
	$d–_Ëngth
()

175  
max_Ëngth
<
T
>()-
mš_Ëngth
<T>();

176 
	}
}

	@py_compat.h

1 #ià
PY_MAJOR_VERSION
 >= 3

2 
	#IS_PY3K


	)

5 #iâdeà
Py_TYPE


6 
	#Py_TYPE
(
ob
è(((
PyObjeù
*)(ob))->
ob_ty³
)

	)

11 #ifdeà
IS_PY3K


12 
	#PyLÚg_FromLÚg
 
PyLÚg_FromLÚg


	)

13 
	#PyLÚg_FromSize_t
 
PyLÚg_FromSize_t


	)

14 
	#GET_FILE_FROM_PY
(
fe_Çme
è
	)
file_name

15 
	#MOD_INIT
(
Çme
,
func
è
PyMODINIT_FUNC
 
PyIn™_
##
	`Çme
(){
PyObjeù
* 
__moduË__
=func;  __moduË__;}

	)

17 
	#__PySŒšg_AsSŒšg
(
v
è
	`PyUnicode_AsUTF8AndSize
(v,
NULL
)

	)

18 
	#__PySŒšg_FromSŒšg
(
v
è
	`PyUnicode_FromSŒšg
(v)

	)

22 
	#PyLÚg_FromLÚg
 
PyIÁ_FromLÚg


	)

23 
	#PyLÚg_FromSize_t
 
PyIÁ_FromSize_t


	)

24 
	#GET_FILE_FROM_PY
(
fe_Çme
è
»š‹½»t_ÿ¡
<
PyFeObjeù
*>(
	`PySys_G‘Objeù
((*)#fe_Çme))->
f_å


	)

25 
	#MOD_INIT
(
Çme
,
func
è
PyMODINIT_FUNC
 
š™
##
	`Çme
(){func;}

	)

27 
	#__PySŒšg_AsSŒšg
(
v
è
	`PySŒšg_AsSŒšg
(v)

	)

28 
	#__PySŒšg_FromSŒšg
(
v
è
	`PySŒšg_FromSŒšg
(v)

	)

	@random.cpp

5 
	~"¿ndom.h
"

6 
	~<m©h.h
>

7 
	#RNG_M
 2147483647

	)

8 
	#RNG_MI
 1.0/2147483647

	)

9 
	#RNG_A
 16807

	)

10 
	#RNG_Q
 127773

	)

11 
	#RNG_R
 2836

	)

12 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

16 
	gRªdom
::
	$Rªdom
(
num
)

18 
£ed
=
num
;

19 
gauss_chk
=0;

20 
	}
}

24 
	gRªdom
::~
	$Rªdom
()

26 
	}
}

32 
ty³0
 
Rªdom
::
	$unifÜm
()

34 
fœ¡
,
£cÚd
,
ºd
;

35 
fœ¡
=
£ed
/
RNG_Q
;

36 
£cÚd
=
£ed
%
RNG_Q
;

37 
ºd
=
RNG_A
*
£cÚd
-
RNG_R
*
fœ¡
;

38 if(
ºd
>0)

39 
£ed
=
ºd
;

41 
£ed
=
ºd
+
RNG_M
;

42  
£ed
*
RNG_MI
;

43 
	}
}

47 
ty³0
 
	gRªdom
::
	$gaussŸn
()

49 if(
gauss_chk
)

51 
gauss_chk
=
çl£
;

52  
»£rved
;

55 
gauss_chk
=
Œue
;

56 
ty³0
 
u
=0.0,
v
=0.0,
s
,
r
;

57 
s
=1.0;

58 
s
>=1.0)

60 
u
=2.0*
	`unifÜm
()-1.0;

61 
v
=2.0*
	`unifÜm
()-1.0;

62 
s
=
u
*u+
v
*v;

65 
r
=
	`sq¹
(-2.0*
	`log
(
s
)/s);

66 
»£rved
=
v
*
r
;

67  
u
*
r
;

68 
	}
}

72 
ty³0
 
	gRªdom
::

73 
	$gaussŸn
(
ty³0
 
sigma
,ty³0 
mu
)

75  (
mu
+
sigma
*
	`gaussŸn
());

76 
	}
}

	@random.h

1 #iâdeà
__MAPP__¿ndom__


2 
	#__MAPP__¿ndom__


	)

3 
	~"glob®.h
"

4 
Çme¥aû
 
	gMAPP_NS


6 şas 
	cRªdom


8 
	g´iv©e
:

9 
ty³0
 
»£rved
;

10 
boŞ
 
	ggauss_chk
;

11 
	g£ed
;

12 
	g´Ùeùed
:

13 
public
:

14 
Rªdom
();

15 ~
Rªdom
();

16 
ty³0
 
unifÜm
();

17 
ty³0
 
gaussŸn
();

18 
ty³0
 
gaussŸn
(type0,type0);

	@thermo_dynamics.cpp

1 
	~"th”mo_dyÇmics.h
"

2 
	~"MAPP.h
"

3 
	~"memÜy.h
"

4 
	~"´št.h
"

5 
	~<m©h.h
>

9 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

13 
	gTh”moDyÇmics
::
	$Th”moDyÇmics
(cÚ¡ 
__´ecisiÚ
):

14 
	`´ecisiÚ
(
__´ecisiÚ
),

15 
	`l_št
(
Pršt
::
max_Ëngth
<>()+1),

16 
	`l_doubË
(
Pršt
::
max_Ëngth
<>()+
__´ecisiÚ
),

17 
	`qs
(
NULL
),

18 
	$nqs
(0)

20 
	}
}

24 
	gTh”moDyÇmics
::~
	$Th”moDyÇmics
()

26 
d–‘e
 [] 
qs
;

27 
	}
}

31 
	gTh”moDyÇmics
::
	$š™
()

33 
n
=
nqs
*(
l_doubË
+1)+
l_št
+1+nqs;

34 
	`årštf
(
MAPP
::
m­p_out
," ");

35 
i
=0;i<
n
;i++)

36 
	`årštf
(
MAPP
::
m­p_out
,
THERMO_LINE
);

37 
	`årštf
(
MAPP
::
m­p_out
," \n");

40 
	`årštf
(
MAPP
::
m­p_out
,
THERMO_DLMTR
);

41 
	`´št_h—d”
(
MAPP
::
m­p_out
,"¡•",
l_št
+1);

43 
i
=0;i<
nqs
;i++)

45 
	`årštf
(
MAPP
::
m­p_out
,
THERMO_DLMTR
);

46 
qs
[
i
].
	`´št_h—d”
(
MAPP
::
m­p_out
,
l_doubË
+1);

48 
	`årštf
(
MAPP
::
m­p_out
,
THERMO_DLMTR
"\n");

51 
	`årštf
(
MAPP
::
m­p_out
,
THERMO_DLMTR
);

52 
i
=0;i<
l_št
+1;i++)

53 
	`årštf
(
MAPP
::
m­p_out
,
THERMO_LINE
);

54 
i
=0;i<
nqs
;i++)

56 
	`årštf
(
MAPP
::
m­p_out
,
THERMO_DLMTR
);

57 
j
=0;j<
l_doubË
+1;j++)

58 
	`årštf
(
MAPP
::
m­p_out
,
THERMO_LINE
);

61 
	`årštf
(
MAPP
::
m­p_out
,
THERMO_DLMTR
"\n");

63 
	}
}

67 
	gTh”moDyÇmics
::
	$´št
(
¡•_no
)

69 
	`årštf
(
MAPP
::
m­p_out
,
THERMO_DLMTR
" %0*d ",
l_št
-1,
¡•_no
);

70 
i
=0;i<
nqs
;i++)

71 
	`årštf
(
MAPP
::
m­p_out
,
THERMO_DLMTR
"%+*.*",
l_doubË
,
´ecisiÚ
,*
qs
[
i
].
±r
);

73 
	`årštf
(
MAPP
::
m­p_out
,
THERMO_DLMTR
"\n");

74 
	}
}

78 
	gTh”moDyÇmics
::
	$fš
()

80 
n
=
nqs
*(
l_doubË
+1)+
l_št
+1+nqs;

81 
	`årštf
(
MAPP
::
m­p_out
," ");

82 
i
=0;i<
n
;i++)

83 
	`årštf
(
MAPP
::
m­p_out
,
THERMO_LINE
);

84 
	`årštf
(
MAPP
::
m­p_out
," \n");

85 
	}
}

89 
	gTh”moQuªt™y
::
	$Th”moQuªt™y
():

90 
	`Çme
(
NULL
),

91 
	`Çme_Êgth
(0),

92 
	$±r
(
NULL
)

94 
	}
}

98 
	gTh”moQuªt™y
::~
	$Th”moQuªt™y
()

100 
	}
}

104 
Th”moQuªt™y
::
	$Th”moQuªt™y
(cÚ¡ * 
__Çme
,
ty³0
& 
v®
):

105 
	`Çme
(
__Çme
),
	`±r
(&
v®
),

106 
	`Çme_Êgth
(
¡©ic_ÿ¡
<>(
	$¡¾’
(
__Çme
)))

108 
	}
}

112 
	gTh”moQuªt™y
::
	$Th”moQuªt™y
(cÚ¡ 
Th”moQuªt™y
& 
r
):

113 
	`Çme
(
r
.
Çme
),
	`±r
Ô.
±r
),

114 
	$Çme_Êgth
(
r
.
Çme_Êgth
)

116 
	}
}

120 
	gTh”moQuªt™y
::
	$Th”moQuªt™y
(
Th”moQuªt™y
&& 
r
):

121 
	`Çme
(
r
.
Çme
),
	`±r
Ô.
±r
),

122 
	$Çme_Êgth
(
r
.
Çme_Êgth
)

124 
	}
}

128 
	gTh”moQuªt™y
& Th”moQuªt™y::
İ”©Ü
 =(cÚ¡ 
Th”moQuªt™y
& 
r
)

130 
this
->~
Th”moQuªt™y
();

131 
Ãw
 (
this
è
Th”moQuªt™y
(
r
);

132  *
	gthis
;

137 
	gTh”moQuªt™y
& Th”moQuªt™y::
İ”©Ü
 =(
Th”moQuªt™y
&& 
r
)

139 
this
->~
Th”moQuªt™y
();

140 
Ãw
(
this
è
Th”moQuªt™y
(
¡d
::
move
(
r
));

141  *
	gthis
;

146 
	gTh”moQuªt™y
::
	$´št_h—d”
(
FILE
* 
__out
,
Êgth
)

149 if(
Çme_Êgth
<=
Êgth
)

150 
	`årštf
(
__out
,"%*s%*s",(
Êgth
-Êgth/2)+
Çme_Êgth
/2,
Çme
,lngth/2-name_lngth/2,"");

152 
i
=0;i<
Êgth
;i++è
	`årštf
(
__out
,"%c",
Çme
[i]);

153 
	}
}

	@thermo_dynamics.h

1 #iâdeà
__MAPP__th”mo_dyÇmics__


2 
	#__MAPP__th”mo_dyÇmics__


	)

3 
	~"glob®.h
"

4 
	~<¡ršg
>

6 
Çme¥aû
 
	gMAPP_NS


8 şas 
	cTh”moQuªt™y


10 
	g´iv©e
:

11 
´Ùeùed
:

12 
public
:

14 
Th”moQuªt™y
();

15 
Th”moQuªt™y
(cÚ¡ *,
ty³0
&);

16 
Th”moQuªt™y
(const ThermoQuantity&);

17 
Th”moQuªt™y
(ThermoQuantity&&);

18 ~
Th”moQuªt™y
();

19 
	gTh”moQuªt™y
& 
	gİ”©Ü
 =(cÚ¡ 
Th”moQuªt™y
&);

20 
	gTh”moQuªt™y
& 
	gİ”©Ü
 =(
Th”moQuªt™y
&&);

22 cÚ¡ * 
	gÇme
;

23 cÚ¡ 
	gÇme_Êgth
;

24 
ty³0
 cÚ¡ * cÚ¡ 
	g±r
;

25 
´št_h—d”
(
FILE
*,);

29 
Çme¥aû
 
	gMAPP_NS


31 şas 
	cTh”moDyÇmics


33 
	g´iv©e
:

34 
´Ùeùed
:

35 cÚ¡ 
´ecisiÚ
;

36 cÚ¡ 
	gl_št
;

37 cÚ¡ 
	gl_doubË
;

39 
Th”moQuªt™y
* 
	gqs
;

40 
	gnqs
;

42 
	g‹m¶©e
<
	gşass
 ...
	gTs
>

43 
assign
(
Th”moQuªt™y
* 
__qs
,cÚ¡ * 
Çme
,
ty³0
& 
v®
,
Ts
&... 
vs
)

45 
assign
(
__qs
,
Çme
,
v®
);

46 
assign
(
__qs
+1,
vs
...);

49 
assign
(
Th”moQuªt™y
* 
__qs
,cÚ¡ * 
Çme
,
ty³0
& 
v®
)

51 
	g__qs
->~
Th”moQuªt™y
();

52 
Ãw
 (
__qs
è
Th”moQuªt™y
(
Çme
,
v®
);

57 
	gpublic
:

58 
Th”moDyÇmics
(const );

59 
	g‹m¶©e
<
	gşass
 ...
	gTs
>

60 
Th”moDyÇmics
(cÚ¡ 
__´ecisiÚ
,cÚ¡ * 
Çme
,
Ts
&... 
vs
):

61 
Th”moDyÇmics
(
__´ecisiÚ
)

63 
nqs
=
¡©ic_ÿ¡
<>((...(
vs
)+1)/2);

64 
	gqs
=
Ãw
 
Th”moQuªt™y
[
nqs
];

65 
assign
(
qs
,
Çme
,
vs
...);

69 ~
Th”moDyÇmics
();

71 
´št
();

72 
š™
();

73 
fš
();

76 
	g‹m¶©e
<
	gN
>

77 
´št_h—d”
(
FILE
* 
__out
,cÚ¡ (&
Çme
)[
N
],
Êgth
)

79 if(
	gN
-1<=
Êgth
)

80 
årštf
(
__out
,"%*s%*s",(
Êgth
-Êgth/2)+(
N
-1)/2,
Çme
,lngth/2-(N-1)/2,"");

82 
	gi
=0;i<
	gÊgth
;i++è
årštf
(
__out
,"%c",
Çme
[
i
]);

	@thermostat.cpp

1 
	~"th”mo¡©.h
"

2 
	~<m©h.h
>

3 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

7 
	gTh”mo¡©NHC
::
	$Th”mo¡©NHC
():

8 
	`t_»Ïx
(0),

9 
	`äeq_sq
(0),

10 
	`L
(0),

11 
	`n™”s
(0),

12 
	`ddt
(0),

13 
	`ddt2
(0),

14 
	`ddt4
(0),

15 
	$‘a_d
(
NULL
)

16 {
	}
}

20 
	gTh”mo¡©NHC
::
	$Th”mo¡©NHC
(cÚ¡ 
ty³0
 
__dt
,

21 cÚ¡ 
ty³0
 
__t_»Ïx
,cÚ¡ 
__L
,

22 cÚ¡ 
__n™”s
):

23 
	`t_»Ïx
(
__t_»Ïx
),

24 
	`äeq_sq
(1.0/(
__t_»Ïx
*__t_relax)),

25 
	`L
(
__L
),

26 
	`n™”s
(
__n™”s
),

27 
	`‘a_d
(
NULL
),

28 
	`ddt
(
__dt
/
¡©ic_ÿ¡
<
ty³0
>(
__n™”s
)),

29 
	`ddt2
(0.5*
__dt
/
¡©ic_ÿ¡
<
ty³0
>(
__n™”s
)),

30 
	`ddt4
(0.25*
__dt
/
¡©ic_ÿ¡
<
ty³0
>(
__n™”s
))

32 
‘a_d
=
Ãw
 
ty³0
[
L
];

33 
ich
=0;ich<
L
;ich++è
‘a_d
[ich]=0.0;

34 
	}
}

38 
	gTh”mo¡©NHC
::~
	$Th”mo¡©NHC
()

40 
d–‘e
 [] 
‘a_d
;

41 
	}
}

45 
ty³0
 
	gTh”mo¡©NHC
::
	$İ”©Ü
()(
ty³0
 
T_r
,
ndof
)

47 
ty³0
 
»sÿË
=1.0;

48 
ty³0
 
´ev_çc
,
tmp
;

49 if(
L
==1)

51 
™”
=0;™”<
n™”s
;iter++)

53 
‘a_d
[0]+=
ddt2
*
äeq_sq
*(
T_r
-1.0);

54 
´ev_çc
=
	`exp
(-
ddt
*
‘a_d
[0]);

55 
»sÿË
*=
´ev_çc
;

56 
T_r
*=
´ev_çc
*prev_fac;

57 
‘a_d
[0]+=
ddt2
*
äeq_sq
*(
T_r
-1.0);

59  
»sÿË
;

63 autØ
f
=[](
ty³0
 
x
)->type0

65 if(
	`çbs
(
x
)<0.015625)

66  1.0+
x
/2.0+x*x/6.0+x*x*x/24.0;

67  (
	`exp
(
x
)-1.0)/x;

70 
™”
=0;™”<
n™”s
;iter++)

72 
‘a_d
[
L
-1]+=
ddt2
*Ó_d[L-2]*‘a_d[L-2]-
äeq_sq
);

73 
´ev_çc
=-
‘a_d
[
L
-1];

75 
ich
=
L
-2;ich>0;ich--)

77 
‘a_d
[
ich
]+=
ddt2
*
	`f
(
´ev_çc
*ddt2)*Õ»v_çc*‘a_d[ich]+‘a_d[ich-1]*‘a_d[ich-1]-
äeq_sq
);

78 
´ev_çc
=-
‘a_d
[
ich
];

81 
‘a_d
[0]+=
ddt2
*
	`f
(
´ev_çc
*ddt2)*Õ»v_çc*‘a_d[0]+
äeq_sq
*(
T_r
-1.0));

82 
´ev_çc
=-
‘a_d
[0];

85 
tmp
=
	`exp
(
ddt
*
´ev_çc
);

86 
»sÿË
*=
tmp
;

87 
T_r
*=
tmp
*tmp;

88 
´ev_çc
=(
T_r
-1.0)*
äeq_sq
;

91 
‘a_d
[0]+=
ddt2
*
	`f
(-‘a_d[1]*ddt2)*(-‘a_d[1]*‘a_d[0]+
´ev_çc
);

92 
´ev_çc
=
ndof
*
‘a_d
[0]*‘a_d[0]-
äeq_sq
;

94 
ich
=1;ich<
L
-1;ich++)

96 
‘a_d
[
ich
]+=
ddt2
*
	`f
(-‘a_d[ich+1]*ddt2)*(-‘a_d[ich+1]*‘a_d[ich]+
´ev_çc
);

97 
´ev_çc
=
‘a_d
[
ich
]*‘a_d[ich]-
äeq_sq
;

100 
‘a_d
[
L
-1]+=
ddt2
*
´ev_çc
;

140  
»sÿË
;

141 
	}
}

	@thermostat.h

1 #iâdeà
__MAPP__th”mo¡©__


2 
	#__MAPP__th”mo¡©__


	)

3 
	~<¡dio.h
>

4 
	~"glob®.h
"

5 
Çme¥aû
 
	gMAPP_NS


7 şas 
	cTh”mo¡©NHC


9 
	g´iv©e
:

10 cÚ¡ 
ty³0
 
ddt
;

11 cÚ¡ 
ty³0
 
	gddt2
;

12 cÚ¡ 
ty³0
 
	gddt4
;

13 cÚ¡ 
ty³0
 
	gäeq_sq
;

14 
ty³0
* 
	g‘a_d
;

15 
	g´Ùeùed
:

16 
public
:

17 cÚ¡ 
ty³0
 
t_»Ïx
;

18 cÚ¡ 
	gL
;

19 cÚ¡ 
	gn™”s
;

20 
Th”mo¡©NHC
(cÚ¡ 
ty³0
,constype0,const ,const );

21 
Th”mo¡©NHC
();

22 ~
Th”mo¡©NHC
();

23 
ty³0
 
İ”©Ü
()(
	gty³0
,);

	@timer.cpp

1 
	~"©oms.h
"

2 
	~"tim”.h
"

3 
	~"memÜy.h
"

4 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

8 
	gTim”
::
	$Tim”
()

10 
nmodes
=0;

11 
cu¼_Ëv–
=-1;

12 
Ëv–2mode_ÿ·c™y
=0;

14 
	`add_mode
("comm ");

15 
	`add_mode
("neigh");

16 
	`add_mode
("force");

17 
	`add_mode
("write");

18 
	`add_mode
("other");

19 
	}
}

23 
	gTim”
::~
	$Tim”
()

25 
imod
=0;imod<
nmodes
;imod++)

26 
d–‘e
 [] 
mode_Çmes
[
imod
];

27 if(
nmodes
)

29 
d–‘e
 [] 
time
;

30 
d–‘e
 [] 
mode_Çmes
;

33 if(
Ëv–2mode_ÿ·c™y
)

34 
d–‘e
 [] 
Ëv–2mode
;

35 
	}
}

39 
	gTim”
::
	$add_mode
(cÚ¡ * 
mode_Çme
)

41 
imod
=0;

42 
imod
<
nmodes
 && 
	`¡rcmp
(
mode_Çme
,
mode_Çmes
[imod]))

43 
imod
++;

45 if(
imod
!=
nmodes
)

46  
imod
;

48 
Êght
=
¡©ic_ÿ¡
<>(
	`¡¾’
(
mode_Çme
))+1;

49 
	`GROW
(
time
,
nmodes
,nmodes+1);

50 
	`GROW
(
mode_Çmes
,
nmodes
,nmodes+1);

51 
time
[
nmodes
]=0.0;

52 
	`CREATE1D
(
mode_Çmes
[
nmodes
],
Êght
);

53 
	`memıy
(
mode_Çmes
[
nmodes
],
mode_Çme
,
Êght
*());

54 
nmodes
++;

55  
nmodes
-1;

56 
	}
}

60 
	gTim”
::
	$¡¬t
(
mode
)

62 
ty³0
 
t
=
	`MPI_Wtime
();

63 if(
cu¼_Ëv–
!=-1)

64 
time
[
Ëv–2mode
[
cu¼_Ëv–
]]+=
t
;

66 
cu¼_Ëv–
++;

67 if(
cu¼_Ëv–
==
Ëv–2mode_ÿ·c™y
)

69 
	`GROW
(
Ëv–2mode
,
Ëv–2mode_ÿ·c™y
,level2mode_capacity+1);

70 
Ëv–2mode_ÿ·c™y
++;

72 
Ëv–2mode
[
cu¼_Ëv–
]=
mode
;

74 
time
[
mode
]-=
t
;

76 
	}
}

80 
	gTim”
::
	$¡İ
(
mode
)

87 
ty³0
 
t
=
	`MPI_Wtime
();

88 
time
[
mode
]+=
t
;

89 
cu¼_Ëv–
--;

90 if(
cu¼_Ëv–
!=-1)

91 
time
[
Ëv–2mode
[
cu¼_Ëv–
]]-=
t
;

92 
	}
}

96 
ty³0
 
	gTim”
::
	$mode_time
(
mode
)

98  
time
[
mode
];

99 
	}
}

103 
	gTim”
::
	$š™
()

105 
ty³0
 
t
=
	`MPI_Wtime
();

106 
tÙ_time
=-
t
;

107 
i
=0;i<
nmodes
;i++)

108 
time
[
i
]=0.0;

109 
	}
}

113 
	gTim”
::
	$fš
()

115 
ty³0
 
t
=
	`MPI_Wtime
();

116 
tÙ_time
+=
t
;

118 
t
=
tÙ_time
;

119 
i
=0;i<
nmodes
;i++)

120 
t
-=
time
[
i
];

122 
time
[
OTHER_TIME_mode
]+=
t
;

123 
	}
}

127 
	gTim”
::
	$´št_¡©s
()

143 
	}
}

147 
ty³0
 
Tim”
::
	$t¡_¡¬t
()

149 
t¡_time
=-
	`MPI_Wtime
();

151 
	}
}

155 
ty³0
 
	gTim”
::
	$t¡_¡İ
()

157 
t¡_time
+=
	`MPI_Wtime
();

158  
t¡_time
;

159 
	}
}

	@timer.h

1 #iâdeà
__MAPP__tim”__


2 
	#__MAPP__tim”__


	)

3 
	~"glob®.h
"

4 
Çme¥aû
 
	gMAPP_NS


8 
	gCOMM_TIME_mode
,

9 
	gNEIGH_TIME_mode
,

10 
	gFORCE_TIME_mode
,

11 
	gWRITE_TIME_mode
,

12 
	gOTHER_TIME_mode


15 şas 
	cTim”


17 
	g´iv©e
:

18 
cu¼_time_mode
;

19 
	g´ev_time_mode
;

20 
ty³0
 
	gt¡_time
;

21 ** 
	gmode_Çmes
;

22 
	g´Ùeùed
:

23 
public
:

24 * 
Ëv–2mode
;

25 
	gËv–2mode_ÿ·c™y
;

26 
	gcu¼_Ëv–
;

28 
	gnmodes
;

30 
ty³0
 
	gtÙ_time
;

31 
ty³0
* 
	gtime
;

33 
¡¬t
();

34 
¡İ
();

35 
ty³0
 
mode_time
();

36 
š™
();

37 
fš
();

38 
´št_¡©s
();

40 
ty³0
 
t¡_¡¬t
();

41 
ty³0
 
t¡_¡İ
();

42 
add_mode
(const *);

44 
Tim”
();

45 ~
Tim”
();

	@var.cpp

1 
	~"v¬.h
"

2 
	~<mpi.h
>

4 
V¬
** 
	gV¬
::
v¬_¡ack
=
NULL
;

5 
size_t
 
	gV¬
::
¡ack_size
=0;

6 
size_t
 
	gV¬
::
¡ack_ÿ·c™y
=0;

7 
size_t
 
	gV¬
::
¡ack_grow
=10;

8 cÚ¡ 
	g¡d
::
¡ršg
 
ty³_©Œ
<
boŞ
>::
	$Çme
(){ 
¡d
::
	`¡ršg
("boŞ");
	}
};

9 cÚ¡ 
boŞ
 
	gty³_©Œ
<
	gboŞ
>::
z”o
=
çl£
;

10 cÚ¡ 
	g¡d
::
¡ršg
 
ty³_©Œ
<>::
	$Çme
(){ 
¡d
::
	`¡ršg
("ch¬");
	}
};

11 cÚ¡ 
	gty³_©Œ
<>::
z”o
=0;

12 cÚ¡ 
	g¡d
::
¡ršg
 
ty³_©Œ
<>::
	$Çme
(){ 
¡d
::
	`¡ršg
("unsigÃd ch¬");
	}
};

13 cÚ¡ 
	gty³_©Œ
<>::
z”o
=0;

14 cÚ¡ 
	g¡d
::
¡ršg
 
ty³_©Œ
<>::
	$Çme
(){ 
¡d
::
	`¡ršg
("shÜt");
	}
};

15 cÚ¡ 
	gty³_©Œ
<>::
z”o
=0;

16 cÚ¡ 
	g¡d
::
¡ršg
 
ty³_©Œ
<>::
	$Çme
(){ 
¡d
::
	`¡ršg
("unsigÃd shÜt");
	}
};

17 cÚ¡ 
	gty³_©Œ
<>::
z”o
=0;

18 cÚ¡ 
	g¡d
::
¡ršg
 
ty³_©Œ
<>::
	$Çme
(){ 
¡d
::
	`¡ršg
("št");
	}
};

19 cÚ¡ 
	gty³_©Œ
<>::
z”o
=0;

20 cÚ¡ 
	g¡d
::
¡ršg
 
ty³_©Œ
<>::
	$Çme
(){ 
¡d
::
	`¡ršg
("unsigÃd iÁ");
	}
};

21 cÚ¡ 
	gty³_©Œ
<>::
z”o
=0;

22 cÚ¡ 
	g¡d
::
¡ršg
 
ty³_©Œ
<>::
	$Çme
(){ 
¡d
::
	`¡ršg
("lÚg");
	}
};

23 cÚ¡ 
	gty³_©Œ
<>::
z”o
=0;

24 cÚ¡ 
	g¡d
::
¡ršg
 
ty³_©Œ
<>::
	$Çme
(){ 
¡d
::
	`¡ršg
("unsigÃd†Úg");
	}
};

25 cÚ¡ 
	gty³_©Œ
<>::
z”o
=0;

26 cÚ¡ 
	g¡d
::
¡ršg
 
ty³_©Œ
<>::
	$Çme
(){ 
¡d
::
	`¡ršg
("lÚg†Úg");
	}
};

27 cÚ¡ 
	gty³_©Œ
<>::
z”o
=0;

28 cÚ¡ 
	g¡d
::
¡ršg
 
ty³_©Œ
<>::
	$Çme
(){ 
¡d
::
	`¡ršg
("unsigÃd†Úg†Úg");
	}
};

29 cÚ¡ 
	gty³_©Œ
<>::
z”o
=0;

30 cÚ¡ 
	g¡d
::
¡ršg
 
ty³_©Œ
<>::
	$Çme
(){ 
¡d
::
	`¡ršg
("æßt");
	}
};

31 cÚ¡ 
	gty³_©Œ
<>::
z”o
=0;

32 cÚ¡ 
	g¡d
::
¡ršg
 
ty³_©Œ
<>::
	$Çme
(){ 
¡d
::
	`¡ršg
("doubË");
	}
};

33 cÚ¡ 
	gty³_©Œ
<>::
z”o
=0;

34 cÚ¡ 
	g¡d
::
¡ršg
 
ty³_©Œ
<>::
	$Çme
(){ 
¡d
::
	`¡ršg
("lÚg doubË");
	}
};

35 cÚ¡ 
	gty³_©Œ
<>::
z”o
=0;

36 cÚ¡ 
	g¡d
::
¡ršg
 
ty³_©Œ
<
¡d
::¡ršg>::
	$Çme
(){ 
¡d
::
	`¡ršg
("¡d::¡ršg");
	}
};

37 cÚ¡ 
	g¡d
::
¡ršg
 
ty³_©Œ
<
¡d
::¡ršg>::
z”o
=std::string();

39 
¡©ic_as£¹
((
boŞ
)==(),"sizeof(bool)!=sizeof(char)");

40 
¡©ic_as£¹
((
boŞ
)==(
Åy_boŞ
),"sizeof(bool)!=sizeof(npy_bool)");

41 
¡©ic_as£¹
(
¡©ic_ÿ¡
<
Åy_boŞ
>(
Œue
)==
NPY_TRUE
,"true!=NPY_TRUE");

42 
¡©ic_as£¹
(
¡©ic_ÿ¡
<
Åy_boŞ
>(
çl£
)==
NPY_FALSE
,"true!=NPY_TRUE");

47 
	gV¬
::
	$push
(
V¬
* 
v¬ŸbË
)

49 if(
¡ack_size
+1>
¡ack_ÿ·c™y
)

51 
V¬
** 
v¬_¡ack_
=
Ãw
 V¬*[
¡ack_ÿ·c™y
+1+
¡ack_grow
];

52 
	`memıy
(
v¬_¡ack_
,
v¬_¡ack
,
¡ack_size
*(
V¬
*));

53 
d–‘e
 [] 
v¬_¡ack
;

54 
v¬_¡ack
=
v¬_¡ack_
;

55 
¡ack_ÿ·c™y
+=1+
¡ack_grow
;

58 
v¬_¡ack
[
¡ack_size
]=
v¬ŸbË
;

59 
¡ack_size
++;

60 
	}
}

64 
	gV¬
::
	$pİ
(
V¬
* 
v¬ŸbË
)

66 
size_t
 
iv¬
=
¡ack_size
-1;

67 ;
v¬_¡ack
[
iv¬
]!ğ
v¬ŸbË
;ivar--){}

68 
v¬_¡ack
[
iv¬
]=v¬_¡ack[
¡ack_size
-1];

70 
¡ack_size
--;

71 if(
¡ack_ÿ·c™y
-
¡ack_size
>
¡ack_grow
)

73 
V¬
** 
v¬_¡ack_
=
Ãw
 V¬*[
¡ack_size
];

74 
	`memıy
(
v¬_¡ack_
,
v¬_¡ack
,
¡ack_size
*(
V¬
*));

75 
d–‘e
 [] 
v¬_¡ack
;

76 
v¬_¡ack
=
v¬_¡ack_
;

77 
¡ack_ÿ·c™y
=
¡ack_size
;

79 
	}
}

83 
	gV¬
::
	$»¶aû
(
V¬
* 
key
,V¬* 
v®ue
)

85 
size_t
 
iv¬
=
¡ack_size
-1;

86 ;
v¬_¡ack
[
iv¬
]!ğ
key
;ivar--){}

87 
v¬_¡ack
[
iv¬
]=
v®ue
;

88 
	}
}

92 
	gV¬
::
	$V¬
(
¿nk_
,
size_t
 
hash_code_
,cÚ¡ * 
__Çme
):

93 
	`¿nk
(
¿nk_
),

94 
	`hash_code
(
hash_code_
),

95 
	`Çme
(
__Çme
),

96 
	`obj_£t
(
çl£
),

97 
	`pushed
(
Œue
),

98 
	$roÙ
(
Œue
)

100 
	`push
(
this
);

101 
	}
}

105 
	gV¬
::
	$V¬
(
¿nk_
,
size_t
 
hash_code_
,
¡d
::
¡ršg
&& 
Çme_
):

106 
	`¿nk
(
¿nk_
),

107 
	`hash_code
(
hash_code_
),

108 
	`Çme
(
Çme_
),

109 
	`obj_£t
(
çl£
),

110 
	`pushed
(
Œue
),

111 
	$roÙ
(
çl£
)

113 
	`push
(
this
);

114 
	}
}

118 
	gV¬
::
	$V¬
(
__¿nk
,
size_t
 
hash_code_
,cÚ¡ 
¡d
::
¡ršg
& 
__Çme
):

119 
	`¿nk
(
__¿nk
),

120 
	`hash_code
(
hash_code_
),

121 
	`Çme
(
__Çme
),

122 
	`obj_£t
(
çl£
),

123 
	`pushed
(
Œue
),

124 
	$roÙ
(
çl£
)

126 
	`push
(
this
);

127 
	}
}

131 
	gV¬
::
	$V¬
(
¿nk_
,
size_t
 
hash_code_
):

132 
	`¿nk
(
¿nk_
),

133 
	`hash_code
(
hash_code_
),

134 
	`obj_£t
(
çl£
),

135 
	`pushed
(
çl£
),

136 
	$roÙ
(
çl£
)

138 
	}
}

142 
	gV¬
::~
	$V¬
()

144 if(
pushed
è
	`pİ
(
this
);

145 
	}
}

149 
	gV¬
::
	$V¬
(cÚ¡ 
V¬
& 
r
):

150 
	`¿nk
(
r
.
¿nk
),

151 
	`hash_code
(
r
.
hash_code
),

152 
	`obj_£t
(
r
.
obj_£t
),

153 
	`size
(
r
.
size
),

154 
	`pushed
(
r
.
pushed
),

155 
	$roÙ
(
r
.
roÙ
)

157 if(
pushed
è
	`push
(
this
);

158 
	}
}

162 
	gV¬
::
	$V¬
(
V¬
&& 
r
):

163 
	`¿nk
(
r
.
¿nk
),

164 
	`hash_code
(
r
.
hash_code
),

165 
	`Çme
(
¡d
::
	`move
(
r
.
Çme
)),

166 
	`obj_£t
(
r
.
obj_£t
),

167 
	`size
(
r
.
size
),

168 
	`pushed
(
r
.
pushed
),

169 
	$roÙ
(
r
.
roÙ
)

171 if(
pushed
è
	`»¶aû
(&
r
,
this
);

173 
r
.
obj_£t
=
çl£
;

174 
r
.
size
=0;

175 
r
.
pushed
=
çl£
;

176 
r
.
roÙ
=
çl£
;

177 
	}
}

181 
size_t
* 
	gV¬
::
	$is_¬¿y
(cÚ¡ 
r
)

183 if(!
¿nk
è 
NULL
;

184 
size_t
** 
sz_l¡
=
	`size_li¡
();

185 
size_t
 
sz
=1;

186 
i
=0;i<
r
;i++)

188 
j
=1;j<
sz
;j++)

190 if(
sz_l¡
[
i
][
j
]!=sz_lst[i][0])

192 
d–‘e
 [] *
sz_l¡
;

193 
d–‘e
 [] 
sz_l¡
;

194  
NULL
;

197 
sz
*=
sz_l¡
[
i
][0];

200 
size_t
* 
sh­e
=
Ãw
 size_t[
r
];

201 
i
=0;i<
r
;i++)

202 
sh­e
[
i
]=
sz_l¡
[i][0];

204 
d–‘e
 [] *
sz_l¡
;

205 
d–‘e
 [] 
sz_l¡
;

208  
sh­e
;

209 
	}
}

213 
size_t
 
	gV¬
::
	$is_squ¬e
()

215 
size_t
* 
sh­e
=
	`is_¬¿y
(2);

216 if(
sh­e
 && shape[0]==shape[1])

218 
size_t
 
ªs
=
sh­e
[0];

219 
d–‘e
 [] 
sh­e
;

220  
ªs
;

223 
d–‘e
 [] 
sh­e
;

225 
	}
}

229 
size_t
 
	gV¬
::
	$is_ŒŸnguÏr
()

231 if(
¿nk
<2)  0;

233 
size_t
** 
sz_l¡
=
	`size_li¡
();

234 
size_t
 
i
=0;i<
sz_l¡
[0][0];i++)

235 if(
sz_l¡
[1][
i
]!=i+1)

237 
d–‘e
 [] *
sz_l¡
;

238 
d–‘e
 [] 
sz_l¡
;

242 
size_t
 
ªs
=
sz_l¡
[0][0];

243 
d–‘e
 [] *
sz_l¡
;

244 
d–‘e
 [] 
sz_l¡
;

245  
ªs
;

246 
	}
}

250 
size_t
** 
	gV¬
::
	$size_li¡
()

252 if(!
¿nk
è 
NULL
;

253 
size_t
* 
ÃËm
=(
¿nk
==0è? 
NULL
:
Ãw
 size_t[rank];

254 
i
=0;i<
¿nk
;i++è
ÃËm
[i]=0;

255 
	`size_li¡
(
ÃËm
);

256 
size_t
 
tÙ
=0;

257 
i
=0;i<
¿nk
;i++è
tÙ
+=
ÃËm
[i];

259 
size_t
** 
sz_l¡
=
Ãw
 size_t*[
¿nk
];

260 *
sz_l¡
=
Ãw
 
size_t
[
tÙ
];

261 
i
=1;i<
¿nk
;i++)

262 
sz_l¡
[
i
]=sz_l¡[i-1]+
ÃËm
[i-1];

263 
size_t
** 
sh
=(
¿nk
==0è? 
NULL
:
Ãw
 size_t*[rank];

264 
i
=1;i<
¿nk
;i++è
sh
[i]=
sz_l¡
[i];

265 
	`size_li¡
(
sh
);

266 
d–‘e
 [] 
sh
;

267 
d–‘e
 [] 
ÃËm
;

268  
sz_l¡
;

269 
	}
}

273 
	gV¬
::
	$size_li¡
(
size_t
* 
sz
)

275 *
sz
+=
size
;

276 if(
¿nk
==1) ;

277 
size_t
 
i
=0;i<
size
;i++)

278 (*
this
)[
i
].
	`size_li¡
(
sz
+1);

279 
	}
}

283 
	gV¬
::
	$size_li¡
(
size_t
** 
sz
)

285 **
sz
=
size
;

286 *
sz
+=1;

287 if(
¿nk
==1) ;

288 
size_t
 
i
=0;i<
size
;i++)

289 (*
this
)[
i
].
	`size_li¡
(
sz
+1);

290 
	}
}

294 
boŞ
 
	gV¬
::
	$is_£t
()

296  
obj_£t
;

297 
	}
}

301 
boŞ
 
	gV¬
::
	$b–Úgs_to
(
V¬
& 
r
)

303 if(
this
->
hash_code
!ğ
r
.hash_code)

304  
çl£
;

306 if(
this
->
¿nk
==
r
.rank)

307  *
this
==
r
;

309 if(
¿nk
==
r
.rank+1)

310 
size_t
 
i
=0;i<
size
;i++)

311 if(*
this
==
r
[
i
])

312  
Œue
;

314  
çl£
;

315 
	}
}

319 
boŞ
 
	gV¬
::
İ”©Ü
 =ğ(
V¬
& 
r
)

321 if(
this
->
hash_code
!ğ
r
.hash_cod||his->
¿nk
!ğr.¿nk ||his->
size
!=„.size)

322  
çl£
;

323 
size_t
 
	gi
=0;i<
	gsize
;i++)

324 if(!((*
	gthis
)[
i
]==
r
[i]))

325  
çl£
;

326  
	gŒue
;

331 
boŞ
 
	gV¬
::
İ”©Ü
 !ğ(
V¬
& 
r
)

333  !
İ”©Ü
==(
r
);

338 
boŞ
 
	gV¬
::
İ”©Ü
 > (
V¬
&)

340  
çl£
;

345 
boŞ
 
	gV¬
::
İ”©Ü
 >ğ(
V¬
&)

347  
çl£
;

352 
boŞ
 
	gV¬
::
İ”©Ü
 <ğ(
V¬
&)

354  
çl£
;

359 
boŞ
 
	gV¬
::
İ”©Ü
 < (
V¬
&)

361  
çl£
;

	@var.h

1 #iâdeà
__MAPP__v¬__


2 
	#__MAPP__v¬__


	)

3 
	~<PythÚ.h
>

4 
	~"py_com·t.h
"

5 
	#NPY_NO_DEPRECATED_API
 
NPY_1_7_API_VERSION


	)

6 
	#NO_IMPORT_ARRAY


	)

7 
	#PY_ARRAY_UNIQUE_SYMBOL
 
ARRAY_API


	)

8 
	~<numpy/¬¿yobjeù.h
>

9 
	~<mpi.h
>

10 
	~"´št.h
"

11 
	~"glob®.h
"

15 
Çme¥aû
 
	gMAPP_NS


17 
	g‹m¶©e
<cÚ¡ >şas 
	cty³_num2ıp_ty³
{
	gpublic
:
	tT
;};

18 
	g‹m¶©e
<>
şass
 
	gty³_num2ıp_ty³
<
	gNPY_BOOL
>{
	gpublic
:
boŞ
 
	tT
;};

19 
	g‹m¶©e
<>
şass
 
	gty³_num2ıp_ty³
<
	gNPY_BYTE
>{
	gpublic
:
	tT
;};

20 
	g‹m¶©e
<>
şass
 
	gty³_num2ıp_ty³
<
	gNPY_UBYTE
>{
	gpublic
:
	tT
;};

21 
	g‹m¶©e
<>
şass
 
	gty³_num2ıp_ty³
<
	gNPY_SHORT
>{
	gpublic
:
	tT
;};

22 
	g‹m¶©e
<>
şass
 
	gty³_num2ıp_ty³
<
	gNPY_USHORT
>{
	gpublic
:
	tT
;};

23 
	g‹m¶©e
<>
şass
 
	gty³_num2ıp_ty³
<
	gNPY_INT
>{
	gpublic
:
	tT
;};

24 
	g‹m¶©e
<>
şass
 
	gty³_num2ıp_ty³
<
	gNPY_UINT
>{
	gpublic
:
	tT
;};

25 
	g‹m¶©e
<>
şass
 
	gty³_num2ıp_ty³
<
	gNPY_LONG
>{
	gpublic
:
	tT
;};

26 
	g‹m¶©e
<>
şass
 
	gty³_num2ıp_ty³
<
	gNPY_ULONG
>{
	gpublic
:
	tT
;};

27 
	g‹m¶©e
<>
şass
 
	gty³_num2ıp_ty³
<
	gNPY_LONGLONG
>{
	gpublic
:
	tT
;};

28 
	g‹m¶©e
<>
şass
 
	gty³_num2ıp_ty³
<
	gNPY_ULONGLONG
>{
	gpublic
:
	tT
;};

29 
	g‹m¶©e
<>
şass
 
	gty³_num2ıp_ty³
<
	gNPY_FLOAT
>{
	gpublic
:
	tT
;};

30 
	g‹m¶©e
<>
şass
 
	gty³_num2ıp_ty³
<
	gNPY_DOUBLE
>{
	gpublic
:
	tT
;};

31 
	g‹m¶©e
<>
şass
 
	gty³_num2ıp_ty³
<
	gNPY_LONGDOUBLE
>{
	gpublic
:
	tT
;};

32 
	g‹m¶©e
<>
şass
 
	gty³_num2ıp_ty³
<
	gNPY_STRING
>{
	gpublic
:
¡d
::
	t¡ršg
 
	tT
;};

34 
	g‹m¶©e
<
şass
 
	gT
>şas 
	cıp_ty³2ty³_num
{
	gpublic
:
cÚ¡ex´
 
ty³_num
(){ -1;};};

35 
	g‹m¶©e
<>
şass
 
	gıp_ty³2ty³_num
<
	gboŞ
>{
	gpublic
:
cÚ¡ex´
 
ty³_num
(){ 
NPY_BOOL
;};};

36 
	g‹m¶©e
<>
şass
 
	gıp_ty³2ty³_num
<>{
	gpublic
:
cÚ¡ex´
 
ty³_num
(){ 
NPY_BYTE
;};};

37 
	g‹m¶©e
<>
şass
 
	gıp_ty³2ty³_num
<>{
	gpublic
:
cÚ¡ex´
 
ty³_num
(){ 
NPY_UBYTE
;};};

38 
	g‹m¶©e
<>
şass
 
	gıp_ty³2ty³_num
<>{
	gpublic
:
cÚ¡ex´
 
ty³_num
(){ 
NPY_SHORT
;};};

39 
	g‹m¶©e
<>
şass
 
	gıp_ty³2ty³_num
<>{
	gpublic
:
cÚ¡ex´
 
ty³_num
(){ 
NPY_USHORT
;};};

40 
	g‹m¶©e
<>
şass
 
	gıp_ty³2ty³_num
<>{
	gpublic
:
cÚ¡ex´
 
ty³_num
(){ 
NPY_INT
;};};

41 
	g‹m¶©e
<>
şass
 
	gıp_ty³2ty³_num
<>{
	gpublic
:
cÚ¡ex´
 
ty³_num
(){ 
NPY_UINT
;};};

42 
	g‹m¶©e
<>
şass
 
	gıp_ty³2ty³_num
<>{
	gpublic
:
cÚ¡ex´
 
ty³_num
(){ 
NPY_LONG
;};};

43 
	g‹m¶©e
<>
şass
 
	gıp_ty³2ty³_num
<>{
	gpublic
:
cÚ¡ex´
 
ty³_num
(){ 
NPY_ULONG
;};};

44 
	g‹m¶©e
<>
şass
 
	gıp_ty³2ty³_num
<>{
	gpublic
:
cÚ¡ex´
 
ty³_num
(){ 
NPY_LONGLONG
;};};

45 
	g‹m¶©e
<>
şass
 
	gıp_ty³2ty³_num
<>{
	gpublic
:
cÚ¡ex´
 
ty³_num
(){ 
NPY_ULONGLONG
;};};

46 
	g‹m¶©e
<>
şass
 
	gıp_ty³2ty³_num
<>{
	gpublic
:
cÚ¡ex´
 
ty³_num
(){ 
NPY_FLOAT
;};};

47 
	g‹m¶©e
<>
şass
 
	gıp_ty³2ty³_num
<>{
	gpublic
:
cÚ¡ex´
 
ty³_num
(){ 
NPY_DOUBLE
;};};

48 
	g‹m¶©e
<>
şass
 
	gıp_ty³2ty³_num
<>{
	gpublic
:
cÚ¡ex´
 
ty³_num
(){ 
NPY_LONGDOUBLE
;};};

49 
	g‹m¶©e
<>
şass
 
	gıp_ty³2ty³_num
<
	g¡d
::
¡ršg
>{
public
:
cÚ¡ex´
 
ty³_num
(){ 
NPY_STRING
;};};

53 
	g‹m¶©e
<
şass
 
	gT
>şas 
	csymm
{};

54 
	g‹m¶©e
<
şass
 
	gT
>şas 
	csq
{};

56 
	g‹m¶©e
<
şass
 
	gT
>şas 
	cty³_©Œ
{};

57 
	g‹m¶©e
<>
şass
 
	gty³_©Œ
<
	gboŞ
>

58 {
	gpublic
: cÚ¡ 
¡d
::
¡ršg
 
Çme
(); cÚ¡ 
boŞ
 
	gz”o
;};

59 
	g‹m¶©e
<>
şass
 
	gty³_©Œ
<>

60 {
	gpublic
: cÚ¡ 
¡d
::
¡ršg
 
Çme
(); cÚ¡ 
	gz”o
;};

61 
	g‹m¶©e
<>
şass
 
	gty³_©Œ
<>

62 {
	gpublic
: cÚ¡ 
¡d
::
¡ršg
 
Çme
(); cÚ¡ 
	gz”o
;};

63 
	g‹m¶©e
<>
şass
 
	gty³_©Œ
<>

64 {
	gpublic
: cÚ¡ 
¡d
::
¡ršg
 
Çme
(); cÚ¡ 
	gz”o
;};

65 
	g‹m¶©e
<>
şass
 
	gty³_©Œ
<>

66 {
	gpublic
: cÚ¡ 
¡d
::
¡ršg
 
Çme
(); cÚ¡ 
	gz”o
;};

67 
	g‹m¶©e
<>
şass
 
	gty³_©Œ
<>

68 {
	gpublic
: cÚ¡ 
¡d
::
¡ršg
 
Çme
(); cÚ¡ 
	gz”o
;};

69 
	g‹m¶©e
<>
şass
 
	gty³_©Œ
<>

70 {
	gpublic
: cÚ¡ 
¡d
::
¡ršg
 
Çme
(); cÚ¡ 
	gz”o
;};

71 
	g‹m¶©e
<>
şass
 
	gty³_©Œ
<>

72 {
	gpublic
: cÚ¡ 
¡d
::
¡ršg
 
Çme
(); cÚ¡ 
	gz”o
;};

73 
	g‹m¶©e
<>
şass
 
	gty³_©Œ
<>

74 {
	gpublic
: cÚ¡ 
¡d
::
¡ršg
 
Çme
(); cÚ¡ 
	gz”o
;};

75 
	g‹m¶©e
<>
şass
 
	gty³_©Œ
<>

76 {
	gpublic
: cÚ¡ 
¡d
::
¡ršg
 
Çme
(); cÚ¡ 
	gz”o
;};

77 
	g‹m¶©e
<>
şass
 
	gty³_©Œ
<>

78 {
	gpublic
: cÚ¡ 
¡d
::
¡ršg
 
Çme
(); cÚ¡ 
	gz”o
;};

79 
	g‹m¶©e
<>
şass
 
	gty³_©Œ
<>

80 {
	gpublic
: cÚ¡ 
¡d
::
¡ršg
 
Çme
(); cÚ¡ 
	gz”o
;};

81 
	g‹m¶©e
<>
şass
 
	gty³_©Œ
<>

82 {
	gpublic
: cÚ¡ 
¡d
::
¡ršg
 
Çme
(); cÚ¡ 
	gz”o
;};

83 
	g‹m¶©e
<>
şass
 
	gty³_©Œ
<>

84 {
	gpublic
: cÚ¡ 
¡d
::
¡ršg
 
Çme
(); cÚ¡ 
	gz”o
;};

85 
	g‹m¶©e
<>
şass
 
	gty³_©Œ
<
	g¡d
::
¡ršg
>

86 {
public
: cÚ¡ 
¡d
::
¡ršg
 
Çme
(); cÚ¡ 
	g¡d
::¡ršg 
z”o
;};

91 
	g‹m¶©e
<
şass
 
	gT
> cÏs 
	c»move_m©rix_©Œ
{
	gpublic
: 
T
 
	tty³
;};

92 
	g‹m¶©e
<
şass
 
	gT
> cÏs 
	g»move_m©rix_©Œ
<
	gsymm
<T>>{
	gpublic
: 
T
 
	tty³
;};

93 
	g‹m¶©e
<
şass
 
	gT
> cÏs 
	g»move_m©rix_©Œ
<
	gsq
<T>>{
	gpublic
: 
T
 
	tty³
;};

96 
	g‹m¶©e
<
şass
 
	gT
> cÏs 
	cıp_ty³
{
	gpublic
: 
T
 
	tty³
;};

97 
	g‹m¶©e
<
şass
 
	gT
> cÏs 
	gıp_ty³
<
	gsymm
<T>>{
	gpublic
: 
T
 
	tty³
;};

98 
	g‹m¶©e
<
şass
 
	gT
> cÏs 
	gıp_ty³
<
	gsq
<T>>{
	gpublic
: 
T
 
	tty³
;};

99 
	g‹m¶©e
<
şass
 
	gT
> cÏs 
	gıp_ty³
<T*>{
	gpublic
: 
ty³Çme
 
	tıp_ty³
<
	tT
>::
	tty³
*ype;};

100 
	g‹m¶©e
<
şass
 
	gT
,
size_t
 
	gN
> cÏs 
	gıp_ty³
<T[
N
]>{
	gpublic
: 
ty³Çme
 
	tıp_ty³
<
	tT
>::
	tty³
ype[N];};

103 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

107 
Çme¥aû
 
	gMAPP_NS


109 
	g‹m¶©e
<
şass
 
	gT
>

110 şas 
	cpy_v¬


112 
ä›nd
 
şass
 
	gpy_v¬
<
	gT
*>;

113 
size_t
 
g‘_size
() const{ 0;}

114 
	g´iv©e
:

115 
py_v¬
(
size_t
*,*&);

116 
py_v¬
(,*,
PyObjeù
**&);

117 
py_v¬
Õy_v¬<
T
>&&);

118 
	gpublic
:

119 
T
 
	tT_BASE
;

120 
cÚ¡ex´
 
g‘_¿nk
(){ 0;}

121 
T
 
	gv®
;

122 
py_v¬
(
PyObjeù
*);

123 
py_v¬
();

124 ~
py_v¬
();

126 
py_v¬
(cÚ¡…y_v¬<
T
>&);

127 
İ”©Ü
 
T
(ècÚ¡{ 
	gv®
;}

128 
	gpy_v¬
<
	gT
>& 
	gİ”©Ü
=(cÚ¡ 
py_v¬
<
T
>&);

129 
	gpy_v¬
<
	gT
>& 
	gİ”©Ü
=(
py_v¬
<
T
>&&);

130 
boŞ
 
	gİ”©Ü
==(cÚ¡ 
py_v¬
<
T
>&);

131 
	g¡d
::
¡ršg
 
”r_msg
();

132 cÚ¡ 
	g¡d
::
¡ršg
 
ty³_Çme
();

133 
boŞ
 
is_sq
(){ 
	gŒue
;}

139 
	g‹m¶©e
<
şass
 
	gT
>

140 
	gpy_v¬
<
	gT
>::
	$py_v¬
():

141 
	`v®
(
ty³_©Œ
<
T
>::
z”o
)

143 
	}
}

147 
‹m¶©e
<
şass
 
T
>

148 
py_v¬
<
T
>::
	$py_v¬
(
PyObjeù
* 
İ
):

149 
	`v®
(
ty³_©Œ
<
T
>::
z”o
)

151 
ty³_num
=
ıp_ty³2ty³_num
<
T
>::
	`ty³_num
();

152 
PyA¼ay_Desü
* 
desü
=
	`PyA¼ay_DesüFromTy³
(
ty³_num
);

153 
PyObjeù
* 
__¬r__
=
	`PyA¼ay_FromAny
(
İ
,
desü
,0,0,0,
NULL
);

155 if(
__¬r__
)

157 
PyA¼ayObjeù
* 
¬r
=(PyA¼ayObjeù*)
__¬r__
;

158 if(
¡d
::
is_§me
<
T
,
boŞ
>::
v®ue
)

160 if(*
¡©ic_ÿ¡
<*>(
	`PyA¼ay_DATA
(
¬r
))==
NPY_TRUE
)

161 
v®
=
Œue
;

163 
v®
=
çl£
;

166 
v®
=*
¡©ic_ÿ¡
<
T
*>(
	`PyA¼ay_DATA
(
¬r
));

168 
	`Py_DECREF
(
__¬r__
);

172 
throw
 1;

173 
	}
}

177 
	g‹m¶©e
<>

178 
šlše
 
	gpy_v¬
<
	g¡d
::
¡ršg
>::
	$py_v¬
(
PyObjeù
* 
İ
):

179 
	`v®
(
ty³_©Œ
<
¡d
::
¡ršg
>::
z”o
)

181 
ty³_num
=
ıp_ty³2ty³_num
<
¡d
::
¡ršg
>::
	`ty³_num
();

182 
PyA¼ay_Desü
* 
desü
=
	`PyA¼ay_DesüFromTy³
(
ty³_num
);

183 
PyObjeù
* 
__¬r__
=
	`PyA¼ay_FromAny
(
İ
,
desü
,0,0,0,
NULL
);

185 if(
__¬r__
)

187 
PyA¼ayObjeù
* 
¬r
=(PyA¼ayObjeù*)
__¬r__
;

188 * 
d©a
=
¡©ic_ÿ¡
<*>(
	`PyA¼ay_DATA
(
¬r
));

189 
v®
=
¡d
::
	`¡ršg
(
d©a
,
	`PyA¼ay_DESCR
(
¬r
)->
–size
);

190 
	`Py_DECREF
(
__¬r__
);

194 
throw
 1;

195 
	}
}

199 
	g‹m¶©e
<>

200 
šlše
 
	gpy_v¬
<
	g¡d
::
¡ršg
>::
	$py_v¬
(
size_t
* 
sz
,*& 
d©a
):

201 
	`v®
(
ty³_©Œ
<
¡d
::
¡ršg
>::
z”o
)

203 * 
d
=
¡©ic_ÿ¡
<*>(
d©a
);

204 
v®
=
¡d
::
	`¡ršg
(
d
,*
sz
);

205 
d©a
=
d
+*
sz
;

206 
	}
}

210 
	g‹m¶©e
<
şass
 
	gT
>

211 
	gpy_v¬
<
	gT
>::
	$py_v¬
(,*,
PyObjeù
**& 
objs
)

213 
this
->~
py_v¬
<
T
>();

214 
Œy


216 
	`Ãw
 (
this
è
py_v¬
<
T
>(*
objs
);

218 
	`ÿtch
()

220 
throw
 1;

222 
objs
++;

223 
	}
}

227 
	g‹m¶©e
<
şass
 
	gT
>

228 
	gpy_v¬
<
	gT
>::
	$py_v¬
(
size_t
*,*& 
d©a
):

229 
	`v®
(
ty³_©Œ
<
T
>::
z”o
)

231 
T
* 
d
=(T*)
d©a
;

232 
v®
=*
d
;

233 
d©a
=
d
+1;

234 
	}
}

238 
	g‹m¶©e
<
şass
 
	gT
>

239 
	gpy_v¬
<
	gT
>::~
	$py_v¬
()

241 
	}
}

245 
‹m¶©e
<
şass
 
T
>

246 
py_v¬
<
T
>::py_v¬(cÚ¡…y_v¬<T>& 
r
)

248 
v®
=
r
.val;

253 
	g‹m¶©e
<
şass
 
	gT
>

254 
	gpy_v¬
<
	gT
>&…y_v¬<T>::
İ”©Ü
=(cÚ¡ 
py_v¬
<
T
>& 
r
)

256 
v®
=
r
.val;

257  *
	gthis
;

262 
	g‹m¶©e
<
şass
 
	gT
>

263 
	gpy_v¬
<
	gT
>::
py_v¬
Õy_v¬<
T
>&& 
r
)

265 
v®
=
r
.val;

270 
	g‹m¶©e
<
şass
 
	gT
>

271 
	gpy_v¬
<
	gT
>&…y_v¬<T>::
İ”©Ü
=(
py_v¬
<
T
>&& 
r
)

273 
v®
=
r
.val;

274  *
	gthis
;

279 
	g‹m¶©e
<
şass
 
	gT
>

280 
boŞ
 
	gpy_v¬
<
	gT
>::
İ”©Ü
==(cÚ¡ 
py_v¬
<
T
>& 
r
)

282  (
this
->
v®
==
r
.val);

287 
	g‹m¶©e
<
şass
 
	gT
>

288 
	g¡d
::
¡ršg
 
py_v¬
<
T
>::
	$”r_msg
()

290  "fŸlu»Ødeduû C++y³ <"+
ty³_©Œ
<
T_BASE
>::
Çme
+">";

291 
	}
}

295 
	g‹m¶©e
<
şass
 
	gT
>

296 cÚ¡ 
	g¡d
::
¡ršg
 
py_v¬
<
T
>::
	$ty³_Çme
()

298  
ty³_©Œ
<
T_BASE
>::
	`Çme
();

299 
	}
}

303 
Çme¥aû
 
	gMAPP_NS


305 
	g‹m¶©e
<
şass
 
	gT
>

306 
şass
 
	gpy_v¬
<
	gT
*>

308 
ä›nd
 
şass
 
	gpy_v¬
<
	gT
**>;

309 
	g´iv©e
:

310 
py_v¬
(
size_t
*,*&);

311 
py_v¬
(,*,
PyObjeù
**&);

312 
py_v¬
Õy_v¬<
T
*>&&);

313 
	gpublic
:

314 
ty³Çme
 
	tpy_v¬
<
	tT
>::
	tT_BASE
 T_BASE;

315 
cÚ¡ex´
 
g‘_¿nk
(){  1+
	gpy_v¬
<
	gT
>::get_rank();}

316 
	gpy_v¬
<
	gT
>* 
	gv¬s
;

317 
size_t
 
	gsize
;

318 
py_v¬
(
PyObjeù
*);

319 
py_v¬
(
PyObjeù
**);

320 
py_v¬
();

321 ~
py_v¬
();

323 
py_v¬
(cÚ¡…y_v¬<
T
*>&);

324 
	gpy_v¬
<
	gT
*>& 
	gİ”©Ü
=(cÚ¡ 
py_v¬
<
T
*>&);

325 
	gpy_v¬
<
	gT
*>& 
	gİ”©Ü
=(
py_v¬
<
T
*>&&);

326 
boŞ
 
	gİ”©Ü
==(cÚ¡ 
py_v¬
<
T
*>&);

327 
	gpy_v¬
<
	gT
>& 
	gİ”©Ü
[](cÚ¡ 
	gsize_t
);

329 
boŞ
 
is_sq
();

330 
boŞ
 
is_sq
(
size_t
);

331 
boŞ
 
is_squ¬e
();

332 
boŞ
 
is_squ¬e
(
size_t
);

333 
boŞ
 
is_ŒŸnguÏr
();

334 
boŞ
 
is_ŒŸnguÏr
(
size_t
);

335 
boŞ
 
is_symm‘ric
();

336 
boŞ
 
is_symm‘ric
(
size_t
);

337 
boŞ
 
is_low”_ŒŸnguÏr
();

338 
boŞ
 
is_low”_ŒŸnguÏr
(
size_t
);

339 
boŞ
 
is_uµ”_ŒŸnguÏr
();

340 
boŞ
 
is_uµ”_ŒŸnguÏr
(
size_t
);

342 
ŒŸnguÏr_to_symm‘ric
();

343 
ŒŸnguÏr_to_low”_ŒŸnguÏr
();

344 
ŒŸnguÏr_to_uµ”_ŒŸnguÏr
();

346 
	g¡d
::
¡ršg
 
”r_msg
();

347 cÚ¡ 
	g¡d
::
¡ršg
 
ty³_Çme
();

348 
	g´iv©e
:

349 
size_t
 
g‘_size
(ècÚ¡{ 
size
;}

356 
	g‹m¶©e
<
şass
 
	gT
>

357 
	gpy_v¬
<
	gT
*>::
	$py_v¬
():

358 
	`size
(0),

359 
	$v¬s
(
NULL
)

361 
	}
}

365 
	g‹m¶©e
<
şass
 
	gT
>

366 
	gpy_v¬
<
	gT
*>::
	$py_v¬
(
PyObjeù
* 
İ
):

367 
	`size
(0),

368 
	$v¬s
(
NULL
)

371 
ty³_num
=
ıp_ty³2ty³_num
<
T_BASE
>::
	`ty³_num
();

372 
¿nk
=
	`g‘_¿nk
();

373 
PyObjeù
* 
__¬r__
;

374 
PyA¼ay_Desü
* 
desü
;

377 
desü
=
	`PyA¼ay_DesüFromTy³
(
ty³_num
);

378 
__¬r__
=
	`PyA¼ay_FromAny
(
İ
,
desü
,
¿nk
,¿nk,
NPY_ARRAY_CARRAY_RO
,
NULL
);

379 if(
__¬r__
)

381 
PyA¼ayObjeù
* 
¬r
=(PyA¼ayObjeù*)
__¬r__
;

382 
Åy_š
* 
dims
=
	`PyA¼ay_DIMS
(
¬r
);

383 
size_t
 
sz
[
	`g‘_¿nk
()+1];

384 
i
=0;i<
¿nk
;i++)

385 
sz
[
i
]=
dims
[i];

386 
sz
[
	`g‘_¿nk
()]=0;

388 if(
¡d
::
is_§me
<
T_BASE
,¡d::
¡ršg
>::
v®ue
è
sz
[
	`g‘_¿nk
()]=
	`PyA¼ay_DESCR
(
¬r
)->
–size
;

390 * 
d©a
=
	`PyA¼ay_DATA
(
¬r
);

391 
this
->~
py_v¬
<
T
*>();

392 
	`Ãw
 (
this
è
py_v¬
<
T
*>(
sz
,
d©a
);

393 
	`Py_DECREF
(
__¬r__
);

396 
	`PyE¼_CË¬
();

398 if(
¿nk
>1)

400 
desü
=
	`PyA¼ay_DesüFromTy³
(
NPY_OBJECT
);

401 
__¬r__
=
	`PyA¼ay_FromAny
(
İ
,
desü
,1,
¿nk
-1,
NPY_ARRAY_CARRAY_RO
,
NULL
);

402 
	`PyE¼_CË¬
();

404 if(
__¬r__
)

406 
PyA¼ayObjeù
* 
¬r
=(PyA¼ayObjeù*)
__¬r__
;

407 
d•th
=
	`PyA¼ay_NDIM
(
¬r
);

408 
PyObjeù
** 
objs
=
¡©ic_ÿ¡
<PyObjeù**>(
	`PyA¼ay_DATA
(
¬r
));

409 * 
sz
=
	`PyA¼ay_DIMS
(
¬r
);

410 
this
->~
py_v¬
<
T
*>();

411 
Œy


413 
	`Ãw
 (
this
è
py_v¬
<
T
*>(
d•th
,
sz
,
objs
);

415 
	`ÿtch
()

417 
	`Py_DECREF
(
__¬r__
);

418 
throw
 1;

420 
	`Py_DECREF
(
__¬r__
);

423 
	`PyE¼_CË¬
();

426 
throw
 1;

427 
	}
}

431 
	g‹m¶©e
<
şass
 
	gT
>

432 
	gpy_v¬
<
	gT
*>::
	$py_v¬
(
PyObjeù
** 
İ_±r
):

433 
	`size
(0),

434 
	$v¬s
(
NULL
)

436 
size
=1;

437 
v¬s
=
Ãw
 
py_v¬
<
T
>[1];

438 
Œy


440 
v¬s
->~
py_v¬
<
T
>();

441 
	`Ãw
 (
v¬s
è
py_v¬
<
T
>(*
İ_±r
);

443 
	`ÿtch
()

445 
d–‘e
 [] 
v¬s
;

446 
throw
 1;

449 
size_t
 
dim
=0;

450 
dim
*(dim+1)/2<
v¬s
[0].
size
)

451 
dim
++;

453 if(
dim
*(dim+1)/2!=
v¬s
[0].
size
)

455 
d–‘e
 [] 
v¬s
;

456 
throw
 1;

458 
size
=
dim
;

460 
ty³Çme
 
	t¡d
::
	t»move_poš‹r
<
	tT
>::
	tty³
 
	tS
;

461 
py_v¬
<
S
*>* 
__v¬s
=
NULL
;

462 if(
size
è
__v¬s
=
Ãw
 
py_v¬
<
S
*>[size];

465 
size_t
 
i
=0;i<
size
;i++)

467 
__v¬s
[
i
].
size
=size;

468 
__v¬s
[
i
].
v¬s
=
Ãw
 
py_v¬
<
S
>[
size
];

470 
size_t
 
™
=0;

472 
size_t
 
i
=0;i<
size
;i++)

474 
__v¬s
[
i
][i]=
¡d
::
	`move
(
v¬s
[0][
™
++]);

477 
dœ
=-1;

478 
size_t
 
i
=
size
-1;i>0;i--)

480 if(
dœ
==-1)

481 
size_t
 
j
=
i
;j>0;j--)

483 
__v¬s
[
i
][
j
-1]=
¡d
::
	`move
(
v¬s
[0][
™
++]);

484 
__v¬s
[
j
-1][
i
]=__vars[i][j-1];

487 
size_t
 
j
=0;j<
i
;j++)

489 
__v¬s
[
i
][
j
]=
¡d
::
	`move
(
v¬s
[0][
™
++]);

490 
__v¬s
[
j
][
i
]=__vars[i][j];

493 
dœ
*=-1;

496 
d–‘e
 [] 
v¬s
;

497 
v¬s
=
__v¬s
;

498 
	}
}

502 
	g‹m¶©e
<
şass
 
	gT
>

503 
	gpy_v¬
<
	gT
*>::
	$py_v¬
(
size_t
* 
sz
,*& 
d©a
):

504 
	`size
(*
sz
),

505 
	$v¬s
(
NULL
)

507 if(
¡d
::
is_§me
<
T
,>::
v®ue
)

509 * 
d
=
¡©ic_ÿ¡
<*>(
d©a
);

510 
d
[
size
-1]=='\0') size--;

511 
size
++;

512 if(
size
è
v¬s
=
Ãw
 
py_v¬
<
T
>[size];

513 
size_t
 
i
=0;i<
size
-1;i++)

515 (
v¬s
+
i
)-> ~
py_v¬
<
T
>();

516 
	`Ãw
 (
v¬s
+
i
è
py_v¬
<
T
>(
sz
+1,
d©a
);

519 
nuÎ_ch¬
='\0';

520 * 
_d©a
=&
nuÎ_ch¬
;

521 (
v¬s
+
size
-1)-> ~
py_v¬
<
T
>();

522 
	`Ãw
 (
v¬s
+
size
-1è
py_v¬
<
T
>(
sz
+1,
_d©a
);

526 if(
size
è
v¬s
=
Ãw
 
py_v¬
<
T
>[size];

527 
size_t
 
i
=0;i<
size
;i++)

529 (
v¬s
+
i
)-> ~
py_v¬
<
T
>();

530 
	`Ãw
 (
v¬s
+
i
è
py_v¬
<
T
>(
sz
+1,
d©a
);

533 
	}
}

537 
	g‹m¶©e
<
şass
 
	gT
>

538 
	gpy_v¬
<
	gT
*>::
	$py_v¬
(
d•th
,* 
sz
,
PyObjeù
**& 
objs
):

539 
	`size
(0),

540 
	$v¬s
(
NULL
)

542 if(
d•th
==0)

544 
this
->~
py_v¬
<
T
*>();

545 
Œy


547 
	`Ãw
 (
this
è
py_v¬
<
T
*>(*
objs
);

549 
	`ÿtch
()

551 
d–‘e
 [] 
v¬s
;

552 
throw
 1;

554 
objs
++;

559 
size
=*
sz
;

560 if(
size
è
v¬s
=
Ãw
 
py_v¬
<
T
>[*
sz
];

561 
size_t
 
i
=0;i<
size
;i++)

563 
Œy


565 (
v¬s
+
i
)->~
py_v¬
<
T
>();

566 
	`Ãw
 (
v¬s
+
i
è
py_v¬
<
T
>(
d•th
-1,
sz
+1,
objs
);

568 
	`ÿtch
()

570 
d–‘e
 [] 
v¬s
;

571 
throw
 1;

576 
	}
}

580 
	g‹m¶©e
<
şass
 
	gT
>

581 
	gpy_v¬
<
	gT
*>::~
	$py_v¬
()

583 
d–‘e
 [] 
v¬s
;

584 
	}
}

588 
	g‹m¶©e
<
şass
 
	gT
>

589 
	gpy_v¬
<
	gT
*>::
py_v¬
(cÚ¡…y_v¬<
T
*>& 
r
):

590 
	$v¬s
(
NULL
)

592 
size
=
r
.size;

593 if(
size
è
v¬s
=
Ãw
 
py_v¬
<
T
>[size];

594 
size_t
 
i
=0;i<
size
;i++)

595 
v¬s
[
i
]=
r
.vars[i];

596 
	}
}

600 
	g‹m¶©e
<
şass
 
	gT
>

601 
	gpy_v¬
<
	gT
*>&…y_v¬<T*>::
İ”©Ü
=(cÚ¡ 
py_v¬
<
T
*>& 
r
)

603 
d–‘e
 [] 
this
->
v¬s
;

604 
	gthis
->
	gv¬s
=
NULL
;

605 
	gthis
->
	gsize
=
r
.
size
;

606 if(
	gthis
->
	gsize
èthis->
	gv¬s
=
Ãw
 
py_v¬
<
T
>[
size
];

607 
size_t
 
	gi
=0;i<
	gthis
->
	gsize
;i++)

608 
	gthis
->
	gv¬s
[
i
]=
r
.
v¬s
[i];

609  *
	gthis
;

614 
	g‹m¶©e
<
şass
 
	gT
>

615 
	gpy_v¬
<
	gT
*>::
py_v¬
Õy_v¬<
T
*>&& 
r
)

617 
size
=
r
.size;

618 
	gr
.
	gsize
=0;

619 
	gv¬s
=
r
.
v¬s
;

620 
	gr
.
	gv¬s
=
NULL
;

625 
	g‹m¶©e
<
şass
 
	gT
>

626 
	gpy_v¬
<
	gT
*>&…y_v¬<T*>::
İ”©Ü
=(
py_v¬
<
T
*>&& 
r
)

628 
d–‘e
 [] 
this
->
v¬s
;

629 
	gthis
->
	gv¬s
=
NULL
;

630 
	gthis
->
	gsize
=
r
.
size
;

631 
	gr
.
	gsize
=0;

632 
	gthis
->
	gv¬s
=
r
.
v¬s
;

633 
	gr
.
	gv¬s
=
NULL
;

634  *
	gthis
;

639 
	g‹m¶©e
<
şass
 
	gT
>

640 
boŞ
 
	gpy_v¬
<
	gT
*>::
İ”©Ü
==(cÚ¡ 
py_v¬
<
T
*>& 
r
)

642 if(
this
->
size
!=
r
.sizeè 
çl£
;

643 
size_t
 
	gi
=0;i<
	gsize
;i++)

644 if(!(
	gthis
->
	gv¬s
[
i
]==
r
.
v¬s
[i])è 
çl£
;

645  
	gŒue
;

650 
	g‹m¶©e
<
şass
 
	gT
>

651 
	gpy_v¬
<
	gT
>&…y_v¬<T*>::
İ”©Ü
[](cÚ¡ 
size_t
 
i
)

653  
v¬s
[
i
];

658 
	g‹m¶©e
<
şass
 
	gT
>

659 
boŞ
 
	gpy_v¬
<
	gT
*>::
	$is_sq
()

661 if(
	`g‘_¿nk
()==1è 
Œue
;

662 
size_t
 
i
=0;i<
size
;i++)

664 if(
v¬s
[
i
].
	`g‘_size
()!=
size
è 
çl£
;

665 if(!
v¬s
[
i
].
	`is_sq
()è 
çl£
;

667  
Œue
;

668 
	}
}

672 
	g‹m¶©e
<
şass
 
	gT
>

673 
boŞ
 
	gpy_v¬
<
	gT
*>::
	$is_sq
(
size_t
 
__size
)

675 if(
size
!=
__size
è 
çl£
;

676  
	`is_sq
();

677 
	}
}

681 
	g‹m¶©e
<
şass
 
	gT
>

682 
boŞ
 
	gpy_v¬
<
	gT
*>::
	$is_squ¬e
()

684 if(
	`g‘_¿nk
()<2è 
çl£
;

685 
size_t
 
i
=0;i<
size
;i++)

686 if(
v¬s
[
i
].
size
!=sizeè 
çl£
;

687  
Œue
;

688 
	}
}

692 
	g‹m¶©e
<
şass
 
	gT
>

693 
boŞ
 
	gpy_v¬
<
	gT
*>::
	$is_squ¬e
(
size_t
 
__size
)

695 if(
size
!=
__size
è 
çl£
;

696  
	`is_squ¬e
();

697 
	}
}

701 
	g‹m¶©e
<
şass
 
	gT
>

702 
boŞ
 
	gpy_v¬
<
	gT
*>::
	$is_ŒŸnguÏr
()

704 if(
	`g‘_¿nk
()<2è 
çl£
;

705 
size_t
 
i
=0;i<
size
;i++)

706 if(
v¬s
[
i
].
size
!=i+1è 
çl£
;

707  
Œue
;

708 
	}
}

712 
	g‹m¶©e
<
şass
 
	gT
>

713 
boŞ
 
	gpy_v¬
<
	gT
*>::
	$is_ŒŸnguÏr
(
size_t
 
__size
)

715 if(
size
!=
__size
è 
çl£
;

716  
	`is_ŒŸnguÏr
();

717 
	}
}

721 
	g‹m¶©e
<
şass
 
	gT
>

722 
boŞ
 
	gpy_v¬
<
	gT
*>::
	$is_symm‘ric
()

724 if(
	`is_ŒŸnguÏr
())

726 
	`ŒŸnguÏr_to_symm‘ric
();

727  
Œue
;

730 if(!
	`is_squ¬e
()è 
çl£
;

731 
size_t
 
i
=0;i<
size
;i++)

732 
size_t
 
j
=0;j<
i
;j++)

733 if(!(
v¬s
[
i
][
j
]==vars[j][i]))

734  
çl£
;

735  
Œue
;

736 
	}
}

740 
	g‹m¶©e
<
şass
 
	gT
>

741 
boŞ
 
	gpy_v¬
<
	gT
*>::
	$is_symm‘ric
(
size_t
 
__size
)

743 if(
size
!=
__size
è 
çl£
;

744  
	`is_symm‘ric
();

745 
	}
}

749 
	g‹m¶©e
<
şass
 
	gT
>

750 
boŞ
 
	gpy_v¬
<
	gT
*>::
	$is_low”_ŒŸnguÏr
()

752 if(
	`is_ŒŸnguÏr
())

754 
	`ŒŸnguÏr_to_low”_ŒŸnguÏr
();

755  
Œue
;

758 if(!
	`is_squ¬e
()è 
çl£
;

759 
ty³Çme
 
	t¡d
::
	t»move_poš‹r
<
	tT
>::
	tty³
 
	tS
;

760 
py_v¬
<
S
> 
nuÎ_v¬
;

761 
size_t
 
i
=0;i<
size
;i++)

762 
size_t
 
j
=0;j<
i
;j++)

763 if(!(
v¬s
[
j
][
i
]==
nuÎ_v¬
))

764  
çl£
;

765  
Œue
;

766 
	}
}

770 
	g‹m¶©e
<
şass
 
	gT
>

771 
boŞ
 
	gpy_v¬
<
	gT
*>::
	$is_low”_ŒŸnguÏr
(
size_t
 
__size
)

773 if(
size
!=
__size
è 
çl£
;

774  
	`is_low”_ŒŸnguÏr
();

775 
	}
}

779 
	g‹m¶©e
<
şass
 
	gT
>

780 
boŞ
 
	gpy_v¬
<
	gT
*>::
	$is_uµ”_ŒŸnguÏr
()

782 if(
	`is_ŒŸnguÏr
())

784 
	`ŒŸnguÏr_to_uµ”_ŒŸnguÏr
();

785  
Œue
;

788 if(!
	`is_squ¬e
()è 
çl£
;

789 
ty³Çme
 
	t¡d
::
	t»move_poš‹r
<
	tT
>::
	tty³
 
	tS
;

790 
py_v¬
<
S
> 
nuÎ_v¬
;

791 
size_t
 
i
=0;i<
size
;i++)

792 
size_t
 
j
=0;j<
i
;j++)

793 if(!(
v¬s
[
i
][
j
]==
nuÎ_v¬
))

794  
çl£
;

795  
Œue
;

796 
	}
}

800 
	g‹m¶©e
<
şass
 
	gT
>

801 
boŞ
 
	gpy_v¬
<
	gT
*>::
	$is_uµ”_ŒŸnguÏr
(
size_t
 
__size
)

803 if(
size
!=
__size
è 
çl£
;

804  
	`is_uµ”_ŒŸnguÏr
();

805 
	}
}

809 
	g‹m¶©e
<
şass
 
	gT
>

810 
	gpy_v¬
<
	gT
*>::
	$ŒŸnguÏr_to_symm‘ric
()

812 
ty³Çme
 
	t¡d
::
	t»move_poš‹r
<
	tT
>::
	tty³
 
	tS
;

813 
py_v¬
<
S
*>* 
__v¬s
=
NULL
;

814 if(
size
è
__v¬s
=
Ãw
 
py_v¬
<
S
*>[size];

817 
size_t
 
i
=0;i<
size
;i++)

819 
__v¬s
[
i
].
size
=size;

820 
__v¬s
[
i
].
v¬s
=
Ãw
 
py_v¬
<
S
>[
size
];

821 
size_t
 
j
=0;j<=
i
;j++)

822 
__v¬s
[
i
][
j
]=
¡d
::
	`move
(
v¬s
[i][j]);

825 
size_t
 
i
=0;i<
size
;i++)

826 
size_t
 
j
=
i
+1;j<
size
;j++)

827 
__v¬s
[
i
][
j
]=__vars[j][i];

829 
d–‘e
 [] 
v¬s
;

830 
v¬s
=
__v¬s
;

831 
	}
}

835 
	g‹m¶©e
<
şass
 
	gT
>

836 
	gpy_v¬
<
	gT
*>::
	$ŒŸnguÏr_to_low”_ŒŸnguÏr
()

838 
ty³Çme
 
	t¡d
::
	t»move_poš‹r
<
	tT
>::
	tty³
 
	tS
;

839 
py_v¬
<
S
*>* 
__v¬s
=
NULL
;

840 if(
size
è
__v¬s
=
Ãw
 
py_v¬
<
S
*>[size];

843 
size_t
 
i
=0;i<
size
;i++)

845 
__v¬s
[
i
].
size
=size;

846 
__v¬s
[
i
].
v¬s
=
Ãw
 
py_v¬
<
S
>[
size
];

847 
size_t
 
j
=0;j<=
i
;j++)

848 
__v¬s
[
i
][
j
]=
¡d
::
	`move
(
v¬s
[i][j]);

851 
d–‘e
 [] 
v¬s
;

852 
v¬s
=
__v¬s
;

853 
	}
}

857 
	g‹m¶©e
<
şass
 
	gT
>

858 
	gpy_v¬
<
	gT
*>::
	$ŒŸnguÏr_to_uµ”_ŒŸnguÏr
()

860 
ty³Çme
 
	t¡d
::
	t»move_poš‹r
<
	tT
>::
	tty³
 
	tS
;

861 
py_v¬
<
S
*>* 
__v¬s
=
NULL
;

862 if(
size
è
__v¬s
=
Ãw
 
py_v¬
<
S
*>[size];

865 
size_t
 
i
=0;i<
size
;i++)

867 
__v¬s
[
i
].
size
=size;

868 
__v¬s
[
i
].
v¬s
=
Ãw
 
py_v¬
<
S
>[
size
];

869 
size_t
 
j
=0;j<=
i
;j++)

870 
__v¬s
[
j
][
i
]=
¡d
::
	`move
(
v¬s
[i][j]);

873 
d–‘e
 [] 
v¬s
;

874 
v¬s
=
__v¬s
;

875 
	}
}

879 
	g‹m¶©e
<
şass
 
	gT
>

880 
	g¡d
::
¡ršg
 
py_v¬
<
T
*>::
	$”r_msg
()

882 
cÚ¡ex´
 
¿nk
=
	`g‘_¿nk
();

883 
¡d
::
¡ršg
 
”r
="fŸlu»Ødeduû C++y³ <"+
ty³_©Œ
<
T_BASE
>::
Çme
+"[]";

885 
i
=1;i<
¿nk
;i++è
”r
+="[]";

886 
”r
+=">";

887  
”r
;

888 
	}
}

892 
	g‹m¶©e
<
şass
 
	gT
>

893 cÚ¡ 
	g¡d
::
¡ršg
 
py_v¬
<
T
*>::
	$ty³_Çme
()

895 
cÚ¡ex´
 
¿nk
=
	`g‘_¿nk
();

896 
¡d
::
¡ršg
 
”r
=
ty³_©Œ
<
T_BASE
>::
	`Çme
()+"*";

897 
i
=1;i<
¿nk
;i++è
”r
+="*";

898  
”r
;

899 
	}
}

903 
Çme¥aû
 
	gMAPP_NS


905 
	g‹m¶©e
<
	gşass
> 
şass
 
	gv¬
;

906 şas 
	cV¬


908 
	g´iv©e
:

909 
boŞ
 
pushed
;

910 
	g´Ùeùed
:

911 
vœtu®
 cÚ¡ * 
g‘_±r
()=0;

912 
boŞ
 
	groÙ
;

913 
size_t
** 
size_li¡
();

914 
size_li¡
(
size_t
*);

915 
size_li¡
(
size_t
**);

916 
	gpublic
:

917 
V¬
** 
v¬_¡ack
;

918 
size_t
 
	g¡ack_size
;

919 
size_t
 
	g¡ack_ÿ·c™y
;

920 
size_t
 
	g¡ack_grow
;

921 
push
(
V¬
*);

922 
pİ
(
V¬
*);

923 
»¶aû
(
V¬
*,Var*);

924 
	g‹m¶©e
<
şass
 
	gT
>

925 
V¬
* 
fšd_v¬
(
T
&);

927 
	g‹m¶©e
<
şass
 
	gT
,
	gşass
...
	gTs
>

928 
assign_dyÇmic_size
(
T
**,
size_t
&,
Ts
&&...);

929 
	g‹m¶©e
<
şass
 
	gT
,
	gşass
...
	gTs
>

930 
assign_dyÇmic_size
(
T
**,
size_t
&&,
Ts
&&...);

931 
	g‹m¶©e
<
şass
 
	gT
>

932 
assign_dyÇmic_size
(
T
**){}

934 
boŞ
 
	gobj_£t
;

935 cÚ¡ 
	g¿nk
;

936 cÚ¡ 
size_t
 
	ghash_code
;

937 
size_t
 
	gsize
;

938 
	g¡d
::
¡ršg
 
Çme
;

941 
V¬
(,
size_t
,const *);

942 
V¬
(,
size_t
,cÚ¡ 
¡d
::
¡ršg
&);

943 
V¬
(,
size_t
,
¡d
::
¡ršg
&&);

944 
V¬
(,
size_t
);

945 
	gvœtu®
 ~
V¬
();

946 
V¬
(const Var&);

947 
V¬
(Var&&);

948 
vœtu®
 
V¬
* 
şÚe
()=0;

950 
vœtu®
 
£t
(
PyObjeù
*)=0;

951 
vœtu®
 
boŞ
 
£t_nÙhrow
(
PyObjeù
*)=0;

952 
vœtu®
 
PyObjeù
* 
g‘
()=0;

953 
vœtu®
 
	gV¬
& 
	gİ”©Ü
 [] (cÚ¡ 
	gsize_t
)=0;

955 
size_t
* 
is_¬¿y
(const );

956 
size_t
 
is_squ¬e
();

957 
size_t
 
is_ŒŸnguÏr
();

959 
boŞ
 
is_£t
();

960 
boŞ
 
b–Úgs_to
(
V¬
&);

961 
vœtu®
 
boŞ
 
	gİ”©Ü
 =ğ(
V¬
&);

962 
vœtu®
 
boŞ
 
	gİ”©Ü
 !ğ(
V¬
&);

963 
vœtu®
 
boŞ
 
	gİ”©Ü
 > (
	gV¬
&);

964 
vœtu®
 
boŞ
 
	gİ”©Ü
 >ğ(
V¬
&);

965 
vœtu®
 
boŞ
 
	gİ”©Ü
 <ğ(
V¬
&);

966 
vœtu®
 
boŞ
 
	gİ”©Ü
 < (
	gV¬
&);

971 
	g‹m¶©e
<
şass
 
	gLogics
>

972 
log_chek
(
Logics
* 
logics
);

978 
	g‹m¶©e
<
şass
 
	gLogics
>

979 
	gV¬
::
	$log_chek
(
Logics
* 
logics
)

981 
¡d
::
¡ršg
 
”r_msg
=(*
logics
)(
this
);

982 if(!
”r_msg
.
	`em±y
()è
throw
ƒrr_msg;

983 if(
¿nk
)

984 
size_t
 
i
=0;i<
size
;i++)

985 (*
this
)[
i
].
	`log_chek
(
logics
+1);

986 
	}
}

990 
	g‹m¶©e
<
şass
 
	gT
>

991 
V¬
* 
	gV¬
::
	$fšd_v¬
(
T
& 
v®
)

993 if(!
¡ack_size
è 
NULL
;

994 
v¬_¿nk
=
v¬
<
T
>::
	`g‘_¿nk
();

995 cÚ¡ * 
±r
=&
v®
;

996 
size_t
 
iv¬
=
¡ack_size
-1;

997 ;
iv¬
!=0 && (
v¬_¡ack
[iv¬]->
	`g‘_±r
()!=
±r
 || v¬_¡ack[iv¬]->
¿nk
!=
v¬_¿nk
) ;ivar--);

998 if(
iv¬
è 
v¬_¡ack
[ivar];

999 if(
v¬_¡ack
[0]->
	`g‘_±r
()==
±r
 && v¬_¡ack[
iv¬
]->
¿nk
==
v¬_¿nk
)

1000  
v¬_¡ack
[0];

1001  
NULL
;

1002 
	}
}

1006 
	g‹m¶©e
<
şass
 
	gT
,
	gşass
...
	gTs
>

1007 
	gV¬
::
	$assign_dyÇmic_size
(
T
** 
__dsizes__
,
size_t
& 
sz
,
Ts
&&...
szs
)

1009 *
__dsizes__
=
»š‹½»t_ÿ¡
<
T
*>(
	`fšd_v¬
(
sz
));

1010 
	`assign_dyÇmic_size
(
__dsizes__
+1,
szs
...);

1011 
	}
}

1015 
	g‹m¶©e
<
şass
 
	gT
,
	gşass
...
	gTs
>

1016 
	gV¬
::
	$assign_dyÇmic_size
(
T
** 
__dsizes__
,
size_t
&&,
Ts
&&...
szs
)

1018 *
__dsizes__
=
NULL
;

1019 
	`assign_dyÇmic_size
(
__dsizes__
+1,
szs
...);

1020 
	}
}

1024 
Çme¥aû
 
	gMAPP_NS


1026 
	g‹m¶©e
<
şass
 
	gT
>

1027 şas 
	cv¬
: 
public
 
V¬


1029 
´iv©e
:

1030 
T
 
v®
;

1031 
	g´Ùeùed
:

1032 cÚ¡ * 
g‘_±r
();

1033 
	gpublic
:

1034 
ty³Çme
 
	t¡d
::
	t»move_cÚ¡
<
	tT
>::
	tty³
 
	tT_BASE
;

1035 
T_BASE
 
	tT_EQUIV
;

1036 
cÚ¡ex´
 
g‘_¿nk
();

1037 
size_t
 
ba£_hash_code
();

1038 
®loÿ‹
(**,
T
&,
size_t
*);

1039 
d—Îoÿ‹
(
T
&);

1040 
accum_size
(
py_v¬
<
T_EQUIV
>&,
size_t
*){};

1041 
boŞ
 
is_size_com·tibË_nÙhrow
(
py_v¬
<
T_EQUIV
>&,
v¬
<
size_t
>**);

1042 
is_size_com·tibË
(
py_v¬
<
T_EQUIV
>&,cÚ¡ 
¡d
::
¡ršg
&,
v¬
<
size_t
>**);

1043 
	g¡d
::
¡ršg
 
ty³_Çme
(
v¬
<
size_t
>**);

1044 
PyObjeù
* 
bud
(
T
&,
size_t
(**)=
NULL
);

1046 
T
* 
	g±r
;

1048 
v¬
(
T
&,const *);

1050 
v¬
(
T
&,
¡d
::
¡ršg
&&,
py_v¬
<
T_EQUIV
>&,**);

1051 
v¬
(
T
&,v¬<T>&,**,cÚ¡ 
size_t
*,const size_t);

1052 
v¬
();

1053 ~
v¬
();

1054 
v¬
(
T
&&);

1055 
v¬
(cÚ¡ v¬<
T
>&);

1056 
v¬
(v¬<
T
>&&);

1057 
	gv¬
<
	gT
>& 
	gİ”©Ü
=(cÚ¡ 
v¬
<
T
>&);

1058 
	gv¬
<
	gT
>& 
	gİ”©Ü
=(
v¬
<
T
>&&);

1059 
	gv¬
<
	gT
>& 
	gİ”©Ü
=(cÚ¡ 
T
&);

1060 
V¬
* 
şÚe
();

1062 
İ”©Ü
 
T
() const;

1063 
	gv¬
<
	gT
>& 
	gİ”©Ü
 [] (cÚ¡ 
	gsize_t
);

1064 
£t
(
PyObjeù
*);

1065 
boŞ
 
£t_nÙhrow
(
PyObjeù
*);

1066 
PyObjeù
* 
g‘
();

1068 
	g¡d
::
¡ršg
 
ty³_Çme
(){ 
ty³_©Œ
<
T_BASE
>::
Çme
;}

1070 
boŞ
 
	gİ”©Ü
==(
V¬
&);

1071 
boŞ
 
	gİ”©Ü
!=(
V¬
&);

1072 
boŞ
 
	gİ”©Ü
> (
	gV¬
&);

1073 
boŞ
 
	gİ”©Ü
< (
	gV¬
&);

1074 
boŞ
 
	gİ”©Ü
>=(
V¬
&);

1075 
boŞ
 
	gİ”©Ü
<=(
V¬
&);

1082 
	g‹m¶©e
 <
şass
 
	gT
>

1083 
cÚ¡ex´
 
	gv¬
<
	gT
>::
	$g‘_¿nk
()

1086 
	}
}

1090 
	g‹m¶©e
 <
şass
 
	gT
>

1091 
size_t
 
	gv¬
<
	gT
>::
	$ba£_hash_code
()

1095 
	}
}

1099 
	g‹m¶©e
 <
şass
 
	gT
>

1100 
	gv¬
<
	gT
>::
	$®loÿ‹
(**,
T
&,
size_t
*)

1101 {
	}
}

1105 
	g‹m¶©e
 <
şass
 
	gT
>

1106 
	gv¬
<
	gT
>::
	$d—Îoÿ‹
(
T
&)

1107 {
	}
}

1111 
‹m¶©e
 <
şass
 
T
>

1112 
boŞ
 
v¬
<
T
>::
is_size_com·tibË_nÙhrow
(
py_v¬
<
T_EQUIV
>&,v¬<
size_t
>**)

1114  
	gŒue
;

1119 
	g‹m¶©e
 <
şass
 
	gT
>

1120 
	gv¬
<
	gT
>::
is_size_com·tibË
(
py_v¬
<
T_EQUIV
>&,cÚ¡ 
¡d
::
¡ršg
&,
v¬
<
size_t
>**)

1126 
	g‹m¶©e
 <
şass
 
	gT
>

1127 
	g¡d
::
¡ršg
 
v¬
<
T
>::
ty³_Çme
(v¬<
size_t
>**)

1129  
¡d
::
¡ršg
();

1134 
	g‹m¶©e
<
şass
 
	gT
>

1135 
PyObjeù
* 
	gv¬
<
	gT
>::
	$bud
(
T
& 
v
,
size_t
**)

1138 if(
¡d
::
is_š‹g¿l
<
T_BASE
>::
v®ue
)

1140 
i
=0;

1141 if(
¡d
::
is_§me
<
T_BASE
,
boŞ
>::
v®ue
)

1143 if(
v
è
i
=1;

1144  
	`PyBoŞ_FromLÚg
(
i
);

1148 
i
=
¡©ic_ÿ¡
<>(
v
);

1149  
	`PyLÚg_FromLÚg
(
i
);

1155 
i
=
¡©ic_ÿ¡
<>(
v
);

1156  
	`PyFlßt_FromDoubË
(
i
);

1158 
Py_RETURN_NONE
;

1159 
	}
}

1163 
	g‹m¶©e
<>

1164 
šlše
 
PyObjeù
* 
	gv¬
<
	g¡d
::
¡ršg
>::
	$bud
(
¡d
::
¡ršg
& 
v
,
size_t
**)

1165 { 
	`__PySŒšg_FromSŒšg
(
v
.
	`c_¡r
());
	}
}

1170 
	g‹m¶©e
<
şass
 
	gT
>

1171 
	gv¬
<
	gT
>::
	$v¬
(
T
& 
v
,cÚ¡ * 
Çme_
):

1172 
	`v®
(
ty³_©Œ
<
T
>::
z”o
),

1173 
	`±r
(&
v
),

1174 
	`V¬
(
	`g‘_¿nk
(),
	`ba£_hash_code
(),
Çme_
)

1176 
size
=1;

1177 
	}
}

1183 
	g‹m¶©e
<
şass
 
	gT
>

1184 
	gv¬
<
	gT
>::
v¬
(
T
& 
v
,
¡d
::
¡ršg
&& 
Çme_
,
py_v¬
<
T_EQUIV
>& 
pv
,**):

1185 
v®
(
ty³_©Œ
<
T
>::
z”o
),

1186 
±r
(&
v
),

1187 
V¬
(
g‘_¿nk
(),
ba£_hash_code
(),
¡d
::
	$move
(
Çme_
))

1189 
size
=1;

1190 
v
=
pv
;

1191 
	}
}

1197 
	g‹m¶©e
<
şass
 
	gT
>

1198 
	gv¬
<
	gT
>::
v¬
(
T
& 
v
,v¬<T>& 
__v¬
,**,cÚ¡ 
size_t
*,const size_t):

1199 
v®
(
ty³_©Œ
<
T
>::
z”o
),

1200 
±r
(&
v
),

1201 
V¬
(
g‘_¿nk
(),
ba£_hash_code
(),
__v¬
.
Çme
)

1203 
	gsize
=1;

1204 *
	g±r
=*
__v¬
.
±r
;

1211 
	g‹m¶©e
<
şass
 
	gT
>

1212 
	gv¬
<
	gT
>::
	$v¬
():

1213 
	`±r
(
NULL
),

1214 
	`V¬
(
	`g‘_¿nk
(),
	`ba£_hash_code
()),

1215 
	`v®
(
ty³_©Œ
<
T
>::
z”o
)

1217 
size
=0;

1218 
	}
}

1222 
	g‹m¶©e
<
şass
 
	gT
>

1223 
	gv¬
<
	gT
>::~
	$v¬
()

1225 
	}
}

1232 
‹m¶©e
<
şass
 
T
>

1233 
v¬
<
T
>::
	$v¬
(
T
&& 
v
):

1234 
	`v®
(
v
),

1235 
	`±r
(&
v®
),

1236 
	`V¬
(
	`g‘_¿nk
(),
	$ba£_hash_code
())

1238 
size
=1;

1239 
Çme
=
Pršt
::
	`to_¡ršg
(
v®
);

1240 
	}
}

1244 
	g‹m¶©e
<
şass
 
	gT
>

1245 
	gv¬
<
	gT
>::
v¬
(cÚ¡ v¬<
T
>& 
r
):

1246 
V¬
(
¡©ic_ÿ¡
<cÚ¡ V¬&>(
r
)),

1247 
v®
(
r
.val),

1248 
±r
(
r
.±r==&Ô.
v®
)?&val:r.ptr)

1255 
‹m¶©e
<
şass
 
T
>

1256 
v¬
<
T
>::v¬(v¬<T>&& 
r
):

1257 
V¬
(
¡©ic_ÿ¡
<V¬&&>(
r
)),

1258 
v®
(
r
.val),

1259 
±r
(
r
.±r==&Ô.
v®
)?&val:r.ptr)

1261 
r
.
±r
=
NULL
;

1266 
	g‹m¶©e
<
şass
 
	gT
>

1267 
	gv¬
<
	gT
>& v¬<T>::
İ”©Ü
=(cÚ¡ 
v¬
<
T
>& 
r
)

1269 if(
this
==&
r
)  *this;

1270 
	gthis
->~
	gv¬
<
	gT
>();

1271 
Ãw
 (
this
è
	gv¬
<
	gT
>(
	gr
);

1272  *
	gthis
;

1277 
	g‹m¶©e
<
şass
 
	gT
>

1278 
	gv¬
<
	gT
>& v¬<T>::
İ”©Ü
=(
v¬
<
T
>&& 
r
)

1280 if(
this
==&
r
)  *this;

1281 
	gthis
->~
	gv¬
<
	gT
>();

1282 
Ãw
 (
this
è
	gv¬
<
	gT
>(
	g¡d
::
move
(
r
));

1283  *
	gthis
;

1288 
	g‹m¶©e
<
şass
 
	gT
>

1289 
	gv¬
<
	gT
>& v¬<T>::
İ”©Ü
 = (cÚ¡ 
T
& 
v
)

1291 
ty³Çme
 
	t¡d
::
	t»move_cÚ¡
<
	tT
>::
	tty³
 
	tS
;

1292 *
	gcÚ¡_ÿ¡
<
	gS
*>(
	g±r
)=
v
;

1293  *
	gthis
;

1298 
	g‹m¶©e
<
şass
 
	gT
>

1299 
V¬
* 
	gv¬
<
	gT
>::
	$şÚe
()

1301  
Ãw
 
v¬
<
T
>(*
this
);

1302 
	}
}

1306 
	g‹m¶©e
<
şass
 
	gT
>

1307 cÚ¡ * 
	gv¬
<
	gT
>::
	$g‘_±r
()

1309  
±r
;

1310 
	}
}

1314 
	g‹m¶©e
<
şass
 
	gT
>

1315 
	gv¬
<
	gT
>::
İ”©Ü
 
	$T
() const

1317  *
±r
;

1318 
	}
}

1322 
	g‹m¶©e
<
şass
 
	gT
>

1323 
	gv¬
<
	gT
>& v¬<T>::
İ”©Ü
[](cÚ¡ 
size_t
)

1325  *
this
;

1330 
	g‹m¶©e
<
şass
 
	gT
>

1331 
	gv¬
<
	gT
>::
	$£t
(
PyObjeù
* 
py_obj
)

1333 
py_v¬
<
T_EQUIV
> 
pv
;

1334 
Œy


1336 
pv
=
py_v¬
<
T_EQUIV
>(
py_obj
);

1338 
	`ÿtch
()

1340 
throw
 "fŸlu»Ødeduû C++y³ <"+
py_v¬
<
T_EQUIV
>::
	`ty³_Çme
()+">";

1342 *
±r
=
pv
;

1343 
	}
}

1347 
	g‹m¶©e
<
şass
 
	gT
>

1348 
boŞ
 
	gv¬
<
	gT
>::
	$£t_nÙhrow
(
PyObjeù
* 
py_obj
)

1350 
py_v¬
<
T_EQUIV
> 
pv
;

1351 
Œy


1353 
pv
=
py_v¬
<
T_EQUIV
>(
py_obj
);

1355 
	`ÿtch
()

1357  
çl£
;

1359 *
±r
=
pv
;

1360  
Œue
;

1361 
	}
}

1365 
	g‹m¶©e
<
şass
 
	gT
>

1366 
PyObjeù
* 
	gv¬
<
	gT
>::
	$g‘
()

1368 if(
¡d
::
is_š‹g¿l
<
T_BASE
>::
v®ue
)

1370 
i
=0;

1371 if(
¡d
::
is_§me
<
T_BASE
,
boŞ
>::
v®ue
)

1373 if(*
±r
è
i
=1;

1374  
	`PyBoŞ_FromLÚg
(
i
);

1378 
i
=
¡©ic_ÿ¡
<>(*
±r
);

1379  
	`PyLÚg_FromLÚg
(
i
);

1384 
i
=
¡©ic_ÿ¡
<>(*
±r
);

1385  
	`PyFlßt_FromDoubË
(
i
);

1387 
Py_RETURN_NONE
;

1388 
	}
}

1392 
	g‹m¶©e
<>

1393 
šlše
 
PyObjeù
* 
	gv¬
<
	g¡d
::
¡ršg
>::
	$g‘
()

1394 { 
	`__PySŒšg_FromSŒšg
(
±r
->
	`c_¡r
());
	}
}

1398 
	g‹m¶©e
<
şass
 
	gT
>

1399 
boŞ
 
	gv¬
<
	gT
>::
İ”©Ü
 =ğ(
V¬
& 
r
)

1401 
v¬
<
T
>* 
v¬_±r0
=
dyÇmic_ÿ¡
<v¬<T>*>(&
r
);

1402 if(
	gv¬_±r0
)

1403  (*
	g±r
==*(
v¬_±r0
->
±r
));

1405 if(
	g¡d
::
is_cÚ¡
<
T
>::
v®ue
)

1407 
ty³Çme
 
	t¡d
::
	t»move_cÚ¡
<
	tT
>::
	tty³
 
	tS
;

1408 
	gv¬
<
	gS
>* 
	gv¬_±r0
=
dyÇmic_ÿ¡
<
v¬
<
S
>*>(&
r
);

1409 if(
	gv¬_±r0
)

1410  (*
	g±r
==*(
v¬_±r0
->
±r
));

1414 
	gv¬
<cÚ¡ 
	gT
>* 
	gv¬_±r0
=
dyÇmic_ÿ¡
<
v¬
<cÚ¡ 
T
>*>(&
r
);

1415 if(
	gv¬_±r0
)

1416  (*
	g±r
==*(
v¬_±r0
->
±r
));

1418  
	gçl£
;

1423 
	g‹m¶©e
<
şass
 
	gT
>

1424 
boŞ
 
	gv¬
<
	gT
>::
İ”©Ü
!=(
V¬
& 
r
)

1426 
v¬
<
T
>* 
v¬_±r0
=
dyÇmic_ÿ¡
<v¬<T>*>(&
r
);

1427 if(
	gv¬_±r0
)

1428  (*
	g±r
!=*(
v¬_±r0
->
±r
));

1430 if(
	g¡d
::
is_cÚ¡
<
T
>::
v®ue
)

1432 
ty³Çme
 
	t¡d
::
	t»move_cÚ¡
<
	tT
>::
	tty³
 
	tS
;

1433 
	gv¬
<
	gS
>* 
	gv¬_±r0
=
dyÇmic_ÿ¡
<
v¬
<
S
>*>(&
r
);

1434 if(
	gv¬_±r0
)

1435  (*
	g±r
!=*(
v¬_±r0
->
±r
));

1439 
	gv¬
<cÚ¡ 
	gT
>* 
	gv¬_±r0
=
dyÇmic_ÿ¡
<
v¬
<cÚ¡ 
T
>*>(&
r
);

1440 if(
	gv¬_±r0
)

1441  (*
	g±r
!=*(
v¬_±r0
->
±r
));

1443  
	gçl£
;

1448 
	g‹m¶©e
<
şass
 
	gT
>

1449 
boŞ
 
	gv¬
<
	gT
>::
İ”©Ü
>(
V¬
& 
r
)

1451 
v¬
<
T
>* 
v¬_±r0
=
dyÇmic_ÿ¡
<v¬<T>*>(&
r
);

1452 if(
	gv¬_±r0
)

1453  (*
	g±r
>*(
	gv¬_±r0
->ptr));

1455 if(
	g¡d
::
is_cÚ¡
<
T
>::
v®ue
)

1457 
ty³Çme
 
	t¡d
::
	t»move_cÚ¡
<
	tT
>::
	tty³
 
	tS
;

1458 
	gv¬
<
	gS
>* 
	gv¬_±r0
=
dyÇmic_ÿ¡
<
v¬
<
S
>*>(&
r
);

1459 if(
	gv¬_±r0
)

1460  (*
	g±r
>*(
	gv¬_±r0
->ptr));

1464 
	gv¬
<cÚ¡ 
	gT
>* 
	gv¬_±r0
=
dyÇmic_ÿ¡
<
v¬
<cÚ¡ 
T
>*>(&
r
);

1465 if(
	gv¬_±r0
)

1466  (*
	g±r
>*(
	gv¬_±r0
->ptr));

1468  
	gçl£
;

1473 
	g‹m¶©e
<
şass
 
	gT
>

1474 
boŞ
 
	gv¬
<
	gT
>::
İ”©Ü
<(
V¬
& 
r
)

1476 
v¬
<
T
>* 
v¬_±r0
=
dyÇmic_ÿ¡
<v¬<T>*>(&
r
);

1477 if(
	gv¬_±r0
)

1478  (*
	g±r
<*(
	gv¬_±r0
->ptr));

1480 if(
	g¡d
::
is_cÚ¡
<
T
>::
v®ue
)

1482 
ty³Çme
 
	t¡d
::
	t»move_cÚ¡
<
	tT
>::
	tty³
 
	tS
;

1483 
	gv¬
<
	gS
>* 
	gv¬_±r0
=
dyÇmic_ÿ¡
<
v¬
<
S
>*>(&
r
);

1484 if(
	gv¬_±r0
)

1485  (*
	g±r
<*(
	gv¬_±r0
->ptr));

1489 
	gv¬
<cÚ¡ 
	gT
>* 
	gv¬_±r0
=
dyÇmic_ÿ¡
<
v¬
<cÚ¡ 
T
>*>(&
r
);

1490 if(
	gv¬_±r0
)

1491  (*
	g±r
<*(
	gv¬_±r0
->ptr));

1493  
	gçl£
;

1498 
	g‹m¶©e
<
şass
 
	gT
>

1499 
boŞ
 
	gv¬
<
	gT
>::
İ”©Ü
>=(
V¬
& 
r
)

1501 
v¬
<
T
>* 
v¬_±r0
=
dyÇmic_ÿ¡
<v¬<T>*>(&
r
);

1502 if(
	gv¬_±r0
)

1503  (*
	g±r
>=*(
v¬_±r0
->
±r
));

1505 if(
	g¡d
::
is_cÚ¡
<
T
>::
v®ue
)

1507 
ty³Çme
 
	t¡d
::
	t»move_cÚ¡
<
	tT
>::
	tty³
 
	tS
;

1508 
	gv¬
<
	gS
>* 
	gv¬_±r0
=
dyÇmic_ÿ¡
<
v¬
<
S
>*>(&
r
);

1509 if(
	gv¬_±r0
)

1510  (*
	g±r
>=*(
v¬_±r0
->
±r
));

1514 
	gv¬
<cÚ¡ 
	gT
>* 
	gv¬_±r0
=
dyÇmic_ÿ¡
<
v¬
<cÚ¡ 
T
>*>(&
r
);

1515 if(
	gv¬_±r0
)

1516  (*
	g±r
>=*(
v¬_±r0
->
±r
));

1518  
	gçl£
;

1523 
	g‹m¶©e
<
şass
 
	gT
>

1524 
boŞ
 
	gv¬
<
	gT
>::
İ”©Ü
<=(
V¬
& 
r
)

1526 
v¬
<
T
>* 
v¬_±r0
=
dyÇmic_ÿ¡
<v¬<T>*>(&
r
);

1527 if(
	gv¬_±r0
)

1528  (*
	g±r
<=*(
v¬_±r0
->
±r
));

1530 if(
	g¡d
::
is_cÚ¡
<
T
>::
v®ue
)

1532 
ty³Çme
 
	t¡d
::
	t»move_cÚ¡
<
	tT
>::
	tty³
 
	tS
;

1533 
	gv¬
<
	gS
>* 
	gv¬_±r0
=
dyÇmic_ÿ¡
<
v¬
<
S
>*>(&
r
);

1534 if(
	gv¬_±r0
)

1535  (*
	g±r
<=*(
v¬_±r0
->
±r
));

1539 
	gv¬
<cÚ¡ 
	gT
>* 
	gv¬_±r0
=
dyÇmic_ÿ¡
<
v¬
<cÚ¡ 
T
>*>(&
r
);

1540 if(
	gv¬_±r0
)

1541  (*
	g±r
<=*(
v¬_±r0
->
±r
));

1543  
	gçl£
;

1548 
Çme¥aû
 
	gMAPP_NS


1550 
	g‹m¶©e
<
şass
 
	gT
,
size_t
 
	gN
>

1551 
şass
 
	gv¬
<
	gT
[
N
]>:
public
 
V¬


1553 
´iv©e
:

1554 
´Ùeùed
:

1555 
v¬
<
size_t
>** 
__dsizes__
;

1556 cÚ¡ * 
g‘_±r
();

1557 
	gpublic
:

1558 
ty³Çme
 
	tv¬
<
	tT
>::
	tT_BASE
 T_BASE;

1559 
ty³Çme
 
	t¡d
::
	tadd_poš‹r
<
	tty³Çme
 
	tv¬
<
	tT
>::
	tT_EQUIV
>::
	tty³
 T_EQUIV;

1560 
ty³Çme
 
	tıp_ty³
<
	tT
>::
	tty³
 
	tT_CPP
;

1561 
cÚ¡ex´
 
g‘_¿nk
();

1562 
size_t
 
ba£_hash_code
();

1563 
®loÿ‹
(**,
T_CPP
(&)[
N
],
size_t
*);

1564 
d—Îoÿ‹
(
T_CPP
(&)[
N
]);

1565 
accum_size
(
py_v¬
<
T_EQUIV
>&,
size_t
*);

1566 
boŞ
 
is_size_com·tibË_nÙhrow
(
py_v¬
<
T_EQUIV
>&,
v¬
<
size_t
>**);

1567 
is_size_com·tibË
(
py_v¬
<
T_EQUIV
>&,cÚ¡ 
¡d
::
¡ršg
&,
v¬
<
size_t
>**);

1568 
	g¡d
::
¡ršg
 
ty³_Çme
(
v¬
<
size_t
>**);

1569 
PyObjeù
* 
bud
(
T_CPP
(&)[
N
],
size_t
(**)=
NULL
);

1571 
	gv¬
<
	gT
> 
	gv¬s
[
N
];

1572 
T_CPP
 (*
±r
)[
N
];

1574 
v¬
(
T_CPP
(&)[
N
],const *);

1577 
v¬
(
T_CPP
(&)[
N
],
¡d
::
¡ršg
&&,
py_v¬
<
T_EQUIV
>&,**);

1578 
v¬
();

1579 
	gvœtu®
 ~
v¬
();

1580 
v¬
(
T_CPP
(&)[
N
]);

1581 
v¬
(cÚ¡ v¬<
T
[
N
]>&);

1582 
v¬
(v¬<
T
[
N
]>&&);

1583 
	gv¬
<
	gT
[
N
]>& 
	gİ”©Ü
 = (cÚ¡ 
v¬
<
T
[N]>&);

1584 
	gv¬
<
	gT
[
N
]>& 
	gİ”©Ü
 = (
v¬
<
T
[N]>&&);

1585 
	gv¬
<
	gT
[
N
]>& 
	gİ”©Ü
 = (cÚ¡ 
T_CPP
 (&)[N]);

1586 
V¬
* 
şÚe
();

1588 
	gv¬
<
	gT
>& 
	gİ”©Ü
 [] (cÚ¡ 
	gsize_t
);

1589 
£t
(
PyObjeù
*);

1590 
boŞ
 
£t_nÙhrow
(
PyObjeù
*);

1591 
£t
(
py_v¬
<
T_EQUIV
>&);

1592 
PyObjeù
* 
g‘
();

1593 
	g¡d
::
¡ršg
 
ty³_Çme
()

1594 { 
ty³_©Œ
<
T_BASE
>::
Çme
()+" "+
ty³_Çme
(
__dsizes__
);}

1595 
	g‹m¶©e
<
	gşass
 ... 
	gTs
>

1596 
dyÇmic_size
(
Ts
&&...);

1602 
	g‹m¶©e
 <
şass
 
	gT
,
size_t
 
	gN
>

1603 
cÚ¡ex´
 
	gv¬
<
	gT
[
N
]>::
	$g‘_¿nk
()

1605  1+
v¬
<
T
>::
	`g‘_¿nk
();

1606 
	}
}

1610 
	g‹m¶©e
 <
şass
 
	gT
,
size_t
 
	gN
>

1611 
size_t
 
	gv¬
<
	gT
[
N
]>::
	$ba£_hash_code
()

1615 
	}
}

1619 
	g‹m¶©e
 <
şass
 
	gT
,
size_t
 
	gN
>

1620 
	gv¬
<
	gT
[
N
]>::
®loÿ‹
(** 
±r
,
T_CPP
 (&
v
)[N],
size_t
* 
sz
)

1622 *
	g±r
=
NULL
;

1623 if(
g‘_¿nk
()==1) ;

1624 
	gv¬
<
	gT
>::
®loÿ‹
(
±r
+1,
v
[0],
sz
+1);

1629 
	g‹m¶©e
 <
şass
 
	gT
,
size_t
 
	gN
>

1630 
	gv¬
<
	gT
[
N
]>::
d—Îoÿ‹
(
T_CPP
 (&
v
)[N])

1632 
v¬
<
T
>::
d—Îoÿ‹
(
v
[0]);

1637 
	g‹m¶©e
 <
şass
 
	gT
,
size_t
 
	gN
>

1638 
	gv¬
<
	gT
[
N
]>::
accum_size
(
py_v¬
<
T_EQUIV
>& 
pv
,
size_t
* 
sz
)

1640 *
	gsz
+=
N
;

1641 if(
g‘_¿nk
()==1) ;

1642 
size_t
 
	gi
=0;i<
	gN
;i++)

1643 
	gv¬
<
	gT
>::
accum_size
(
pv
[
i
],
sz
+1);

1648 
	g‹m¶©e
 <
şass
 
	gT
,
size_t
 
	gN
>

1649 
boŞ
 
	gv¬
<
	gT
[
N
]>::
is_size_com·tibË_nÙhrow
(
py_v¬
<
T_EQUIV
>& 
pv
,
v¬
<
size_t
>** 
sz
)

1651 if(
	gN
!=
pv
.
size
)

1652  
çl£
;

1654 if(
	gsz
) sz+=1;

1656 
size_t
 
	gi
=0;i<
	gpv
.
	gsize
;i++)

1657 if(!
	gv¬
<
	gT
>::
is_size_com·tibË_nÙhrow
(
pv
[
i
],
sz
))

1658  
	gçl£
;

1660  
	gŒue
;

1665 
	g‹m¶©e
 <
şass
 
	gT
,
size_t
 
	gN
>

1666 
	gv¬
<
	gT
[
N
]>::
is_size_com·tibË
(
py_v¬
<
T_EQUIV
>& 
pv
,cÚ¡ 
¡d
::
¡ršg
& 
Çme
,
v¬
<
size_t
>** 
sz
)

1668 if(
	gN
!=
pv
.
size
)

1669 
throw
 "ex³ùed siz"+
Pršt
::
to_¡ršg
(
N
)+" fÜ‡rgum’ˆ'"+
Çme
+"'";

1671 if(
	gsz
) sz+=1;

1673 
size_t
 
	gi
=0;i<
	gpv
.
	gsize
;i++)

1675 
	gŒy


1677 
	gv¬
<
	gT
>::
is_size_com·tibË
(
pv
[
i
],
Çme
,
sz
);

1680 
ÿtch
(
¡d
::
¡ršg
& 
”r_msg
)

1682 
throw
 
”r_msg
+"["+
Pršt
::
to_¡ršg
(
i
)+"]";

1689 
	g‹m¶©e
<
şass
 
	gT
,
size_t
 
	gN
>

1690 
	g¡d
::
¡ršg
 
v¬
<
T
[
N
]>::
ty³_Çme
(v¬<
size_t
>** 
sz
)

1692 if(
sz
)

1693  
¡d
::
¡ršg
("[")+
Pršt
::
to_¡ršg
(
N
)

1694 +
¡d
::
¡ršg
("]")+
v¬
<
T
>::
ty³_Çme
(
sz
+1);

1695  
	g¡d
::
¡ršg
("[")+
Pršt
::
to_¡ršg
(
N
)

1696 +
¡d
::
¡ršg
("]")+
v¬
<
T
>::
ty³_Çme
(
sz
);

1701 
	g‹m¶©e
<
şass
 
	gT
,
size_t
 
	gN
>

1702 
PyObjeù
* 
	gv¬
<
	gT
[
N
]>::
bud
(
T_CPP
(&
v
)[N],
size_t
** 
sz
)

1705 
PyObjeù
* 
	gpy_obj
=
PyLi¡_New
(
N
);

1706 if(
	gsz
)

1708 
size_t
 
	gi
=0;i<
	gN
;i++)

1709 
PyLi¡_SET_ITEM
(
py_obj
,
i
,
v¬
<
T
>::
bud
(
v
[i],
sz
+1));

1712 
size_t
 
	gi
=0;i<
	gN
;i++)

1713 
PyLi¡_SET_ITEM
(
py_obj
,
i
,
v¬
<
T
>::
bud
(
v
[i],
sz
));

1715  
	gpy_obj
;

1721 
	g‹m¶©e
<
şass
 
	gT
,
size_t
 
	gN
>

1722 
	gv¬
<
	gT
[
N
]>::
v¬
(
T_CPP
 (&
v
)[N],cÚ¡ * 
Çme_
):

1723 
±r
(&
v
),

1724 
__dsizes__
(
NULL
),

1725 
V¬
(
g‘_¿nk
(),
ba£_hash_code
(),
Çme_
)

1727 
	gsize
=0;

1750 
	g‹m¶©e
<
şass
 
	gT
,
size_t
 
	gN
>

1751 
	gv¬
<
	gT
[
N
]>::
v¬
(
T_CPP
(&
v
)[N],
¡d
::
¡ršg
&& 
Çme_
,
py_v¬
<
T_EQUIV
>& 
pv
,** 
d©a_±r
):

1752 
±r
(&
v
),

1753 
__dsizes__
(
NULL
),

1754 
V¬
(
g‘_¿nk
(),
ba£_hash_code
(),
¡d
::
	$move
(
Çme_
))

1756 
size
=
N
;

1757 
size_t
 
i
=0;i<
size
;i++)

1759 (
v¬s
+
i
)->~
v¬
<
T
>();

1760 
	`Ãw
 (
v¬s
+
i
è
v¬
<
T
>(
v
[i],
Çme
+"["+
Pršt
::
	`to_¡ršg
(i)+"]",
pv
[i],
d©a_±r
+1);

1762 
	}
}

1768 
	g‹m¶©e
<
şass
 
	gT
,
size_t
 
	gN
>

1769 
	gv¬
<
	gT
[
N
]>::
	$v¬
():

1770 
	`±r
(
NULL
),

1771 
	`__dsizes__
(
NULL
),

1772 
	`V¬
(
	`g‘_¿nk
(),
	$ba£_hash_code
())

1774 
size
=
N
;

1775 
	}
}

1779 
	g‹m¶©e
<
şass
 
	gT
,
size_t
 
	gN
>

1780 
	gv¬
<
	gT
[
N
]>::~
	$v¬
()

1782 
d–‘e
 [] 
__dsizes__
;

1783 
	}
}

1789 
	g‹m¶©e
<
şass
 
	gT
,
size_t
 
	gN
>

1790 
	gv¬
<
	gT
[
N
]>::
v¬
(
T_CPP
 (&
v
)[N]):

1791 
±r
(&
v
),

1792 
__dsizes__
(
NULL
),

1793 
V¬
(
g‘_¿nk
(),
	$ba£_hash_code
())

1795 
size
=
N
;

1796 if(
¡d
::
is_§me
<cÚ¡ ,
T
>::
v®ue
)

1798 cÚ¡ * 
v_¡r
=
»š‹½»t_ÿ¡
<cÚ¡ *>(
v
);

1799 
Çme
=
¡d
::
	`¡ršg
(
v_¡r
);

1800 * 
Çme_
=
Ãw
 [2];

1801 
Çme_
[1]='\0';

1802 
size_t
 
i
=0;i<
size
;i++)

1804 
Çme_
[0]=
v
[
i
];

1806 (
v¬s
+
i
)->~
v¬
<
T
>();

1807 
	`Ãw
 (
v¬s
+
i
è
v¬
<
T
>(
v
[i],
¡d
::
	`¡ršg
(v[i]));

1811 
throw
 "this is‚ot‡llowed";

1812 
	}
}

1816 
	g‹m¶©e
<
şass
 
	gT
,
size_t
 
	gN
>

1817 
	gv¬
<
	gT
[
N
]>::
v¬
(cÚ¡ v¬<
T
[N]>& 
r
):

1818 
V¬
(
¡©ic_ÿ¡
<cÚ¡ V¬&>(
r
)),

1819 
±r
(
r
.ptr),

1820 
	$__dsizes__
(
NULL
)

1822 if(
r
.
__dsizes__
)

1824 
__dsizes__
=
Ãw
 
v¬
<
size_t
>*[
	`g‘_¿nk
()];

1825 
	`memıy
(
__dsizes__
,
r
.__dsizes__,
¿nk
*(
v¬
<
size_t
>*));

1827 
size_t
 
i
=0;i<
size
;i++)

1828 
v¬s
[
i
]=
r
.vars[i];

1829 
	}
}

1833 
	g‹m¶©e
<
şass
 
	gT
,
size_t
 
	gN
>

1834 
	gv¬
<
	gT
[
N
]>::
v¬
(v¬<
T
[N]>&& 
r
):

1835 
V¬
(
¡©ic_ÿ¡
<V¬&&>(
r
)),

1836 
±r
(
r
.ptr),

1837 
	$__dsizes__
(
r
.
__dsizes__
)

1839 
r
.
±r
=
NULL
;

1840 
r
.
__dsizes__
=
NULL
;

1841 
size_t
 
i
=0;i<
size
;i++)

1842 
v¬s
[
i
]=
¡d
::
	`move
(
r
.vars[i]);

1843 
	}
}

1847 
	g‹m¶©e
<
şass
 
	gT
,
size_t
 
	gN
>

1848 
	gv¬
<
	gT
[
N
]>& v¬<T[N]>::
İ”©Ü
=(cÚ¡ 
v¬
<
T
[N]>& 
r
)

1850 if(
this
==&
r
)  *this;

1851 
	gthis
-> ~
	gv¬
<
	gT
[
N
]>();

1852 
Ãw
 (
this
è
	gv¬
<
	gT
[
N
]>(
	gr
);

1853  *
	gthis
;

1858 
	g‹m¶©e
<
şass
 
	gT
,
size_t
 
	gN
>

1859 
	gv¬
<
	gT
[
N
]>& v¬<T[N]>::
İ”©Ü
=(
v¬
<
T
[N]>&& 
r
)

1861 if(
this
==&
r
)  *this;

1862 
	gthis
-> ~
	gv¬
<
	gT
[
N
]>();

1863 
Ãw
 (
this
è
	gv¬
<
	gT
[
N
]>(
	g¡d
::
move
(
r
));

1864  *
	gthis
;

1869 
	g‹m¶©e
<
şass
 
	gT
,
size_t
 
	gN
>

1870 
	gv¬
<
	gT
[
N
]>& v¬<T[N]>::
İ”©Ü
=(cÚ¡ 
T_CPP
 (&
v
)[N])

1872 
size
=
N
;

1873 
size_t
 
	gi
=0;i<
	gsize
;i++)

1874 
	gv¬s
[
i
]=
v
[i];

1875 
size_t
 
	gi
=0;i<
	gthis
->
	gsize
;i++)

1877 (
	gthis
->
	gv¬s
+
	gi
)->~
	gv¬
<
	gT
>();

1878 
Ãw
 (
this
->
v¬s
+
i
è
	gv¬
<
	gT
>(
	gv
[i],
	gthis
->
	gÇme
+"["+
	gPršt
::
to_¡ršg
(i)+"]");

1881  *
	gthis
;

1886 
	g‹m¶©e
<
şass
 
	gT
,
size_t
 
	gN
>

1887 
V¬
* 
	gv¬
<
	gT
[
N
]>::
	$şÚe
()

1889  
Ãw
 
v¬
<
T
[
N
]>(*
this
);

1890 
	}
}

1894 
	g‹m¶©e
<
şass
 
	gT
,
size_t
 
	gN
>

1895 cÚ¡ * 
	gv¬
<
	gT
[
N
]>::
	$g‘_±r
()

1897  
±r
;

1898 
	}
}

1902 
	g‹m¶©e
<
şass
 
	gT
,
size_t
 
	gN
>

1903 
	gv¬
<
	gT
>& v¬<T[
N
]>::
İ”©Ü
[](cÚ¡ 
size_t
 
i
)

1905  
v¬s
[
i
];

1910 
	g‹m¶©e
<
şass
 
	gT
,
size_t
 
	gN
>

1911 
	gv¬
<
	gT
[
N
]>::
	$£t
(
PyObjeù
* 
py_obj
)

1913 
py_v¬
<
T_EQUIV
> 
pv
;

1914 
Œy


1916 
pv
=
py_v¬
<
T_EQUIV
>(
py_obj
);

1918 
	`ÿtch
()

1920 
throw
 "fŸlu»Ødeduû C++y³ <"+
py_v¬
<
T_EQUIV
>::
	`ty³_Çme
()+">";

1923 
Œy


1925 
	`is_size_com·tibË
(
pv
,
Çme
,
__dsizes__
);

1927 
	`ÿtch
 (
¡d
::
¡ršg
& 
”r_msg
)

1929 
throw
 "fŸlu»Ødeduûy³ <"+
	`ty³_Çme
()+">: "+
”r_msg
;

1932 
	`£t
(
pv
);

1933 
	}
}

1937 
	g‹m¶©e
<
şass
 
	gT
,
size_t
 
	gN
>

1938 
boŞ
 
	gv¬
<
	gT
[
N
]>::
	$£t_nÙhrow
(
PyObjeù
* 
py_obj
)

1940 
py_v¬
<
T_EQUIV
> 
pv
;

1941 
Œy


1943 
pv
=
py_v¬
<
T_EQUIV
>(
py_obj
);

1945 
	`ÿtch
()

1947  
çl£
;

1950 if(!
	`is_size_com·tibË_nÙhrow
(
pv
,
__dsizes__
))

1951  
çl£
;

1952 
	`£t
(
pv
);

1953  
Œue
;

1954 
	}
}

1958 
	g‹m¶©e
<
şass
 
	gT
,
size_t
 
	gN
>

1959 
	gv¬
<
	gT
[
N
]>::
£t
(
py_v¬
<
T_EQUIV
>& 
pv
)

1961 
size
=
pv
.size;

1963 
d—Îoÿ‹
(*
±r
);

1964 
size_t
 
	gsz
[
g‘_¿nk
()];

1965 
	gi
=0;i<
	g¿nk
;i++è
	gsz
[
i
]=0;

1966 
accum_size
(
pv
,
sz
);

1967 * 
	gd©a_±r
[
g‘_¿nk
()];

1968 
	gi
=0;i<
	g¿nk
;i++è
	gd©a_±r
[
i
]=
NULL
;

1969 
®loÿ‹
(
d©a_±r
,*
±r
,
sz
);

1970 
size_t
 
	gi
=0;i<
	gsize
;i++)

1972 (
	gv¬s
+
	gi
)->~
	gv¬
<
	gT
>();

1973 
Ãw
 (
v¬s
+
i
è
	gv¬
<
	gT
>((*
	g±r
)[i],
	gÇme
+"["+
	gPršt
::
to_¡ršg
(i)+"]",
	gpv
[i],
	gd©a_±r
+1);

1979 
	g‹m¶©e
<
şass
 
	gT
,
size_t
 
	gN
>

1980 
PyObjeù
* 
	gv¬
<
	gT
[
N
]>::
	$g‘
()

1982 if(
¡d
::
is_§me
<
T
,>::
v®ue
 || std::is_same<T,const >::value)

1983  
	`PyBy‹s_FromSŒšg
(
»š‹½»t_ÿ¡
<*>(*
±r
));

1987 
PyObjeù
* 
py_obj
=
	`PyLi¡_New
(
size
);

1988 
size_t
 
i
=0;i<
size
;i++)

1989 
	`PyLi¡_SET_ITEM
(
py_obj
,
i
,
v¬s
[i].
	`g‘
());

1990  
py_obj
;

1991 
	}
}

1995 
	g‹m¶©e
<
şass
 
	gT
,
size_t
 
	gN
>‹m¶©e<
	gşass
 ... 
	gTs
>

1996 
	gv¬
<
	gT
[
N
]>::
	$dyÇmic_size
(
Ts
&&... 
____dsizes__
)

1998 
	`as£¹
(
roÙ
);

1999 
	`as£¹
(...(
____dsizes__
)==
	`g‘_¿nk
());

2000 
d–‘e
 [] 
__dsizes__
;

2001 
__dsizes__
=
Ãw
 
v¬
<
size_t
>*[
	`g‘_¿nk
()];

2002 
i
=0;i<
¿nk
;i++è
__dsizes__
[i]=
NULL
;

2003 
V¬
::
	`assign_dyÇmic_size
(
__dsizes__
,
____dsizes__
...);

2004 
	}
}

2008 
Çme¥aû
 
	gMAPP_NS


2010 
	g‹m¶©e
<
şass
 
	gT
>

2011 
şass
 
	gv¬
<
	gT
*>: 
public
 
V¬


2013 
´iv©e
:

2014 
´Ùeùed
:

2015 
v¬
<
size_t
>** 
__dsizes__
;

2016 cÚ¡ * 
g‘_±r
();

2017 
	gpublic
:

2018 
ty³Çme
 
	tv¬
<
	tT
>::
	tT_BASE
 T_BASE;

2019 
ty³Çme
 
	t¡d
::
	tadd_poš‹r
<
	tty³Çme
 
	tv¬
<
	tT
>::
	tT_EQUIV
>::
	tty³
 T_EQUIV;

2020 
ty³Çme
 
	tıp_ty³
<
	tT
>::
	tty³
 
	tT_CPP
;

2021 
cÚ¡ex´
 
g‘_¿nk
();

2022 
size_t
 
ba£_hash_code
();

2023 
®loÿ‹
(**,
T_CPP
*&,
size_t
*);

2024 
d—Îoÿ‹
(
T_CPP
*&);

2025 
accum_size
(
py_v¬
<
T_EQUIV
>&,
size_t
*);

2026 
boŞ
 
is_size_com·tibË_nÙhrow
(
py_v¬
<
T_EQUIV
>&,
v¬
<
size_t
>**);

2027 
is_size_com·tibË
(
py_v¬
<
T_EQUIV
>&,cÚ¡ 
¡d
::
¡ršg
&,
v¬
<
size_t
>**);

2028 
	g¡d
::
¡ršg
 
ty³_Çme
(
v¬
<
size_t
>**);

2029 
PyObjeù
* 
bud
(
T_CPP
*&,
size_t
(**)=
NULL
);

2030 
	gv¬
<
	gT
>* 
	gv¬s
;

2031 
T_CPP
** 
	g±r
;

2033 
v¬
(
T_CPP
*&,const *);

2036 
v¬
(
T_CPP
*&,
¡d
::
¡ršg
&&,
py_v¬
<
T_EQUIV
>&,**);

2037 
v¬
(
T_CPP
*&,v¬<
T
*>&,**,cÚ¡ 
size_t
*,const size_t);

2038 
v¬
();

2039 
	gvœtu®
 ~
v¬
();

2040 
v¬
(
T_CPP
*&);

2041 
v¬
(cÚ¡ v¬<
T
*>&);

2042 
v¬
(v¬<
T
*>&&);

2043 
	gv¬
<
	gT
*>& 
	gİ”©Ü
 = (cÚ¡ 
v¬
<
T
*>&);

2044 
	gv¬
<
	gT
*>& 
	gİ”©Ü
 = (
v¬
<
T
*>&&);

2045 
	g‹m¶©e
<
size_t
 
	gN
>

2046 
	gv¬
<
	gT
*>& 
	gİ”©Ü
 = (cÚ¡ 
T_CPP
(&)[
N
]);

2047 
V¬
* 
şÚe
();

2049 
	gv¬
<
	gT
>& 
	gİ”©Ü
 [] (cÚ¡ 
	gsize_t
);

2050 
£t
(
PyObjeù
*);

2051 
boŞ
 
£t_nÙhrow
(
PyObjeù
*);

2052 
£t
(
py_v¬
<
T_EQUIV
>&);

2053 
»£t_n_»m­
(cÚ¡ 
size_t
*,size_t);

2054 
PyObjeù
* 
g‘
();

2055 
	g¡d
::
¡ršg
 
ty³_Çme
(){ 
ty³_©Œ
<
T_BASE
>::
Çme
()+" "+ty³_Çme(
__dsizes__
);}

2056 
	g‹m¶©e
<
	gşass
 ... 
	gTs
>

2057 
dyÇmic_size
(
Ts
&&...);

2063 
	g‹m¶©e
 <
şass
 
	gT
>

2064 
cÚ¡ex´
 
	gv¬
<
	gT
*>::
	$g‘_¿nk
()

2066  1+
v¬
<
T
>::
	`g‘_¿nk
();

2067 
	}
}

2071 
	g‹m¶©e
 <
şass
 
	gT
>

2072 
size_t
 
	gv¬
<
	gT
*>::
	$ba£_hash_code
()

2076 
	}
}

2080 
	g‹m¶©e
 <
şass
 
	gT
>

2081 
	gv¬
<
	gT
*>::
	$®loÿ‹
(** 
±r
,
T_CPP
*& 
v
,
size_t
* 
sz
)

2083 
v
=
NULL
;

2084 if(*
sz
è
v
=
Ãw
 
T_CPP
[*sz];

2085 *
±r
=
v
;

2086 if(
	`g‘_¿nk
()==1) ;

2087 
v¬
<
T
>::
	`®loÿ‹
(
±r
+1,
v
[0],
sz
+1);

2088 
	}
}

2092 
	g‹m¶©e
 <
şass
 
	gT
>

2093 
	gv¬
<
	gT
*>::
	$d—Îoÿ‹
(
T_CPP
*& 
v
)

2095 if(
v
è
v¬
<
T
>::
	`d—Îoÿ‹
(v[0]);

2096 
d–‘e
 [] 
v
;

2097 
v
=
NULL
;

2098 
	}
}

2102 
	g‹m¶©e
 <
şass
 
	gT
>

2103 
	gv¬
<
	gT
*>::
accum_size
(
py_v¬
<
T_EQUIV
>& 
pv
,
size_t
* 
sz
)

2105 *
	gsz
+=
pv
.
size
;

2106 if(
g‘_¿nk
()==1) ;

2108 
size_t
 
	gi
=0;i<
	gpv
.
	gsize
;i++)

2109 
	gv¬
<
	gT
>::
accum_size
(
pv
[
i
],
sz
+1);

2114 
	g‹m¶©e
 <
şass
 
	gT
>

2115 
boŞ
 
	gv¬
<
	gT
*>::
is_size_com·tibË_nÙhrow
(
py_v¬
<
T_EQUIV
>& 
pv
,
v¬
<
size_t
>** 
sz
)

2117 if(
	gsz
)

2119 if(*
	gsz
 && **sz!=
pv
.
size
)

2120  
çl£
;

2121 
	gsz
+=1;

2124 
size_t
 
	gi
=0;i<
	gpv
.
	gsize
;i++)

2125 if(!
	gv¬
<
	gT
>::
is_size_com·tibË_nÙhrow
(
pv
[
i
],
sz
))

2126  
	gçl£
;

2127  
	gŒue
;

2132 
	g‹m¶©e
 <
şass
 
	gT
>

2133 
	gv¬
<
	gT
*>::
is_size_com·tibË
(
py_v¬
<
T_EQUIV
>& 
pv
,cÚ¡ 
¡d
::
¡ršg
& 
Çme
,
v¬
<
size_t
>** 
sz
)

2135 if(
	gsz
)

2137 if(*
	gsz
 && **sz!=
pv
.
size
)

2139 
throw
 "ex³ùed siz"+
Pršt
::
to_¡ršg
(*((*
sz
)->
±r
))+" ("+(*sz)->
Çme
+") for‡rgument '"+name+"'";

2141 
	gsz
+=1;

2144 
size_t
 
	gi
=0;i<
	gpv
.
	gsize
;i++)

2146 
	gŒy


2148 
	gv¬
<
	gT
>::
is_size_com·tibË
(
pv
[
i
],
Çme
,
sz
);

2151 
ÿtch
(
¡d
::
¡ršg
& 
”r_msg
)

2153 
throw
 
”r_msg
+"["+
Pršt
::
to_¡ršg
(
i
)+"]";

2160 
	g‹m¶©e
<
şass
 
	gT
>

2161 
	g¡d
::
¡ršg
 
v¬
<
T
*>::
ty³_Çme
(v¬<
size_t
>** 
sz
)

2163 if(
sz
)

2165 if(*
sz
)

2166  
¡d
::
¡ršg
("[")+¡d::¡ršg((*
sz
)->
Çme
)+¡d::¡ršg("]")+
v¬
<
T
>::
ty³_Çme
(sz+1);

2168  
	g¡d
::
¡ršg
("[]")+
v¬
<
T
>::
ty³_Çme
(
sz
+1);

2170  
	g¡d
::
¡ršg
("[]")+
v¬
<
T
>::
ty³_Çme
(
sz
);

2175 
	g‹m¶©e
<
şass
 
	gT
>

2176 
PyObjeù
* 
	gv¬
<
	gT
*>::
	$bud
(
T_CPP
*& 
v
,
size_t
** 
sz
)

2179 
PyObjeù
* 
py_obj
=
	`PyLi¡_New
(**
sz
);

2180 
size_t
 
i
=0;i<**
sz
;i++)

2181 
	`PyLi¡_SET_ITEM
(
py_obj
,
i
,
v¬
<
T
>::
	`bud
(
v
[i],
sz
+1));

2182  
py_obj
;

2183 
	}
}

2188 
	g‹m¶©e
<
şass
 
	gT
>

2189 
	gv¬
<
	gT
*>::
	$v¬
(
T_CPP
*& 
v
,cÚ¡ * 
Çme_
):

2190 
	`v¬s
(
NULL
),

2191 
	`±r
(&
v
),

2192 
	`__dsizes__
(
NULL
),

2193 
	`V¬
(
	`g‘_¿nk
(),
	`ba£_hash_code
(),
Çme_
)

2195 
size
=0;

2196 
v
=
NULL
;

2197 
	}
}

2222 
	g‹m¶©e
<
şass
 
	gT
>

2223 
	gv¬
<
	gT
*>::
v¬
(
T_CPP
*& 
v
,
¡d
::
¡ršg
&& 
Çme_
,
py_v¬
<
T_EQUIV
>& 
pv
,** 
d©a_±r
):

2224 
V¬
(
g‘_¿nk
(),
ba£_hash_code
(),
¡d
::
move
(
Çme_
)),

2225 
v¬s
(
NULL
),

2226 
__dsizes__
(
NULL
),

2227 
	$±r
(&
v
)

2229 
v
=
¡©ic_ÿ¡
<
T
*>(*
d©a_±r
);

2230 
size
=
pv
.size;

2231 
v¬s
=
Ãw
 
v¬
<
T
>[
size
];

2232 
size_t
 
i
=0;i<
size
;i++)

2234 (
v¬s
+
i
)->~
v¬
<
T
>();

2235 
	`Ãw
 (
v¬s
+
i
è
v¬
<
T
>((*
±r
)[i],
Çme
+"["+
Pršt
::
	`to_¡ršg
(i)+"]",
pv
[i],
d©a_±r
+1);

2237 *
d©a_±r
=
v
+
size
;

2238 
	}
}

2244 
	g‹m¶©e
<
şass
 
	gT
>

2245 
	gv¬
<
	gT
*>::
v¬
(
T_CPP
*& 
v
,v¬<
T
*>& 
__v¬
,** 
d©a_±r
,cÚ¡ 
size_t
* 
m­
,cÚ¡ size_ˆ
m­_sz
):

2246 
V¬
(
g‘_¿nk
(),
ba£_hash_code
(),
__v¬
.
Çme
),

2247 
v¬s
(
NULL
),

2248 
__dsizes__
(
NULL
),

2249 
	$±r
(&
v
)

2251 
v
=
¡©ic_ÿ¡
<
T
*>(*
d©a_±r
);

2252 
size
=
m­_sz
;

2253 
v¬s
=
Ãw
 
v¬
<
T
>[
size
];

2254 
size_t
 
i
=0;i<
size
;i++)

2256 (
v¬s
+
i
)->~
v¬
<
T
>();

2257 
	`Ãw
 (
v¬s
+
i
è
v¬
<
T
>((*
±r
)[i],
__v¬
[
m­
[i]],
d©a_±r
+1,m­,
m­_sz
);

2259 *
d©a_±r
=
v
+
size
;

2260 
	}
}

2266 
	g‹m¶©e
<
şass
 
	gT
>

2267 
	gv¬
<
	gT
*>::
	$v¬
():

2268 
	`V¬
(
	`g‘_¿nk
(),
	`ba£_hash_code
()),

2269 
	`v¬s
(
NULL
),

2270 
	`__dsizes__
(
NULL
),

2271 
	$±r
(
NULL
)

2273 
size
=0;

2274 
	}
}

2278 
	g‹m¶©e
<
şass
 
	gT
>

2279 
	gv¬
<
	gT
*>::~
	$v¬
()

2281 
d–‘e
 [] 
__dsizes__
;

2282 
d–‘e
 [] 
v¬s
;

2283 if(
roÙ
 && 
±r
è
v¬
<
T
*>::
	`d—Îoÿ‹
(*ptr);

2284 
	}
}

2290 
	g‹m¶©e
<
şass
 
	gT
>

2291 
	gv¬
<
	gT
*>::
	$v¬
(
T_CPP
*& 
v
):

2292 
	`v¬s
(
NULL
),

2293 
	`±r
(&
v
),

2294 
	`__dsizes__
(
NULL
),

2295 
	`V¬
(
	`g‘_¿nk
(),
	$ba£_hash_code
())

2297 
size
=0;

2298 if(
¡d
::
is_§me
<cÚ¡ ,
T
>::
v®ue
)

2300 cÚ¡ * 
v_¡r
=
»š‹½»t_ÿ¡
<cÚ¡ *>(
v
);

2301 
Çme
=
¡d
::
	`¡ršg
(
v_¡r
);

2302 
size
=
	`¡¾’
(
v_¡r
)+1;

2303 * 
Çme_
=
Ãw
 [2];

2304 
Çme_
[1]='\0';

2305 
size_t
 
i
=0;i<
size
;i++)

2307 
Çme_
[0]=
v_¡r
[
i
];

2309 (
v¬s
+
i
)->~
v¬
<
T
>();

2310 
	`Ãw
 (
v¬s
+
i
è
v¬
<
T
>(
v
[i],
¡d
::
	`¡ršg
(v[i]));

2314 
throw
 "this is‚ot‡llowed";

2315 
	}
}

2319 
	g‹m¶©e
<
şass
 
	gT
>

2320 
	gv¬
<
	gT
*>::
v¬
(cÚ¡ v¬<
T
*>& 
r
):

2321 
V¬
(
¡©ic_ÿ¡
<cÚ¡ V¬&>(
r
)),

2322 
±r
(
r
.ptr),

2323 
	$__dsizes__
(
NULL
)

2325 if(
r
.
__dsizes__
)

2327 
__dsizes__
=
Ãw
 
v¬
<
size_t
>*[
	`g‘_¿nk
()];

2328 
	`memıy
(
__dsizes__
,
r
.__dsizes__,
¿nk
*(
v¬
<
size_t
>*));

2330 
v¬s
=
Ãw
 
v¬
<
T
>[
r
.
size
];

2331 
size_t
 
i
=0;i<
size
;i++)

2332 
v¬s
[
i
]=
r
.vars[i];

2333 
	}
}

2337 
	g‹m¶©e
<
şass
 
	gT
>

2338 
	gv¬
<
	gT
*>::
v¬
(v¬<
T
*>&& 
r
):

2339 
V¬
(
¡©ic_ÿ¡
<V¬&&>(
r
)),

2340 
±r
(
r
.ptr),

2341 
	$__dsizes__
(
r
.
__dsizes__
)

2343 
r
.
±r
=
NULL
;

2344 
r
.
__dsizes__
=
NULL
;

2345 
v¬s
=
r
.vars;

2346 
r
.
v¬s
=
NULL
;

2347 
	}
}

2351 
	g‹m¶©e
<
şass
 
	gT
>

2352 
	gv¬
<
	gT
*>& v¬<T*>::
İ”©Ü
=(cÚ¡ 
v¬
<
T
*>& 
r
)

2354 if(
this
==&
r
)  *this;

2355 
	gthis
->~
	gv¬
<
	gT
*>();

2356 
Ãw
 (
this
è
	gv¬
<
	gT
*>(
	gr
);

2357  *
	gthis
;

2362 
	g‹m¶©e
<
şass
 
	gT
>

2363 
	gv¬
<
	gT
*>& v¬<T*>::
İ”©Ü
=(
v¬
<
T
*>&& 
r
)

2365 if(
this
==&
r
)  *this;

2366 
	gthis
->~
	gv¬
<
	gT
*>();

2367 
Ãw
 (
this
è
	gv¬
<
	gT
*>(
	g¡d
::
move
(
r
));

2368  *
	gthis
;

2373 
	g‹m¶©e
<
şass
 
	gT
>‹m¶©e<
size_t
 
	gN
>

2374 
	gv¬
<
	gT
*>& v¬<T*>::
İ”©Ü
=(cÚ¡ 
T_CPP
 (&
v_¬r
)[
N
])

2376 
as£¹
(
roÙ
);

2377 
	gd–‘e
 [] 
	gthis
->
	gv¬s
;

2378 if(
	g±r
è
	gd–‘e
 [] *(
	gthis
->ptr);

2379 
	gthis
->
	gsize
=
N
;

2380 
	gthis
->
	gv¬s
=
Ãw
 
v¬
<
T
>[
this
->
size
];

2381 
T_CPP
* 
	gv
=
Ãw
 T_CPP[
this
->
size
];

2382 *(
	gthis
->
	g±r
)=
v
;

2384 
size_t
 
	gi
=0;i<
	gthis
->
	gsize
;i++)

2386 (
	gthis
->
	gv¬s
+
	gi
)->~
	gv¬
<
	gT
>();

2387 
Ãw
 (
this
->
v¬s
+
i
è
	gv¬
<
	gT
>(
	gv
[i],
	gthis
->
	gÇme
+"["+
	gPršt
::
to_¡ršg
(i)+"]");

2389  *
	gthis
;

2394 
	g‹m¶©e
<
şass
 
	gT
>

2395 
V¬
* 
	gv¬
<
	gT
*>::
	$şÚe
()

2397  
Ãw
 
v¬
<
T
*>(*
this
);

2398 
	}
}

2402 
	g‹m¶©e
<
şass
 
	gT
>

2403 cÚ¡ * 
	gv¬
<
	gT
*>::
	$g‘_±r
()

2405  
±r
;

2406 
	}
}

2410 
	g‹m¶©e
<
şass
 
	gT
>

2411 
	gv¬
<
	gT
>& v¬<T*>::
İ”©Ü
[](cÚ¡ 
size_t
 
i
)

2413  
v¬s
[
i
];

2418 
	g‹m¶©e
<
şass
 
	gT
>

2419 
	gv¬
<
	gT
*>::
	$£t
(
PyObjeù
* 
py_obj
)

2421 
py_v¬
<
T_EQUIV
> 
pv
;

2422 
Œy


2424 
pv
=
py_v¬
<
T_EQUIV
>(
py_obj
);

2426 
	`ÿtch
()

2428 
throw
 "fŸlu»Ødeduû C++y³ <"+
py_v¬
<
T_EQUIV
>::
	`ty³_Çme
()+">";

2431 
Œy


2433 
	`is_size_com·tibË
(
pv
,
Çme
,
__dsizes__
);

2435 
	`ÿtch
 (
¡d
::
¡ršg
& 
”r_msg
)

2437 
throw
 "fŸlu»Ødeduûy³ <"+
	`ty³_Çme
()+">: "+
”r_msg
;

2440 
	`£t
(
pv
);

2441 
	}
}

2445 
	g‹m¶©e
<
şass
 
	gT
>

2446 
boŞ
 
	gv¬
<
	gT
*>::
	$£t_nÙhrow
(
PyObjeù
* 
py_obj
)

2448 
py_v¬
<
T_EQUIV
> 
pv
;

2449 
Œy


2451 
pv
=
py_v¬
<
T_EQUIV
>(
py_obj
);

2453 
	`ÿtch
()

2455  
çl£
;

2458 if(!
	`is_size_com·tibË_nÙhrow
(
pv
,
__dsizes__
))

2459  
çl£
;

2461 
d–‘e
 [] 
v¬s
;

2462 
v¬s
=
NULL
;

2463 
size
=
pv
.size;

2464 if(
size
è
v¬s
=
Ãw
 
v¬
<
T
>[size];

2466 
	`£t
(
pv
);

2467  
Œue
;

2468 
	}
}

2472 
	g‹m¶©e
<
şass
 
	gT
>

2473 
	gv¬
<
	gT
*>::
£t
(
py_v¬
<
T_EQUIV
>& 
pv
)

2475 
d–‘e
 [] 
v¬s
;

2476 
	gv¬s
=
NULL
;

2477 
	gsize
=
pv
.
size
;

2478 if(
	gsize
è
	gv¬s
=
Ãw
 
v¬
<
T
>[
size
];

2480 
d—Îoÿ‹
(*
±r
);

2481 
size_t
 
	gsz
[
g‘_¿nk
()];

2482 
	gi
=0;i<
	g¿nk
;i++è
	gsz
[
i
]=0;

2483 
accum_size
(
pv
,
sz
);

2484 * 
	gd©a_±r
[
g‘_¿nk
()];

2485 
	gi
=0;i<
	g¿nk
;i++è
	gd©a_±r
[
i
]=
NULL
;

2486 
®loÿ‹
(
d©a_±r
,*
±r
,
sz
);

2487 
size_t
 
	gi
=0;i<
	gsize
;i++)

2489 (
	gv¬s
+
	gi
)->~
	gv¬
<
	gT
>();

2490 
Ãw
 (
v¬s
+
i
è
	gv¬
<
	gT
>((*
	g±r
)[i],
	gÇme
+"["+
	gPršt
::
to_¡ršg
(i)+"]",
	gpv
[i],
	gd©a_±r
+1);

2497 
	g‹m¶©e
<
şass
 
	gT
>

2498 
	gv¬
<
	gT
*>::
	$»£t_n_»m­
(cÚ¡ 
size_t
* 
m­
,cÚ¡ size_ˆ
m­_sz
)

2501 
T
* 
__d©a
=*
±r
;

2502 *
±r
=
NULL
;

2503 
v¬
<
T
>* 
__v¬s
=
v¬s
;

2504 
v¬s
=
NULL
;

2506 
size_t
 
sz
[
	`g‘_¿nk
()];

2507 
sz
[0]=
m­_sz
;

2508 
i
=1;i<
¿nk
;i++è
sz
[i]=
m­_sz
*sz[i-1];

2509 * 
d©a_±r
[
	`g‘_¿nk
()];

2510 
i
=0;i<
¿nk
;i++è
d©a_±r
[i]=
NULL
;

2511 
	`®loÿ‹
(
d©a_±r
,*
±r
,
sz
);

2515 
T
* 
v
=*
±r
;

2516 
size
=
m­_sz
;

2517 
v¬s
=
Ãw
 
v¬
<
T
>[
size
];

2518 
size_t
 
i
=0;i<
size
;i++)

2520 (
v¬s
+
i
)->~
v¬
<
T
>();

2521 
	`Ãw
 (
v¬s
+
i
è
v¬
<
T
>((*
±r
)[i],
__v¬s
[
m­
[i]],
d©a_±r
+1,m­,
m­_sz
);

2523 *
d©a_±r
=
v
+
size
;

2525 
d–‘e
 [] 
__v¬s
;

2526 
	`d—Îoÿ‹
(
__d©a
);

2527 
d–‘e
 [] 
__dsizes__
;

2528 
__dsizes__
=
NULL
;

2529 
	}
}

2533 
	g‹m¶©e
<
şass
 
	gT
>

2534 
PyObjeù
* 
	gv¬
<
	gT
*>::
	$g‘
()

2536 if(
¡d
::
is_§me
<
T
,>::
v®ue
 || std::is_same<T,const >::value)

2537  
	`__PySŒšg_FromSŒšg
(
»š‹½»t_ÿ¡
<*>(*
±r
));

2539 
PyObjeù
* 
py_obj
=
	`PyLi¡_New
(
size
);

2540 
size_t
 
i
=0;i<
size
;i++)

2541 
	`PyLi¡_SET_ITEM
(
py_obj
,
i
,
v¬s
[i].
	`g‘
());

2542  
py_obj
;

2543 
	}
}

2547 
	g‹m¶©e
<
şass
 
	gT
>‹m¶©e<
	gşass
 ... 
	gTs
>

2548 
	gv¬
<
	gT
*>::
	$dyÇmic_size
(
Ts
&&... 
____dsizes__
)

2550 
	`as£¹
(
roÙ
);

2551 
	`as£¹
(...(
____dsizes__
)==
	`g‘_¿nk
());

2552 
d–‘e
 [] 
__dsizes__
;

2553 
__dsizes__
=
Ãw
 
v¬
<
size_t
>*[
	`g‘_¿nk
()];

2554 
i
=0;i<
¿nk
;i++è
__dsizes__
[i]=
NULL
;

2555 
V¬
::
	`assign_dyÇmic_size
(
__dsizes__
,
____dsizes__
...);

2556 
	}
}

2560 
Çme¥aû
 
	gMAPP_NS


2562 
	g‹m¶©e
<
şass
 
	gT
>

2563 
şass
 
	gv¬
<
	gsymm
<
	gT
>>:
public
 
v¬
<
T
>

2565 
public
:

2566 
ty³Çme
 
	tv¬
<
	tT
>::
	tT_BASE
 T_BASE;

2567 
ty³Çme
 
	tv¬
<
	tT
>::
	tT_EQUIV
 T_EQUIV;

2569 
boŞ
 
is_size_com·tibË_nÙhrow
(
py_v¬
<
T_EQUIV
>&,
v¬
<
size_t
>**);

2570 
is_size_com·tibË
(
py_v¬
<
T_EQUIV
>&,cÚ¡ 
¡d
::
¡ršg
&,
v¬
<
size_t
>**);

2571 
	g¡d
::
¡ršg
 
ty³_Çme
(
v¬
<
size_t
>** 
sz
){ v¬<
T
>::type_name(sz);};

2572 
v¬
(
T
&,const *);

2575 
v¬
(
T
&,
¡d
::
¡ršg
&&,
py_v¬
<
T_EQUIV
>&,**);

2576 
v¬
(
T
&,v¬<
symm
<T>>&,**,cÚ¡ 
size_t
*,const size_t);

2577 
v¬
();

2578 ~
v¬
();

2579 
£t
(
PyObjeù
*);

2580 
boŞ
 
£t_nÙhrow
(
PyObjeù
*);

2581 
	g¡d
::
¡ršg
 
ty³_Çme
();

2588 
	g‹m¶©e
 <
şass
 
	gT
>

2589 
boŞ
 
	gv¬
<
	gsymm
<
	gT
>>::
is_size_com·tibË_nÙhrow
(
py_v¬
<
T_EQUIV
>& 
pv
,
v¬
<
size_t
>** 
sz
)

2591 if(!
	gpv
.
is_symm‘ric
()è 
	gçl£
;

2592  
	gv¬
<
	gT
>::
is_size_com·tibË_nÙhrow
(
pv
,
sz
);

2597 
	g‹m¶©e
 <
şass
 
	gT
>

2598 
	gv¬
<
	gsymm
<
	gT
>>::
is_size_com·tibË
(
py_v¬
<
T_EQUIV
>& 
pv
,cÚ¡ 
¡d
::
¡ršg
& 
Çme
,
v¬
<
size_t
>** 
sz
)

2600 if(!
	gpv
.
is_symm‘ric
())

2603 
	gthrow
 "ex³ùed symm‘ric,rŸnguÏ¸Ü voigˆ»´e£Á©iÚ fÜ '"+
	gÇme
+"'";

2605  
	gv¬
<
	gT
>::
is_size_com·tibË
(
pv
,
Çme
,
sz
);

2611 
	g‹m¶©e
<
şass
 
	gT
>

2612 
	gv¬
<
	gsymm
<
	gT
>>::
	$v¬
(
T
& 
v
,cÚ¡ * 
Çme_
):

2613 
v¬
<
T
>(
v
,
Çme_
)

2615 
	}
}

2630 
	g‹m¶©e
<
şass
 
	gT
>

2631 
	gv¬
<
	gsymm
<
	gT
>>::
v¬
(
T
& 
v
,
¡d
::
¡ršg
&& 
Çme_
,
py_v¬
<
T_EQUIV
>& 
pv
,** 
d©a_±r
):

2632 
v¬
<
T
>::v¬(
v
,
¡d
::
move
(
Çme_
),
pv
,
d©a_±r
)

2640 
	g‹m¶©e
<
şass
 
	gT
>

2641 
	gv¬
<
	gsymm
<
	gT
>>::
v¬
(
T
& 
v
,v¬<
symm
<T>>& 
__v¬
,** 
d©a_±r
,cÚ¡ 
size_t
* 
m­
,cÚ¡ size_ˆ
m­_sz
):

2642 
v¬
<
T
>::
	$v¬
(
v
,
__v¬
,
d©a_±r
,
m­
,
m­_sz
)

2645 
	}
}

2651 
	g‹m¶©e
<
şass
 
	gT
>

2652 
	gv¬
<
	gsymm
<
	gT
>>::
	$v¬
():

2653 
v¬
<
T
>::
	$v¬
()

2655 
	}
}

2659 
‹m¶©e
<
şass
 
T
>

2660 
v¬
<
symm
<
T
>>::~
	$v¬
()

2662 
	}
}

2666 
‹m¶©e
<
şass
 
T
>

2667 
v¬
<
symm
<
T
>>::
	$£t
(
PyObjeù
* 
py_obj
)

2669 
py_v¬
<
T_EQUIV
> 
pv
;

2670 
Œy


2672 
pv
=
py_v¬
<
T_EQUIV
>(
py_obj
);

2674 
	`ÿtch
()

2676 
Œy


2678 
pv
=
py_v¬
<
T_EQUIV
>(&
py_obj
);

2680 
	`ÿtch
()

2682 
throw
 "fŸlu»Ødeduû C++y³ <"+
py_v¬
<
T_EQUIV
>::
	`ty³_Çme
()+"> or <"

2683 +
py_v¬
<
ty³Çme
 
¡d
::
»move_poš‹r
<
T_EQUIV
>::
ty³
>::
	`ty³_Çme
()+">";

2687 if(!
pv
.
	`is_symm‘ric
())

2688 
throw
 "fŸlu»Ødeduûy³ <"+
	`ty³_Çme
()+">: "+

2689 
v¬
<
T
>::
Çme
+" must be„epresented in symmetric,riangular or voigt form";

2691 
Œy


2693 
v¬
<
T
>::
	`is_size_com·tibË
(
pv
,v¬<T>::
Çme
,v¬<T>::
__dsizes__
);

2695 
	`ÿtch
 (
¡d
::
¡ršg
& 
”r_msg
)

2697 
throw
 "fŸlu»Ødeduûy³ <"+
	`ty³_Çme
()+">: "+
”r_msg
;

2700 
v¬
<
T
>::
	`£t
(
pv
);

2701 
	}
}

2705 
	g‹m¶©e
<
şass
 
	gT
>

2706 
boŞ
 
	gv¬
<
	gsymm
<
	gT
>>::
	$£t_nÙhrow
(
PyObjeù
* 
py_obj
)

2708 
py_v¬
<
T_EQUIV
> 
pv
;

2709 
Œy


2711 
pv
=
py_v¬
<
T_EQUIV
>(
py_obj
);

2713 
	`ÿtch
()

2715 
Œy


2717 
pv
=
py_v¬
<
T_EQUIV
>(&
py_obj
);

2719 
	`ÿtch
()

2721  
çl£
;

2725 if(!
pv
.
	`is_symm‘ric
())

2726  
çl£
;

2728 if(!
v¬
<
T
>::
	`is_size_com·tibË_nÙhrow
(
pv
,v¬<T>::
__dsizes__
))

2729  
çl£
;

2731 
v¬
<
T
>::
	`£t
(
pv
);

2732  
Œue
;

2733 
	}
}

2737 
	g‹m¶©e
<
şass
 
	gT
>

2738 
	g¡d
::
¡ršg
 
v¬
<
symm
<
T
>>::
	$ty³_Çme
()

2740  
¡d
::
	`¡ršg
("symm‘riø")+
v¬
<
T
>::
	`ty³_Çme
();

2741 
	}
}

2745 
Çme¥aû
 
	gMAPP_NS


2747 
	g‹m¶©e
<
şass
 
	gT
>

2748 
şass
 
	gv¬
<
	gsq
<
	gT
>>:
public
 
v¬
<
T
>

2750 
public
:

2751 
ty³Çme
 
	tv¬
<
	tT
>::
	tT_BASE
 T_BASE;

2752 
ty³Çme
 
	tv¬
<
	tT
>::
	tT_EQUIV
 T_EQUIV;

2753 
v¬
(
T
&,const *);

2754 
	g‹m¶©e
<
	gşass
... 
	gTs
>

2755 
v¬
(
T
&,cÚ¡ *,
Ts
&&...);

2756 ~
v¬
();

2757 
£t
(
PyObjeù
*);

2758 
boŞ
 
£t_nÙhrow
(
PyObjeù
*);

2759 
	g¡d
::
¡ršg
 
ty³_Çme
();

2766 
	g‹m¶©e
<
şass
 
	gT
>

2767 
	gv¬
<
	gsq
<
	gT
>>::~
	$v¬
()

2769 
	}
}

2774 
‹m¶©e
<
şass
 
T
>

2775 
v¬
<
sq
<
T
>>::
	$v¬
(
T
& 
v
,cÚ¡ * 
Çme_
):

2776 
v¬
<
T
>(
v
,
Çme_
)

2778 
	}
}

2783 
	g‹m¶©e
<
şass
 
	gT
>‹m¶©e<
	gşass
... 
	gTs
>

2784 
	gv¬
<
	gsq
<
	gT
>>::
	$v¬
(
T
& 
v
,cÚ¡ * 
Çme_
,
Ts
&&...
____dsizes__
):

2785 
v¬
<
T
>(
v
,
Çme_
,
____dsizes__
...)

2787 
	}
}

2791 
	g‹m¶©e
<
şass
 
	gT
>

2792 
	gv¬
<
	gsq
<
	gT
>>::
	$£t
(
PyObjeù
* 
py_obj
)

2794 
py_v¬
<
T_EQUIV
> 
pv
;

2795 
Œy


2797 
pv
=
py_v¬
<
T_EQUIV
>(
py_obj
);

2799 
	`ÿtch
()

2801 
Œy


2803 
pv
=
py_v¬
<
T_EQUIV
>(&
py_obj
);

2805 
	`ÿtch
()

2807 
throw
 "fŸlu»Ødeduû C++y³ <"+
py_v¬
<
T_EQUIV
>::
	`ty³_Çme
()+"> or <"

2808 +
py_v¬
<
ty³Çme
 
¡d
::
»move_poš‹r
<
T_EQUIV
>::
ty³
>::
	`ty³_Çme
()+">";

2812 if(!
pv
.
	`is_sq
())

2813 
throw
 "fŸlu»Ødeduûy³ <"+
	`ty³_Çme
()+">: ";

2815 
Œy


2817 
v¬
<
T
>::
	`is_size_com·tibË
(
pv
,v¬<T>::
Çme
,v¬<T>::
__dsizes__
);

2819 
	`ÿtch
 (
¡d
::
¡ršg
& 
”r_msg
)

2821 
throw
 "fŸlu»Ødeduûy³ <"+
	`ty³_Çme
()+">: "+
”r_msg
;

2824 
v¬
<
T
>::
	`£t
(
pv
);

2825 
	}
}

2829 
	g‹m¶©e
<
şass
 
	gT
>

2830 
boŞ
 
	gv¬
<
	gsq
<
	gT
>>::
	$£t_nÙhrow
(
PyObjeù
* 
py_obj
)

2832 
py_v¬
<
T_EQUIV
> 
pv
;

2833 
Œy


2835 
pv
=
py_v¬
<
T_EQUIV
>(
py_obj
);

2837 
	`ÿtch
()

2839 
Œy


2841 
pv
=
py_v¬
<
T_EQUIV
>(&
py_obj
);

2843 
	`ÿtch
()

2845  
çl£
;

2849 if(!
pv
.
	`is_sq
())

2850  
çl£
;

2852 if(!
v¬
<
T
>::
	`is_size_com·tibË_nÙhrow
(
pv
,v¬<T>::
__dsizes__
))

2853  
çl£
;

2855 
v¬
<
T
>::
	`£t
(
pv
);

2856  
Œue
;

2857 
	}
}

2861 
	g‹m¶©e
<
şass
 
	gT
>

2862 
	g¡d
::
¡ršg
 
v¬
<
sq
<
T
>>::
	$ty³_Çme
()

2864 if(
V¬
::
¿nk
==0)

2865  
v¬
<
T
>::
	`ty³_Çme
();

2866 if(
V¬
::
¿nk
==1)

2867  
v¬
<
T
>::
	`ty³_Çme
();

2868 if(
V¬
::
¿nk
==2)

2869  
¡d
::
	`¡ršg
("squ¬")+
v¬
<
T
>::
	`ty³_Çme
();

2870 if(
V¬
::
¿nk
==3)

2871  
¡d
::
	`¡ršg
("cub")+
v¬
<
T
>::
	`ty³_Çme
();

2873  
¡d
::
	`¡ršg
("hy³r_cub")+
v¬
<
T
>::
	`ty³_Çme
();

2874 
	}
}

	@var_op.h

1 #iâdeà
__MAPP__v¬_İ__


2 
	#__MAPP__v¬_İ__


	)

3 
	~"v¬.h
"

4 
	~<m­
>

8 
Çme¥aû
 
	gMAPP_NS


10 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

11 şas 
	cOB


13 
	g´iv©e
:

14 
´Ùeùed
:

15 
public
:

16 
PyObjeù
* 
ob
;

17 
OB
();

18 ~
OB
();

19 
OB
(
O
* 
__ob
);

20 
OB
(
PyObjeù
* 
__ob
);

21 
OB
(cÚ¡ OB& 
r
);

22 
OB
(OB&& 
r
);

23 
	gOB
& 
	gİ”©Ü
=(cÚ¡ 
OB
& 
r
);

24 
	gOB
& 
	gİ”©Ü
=(
OB
&& 
r
);

25 
	gOB
& 
	gİ”©Ü
=(
PyObjeù
* 
r
);

26 
İ”©Ü
 
	gPyObjeù
*&();

30 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

34 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

35 
	gOB
<
	gO
,
	gT
>::
	$OB
()

37 
ob
=
NULL
;

38 
	}
}

42 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

43 
	gOB
<
	gO
,
	gT
>::~
	$OB
()

45 if(
ob
è
	`Py_DECREF
(ob);

46 
	}
}

50 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

51 
	gOB
<
	gO
,
	gT
>::
	$OB
(
O
* 
__ob
):

52 
	`ob
(
»š‹½»t_ÿ¡
<
PyObjeù
*>(
__ob
))

54 if(
ob
è
	`Py_INCREF
(ob);

55 
	}
}

59 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

60 
	gOB
<
	gO
,
	gT
>::
	$OB
(
PyObjeù
* 
__ob
):

61 
	$ob
(
__ob
)

63 if(
ob
è
	`Py_INCREF
(ob);

64 
	}
}

68 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

69 
	gOB
<
	gO
,
	gT
>::
	$OB
(cÚ¡ 
OB
& 
r
):

70 
	$ob
(
r
.
ob
)

72 if(
ob
è
	`Py_INCREF
(ob);

73 
	}
}

77 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

78 
	gOB
<
	gO
,
	gT
>::
	$OB
(
OB
&& 
r
):

79 
	$ob
(
r
.
ob
)

81 
r
.
ob
=
NULL
;

82 
	}
}

86 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

87 
	gOB
<
	gO
,
	gT
>& OB<O,T>::
İ”©Ü
=(cÚ¡ 
OB
& 
r
)

89 if(
ob
è
Py_DECREF
(ob);

90 
	gob
=
r
.
ob
;

91 if(
	gob
è
Py_INCREF
(
ob
);

92  *
	gthis
;

97 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

98 
	gOB
<
	gO
,
	gT
>& OB<O,T>::
İ”©Ü
=(
OB
&& 
r
)

100 if(
ob
è
Py_DECREF
(ob);

101 
	gob
=
r
.
ob
;

102 
	gr
.
	gob
=
NULL
;

103  *
	gthis
;

108 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

109 
	gOB
<
	gO
,
	gT
>& OB<O,T>::
İ”©Ü
=(
PyObjeù
* 
r
)

111 if(
r
)

114 if(
r
->
ob_ty³
!=&
T
 &&„->ob_ty³->
_ba£
!=&Tè
throw
 0;

115 if(
	gob
è
Py_DECREF
(
ob
);

116 
	gob
=
r
;

117 if(
	gob
è
Py_INCREF
(
ob
);

118  *
	gthis
;

121 if(
	gob
è
Py_DECREF
(
ob
);

122 
	gob
=
NULL
;

123  *
	gthis
;

128 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

129 
	gOB
<
	gO
,
	gT
>::
İ”©Ü
 
PyObjeù
*&()

131  
ob
;

136 
Çme¥aû
 
	gMAPP_NS


138 
	g‹m¶©e
<
şass
 
	gC
>

139 
usšg
 
	gOP
=
OB
<
ty³Çme
 
C
::
Objeù
,
	gC
::
Ty³Objeù
>;

141 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>şas 
	gıp_ty³2ty³_num
<
	gOB
<O,T>>

142 {
	gpublic
:
cÚ¡ex´
 
ty³_num
(){ 
NPY_OBJECT
;};};

143 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>şas 
	gty³_©Œ
<
	gOB
<O,T>>

144 {
	gpublic
: cÚ¡ 
¡d
::
¡ršg
 
Çme
(); cÚ¡ 
	gOB
<
	gO
,
	gT
> 
	gz”o
;};

149 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

150 cÚ¡ 
	g¡d
::
¡ršg
 
ty³_©Œ
<
OB
<
O
,
	gT
>>::
	$Çme
(){ 
¡d
::
	`¡ršg
(
T
.
_Çme
);
	}
};

151 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

152 cÚ¡ 
	gOB
<
	gO
,
	gT
> 
	gty³_©Œ
<OB<O,T>>::
z”o
=
OB
<
O
,T>();

156 
Çme¥aû
 
	gMAPP_NS


158 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

159 
şass
 
	gpy_v¬
<
	gOB
<
	gO
,
	gT
>>

161 
ä›nd
 
şass
 
	gpy_v¬
<
	gOB
<
	gO
,
	gT
>*>;

162 
	g´iv©e
:

163 
py_v¬
(
size_t
*,*&);

164 
py_v¬
(,*,
PyObjeù
**&);

165 
py_v¬
Õy_v¬<
OB
<
O
,
T
>>&&);

166 
	gpublic
:

167 
OB
<
	tO
,
	tT
> 
	tT_BASE
;

168 
cÚ¡ex´
 
g‘_¿nk
(){ 0;}

169 
	gOB
<
	gO
,
	gT
> 
	gv®
;

170 
py_v¬
(
PyObjeù
*);

171 
py_v¬
();

172 ~
py_v¬
();

174 
py_v¬
(cÚ¡…y_v¬<
OB
<
O
,
T
>>&);

175 
İ”©Ü
 
	gOB
<
	gO
,
	gT
>(ècÚ¡{ 
	gv®
;}

176 
	gpy_v¬
<
	gOB
<
	gO
,
	gT
>>& 
	gİ”©Ü
=(cÚ¡ 
py_v¬
<
OB
<
O
,T>>&);

177 
	gpy_v¬
<
	gOB
<
	gO
,
	gT
>>& 
	gİ”©Ü
=(
py_v¬
<
OB
<
O
,T>>&&);

178 
boŞ
 
	gİ”©Ü
==(cÚ¡ 
py_v¬
<
OB
<
O
,
	gT
>>&);

179 
	g¡d
::
¡ršg
 
”r_msg
();

180 cÚ¡ 
	g¡d
::
¡ršg
 
ty³_Çme
();

186 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

187 
	gpy_v¬
<
	gOB
<
	gO
,
	gT
>>::
	$py_v¬
():

188 
	`v®
(
ty³_©Œ
<
OB
<
O
,
T
>>::
z”o
)

190 
	}
}

194 
‹m¶©e
<
şass
 
O
,
	gPyTy³Objeù
& 
	gT
>

195 
	gpy_v¬
<
	gOB
<
	gO
,
	gT
>>::
	$py_v¬
(
PyObjeù
* 
İ
):

196 
	`v®
(
ty³_©Œ
<
OB
<
O
,
T
>>::
z”o
)

198 
Œy


200 
v®
=
İ
;

202 
	`ÿtch
()

204 
throw
 1;

206 
	}
}

210 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

211 
	gpy_v¬
<
	gOB
<
	gO
,
	gT
>>::
	$py_v¬
(
d•th
,* 
sz
,
PyObjeù
**& 
objs
)

213 
this
->~
py_v¬
<
OB
<
O
,
T
>>();

214 
Œy


216 
	`Ãw
 (
this
è
py_v¬
<
OB
<
O
,
T
>>(*
objs
);

218 
	`ÿtch
()

220 
throw
 1;

222 
objs
++;

223 
	}
}

227 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

228 
	gpy_v¬
<
	gOB
<
	gO
,
	gT
>>::
	$py_v¬
(
size_t
*,*& 
d©a
)

230 
PyObjeù
** 
d
=
»š‹½»t_ÿ¡
<PyObjeù**>(
d©a
);

231 
Œy


233 
v®
=*
d
;

235 
	`ÿtch
()

237 
throw
 1;

239 
d©a
=
d
+1;

240 
	}
}

244 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

245 
	gpy_v¬
<
	gOB
<
	gO
,
	gT
>>::~
	$py_v¬
()

247 
	}
}

251 
‹m¶©e
<
şass
 
O
,
	gPyTy³Objeù
& 
	gT
>

252 
	gpy_v¬
<
	gOB
<
	gO
,
	gT
>>::
py_v¬
(cÚ¡…y_v¬<
OB
<
O
,
T
>>& 
r
):

253 
	$v®
(
r
.
v®
)

255 
	}
}

259 
‹m¶©e
<
şass
 
O
,
	gPyTy³Objeù
& 
	gT
>

260 
	gpy_v¬
<
	gOB
<
	gO
,
	gT
>>&…y_v¬<OB<O,T>>::
İ”©Ü
=(cÚ¡ 
py_v¬
<
OB
<
O
,T>>& 
	gr
)

262 
	gthis
->~
	gpy_v¬
<
	gOB
<
	gO
,
	gT
>>();

263 
Ãw
 (
this
è
	gpy_v¬
<
	gOB
<
	gO
,
	gT
>>(
	gr
);

264  *
	gthis
;

269 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

270 
	gpy_v¬
<
	gOB
<
	gO
,
	gT
>>::
py_v¬
Õy_v¬<
OB
<
O
,
T
>>&& 
r
):

271 
v®
(
¡d
::
	$move
(
r
.
v®
))

273 
	}
}

277 
‹m¶©e
<
şass
 
O
,
	gPyTy³Objeù
& 
	gT
>

278 
	gpy_v¬
<
	gOB
<
	gO
,
	gT
>>&…y_v¬<OB<O,T>>::
İ”©Ü
=(
py_v¬
<
OB
<
O
,T>>&& 
	gr
)

280 
	gthis
->~
	gpy_v¬
<
	gOB
<
	gO
,
	gT
>>();

281 
Ãw
 (
this
è
	gpy_v¬
<
	gOB
<
	gO
,
	gT
>>(
	g¡d
::
move
(
r
));

282  *
	gthis
;

287 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

288 
boŞ
 
	gpy_v¬
<
	gOB
<
	gO
,
	gT
>>::
İ”©Ü
==(cÚ¡ 
py_v¬
<
OB
<
O
,T>>& 
	gr
)

290  (
	gthis
->
	gv®
==
r
.
v®
);

295 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

296 
	g¡d
::
¡ršg
 
py_v¬
<
OB
<
O
,
	gT
>>::
	$”r_msg
()

298  "fŸlu»Ødeduû C++y³ <"+
¡d
::
	`¡ršg
(
T
.
_Çme
)+">";

299 
	}
}

303 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

304 cÚ¡ 
	g¡d
::
¡ršg
 
py_v¬
<
OB
<
O
,
	gT
>>::
	$ty³_Çme
()

306  
¡d
::
	`¡ršg
(
T
.
_Çme
);

307 
	}
}

311 
Çme¥aû
 
	gMAPP_NS


313 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

314 
şass
 
	gv¬
<
	gOB
<
	gO
,
	gT
>>:
public
 
V¬


316 
´iv©e
:

317 
´Ùeùed
:

318 cÚ¡ * 
g‘_±r
();

319 
	gpublic
:

321 
OB
<
	tO
,
	tT
> 
	tT_BASE
;

322 
T_BASE
 
	tT_EQUIV
;

323 
cÚ¡ex´
 
g‘_¿nk
();

324 
size_t
 
ba£_hash_code
();

325 
®loÿ‹
(**,
OB
<
O
,
T
>&,
size_t
*);

326 
d—Îoÿ‹
(
OB
<
O
,
T
>&);

327 
accum_size
(
py_v¬
<
T_EQUIV
>&,
size_t
*){};

328 
boŞ
 
is_size_com·tibË_nÙhrow
(
py_v¬
<
T_EQUIV
>&,
v¬
<
size_t
>**);

329 
is_size_com·tibË
(
py_v¬
<
T_EQUIV
>&,cÚ¡ 
¡d
::
¡ršg
&,
v¬
<
size_t
>**);

330 
	g¡d
::
¡ršg
 
ty³_Çme
(
v¬
<
size_t
>**);

331 
PyObjeù
* 
bud
(
O
*&,
size_t
**);

333 
	gOB
<
	gO
,
	gT
>* 
	g±r
;

335 
v¬
(
OB
<
O
,
T
>&,const *);

337 
v¬
(
OB
<
O
,
T
>&,
¡d
::
¡ršg
&&,
py_v¬
<
T_EQUIV
>&,**);

338 
v¬
();

339 ~
v¬
();

340 
v¬
(
OB
<
O
,
T
>&&);

341 
v¬
(cÚ¡ v¬<
OB
<
O
,
T
>>&);

342 
v¬
(v¬<
OB
<
O
,
T
>>&&);

343 
	gv¬
<
	gOB
<
	gO
,
	gT
>>& 
	gİ”©Ü
=(cÚ¡ 
v¬
<
OB
<
O
,T>>&);

344 
	gv¬
<
	gOB
<
	gO
,
	gT
>>& 
	gİ”©Ü
ğ(
v¬
<
OB
<
O
,T>>&&);

345 
	gv¬
<
	gOB
<
	gO
,
	gT
>>& 
	gİ”©Ü
=(cÚ¡ 
OB
<
O
,T>&);

346 
V¬
* 
şÚe
();

348 
İ”©Ü
 
	gPyObjeù
*() const;

349 
	gv¬
<
	gOB
<
	gO
,
	gT
>>& 
	gİ”©Ü
 [] (cÚ¡ 
	gsize_t
);

350 
£t
(
PyObjeù
*);

351 
boŞ
 
£t_nÙhrow
(
PyObjeù
*);

352 
PyObjeù
* 
g‘
();

354 
	g¡d
::
¡ršg
 
ty³_Çme
(){ 
¡d
::¡ršg(
T
.
_Çme
);}

356 
boŞ
 
	gİ”©Ü
==(
V¬
&){ 
çl£
;};

357 
boŞ
 
	gİ”©Ü
!=(
V¬
&){ 
çl£
;};

358 
boŞ
 
	gİ”©Ü
> (
	gV¬
&){ 
	gçl£
;};

359 
boŞ
 
	gİ”©Ü
< (
	gV¬
&){ 
	gçl£
;};

360 
boŞ
 
	gİ”©Ü
>=(
V¬
&){ 
çl£
;};

361 
boŞ
 
	gİ”©Ü
<=(
V¬
&){ 
çl£
;};

367 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

368 
cÚ¡ex´
 
	gv¬
<
	gOB
<
	gO
,
	gT
>>::
	$g‘_¿nk
()

371 
	}
}

375 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

376 
size_t
 
	gv¬
<
	gOB
<
	gO
,
	gT
>>::
	$ba£_hash_code
()

380 
	}
}

384 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

385 
	gv¬
<
	gOB
<
	gO
,
	gT
>>::
®loÿ‹
(**,
OB
<
O
,
T
>&,
size_t
*)

390 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

391 
	gv¬
<
	gOB
<
	gO
,
	gT
>>::
d—Îoÿ‹
(
OB
<
O
,
T
>&)

396 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

397 
boŞ
 
	gv¬
<
	gOB
<
	gO
,
	gT
>>::
is_size_com·tibË_nÙhrow
(
py_v¬
<
T_EQUIV
>&,
v¬
<
size_t
>**)

399  
	gŒue
;

404 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

405 
	gv¬
<
	gOB
<
	gO
,
	gT
>>::
is_size_com·tibË
(
py_v¬
<
T_EQUIV
>&,cÚ¡ 
¡d
::
¡ršg
&,
v¬
<
size_t
>**)

411 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

412 
	g¡d
::
¡ršg
 
v¬
<
OB
<
O
,
	gT
>>::
ty³_Çme
(v¬<
size_t
>**)

414  
¡d
::
¡ršg
();

419 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

420 
PyObjeù
* 
	gv¬
<
	gOB
<
	gO
,
	gT
>>::
	$bud
(
O
*& 
v
,
size_t
**)

422  
»š‹½»t_ÿ¡
<
PyObjeù
*>(
v
);

423 
	}
}

428 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

429 
	gv¬
<
	gOB
<
	gO
,
	gT
>>::
v¬
(
OB
<
O
,
T
>& 
v
,cÚ¡ * 
Çme_
):

430 
±r
(&
v
),

431 
V¬
(
g‘_¿nk
(),
ba£_hash_code
(),
Çme_
)

433 
	gsize
=1;

440 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

441 
	gv¬
<
	gOB
<
	gO
,
	gT
>>::
v¬
(
OB
<
O
,
T
>& 
v
,
¡d
::
¡ršg
&& 
Çme_
,
py_v¬
<
T_EQUIV
>& 
pv
,**):

442 
±r
(&
v
),

443 
V¬
(
g‘_¿nk
(),
ba£_hash_code
(),
¡d
::
	$move
(
Çme_
))

445 
size
=1;

446 
v
=
pv
;

447 
	}
}

453 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

454 
	gv¬
<
	gOB
<
	gO
,
	gT
>>::
	$v¬
():

455 
	`±r
(
NULL
),

456 
	`V¬
(
	`g‘_¿nk
(),
	$ba£_hash_code
())

458 
size
=0;

459 
	}
}

463 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

464 
	gv¬
<
	gOB
<
	gO
,
	gT
>>::~
	$v¬
()

465 {
	}
}

469 
‹m¶©e
<
şass
 
O
,
	gPyTy³Objeù
& 
	gT
>

470 
	gv¬
<
	gOB
<
	gO
,
	gT
>>::
v¬
(cÚ¡ v¬<
OB
<
O
,
T
>>& 
r
):

471 
V¬
(
¡©ic_ÿ¡
<cÚ¡ V¬&>(
r
)),

472 
	$±r
(
r
.
±r
)

473 {
	}
}

477 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

478 
	gv¬
<
	gOB
<
	gO
,
	gT
>>::
v¬
(v¬<
OB
<
O
,
T
>>&& 
r
):

479 
V¬
(
¡©ic_ÿ¡
<V¬&&>(
r
)),

480 
	$±r
(
r
.
±r
)

481 {
	}
}

485 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

486 
	gv¬
<
	gOB
<
	gO
,
	gT
>>& v¬<OB<O,T>>::
İ”©Ü
=(cÚ¡ 
v¬
<
OB
<
O
,T>>& 
	gr
)

488 
	gthis
-> ~
	gv¬
<
	gOB
<
	gO
,
	gT
>>();

489 
Ãw
 (
this
è
	gv¬
<
	gOB
<
	gO
,
	gT
>>(
	gr
);

490  *
	gthis
;

495 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

496 
	gv¬
<
	gOB
<
	gO
,
	gT
>>& v¬<OB<O,T>>::
İ”©Ü
=(
v¬
<
OB
<
O
,T>>&& 
	gr
)

498 
	gthis
-> ~
	gv¬
<
	gOB
<
	gO
,
	gT
>>();

499 
Ãw
 (
this
è
	gv¬
<
	gOB
<
	gO
,
	gT
>>(
	g¡d
::
move
(
r
));

500  *
	gthis
;

505 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

506 
	gv¬
<
	gOB
<
	gO
,
	gT
>>& v¬<OB<O,T>>::
İ”©Ü
=(cÚ¡ 
OB
<
O
,T>& 
	gr
)

508 
	g±r
=&
r
;

509  *
	gthis
;

514 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

515 
V¬
* 
	gv¬
<
	gOB
<
	gO
,
	gT
>>::
	$şÚe
()

517  
Ãw
 
v¬
<
OB
<
O
,
T
>>(*
this
);

518 
	}
}

522 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

523 cÚ¡ * 
	gv¬
<
	gOB
<
	gO
,
	gT
>>::
	$g‘_±r
()

525  
±r
;

526 
	}
}

530 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

531 
	gv¬
<
	gOB
<
	gO
,
	gT
>>::
İ”©Ü
 
PyObjeù
*() const

533  *
±r
;

538 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

539 
	gv¬
<
	gOB
<
	gO
,
	gT
>>& v¬<OB<O,T>>::
İ”©Ü
[](cÚ¡ 
size_t
)

541  *
this
;

546 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

547 
	gv¬
<
	gOB
<
	gO
,
	gT
>>::
	$£t
(
PyObjeù
* 
py_obj
)

549 
Œy


551 *
±r
=
py_obj
;

553 
	`ÿtch
()

555 
throw
 "fŸlu»Ødeduûy³ <"+
	`ty³_Çme
()+">";

557 
	}
}

561 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

562 
boŞ
 
	gv¬
<
	gOB
<
	gO
,
	gT
>>::
	$£t_nÙhrow
(
PyObjeù
* 
py_obj
)

564 
Œy


566 *
±r
=
py_obj
;

568 
	`ÿtch
()

570  
çl£
;

572  
Œue
;

573 
	}
}

577 
	g‹m¶©e
<
şass
 
	gO
,
	gPyTy³Objeù
& 
	gT
>

578 
PyObjeù
* 
	gv¬
<
	gOB
<
	gO
,
	gT
>>::
	$g‘
()

580  
±r
->
ob
;

581 
	}
}

586 
Çme¥aû
 
	gMAPP_NS


588 
	g‹m¶©e
<
şass
 
	gT0
,şas 
	gT1
>

589 
şass
 
	gpy_v¬
<
	g¡d
::
m­
<
T0
,
	gT1
>>

591 
ä›nd
 
şass
 
	gpy_v¬
<
	g¡d
::
m­
<
T0
,
	gT1
>*>;

592 
	g´iv©e
:

593 
py_v¬
(
size_t
*,*&);

594 
py_v¬
(,*,
PyObjeù
**&);

595 
py_v¬
Õy_v¬<
¡d
::
m­
<
T0
,
T1
>>&&);

596 
	gpublic
:

597 
¡d
::
	tm­
<
	tT0
,
	tT1
> 
	tT_BASE
;

598 
cÚ¡ex´
 
g‘_¿nk
(){ 0;}

599 
	g¡d
::
m­
<
T0
,
	gT1
> 
	gv®
;

600 
py_v¬
(
PyObjeù
*);

601 
py_v¬
();

602 ~
py_v¬
();

604 
py_v¬
(cÚ¡…y_v¬<
¡d
::
m­
<
T0
,
T1
>>&);

605 
İ”©Ü
 
	g¡d
::
m­
<
T0
,
	gT1
>(ècÚ¡{ 
	gv®
;}

606 
	gpy_v¬
<
	g¡d
::
m­
<
T0
,
	gT1
>>& 
	gİ”©Ü
=(cÚ¡ 
py_v¬
<
¡d
::map<T0,T1>>&);

607 
	gpy_v¬
<
	g¡d
::
m­
<
T0
,
	gT1
>>& 
	gİ”©Ü
=(
py_v¬
<
¡d
::map<T0,T1>>&&);

608 
boŞ
 
	gİ”©Ü
==(cÚ¡ 
py_v¬
<
¡d
::
m­
<
T0
,
	gT1
>>&);

609 
	g¡d
::
¡ršg
 
”r_msg
();

610 cÚ¡ 
	g¡d
::
¡ršg
 
ty³_Çme
();

616 
	g‹m¶©e
<
şass
 
	gT0
,şas 
	gT1
>

617 
	gpy_v¬
<
	g¡d
::
m­
<
T0
,
	gT1
>>::
	$py_v¬
():

618 
	`v®
(
ty³_©Œ
<
¡d
::
m­
<
T0
,
T1
>>::
z”o
)

620 
	}
}

624 
‹m¶©e
<
şass
 
T0
,şas 
	gT1
>

625 
	gpy_v¬
<
	g¡d
::
m­
<
T0
,
	gT1
>>::
	$py_v¬
(
PyObjeù
* 
İ
):

626 
	`v®
(
ty³_©Œ
<
¡d
::
m­
<
T0
,
T1
>>::
z”o
)

628 if(!
	`PyDiù_Check
(
İ
))

629 
throw
 1;

630 
PyObjeù
* 
keys
=
	`PyDiù_Keys
(
İ
);

631 
PyObjeù
* 
v®s
=
	`PyDiù_V®ues
(
İ
);

632 
py_v¬
<
T0
*> 
__keys
;

633 
py_v¬
<
T1
*> 
__v®s
;

634 
Œy


636 
__keys
=
py_v¬
<
T0
*>(
keys
);

637 
__v®s
=
py_v¬
<
T1
*>(
v®s
);

640 
	`ÿtch
()

642 
	`Py_DECREF
(
keys
);

643 
	`Py_DECREF
(
v®s
);

644 
throw
 1;

647 
v®
.
	`ş—r
();

648 
size_t
 
i
=0;i<
	`Py_SIZE
(
keys
);i++)

649 
v®
[
__keys
[
i
].v®]=
__v®s
[i].val;

651 
	`Py_DECREF
(
keys
);

652 
	`Py_DECREF
(
v®s
);

653 
	}
}

657 
	g‹m¶©e
<
şass
 
	gT0
,şas 
	gT1
>

658 
	gpy_v¬
<
	g¡d
::
m­
<
T0
,
	gT1
>>::
	$py_v¬
(
d•th
,* 
sz
,
PyObjeù
**& 
objs
)

660 
this
->~
py_v¬
<
¡d
::
m­
<
T0
,
T1
>>();

661 
Œy


663 
	`Ãw
 (
this
è
py_v¬
<
¡d
::
m­
<
T0
,
T1
>>(*
objs
);

665 
	`ÿtch
()

667 
throw
 1;

669 
objs
++;

670 
	}
}

674 
	g‹m¶©e
<
şass
 
	gT0
,şas 
	gT1
>

675 
	gpy_v¬
<
	g¡d
::
m­
<
T0
,
	gT1
>>::
	$py_v¬
(
size_t
*,*& 
d©a
)

677 
PyObjeù
** 
d
=
»š‹½»t_ÿ¡
<PyObjeù**>(
d©a
);

678 if(!
	`PyDiù_Check
(*
d
))

679 
throw
 1;

680 
PyObjeù
* 
keys
=
	`PyDiù_Keys
(*
d
);

681 
PyObjeù
* 
v®s
=
	`PyDiù_V®ues
(*
d
);

682 
py_v¬
<
T0
*> 
__keys
;

683 
py_v¬
<
T1
*> 
__v®s
;

684 
Œy


686 
__keys
=
py_v¬
<
T0
*>(
keys
);

687 
__v®s
=
py_v¬
<
T1
*>(
v®s
);

690 
	`ÿtch
()

692 
	`Py_DECREF
(
keys
);

693 
	`Py_DECREF
(
v®s
);

694 
throw
 1;

697 
v®
.
	`ş—r
();

698 
size_t
 
i
=0;i<
	`Py_SIZE
(
keys
);i++)

699 
v®
[
__keys
[
i
].v®]=
__v®s
[i].val;

701 
	`Py_DECREF
(
keys
);

702 
	`Py_DECREF
(
v®s
);

703 
d©a
=
d
+1;

704 
	}
}

708 
	g‹m¶©e
<
şass
 
	gT0
,şas 
	gT1
>

709 
	gpy_v¬
<
	g¡d
::
m­
<
T0
,
	gT1
>>::~
	$py_v¬
()

711 
	}
}

715 
‹m¶©e
<
şass
 
T0
,şas 
	gT1
>

716 
	gpy_v¬
<
	g¡d
::
m­
<
T0
,
	gT1
>>::
py_v¬
(cÚ¡…y_v¬<
¡d
::m­<T0,
T1
>>& 
r
):

717 
	$v®
(
r
.
v®
)

719 
	}
}

723 
‹m¶©e
<
şass
 
T0
,şas 
	gT1
>

724 
	gpy_v¬
<
	g¡d
::
m­
<
T0
,
	gT1
>>&…y_v¬<¡d::m­<T0,T1>>::
İ”©Ü
=(cÚ¡ 
py_v¬
<
¡d
::m­<T0,T1>>& 
	gr
)

726 
	gthis
->~
	gpy_v¬
<
	g¡d
::
m­
<
T0
,
	gT1
>>();

727 
Ãw
 (
this
è
	gpy_v¬
<
	g¡d
::
m­
<
T0
,
	gT1
>>(
	gr
);

728  *
	gthis
;

733 
	g‹m¶©e
<
şass
 
	gT0
,şas 
	gT1
>

734 
	gpy_v¬
<
	g¡d
::
m­
<
T0
,
	gT1
>>::
py_v¬
Õy_v¬<
¡d
::m­<T0,
T1
>>&& 
r
):

735 
v®
(
¡d
::
	$move
(
r
.
v®
))

737 
	}
}

741 
‹m¶©e
<
şass
 
T0
,şas 
	gT1
>

742 
	gpy_v¬
<
	g¡d
::
m­
<
T0
,
	gT1
>>&…y_v¬<¡d::m­<T0,T1>>::
İ”©Ü
=(
py_v¬
<
¡d
::m­<T0,T1>>&& 
	gr
)

744 
	gthis
->~
	gpy_v¬
<
	g¡d
::
m­
<
T0
,
	gT1
>>();

745 
Ãw
 (
this
è
	gpy_v¬
<
	g¡d
::
m­
<
T0
,
	gT1
>>(¡d::
move
(
r
));

746  *
	gthis
;

751 
	g‹m¶©e
<
şass
 
	gT0
,şas 
	gT1
>

752 
boŞ
 
	gpy_v¬
<
	g¡d
::
m­
<
T0
,
	gT1
>>::
İ”©Ü
==(cÚ¡ 
py_v¬
<
¡d
::m­<T0,T1>>& 
	gr
)

754  (
	gthis
->
	gv®
==
r
.
v®
);

759 
	g‹m¶©e
<
şass
 
	gT0
,şas 
	gT1
>

760 
	g¡d
::
¡ršg
 
py_v¬
<
¡d
::
m­
<
T0
,
	gT1
>>::
	$”r_msg
()

762  "fŸlu»Ødeduû C++y³ <m­ "+
ty³_©Œ
<
T0
>::
	`Çme
()+" "+ty³_©Œ<
T1
>::name()+">";

763 
	}
}

767 
	g‹m¶©e
<
şass
 
	gT0
,şas 
	gT1
>

768 cÚ¡ 
	g¡d
::
¡ršg
 
py_v¬
<
¡d
::
m­
<
T0
,
	gT1
>>::
	$ty³_Çme
()

770  "m­ "+
ty³_©Œ
<
T0
>::
	`Çme
()+" "+ty³_©Œ<
T1
>::name();

771 
	}
}

	@xmath.cpp

1 
	~"xm©h.h
"

2 
	#TOLERANCE
 1.0e-10

	)

3 
	~<c¡ršg
>

4 
	~"memÜy.h
"

5 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

11 
	gXM©h
::
	$çc_li¡
(
no
,
dim
,*& 
li¡
,& 
li¡_sz
)

13 
li¡_sz
=0;

14 
li¡
=
NULL
;

15 * 
tmp_li¡
=
Ãw
 [
dim
];

16 
	`çc_li¡_»c
(
no
,
dim
,0,
tmp_li¡
,
li¡
,
li¡_sz
);

17 
d–‘e
 [] 
tmp_li¡
;

18 
	}
}

22 
	gXM©h
::
	$çc_li¡_»c
(
no
,
idim
,
os
,

23 *& 
tmp_li¡
,*& 
li¡
,& 
li¡_sz
)

26 if(
idim
>1)

28 
i
=1;i<=
no
;i++)

29 if(
no
%
i
==0)

31 
tmp_li¡
[
os
]=
i
;

32 
	`çc_li¡_»c
(
no
/
i
,
idim
-1,
os
+1,
tmp_li¡
,
li¡
,
li¡_sz
);

37 
tmp_li¡
[
os
]=
no
;

38 * 
li¡_
=
Ãw
 [(
li¡_sz
+1)*(
os
+1)];

39 
	`memıy
(
li¡_
,
li¡
,
li¡_sz
*(
os
+1)*());

40 
	`memıy
(
li¡_
+(
os
+1)*
li¡_sz
,
tmp_li¡
,(ipos+1)*());

41 
d–‘e
 [] 
li¡
;

42 
li¡
=
li¡_
;

43 
li¡_sz
++;

45 
	}
}

49 
	gXM©h
::
squ¬e2lo_Œi
(
ty³0
(&
H_Şd
)[3][3],ty³0(&
H_Ãw
)[3][3])

51 
ty³0
** 
	gQ
=
Ãw
ype0*[3];

52 
	gidim
=0;idim<3;idim++)

53 
	gQ
[
idim
]=
Ãw
 
ty³0
[3];

55 
ty³0
 
	gH0H0
;

56 
ty³0
 
	gH0H1
;

57 
	gH0H0
=
H0H1
=0.0;

58 
	gi
=0;i<3;i++)

60 
	gH0H0
+=
H_Şd
[0][
i
]*H_old[0][i];

61 
	gH0H1
+=
H_Şd
[0][
i
]*H_old[1][i];

63 
	gQ
[0][0]=
H_Şd
[0][0];

64 
	gQ
[0][1]=
H_Şd
[0][1];

65 
	gQ
[0][2]=
H_Şd
[0][2];

66 
	gQ
[1][0]=
H0H0
*
H_Şd
[1][0]-
H0H1
*H_old[0][0];

67 
	gQ
[1][1]=
H0H0
*
H_Şd
[1][1]-
H0H1
*H_old[0][1];

68 
	gQ
[1][2]=
H0H0
*
H_Şd
[1][2]-
H0H1
*H_old[0][2];

69 
	gQ
[2][0]=
H_Şd
[0][1]*H_old[1][2]-H_old[0][2]*H_old[1][1];

70 
	gQ
[2][1]=
H_Şd
[0][2]*H_old[1][0]-H_old[0][0]*H_old[1][2];

71 
	gQ
[2][2]=
H_Şd
[0][0]*H_old[1][1]-H_old[0][1]*H_old[1][0];

72 
	gi
=0;i<3;i++)

74 
	gH0H0
=0.0;

75 
	gj
=0;j<3;j++)

76 
	gH0H0
+=
Q
[
i
][
j
]*Q[i][j];

78 
	gH0H1
=
sq¹
(
H0H0
);

79 
	gj
=0;j<3;j++)

80 
	gQ
[
i
][
j
]/=
H0H1
;

83 
	gi
=0;i<3;i++)

84 
	gj
=0;j<3;j++)

85 
	gH_Ãw
[
i
][
j
]=0.0;

87 
	gi
=0;i<3;i++)

88 
	gj
=0;j<
	gi
+1;j++)

90 
	gk
=0;k<3;k++)

91 
	gH_Ãw
[
i
][
j
]+=
H_Şd
[i][
k
]*
Q
[j][k];

94 
	gi
=0;i<3;i++)

95 
	gd–‘e
 [] 
	gQ
[
i
];

96 
	gd–‘e
 [] 
	gQ
;

102 
	gXM©h
::
	$šv”t
(
ty³0
** 
A
,ty³0** 
Ašv
,
dim
)

104 if(
dim
==0)

108 
ty³0
** 
ATA
=
Ãw
y³0*[
dim
];

109 
idim
=0;idim<
dim
;idim++)

110 
ATA
[
idim
]=
Ãw
 
ty³0
[
dim
];

111 
ty³0
* 
c
=
Ãw
y³0[
dim
];

112 
ty³0
* 
x
=
Ãw
y³0[
dim
];

113 
ty³0
* 
g
=
Ãw
y³0[
dim
];

114 
ty³0
* 
g0
=
Ãw
y³0[
dim
];

115 
ty³0
* 
h
=
Ãw
y³0[
dim
];

116 
ty³0
 
a0
,
a1
,
®pha
;

117 
ty³0
 
g0g0
,
gg
,
gg0
,
¿tio
;

119 
i
=0;i<
dim
;i++)

120 
j
=0;j<
dim
;j++)

121 
Ašv
[
i
][
j
]=
ATA
[i][j]=0.0;

123 
i
=0;i<
dim
;i++)

124 
j
=0;j<
dim
;j++)

125 
k
=0;k<
dim
;k++)

126 
ATA
[
i
][
j
]+=
A
[
k
][i]*A[k][j];

128 
™ry
=0;™ry<
dim
;itry++)

130 
i
=0;i<
dim
;i++)

132 
c
[
i
]=
A
[
™ry
][i];

133 
x
[
i
]=
c
[i];

137 
g0g0
=0.0;

138 
i
=0;i<
dim
;i++)

140 
h
[
i
]=2.0*
c
[i];

141 
j
=0;j<
dim
;j++)

142 
h
[
i
]-=2.0*
ATA
[i][
j
]*
x
[j];

143 
g
[
i
]=
h
[i];

144 
g0g0
+=
h
[
i
]*h[i];

147 
jŒy
=0;

148 
”rÜ
=1.0;

149 
jŒy
<
dim
+1 && 
”rÜ
!=0.0)

152 if(
g0g0
==0.0)

154 
”rÜ
=0.0;

159 
a0
=0.0;

160 
a1
=0.0;

161 
i
=0;i<
dim
;i++)

163 
a0
+=
h
[
i
]*
g
[i];

164 
j
=0;j<
dim
;j++)

165 
a1
+=
h
[
i
]*
ATA
[i][
j
]*h[j];

167 if(
a1
==0.0)

169 
”rÜ
=0.0;

172 
®pha
=0.5*
a0
/
a1
;

174 
i
=0;i<
dim
;i++)

175 
x
[
i
]+=
®pha
*
h
[i];

179 
gg
=0.0;

180 
gg0
=0.0;

181 
i
=0;i<
dim
;i++)

183 
g
[
i
]=2.0*
c
[i];

184 
j
=0;j<
dim
;j++)

185 
g
[
i
]-=2.0*
ATA
[i][
j
]*
x
[j];

186 
gg
+=
g
[
i
]*g[i];

187 
gg0
+=
g0
[
i
]*
g
[i];

191 
¿tio
=(
gg
-
gg0
)/
g0g0
;

192 
g0g0
=
gg
;

195 
i
=0;i<
dim
;i++)

197 
h
[
i
]=
¿tio
*h[i]+
g
[i];

198 
g0
[
i
]=
g
[i];

202 
”rÜ
=0.0;

203 
i
=0;i<
dim
;i++)

205 
j
=0;j<
dim
;j++)

206 
”rÜ
+=
x
[
i
]*
ATA
[i][
j
]*x[i];

207 
”rÜ
-=2*
c
[
i
]*
x
[i];

209 
”rÜ
++;

211 
jŒy
++;

214 
i
=0;i<
dim
;i++)

215 
Ašv
[
i
][
™ry
]=
x
[i];

218 
i
=0;i<
dim
;i++)

219 
d–‘e
 [] 
ATA
[
i
];

220 
d–‘e
 [] 
ATA
;

221 
d–‘e
 [] 
c
;

222 
d–‘e
 [] 
x
;

223 
d–‘e
 [] 
g
;

224 
d–‘e
 [] 
g0
;

225 
d–‘e
 [] 
h
;

226 
	}
}

289 
	gXM©h
::
	$quad¿tu»_lg
(
n
,
ty³0
* 
x
,ty³0* 
w
)

291 
m
=
n
/2+1;

292 
™”
,
Üd
,
icurs
,
jcurs
;

293 
max_™”
=50;

294 
ty³0
 
a
,
u0
,
šv_u0
,
f
,
up
,
df
,
tmp0
,
tŞ
;

295 
ty³0
 
ii
,
jj
,
d–_u0
;

296 
ty³0
* 
p_cÛf
=
Ãw
y³0[
m
];

297 
ty³0
* 
dp_cÛf
=
Ãw
y³0[
m
];

299 
up
=0.0;

300 
i
=0;i<
m
;i++)

301 
p_cÛf
[
i
]=
dp_cÛf
[i]=0.0;

303 
p_cÛf
[0]=1.0;

305 
i
=1;i<
n
+1;i++)

307 
ii
=
¡©ic_ÿ¡
<
ty³0
>(
i
);

308 if(
i
%2==0)

310 
m
=
i
/2+1;

311 
p_cÛf
[
m
-1]=(2.0-1.0/
ii
)*p_coef[m-2];

312 
j
=
m
-2;j>0;j--)

314 
jj
=
¡©ic_ÿ¡
<
ty³0
>(
j
);

315 
p_cÛf
[
j
]*=-(2.0*
jj
+1)/
ii
;

316 
p_cÛf
[
j
]+=(1.0+(2*
jj
-1.0)/
ii
)*p_coef[j-1];

318 
p_cÛf
[0]*=-1.0/
ii
;

322 
m
=(
i
+1)/2;

323 
j
=0;j<
m
-1;j++)

325 
jj
=
¡©ic_ÿ¡
<
ty³0
>(
j
);

326 
p_cÛf
[
j
]*=1.0+2.0*
jj
/
ii
;

327 
p_cÛf
[
j
]-=2.0*(
jj
+1.0)*p_cÛf[j+1]/
ii
;

330 
p_cÛf
[
m
-1]*=2.0-1.0/
ii
;

334 
m
=
n
/2+1;

336 
i
=1;i<
m
;i++)

338 
dp_cÛf
[
i
-1]=
p_cÛf
[i]*
¡©ic_ÿ¡
<
ty³0
>(i);

341 
tŞ
=
¡d
::
num”ic_lim™s
<
ty³0
>::
	`•sÚ
();

342 
Üd
=
m
;

343 
icurs
=
n
-1;

344 
a
=
p_cÛf
[
m
-1];

346 
i
=0;i<
m
;i++)

347 
p_cÛf
[
i
]/=
a
;

348 
i
=1;i<
m
;i++)

349 
dp_cÛf
[
i
-1]/=
a
;

351 
Üd
>1)

353 
u0
=1.0;

354 
f
=1.0;

355 
d–_u0
=0.0;

356 
™”
=
max_™”
;

357 
	`çbs
(
f
)>
tŞ
 && 
™”
)

359 
u0
+=
d–_u0
;

360 
df
=
f
=0.0;

361 
tmp0
=1.0;

362 
j
=0;j<
Üd
-1;j++)

364 
f
+=
p_cÛf
[
j
]*
tmp0
;

365 
df
+=
dp_cÛf
[
j
]*
tmp0
;

366 
tmp0
*=
u0
;

368 
f
+=
p_cÛf
[
Üd
-1]*
tmp0
;

369 
d–_u0
=-
f
/
df
;

370 
™”
--;

373 
x
[
icurs
]=
	`sq¹
(
u0
);

375 
šv_u0
=1.0/
u0
;

376 
p_cÛf
[0]*=-
šv_u0
;

377 
i
=1;i<
Üd
-1;i++)

379 
p_cÛf
[
i
]*=-
šv_u0
;

380 
p_cÛf
[
i
]+=
šv_u0
*p_coef[i-1];

381 
dp_cÛf
[
i
-1]=
p_cÛf
[i]*
¡©ic_ÿ¡
<
ty³0
>(i);

384 
Üd
--;

385 
icurs
--;

387 
d–‘e
 [] 
p_cÛf
;

388 
d–‘e
 [] 
dp_cÛf
;

391 if(
n
%2==0)

393 
icurs
++;

394 
jcurs
=
icurs
-1;

395 
i
=
icurs
;i<
n
;i++)

397 
tmp0
=
a
;

398 
j
=
icurs
;j<
n
;j++)

400 if(
i
!=
j
)

401 
tmp0
*=
x
[
i
]*x[i]-x[
j
]*x[j];

403 
tmp0
*=
x
[
i
]+x[
j
];

405 
w
[
i
]=2.0/(
tmp0
*tmp0*(1.0-
x
[i]*x[i]));

406 
w
[
jcurs
]=w[
i
];

407 
x
[
jcurs
]=-x[
i
];

408 
jcurs
--;

413 
x
[
icurs
]=0.0;

414 
icurs
++;

415 
tmp0
=
a
;

416 
i
=
icurs
;i<
n
;i++)

417 
tmp0
*=-
x
[
i
]*x[i];

418 
w
[
icurs
-1]=2.0/(
tmp0
*tmp0);

420 
jcurs
=
icurs
-2;

421 
i
=
icurs
;i<
n
;i++)

423 
tmp0
=
a
*
x
[
i
];

424 
j
=
icurs
;j<
n
;j++)

426 if(
i
!=
j
)

427 
tmp0
*=
x
[
i
]*x[i]-x[
j
]*x[j];

429 
tmp0
*=
x
[
i
]+x[
j
];

431 
w
[
i
]=2.0/(
tmp0
*tmp0*(1.0-
x
[i]*x[i]));

432 
w
[
jcurs
]=w[
i
];

433 
x
[
jcurs
]=-x[
i
];

434 
jcurs
--;

437 
	}
}

441 
	gXM©h
::
	$quad¿tu»_hg
(
n
,
ty³0
* 
x
,ty³0* 
w
)

443 
m
=
n
/2+1;

444 
™”
,
Üd
,
icurs
;

445 
max_™”
=50;

446 
ty³0
 
a
,
u0
,
f
,
up
,
df
,
tmp0
,
tŞ
,
tmp1
;

447 
ty³0
 
ii
,
d–_u0
;

450 
ty³0
* 
p_1
=
Ãw
y³0[
m
];

451 
ty³0
* 
p_2
=
Ãw
y³0[
m
];

452 
ty³0
* 
p_cÛf
=
Ãw
y³0[
m
];

453 
ty³0
* 
dp_cÛf
=
Ãw
y³0[
m
];

455 
up
=0.0;

456 
i
=0;i<
m
;i++)

457 
p_1
[
i
]=
p_2
[i]=
p_cÛf
[i]=
dp_cÛf
[i]=0.0;

459 
p_1
[0]=1.0;

460 
p_cÛf
[0]=1.0;

464 
i
=1;i<
n
+1;i++)

466 
ii
=
¡©ic_ÿ¡
<
ty³0
>(
i
);

467 
m
=
i
/2+1;

468 if(
i
%2==0)

470 
j
=0;j<
m
;j++)

471 
p_cÛf
[
j
]=-2.0*(
ii
-1.0)*
p_2
[j];

472 
j
=1;j<
m
;j++)

473 
p_cÛf
[
j
]+=2.0*
p_1
[j-1];

477 
j
=0;j<
m
;j++)

478 
p_cÛf
[
j
]=2.0*
p_1
[j]-2.0*(
ii
-1.0)*
p_2
[j];

481 
j
=0;j<
m
;j++)

483 
p_2
[
j
]=
p_1
[j];

484 
p_1
[
j
]=
p_cÛf
[j];

488 
m
=
n
/2+1;

491 
i
=1;i<
m
;i++)

493 
dp_cÛf
[
i
-1]=
p_cÛf
[i]*
¡©ic_ÿ¡
<
ty³0
>(i);

496 
tŞ
=
¡d
::
num”ic_lim™s
<
ty³0
>::
	`•sÚ
();

497 
Üd
=
m
;

498 
icurs
=
n
/2;

499 if(
n
%2==1)

501 
x
[
icurs
]=0.0;

502 
icurs
++;

505 
a
=
p_cÛf
[
m
-1];

507 
i
=0;i<
m
;i++)

508 
p_cÛf
[
i
]/=
a
;

509 
i
=1;i<
m
;i++)

510 
dp_cÛf
[
i
-1]/=
a
;

514 
Üd
>1)

516 
u0
=0.0;

517 
f
=1.0;

518 
d–_u0
=0.0;

519 
™”
=
max_™”
;

520 
	`çbs
(
f
)>
tŞ
 && 
™”
)

522 
u0
+=
d–_u0
;

523 
df
=
f
=0.0;

524 
tmp0
=1.0;

525 
j
=0;j<
Üd
-1;j++)

527 
f
+=
p_cÛf
[
j
]*
tmp0
;

528 
df
+=
dp_cÛf
[
j
]*
tmp0
;

529 
tmp0
*=
u0
;

531 
f
+=
p_cÛf
[
Üd
-1]*
tmp0
;

532 
d–_u0
=-
f
/
df
;

533 
™”
--;

536 
x
[
icurs
]=
	`sq¹
(
u0
);

538 
tmp0
=1.0;

539 
tmp1
=0.0;

540 
i
=0;i<
m
;i++)

542 
tmp1
+=
p_2
[
i
]*
tmp0
;

543 
tmp0
*=
u0
;

546 if(
n
%2==0)

547 
tmp1
*=
	`sq¹
(
u0
);

549 
w
[
icurs
]=1.0/(
tmp1
*tmp1);

552 
tmp0
=
p_cÛf
[
Üd
-2];

553 
p_cÛf
[
Üd
-2]=1.0;

554 
dp_cÛf
[
Üd
-2]=
¡©ic_ÿ¡
<
ty³0
>(ord-1);

555 
i
=
Üd
-3;i>-1;i--)

557 
tmp1
=
p_cÛf
[
i
];

558 
p_cÛf
[
i
]=
tmp0
+
u0
*p_coef[i+1];

559 
dp_cÛf
[
i
]=
p_cÛf
[i+1]*
¡©ic_ÿ¡
<
ty³0
>(i+1);

560 
tmp0
=
tmp1
;

563 
Üd
--;

564 
icurs
++;

567 
tmp0
=
	`sq¹
(
M_PI
)/
¡©ic_ÿ¡
<
ty³0
>(
n
);

568 
i
=0;i<
n
-1;i++)

570 
tmp0
*=
¡©ic_ÿ¡
<
ty³0
>(2*(
i
+1));

572 if(
n
%2==1)

574 
w
[
n
/2]=
tmp0
/(
p_2
[0]*p_2[0]);

578 
i
=0;i<
n
/2;i++)

580 
icurs
--;

581 
w
[
icurs
]*=
tmp0
;

582 
w
[
i
]=w[
icurs
];

583 
x
[
i
]=-x[
icurs
];

586 
d–‘e
 [] 
p_1
;

587 
d–‘e
 [] 
p_2
;

588 
d–‘e
 [] 
p_cÛf
;

589 
d–‘e
 [] 
dp_cÛf
;

591 
	}
}

600 
boŞ
 
	gXM©h
::
Msq¹
(
ty³0
(&
A
)[3][3],ty³0(&
Asq
)[3][3])

602 
ty³0
 
	gIA
=0;

603 
	gi
=0;i<3;i++)

604 
	gIA
+=
A
[
i
][i];

605 
ty³0
 
	gIIA
=0;

606 
	gi
=0;i<3;i++)

607 
	gj
=0;j<3;j++)

608 
	gIIA
-=
A
[
i
][
j
]*A[j][i];

610 
	gIIA
+=
IA
*IA;

611 
	gIIA
*=0.5;

612 
ty³0
 
	gIIIA
=
M3DET
(
A
);

613 
ty³0
 
	gk
=
IA
*IA-3*
IIA
;

614 if(
	gk
<0.0è 
	gçl£
;

616 if(
	gk
<
	gTOLERANCE
)

618 if(
	gIA
<=0.0)

619  
çl£
;

620 
M3ZERO
(
Asq
);

621 
	gi
=0;i<3;i++)

622 
	gAsq
[
i
][i]=
sq¹
(
IA
/3.0);

623  
	gŒue
;

626 
ty³0
 
	gl
=
IA
*(IA*IA -4.5*
IIA
)+13.5*
IIIA
;

628 
ty³0
 
	g‹mp
=
l
/(
k
*
sq¹
(k));

629 if(
	g‹mp
>1.0||temp<-1.0)

630  
	gçl£
;

632 
ty³0
 
	gphi
=
acos
(
‹mp
);

633 
ty³0
 
	gÏmbda
=
sq¹
((1.0/3.0)*(
IA
+2*sq¹(
k
)*
cos
(
phi
/3.0)));

635 
ty³0
 
	gIIIAsq
=
sq¹
(
IIIA
);

636 
ty³0
 
	gy
=-
Ïmbda
*Ïmbda+
IA
+2*
IIIAsq
/lambda;

637 if(
	gy
<0.0è 
	gçl£
;

638 
ty³0
 
	gIAsq
=
Ïmbda
+
sq¹
(
y
);

639 
ty³0
 
	gIIAsq
=0.5*(
IAsq
*IAsq-
IA
);

641 
ty³0
 
	gcÛf0
=
IAsq
*
IIAsq
-
IIIAsq
;

642 if(
	gcÛf0
==0)

643  
çl£
;

644 
	gcÛf0
=1.0/
cÛf0
;

646 
M3ZERO
(
Asq
);

648 
	gi
=0;i<3;i++)

649 
	gj
=0;j<3;j++)

650 
	gk
=0;k<3;k++)

651 
	gAsq
[
i
][
j
]-=
cÛf0
*
A
[i][
k
]*A[k][j];

653 
ty³0
 
	gcÛf1
=
cÛf0
*(
IAsq
*IAsq-
IIAsq
);

654 
	gi
=0;i<3;i++)

655 
	gj
=0;j<3;j++)

656 
	gAsq
[
i
][
j
]+=
cÛf1
*
A
[i][j];

658 
ty³0
 
	gcÛf2
=
cÛf0
*
IAsq
*
IIIAsq
;

659 
	gi
=0;i<3;i++)

660 
	gAsq
[
i
][i]+=
cÛf2
;

661  
	gŒue
;

671 
boŞ
 
	gXM©h
::
Msq¹
(
ty³0
(&
A
)[2][2],ty³0(&
Asq
)[2][2])

673 
ty³0
 
	gu
=
A
[0][0]+A[1][1];

674 
ty³0
 
	gd–
=
A
[0][0]*A[1][1]-A[0][1]*A[1][0];

675 if(
	gd–
<0.0è 
	gçl£
;

676 
ty³0
 
	gs
=
sq¹
(
d–
);

677 if(
	gu
+2.0*
	gs
<=0.0è 
çl£
;

678 
ty³0
 
	gt
=
sq¹
(
u
+2.0*
s
);

679 
	gAsq
[0][0]=(
A
[0][0]+
s
)/
t
;

680 
	gAsq
[0][1]=
A
[0][1]/
t
;

681 
	gAsq
[1][0]=
A
[1][0]/
t
;

682 
	gAsq
[1][1]=(
A
[1][1]+
s
)/
t
;

685  
	gŒue
;

	@xmath.h

1 #iâdeà
__MAPP__xm©h__


2 
	#__MAPP__xm©h__


	)

3 
	~<ut™y
>

4 
	~<m©h.h
>

5 
	~<lim™s
>

6 
	~<io¡»am
>

7 
	~"glob®.h
"

8 
usšg
 
Çme¥aû
 
	gMAPP_NS
;

9 
Çme¥aû
 
	gMAPP_NS


11 
Çme¥aû
 
	gXM©h


14 
çc_li¡_»c
(,,,*&,*&,&);

15 
	g‹m¶©e
<
	gty³Çme
,
	gşass
>

16 
şass
 
	gXVec
;

18 
šv”t
(
ty³0
**,type0**,);

20 
	g‹m¶©e
<cÚ¡ 
	gd
>

22 
šv”t_low”_ŒŸngË
(
ty³0
**&,type0**&,&);

24 
çc_li¡
(,,*&,&);

26 
squ¬e2lo_Œi
(
ty³0
(&)[3][3],type0(&)[3][3]);

27 
quad¿tu»_lg
(,
ty³0
*,type0*);

28 
quad¿tu»_hg
(,
ty³0
*,type0*);

29 
	g‹m¶©e
<cÚ¡ 
	gN
>

30 
quad_hg
(
ty³0
(&)[
N
],type0(&)[N]);

31 
	g‹m¶©e
<cÚ¡ 
	gN
>

32 
quad_lg
(
ty³0
(&)[
N
],type0(&)[N]);

33 
boŞ
 
Msq¹
(
ty³0
(&)[3][3],type0(&)[3][3]);

34 
boŞ
 
Msq¹
(
ty³0
(&)[2][2],type0(&)[2][2]);

36 
	g‹m¶©e
<
ty³Çme
 
	gT0
,
şass
 
	gCOMP
,şas 
	gSWAP
>

37 
quicksÜt
(
T0
,T0,
COMP
,
SWAP
);

38 
	g‹m¶©e
<
ty³Çme
 
	gT0
,
şass
 
	gC0
>

39 
¤ch_l¡_l¡
(
T0
*,,
C0
*,T0*,,C0*);

45 
Çme¥aû
 
	gMAPP_NS


47 
	g‹m¶©e
<
ty³Çme
 
	gT0
,
şass
 
	gC0
>

48 şas 
	cXM©h
::
XVec


50 
´iv©e
:

51 
T0
* 
d©a
;

52 * 
	gkey
;

53 
	gsize
;

54 
	gC0
& 
	gaù
;

55 
	g´Ùeùed
:

56 
public
:

58 şas 
	c™”©Ü


60 
´iv©e
:

61 
XVec
* 
xvec
;

62 * 
	gikey
;

63 
	g´Ùeùed
:

64 
public
:

65 
™”©Ü
(
XVec
* 
_xvec
,* 
_ikey
)

67 
	gxvec
=
_xvec
;

68 
	gikey
=
_ikey
;

71 
™”©Ü
(cÚ¡ i‹¿tÜ& 
Ùh”
)

73 
	gthis
->
	gxvec
=
Ùh”
.
xvec
;

74 
	gthis
->
	gikey
=
Ùh”
.
ikey
;

77 
™”©Ü
(™”©Ü&& 
Ùh”
)

79 
	gthis
->
	gxvec
=
Ùh”
.
xvec
;

80 
	gthis
->
	gikey
=
Ùh”
.
ikey
;

83 
	g™”©Ü
& 
	gİ”©Ü
 =(cÚ¡ 
™”©Ü
& 
Ùh”
)

85 
this
->
xvec
=
Ùh”
.xvec;

86 
	gthis
->
	gikey
=
Ùh”
.
ikey
;

87  *
	gthis
;

90 
	g™”©Ü
& 
	gİ”©Ü
 =(
™”©Ü
&& 
Ùh”
)

92 
this
->
xvec
=
Ùh”
.xvec;

93 
	gthis
->
	gikey
=
Ùh”
.
ikey
;

94  *
	gthis
;

97 
	g™”©Ü
& 
	gİ”©Ü
 +=(
i
)

99 
ikey
+=
i
;

100  *
	gthis
;

103 
	g™”©Ü
& 
	gİ”©Ü
 ++()

105 
	gikey
++;

106  *
	gthis
;

109 
™”©Ü
 
	gİ”©Ü
 ++()

111 
™”©Ü
 
	gŞd
=*
this
;

112 
	gikey
++;

113  
	gŞd
;

116 
	g™”©Ü
& 
	gİ”©Ü
 --()

118 
	gikey
--;

119  *
	gthis
;

122 
™”©Ü
 
	gİ”©Ü
 --()

124 
™”©Ü
 
	gŞd
=*
this
;

125 
	gikey
--;

126  
	gŞd
;

129 
	gT0
& 
	gİ”©Ü
 *()

131  
	gxvec
->
	gd©a
[*
ikey
];

134 
	gT0
& 
	gİ”©Ü
 [](
	gi
)

136  
	gxvec
->
	gd©a
[*(
ikey
+
i
)];

139 
boŞ
 
	gİ”©Ü
!=(cÚ¡ 
™”©Ü
& 
rhs
)

141  (
this
->
ikey
!=
rhs
.ikey);

144 
boŞ
 
	gİ”©Ü
==(cÚ¡ 
™”©Ü
& 
rhs
)

146  (
this
->
ikey
==
rhs
.ikey);

148 
Ãq
()

150 
	gxvec
->
	gaù
.
Ãq
(*
ikey
);

152 
eq
()

154 
	gxvec
->
	gaù
.
eq
(*
ikey
);

158 
XVec
(
T0
* 
_d©a


159 ,
_size
,
C0
& 
_aù
):

160 
d©a
(
_d©a
),

161 
size
(
_size
),

162 
aù
(
_aù
)

164 
	gkey
=
NULL
;

165 if(!
	gsize
) ;

167 
	gkey
=
Ãw
 [
size
];

168 
	gi
=0;i<
	gsize
;i++è
	gkey
[
i
]=i;

169 
quicksÜt
(
key
,key+
size
,

170 [
this
](* 
ikey
,* 
jkey
){ (
d©a
[*ikey]<data[*jkey]);},

171 [](* 
ikey
,* 
jkey
){
¡d
::
sw­
(*ikey,*jkey);});

174 
XVec
(XVec&& 
Ùh”
):

175 
aù
(
Ùh”
.act)

177 
this
->
d©a
=
Ùh”
.data;

178 
	gthis
->
	gkey
=
Ùh”
.
key
;

179 
	gthis
->
	gsize
=
Ùh”
.
size
;

180 
	gÙh”
.
	gkey
=
NULL
;

182 ~
XVec
()

184 
	gd–‘e
 [] 
	gkey
;

187 
	gXVec
& 
	gİ”©Ü
=(
XVec
&& 
Ùh”
)

189 
this
->
aù
=
Ùh”
.act;

190 
	gthis
->
	gd©a
=
Ùh”
.
d©a
;

191 
	gthis
->
	gkey
=
Ùh”
.
key
;

192 
	gthis
->
	gsize
=
Ùh”
.
size
;

193 
	gÙh”
.
	gkey
=
NULL
;

194  *
	gthis
;

197 
™”©Ü
 
begš
()

199  
™”©Ü
(
this
,
key
);

202 
™”©Ü
 
’d
()

204  
™”©Ü
(
this
,
key
+
size
);

207 
™”©Ü
 
rbegš
()

209  
™”©Ü
(
this
,
key
+
size
-1);

212 
™”©Ü
 
»nd
()

214  
™”©Ü
(
this
,
key
-1);

221 
Çme¥aû
 
	gMAPP_NS


223 
Çme¥aû
 
	gXM©rixVeùÜ


225 cÚ¡ 
´ecisiÚ_f
(
sq¹
(2.0*
¡d
::
num”ic_lim™s
<>::
•sÚ
()));

226 cÚ¡ 
´ecisiÚ_d
(
sq¹
(2.0*
¡d
::
num”ic_lim™s
<>::
•sÚ
()));

227 cÚ¡ 
´ecisiÚ_ld
(
sq¹
(2.0*
¡d
::
num”ic_lim™s
<>::
•sÚ
()));

229 
	g‹m¶©e
<
şass
 
	gT
>

230 şas 
	c´ecisiÚ


233 
	g‹m¶©e
<>

234 
şass
 
	g´ecisiÚ
<>

235 {
	gpublic
: 
v®
(){ 
´ecisiÚ_f
;};};

236 
	g‹m¶©e
<>

237 
şass
 
	g´ecisiÚ
<>

238 {
	gpublic
: 
v®
(){ 
´ecisiÚ_d
;};};

239 
	g‹m¶©e
<>

240 
şass
 
	g´ecisiÚ
<>

241 {
	gpublic
: 
v®
(){ 
´ecisiÚ_ld
;};};

244 
	g‹m¶©e
<cÚ¡ 
	gdim
>

245 şas 
	c_z”o_


247 
	gpublic
:

248 
‹m¶©e
<
ty³Çme
 
T
>

249 
šlše
 
func
(
T
* 
v
)

251 *
v
=0;

252 
	g_z”o_
<
	gdim
-1>::
func
(
v
+1);

255 
	g‹m¶©e
<>

256 
şass
 
	g_z”o_
<0>

258 
	gpublic
:

259 
‹m¶©e
<
ty³Çme
 
T
>

260 
šlše
 
func
(
T
*)

265 
	g‹m¶©e
<cÚ¡ 
	gi
>

266 şas 
	c_rsq_


268 
	gpublic
:

269 
‹m¶©e
<
ty³Çme
 
T
>

270 
šlše
 
T
 
func
(T* 
V0
,T* 
V1
)

272  
	g_rsq_
<
	gi
-1>::
func
(
V0
+1,
V1
+1)+(*
	gV0
-*
	gV1
)*(*V0-*V1);

276 
	g‹m¶©e
<>

277 
şass
 
	g_rsq_
<1>

279 
	gpublic
:

280 
‹m¶©e
<
ty³Çme
 
T
>

281 
šlše
 
T
 
func
(T* 
V0
,T* 
V1
)

283  (*
	gV0
-*
	gV1
)*(*V0-*V1);

287 
	g‹m¶©e
<cÚ¡ 
	gi
>

288 şas 
	c_V_V_


290 
	gpublic
:

291 
‹m¶©e
<
ty³Çme
 
T
>

292 
šlše
 
T
 
func
(T* 
V0
,T* 
V1
)

294  
	g_V_V_
<
	gi
-1>::
func
(
V0
+1,
V1
+1)+(*
	gV0
)*(*
	gV1
);

298 
	g‹m¶©e
<>

299 
şass
 
	g_V_V_
<1>

301 
	gpublic
:

302 
‹m¶©e
<
ty³Çme
 
T
>

303 
šlše
 
T
 
func
(T* 
V0
,T* 
V1
)

305  (*
	gV0
)*(*
	gV1
);

308 
	g‹m¶©e
<>

309 
şass
 
	g_V_V_
<0>

311 
	gpublic
:

312 
‹m¶©e
<
ty³Çme
 
T
>

313 
šlše
 
T
 
func
(T*,T*)

319 
	g‹m¶©e
<cÚ¡ 
	g¡ride
,cÚ¡ 
	gi
>

320 şas 
	c_V_V_¡r_


322 
	gpublic
:

323 
‹m¶©e
<
ty³Çme
 
T
>

324 
šlše
 
T
 
func
(T* 
V0
,T* 
V1
)

326  
	g_V_V_¡r_
<
	g¡ride
,
	gi
-1>::
func
(
V0
+
¡ride
,
V1
+1)+(*
	gV0
)*(*
	gV1
);

330 
	g‹m¶©e
<cÚ¡ 
	g¡ride
>

331 
şass
 
	g_V_V_¡r_
<
	g¡ride
,1>

333 
	gpublic
:

334 
‹m¶©e
<
ty³Çme
 
T
>

335 
šlše
 
T
 
func
(T* 
V0
,T* 
V1
)

337  (*
	gV0
)*(*
	gV1
);

341 
	g‹m¶©e
<cÚ¡ 
	g¡ride
,cÚ¡ 
	gi
>

342 şas 
	c_V_¡r_V_¡r_


344 
	gpublic
:

345 
‹m¶©e
<
ty³Çme
 
T
>

346 
šlše
 
T
 
func
(T* 
V0
,T* 
V1
)

348  
	g_V_¡r_V_¡r_
<
	g¡ride
,
	gi
-1>::
func
(
V0
+
¡ride
,
V1
+¡ride)+(*
	gV0
)*(*
	gV1
);

352 
	g‹m¶©e
<cÚ¡ 
	g¡ride
>

353 
şass
 
	g_V_¡r_V_¡r_
<
	g¡ride
,1>

355 
	gpublic
:

356 
‹m¶©e
<
ty³Çme
 
T
>

357 
šlše
 
T
 
func
(T* 
V0
,T* 
V1
)

359  (*
	gV0
)*(*
	gV1
);

364 
	g‹m¶©e
<cÚ¡ 
	gdim
,cÚ¡ 
	gi
>

365 şas 
	c_V_MÉ_


367 
	gpublic
:

368 
‹m¶©e
<
ty³Çme
 
T
>

369 
šlše
 
func
(
T
* 
MÉ
,T* 
V
)

371 *
	gV
=
_V_V_¡r_
<
dim
,
	gi
>::
func
(
MÉ
,
V
);

372 
	g_V_MÉ_
<
	gdim
,
	gi
-1>::
func
(
MÉ
+
dim
+1,
V
+1);

376 
	g‹m¶©e
<cÚ¡ 
	gdim
>

377 
şass
 
	g_V_MÉ_
<
	gdim
,1>

379 
	gpublic
:

380 
‹m¶©e
<
ty³Çme
 
T
>

381 
šlše
 
func
(
T
* 
MÉ
,T* 
V
)

383 *
	gV
*=*
MÉ
;

387 
	g‹m¶©e
<cÚ¡ 
	gdim
,cÚ¡ 
	gi
>

388 şas 
	c_V_V_MÉ_


390 
	gpublic
:

391 
‹m¶©e
<
ty³Çme
 
T
>

392 
šlše
 
func
(
T
* 
V1
,T* 
MÉ
,T* 
V0
)

394 *
	gV1
=
_V_V_¡r_
<
dim
,
	gi
>::
func
(
MÉ
,
V0
);

395 
	g_V_V_MÉ_
<
	gdim
,
	gi
-1>::
func
(
V1
+1,
MÉ
+
dim
+1,
V0
+1);

399 
	g‹m¶©e
<cÚ¡ 
	gdim
>

400 
şass
 
	g_V_V_MÉ_
<
	gdim
,1>

402 
	gpublic
:

403 
‹m¶©e
<
ty³Çme
 
T
>

404 
šlše
 
func
(
T
* 
V1
, T* 
MÉ
,T* 
V0
)

406 *
	gV1
*=*
V0
 * *
MÉ
;

411 
	g‹m¶©e
<cÚ¡ 
	gdim
,cÚ¡ 
	gi
>

412 şas 
	c_x2s_


414 
	gpublic
:

415 
‹m¶©e
<
ty³Çme
 
T
>

416 
šlše
 
func
(
T
* 
MÉ
,T* 
V
)

418 *
	gV
=
_V_V_¡r_
<
dim
,
	gi
>::
func
(
MÉ
,
V
);

419 *
	gV
<0.0)

420 (*
	gV
)++;

421 *
	gV
>=1.0)

422 (*
V
)--;

423 
	g_x2s_
<
	gdim
,
	gi
-1>::
func
(
MÉ
+
dim
+1,
V
+1);

427 
	g‹m¶©e
<cÚ¡ 
	gdim
>

428 
şass
 
	g_x2s_
<
	gdim
,1>

430 
	gpublic
:

431 
‹m¶©e
<
ty³Çme
 
T
>

432 
šlše
 
func
(
T
* 
MÉ
,T* 
V
)

434 *
	gV
*=*
MÉ
;

435 *
	gV
<0.0)

436 (*
	gV
)++;

437 *
	gV
>=1.0)

438 (*
V
)--;

443 
	g‹m¶©e
<cÚ¡ 
	gdim
,cÚ¡ 
	gi
,cÚ¡ 
	gj
>

444 şas 
	c_MÉ_šv_


446 
	gpublic
:

447 
‹m¶©e
<
ty³Çme
 
T
>

448 
šlše
 
func
(
T
* 
M
,T* 
Mšv
)

450 *
	gMšv
=-
_V_V_¡r_
<
dim
,
	gi
-
	gj
>::
func
(
Mšv
-(
i
-
j
)*dim,
M
)*(*(Minv+i-j));

451 
	g_MÉ_šv_
<
	gdim
,
	gi
,
	gj
-1>::
func
(
M
-1,
Mšv
-1);

455 
	g‹m¶©e
<cÚ¡ 
	gdim
,cÚ¡ 
	gi
>

456 
şass
 
	g_MÉ_šv_
<
	gdim
,
	gi
,i>

458 
	gpublic
:

459 
‹m¶©e
<
ty³Çme
 
T
>

460 
šlše
 
func
(
T
* 
M
,T* 
Mšv
)

462 *
	gMšv
=1.0/(*
M
);

463 
	g_MÉ_šv_
<
	gdim
,
	gi
,i-1>::
func
(
M
-1,
Mšv
-1);

466 
	g‹m¶©e
<cÚ¡ 
	gdim
,cÚ¡ 
	gi
>

467 
şass
 
	g_MÉ_šv_
<
	gdim
,
	gi
,0>

469 
	gpublic
:

470 
‹m¶©e
<
ty³Çme
 
T
>

471 
šlše
 
func
(
T
* 
M
,T* 
Mšv
)

473 *
	gMšv
=-
_V_V_¡r_
<
dim
,
	gi
>::
func
(
Mšv
-
i
*dim,
M
)*(*(Minv+i));

474 
	g_MÉ_šv_
<
	gdim
,
	gi
+1,i+1>::
func
(
M
+
dim
+
i
+1,
Mšv
+dim+i+1);

478 
	g‹m¶©e
<cÚ¡ 
	gdim
>

479 
şass
 
	g_MÉ_šv_
<
	gdim
,dim,dim>

481 
	gpublic
:

482 
‹m¶©e
<
ty³Çme
 
T
>

483 
šlše
 
func
(
T
*,T*)

487 
	g‹m¶©e
<cÚ¡ 
	gdim
,cÚ¡ 
	gi
,cÚ¡ 
	gj
>

488 şas 
	c_M_2_MÉ_


490 
	gpublic
:

491 
‹m¶©e
<
ty³Çme
 
T
>

492 
šlše
 
func
(
T
* 
M_Şd
,T* 
M_Ãw
)

495 
	gM_Ãw
[
i
*
dim
+
j
]=(
_V_V_
<dim>::
func
(
M_Şd
+j*dim,M_old+i*dim)-

496 
	g_V_V_
<
	gj
>::
func
(
M_Ãw
+
j
*
dim
,M_Ãw+
i
*dim))/
	gM_Ãw
[j*(dim+1)];

497 
	g_M_2_MÉ_
<
	gdim
,
	gi
,
	gj
+1>::
func
(
M_Şd
,
M_Ãw
);

501 
	g‹m¶©e
<cÚ¡ 
	gdim
,cÚ¡ 
	gi
>

502 
şass
 
	g_M_2_MÉ_
<
	gdim
,
	gi
,i>

504 
	gpublic
:

505 
‹m¶©e
<
ty³Çme
 
T
>

506 
šlše
 
func
(
T
* 
M_Şd
,T* 
M_Ãw
)

508 
	gM_Ãw
[
i
*
dim
+i]=
sq¹
(
_V_V_
<dim>::
func
(
M_Şd
+i*dim,M_old+i*dim)-

509 
_V_V_
<
i
>::
func
(
M_Ãw
+i*
dim
,M_new+i*dim));

511 
	g_z”o_
<
	gdim
-
	gi
-1>::
func
(
M_Ãw
+
i
*(
dim
+1)+1);

512 
	g_M_2_MÉ_
<
	gdim
,
	gi
+1,0>::
func
(
M_Şd
,
M_Ãw
);

516 
	g‹m¶©e
<cÚ¡ 
	gdim
>

517 
şass
 
	g_M_2_MÉ_
<
	gdim
,dim,0>

519 
	gpublic
:

520 
‹m¶©e
<
ty³Çme
 
T
>

521 
šlše
 
func
(
T
*,T*)

525 
	g‹m¶©e
<cÚ¡ 
	gdim
,cÚ¡ 
	gi
,cÚ¡ 
	gj
>

526 şas 
	c_MÉ_MÉ_


528 
	gpublic
:

529 
‹m¶©e
<
ty³Çme
 
T
>

530 
šlše
 
func
(
T
* 
M0
,T* 
M1
,T* 
B
)

532 *
	gB
=
_V_V_¡r_
<
dim
,
	gi
-
	gj
+1>::
func
(
M1
-(
i
-
j
)*dim,
M0
);

533 
	g_MÉ_MÉ_
<
	gdim
,
	gi
,
	gj
+1>::
func
(
M0
+1,
M1
+1,
B
+1);

537 
	g‹m¶©e
<cÚ¡ 
	gdim
,cÚ¡ 
	gi
>

538 
şass
 
	g_MÉ_MÉ_
<
	gdim
,
	gi
,i>

540 
	gpublic
:

541 
‹m¶©e
<
ty³Çme
 
T
>

542 
šlše
 
func
(
T
* 
M0
,T* 
M1
,T* 
B
)

544 *
	gB
=(*
M0
)*(*
M1
);

545 
	g_MÉ_MÉ_
<
	gdim
,
	gi
+1,0>::
func
(
M0
+
dim
-
i
,
M1
+dim-i,
B
+dim-i);

548 
	g‹m¶©e
<cÚ¡ 
	gdim
>

549 
şass
 
	g_MÉ_MÉ_
<
	gdim
,dim,0>

551 
	gpublic
:

552 
‹m¶©e
<
ty³Çme
 
T
>

553 
šlše
 
func
(
T
*,T*,T*)

558 
	g‹m¶©e
<
	gdim
,
	gi
>

559 şas 
	c__d•th__


561 
	gpublic
:

562 
‹m¶©e
<
ty³Çme
 
T
>

563 
šlše
 
func
(
T
* 
A
,T* 
d
)

565 *
	gd
=
sq¹
(
_V_¡r_V_¡r_
<
dim
,
i
>::
func
(
A
,A));

566 
	g__d•th__
<
	gdim
,
	gi
-1>::
func
(
A
+
dim
+1,
d
+1);

570 
	g‹m¶©e
<
	gdim
>

571 
şass
 
	g__d•th__
<
	gdim
,1>

573 
	gpublic
:

574 
‹m¶©e
<
ty³Çme
 
T
>

575 
šlše
 
func
(
T
* 
A
,T* 
d
)

577 *
	gd
=
abs
(*
A
);

581 
	g‹m¶©e
 <
	gi
,
	gdim
>

582 şas 
	c__Œaû__


584 
	gpublic
:

585 
‹m¶©e
<
ty³Çme
 
T
>

586 
šlše
 
T
 
func
(T* 
A
)

588  *
A
+
__Œaû__
<
i
-1,
	gdim
>::
func
(A+
dim
+1);

591 
	g‹m¶©e
 <
	gdim
>

592 
şass
 
	g__Œaû__
<1,
	gdim
>

594 
	gpublic
:

595 
‹m¶©e
<
ty³Çme
 
T
>

596 
šlše
 
T
 
func
(T* 
A
)

598  *
A
;

604 
	g‹m¶©e
<
	gi
,
	gdim
>

605 şas 
	c__dyadic


607 
	gpublic
:

608 
‹m¶©e
<
ty³Çme
 
T
>

609 
šlše
 
func
(
T
& 
sş
,T* 
x
,T* 
v
)

611 *
	gv
=*
x
*x[
i
]*
sş
;

612 
	g__dyadic
<
	gi
+1,
	gdim
>::
func
(
sş
,
x
,
v
+1);

616 
	g‹m¶©e
<
	gdim
>

617 
şass
 
	g__dyadic
<
	gdim
,dim>

619 
	gpublic
:

620 
‹m¶©e
<
ty³Çme
 
T
>

621 
šlše
 
func
(
T
& 
sş
,T* 
x
,T* 
v
)

623 
	g__dyadic
<0,
	gdim
-1>::
func
(
sş
,
x
+1,
v
);

627 
	g‹m¶©e
<>

628 
şass
 
	g__dyadic
<0,0>

630 
	gpublic
:

631 
‹m¶©e
<
ty³Çme
 
T
>

632 
šlše
 
func
(
T
&,T*,T*)

637 
	g‹m¶©e
<
	gi
,
	gj
,
	gdim
>

638 şas 
	c__SymmVec_2_MÉ


640 
	gpublic
:

641 
‹m¶©e
<
ty³Çme
 
T
>

642 
šlše
 
func
(
T
* 
v
,T* 
A
)

644 *
	gA
=*
v
;

645 
	g__SymmVec_2_MÉ
<
	gi
+1,
	gj
,
	gdim
>::
func
(
v
+1,
A
+
dim
+1);

650 
	g‹m¶©e
<
	gj
,
	gdim
>

651 
şass
 
	g__SymmVec_2_MÉ
<
	gdim
,
	gj
,dim>

653 
	gpublic
:

654 
‹m¶©e
<
ty³Çme
 
T
>

655 
šlše
 
func
(
T
* 
v
,T* 
A
)

657 *
	gA
=*
v
;

658 
	g__SymmVec_2_MÉ
<
	gj
+1,j+1,
	gdim
>::
func
(
v
+1,
A
+(
j
-
dim
+1)*(dim+1)+1);

662 
	g‹m¶©e
<
	gdim
>

663 
şass
 
	g__SymmVec_2_MÉ
<
	gdim
,dim,dim>

665 
	gpublic
:

666 
‹m¶©e
<
ty³Çme
 
T
>

667 
šlše
 
func
(
T
* 
v
,T* 
A
)

669 *
	gA
=*
v
;

676 
	g‹m¶©e
 <cÚ¡ 
	gi
>

677 şas 
	cUÄŞËdLoİ


679 
	gpublic
:

680 
‹m¶©e
 < 
ty³Çme
 
FuncTy³
 >

681 
šlše
 
Do
(
FuncTy³
 
func
)

683 
UÄŞËdLoİ
 <
i
-1>::
Do
Ğ
func
);

684 
func
(
i
-1);

687 
	g‹m¶©e
 <>

688 
şass
 
	gUÄŞËdLoİ
<1>

690 
	gpublic
:

691 
‹m¶©e
 < 
ty³Çme
 
FuncTy³
 >

692 
šlše
 
Do
(
FuncTy³
 
func
){func(0);}

695 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

696 
šlše
 
T
 
rsq
(T* 
V0
,T* 
V1
)

698  
	g_rsq_
<
	gdim
>::
func
(
V0
,
V1
);

701 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

702 
šlše
 
T
 
V_V
(T* 
V0
,T* 
V1
)

704  
	g_V_V_
<
	gdim
>(
	gV0
,
	gV1
);

707 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

708 
šlše
 
V_MÉ
(
T
* 
V
,T** 
MÉ
)

710 
	g_V_MÉ_
<
	gdim
,dim>::
func
(*
MÉ
,
V
);

712 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

713 
šlše
 
V_MÉ
(
T
* 
V
,T (&
MÉ
)[
dim
][dim])

715 
	g_V_MÉ_
<
	gdim
,dim>::
func
((
T
*)
MÉ
,
V
);

718 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

719 
šlše
 
V_MÉ
(
T
* 
V
,T** 
MÉ
,T* 
ªs
)

721 
	g_V_V_MÉ_
<
	gdim
,dim>::
func
(
ªs
,*
MÉ
,
V
);

723 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

724 
šlše
 
V_MÉ
(
T
* 
V
,T (&
MÉ
)[
dim
][dim],T* 
ªs
)

726 
	g_V_V_MÉ_
<
	gdim
,dim>::
func
(
ªs
,(
T
*)
MÉ
,
V
);

729 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

730 
šlše
 
T
 
Tr
(T(&
A
)[
dim
][dim])

732  
	g__Œaû__
<
	gdim
,dim>::
func
((
T
*)
A
);

735 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

736 
šlše
 
s2x
(
T
* 
s
,T (&
H
)[
dim
][dim])

738 
	g_V_MÉ_
<
	gdim
,dim>::
func
(&
H
[0][0],
s
);

741 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

742 
šlše
 
s2x
(
T
* 
s
,T** 
H
)

744 
	g_V_MÉ_
<
	gdim
,dim>::
func
(*
H
,
s
);

747 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

748 
šlše
 
x2s
(
T
* 
x
,T (&
B
)[
dim
][dim])

750 
	g_x2s_
<
	gdim
,dim>::
func
(&
B
[0][0],
x
);

753 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

754 
šlše
 
x2s
(
T
* 
x
,T** 
B
)

756 
	g_x2s_
<
	gdim
,dim>::
func
(*
B
,
x
);

759 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

760 
šlše
 
MÉ_šv
(
T
** 
A
,T** 
Ašv
)

762 **
	gAšv
=1.0/(**
A
);

763 
	g_MÉ_šv_
<
	gdim
,1,1>::
func
(*
A
+
dim
+1,*
Ašv
+dim+1);

766 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

767 
šlše
 
MÉ_šv
(
T
 (&
A
)[
dim
][dim],T (&
Ašv
)[dim][dim])

769 **
	gAšv
=1.0/(**
A
);

770 
	g_MÉ_šv_
<
	gdim
,1,1>::
func
((
T
*)
A
+
dim
+1,(T*)
Ašv
+dim+1);

773 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

774 
šlše
 
MÉ_MÉ
(
T
** 
M0
,T** 
M1
,T** 
B
)

776 
	g_MÉ_MÉ_
<
	gdim
,0,0>::
func
(*
M0
,*
M1
,*
B
);

779 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

780 
šlše
 
MÉ_MÉ
(
T
 (&
M0
)[
dim
][dim],T (&
M1
)[dim][dim],T (&
B
)[dim][dim])

782 
	g_MÉ_MÉ_
<
	gdim
,0,0>::
func
((
T
*)
M0
,(T*)
M1
,(T*)
B
);

785 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

786 
šlše
 
M_2_MÉ
(
T
** &
M0
,T** 
M1
)

788 
	g_M_2_MÉ_
<
	gdim
,0,0>::
func
(*
M0
,*
M1
);

791 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

792 
šlše
 
M_2_MÉ
(
T
 (&
M0
)[
dim
][dim],T (&
M1
)[dim][dim])

794 
	g_M_2_MÉ_
<
	gdim
,0,0>::
func
((
T
*)
M0
,(T*)
M1
);

798 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

799 
šlše
 
d•th
(
T
 (&
A
)[
dim
][dim],T (&
d
)[dim])

801 
	g__d•th__
<
	gdim
,dim>::
func
((
T
*)
A
,
d
);

804 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

805 
šlše
 
dyadic
(
T
& 
sş
,T* 
x
,T (&
v
)[
dim
*(dim+1)/2])

807 
	g__dyadic
<0,
	gdim
>::
func
(
sş
,
x
,
v
);

810 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

811 
šlše
 
SymmVec_2_MÉ
(
T
 (&
v
)[
dim
*(dim+1)/2],T(&
A
)[dim][dim])

813 
	g__SymmVec_2_MÉ
<0,0,
	gdim
-1>::
func
(
v
,&
A
[0][0]);

816 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

817 
šlše
 
z”o
(
T
(&
v
)[
dim
])

819 
	g_z”o_
<
	gdim
>::
func
(
v
);

822 
	g‹m¶©e
<cÚ¡ 
	gdim
,cÚ¡ 
	gidim
>

823 şas 
	c_İt_comm_grid_


825 
	gpublic
:

826 
func
(cÚ¡ 
ty³0
 (&
h
)[
dim
],
no
,(&
cu¼_grid
)[dim],(&
İt_grid
)[dim],ty³0& 
İt_size
)

828 
	gi
=1;i<=
no
;i++)

829 if(
	gno
%
	gi
==0)

831 
cu¼_grid
[
idim
-1]=
i
;

832 
	g_İt_comm_grid_
<
	gdim
,
	gidim
-1>::
func
(
h
,
no
/
i
,
cu¼_grid
,
İt_grid
,
İt_size
);

837 
	g‹m¶©e
<cÚ¡ 
	gdim
>

838 
şass
 
	g_İt_comm_grid_
<
	gdim
,1>

840 
	gpublic
:

841 
func
(cÚ¡ 
ty³0
 (&
h
)[
dim
],
no
,(&
cu¼_grid
)[dim],(&
İt_grid
)[dim],ty³0& 
İt_size
)

843 
	gcu¼_grid
[0]=
no
;

844 
ty³0
 
	gcu¼_size
=0.0;

845 
	gi
=0;i<
	gdim
;i++è
	gcu¼_size
+=
¡©ic_ÿ¡
<
ty³0
>(
cu¼_grid
[
i
])/
h
[i];

846 if(
	gİt_size
==0.0 || 
cu¼_size
<
İt_size
)

848 
İt_size
=
cu¼_size
;

849 
memıy
(
İt_grid
,
cu¼_grid
,
dim
*());

855 şas 
	c__İt_comm_grid__


857 
	gpublic
:

858 
func
(cÚ¡ 
idim
,cÚ¡ 
dim
,cÚ¡ 
ty³0
* 
h
,
no
,* 
cu¼_grid
,* 
İt_grid
,ty³0& 
İt_size
)

860 if(
	gidim
==1)

862 
cu¼_grid
[0]=
no
;

863 
ty³0
 
	gcu¼_size
=0.0;

864 
	gi
=0;i<
	gdim
;i++è
	gcu¼_size
+=
¡©ic_ÿ¡
<
ty³0
>(
cu¼_grid
[
i
])/
h
[i];

865 if(
	gİt_size
==0.0 || 
cu¼_size
<
İt_size
)

867 
İt_size
=
cu¼_size
;

868 
	gi
=0;i<
	gdim
;i++)

869 
	gİt_grid
[
i
]=
cu¼_grid
[i];

874 
	gi
=1;i<=
no
;i++)

875 if(
	gno
%
	gi
==0)

877 
cu¼_grid
[
idim
-1]=
i
;

878 
	g__İt_comm_grid__
::
func
(
idim
-1,
dim
,
h
,
no
/
i
,
cu¼_grid
,
İt_grid
,
İt_size
);

883 
	g‹m¶©e
<cÚ¡ 
	gdim
>

884 
šlše
 
İt_comm_grid
(cÚ¡ 
ty³0
 (&
h
)[
dim
],
no
,(&
İt_grid
)[dim])

886 if(
	gno
==1)

888 
i
=0;
	gi
<
	gdim
;i++)

889 
	gİt_grid
[
i
]=1;

893 
	gcu¼_grid
[
dim
];

894 
ty³0
 
	gİt_size
=0.0;

895 
	g_İt_comm_grid_
<
	gdim
,dim>::
func
(
h
,
no
,
cu¼_grid
,
İt_grid
,
İt_size
);

899 
šlše
 
İt_comm_grid
(cÚ¡ 
ty³0
 (&)[1],
no
,(&
İt_grid
)[1])

901 
	gİt_grid
[0]=
no
;

905 
šlše
 
İt_comm_grid
(cÚ¡ 
dim
,cÚ¡ 
ty³0
* 
h
,
no
,* 
İt_grid
)

907 if(
	gdim
==1)

909 
İt_grid
[0]=
no
;

913 if(
	gno
==1)

915 
i
=0;
	gi
<
	gdim
;i++)

916 
	gİt_grid
[
i
]=1;

920 * 
	gcu¼_grid
 =
Ãw
 [
dim
];

921 
ty³0
 
	gİt_size
=0.0;

922 
	g__İt_comm_grid__
::
func
(
dim
,dim,
h
,
no
,
cu¼_grid
,
İt_grid
,
İt_size
);

923 
	gd–‘e
 [] 
	gcu¼_grid
;

966 
	g‹m¶©e
<
ty³Çme
 
	gT0
,
şass
 
	gCOMP
,şas 
	gSWAP
>

967 
	gXM©h
::
	$quicksÜt
(
T0
 
¡¬t
,T0 
’d
,
COMP
 
comp
,
SWAP
 
sw­
)

969 if(
¡¬t
+1>=
’d
)

971 
T0
 
pšdex
=
¡¬t
;

972 
T0
 
i
=
¡¬t
;i!=
’d
-1;i++)

973 if(
	`comp
(
i
,
’d
-1))

975 
	`sw­
(
i
,
pšdex
);

976 
pšdex
++;

978 
	`sw­
(
’d
-1,
pšdex
);

979 
	`quicksÜt
(
¡¬t
,
pšdex
,
comp
,
sw­
);

980 
	`quicksÜt
(
pšdex
+1,
’d
,
comp
,
sw­
);

981 
	}
}

985 
	g‹m¶©e
<
ty³Çme
 
	gT0
,
şass
 
	gC0
>

986 
	gXM©h
::
	$¤ch_l¡_l¡
(
T0
* 
¡
,
isize
,
C0
* 
Ÿù


987 ,
T0
* 
jl¡
,
jsize
,
C0
* 
jaù
)

989 
XVec
<
T0
,
C0
> 
	`_¡
(
¡
,
isize
,*
Ÿù
);

990 
XVec
<
T0
,
C0
> 
	`_jl¡
(
jl¡
,
jsize
,*
jaù
);

992 if(
isize
==0 || 
jsize
==0)

994 if(
isize
)

996 autØ
os
=
_¡
.
	`begš
();

997 autØ
›nd
=
_¡
.
	`’d
();

998 
os
!=
›nd
)

1000 
os
.
	`Ãq
();

1001 ++
os
;

1005 if(
jsize
)

1007 autØ
jpos
=
_jl¡
.
	`begš
();

1008 autØ
j’d
=
_jl¡
.
	`’d
();

1009 
jpos
!=
j’d
)

1011 
jpos
.
	`Ãq
();

1012 ++
jpos
;

1019 autØ
os
=
_¡
.
	`begš
();

1020 autØ
jpos
=
_jl¡
.
	`begš
();

1021 autØ
›nd
=
_¡
.
	`’d
();

1022 autØ
j’d
=
_jl¡
.
	`’d
();

1024 autØ
ex™
=

1027 
os
!=
›nd
)

1029 
os
.
	`Ãq
();

1030 ++
os
;

1033 
jpos
!=
j’d
)

1035 
jpos
.
	`Ãq
();

1036 ++
jpos
;

1043 *
os
!=*
jpos
)

1045 *
os
<*
jpos
)

1047 
os
.
	`Ãq
();

1048 ++
os
;

1049 if(
os
==
›nd
)

1050  
	`ex™
();

1052 
¡d
::
	`sw­
(
os
,
jpos
);

1053 
¡d
::
	`sw­
(
›nd
,
j’d
);

1055 *
os
==*
jpos
)

1057 
os
.
	`eq
();

1058 
jpos
.
	`eq
();

1059 ++
os
;

1060 ++
jpos
;

1061 if(
os
==
›nd
 || 
jpos
==
j’d
)

1062  
	`ex™
();

1065 
	}
}

1185 
Çme¥aû
 
	gMAPP_NS


1187 
Çme¥aû
 
	gAlgeb¿


1190 
	g‹m¶©e
<cÚ¡ 
	gN
>

1191 şas 
	c__POW


1193 
	gpublic
:

1194 
‹m¶©e
<
ty³Çme
 
T
>

1195 
šlše
 
T
 
func
(T 
x
)

1197  
x
*
__POW
<
N
-1>::
func
(x);

1201 
	g‹m¶©e
<>

1202 
şass
 
	g__POW
<1>

1204 
	gpublic
:

1205 
‹m¶©e
<
ty³Çme
 
T
>

1206 
šlše
 
T
 
func
(T 
x
)

1208  
x
;

1213 
	g‹m¶©e
<cÚ¡ 
	gdim
>

1214 şas 
	c__V_eq


1216 
	gpublic
:

1217 
‹m¶©e
<
ty³Çme
 
T
>

1218 
šlše
 
func
(
T
 cÚ¡ * 
¤c
,T* 
d¡
)

1220 *
	gd¡
=*
¤c
;

1221 
	g__V_eq
<
	gdim
-1>::
func
(
¤c
+1,
d¡
+1);

1225 
	g‹m¶©e
<>

1226 
şass
 
	g__V_eq
<1>

1228 
	gpublic
:

1229 
‹m¶©e
<
ty³Çme
 
T
>

1230 
šlše
 
func
(
T
 cÚ¡ * 
¤c
,T* 
d¡
)

1232 *
	gd¡
=*
¤c
;

1236 
	g‹m¶©e
<cÚ¡ 
	gdim
>

1237 şas 
	c__V_add


1239 
	gpublic
:

1240 
‹m¶©e
<
ty³Çme
 
T
>

1241 
šlše
 
func
(
T
 cÚ¡ * 
¤c
,T* 
d¡
)

1243 *
	gd¡
+=*
¤c
;

1244 
	g__V_add
<
	gdim
-1>::
func
(
¤c
+1,
d¡
+1);

1246 
	g‹m¶©e
<
ty³Çme
 
	gT
>

1247 
šlše
 
func2
(
T
 cÚ¡ * 
¤c0
,T cÚ¡ * 
¤c1
,T* 
d¡
)

1249 *
	gd¡
+=(*
¤c0
+*
¤c1
);

1250 
	g__V_add
<
	gdim
-1>::
func2
(
¤c0
+1,
¤c1
+1,
d¡
+1);

1254 
	g‹m¶©e
<>

1255 
şass
 
	g__V_add
<1>

1257 
	gpublic
:

1258 
‹m¶©e
<
ty³Çme
 
T
>

1259 
šlše
 
func
(
T
 cÚ¡ * 
¤c
,T* 
d¡
)

1261 *
	gd¡
+=*
¤c
;

1263 
	g‹m¶©e
<
ty³Çme
 
	gT
>

1264 
šlše
 
func2
(
T
 cÚ¡ * 
¤c0
,T cÚ¡ * 
¤c1
,T* 
d¡
)

1266 *
	gd¡
+=(*
¤c0
+*
¤c1
);

1270 
	g‹m¶©e
<cÚ¡ 
	gdim
>

1271 şas 
	c__V_sub


1273 
	gpublic
:

1274 
‹m¶©e
<
ty³Çme
 
T
>

1275 
šlše
 
func
(
T
 cÚ¡ * 
¤c
,T* 
d¡
)

1277 *
	gd¡
-=*
¤c
;

1278 
	g__V_sub
<
	gdim
-1>::
func
(
¤c
+1,
d¡
+1);

1280 
	g‹m¶©e
<
ty³Çme
 
	gT
>

1281 
šlše
 
func2
(
T
 cÚ¡ * 
¤c0
,T cÚ¡ * 
¤c1
,T* 
d¡
)

1283 *
	gd¡
-=(*
¤c0
+*
¤c1
);

1284 
	g__V_sub
<
	gdim
-1>::
func2
(
¤c0
+1,
¤c1
+1,
d¡
+1);

1288 
	g‹m¶©e
<>

1289 
şass
 
	g__V_sub
<1>

1291 
	gpublic
:

1292 
‹m¶©e
<
ty³Çme
 
T
>

1293 
šlše
 
func
(
T
 cÚ¡ * 
¤c
,T* 
d¡
)

1295 *
	gd¡
-=*
¤c
;

1297 
	g‹m¶©e
<
ty³Çme
 
	gT
>

1298 
šlše
 
func2
(
T
 cÚ¡ * 
¤c0
,T cÚ¡ * 
¤c1
,T* 
d¡
)

1300 *
	gd¡
-=(*
¤c0
+*
¤c1
);

1304 
	g‹m¶©e
<cÚ¡ 
	gdim
>

1305 şas 
	c__V_add_x_mul_V


1307 
	gpublic
:

1308 
‹m¶©e
<
ty³Çme
 
T
>

1309 
šlše
 
func
(cÚ¡ 
T
& 
x
,T cÚ¡ * 
¤c
,T* 
d¡
)

1311 *
	gd¡
+=
x
**
¤c
;

1312 
	g__V_add_x_mul_V
<
	gdim
-1>::
func
(
x
,
¤c
+1,
d¡
+1);

1316 
	g‹m¶©e
<>

1317 
şass
 
	g__V_add_x_mul_V
<1>

1319 
	gpublic
:

1320 
‹m¶©e
<
ty³Çme
 
T
>

1321 
šlše
 
func
(cÚ¡ 
T
& 
x
,T cÚ¡ * 
¤c
,T* 
d¡
)

1323 *
	gd¡
+=
x
**
¤c
;

1327 
	g‹m¶©e
<cÚ¡ 
	gdim
>

1328 şas 
	c__V_eq_x_mul_V


1330 
	gpublic
:

1331 
‹m¶©e
<
ty³Çme
 
T
>

1332 
šlše
 
func
(cÚ¡ 
T
& 
x
,T cÚ¡ * 
¤c
,T* 
d¡
)

1334 *
	gd¡
=
x
**
¤c
;

1335 
	g__V_eq_x_mul_V
<
	gdim
-1>::
func
(
x
,
¤c
+1,
d¡
+1);

1339 
	g‹m¶©e
<>

1340 
şass
 
	g__V_eq_x_mul_V
<1>

1342 
	gpublic
:

1343 
‹m¶©e
<
ty³Çme
 
T
>

1344 
šlše
 
func
(cÚ¡ 
T
& 
x
,T cÚ¡ * 
¤c
,T* 
d¡
)

1346 *
	gd¡
=
x
**
¤c
;

1351 
	g‹m¶©e
<cÚ¡ 
	gdim
>

1352 şas 
	c__V_z”o


1354 
	gpublic
:

1355 
‹m¶©e
<
ty³Çme
 
T
>

1356 
šlše
 
func
(
T
* 
v
)

1358 *
v
=0;

1359 
	g__V_z”o
<
	gdim
-1>::
func
(
v
+1);

1362 
	g‹m¶©e
<>

1363 
şass
 
	g__V_z”o
<1>

1365 
	gpublic
:

1366 
‹m¶©e
<
ty³Çme
 
T
>

1367 
šlše
 
func
(
T
* 
v
)

1369 *
v
=0;

1373 
	g‹m¶©e
<>

1374 
şass
 
	g__V_z”o
<0>

1376 
	gpublic
:

1377 
‹m¶©e
<
ty³Çme
 
T
>

1378 
šlše
 
func
(
T
*)

1383 
	g‹m¶©e
<cÚ¡ 
	gdim
>

1384 şas 
	c__V_£t


1386 
	gpublic
:

1387 
‹m¶©e
<
ty³Çme
 
T
>

1388 
šlše
 
func
(
T
* 
v
,cÚ¡ T& 
v®
)

1390 *
	gv
=
v®
;

1391 
	g__V_£t
<
	gdim
-1>::
func
(
v
+1,
v®
);

1395 
	g‹m¶©e
<>

1396 
şass
 
	g__V_£t
<1>

1398 
	gpublic
:

1399 
‹m¶©e
<
ty³Çme
 
T
>

1400 
šlše
 
func
(
T
* 
v
,cÚ¡ T& 
v®
)

1402 *
	gv
=
v®
;

1406 
	g‹m¶©e
<>

1407 
şass
 
	g__V_£t
<0>

1409 
	gpublic
:

1410 
‹m¶©e
<
ty³Çme
 
T
>

1411 
šlše
 
func
(
T
*,const T&)

1417 
	g‹m¶©e
<cÚ¡ 
	gdim
,cÚ¡ 
	g¡rd
>

1418 şas 
	c__V_¡rd_z”o


1420 
	gpublic
:

1421 
‹m¶©e
<
ty³Çme
 
T
>

1422 
šlše
 
func
(
T
* 
v
)

1424 *
v
=0;

1425 
	g__V_z”o
<
	gdim
-1>::
func
(
v
+
¡rd
);

1428 
	g‹m¶©e
<cÚ¡ 
	g¡rd
>

1429 
şass
 
	g__V_¡rd_z”o
<1,
	g¡rd
>

1431 
	gpublic
:

1432 
‹m¶©e
<
ty³Çme
 
T
>

1433 
šlše
 
func
(
T
* 
v
)

1435 *
v
=0;

1438 
	g‹m¶©e
<cÚ¡ 
	g¡rd
>

1439 
şass
 
	g__V_¡rd_z”o
<0,
	g¡rd
>

1441 
	gpublic
:

1442 
‹m¶©e
<
ty³Çme
 
T
>

1443 
šlše
 
func
(
T
*)

1451 
	g‹m¶©e
<cÚ¡ 
	gi
>

1452 şas 
	c__V_mul_SCL


1454 
	gpublic
:

1455 
‹m¶©e
<
ty³Çme
 
T
>

1456 
šlše
 
func
(
T
* 
vec
,T 
sş
)

1458 *
	gvec
*=
sş
;

1459  
	g__V_mul_SCL
::
func
(
vec
+1,
sş
);

1463 
	g‹m¶©e
<>

1464 
şass
 
	g__V_mul_SCL
<1>

1466 
	gpublic
:

1467 
‹m¶©e
<
ty³Çme
 
T
>

1468 
šlše
 
func
(
T
* 
vec
,T 
sş
)

1470 *
	gvec
*=
sş
;

1478 
	g‹m¶©e
<cÚ¡ 
	gi
>

1479 şas 
	c__V_mul_V


1481 
	gpublic
:

1482 
‹m¶©e
<
ty³Çme
 
T
>

1483 
šlše
 
T
 
func
(T* 
vec0
,T* 
vec1
)

1485  *
vec0
**
	gvec1
+
	g__V_mul_V
<
	gi
-1>::
func
(vec0+1,
vec1
+1);

1489 
	g‹m¶©e
<>

1490 
şass
 
	g__V_mul_V
<1>

1492 
	gpublic
:

1493 
‹m¶©e
<
ty³Çme
 
T
>

1494 
šlše
 
T
 
func
(T* 
vec0
,T* 
vec1
)

1496  *
vec0
**
	gvec1
;

1500 
	g‹m¶©e
<>

1501 
şass
 
	g__V_mul_V
<0>

1503 
	gpublic
:

1504 
‹m¶©e
<
ty³Çme
 
T
>

1505 
šlše
 
T
 
func
(T*,T*)

1514 
	g‹m¶©e
<cÚ¡ 
	gi
,cÚ¡ 
	g¡rd
>

1515 şas 
	c__V_¡rd_mul_V


1517 
	gpublic
:

1518 
‹m¶©e
<
ty³Çme
 
T
>

1519 
šlše
 
T
 
func
(T* 
vec0
,T* 
vec1
)

1521  *
vec0
**
	gvec1
+
	g__V_¡rd_mul_V
<
	gi
-1,
	g¡rd
>::
func
(vec0+
¡rd
,
vec1
+1);

1525 
	g‹m¶©e
<cÚ¡ 
	g¡rd
>

1526 
şass
 
	g__V_¡rd_mul_V
<1,
	g¡rd
>

1528 
	gpublic
:

1529 
‹m¶©e
<
ty³Çme
 
T
>

1530 
šlše
 
T
 
func
(T* 
vec0
,T* 
vec1
)

1532  *
vec0
**
	gvec1
;

1537 
	g‹m¶©e
<cÚ¡ 
	g¡rd
>

1538 
şass
 
	g__V_¡rd_mul_V
<0,
	g¡rd
>

1540 
	gpublic
:

1541 
‹m¶©e
<
ty³Çme
 
T
>

1542 
šlše
 
T
 
func
(T*,T*)

1550 
	g‹m¶©e
<cÚ¡ 
	gi
,cÚ¡ 
	g¡rd0
,cÚ¡ 
	g¡rd1
>

1551 şas 
	c__V_¡rd_mul_V_¡rd


1553 
	gpublic
:

1554 
‹m¶©e
<
ty³Çme
 
T
>

1555 
šlše
 
T
 
func
(T* 
vec0
,T* 
vec1
)

1557  *
vec0
**
	gvec1
+
	g__V_¡rd_mul_V_¡rd
<
	gi
-1,
	g¡rd0
,
	g¡rd1
>::
func
(vec0+
¡rd0
,
vec1
+
¡rd1
);

1561 
	g‹m¶©e
<cÚ¡ 
	g¡rd0
,cÚ¡ 
	g¡rd1
>

1562 
şass
 
	g__V_¡rd_mul_V_¡rd
<1,
	g¡rd0
,
	g¡rd1
>

1564 
	gpublic
:

1565 
‹m¶©e
<
ty³Çme
 
T
>

1566 
šlše
 
T
 
func
(T* 
vec0
,T* 
vec1
)

1568  *
vec0
**
	gvec1
;

1573 
	g‹m¶©e
<cÚ¡ 
	g¡rd0
,cÚ¡ 
	g¡rd1
>

1574 
şass
 
	g__V_¡rd_mul_V_¡rd
<0,
	g¡rd0
,
	g¡rd1
>

1576 
	gpublic
:

1577 
‹m¶©e
<
ty³Çme
 
T
>

1578 
šlše
 
T
 
func
(T*,T*)

1595 
	g‹m¶©e
<cÚ¡ 
	gi
,cÚ¡ 
	gdim
>

1596 şas 
	c__V_mul_MLT


1598 
	gpublic
:

1599 
‹m¶©e
<
ty³Çme
 
T
>

1600 
šlše
 
func
(
T
* 
V
,T* 
MLT
,T* 
VMLT
)

1602 *
	gVMLT
=
__V_¡rd_mul_V
<
i
,
	gdim
>::
func
(
MLT
,
V
);

1603 
	g__V_mul_MLT
<
	gi
-1,
	gdim
>::
func
(
V
+1,
MLT
+
dim
+1,
VMLT
+1);

1605 
	g‹m¶©e
<
ty³Çme
 
	gT
>

1606 
šlše
 
add_š
(
T
* 
V
,T* 
MLT
,T* 
VMLT
)

1608 *
	gVMLT
+=
__V_¡rd_mul_V
<
i
,
	gdim
>::
func
(
MLT
,
V
);

1609 
	g__V_mul_MLT
<
	gi
-1,
	gdim
>::
add_š
(
V
+1,
MLT
+
dim
+1,
VMLT
+1);

1613 
	g‹m¶©e
<cÚ¡ 
	gdim
>

1614 
şass
 
	g__V_mul_MLT
<1,
	gdim
>

1616 
	gpublic
:

1617 
‹m¶©e
<
ty³Çme
 
T
>

1618 
šlše
 
func
(
T
* 
V
,T* 
MLT
,T* 
VMLT
)

1620 *
	gVMLT
=*
V
**
MLT
;

1622 
	g‹m¶©e
<
ty³Çme
 
	gT
>

1623 
šlše
 
add_š
(
T
* 
V
,T* 
MLT
,T* 
VMLT
)

1625 *
	gVMLT
+=*
V
**
MLT
;

1633 
	g‹m¶©e
<cÚ¡ 
	gi
,cÚ¡ 
	gdim
>

1634 şas 
	c__MLT_mul_V


1636 
	gpublic
:

1637 
‹m¶©e
<
ty³Çme
 
T
>

1638 
šlše
 
func
(
T
* 
MLT
,T* 
V
,T* 
VMLT
)

1640 *
	gVMLT
=
__V_mul_V
<
i
>::
func
(
MLT
,
V
);

1641 
	g__MLT_mul_V
<
	gi
-1,
	gdim
>::
func
(
MLT
-
dim
,
V
,
VMLT
-1);

1645 
	g‹m¶©e
<cÚ¡ 
	gdim
>

1646 
şass
 
	g__MLT_mul_V
<1,
	gdim
>

1648 
	gpublic
:

1649 
‹m¶©e
<
ty³Çme
 
T
>

1650 
šlše
 
func
(
T
* 
MLT
,T* 
V
,T* 
VMLT
)

1652 *
	gVMLT
=*
V
**
MLT
;

1663 
	g‹m¶©e
<cÚ¡ 
	gi
,cÚ¡ 
	gdim
>

1664 şas 
	c__V_mul_MUT


1666 
	gpublic
:

1667 
‹m¶©e
<
ty³Çme
 
T
>

1668 
šlše
 
func
(
T
* 
V
,T* 
MUT
,T* 
VMUT
)

1670 *
	gVMUT
=
__V_¡rd_mul_V
<
i
,
	gdim
>::
func
(
MUT
,
V
);

1671 
	g__V_mul_MUT
<
	gi
-1,
	gdim
>::
func
(
V
,
MUT
-1,
VMUT
-1);

1675 
	g‹m¶©e
<cÚ¡ 
	gdim
>

1676 
şass
 
	g__V_mul_MUT
<1,
	gdim
>

1678 
	gpublic
:

1679 
‹m¶©e
<
ty³Çme
 
T
>

1680 
šlše
 
func
(
T
* 
V
,T* 
MUT
,T* 
VMUT
)

1682 *
	gVMUT
=*
V
**
MUT
;

1691 
	g‹m¶©e
<cÚ¡ 
	gi
,cÚ¡ 
	gdim
>

1692 şas 
	c__MUT_mul_V


1694 
	gpublic
:

1695 
‹m¶©e
<
ty³Çme
 
T
>

1696 
šlše
 
func
(
T
* 
MUT
,T* 
V
,T* 
VMUT
)

1698 *
	gVMUT
=
__V_mul_V
<
i
>::
func
(
MUT
,
V
);

1699 
	g__MUT_mul_V
<
	gi
-1,
	gdim
>::
func
(
MUT
+
dim
+1,
V
+1,
VMUT
+1);

1703 
	g‹m¶©e
<cÚ¡ 
	gdim
>

1704 
şass
 
	g__MUT_mul_V
<1,
	gdim
>

1706 
	gpublic
:

1707 
‹m¶©e
<
ty³Çme
 
T
>

1708 
šlše
 
func
(
T
* 
MUT
,T* 
V
,T* 
VMUT
)

1710 *
	gVMUT
=*
V
**
MUT
;

1719 
	g‹m¶©e
<cÚ¡ 
	grow
,cÚ¡ 
	gdiff
,cÚ¡ 
	gdim
>

1720 şas 
	c__MLT_šv


1722 
	gpublic
:

1723 
‹m¶©e
<
ty³Çme
 
T
>

1724 
šlše
 
func
(
T
* 
MLT
,T* 
MLT_šv
)

1726 *
	gMLT_šv
=-
MLT_šv
[
diff
]*
__V_¡rd_mul_V
<diff,
	gdim
>::
func
(MLT_šv-diff*
dim
,
MLT
);

1727 
	g__MLT_šv
<
	grow
,
	gdiff
+1,
	gdim
>::
func
(
MLT
-1,
MLT_šv
-1);

1732 
	g‹m¶©e
<cÚ¡ 
	gdiff
,cÚ¡ 
	gdim
>

1733 
şass
 
	g__MLT_šv
<
	gdiff
,diff,
	gdim
>

1735 
	gpublic
:

1736 
‹m¶©e
<
ty³Çme
 
T
>

1737 
šlše
 
func
(
T
* 
MLT
,T* 
MLT_šv
)

1739 *
	gMLT_šv
=-
MLT_šv
[
diff
]*
__V_¡rd_mul_V
<diff,
	gdim
>::
func
(MLT_šv-diff*
dim
,
MLT
);

1740 
	g__MLT_šv
<
	gdiff
+1,0,
	gdim
>::
func
(
MLT
+
dim
+
diff
+1,
MLT_šv
+dim+diff+1);

1744 
	g‹m¶©e
<cÚ¡ 
	grow
,cÚ¡ 
	gdim
>

1745 
şass
 
	g__MLT_šv
<
	grow
,0,
	gdim
>

1747 
	gpublic
:

1748 
‹m¶©e
<
ty³Çme
 
T
>

1749 
šlše
 
func
(
T
* 
MLT
,T* 
MLT_šv
)

1751 *
	gMLT_šv
=1.0/(*
MLT
);

1752 
	g__MLT_šv
<
	grow
,1,
	gdim
>::
func
(
MLT
-1,
MLT_šv
-1);

1757 
	g‹m¶©e
<cÚ¡ 
	gdim
>

1758 
şass
 
	g__MLT_šv
<0,0,
	gdim
>

1760 
	gpublic
:

1761 
‹m¶©e
<
ty³Çme
 
T
>

1762 
šlše
 
func
(
T
* 
MLT
,T* 
MLT_šv
)

1764 *
	gMLT_šv
=1.0/(*
MLT
);

1765 
	g__MLT_šv
<1,0,
	gdim
>::
func
(
MLT
+
dim
+1,
MLT_šv
+dim+1);

1770 
	g‹m¶©e
<cÚ¡ 
	gdim
>

1771 
şass
 
	g__MLT_šv
<
	gdim
,0,dim>

1773 
	gpublic
:

1774 
‹m¶©e
<
ty³Çme
 
T
>

1775 
šlše
 
func
(
T
*,T*)

1780 
	g‹m¶©e
<cÚ¡ 
	gi
,cÚ¡ 
	gdim
>

1781 şas 
	c__MLT_d•th


1783 
	gpublic
:

1784 
‹m¶©e
<
ty³Çme
 
T
>

1785 
šlše
 
func
(
T
 cÚ¡ * 
MLT
,T* 
d•th
)

1787 *
	gd•th
=
sq¹
(
__V_¡rd_mul_V_¡rd
<
i
,
dim
,dim>::
func
(
MLT
,MLT));

1788 
	g__MLT_d•th
<
	gi
-1,
	gdim
>::
func
(
MLT
+
dim
+1,
d•th
+1);

1792 
	g‹m¶©e
<cÚ¡ 
	gdim
>

1793 
şass
 
	g__MLT_d•th
<1,
	gdim
>

1795 
	gpublic
:

1796 
‹m¶©e
<
ty³Çme
 
T
>

1797 
šlše
 
func
(
T
 cÚ¡ * 
MLT
,T* 
d•th
)

1799 *
	gd•th
=
çbs
(*
MLT
);

1807 
	g‹m¶©e
<cÚ¡ 
	gi
,cÚ¡ 
	gj
,cÚ¡ 
	gdim
>

1808 şas 
	c__MLT_mul_MSQ


1810 
	gpublic
:

1811 
‹m¶©e
<
ty³Çme
 
T
>

1812 
šlše
 
func
(
T
* 
MLT
,T* 
MSQ
,T* 
MLT_MSQ
)

1814 *
	gMLT_MSQ
=
__V_¡rd_mul_V
<
i
,
	gdim
>::
func
(
MSQ
,
MLT
);

1815 
	g__MLT_mul_MSQ
<
	gi
,
	gj
-1,
	gdim
>::
func
(
MLT
,
MSQ
-1,
MLT_MSQ
-1);

1819 
	g‹m¶©e
<cÚ¡ 
	gi
,cÚ¡ 
	gdim
>

1820 
şass
 
	g__MLT_mul_MSQ
<
	gi
,1,
	gdim
>

1822 
	gpublic
:

1823 
‹m¶©e
<
ty³Çme
 
T
>

1824 
šlše
 
func
(
T
* 
MLT
,T* 
MSQ
,T* 
MLT_MSQ
)

1826 *
	gMLT_MSQ
=
__V_¡rd_mul_V
<
i
,
	gdim
>::
func
(
MSQ
,
MLT
);

1827 
	g__MLT_mul_MSQ
<
	gi
-1,
	gdim
,dim>::
func
(
MLT
-
dim
,
MSQ
+dim-1,
MLT_MSQ
-1);

1831 
	g‹m¶©e
<cÚ¡ 
	gdim
>

1832 
şass
 
	g__MLT_mul_MSQ
<1,1,
	gdim
>

1834 
	gpublic
:

1835 
‹m¶©e
<
ty³Çme
 
T
>

1836 
šlše
 
func
(
T
* 
MLT
,T* 
MSQ
,T* 
MLT_MSQ
)

1838 *
	gMLT_MSQ
=*
MSQ
**
MLT
;

1844 
	g‹m¶©e
<cÚ¡ 
	gi
,cÚ¡ 
	gj
,cÚ¡ 
	gdim
>

1845 şas 
	c__MSQ_mul_MLT


1847 
	gpublic
:

1848 
‹m¶©e
<
ty³Çme
 
T
>

1849 
šlše
 
func
(
T
* 
MSQ
,T* 
MLT
,T* 
MSQ_MLT
)

1851 *
	gMSQ_MLT
=
__V_¡rd_mul_V
<
j
,
	gdim
>::
func
(
MLT
,
MSQ
);

1852 
	g__MSQ_mul_MLT
<
	gi
,
	gj
-1,
	gdim
>::
func
(
MSQ
+1,
MLT
+
dim
+1,
MSQ_MLT
+1);

1856 
	g‹m¶©e
<cÚ¡ 
	gi
,cÚ¡ 
	gdim
>

1857 
şass
 
	g__MSQ_mul_MLT
<
	gi
,1,
	gdim
>

1859 
	gpublic
:

1860 
‹m¶©e
<
ty³Çme
 
T
>

1861 
šlše
 
func
(
T
* 
MSQ
,T* 
MLT
,T* 
MSQ_MLT
)

1863 *
	gMSQ_MLT
=*
MSQ
**
MLT
;

1864 
	g__MSQ_mul_MLT
<
	gi
-1,
	gdim
,dim>::
func
(
MSQ
+1,
MLT
-
dim
*dim+1,
MSQ_MLT
+1);

1868 
	g‹m¶©e
<cÚ¡ 
	gdim
>

1869 
şass
 
	g__MSQ_mul_MLT
<1,1,
	gdim
>

1871 
	gpublic
:

1872 
‹m¶©e
<
ty³Çme
 
T
>

1873 
šlše
 
func
(
T
* 
MSQ
,T* 
MLT
,T* 
MSQ_MLT
)

1875 *
	gMSQ_MLT
=*
MSQ
**
MLT
;

1896 
	g‹m¶©e
<cÚ¡ 
	gi
,cÚ¡ 
	gj
,cÚ¡ 
	gdim
>

1897 şas 
	c___MSQ_mul_MLT


1899 
	gpublic
:

1900 
‹m¶©e
<
ty³Çme
 
T
>

1901 
šlše
 
func
(
T
* 
MSQ
,T* 
MLT
,T* 
MSQ_MLT
)

1903 *
	gMSQ_MLT
=
__V_¡rd_mul_V
<
j
,
	gdim
>::
func
(
MLT
,
MSQ
);

1904 
	g___MSQ_mul_MLT
<
	gi
,
	gj
-1,
	gdim
>::
func
(
MSQ
+1,
MLT
+
dim
+1,
MSQ_MLT
+1);

1908 
	g‹m¶©e
<cÚ¡ 
	gi
,cÚ¡ 
	gdim
>

1909 
şass
 
	g___MSQ_mul_MLT
<
	gi
,i,
	gdim
>

1911 
	gpublic
:

1912 
‹m¶©e
<
ty³Çme
 
T
>

1913 
šlše
 
func
(
T
* 
MSQ
,T* 
MLT
,T* 
MSQ_MLT
)

1915 *
	gMSQ_MLT
=
__V_¡rd_mul_V
<
i
,
	gdim
>::
func
(
MLT
,
MSQ
);

1916 
	g___MSQ_mul_MLT
<
	gi
-1,
	gdim
,dim>::
func
(
MSQ
+
i
,
MLT
-(
dim
-i)*(dim+1),
MSQ_MLT
+i);

1921 
	g‹m¶©e
<cÚ¡ 
	gdim
>

1922 
şass
 
	g___MSQ_mul_MLT
<1,1,
	gdim
>

1924 
	gpublic
:

1925 
‹m¶©e
<
ty³Çme
 
T
>

1926 
šlše
 
func
(
T
* 
MSQ
,T* 
MLT
,T* 
MSQ_MLT
)

1928 *
	gMSQ_MLT
=*
MSQ
**
MLT
;

1944 
	g‹m¶©e
<cÚ¡ 
	gi
,cÚ¡ 
	gj
,cÚ¡ 
	gdim
>

1945 şas 
	c___MUT_mul_MSQ_mul_MLT__


1947 
	gpublic
:

1948 
‹m¶©e
<
ty³Çme
 
T
>

1949 
šlše
 
func
(
T
* 
MLT
,T* 
MSQ
,T* 
ANS
)

1951 *
	gANS
=
__V_¡rd_mul_V_¡rd
<
i
,
	gdim
,dim>::
func
(
MLT
,
MSQ
);

1952 
	g___MUT_mul_MSQ_mul_MLT__
<
	gi
-1,
	gj
,
	gdim
>::
func
(
MLT
+
dim
+1,
MSQ
+dim,
ANS
+dim);

1956 
	g‹m¶©e
<cÚ¡ 
	gj
,cÚ¡ 
	gdim
>

1957 
şass
 
	g___MUT_mul_MSQ_mul_MLT__
<1,
	gj
,
	gdim
>

1959 
	gpublic
:

1960 
‹m¶©e
<
ty³Çme
 
T
>

1961 
šlše
 
func
(
T
* 
MLT
,T* 
MSQ
,T* 
ANS
)

1963 *
	gANS
=*
MLT
**
MSQ
;

1964 
	g___MUT_mul_MSQ_mul_MLT__
<
	gj
-1,j-1,
	gdim
>::
func
(
MLT
-(
j
-2)*(
dim
+1),
MSQ
-(j-2)*dim+1,
ANS
-(j-2)*dim+1);

1969 
	g‹m¶©e
<cÚ¡ 
	gdim
>

1970 
şass
 
	g___MUT_mul_MSQ_mul_MLT__
<1,1,
	gdim
>

1972 
	gpublic
:

1973 
‹m¶©e
<
ty³Çme
 
T
>

1974 
šlše
 
func
(
T
* 
MLT
,T* 
MSQ
,T* 
ANS
)

1976 *
	gANS
=*
MLT
**
MSQ
;

1981 
	g‹m¶©e
<cÚ¡ 
	gi
,cÚ¡ 
	gj
,cÚ¡ 
	gdim
 >

1982 şas 
	c__MLT_T


1984 
	gpublic
:

1985 
‹m¶©e
<
ty³Çme
 
T
>

1986 
šlše
 
func
(
T
* 
RESTRICT
 
MLT
,T* RESTRICT 
MUT
)

1988 *
	gMUT
=*
MLT
;

1989 
	g__MLT_T
<
	gi
-1,
	gj
,
	gdim
>::
func
(
MLT
+
dim
,
MUT
+1);

1994 
	g‹m¶©e
<cÚ¡ 
	gj
,cÚ¡ 
	gdim
 >

1995 
şass
 
	g__MLT_T
<1,
	gj
,
	gdim
>

1997 
	gpublic
:

1998 
‹m¶©e
<
ty³Çme
 
T
>

1999 
šlše
 
func
(
T
* 
RESTRICT
 
MLT
,T* RESTRICT 
MUT
)

2001 *
	gMUT
=*
MLT
;

2002 
	g__MLT_T
<
	gj
-1,j-1,
	gdim
>::
func
(
MLT
+(2-
j
)*
dim
+1,
MUT
-j+dim+2);

2006 
	g‹m¶©e
<cÚ¡ 
	gdim
 >

2007 
şass
 
	g__MLT_T
<1,1,
	gdim
>

2009 
	gpublic
:

2010 
‹m¶©e
<
ty³Çme
 
T
>

2011 
šlše
 
func
(
T
* 
RESTRICT
 
MLT
,T* RESTRICT 
MUT
)

2013 *
	gMUT
=*
MLT
;

2018 
	g‹m¶©e
<cÚ¡ 
	gi
,cÚ¡ 
	gj
,cÚ¡ 
	gdim
 >

2019 şas 
	c__MLT_2_V


2021 
	gpublic
:

2022 
‹m¶©e
<
ty³Çme
 
T
>

2023 
šlše
 
func
(
T
* 
RESTRICT
 
MLT
,T* RESTRICT 
mÉ
)

2025 *
	gmÉ
=*
MLT
;

2026 
	g__MLT_2_V
<
	gi
-1,
	gj
,
	gdim
>::
func
(
MLT
+
dim
,
mÉ
+1);

2031 
	g‹m¶©e
<cÚ¡ 
	gj
,cÚ¡ 
	gdim
 >

2032 
şass
 
	g__MLT_2_V
<1,
	gj
,
	gdim
>

2034 
	gpublic
:

2035 
‹m¶©e
<
ty³Çme
 
T
>

2036 
šlše
 
func
(
T
* 
RESTRICT
 
MLT
,T* RESTRICT 
mÉ
)

2038 *
	gmÉ
=*
MLT
;

2039 
	g__MLT_2_V
<
	gj
-1,j-1,
	gdim
>::
func
(
MLT
+(2-
j
)*
dim
+1,
mÉ
+1);

2043 
	g‹m¶©e
<cÚ¡ 
	gdim
 >

2044 
şass
 
	g__MLT_2_V
<1,1,
	gdim
>

2046 
	gpublic
:

2047 
‹m¶©e
<
ty³Çme
 
T
>

2048 
šlše
 
func
(
T
* 
RESTRICT
 
MLT
,T* RESTRICT 
mÉ
)

2050 *
	gmÉ
=*
MLT
;

2057 
	g‹m¶©e
<cÚ¡ 
	gcŞumn
,cÚ¡ 
	gdiff
,cÚ¡ 
	gdim
>

2058 şas 
	c__MUT_šv


2060 
	gpublic
:

2061 
‹m¶©e
<
ty³Çme
 
T
>

2062 
šlše
 
func
(
T
* 
MUT
,T* 
MUT_šv
)

2064 *
	gMUT_šv
=-
MUT_šv
[
diff
*
dim
]*
__V_¡rd_mul_V
<diff,
	gdim
>::
func
(
MUT
,MUT_inv-diff);

2065 
	g__MUT_šv
<
	gcŞumn
,
	gdiff
+1,
	gdim
>::
func
(
MUT
-
dim
,
MUT_šv
-dim);

2070 
	g‹m¶©e
<cÚ¡ 
	gdiff
,cÚ¡ 
	gdim
>

2071 
şass
 
	g__MUT_šv
<
	gdiff
,diff,
	gdim
>

2073 
	gpublic
:

2074 
‹m¶©e
<
ty³Çme
 
T
>

2075 
šlše
 
func
(
T
* 
MUT
,T* 
MUT_šv
)

2077 *
	gMUT_šv
=-
MUT_šv
[
diff
*
dim
]*
__V_¡rd_mul_V
<diff,
	gdim
>::
func
(
MUT
,MUT_inv-diff);

2078 
	g__MUT_šv
<
	gdiff
+1,0,
	gdim
>::
func
(
MUT
+(
diff
+1)*
dim
+1,
MUT_šv
+(diff+1)*dim+1);

2083 
	g‹m¶©e
<cÚ¡ 
	gcŞumn
,cÚ¡ 
	gdim
>

2084 
şass
 
	g__MUT_šv
<
	gcŞumn
,0,
	gdim
>

2086 
	gpublic
:

2087 
‹m¶©e
<
ty³Çme
 
T
>

2088 
šlše
 
func
(
T
* 
MUT
,T* 
MUT_šv
)

2090 *
	gMUT_šv
=1.0/(*
MUT
);

2091 
	g__MUT_šv
<
	gcŞumn
,1,
	gdim
>::
func
(
MUT
-
dim
,
MUT_šv
-dim);

2096 
	g‹m¶©e
<cÚ¡ 
	gdim
>

2097 
şass
 
	g__MUT_šv
<0,0,
	gdim
>

2099 
	gpublic
:

2100 
‹m¶©e
<
ty³Çme
 
T
>

2101 
šlše
 
func
(
T
* 
MUT
,T* 
MUT_šv
)

2103 *
	gMUT_šv
=1.0/(*
MUT
);

2104 
	g__MUT_šv
<1,0,
	gdim
>::
func
(
MUT
+
dim
+1,
MUT_šv
+dim+1);

2110 
	g‹m¶©e
<cÚ¡ 
	gdim
>

2111 
şass
 
	g__MUT_šv
<
	gdim
,0,dim>

2113 
	gpublic
:

2114 
‹m¶©e
<
ty³Çme
 
T
>

2115 
šlše
 
func
(
T
*,T*)

2126 
	g‹m¶©e
<cÚ¡ 
	gi
,cÚ¡ 
	gj
,cÚ¡ 
	gdim
>

2127 şas 
	c__MSQ_2_MLT


2129 
	gpublic
:

2130 
‹m¶©e
<
ty³Çme
 
T
>

2131 
šlše
 
func
(
T
* 
MSQ
,T* 
MLT
)

2134 
	gMLT
[
i
*
dim
+
j
]=(
__V_mul_V
<dim>::
func
(
MSQ
+j*dim,MSQ+i*dim)-

2135 
	g__V_mul_V
<
	gj
>::
func
(
MLT
+
j
*
dim
,MLT+
i
*dim))/
	gMLT
[j*(dim+1)];

2136 
	g__MSQ_2_MLT
<
	gi
,
	gj
+1,
	gdim
>::
func
(
MSQ
,
MLT
);

2140 
	g‹m¶©e
<cÚ¡ 
	gi
,cÚ¡ 
	gdim
>

2141 
şass
 
	g__MSQ_2_MLT
<
	gi
,i,
	gdim
>

2143 
	gpublic
:

2144 
‹m¶©e
<
ty³Çme
 
T
>

2145 
šlše
 
func
(
T
* 
MSQ
,T* 
MLT
)

2147 
	gMLT
[
i
*
dim
+i]=
sq¹
(
__V_mul_V
<dim>::
func
(
MSQ
+i*dim,MSQ+i*dim)-

2148 
__V_mul_V
<
i
>::
func
(
MLT
+i*
dim
,MLT+i*dim));

2150 
	g__V_z”o
<
	gdim
-
	gi
-1>::
func
(
MLT
+
i
*(
dim
+1)+1);

2151 
	g__MSQ_2_MLT
<
	gi
+1,0,
	gdim
>::
func
(
MSQ
,
MLT
);

2155 
	g‹m¶©e
<cÚ¡ 
	gdim
>

2156 
şass
 
	g__MSQ_2_MLT
<
	gdim
,0,dim>

2158 
	gpublic
:

2159 
‹m¶©e
<
ty³Çme
 
T
>

2160 
šlše
 
func
(
T
*,T*)

2173 
	g‹m¶©e
<cÚ¡ 
	gi
,cÚ¡ 
	gj
,cÚ¡ 
	gdim
>

2174 şas 
	c__MSQ_2_MUT


2176 
	gpublic
:

2177 
‹m¶©e
<
ty³Çme
 
T
>

2178 
šlše
 
func
(
T
* 
M_Şd
,T* 
M_Ãw
)

2181 
	gM_Ãw
[
i
*
dim
+
j
]=(
__V_¡rd_mul_V_¡rd
<dim,
	gdim
,dim>::
func
(
M_Şd
+j,M_old+i)-

2182 
	g__V_¡rd_mul_V_¡rd
<
	gi
,
	gdim
,dim>::
func
(
M_Ãw
+
j
,M_Ãw+
i
))/
	gM_Ãw
[i*(
dim
+1)];

2183 
	g__MSQ_2_MUT
<
	gi
+1,
	gj
,
	gdim
>::
func
(
M_Şd
,
M_Ãw
);

2187 
	g‹m¶©e
<cÚ¡ 
	gi
,cÚ¡ 
	gdim
>

2188 
şass
 
	g__MSQ_2_MUT
<
	gi
,i,
	gdim
>

2190 
	gpublic
:

2191 
‹m¶©e
<
ty³Çme
 
T
>

2192 
šlše
 
func
(
T
* 
M_Şd
,T* 
M_Ãw
)

2196 
	gM_Ãw
[
i
*
dim
+i]=
sq¹
(
__V_¡rd_mul_V_¡rd
<dim,dim,dim>::
func
(
M_Şd
+i,M_old+i)-

2197 
__V_¡rd_mul_V_¡rd
<
i
,
dim
,dim>::
func
(
M_Ãw
+i,M_new+i));

2199 
	g__V_¡rd_z”o
<
	gdim
-
	gi
-1,dim>::
func
(
M_Ãw
+
i
*(
dim
+1)+dim);

2200 
	g__MSQ_2_MUT
<0,
	gi
+1,
	gdim
>::
func
(
M_Şd
,
M_Ãw
);

2204 
	g‹m¶©e
<cÚ¡ 
	gdim
>

2205 
şass
 
	g__MSQ_2_MUT
<0,
	gdim
,dim>

2207 
	gpublic
:

2208 
‹m¶©e
<
ty³Çme
 
T
>

2209 
šlše
 
func
(
T
*,T*)

2217 
	g‹m¶©e
<cÚ¡ 
	grow
,cÚ¡ 
	gdiff
,cÚ¡ 
	gdim
>

2218 şas 
	c__MLT_mul_MLT


2220 
	gpublic
:

2221 
‹m¶©e
<
ty³Çme
 
T
>

2222 
šlše
 
func
(
T
* 
MLTL
,T* 
MLTR
,T* 
MLT
)

2224 *
	gMLT
=
__V_¡rd_mul_V
<
diff
+1,
	gdim
>::
func
(
MLTR
,
MLTL
);

2225 
	g__MLT_mul_MLT
<
	grow
,
	gdiff
-1,
	gdim
>::
func
(
MLTL
+1,
MLTR
+
dim
+1,
MLT
+1);

2229 
	g‹m¶©e
<cÚ¡ 
	grow
,cÚ¡ 
	gdim
>

2230 
şass
 
	g__MLT_mul_MLT
<
	grow
,0,
	gdim
>

2232 
	gpublic
:

2233 
‹m¶©e
<
ty³Çme
 
T
>

2234 
šlše
 
func
(
T
* 
MLTL
,T* 
MLTR
,T* 
MLT
)

2236 *
	gMLT
=*
MLTL
**
MLTR
;

2237 
	g__MLT_mul_MLT
<
	grow
+1,row+1,
	gdim
>::
func
(
MLTL
-
row
+
dim
,
MLTR
-(dim+1)*row,
MLT
-row+dim);

2241 
	g‹m¶©e
<cÚ¡ 
	gdim
>

2242 
şass
 
	g__MLT_mul_MLT
<
	gdim
,dim,dim>

2244 
	gpublic
:

2245 
‹m¶©e
<
ty³Çme
 
T
>

2246 
šlše
 
func
(
T
*,T*,T*)

2255 
	g‹m¶©e
<cÚ¡ 
	gcŞumn
,cÚ¡ 
	gdiff
,cÚ¡ 
	gdim
>

2256 şas 
	c__MUT_mul_MUT


2258 
	gpublic
:

2259 
‹m¶©e
<
ty³Çme
 
T
>

2260 
šlše
 
func
(
T
* 
MUTL
,T* 
MUTR
,T* 
MUT
)

2262 *
	gMUT
=
__V_¡rd_mul_V
<
diff
+1,
	gdim
>::
func
(
MUTR
,
MUTL
);

2263 
	g__MUT_mul_MUT
<
	gcŞumn
,
	gdiff
-1,
	gdim
>::
func
(
MUTL
+1+
dim
,
MUTR
+dim,
MUT
+dim);

2266 
	g‹m¶©e
<cÚ¡ 
	gcŞumn
,cÚ¡ 
	gdim
>

2267 
şass
 
	g__MUT_mul_MUT
<
	gcŞumn
,0,
	gdim
>

2269 
	gpublic
:

2270 
‹m¶©e
<
ty³Çme
 
T
>

2271 
šlše
 
func
(
T
* 
MUTL
,T* 
MUTR
,T* 
MUT
)

2273 *
	gMUT
=*
MUTL
**
MUTR
;

2274 
	g__MUT_mul_MUT
<
	gcŞumn
+1,cŞumn+1,
	gdim
>::
func
(
MUTL
-
cŞumn
*(
dim
+1),
MUTR
-cŞumn*dim+1,
MUT
-column*dim+1);

2278 
	g‹m¶©e
<cÚ¡ 
	gdim
>

2279 
şass
 
	g__MUT_mul_MUT
<
	gdim
,dim,dim>

2281 
	gpublic
:

2282 
‹m¶©e
<
ty³Çme
 
T
>

2283 
šlše
 
func
(
T
*,T*,T*)

2295 
	g‹m¶©e
<cÚ¡ 
	gi
,cÚ¡ 
	gj
,cÚ¡ 
	gdim
>

2296 şas 
	c__DyadicV_mul_MLT


2298 
	gpublic
:

2299 
‹m¶©e
<
ty³Çme
 
T
>

2300 
šlše
 
func
(
T
* 
DyadicV
,T* 
MLT
, T* 
M
)

2302 *
	gM
=
__V_¡rd_mul_V
<
j
,
	gdim
>::
func
(
MLT
,
DyadicV
);

2303 
	g__DyadicV_mul_MLT
<
	gi
,
	gj
-1,
	gdim
>::
func
(
DyadicV
+1,
MLT
+
dim
+1,
M
+1);

2308 
	g‹m¶©e
<cÚ¡ 
	gi
,cÚ¡ 
	gdim
>

2309 
şass
 
	g__DyadicV_mul_MLT
<
	gi
,1,
	gdim
>

2311 
	gpublic
:

2312 
‹m¶©e
<
ty³Çme
 
T
>

2313 
šlše
 
func
(
T
* 
DyadicV
,T* 
MLT
, T* 
M
)

2315 *
	gM
=*
MLT
**
DyadicV
;

2316 
	g__DyadicV_mul_MLT
<
	gi
-1,i-1,
	gdim
>::
func
(
DyadicV
+1,
MLT
-
dim
*dim+1,
M
+1);

2320 
	g‹m¶©e
<cÚ¡ 
	gdim
>

2321 
şass
 
	g__DyadicV_mul_MLT
<1,1,
	gdim
>

2323 
	gpublic
:

2324 
‹m¶©e
<
ty³Çme
 
T
>

2325 
šlše
 
func
(
T
* 
DyadicV
,T* 
MLT
, T* 
M
)

2327 *
	gM
=*
MLT
**
DyadicV
;

2342 
	g‹m¶©e
<cÚ¡ 
	gi
,cÚ¡ 
	gdim
>

2343 şas 
	c__DyadicV


2345 
	gpublic
:

2346 
‹m¶©e
<
ty³Çme
 
T
>

2347 
šlše
 
func
(
T
& 
sş
,T* 
x
,T* 
dyad
)

2349 *
	gdyad
+=*
x
*x[
dim
-
i
]*
sş
;

2350 
	g__DyadicV
<
	gi
-1,
	gdim
>::
func
(
sş
,
x
,
dyad
+1);

2352 
	g‹m¶©e
<
ty³Çme
 
	gT
>

2353 
šlše
 
func
(
T
* 
x
,T* 
y
,T* 
dyad
)

2355 *
	gdyad
+=*
x
**
y
;

2356 
	g__DyadicV
<
	gi
-1,
	gdim
>::
func
(
x
,
y
+1,
dyad
+1);

2359 
	g‹m¶©e
<
ty³Çme
 
	gT
>

2360 
šlše
 
func
(
T
 
sş
,T* 
x
,T* 
y
,T* 
dyad
)

2362 *
	gdyad
+=
sş
*(*
x
*
y
[
dim
-
i
]+*y*x[dim-i]);

2363 
	g__DyadicV
<
	gi
-1,
	gdim
>::
func
(
sş
,
x
,
y
,
dyad
+1);

2367 
	g‹m¶©e
<cÚ¡ 
	gdim
>

2368 
şass
 
	g__DyadicV
<1,
	gdim
>

2370 
	gpublic
:

2371 
‹m¶©e
<
ty³Çme
 
T
>

2372 
šlše
 
func
(
T
& 
sş
,T* 
x
,T* 
dyad
)

2374 *
	gdyad
+=*
x
*x[
dim
-1]*
sş
;

2375 
	g__DyadicV
<
	gdim
-1,dim-1>::
func
(
sş
,
x
+1,
dyad
+1);

2377 
	g‹m¶©e
<
ty³Çme
 
	gT
>

2378 
šlše
 
func
(
T
* 
x
,T* 
y
,T* 
dyad
)

2380 *
	gdyad
+=*
x
**
y
;

2381 
	g__DyadicV
<
	gdim
-1,dim-1>::
func
(
x
+1,
y
-
dim
+2,
dyad
+1);

2383 
	g‹m¶©e
<
ty³Çme
 
	gT
>

2384 
šlše
 
func
(
T
 
sş
,T* 
x
,T* 
y
,T* 
dyad
)

2386 *
	gdyad
+=
sş
*(*
x
*
y
[
dim
-1]+*y*x[dim-1]);

2387 
	g__DyadicV
<
	gdim
-1,dim-1>::
func
(
sş
,
x
+1,
y
+1,
dyad
+1);

2391 
	g‹m¶©e
<>

2392 
şass
 
	g__DyadicV
<1,1>

2394 
	gpublic
:

2395 
‹m¶©e
<
ty³Çme
 
T
>

2396 
šlše
 
func
(
T
& 
sş
,T* 
x
,T* 
dyad
)

2398 *
	gdyad
+=*
x
**x*
sş
;

2400 
	g‹m¶©e
<
ty³Çme
 
	gT
>

2401 
šlše
 
func
(
T
* 
x
,T* 
y
,T* 
dyad
)

2403 *
	gdyad
+=*
x
**
y
;

2405 
	g‹m¶©e
<
ty³Çme
 
	gT
>

2406 
šlše
 
func
(
T
 
sş
,T* 
x
,T* 
y
,T* 
dyad
)

2408 *
	gdyad
+=2.0*
sş
**
x
**
y
;

2415 
	g‹m¶©e
<cÚ¡ 
	gi
,cÚ¡ 
	gj
,cÚ¡ 
	gdim
>

2416 şas 
	c__DyadicV_2_MLT


2418 
	gpublic
:

2419 
‹m¶©e
<
ty³Çme
 
T
>

2420 
šlše
 
func
(
T
* 
dyad
,T* 
MLT
)

2422 *
	gMLT
=*
dyad
;

2423 
	g__DyadicV_2_MLT
<
	gi
-1,
	gj
,
	gdim
>::
func
(
dyad
+1,
MLT
+
dim
);

2428 
	g‹m¶©e
<cÚ¡ 
	gj
,cÚ¡ 
	gdim
>

2429 
şass
 
	g__DyadicV_2_MLT
<1,
	gj
,
	gdim
>

2431 
	gpublic
:

2432 
‹m¶©e
<
ty³Çme
 
T
>

2433 
šlše
 
func
(
T
* 
dyad
,T* 
MLT
)

2435 *
	gMLT
=*
dyad
;

2436 
	g__DyadicV_2_MLT
<
	gj
-1,j-1,
	gdim
>::
func
(
dyad
+1,
MLT
-
dim
*(
j
-2)+1);

2440 
	g‹m¶©e
<cÚ¡ 
	gdim
>

2441 
şass
 
	g__DyadicV_2_MLT
<1,1,
	gdim
>

2443 
	gpublic
:

2444 
‹m¶©e
<
ty³Çme
 
T
>

2445 
šlše
 
func
(
T
* 
dyad
,T* 
MLT
)

2447 *
	gMLT
=*
dyad
;

2453 
	g‹m¶©e
<cÚ¡ 
	gi
,cÚ¡ 
	gj
,cÚ¡ 
	gdim
>

2454 şas 
	c__NONAME_DyadicV_mul_MLT


2456 
	gpublic
:

2457 
‹m¶©e
<
ty³Çme
 
T
>

2458 
šlše
 
func
(
T
* 
dyad
,T* 
MLT
,T* 
ANS
)

2460 *
	gANS
=
__V_¡rd_mul_V
<
i
,
	gdim
>::
func
(
MLT
,
dyad
);

2461 
	g__NONAME_DyadicV_mul_MLT
<
	gi
-1,
	gj
,
	gdim
>::
func
(
dyad
+1,
MLT
+
dim
+1,
ANS
+dim);

2465 
	g‹m¶©e
<cÚ¡ 
	gj
,cÚ¡ 
	gdim
>

2466 
şass
 
	g__NONAME_DyadicV_mul_MLT
<1,
	gj
,
	gdim
>

2468 
	gpublic
:

2469 
‹m¶©e
<
ty³Çme
 
T
>

2470 
šlše
 
func
(
T
* 
dyad
,T* 
MLT
,T* 
ANS
)

2472 *
	gANS
=*
MLT
**
dyad
;

2473 
	g__NONAME_DyadicV_mul_MLT
<
	gj
-1,j-1,
	gdim
>::
func
(
dyad
+1,
MLT
-(
j
-2)*(
dim
+1),
ANS
-(j-2)*dim+1);

2477 
	g‹m¶©e
<cÚ¡ 
	gdim
>

2478 
şass
 
	g__NONAME_DyadicV_mul_MLT
<1,1,
	gdim
>

2480 
	gpublic
:

2481 
‹m¶©e
<
ty³Çme
 
T
>

2482 
šlše
 
func
(
T
* 
dyad
,T* 
MLT
,T* 
ANS
)

2484 *
	gANS
=*
MLT
**
dyad
;

2489 
	g‹m¶©e
<
	gi
,
	gj
,
	gdim
>

2490 şas 
	c__NONAME_DyadicV_2_MLT


2492 
	gpublic
:

2493 
‹m¶©e
<
şass
 
T
>

2494 
func
(
T
* 
x
)

2496 
x
[(
i
-
j
)*(
dim
-1)+j*(j-1)/2]=*x;

2497 
	g__NONAME_DyadicV_2_MLT
<
	gi
-1,
	gj
,
	gdim
>::
func
(
x
-1);

2501 
	g‹m¶©e
<
	gi
,
	gdim
>

2502 
şass
 
	g__NONAME_DyadicV_2_MLT
<
	gi
,i,
	gdim
>

2504 
	gpublic
:

2505 
‹m¶©e
<
şass
 
T
>

2506 
func
(
T
* 
x
)

2508 
x
[
i
*(i-1)/2]=*x;

2509 
	g__NONAME_DyadicV_2_MLT
<
	gdim
,
	gi
-1,dim>::
func
(
x
-1);

2513 
	g‹m¶©e
<
	gdim
>

2514 
şass
 
	g__NONAME_DyadicV_2_MLT
<1,1,
	gdim
>

2516 
	gpublic
:

2517 
‹m¶©e
<
şass
 
T
>

2518 
func
(
T
*)

2523 
	g‹m¶©e
<cÚ¡ 
	gi
,cÚ¡ 
	gj
,cÚ¡ 
	gdim
>

2524 şas 
	c__DyadicV_2_MUT


2526 
	gpublic
:

2527 
‹m¶©e
<
ty³Çme
 
T
>

2528 
šlše
 
func
(
T
* 
dyad
,T* 
MUT
)

2530 *
	gMUT
=*
dyad
;

2531 
	g__DyadicV_2_MUT
<
	gi
-1,
	gj
,
	gdim
>::
func
(
dyad
+1,
MUT
+1);

2535 
	g‹m¶©e
<cÚ¡ 
	gj
,cÚ¡ 
	gdim
>

2536 
şass
 
	g__DyadicV_2_MUT
<1,
	gj
,
	gdim
>

2538 
	gpublic
:

2539 
‹m¶©e
<
ty³Çme
 
T
>

2540 
šlše
 
func
(
T
* 
dyad
,T* 
MUT
)

2542 *
	gMUT
=*
dyad
;

2543 
	g__DyadicV_2_MUT
<
	gj
-1,j-1,
	gdim
>::
func
(
dyad
+1,
MUT
+
dim
+2-
j
);

2547 
	g‹m¶©e
<cÚ¡ 
	gdim
>

2548 
şass
 
	g__DyadicV_2_MUT
<1,1,
	gdim
>

2550 
	gpublic
:

2551 
‹m¶©e
<
ty³Çme
 
T
>

2552 
šlše
 
func
(
T
* 
dyad
,T* 
MUT
)

2554 *
	gMUT
=*
dyad
;

2560 
	g‹m¶©e
<cÚ¡ 
	gi
,cÚ¡ 
	gj
,cÚ¡ 
	gdim
>

2561 şas 
	c__DyadicV_2_MSY


2563 
	gpublic
:

2564 
‹m¶©e
<
ty³Çme
 
T
>

2565 
šlše
 
func
(
T
* 
dyad
,T* 
MSY
)

2567 *
	gMSY
=
MSY
[(
j
-
i
)*(
dim
-1)]=*
dyad
;

2568 
	g__DyadicV_2_MSY
<
	gi
-1,
	gj
,
	gdim
>::
func
(
dyad
+1,
MSY
+1);

2573 
	g‹m¶©e
<cÚ¡ 
	gi
,cÚ¡ 
	gdim
>

2574 
şass
 
	g__DyadicV_2_MSY
<
	gi
,i,
	gdim
>

2576 
	gpublic
:

2577 
‹m¶©e
<
ty³Çme
 
T
>

2578 
šlše
 
func
(
T
* 
dyad
,T* 
MSY
)

2580 *
	gMSY
=*
dyad
;

2581 
	g__DyadicV_2_MSY
<
	gi
-1,i,
	gdim
>::
func
(
dyad
+1,
MSY
+1);

2585 
	g‹m¶©e
<cÚ¡ 
	gj
,cÚ¡ 
	gdim
>

2586 
şass
 
	g__DyadicV_2_MSY
<1,
	gj
,
	gdim
>

2588 
	gpublic
:

2589 
‹m¶©e
<
ty³Çme
 
T
>

2590 
šlše
 
func
(
T
* 
dyad
,T* 
MSY
)

2592 *
	gMSY
=
MSY
[(
j
-1)*(
dim
-1)]=*
dyad
;

2593 
	g__DyadicV_2_MSY
<
	gj
-1,j-1,
	gdim
>::
func
(
dyad
+1,
MSY
+
dim
+2-
j
);

2597 
	g‹m¶©e
<cÚ¡ 
	gdim
>

2598 
şass
 
	g__DyadicV_2_MSY
<1,1,
	gdim
>

2600 
	gpublic
:

2601 
‹m¶©e
<
ty³Çme
 
T
>

2602 
šlše
 
func
(
T
* 
dyad
,T* 
MSY
)

2604 *
	gMSY
=*
dyad
;

2611 
	g‹m¶©e
<cÚ¡ 
	gi
,cÚ¡ 
	gj
,cÚ¡ 
	gdim
>

2612 şas 
	c__MSY_2_DyadicV


2614 
	gpublic
:

2615 
‹m¶©e
<
ty³Çme
 
T
>

2616 
šlše
 
func
(
T
* 
MSY
,T* 
dyad
)

2618 *
	gdyad
=*
MSY
;

2619 
	g__MSY_2_DyadicV
<
	gi
-1,
	gj
,
	gdim
>::
func
(
MSY
+1,
dyad
+1);

2624 
	g‹m¶©e
<cÚ¡ 
	gi
,cÚ¡ 
	gdim
>

2625 
şass
 
	g__MSY_2_DyadicV
<
	gi
,i,
	gdim
>

2627 
	gpublic
:

2628 
‹m¶©e
<
ty³Çme
 
T
>

2629 
šlše
 
func
(
T
* 
MSY
,T* 
dyad
)

2631 *
	gdyad
=*
MSY
;

2632 
	g__MSY_2_DyadicV
<
	gi
-1,i,
	gdim
>::
func
(
MSY
+1,
dyad
+1);

2636 
	g‹m¶©e
<cÚ¡ 
	gj
,cÚ¡ 
	gdim
>

2637 
şass
 
	g__MSY_2_DyadicV
<1,
	gj
,
	gdim
>

2639 
	gpublic
:

2640 
‹m¶©e
<
ty³Çme
 
T
>

2641 
šlše
 
func
(
T
* 
MSY
,T* 
dyad
)

2643 *
	gdyad
=*
MSY
;

2644 
	g__MSY_2_DyadicV
<
	gj
-1,j-1,
	gdim
>::
func
(
MSY
+
dim
+2-
j
,
dyad
+1);

2648 
	g‹m¶©e
<cÚ¡ 
	gdim
>

2649 
şass
 
	g__MSY_2_DyadicV
<1,1,
	gdim
>

2651 
	gpublic
:

2652 
‹m¶©e
<
ty³Çme
 
T
>

2653 
šlše
 
func
(
T
* 
MSY
,T* 
dyad
)

2655 *
	gdyad
=*
MSY
;

2667 
	g‹m¶©e
 <cÚ¡ 
	gi
,cÚ¡ 
	gdim
>

2668 şas 
	c__MLT_d‘


2670 
	gpublic
:

2671 
‹m¶©e
<
ty³Çme
 
T
>

2672 
šlše
 
T
 
func
(T* 
M
)

2674  *
M
*
__MLT_d‘
<
i
-1,
	gdim
>::
func
(M+
dim
+1);

2677 
	g‹m¶©e
 <cÚ¡ 
	gdim
>

2678 
şass
 
	g__MLT_d‘
<1,
	gdim
>

2680 
	gpublic
:

2681 
‹m¶©e
<
ty³Çme
 
T
>

2682 
šlše
 
T
 
func
(T* 
M
)

2684  *
M
;

2689 
	g‹m¶©e
 <cÚ¡ 
	gi
,cÚ¡ 
	gdim
>

2690 şas 
	c__Tr


2692 
	gpublic
:

2693 
‹m¶©e
<
ty³Çme
 
T
>

2694 
šlše
 
T
 
func
(T* 
M
)

2696  *
M
+
__Tr
<
i
-1,
	gdim
>::
func
(M+
dim
+1);

2699 
	g‹m¶©e
 <cÚ¡ 
	gdim
>

2700 
şass
 
	g__Tr
<1,
	gdim
>

2702 
	gpublic
:

2703 
‹m¶©e
<
ty³Çme
 
T
>

2704 
šlše
 
T
 
func
(T* 
M
)

2706  *
M
;

2710 
	g‹m¶©e
 <cÚ¡ 
	gi
,cÚ¡ 
	gdim
>

2711 şas 
	c__Tr_DyadicV


2713 
	gpublic
:

2714 
‹m¶©e
<
ty³Çme
 
T
>

2715 
šlše
 
T
 
func
(T* 
M
)

2717  *
M
+
__Tr_DyadicV
<
i
-1,
	gdim
>::
func
(M+i);

2720 
	g‹m¶©e
 <cÚ¡ 
	gdim
>

2721 
şass
 
	g__Tr_DyadicV
<1,
	gdim
>

2723 
	gpublic
:

2724 
‹m¶©e
<
ty³Çme
 
T
>

2725 
šlše
 
T
 
func
(T* 
M
)

2727  *
M
;

2732 
	g‹m¶©e
<cÚ¡ 
	gi
>

2733 şas 
	c__DX_RSQ


2735 
	gpublic
:

2736 
‹m¶©e
<
şass
 
T
>

2737 
šlše
 
T
 
func
(T cÚ¡* 
xi
,T cÚ¡* 
xj
 ,T* 
dxij
)

2739 *
	gdxij
=*
xi
-*
xj
;

2740  *
dxij
**
	gdxij
+
	g__DX_RSQ
<
	gi
-1>::
func
(
xi
+1,
xj
+1,dxij+1);

2743 
	g‹m¶©e
<
şass
 
	gT
>

2744 
šlše
 
T
 
func
(T cÚ¡ * 
xi
,T cÚ¡ * 
xj
)

2746  (*
	gxi
-*
	gxj
)*(*xi-*xj)+
	g__DX_RSQ
<
	gi
-1>::
func
(
xi
+1,
xj
+1);

2749 
	g‹m¶©e
<
şass
 
	gT
>

2750 
šlše
 
__func
(
T
 cÚ¡* 
xi
,T cÚ¡* 
xj
 ,T* 
dxij
)

2752 *
	gdxij
=*
xi
-*
xj
;

2753 
	g__DX_RSQ
<
	gi
-1>::
__func
(
xi
+1,
xj
+1,
dxij
+1);

2757 
	g‹m¶©e
<>

2758 
şass
 
	g__DX_RSQ
<1>

2760 
	gpublic
:

2761 
‹m¶©e
<
şass
 
T
>

2762 
šlše
 
T
 
func
(T cÚ¡* 
xi
,T cÚ¡* 
xj
 ,T* 
dxij
)

2764 *
	gdxij
=*
xi
-*
xj
;

2765  *
dxij
**
	gdxij
;

2768 
	g‹m¶©e
<
şass
 
	gT
>

2769 
šlše
 
T
 
func
(T cÚ¡ * 
xi
,T cÚ¡ * 
xj
)

2771  (*
	gxi
-*
	gxj
)*(*xi-*xj);

2774 
	g‹m¶©e
<
şass
 
	gT
>

2775 
šlše
 
__func
(
T
 cÚ¡* 
xi
,T cÚ¡* 
xj
 ,T* 
dxij
)

2777 *
	gdxij
=*
xi
-*
xj
;

2783 
	g‹m¶©e
<cÚ¡ 
	gdim
,cÚ¡ 
	gi
>

2784 şas 
	c__DX_HAT_R


2786 
	gpublic
:

2787 
‹m¶©e
<
şass
 
T
>

2788 
šlše
 
T
 
func
(T cÚ¡* 
xi
,T cÚ¡* 
xj
 ,T* 
dxij
)

2790 *
	gdxij
=*
xi
-*
xj
;

2791  *
dxij
**
	gdxij
+
	g__DX_HAT_R
<
	gdim
,
	gi
-1>::
func
(
xi
+1,
xj
+1,dxij+1);

2795 
	g‹m¶©e
<cÚ¡ 
	gdim
>

2796 
şass
 
	g__DX_HAT_R
<
	gdim
,1>

2798 
	gpublic
:

2799 
‹m¶©e
<
şass
 
T
>

2800 
šlše
 
T
 
func
(T cÚ¡* 
xi
,T cÚ¡* 
xj
 ,T* 
dxij
)

2802 *
	gdxij
=*
xi
-*
xj
;

2803  *
dxij
**
	gdxij
;

2807 
	g‹m¶©e
<cÚ¡ 
	gdim
>

2808 
şass
 
	g__DX_HAT_R
<
	gdim
,dim>

2810 
	gpublic
:

2811 
‹m¶©e
<
şass
 
T
>

2812 
šlše
 
T
 
func
(T cÚ¡* 
xi
,T cÚ¡* 
xj
 ,T* 
dxij
)

2814 *
	gdxij
=*
xi
-*
xj
;

2815 
T
 
	gr
=
sq¹
(*
dxij
**dxij+
__DX_HAT_R
<
dim
,dim-1>::
func
(
xi
+1,
xj
+1,dxij+1));

2816 
	g__V_mul_SCL
<
	gdim
>::
func
(
dxij
,1.0/
r
);

2817  
	gr
;

2823 
	g‹m¶©e
<cÚ¡ 
	gN
,cÚ¡ 
	gM
>

2824 şas 
	c__pow


2826 
	gpublic
:

2827 
cÚ¡ex´
 
v®ue
=
N
*
__pow
<N,
	gM
-1>::value;

2830 
	g‹m¶©e
<cÚ¡ 
	gN
>

2831 
şass
 
	g__pow
<
	gN
,1>

2833 
	gpublic
:

2834 
cÚ¡ex´
 
v®ue
=
N
;

2840 
	g‹m¶©e
 <cÚ¡ 
	gi
>

2841 şas 
	cDo


2843 
	gpublic
:

2844 
‹m¶©e
<
ty³Çme
 
FuncTy³
>

2845 
šlše
 
func
(
FuncTy³
 
f
)

2847 
Do
<
i
-1>::
func
(
f
);

2848 
f
(
i
-1);

2851 
	g‹m¶©e
 <>

2852 
şass
 
	gDo
<1>

2854 
	gpublic
:

2855 
‹m¶©e
<
ty³Çme
 
FuncTy³
>

2856 
šlše
 
func
(
FuncTy³
 
f
){f(0);}

2858 
	g‹m¶©e
 <>

2859 
şass
 
	gDo
<0>

2861 
	gpublic
:

2862 
‹m¶©e
<
ty³Çme
 
FuncTy³
>

2863 
šlše
 
func
(
FuncTy³
){}

2867 
	g‹m¶©e
 <cÚ¡ 
	gi
,cÚ¡ 
	gj
=
i
>

2868 şas 
	cDoLT


2870 
public
:

2871 
‹m¶©e
<
ty³Çme
 
FuncTy³
>

2872 
šlše
 
func
(
FuncTy³
 
f
)

2874 
DoLT
<
i
,
j
-1>::
func
(
f
);

2875 
f
(
i
-1,
j
-1);

2879 
	g‹m¶©e
 <cÚ¡ 
	gi
>

2880 
şass
 
	gDoLT
<
	gi
,1>

2882 
	gpublic
:

2883 
‹m¶©e
<
ty³Çme
 
FuncTy³
>

2884 
šlše
 
func
(
FuncTy³
 
f
)

2886 
DoLT
<
i
-1,
	gi
-1>::
func
(
f
);

2887 
f
(
i
-1,0);

2891 
	g‹m¶©e
 <>

2892 
şass
 
	gDoLT
<1,1>

2894 
	gpublic
:

2895 
‹m¶©e
<
ty³Çme
 
FuncTy³
>

2896 
šlše
 
func
(
FuncTy³
 
f
)

2897 {
f
(0,0);}

2904 
	g‹m¶©e
<cÚ¡ 
	gdim
>

2905 şas 
	c__S2X


2907 
	gpublic
:

2908 
‹m¶©e
<
ty³Çme
 
T
>

2909 
šlše
 
func
(
T
* 
RESTRICT
 
h
,T* RESTRICT 
s
)

2911 *
	gs
=
__V_mul_V
<
dim
>::
func
(
h
,
s
);

2913 
	g__S2X
<
	gdim
-1>::
func
(
h
+
dim
,
s
+1);

2917 
	g‹m¶©e
<>

2918 
şass
 
	g__S2X
<1>

2920 
	gpublic
:

2921 
‹m¶©e
<
ty³Çme
 
T
>

2922 
šlše
 
func
(
T
* 
RESTRICT
 
h
,T* RESTRICT 
s
)

2924 *
	gs
*=*
h
;

2928 
	g‹m¶©e
<cÚ¡ 
	gdim
>

2929 şas 
	c__X2S


2931 
	gpublic
:

2932 
‹m¶©e
<
ty³Çme
 
T
>

2933 
šlše
 
func
(
T
* 
RESTRICT
 
b
,T* RESTRICT 
x
)

2935 *
	gx
=
__V_mul_V
<
dim
>::
func
(
b
,
x
);

2936 *
	gx
<0.0) ++*x;

2937 *
	gx
>=1.0è--*
x
;

2938 
	g__X2S
<
	gdim
-1>::
func
(
b
+
dim
,
x
+1);

2942 
	g‹m¶©e
<>

2943 
şass
 
	g__X2S
<1>

2945 
	gpublic
:

2946 
‹m¶©e
<
ty³Çme
 
T
>

2947 
šlše
 
func
(
T
* 
RESTRICT
 
b
,T* RESTRICT 
x
)

2949 *
	gx
*=*
b
;

2950 *
	gx
<0.0) ++*x;

2951 *
	gx
>=1.0è--*
x
;

2955 
	g‹m¶©e
<cÚ¡ 
	gdim
>

2956 şas 
	c__X2S_NOCORR


2958 
	gpublic
:

2959 
‹m¶©e
<
ty³Çme
 
T
>

2960 
šlše
 
func
(
T
* 
RESTRICT
 
b
,T* RESTRICT 
x
)

2962 *
	gx
=
__V_mul_V
<
dim
>::
func
(
b
,
x
);

2963 
	g__X2S_NOCORR
<
	gdim
-1>::
func
(
b
+
dim
,
x
+1);

2967 
	g‹m¶©e
<>

2968 
şass
 
	g__X2S_NOCORR
<1>

2970 
	gpublic
:

2971 
‹m¶©e
<
ty³Çme
 
T
>

2972 
šlše
 
func
(
T
* 
RESTRICT
 
b
,T* RESTRICT 
x
)

2974 *
	gx
*=*
b
;

2979 şas 
	c__İt_comm_grid


2981 
	gpublic
:

2982 
func
(cÚ¡ 
idim
,cÚ¡ 
dim
,cÚ¡ 
ty³0
* 
h
,
no
,* 
cu¼_grid
,* 
İt_grid
,ty³0& 
İt_size
)

2984 if(
	gidim
==1)

2986 
cu¼_grid
[0]=
no
;

2987 
ty³0
 
	gcu¼_size
=0.0;

2988 
	gi
=0;i<
	gdim
;i++è
	gcu¼_size
+=
¡©ic_ÿ¡
<
ty³0
>(
cu¼_grid
[
i
])/
h
[i];

2989 if(
	gİt_size
==0.0 || 
cu¼_size
<
İt_size
)

2991 
İt_size
=
cu¼_size
;

2992 
	gi
=0;i<
	gdim
;i++)

2993 
	gİt_grid
[
i
]=
cu¼_grid
[i];

2998 
	gi
=1;i<=
no
;i++)

2999 if(
	gno
%
	gi
==0)

3001 
cu¼_grid
[
idim
-1]=
i
;

3002 
	g__İt_comm_grid
::
func
(
idim
-1,
dim
,
h
,
no
/
i
,
cu¼_grid
,
İt_grid
,
İt_size
);

3010 
	g‹m¶©e
<cÚ¡ 
	gN
,
ty³Çme
 
	gT
>

3011 
T
 
pow
(T 
x
)

3013  
	g__POW
<
	gN
>::
func
(
x
);

3016 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3017 
z”o
(
T
* 
V
)

3019 
	g__V_z”o
<
	gdim
>::
func
(
V
);

3022 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3023 
£t
(
T
* 
V
,cÚ¡ T& 
v®
)

3025 
	g__V_£t
<
	gdim
>::
func
(
V
,
v®
);

3028 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3029 
MSQ_2_MLT
(
T
(&
MSQ
)[
dim
][dim],T(&
MLT
)[dim][dim])

3031 
	g__MSQ_2_MLT
<0,0,
	gdim
>::
func
(&
MSQ
[0][0],&
MLT
[0][0]);

3034 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3035 
MLT_šv
(
T
(&
MLT
)[
dim
][dim],T(&MLT_inv)[dim][dim])

3037 
	g__MLT_šv
<0,0,
	gdim
>::
func
(&
MLT
[0][0],&
MLT_šv
[0][0]);

3040 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3041 
MUT_šv
(
T
(&
MUT
)[
dim
][dim],T(&MUT_inv)[dim][dim])

3043 
	g__MUT_šv
<0,0,
	gdim
>::
func
(&
MUT
[0][0],&
MUT_šv
[0][0]);

3046 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3047 
T
 
V_mul_V
(cÚ¡ T* 
V0
,cÚ¡ T* 
V1
)

3049  
	g__V_mul_V
<
	gdim
>::
func
(
V0
,
V1
);

3052 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3053 
MLT_mul_V
(
T
(&
MLT
)[
dim
][dim],T*&
V
,T*&
MLTV
)

3055 
	g__MLT_mul_V
<
	gdim
,dim> ::
func
(&
MLT
[
dim
-1][0],
V
,&
MLTV
[dim-1]);

3057 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3058 
MLT_mul_V
(
T
(&
MLT
)[
dim
][dim],T*&
V
,T(&
MLTV
)[dim])

3060 
	g__MLT_mul_V
<
	gdim
,dim> ::
func
(&
MLT
[
dim
-1][0],
V
,&
MLTV
[dim-1]);

3063 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3064 
V_mul_MLT
(
T
* 
V
,T (*
MLT
)[
dim
],T* 
VMLT
)

3066 
	g__V_mul_MLT
<
	gdim
,dim> ::
func
(
V
,&
MLT
[0][0],
VMLT
);

3069 
	g‹m¶©e
<
ty³Çme
 
	gT
,cÚ¡ 
	gdim
>

3070 
V_mul_MLT_add_š
(
T
* 
V
,T (*
MLT
)[
dim
],T* 
VMLT
)

3072 
	g__V_mul_MLT
<
	gdim
,dim>::
add_š
(
V
,&
MLT
[0][0],
VMLT
);

3075 
	g‹m¶©e
<
ty³Çme
 
	gT
,cÚ¡ 
	gdim
>

3076 
MLT_d•th
(
T
(&
MLT
)[
dim
][dim],T(&
d•th
)[dim])

3078 
	g__MLT_d•th
<
	gdim
,dim>::
func
(&(
MLT
[0][0]),
d•th
);

3081 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3082 
MUT_mul_V
(
T
(&
MUT
)[
dim
][dim],T*&
V
,T*&
MUTV
)

3084 
	g__MUT_mul_V
<
	gdim
,dim> ::
func
(&
MUT
[0][0],
V
,
MUTV
);

3086 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3087 
MUT_mul_V
(
T
(&
MUT
)[
dim
][dim],T*&
V
,T(&
MUTV
)[dim])

3089 
	g__MUT_mul_V
<
	gdim
,dim> ::
func
(&
MUT
[0][0],
V
,
MUTV
);

3092 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3093 
V_mul_MUT
(
T
*&
V
,T(&
MUT
)[
dim
][dim],T*&
VMUT
)

3095 
	g__V_mul_MUT
<
	gdim
,dim> ::
func
(
V
,&
MUT
[0][
dim
-1],
VMUT
[dim-1]);

3097 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3098 
V_mul_MUT
(
T
*&
V
,T(&
MUT
)[
dim
][dim],T(&
VMUT
)[dim])

3100 
	g__V_mul_MUT
<
	gdim
,dim> ::
func
(
V
,&
MUT
[0][
dim
-1],
VMUT
[dim-1]);

3103 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3104 
MLT_mul_MLT
(
T
(*
MLTL
)[
dim
],T(*
MLTR
)[dim],T(*
MLT
)[dim])

3106 
	g__MLT_mul_MLT
<0,0,
	gdim
>::
func
(&
MLTL
[0][0],&
MLTR
[0][0],&
MLT
[0][0]);

3109 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3110 
MUT_mul_MUT
(
T
(&
MUTL
)[
dim
][dim],T(&
MUTR
)[dim][dim],T(&
MUT
)[dim][dim])

3112 
	g__MUT_mul_MUT
<0,0,
	gdim
>::
func
(&
MUTL
[0][0],&
MUTR
[0][0],&
MUT
[0][0]);

3115 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3116 
MSQ_mul_MLT
(
T
(&
MSQ
)[
dim
][dim],T(&
MLT
)[dim][dim],T(&
MSQ_MLT
)[dim][dim])

3118 
	g__MSQ_mul_MLT
<
	gdim
,dim,dim>::
func
(&
MSQ
[0][0],&
MLT
[0][0],&
MSQ_MLT
[0][0]);

3120 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3121 
MSQ_mul_MLT_LT
(
T
(&
MSQ
)[
dim
][dim],T(&
MLT
)[dim][dim],T(&
MSQ_MLT
)[dim][dim])

3123 
	g___MSQ_mul_MLT
<
	gdim
,dim,dim>::
func
(&
MSQ
[0][0],&
MLT
[0][0],&
MSQ_MLT
[0][0]);

3126 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3127 
MUT_mul_MSQ_mul_MLT
(
T
(&
MSQ
)[
dim
][dim],T(&
MLT
)[dim][dim],T(&
MSQ_MLT
)[dim][dim])

3130 
	g___MUT_mul_MSQ_mul_MLT__
<
	gdim
,dim,dim>::
func
(&
MSQ
[0][0],&
MLT
[0][0],&
MSQ_MLT
[0][0]);

3132 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3133 
MUT_mul_MSY_mul_MLT
(
T
(&
MSY
)[
dim
][dim],T(&
MLT
)[dim][dim],T(&
__MLT
)[dim][dim],T(&
ANS
)[dim][dim])

3135 
	g___MSQ_mul_MLT
<
	gdim
,dim,dim>::
func
(&
MSY
[0][0],&
MLT
[0][0],&
__MLT
[0][0]);

3136 
	g___MUT_mul_MSQ_mul_MLT__
<
	gdim
,dim,dim>::
func
(&
MLT
[0][0],&
__MLT
[0][0],&
ANS
[0][0]);

3139 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3140 
MLT_mul_MSQ
(
T
(&
MLT
)[
dim
][dim],T(&
MSQ
)[dim][dim],T(&
MLT_MSQ
)[dim][dim])

3142 
	g__MLT_mul_MSQ
<
	gdim
,dim,dim>::
func
(&
MLT
[
dim
-1][0],&
MSQ
[0][dim-1],&
MLT_MSQ
[dim-1][dim-1]);

3145 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3146 
MLT_T
(
T
(&
MLT
)[
dim
][dim],T(&
MUT
)[dim][dim])

3148 
	g__MLT_T
<
	gdim
,dim,dim>::
func
(&
MLT
[0][0],&
MUT
[0][0]);

3151 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3152 
MLT_2_V
(
T
(&
MLT
)[
dim
][dim],T* 
mÉ
)

3154 
	g__MLT_2_V
<
	gdim
,dim,dim>::
func
(&
MLT
[0][0],
mÉ
);

3157 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3158 
DyadicV
(
T
 
sş
,T* 
x
,T* 
dyad
)

3160 
	g__DyadicV
<
	gdim
,dim>::
func
(
sş
,
x
,
dyad
);

3178 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3179 
DyadicV
(
T
*&
x
,T*& 
y
,T* 
dyad
)

3181 
	g__DyadicV
<
	gdim
,dim>::
func
(
x
,
y
,
dyad
);

3184 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3185 
DyadicV
(
T
 
sş
,T* 
x
,T* 
y
,T* 
dyad
)

3187 
	g__DyadicV
<
	gdim
,dim>::
func
(
sş
,
x
,
y
,
dyad
);

3196 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3197 
DyadicV_2_MLT
(
T
* 
dyad
,T (*
MLT
)[
dim
])

3199 
	g__DyadicV_2_MLT
<
	gdim
,dim,dim>::
func
(
dyad
,
MLT
[0]);

3201 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3202 
DyadicV_2_MSY
(
T
* 
dyad
,T (*
MLT
)[
dim
])

3204 
	g__DyadicV_2_MSY
<
	gdim
,dim,dim>::
func
(
dyad
,
MLT
[0]);

3206 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3207 
MSY_2_DyadicV
(
T
 (*
MLT
)[
dim
],T* 
dyad
)

3209 
	g__MSY_2_DyadicV
<
	gdim
,dim,dim>::
func
(
MLT
[0],
dyad
);

3212 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3213 
DyadicV_2_MUT
(
T
(&
dyad
)[
dim
*(dim+1)/2],T (&
MUT
)[dim][dim])

3215 
	g__DyadicV_2_MUT
<
	gdim
,dim,dim>::
func
(
dyad
,&
MUT
[0][0]);

3218 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3219 
T
 
Tr
(T(&
M
)[
dim
][dim])

3221  
	g__Tr
<
	gdim
,dim>::
func
(&
M
[0][0]);

3223 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3224 
T
 
Tr_DyadicV
(T* 
DyadicV
)

3226  
	g__Tr_DyadicV
<
	gdim
,dim>::
func
(
DyadicV
);

3229 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3230 
T
 
MLT_d‘
(T(&
M
)[
dim
][dim])

3232  
	g__MLT_d‘
<
	gdim
,dim>::
func
(&
M
[0][0]);

3235 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3236 
T
 
MLT_max
(T(&
MLT
)[
dim
][dim])

3238 
T
 
	gmax
=
MLT
[0][0];

3239 
	gAlgeb¿
::
DoLT
<
dim
>::
func
([&
max
,&
MLT
](
i
,
j
){max=max<MLT[i][j]?MLT[i][j]:max;});

3240  
	gmax
;

3243 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3244 
T
 
MLT_mš
(T(&
MLT
)[
dim
][dim])

3246 
T
 
	gmš
=
MLT
[0][0];

3247 
	gAlgeb¿
::
DoLT
<
dim
>::
func
([&
mš
,&
MLT
](
i
,
j
){min=min>MLT[i][j]?MLT[i][j]:min;});

3248  
	gmš
;

3251 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3252 
NONAME_DyadicV_mul_MLT
(
T
* 
DyadicV
,T(&
MLT
)[
dim
][dim],T(&
ANS
)[dim][dim])

3254 
	g__NONAME_DyadicV_mul_MLT
<
	gdim
,dim,dim>::
func
(
DyadicV
,&
MLT
[0][0],&
ANS
[0][0]);

3256 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3257 
NONAME_DyadicV_mul_MLT
(
T
* 
DyadicV
,T(&
MLT
)[
dim
][dim],T(*&
ANS
)[dim])

3259 
	g__NONAME_DyadicV_mul_MLT
<
	gdim
,dim,dim>::
func
(
DyadicV
,&
MLT
[0][0],&
ANS
[0][0]);

3262 
	g‹m¶©e
<
	gdim
,
şass
 
	gT
>

3263 
NONAME_DyadicV_2_MLT
(
T
(&
MLT
)[
dim
][dim])

3265 
	g__NONAME_DyadicV_2_MLT
<
	gdim
,dim,dim>::
func
(&
MLT
[0][0]+
dim
*(dim+1)/2-1);

3268 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3269 
T
 
DX_RSQ
(T cÚ¡ * 
xi
,T cÚ¡ * 
xj
,T (&
dxij
)[
dim
])

3271  
	g__DX_RSQ
<
	gdim
>::
func
(
xi
,
xj
,
dxij
);

3274 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3275 
T
 
DX_HAT_R
(T cÚ¡ * 
xi
,T cÚ¡ * 
xj
,T (&
dxij
)[
dim
])

3277  
	g__DX_HAT_R
<
	gdim
,dim>::
func
(
xi
,
xj
,
dxij
);

3286 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3287 
T
 
RSQ
(T cÚ¡ * 
xi
,T cÚ¡ * 
xj
)

3289  
	g__DX_RSQ
<
	gdim
>::
func
(
xi
,
xj
);

3292 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3293 
DX
(
T
 cÚ¡ * 
xi
,T cÚ¡ * 
xj
,T* 
dxij
)

3295 
	g__DX_RSQ
<
	gdim
>::
__func
(
xi
,
xj
,
dxij
);

3298 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3299 
V_eq
(
T
 cÚ¡ * 
¤c
,T* 
d¡
)

3301 
	g__V_eq
<
	gdim
>::
func
(
¤c
,
d¡
);

3304 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3305 
V_add
(
T
 cÚ¡ * 
¤c
,T* 
d¡
)

3307 
	g__V_add
<
	gdim
>::
func
(
¤c
,
d¡
);

3309 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3310 
V_add2
(
T
 cÚ¡ * 
¤c0
,T cÚ¡ * 
¤c1
,T* 
d¡
)

3312 
	g__V_add
<
	gdim
>::
func2
(
¤c0
,
¤c1
,
d¡
);

3315 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3316 
V_sub
(
T
 cÚ¡ * 
¤c
,T* 
d¡
)

3318 
	g__V_sub
<
	gdim
>::
func
(
¤c
,
d¡
);

3320 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3321 
V_sub2
(
T
 cÚ¡ * 
¤c0
,T cÚ¡ * 
¤c1
,T* 
d¡
)

3323 
	g__V_sub
<
	gdim
>::
func2
(
¤c0
,
¤c1
,
d¡
);

3326 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3327 
V_add_x_mul_V
(cÚ¡ 
T
 
x
,T cÚ¡ * 
¤c
,T* 
d¡
)

3329 
	g__V_add_x_mul_V
<
	gdim
>::
func
(
x
,
¤c
,
d¡
);

3332 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3333 
V_eq_x_mul_V
(cÚ¡ 
T
 
x
,T cÚ¡ * 
¤c
,T* 
d¡
)

3335 
	g__V_eq_x_mul_V
<
	gdim
>::
func
(
x
,
¤c
,
d¡
);

3338 
	g‹m¶©e
<cÚ¡ 
	gN
,cÚ¡ 
	gM
>

3339 
cÚ¡ex´
 
pow
()

3341  
	g__pow
<
	gN
,
	gM
>::
v®ue
;

3344 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3345 
X2S
(
T
* 
RESTRICT
 
b
,
N
,T* RESTRICT 
x
)

3347 
	gi
=0;i<
	gN
;i++)

3349 
	g__X2S
<
	gdim
>::
func
(
b
,
x
);

3350 
	gx
+=
dim
;

3354 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3355 
X2S_NOCORR
(
T
* 
RESTRICT
 
b
,
N
,T* RESTRICT 
x
)

3357 
	gi
=0;i<
	gN
;i++)

3359 
	g__X2S_NOCORR
<
	gdim
>::
func
(
b
,
x
);

3360 
	gx
+=
dim
;

3364 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3365 
S2X
(
T
* 
RESTRICT
 
h
,
N
,T* RESTRICT 
s
)

3367 
	gi
=0;i<
	gN
;i++)

3369 
	g__S2X
<
	gdim
>::
func
(
h
,
s
);

3370 
	gs
+=
dim
;

3375 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3376 
X2S
(
T
* 
RESTRICT
 
b
,T* RESTRICT 
x
)

3378 
	g__X2S
<
	gdim
>::
func
(
b
,
x
);

3381 
	g‹m¶©e
<cÚ¡ 
	gdim
,
ty³Çme
 
	gT
>

3382 
S2X
(
T
* 
RESTRICT
 
h
,T* RESTRICT 
s
)

3384 
	g__S2X
<
	gdim
>::
func
(
h
,
s
);

3387 
šlše
 
İt_comm_grid
(cÚ¡ 
dim
,cÚ¡ 
ty³0
* 
h
,
no
,* 
İt_grid
)

3389 if(
	gdim
==1)

3391 
İt_grid
[0]=
no
;

3395 if(
	gno
==1)

3397 
i
=0;
	gi
<
	gdim
;i++)

3398 
	gİt_grid
[
i
]=1;

3402 * 
	gcu¼_grid
 =
Ãw
 [
dim
];

3403 
ty³0
 
	gİt_size
=0.0;

3404 
	g__İt_comm_grid
::
func
(
dim
,dim,
h
,
no
,
cu¼_grid
,
İt_grid
,
İt_size
);

3405 
	gd–‘e
 [] 
	gcu¼_grid
;

3416 
	g‹m¶©e
<cÚ¡ 
	gN
>

3417 
	gXM©h
::
quad_hg
(
ty³0
 (&
x
)[
N
],ty³0 (&
w
)[N])

3419 
cÚ¡ex´
 
	gM
=
N
/2+1;

3420 cÚ¡ 
	gmax_™”
=50;

3421 
cÚ¡ex´
 
ty³0
 
	gtŞ
=
¡d
::
num”ic_lim™s
<ty³0>::
•sÚ
();

3427 
ty³0
 
	gp_1
[
M
];

3428 
ty³0
 
	gp_2
[
M
];

3429 
ty³0
 
	gp_cÛf
[
M
];

3430 
ty³0
 
	gdp_cÛf
[
M
];

3432 
	gAlgeb¿
::
z”o
<
M
>(
p_1
);

3433 
	gAlgeb¿
::
z”o
<
M
>(
p_2
);

3434 
	gAlgeb¿
::
z”o
<
M
>(
p_cÛf
);

3435 
	gAlgeb¿
::
z”o
<
M
>(
dp_cÛf
);

3438 
	gp_1
[0]=1.0;

3439 
	gp_cÛf
[0]=1.0;

3440 
ty³0
 
	gii
;

3441 
	gm
,
	gi
=0;i<
	gN
;i++)

3443 
	gii
=
¡©ic_ÿ¡
<
ty³0
>(
i
+1);

3444 
	gm
=(
i
+3)/2;

3445 if(
	gi
%2)

3447 
	gj
=0;j<
	gm
;j++)

3448 
	gp_cÛf
[
j
]=-2.0*(
ii
-1.0)*
p_2
[j];

3449 
	gj
=1;j<
	gm
;j++)

3450 
	gp_cÛf
[
j
]+=2.0*
p_1
[j-1];

3454 
	gj
=0;j<
	gm
;j++)

3455 
	gp_cÛf
[
j
]=2.0*
p_1
[j]-2.0*(
ii
-1.0)*
p_2
[j];

3458 
	gj
=0;j<
	gm
;j++)

3460 
	gp_2
[
j
]=
p_1
[j];

3461 
	gp_1
[
j
]=
p_cÛf
[j];

3466 
	gi
=0;i<
	gM
-1;i++)

3467 
	gdp_cÛf
[
i
]=
p_cÛf
[i+1]*
¡©ic_ÿ¡
<
ty³0
>(i+1);

3469 
	g™”
,
	gÜd
,
	gicurs
;

3470 
ty³0
 
	ga
,
	gu0
,
	gšv_u0
,
	gf
,
	gdf
,
	gtmp0
,
	gtmp1
,
	gd–_u0
;

3472 
	gÜd
=
M
;

3473 
	gicurs
=
N
/2;

3474 if(
	gN
%2==1)

3476 
x
[
icurs
]=0.0;

3477 
	gicurs
++;

3480 
	ga
=
p_cÛf
[
M
-1];

3482 
	gi
=0;i<
	gM
;i++)

3483 
	gp_cÛf
[
i
]/=
a
;

3484 
	gi
=0;i<
	gM
-1;i++)

3485 
	gdp_cÛf
[
i
]/=
a
;

3489 
	gÜd
>1)

3491 
	gu0
=0.0;

3492 
	gf
=1.0;

3493 
	gd–_u0
=0.0;

3494 
	g™”
=
max_™”
;

3495 
çbs
(
f
)>
	gtŞ
 && 
	g™”
)

3497 
	gu0
+=
d–_u0
;

3498 
	gdf
=
f
=0.0;

3499 
	gtmp0
=1.0;

3500 
	gj
=0;j<
	gÜd
-1;j++)

3502 
	gf
+=
p_cÛf
[
j
]*
tmp0
;

3503 
	gdf
+=
dp_cÛf
[
j
]*
tmp0
;

3504 
	gtmp0
*=
u0
;

3506 
	gf
+=
p_cÛf
[
Üd
-1]*
tmp0
;

3507 
	gd–_u0
=-
f
/
df
;

3508 
	g™”
--;

3511 
	gx
[
icurs
]=
sq¹
(
u0
);

3513 
	gtmp0
=1.0;

3514 
	gtmp1
=0.0;

3515 
	gi
=0;i<
	gM
;i++)

3517 
	gtmp1
+=
p_2
[
i
]*
tmp0
;

3518 
	gtmp0
*=
u0
;

3521 if(
	gN
%2==0)

3522 
tmp1
*=
sq¹
(
u0
);

3524 
	gw
[
icurs
]=1.0/(
tmp1
*tmp1);

3527 
	gšv_u0
=1.0/
u0
;

3528 
	gp_cÛf
[0]*=-
šv_u0
;

3529 
	gi
=1;i<
	gÜd
-1;i++)

3531 
	gp_cÛf
[
i
]*=-
šv_u0
;

3532 
	gp_cÛf
[
i
]+=
šv_u0
*
p_cÛf
[i-1];

3533 
	gdp_cÛf
[
i
-1]=
p_cÛf
[i]*
¡©ic_ÿ¡
<
ty³0
>(i);

3536 
	gÜd
--;

3537 
	gicurs
++;

3540 
	gtmp0
=
sq¹
(
M_PI
)/
¡©ic_ÿ¡
<
ty³0
>(
N
);

3541 
	gi
=0;i<
	gN
-1;i++)

3542 
	gtmp0
*=
¡©ic_ÿ¡
<
ty³0
>(2*(
i
+1));

3544 if(
	gN
%2==1)

3545 
w
[
N
/2]=
tmp0
/(
p_2
[0]*p_2[0]);

3548 
	gi
=0;i<
	gN
/2;i++)

3550 
	gicurs
--;

3551 
	gw
[
icurs
]*=
tmp0
;

3552 
	gw
[
i
]=
w
[
icurs
];

3553 
	gx
[
i
]=-
x
[
icurs
];

3559 
	g‹m¶©e
<cÚ¡ 
	gN
>

3560 
	gXM©h
::
quad_lg
(
ty³0
 (&
x
)[
N
],ty³0 (&
w
)[N])

3562 
cÚ¡ex´
 
	gM
=
N
/2+1;

3563 
cÚ¡ex´
 
	gmax_™”
=50;

3564 
cÚ¡ex´
 
ty³0
 
	gtŞ
=
¡d
::
num”ic_lim™s
<ty³0>::
•sÚ
();

3567 
	g™”
,
	gÜd
,
	gicurs
,
	gjcurs
;

3568 
ty³0
 
	ga
,
	gu0
,
	gšv_u0
,
	gf
,
	gup
,
	gdf
,
	gtmp0
;

3569 
ty³0
 
	gii
,
	gjj
,
	gd–_u0
;

3570 
ty³0
 
	gp_cÛf
[
M
];

3571 
ty³0
 
	gdp_cÛf
[
M
];

3572 
	gAlgeb¿
::
z”o
<
M
>(
p_cÛf
);

3573 
	gAlgeb¿
::
z”o
<
M
>(
dp_cÛf
);

3575 
	gup
=0.0;

3577 
	gp_cÛf
[0]=1.0;

3581 
	g__m
,
	gi
=0;i<
	gN
;i++)

3583 
	gii
=
¡©ic_ÿ¡
<
ty³0
>(
i
+1);

3584 if(
	gi
%2)

3586 
	g__m
=(
i
+3)/2;

3587 
	gp_cÛf
[
__m
-1]=(2.0-1.0/
ii
)*
p_cÛf
[__m-2];

3588 
	gj
=
__m
-2;j>0;j--)

3590 
	gjj
=
¡©ic_ÿ¡
<
ty³0
>(
j
);

3591 
	gp_cÛf
[
j
]*=-(2.0*
jj
+1)/
ii
;

3592 
	gp_cÛf
[
j
]+=(1.0+(2*
jj
-1.0)/
ii
)*
p_cÛf
[j-1];

3594 
	gp_cÛf
[0]*=-1.0/
ii
;

3598 
	g__m
=
i
/2+1;

3599 
	gj
=0;j<
	g__m
-1;j++)

3601 
	gjj
=
¡©ic_ÿ¡
<
ty³0
>(
j
);

3602 
	gp_cÛf
[
j
]*=1.0+2.0*
jj
/
ii
;

3603 
	gp_cÛf
[
j
]-=2.0*(
jj
+1.0)*
p_cÛf
[j+1]/
ii
;

3606 
	gp_cÛf
[
__m
-1]*=2.0-1.0/
ii
;

3612 
	gi
=0;i<
	gM
-1;i++)

3613 
	gdp_cÛf
[
i
]=
p_cÛf
[i+1]*
¡©ic_ÿ¡
<
ty³0
>(i+1);

3615 
	gÜd
=
M
;

3616 
	gicurs
=
N
-1;

3617 
	ga
=
p_cÛf
[
M
-1];

3619 
	gi
=0;i<
	gM
;i++)

3620 
	gp_cÛf
[
i
]/=
a
;

3621 
	gi
=0;i<
	gM
-1;i++)

3622 
	gdp_cÛf
[
i
]/=
a
;

3624 
	gÜd
>1)

3626 
	gu0
=1.0;

3627 
	gf
=1.0;

3628 
	gd–_u0
=0.0;

3629 
	g™”
=
max_™”
;

3630 
çbs
(
f
)>
	gtŞ
 && 
	g™”
)

3632 
	gu0
+=
d–_u0
;

3633 
	gdf
=
f
=0.0;

3634 
	gtmp0
=1.0;

3635 
	gj
=0;j<
	gÜd
-1;j++)

3637 
	gf
+=
p_cÛf
[
j
]*
tmp0
;

3638 
	gdf
+=
dp_cÛf
[
j
]*
tmp0
;

3639 
	gtmp0
*=
u0
;

3641 
	gf
+=
p_cÛf
[
Üd
-1]*
tmp0
;

3642 
	gd–_u0
=-
f
/
df
;

3643 
	g™”
--;

3646 
	gx
[
icurs
]=
sq¹
(
u0
);

3648 
	gšv_u0
=1.0/
u0
;

3649 
	gp_cÛf
[0]*=-
šv_u0
;

3650 
	gi
=1;i<
	gÜd
-1;i++)

3652 
	gp_cÛf
[
i
]*=-
šv_u0
;

3653 
	gp_cÛf
[
i
]+=
šv_u0
*
p_cÛf
[i-1];

3654 
	gdp_cÛf
[
i
-1]=
p_cÛf
[i]*
¡©ic_ÿ¡
<
ty³0
>(i);

3657 
	gÜd
--;

3658 
	gicurs
--;

3662 if(
	gN
%2==0)

3664 
icurs
++;

3665 
	gjcurs
=
icurs
-1;

3666 
	gi
=
icurs
;i<
	gN
;i++)

3668 
	gtmp0
=
a
;

3669 
	gj
=
icurs
;j<
	gN
;j++)

3671 if(
	gi
!=
j
)

3672 
tmp0
*=
x
[
i
]*x[i]-x[
j
]*x[j];

3674 
	gtmp0
*=
x
[
i
]+x[
j
];

3676 
	gw
[
i
]=2.0/(
tmp0
*tmp0*(1.0-
x
[i]*x[i]));

3677 
	gw
[
jcurs
]=
w
[
i
];

3678 
	gx
[
jcurs
]=-
x
[
i
];

3679 
	gjcurs
--;

3684 
	gx
[
icurs
]=0.0;

3685 
	gicurs
++;

3686 
	gtmp0
=
a
;

3687 
	gi
=
icurs
;i<
	gN
;i++)

3688 
	gtmp0
*=-
x
[
i
]*x[i];

3689 
	gw
[
icurs
-1]=2.0/(
tmp0
*tmp0);

3691 
	gjcurs
=
icurs
-2;

3692 
	gi
=
icurs
;i<
	gN
;i++)

3694 
	gtmp0
=
a
*
x
[
i
];

3695 
	gj
=
icurs
;j<
	gN
;j++)

3697 if(
	gi
!=
j
)

3698 
tmp0
*=
x
[
i
]*x[i]-x[
j
]*x[j];

3700 
	gtmp0
*=
x
[
i
]+x[
j
];

3702 
	gw
[
i
]=2.0/(
tmp0
*tmp0*(1.0-
x
[i]*x[i]));

3703 
	gw
[
jcurs
]=
w
[
i
];

3704 
	gx
[
jcurs
]=-
x
[
i
];

3705 
	gjcurs
--;

	@
1
.
0
147
1787
MAPP.cpp
MAPP.h
api.h
atoms.cpp
atoms.h
atoms_dmd.cpp
atoms_dmd.h
atoms_md.cpp
atoms_md.h
atoms_styles.h
cell.h
comm.cpp
comm.h
dae.cpp
dae.h
dae_bdf.cpp
dae_bdf.h
dae_imp.cpp
dae_imp.h
dae_styles.h
dynamic.cpp
dynamic.h
dynamic_dmd.cpp
dynamic_dmd.h
dynamic_md.cpp
dynamic_md.h
elements.cpp
elements.h
example.cpp
example.h
exchange.cpp
exchange.h
export.cpp
export.h
export_cfg_dmd.cpp
export_cfg_dmd.h
export_cfg_md.cpp
export_cfg_md.h
export_styles.h
ff.cpp
ff.h
ff_dmd.cpp
ff_dmd.h
ff_eam.cpp
ff_eam.h
ff_eam_dmd.cpp
ff_eam_dmd.h
ff_eam_dmd_cluster.cpp
ff_eam_dmd_cluster.h
ff_eam_dmd_sc.cpp
ff_eam_dmd_sc.h
ff_eam_dmd_scc.cpp
ff_eam_dmd_scc.h
ff_eam_fit.cpp
ff_eam_fit.h
ff_eam_fit_o.cpp
ff_eam_fit_o.h
ff_eam_func.cpp
ff_eam_func.h
ff_eam_potfit.cpp
ff_eam_potfit.h
ff_fs.cpp
ff_fs.h
ff_lj.cpp
ff_lj.h
ff_md.cpp
ff_md.h
ff_meam.cpp
ff_meam.h
ff_styles.h
ff_tersoff.cpp
ff_tersoff.h
gcmc.cpp
gcmc.h
global.h
gmres.cpp
gmres.h
import.cpp
import.h
import_cfg.cpp
import_cfg.h
import_eam.cpp
import_eam.h
import_styles.h
logics.cpp
logics.h
ls.cpp
ls.h
macro_extra.h
macros.h
main.cpp
mapp_func.h
md_muvt_2.cpp
md_muvt_2.h
md_nst.cpp
md_nst.h
md_nvt.cpp
md_nvt.h
md_styles.h
memory.h
min.cpp
min.h
min_cg.cpp
min_cg.h
min_cg3_dmd.cpp
min_cg3_dmd.h
min_cg_dmd.cpp
min_cg_dmd.h
min_cg_potfit.cpp
min_cg_potfit.h
min_l-bfgs.cpp
min_l-bfgs.h
min_l-bfgs_dmd.cpp
min_l-bfgs_dmd.h
min_styles.h
min_vec.h
neighbor.cpp
neighbor.h
neighbor_dmd.cpp
neighbor_dmd.h
neighbor_dmd_sc.cpp
neighbor_dmd_sc.h
neighbor_md.cpp
neighbor_md.h
pgcmc_2.cpp
pgcmc_2.h
potfit.cpp
potfit.h
potfit_funcs.cpp
potfit_funcs.h
potfit_o.cpp
potfit_o.h
print.h
py_compat.h
random.cpp
random.h
thermo_dynamics.cpp
thermo_dynamics.h
thermostat.cpp
thermostat.h
timer.cpp
timer.h
var.cpp
var.h
var_op.h
xmath.cpp
xmath.h
